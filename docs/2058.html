<html>
<head>
<title>Implementing Proof of Stake Part — 5</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">实施利害关系证明第5部分</h1>
<blockquote>原文：<a href="https://medium.com/coinmonks/implementing-proof-of-stake-part-5-7e3d5b6cdc31?source=collection_archive---------1-----------------------#2019-02-10">https://medium.com/coinmonks/implementing-proof-of-stake-part-5-7e3d5b6cdc31?source=collection_archive---------1-----------------------#2019-02-10</a></blockquote><div><div class="ef hh hi hj hk hl"/><div class="hm hn ho hp hq"><div class=""/><div class=""><h2 id="0fe8" class="pw-subtitle-paragraph iq hs ht bd b ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ek translated">账户、股份和验证者</h2></div><figure class="jj jk jl jm fq jn fe ff paragraph-image"><div class="fe ff ji"><img src="../Images/67a3c3a562cf394e00d1dc1fd2774c83.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*X1523S70lXzN1lyg8sm7mQ.jpeg"/></div></figure><p id="44a9" class="pw-post-body-paragraph jq jr ht js b jt ju iu jv jw jx ix jy jz ka kb kc kd ke kf kg kh ki kj kk kl hm dt translated">在前一篇文章中，我们创建了一个钱包，签署了交易并将其广播到网络。在这篇文章中，我们将在我们的应用程序中添加一些额外的功能。我们将实现一个帐户模型、股份模型和验证者列表。</p><h1 id="dcce" class="km kn ht bd ko kp kq kr ks kt ku kv kw iz kx ja ky jc kz jd la jf lb jg lc ld dt translated">帐目</h1><p id="d332" class="pw-post-body-paragraph jq jr ht js b jt le iu jv jw lf ix jy jz lg kb kc kd lh kf kg kh li kj kk kl hm dt translated">比特币使用UTXOs的概念，而以太坊使用账户模型来跟踪节点余额。账户模型是以太坊中的另一棵默克尔树，就像区块链一样。每笔交易执行时，特定账户的余额要么增加，要么减少。因此，可以简单地将其视为一个大型的键-值哈希表，其中键是节点的帐户，值是余额。我们将在应用程序中创建一个对象来创建一个帐户模型，而不是实际创建merkel树。</p><p id="4b5e" class="pw-post-body-paragraph jq jr ht js b jt ju iu jv jw jx ix jy jz ka kb kc kd ke kf kg kh ki kj kk kl hm dt translated">因此，让我们通过在区块链文件夹中添加一个名为<code class="eh lj lk ll lm b">account.js</code>的新文件来创建一个帐户模型</p><p id="9539" class="pw-post-body-paragraph jq jr ht js b jt ju iu jv jw jx ix jy jz ka kb kc kd ke kf kg kh ki kj kk kl hm dt translated">我们的账户模型应该提供以下功能—</p><ol class=""><li id="5c9d" class="ln lo ht js b jt ju jw jx jz lp kd lq kh lr kl ls lt lu lv dt translated">增量平衡</li><li id="a4a3" class="ln lo ht js b jt lw jw lx jz ly kd lz kh ma kl ls lt lu lv dt translated">减量平衡</li><li id="a28e" class="ln lo ht js b jt lw jw lx jz ly kd lz kh ma kl ls lt lu lv dt translated">转移硬币</li><li id="1885" class="ln lo ht js b jt lw jw lx jz ly kd lz kh ma kl ls lt lu lv dt translated">转让手续费</li><li id="8264" class="ln lo ht js b jt lw jw lx jz ly kd lz kh ma kl ls lt lu lv dt translated">更新帐户状态</li><li id="3cb1" class="ln lo ht js b jt lw jw lx jz ly kd lz kh ma kl ls lt lu lv dt translated">获取给定账户的余额</li></ol><figure class="jj jk jl jm fq jn"><div class="bz el l di"><div class="mb mc l"/></div></figure><p id="bbee" class="pw-post-body-paragraph jq jr ht js b jt ju iu jv jw jx ix jy jz ka kb kc kd ke kf kg kh ki kj kk kl hm dt translated">Account类有两个属性address和对应于这些地址的balances。</p><p id="568a" class="pw-post-body-paragraph jq jr ht js b jt ju iu jv jw jx ix jy jz ka kb kc kd ke kf kg kh ki kj kk kl hm dt translated">贷记和借记有两种不同的功能。<code class="eh lj lk ll lm b">getBalance </code>函数只是返回给定键的值。传递函数利用递增和递减函数来模拟值的传递，最后，更新函数接受并执行一个事务。</p><p id="251c" class="pw-post-body-paragraph jq jr ht js b jt ju iu jv jw jx ix jy jz ka kb kc kd ke kf kg kh ki kj kk kl hm dt translated"><em class="md">注意:初始化函数可以解决这个问题，因为balances对象没有地址或键，当创建新帐户时，它的默认余额为零，所以这个函数安全地处理这种情况，并为每个帐户分配一个零余额。</em></p><h2 id="9195" class="me kn ht bd ko mf mg mh ks mi mj mk kw jz ml mm ky kd mn mo la kh mp mq lc mr dt translated">钱包和余额</h2><p id="d28c" class="pw-post-body-paragraph jq jr ht js b jt le iu jv jw lf ix jy jz lg kb kc kd lh kf kg kh li kj kk kl hm dt translated">我们现在可以在我们的钱包中添加函数来获得节点的余额。为了保持代码的整洁，我们将在区块链类中添加一个函数来获取任何节点的余额，并重用钱包中的代码。</p><pre class="jj jk jl jm fq ms lm mt mu aw mv dt"><span id="35cf" class="me kn ht lm b fv mw mx l my mz"> // blockchain.js</span><span id="913e" class="me kn ht lm b fv na mx l my mz">  getBalance(publicKey) {<br/>    return this.accounts.getBalance(publicKey);<br/>  }</span></pre><p id="5cf3" class="pw-post-body-paragraph jq jr ht js b jt ju iu jv jw jx ix jy jz ka kb kc kd ke kf kg kh ki kj kk kl hm dt translated">我们现在可以在wallet类中调用这个函数，在创建交易之前检查余额。</p><figure class="jj jk jl jm fq jn"><div class="bz el l di"><div class="mb mc l"/></div></figure><p id="7f09" class="pw-post-body-paragraph jq jr ht js b jt ju iu jv jw jx ix jy jz ka kb kc kd ke kf kg kh ki kj kk kl hm dt translated">我们将在后面的教程中添加转会费功能。</p><h1 id="d769" class="km kn ht bd ko kp kq kr ks kt ku kv kw iz kx ja ky jc kz jd la jf lb jg lc ld dt translated">桩</h1><p id="6fc1" class="pw-post-body-paragraph jq jr ht js b jt le iu jv jw lf ix jy jz lg kb kc kd lh kf kg kh li kj kk kl hm dt translated">我们需要一种方法来跟踪一个节点下注的硬币数量。在以太坊中，每个方块持有赌注金额，但我们将保持简单，并为其创建一个单独的模型来概括这个概念。由于具有最大赌注的节点被选为领导者或伪造块者，我们通过在该模型中查找赌注硬币来找到下一个领导者。股份模型的功能类似于账户模型。</p><p id="a3ca" class="pw-post-body-paragraph jq jr ht js b jt ju iu jv jw jx ix jy jz ka kb kc kd ke kf kg kh ki kj kk kl hm dt translated">通过在区块链文件夹中添加一个名为<code class="eh lj lk ll lm b">stake.js</code>的新文件来创建一个桩子模型</p><figure class="jj jk jl jm fq jn"><div class="bz el l di"><div class="mb mc l"/></div></figure><p id="a1a9" class="pw-post-body-paragraph jq jr ht js b jt ju iu jv jw jx ix jy jz ka kb kc kd ke kf kg kh ki kj kk kl hm dt translated">addStake函数增加节点的堆叠量。getStake函数返回赌注金额。getMax函数返回具有最大赌注硬币的节点地址。update函数只是执行事务的addStake函数的包装器。</p><h1 id="bd93" class="km kn ht bd ko kp kq kr ks kt ku kv kw iz kx ja ky jc kz jd la jf lb jg lc ld dt translated">验证器</h1><p id="f8c3" class="pw-post-body-paragraph jq jr ht js b jt le iu jv jw lf ix jy jz lg kb kc kd lh kf kg kh li kj kk kl hm dt translated">验证器节点不同于PoS中的普通节点。验证器节点可以添加标桩，被选为领导者和创建块。但不是所有的节点都可以是验证器。只有那些发送包含验证器费用的特殊事务的节点才能成为验证器。费用或硬币随后被烧掉，不再使用。在Casper中，每个节点以前需要支付1000个以太，现在需要32个以太才能成为验证者。</p><p id="93c8" class="pw-post-body-paragraph jq jr ht js b jt ju iu jv jw jx ix jy jz ka kb kc kd ke kf kg kh ki kj kk kl hm dt translated">为了将这个特性添加到我们的项目中，我们将在区块链文件夹中创建一个名为<code class="eh lj lk ll lm b">validators.js</code>的文件，该文件将包含一个地址列表，这些地址是验证者并且已经提交了费用。</p><figure class="jj jk jl jm fq jn"><div class="bz el l di"><div class="mb mc l"/></div></figure><p id="dfeb" class="pw-post-body-paragraph jq jr ht js b jt ju iu jv jw jx ix jy jz ka kb kc kd ke kf kg kh ki kj kk kl hm dt translated">费用可以是任何整数，这里我有30英镑，这笔钱的接收者是一个地址“0 ”,这是一个特殊的地址，所有应该被烧毁的硬币都被送到这个地址。如果条件匹配，这个函数简单地将地址添加到列表中。</p><h1 id="4908" class="km kn ht bd ko kp kq kr ks kt ku kv kw iz kx ja ky jc kz jd la jf lb jg lc ld dt translated">交易类型</h1><p id="bc43" class="pw-post-body-paragraph jq jr ht js b jt le iu jv jw lf ix jy jz lg kb kc kd lh kf kg kh li kj kk kl hm dt translated">在这个应用中有三种类型的交易——</p><ol class=""><li id="e076" class="ln lo ht js b jt ju jw jx jz lp kd lq kh lr kl ls lt lu lv dt translated">交易——用于常规交易(想不出更好的名称)</li><li id="0300" class="ln lo ht js b jt lw jw lx jz ly kd lz kh ma kl ls lt lu lv dt translated">赌注——用于赌硬币</li><li id="4948" class="ln lo ht js b jt lw jw lx jz ly kd lz kh ma kl ls lt lu lv dt translated">VALIDATOR_FEE —成为验证者的固定金额的交易</li></ol></div><div class="ab cl nb nc hb nd" role="separator"><span class="ne bw bk nf ng nh"/><span class="ne bw bk nf ng nh"/><span class="ne bw bk nf ng"/></div><div class="hm hn ho hp hq"><p id="78c4" class="pw-post-body-paragraph jq jr ht js b jt ju iu jv jw jx ix jy jz ka kb kc kd ke kf kg kh ki kj kk kl hm dt translated"><em class="md">感谢您的阅读。</em> <strong class="js hu"> <em class="md">在下一部分中，我们将为我们的硬币创建一个ICO，添加一个静态的leader，并生成和广播块。</em> </strong> <em class="md">希望你喜欢编码。如果你发现这很有帮助，请鼓掌。</em>T13】</p><p id="4ed5" class="pw-post-body-paragraph jq jr ht js b jt ju iu jv jw jx ix jy jz ka kb kc kd ke kf kg kh ki kj kk kl hm dt translated">如果你对区块链、以太坊或整个世界有任何疑问，请发表评论。:)</p><figure class="jj jk jl jm fq jn fe ff paragraph-image"><a href="http://bit.ly/2G71Sp7"><div class="fe ff ni"><img src="../Images/449450761cd76f44f9ae574333f9e9af.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fKX2mtg7p1lOs7JmosPLsA.png"/></div></a><figcaption class="nj nk fg fe ff nl nm bd b be z ek">k</figcaption></figure><blockquote class="nn"><p id="6730" class="no np ht bd nq nr ns nt nu nv nw kl ek translated"><a class="ae nx" href="https://coincodecap.com/?utm_source=coinmonks" rel="noopener ugc nofollow" target="_blank">直接在您的收件箱中获得最佳软件交易</a></p></blockquote><figure class="nz oa ob oc od jn fe ff paragraph-image"><a href="https://coincodecap.com/?utm_source=coinmonks"><div class="fe ff ny"><img src="../Images/7c0b3dfdcbfea594cc0ae7d4f9bf6fcb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1168/format:webp/0*OJ-qb5G6i863msBB.png"/></div></a></figure></div></div>    
</body>
</html>