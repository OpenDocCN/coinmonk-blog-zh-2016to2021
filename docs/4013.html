<html>
<head>
<title>How to display internal ERC20 Token transfers in Truffle Tests?</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在Truffle测试中显示内部ERC20令牌传输？</h1>
<blockquote>原文：<a href="https://medium.com/coinmonks/how-to-display-internal-erc20-token-transfers-in-truffle-tests-cdd953f400c9?source=collection_archive---------0-----------------------#2021-02-06">https://medium.com/coinmonks/how-to-display-internal-erc20-token-transfers-in-truffle-tests-cdd953f400c9?source=collection_archive---------0-----------------------#2021-02-06</a></blockquote><div><div class="ef hh hi hj hk hl"/><div class="hm hn ho hp hq"><div class=""/><p id="6ff9" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">在这篇文章中，我们将探索如何使用<a class="ae jo" href="https://www.npmjs.com/package/truffle-token-test-utils" rel="noopener ugc nofollow" target="_blank"> truffle-token-test-utils </a>包来可视化truffle和OpenZeppelin测试中的令牌传输。</p><figure class="jq jr js jt fq ju fe ff paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="fe ff jp"><img src="../Images/90f90e91c9fd1705e32e438cb4c8e79f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gW43JWTLij3hsVnOG44YlQ.png"/></div></div><figcaption class="kb kc fg fe ff kd ke bd b be z ek">Etherscan’s Token Transfers</figcaption></figure><p id="272e" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">当我们在以太坊区块链上进行交易时，通过在以太坊扫描上查找，可以很容易地查看发生的内部令牌转移，如上所示。<br/>在本地ganache或分叉mainnet上测试合同时，它可能是一个黑盒，因为您只能在交易前后检查令牌余额。</p><p id="9bb1" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">为了更容易实现类似于Etherscan的结果，我们将使用我的npm包:`<a class="ae jo" href="https://www.npmjs.com/package/truffle-token-test-utils" rel="noopener ugc nofollow" target="_blank">truffle-token-test-utils</a>`。</p><p id="b8bb" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">下面的教程是针对Truffle测试的，但是稍加修改(正如在<a class="ae jo" href="https://github.com/CodinMaster/truffle-token-test-utils#readme" rel="noopener ugc nofollow" target="_blank"> README </a>中提到的)你也可以让它适用于OpenZeppelin测试！</p><p id="bfd0" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">这是我们最终将实现的终端输出:</p><figure class="jq jr js jt fq ju fe ff paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="fe ff kf"><img src="../Images/dc3151ee6f9b14f519c798edc0bcea3e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TnUJ2Uy0igBjVUL_KAmhRw.png"/></div></div></figure><h2 id="278f" class="kg kh ht bd ki kj kk kl km kn ko kp kq jb kr ks kt jf ku kv kw jj kx ky kz la dt translated">第一步</h2><p id="94c3" class="pw-post-body-paragraph iq ir ht is b it lb iv iw ix lc iz ja jb ld jd je jf le jh ji jj lf jl jm jn hm dt translated">在你的块菌项目<br/> <code class="eh lg lh li lj b">npm install truffle-token-test-utils</code>中安装这个包</p><h2 id="3e32" class="kg kh ht bd ki kj kk kl km kn ko kp kq jb kr ks kt jf ku kv kw jj kx ky kz la dt translated">第二步</h2><p id="d2ff" class="pw-post-body-paragraph iq ir ht is b it lb iv iw ix lc iz ja jb ld jd je jf le jh ji jj lf jl jm jn hm dt translated">在您的测试文件<br/>中导入包<code class="eh lg lh li lj b">const tokenTransfers = require("truffle-token-test-utils");</code></p><h2 id="ae4a" class="kg kh ht bd ki kj kk kl km kn ko kp kq jb kr ks kt jf ku kv kw jj kx ky kz la dt translated">第三步</h2><p id="3da2" class="pw-post-body-paragraph iq ir ht is b it lb iv iw ix lc iz ja jb ld jd je jf le jh ji jj lf jl jm jn hm dt translated">像这样初始化<code class="eh lg lh li lj b">tokenTransfers</code>对象:</p><pre class="jq jr js jt fq lk lj ll lm aw ln dt"><span id="a2ad" class="kg kh ht lj b fv lo lp l lq lr">contract("ContractName", (accounts) =&gt; {<br/>  tokenTransfers.setWeb3(web3);<br/>  ...<br/>}</span></pre><p id="d9f2" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">在这里，<code class="eh lg lh li lj b">web3</code>对象在测试执行期间被truffle自动注入。</p><h2 id="50fe" class="kg kh ht bd ki kj kk kl km kn ko kp kq jb kr ks kt jf ku kv kw jj kx ky kz la dt translated">第四步</h2><p id="27ca" class="pw-post-body-paragraph iq ir ht is b it lb iv iw ix lc iz ja jb ld jd je jf le jh ji jj lf jl jm jn hm dt translated">在您的测试用例的<code class="eh lg lh li lj b">it</code>块中，当您调用契约函数时，将它存储在<code class="eh lg lh li lj b">tx</code>变量中，并在控制台中打印令牌传输:</p><pre class="jq jr js jt fq lk lj ll lm aw ln dt"><span id="46c8" class="kg kh ht lj b fv lo lp l lq lr">const tx = await someContract.someFunction();<br/>await tokenTransfers.print(tx);</span></pre><p id="4141" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">就是这样！运行测试并可视化令牌交易！</p><p id="0a36" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">当调用“print”时，还有几个额外的参数可以传递，它们都在<a class="ae jo" href="https://github.com/CodinMaster/truffle-token-test-utils#readme" rel="noopener ugc nofollow" target="_blank">自述文件</a>中进行了解释。</p><p id="4882" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated"><em class="ls">与我保持联系:</em> <br/> <strong class="is hu">推特</strong>:<a class="ae jo" href="https://twitter.com/apoorvlathey" rel="noopener ugc nofollow" target="_blank">https://twitter.com/apoorvlathey</a><br/><strong class="is hu">网站</strong>:<a class="ae jo" href="https://apoorvlathey.com/" rel="noopener ugc nofollow" target="_blank">https://apoorvlathey.com/</a><br/><strong class="is hu">Github</strong>:<a class="ae jo" href="https://github.com/CodinMaster" rel="noopener ugc nofollow" target="_blank">https://github.com/CodinMaster</a></p></div></div>    
</body>
</html>