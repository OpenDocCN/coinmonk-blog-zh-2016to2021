<html>
<head>
<title>Smart Contracts 101: The Ethereum Virtual Machine (EVM)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">智能合同101:以太坊虚拟机(EVM)</h1>
<blockquote>原文：<a href="https://medium.com/coinmonks/smart-contracts-101-the-ethereum-virtual-machine-cc58c12468bf?source=collection_archive---------1-----------------------#2020-10-12">https://medium.com/coinmonks/smart-contracts-101-the-ethereum-virtual-machine-cc58c12468bf?source=collection_archive---------1-----------------------#2020-10-12</a></blockquote><div><div class="ef hh hi hj hk hl"/><div class="hm hn ho hp hq"><div class=""/><figure class="fi fk ir is it iu fe ff paragraph-image"><div role="button" tabindex="0" class="iv iw di ix bf iy"><div class="fe ff iq"><img src="../Images/041d647ce0b793b961aef90d5006a2b1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*M1UQpx9Ku8ZlJ9eT"/></div></div><figcaption class="jb jc fg fe ff jd je bd b be z ek">Photo by <a class="ae jf" href="https://unsplash.com/@markusspiske?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Markus Spiske</a> on <a class="ae jf" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="09e9" class="pw-post-body-paragraph jg jh ht ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated"><strong class="ji hu">在我们开始之前<br/> </strong> <em class="ke">这篇文章是从头开始介绍智能合约基本概念的系列文章的第二部分。之前的帖子可以在这里找到:</em> <a class="ae jf" rel="noopener" href="/@bobface/smart-contracts-101-an-introduction-to-smart-contracts-on-ethereum-85cc70ce1943"> <em class="ke">智能合约101:以太坊上的智能合约介绍</em> </a></p></div><div class="ab cl kf kg hb kh" role="separator"><span class="ki bw bk kj kk kl"/><span class="ki bw bk kj kk kl"/><span class="ki bw bk kj kk"/></div><div class="hm hn ho hp hq"><h1 id="ed64" class="km kn ht bd ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj dt translated">以太坊虚拟机(EVM)</h1><p id="32e1" class="pw-post-body-paragraph jg jh ht ji b jj lk jl jm jn ll jp jq jr lm jt ju jv ln jx jy jz lo kb kc kd hm dt translated">当智能合约被调用时，它的代码在一个叫做<em class="ke">以太坊虚拟机(EVM) </em>的环境中执行。EVM可以想象成一个运行在256位字上的虚拟处理器。与现代硬件处理器相比，EVM提供的指令集相当有限。然而，它足够强大，可以实现图灵完备性。这有其自身的含义，我们将在本文中进一步探讨。</p><p id="b2a3" class="pw-post-body-paragraph jg jh ht ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated"><strong class="ji hu">指令和字节码<br/> </strong>智能合约的代码叫做<em class="ke"> EVM字节码</em>。字节码本身由<em class="ke">指令</em>组成，也称为<em class="ke">操作码</em>。指令告诉虚拟处理器做什么。例如，执行<em class="ke"> ADD </em>指令将导致堆栈上最上面的两个数相加。有关所有操作码的完整参考，请访问<a class="ae jf" href="https://ethervm.io" rel="noopener ugc nofollow" target="_blank"> ethervm.io </a></p><p id="1473" class="pw-post-body-paragraph jg jh ht ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated">一旦一个合同被部署到区块链，它的字节码将被永久保存，从而对每个人公开可见。它也是不可变的，一旦被部署，即使它的创建者也不能改变它。</p><p id="c907" class="pw-post-body-paragraph jg jh ht ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated"><em class="ke">举例。</em>访问以太网扫描上Dai令牌的<a class="ae jf" href="https://etherscan.io/address/0x6b175474e89094c44da98b954eedeac495271d0f#code" rel="noopener ugc nofollow" target="_blank">合同页面，并向下滚动到<em class="ke">合同创建代码。你现在看到的是十六进制表示的合同字节码。您可以点击<em class="ke">切换到操作码视图</em>以人类可读的形式查看字节码。</em></a></p></div><div class="ab cl kf kg hb kh" role="separator"><span class="ki bw bk kj kk kl"/><span class="ki bw bk kj kk kl"/><span class="ki bw bk kj kk"/></div><div class="hm hn ho hp hq"><h1 id="0fc9" class="km kn ht bd ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj dt translated">智能合约的属性</h1><p id="ffb8" class="pw-post-body-paragraph jg jh ht ji b jj lk jl jm jn ll jp jq jr lm jt ju jv ln jx jy jz lo kb kc kd hm dt translated">智能合同状态由多个不同的属性定义:</p><ul class=""><li id="c1d7" class="lp lq ht ji b jj jk jn jo jr lr jv ls jz lt kd lu lv lw lx dt translated"><em class="ke">由创建者地址和<a class="ae jf" href="https://ethereum.stackexchange.com/questions/27432/what-is-nonce-in-ethereum-how-does-it-prevent-double-spending" rel="noopener ugc nofollow" target="_blank">账号随机数</a>推导出的地址</em>。还有<em class="ke"> CREATE2 </em>指令，其结果地址的计算是不同的。参见<a class="ae jf" href="https://hackernoon.com/using-ethereums-create2-nw2137q7" rel="noopener ugc nofollow" target="_blank">使用以太坊的CREATE2 on Hackernoon </a>。</li><li id="3290" class="lp lq ht ji b jj ly jn lz jr ma jv mb jz mc kd lu lv lw lx dt translated"><em class="ke">乙醚中的一种平衡</em>。契约能够发送和接收以太。</li><li id="1f73" class="lp lq ht ji b jj ly jn lz jr ma jv mb jz mc kd lu lv lw lx dt translated"><em class="ke">当契约被调用时，从第一条指令开始执行的字节码</em>。</li><li id="fc90" class="lp lq ht ji b jj ly jn lz jr ma jv mb jz mc kd lu lv lw lx dt translated"><em class="ke">持久存储</em>在合同执行期间保存。存储可以理解为合同的硬盘。</li></ul><p id="02d0" class="pw-post-body-paragraph jg jh ht ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated">此外，在执行期间，有更多的地址空间和属性可用<em class="ke">:</em></p><ul class=""><li id="e5cb" class="lp lq ht ji b jj jk jn jo jr lr jv ls jz lt kd lu lv lw lx dt translated"><em class="ke">内存</em>可以想象成<a class="ae jf" href="https://en.wikipedia.org/wiki/Random-access_memory" rel="noopener ugc nofollow" target="_blank"> RAM </a>。</li><li id="d1f3" class="lp lq ht ji b jj ly jn lz jr ma jv mb jz mc kd lu lv lw lx dt translated"><em class="ke">一个堆栈</em>类似于正常流程中的堆栈。参见<a class="ae jf" href="https://www.bottomupcs.com/elements_of_a_process.xhtml" rel="noopener ugc nofollow" target="_blank">堆栈</a>。</li><li id="cdf3" class="lp lq ht ji b jj ly jn lz jr ma jv mb jz mc kd lu lv lw lx dt translated"><em class="ke">全局变量</em>如当前时间戳或当前块号。</li><li id="9111" class="lp lq ht ji b jj ly jn lz jr ma jv mb jz mc kd lu lv lw lx dt translated"><em class="ke"> Calldata </em>可以提供给合同执行的附加数据，如参数。</li></ul><p id="da89" class="pw-post-body-paragraph jg jh ht ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated">EVM提供了与上面列出的所有内容进行交互的指令。</p><p id="8330" class="pw-post-body-paragraph jg jh ht ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated">顺便提一下:EVM提供的地址空间是严格分开的。这种分离的副作用是它阻止了一些经典的软件开发模式，比如重写返回指针和将代码执行重定向到堆栈。然而，这并不意味着智能合同不会被利用！我们将在本系列的后面讨论合同安全性。</p></div><div class="ab cl kf kg hb kh" role="separator"><span class="ki bw bk kj kk kl"/><span class="ki bw bk kj kk kl"/><span class="ki bw bk kj kk"/></div><div class="hm hn ho hp hq"><h1 id="b3d9" class="km kn ht bd ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj dt translated">图灵完备性和执行成本</h1><p id="3a71" class="pw-post-body-paragraph jg jh ht ji b jj lk jl jm jn ll jp jq jr lm jt ju jv ln jx jy jz lo kb kc kd hm dt translated">图灵完备性是一个复杂的话题，需要进一步的理论概念的知识来理解。正式的定义是这样的:</p><blockquote class="md me mf"><p id="f5be" class="jg jh ke ji b jj jk jl jm jn jo jp jq mg js jt ju mh jw jx jy mi ka kb kc kd hm dt translated">能够计算每一个图灵- <a class="ae jf" href="https://en.wikipedia.org/wiki/Computable_function" rel="noopener ugc nofollow" target="_blank">可计算函数</a>的计算系统称为图灵完备(或图灵强大)。或者，这样的系统可以模拟通用图灵机。<a class="ae jf" href="https://en.wikipedia.org/wiki/Turing_completeness" rel="noopener ugc nofollow" target="_blank">来源</a></p></blockquote><p id="f3b4" class="pw-post-body-paragraph jg jh ht ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated">幸运的是，我们不需要理解完整的形式定义。对于我们的用例来说，一个普遍接受的简化是足够的:</p><blockquote class="md me mf"><p id="4fc1" class="jg jh ke ji b jj jk jl jm jn jo jp jq mg js jt ju mh jw jx jy mi ka kb kc kd hm dt translated">图灵完全意味着你的机制可以运行你能想到的任何算法，不管它有多复杂、多深奥、多递归、多复杂、多长……,也不管评估它需要多少存储空间或时间。<a class="ae jf" href="https://cs.stackexchange.com/questions/71473/what-does-being-turing-complete-mean" rel="noopener ugc nofollow" target="_blank">来源</a></p></blockquote><p id="7ee5" class="pw-post-body-paragraph jg jh ht ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated"><strong class="ji hu">问题<br/> </strong>关于图灵完全机器(在这种情况下机器是我们的EVM)的一个已被证明的事实是，不可能有一个程序，当给定任何程序任何输入时，它总是能够可靠地确定执行是将结束还是将永远继续。这个问题被称为<a class="ae jf" href="https://en.wikipedia.org/wiki/Halting_problem" rel="noopener ugc nofollow" target="_blank">停顿问题</a>。</p><p id="3789" class="pw-post-body-paragraph jg jh ht ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated">随着EVM的完成，是什么阻止了恶意参与者部署智能合同，该合同将陷入无限循环，导致全球以太坊节点从其主机上吃掉越来越多的资源，直到被操作系统杀死并离线——实际上从内部对以太坊网络造成了全球性的<a class="ae jf" href="https://en.wikipedia.org/wiki/Denial-of-service_attack" rel="noopener ugc nofollow" target="_blank"> DOS攻击</a>?</p><p id="d6f7" class="pw-post-body-paragraph jg jh ht ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated">即使我们忽略无限循环，仍然有可能通过执行复杂的指令(如计算输入的SHA3哈希的<em class="ke"> SHA3 </em>指令)给节点操作处理器带来大量负载，导致节点消耗更多的资源和功率。我们如何在不限制EVM功能的情况下，确保节点运营商因其提供的资源而获得补偿？</p><p id="92db" class="pw-post-body-paragraph jg jh ht ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated"><strong class="ji hu">解决方案<br/></strong>EVM提供的每一条指令都有一个附加的执行成本——燃气成本<em class="ke"/>。Gas是一个虚拟单位，用于衡量合同执行复杂性和资源使用情况，在任何地方都不能买卖。</p><p id="1663" class="pw-post-body-paragraph jg jh ht ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated">当契约运行时，节点跟踪它消耗的气体。如果下一条指令将导致消耗的气体量超过<em class="ke">气体限制</em>——由导致合同执行的交易的发起者提供的值——它将中止运行并将整个交易标记为失败。</p><p id="c29b" class="pw-post-body-paragraph jg jh ht ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated">交易的发起者还提供另一个称为<em class="ke">天然气价格</em>的值，该值是发起者愿意支付的单位消耗天然气的乙醚量。该值通常用<em class="ke"> Gwei </em>测量，其中<em class="ke"> 1 Gwei = 10^(-9)乙醚= 0.000000001乙醚</em>。</p><p id="620f" class="pw-post-body-paragraph jg jh ht ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated">最后，交易费用可以计算为<em class="ke">消耗单位天然气的数量*天然气价格</em>。该费用从发起交易的账户支付给开采包含该交易的区块的开采者。</p></div><div class="ab cl kf kg hb kh" role="separator"><span class="ki bw bk kj kk kl"/><span class="ki bw bk kj kk kl"/><span class="ki bw bk kj kk"/></div><div class="hm hn ho hp hq"><h1 id="5281" class="km kn ht bd ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj dt translated">摘要</h1><p id="2778" class="pw-post-body-paragraph jg jh ht ji b jj lk jl jm jn ll jp jq jr lm jt ju jv ln jx jy jz lo kb kc kd hm dt translated">在这一部分中，我们介绍了EVM的基本内部工作原理，这将为我们接下来的部分打下基础。在下一部分中，我们将探索以太坊网络中不同种类的节点以及它们所扮演的角色。</p><p id="f4f8" class="pw-post-body-paragraph jg jh ht ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated"><em class="ke">我很高兴收到您对以下帖子内容的反馈和建议。随时联系我！</em></p><h2 id="757e" class="mj kn ht bd ko mk ml mm ks mn mo mp kw jr mq mr la jv ms mt le jz mu mv li mw dt translated"><strong class="ak">还有，读</strong></h2><ul class=""><li id="f48c" class="lp lq ht ji b jj lk jn ll jr mx jv my jz mz kd lu lv lw lx dt translated"><a class="ae jf" rel="noopener" href="/coinmonks/defi-future-10-promising-projects-in-the-defi-world-ff2b697ab006">顶级DeFi项目</a></li><li id="3524" class="lp lq ht ji b jj ly jn lz jr ma jv mb jz mc kd lu lv lw lx dt translated"><a class="ae jf" rel="noopener" href="/coinmonks/best-wallets-to-use-uniswap-e91a6385d9e8">unis WAP最佳钱包</a></li><li id="6e2e" class="lp lq ht ji b jj ly jn lz jr ma jv mb jz mc kd lu lv lw lx dt translated"><a class="ae jf" rel="noopener" href="/coinmonks/best-crypto-apis-for-developers-5efe3a597a9f">面向开发人员的最佳加密API</a></li></ul><blockquote class="na"><p id="b751" class="nb nc ht bd nd ne nf ng nh ni nj kd ek translated"><a class="ae jf" href="https://coincodecap.com?utm_source=coinmonks" rel="noopener ugc nofollow" target="_blank">直接在您的收件箱中获得最佳软件交易</a></p></blockquote><figure class="nl nm nn no np iu fe ff paragraph-image"><a href="https://coincodecap.com?utm_source=coinmonks"><div class="fe ff nk"><img src="../Images/160ce73bd06d46c2250251e7d5969f9d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1168/format:webp/1*BoDnKUyK8p4hitHAJZ5Pdw.png"/></div></a></figure></div></div>    
</body>
</html>