<html>
<head>
<title>Payment Channels in Bitcoin</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">比特币的支付渠道</h1>
<blockquote>原文：<a href="https://medium.com/coinmonks/payment-channels-in-bitcoin-470b28e47bb0?source=collection_archive---------1-----------------------#2018-04-07">https://medium.com/coinmonks/payment-channels-in-bitcoin-470b28e47bb0?source=collection_archive---------1-----------------------#2018-04-07</a></blockquote><div><div class="ef hh hi hj hk hl"/><div class="hm hn ho hp hq"><div class=""/><p id="93d8" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">支付渠道是一个独立的解决方案，称为<strong class="is hu">第二层解决方案</strong>。这是可能发展的，因为比特币网络有一定的保证，允许应用程序建立在它的基础上。支付渠道(例如闪电网络)是最受欢迎的渠道之一。允许支付渠道(和其他区块链应用)的比特币网络的一些保证是:</p><ul class=""><li id="2a46" class="jo jp ht is b it iu ix iy jb jq jf jr jj js jn jt ju jv jw dt translated"><strong class="is hu">控制法定人数</strong>:通过脚本中的多重签名约束，比特币网络确保有法定人数来管理多个用户控制的资金。</li><li id="9c4e" class="jo jp ht is b it jx ix jy jb jz jf ka jj kb jn jt ju jv jw dt translated"><strong class="is hu">时间锁:</strong>这确保了脚本只能在指定的时间锁之前或之后执行。</li><li id="08d2" class="jo jp ht is b it jx ix jy jb jz jf ka jj kb jn jt ju jv jw dt translated"><strong class="is hu">没有双重花费</strong>:这是这种分散共识算法的最重要的基础之一，任何UTXO都不能花费两次</li><li id="3ed4" class="jo jp ht is b it jx ix jy jb jz jf ka jj kb jn jt ju jv jw dt translated"><strong class="is hu">未过期</strong>:一个有效的事务不会过期，所以它可以永远等待，直到被选中添加到区块链。</li><li id="375f" class="jo jp ht is b it jx ix jy jb jz jf ka jj kb jn jt ju jv jw dt translated">审查阻力<strong class="is hu">:任何拥有私钥的人都可以在没有任何审查的情况下使用UTXO。</strong></li><li id="c1ab" class="jo jp ht is b it jx ix jy jb jz jf ka jj kb jn jt ju jv jw dt translated"><strong class="is hu">授权</strong>:通过提供数字签名，网络只允许授权地址管理资金。</li></ul><h1 id="8e25" class="kc kd ht bd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz dt translated"><strong class="ak">什么是支付渠道？</strong></h1><blockquote class="la"><p id="cae6" class="lb lc ht bd ld le lf lg lh li lj jn ek translated">支付通道是一种不可信的机制，用于在比特币区块链之外的双方之间交换比特币交易。</p></blockquote><p id="2743" class="pw-post-body-paragraph iq ir ht is b it lk iv iw ix ll iz ja jb lm jd je jf ln jh ji jj lo jl jm jn hm dt translated">简而言之，它们是减轻区块链负担的机制，通过将大量交易移出区块链，转移到用户之间的私人路由通道，但仍依赖区块链的安全性。</p><h2 id="5039" class="lp kd ht bd ke lq lr ls ki lt lu lv km jb lw lx kq jf ly lz ku jj ma mb ky mc dt translated">现在让我们看看<strong class="ak"> <em class="md">状态通道</em> </strong>如何工作来说明基本概念:</h2><ol class=""><li id="77cf" class="jo jp ht is b it me ix mf jb mg jf mh jj mi jn mj ju jv jw dt translated">状态通道由双方通过锁定区块链上共享状态的事务建立。该交易被称为<strong class="is hu"> <em class="mk">【资金交易】</em> </strong>或<strong class="is hu"> <em class="mk">【锚定交易】。</em> </strong>这笔交易必须在区块链(mined)结算才能建立渠道。</li><li id="a10e" class="jo jp ht is b it jx ix jy jb jz jf ka jj kb jn mj ju jv jw dt translated">一旦资金交易已经结算，双方可以开始交换交易，称为<strong class="is hu"> <em class="mk">【承诺交易】</em> </strong>。这些交易在渠道关闭前保持‘离线’。当交换承诺交易时，双方使先前的状态无效，因此最后的状态或最新的交易状态是可以在区块链上兑现的状态。</li><li id="1ad3" class="jo jp ht is b it jx ix jy jb jz jf ka jj kb jn mj ju jv jw dt translated">最后，可以通过向区块链提交最终的<strong class="is hu"> <em class="mk">【结算交易】</em> </strong>或者通过任一方向区块链提交最后的承诺交易来合作关闭通道。</li></ol><p id="12bf" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">只有两笔交易在区块链上结算，即<strong class="is hu"><em class="mk">‘资金交易</em></strong>’和<strong class="is hu"><em class="mk">‘结算交易’</em></strong>。在这两者之间，可以有尽可能多的<strong class="is hu"><em class="mk"/></strong>【承诺事务】，它们将改变共享状态，总是保持最后一个状态，以便在需要时随时准备好在区块链上结算。</p><h2 id="d3d2" class="lp kd ht bd ke lq lr ls ki lt lu lv km jb lw lx kq jf ly lz ku jj ma mb ky mc dt translated"><strong class="ak">支付渠道实例</strong></h2><p id="e8df" class="pw-post-body-paragraph iq ir ht is b it me iv iw ix mf iz ja jb ml jd je jf mm jh ji jj mn jl jm jn hm dt translated">让我们假设胡安和莎拉建立了一个支付渠道。莎拉想学习编码，胡安使用一种自动使用支付通道的流媒体软件，以每小时0.25比特币的价格教她。莎拉用1个比特币(<strong class="is hu"> <em class="mk">【资助交易】)</em> </strong>资助通道。Sarah使用她的UTXO，并用Juan的地址生成一个多重签名输出。一旦交易被发送到区块链并被开采，通道就“有效”,然后教学会话开始。一个小时后，软件自动生成一个<strong class="is hu"> <em class="mk">承诺交易</em> </strong>，该交易改变渠道余额，将0.25比特币存入胡安的地址，并将0.75比特币退还给莎拉。当两个小时过去后，另一个<strong class="is hu"> <em class="mk">承诺事务</em> </strong>改变共享状态，导致0.5 btc总计到Juan的地址，0.5 BTC到Sarah的地址。之后，Sarah厌倦了所有的编码，并决定停止会话，Juan或Sarah可以在区块链上传输最终的结算状态事务。这最后一笔交易(<strong class="is hu"> <em class="mk">结算交易</em> </strong>)向Juan支付了两个小时的编码会话，并向Sarah退还了资金交易的剩余比特币。这笔交易在区块链结算。请注意，资金交易只有一个比特币，因此在这种情况下，这是<strong class="is hu"> <em class="mk">【通道容量】</em> </strong>意味着该通道只允许Juan最多教授4个小时。</p><figure class="mp mq mr ms fq mt fe ff paragraph-image"><div role="button" tabindex="0" class="mu mv di mw bf mx"><div class="fe ff mo"><img src="../Images/358559e1ac66189c9f79f2ff028dcf62.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DIxaWwZiem5ju6U07HVScA.jpeg"/></div></div><figcaption class="na nb fg fe ff nc nd bd b be z ek">Funding transaction of a state channel</figcaption></figure><figure class="mp mq mr ms fq mt fe ff paragraph-image"><div class="fe ff ne"><img src="../Images/550474347d6a2482dbf12e1c7eeb39a3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1118/format:webp/1*_7es1O8lcbedwqGSON47rg.jpeg"/></div><figcaption class="na nb fg fe ff nc nd bd b be z ek">Series of transactions on a state channel</figcaption></figure><blockquote class="nf ng nh"><p id="cfcc" class="iq ir mk is b it iu iv iw ix iy iz ja ni jc jd je nj jg jh ji nk jk jl jm jn hm dt translated"><strong class="is hu">旁注:</strong>这个例子有个问题。因为这些渠道需要一方提供资金交易，这可能导致不信任问题。假设莎拉上了3个小时的课，那么余额将是0.75比特币给胡安，0.25比特币给莎拉，但是她为什么要将最后的余额作为结算交易传送给区块链呢？她可以发送第一笔交易(0.25给胡安，0.75给她)，并且当她有3节课时只支付一个小时的课时。这类问题可以用<strong class="is hu">【时间锁】</strong><strong class="is hu">【非对称可撤销承诺】来解决。</strong>我们不会在这篇博客文章中看到细节，但它基本上意味着该渠道上的每笔交易都有一个锁定的时间，如果时间锁过期，交易可以退款，交易还包括一个密钥，如果一方作弊，另一方可以惩罚。</p></blockquote><h1 id="23aa" class="kc kd ht bd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz dt translated"><strong class="ak">哈希时间锁合约(HTLC) </strong></h1><p id="48e8" class="pw-post-body-paragraph iq ir ht is b it me iv iw ix mf iz ja jb ml jd je jf mm jh ji jj mn jl jm jn hm dt translated">如果我们想深入了解支付渠道的机制，我们必须了解什么是<strong class="is hu"> HTLC </strong>。<strong class="is hu"> HTLC </strong>是一种特殊的智能合约，用于支付渠道，允许参与者将资金投入到一个具有到期时间的可赎回秘密中。假设莎拉想要通过一个已经开放的支付渠道支付给胡安一个比特币。首先，Juan必须生成一个只有Juan知道的秘密。其次，他将使用哈希函数对“<strong class="is hu"> R </strong>”秘密进行哈希运算，得到一个“<strong class="is hu"> H </strong>”哈希。</p><blockquote class="la"><p id="d5fc" class="lb lc ht bd ld le lf lg lh li lj jn ek translated"><strong class="ak">哈希(" R") = "H" </strong></p></blockquote><p id="5c85" class="pw-post-body-paragraph iq ir ht is b it lk iv iw ix ll iz ja jb lm jd je jf ln jh ji jj lo jl jm jn hm dt translated">第三，他可以将散列“<strong class="is hu"> H </strong>”发送给莎拉，她可以进行交易，并将<strong class="is hu">“H”</strong>散列放入锁脚本中，并带有指示赎回资金的时限的标志。现在，只有知道满足哈希条件的秘密<strong class="is hu">“R”</strong>的人才能兑换比特币。时间限制是因为如果秘密<strong class="is hu">【R】</strong>不被泄露，<strong class="is hu"> HTLC </strong>的付款人可以在有限的时间过去后，或者更准确地说，在一定数量的区块后获得退款。</p><h1 id="fe66" class="kc kd ht bd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz dt translated"><strong class="ak">闪电网络(LN) </strong></h1><p id="a1ae" class="pw-post-body-paragraph iq ir ht is b it me iv iw ix mf iz ja jb ml jd je jf mm jh ji jj mn jl jm jn hm dt translated">LN是比特币区块链的扩展方法之一。这是一个端到端连接的双向支付渠道的路由网络，这意味着任何参与者都可以在渠道之间路由支付，而无需使用任何中介。</p><p id="5e1f" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">让我们看一个有五个参与者的例子；我们有不同的渠道连接胡安和莎拉，莎拉和金，金和瑞安，瑞安和佛罗伦萨。</p><p id="bce8" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">因此，<strong class="is hu"> Juan想要支付Florence一个比特币</strong>，但是他并没有直接连接到Florence，并且他不想打开一个新的到Florence的直接通道，因为他必须投入更多的钱来打开LN通道。Juan的Lightning Node有能力连接到Sarah的并发现支付通道之间的新路由，它也有能力通过互联网连接到Florence的Node。正如我们之前看到的，<strong class="is hu">佛罗伦萨产生了一个只有她知道的秘密“R”</strong>。她对其进行哈希处理，并将<strong class="is hu">哈希“H”</strong>发送到胡安的节点。</p><figure class="mp mq mr ms fq mt fe ff paragraph-image"><div role="button" tabindex="0" class="mu mv di mw bf mx"><div class="fe ff nl"><img src="../Images/7466d43c4ac04576f7549ca8b0304896.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*x9sknqLJOkGNNU5SHUjRFw.jpeg"/></div></div><figcaption class="na nb fg fe ff nc nd bd b be z ek">The LN channels connection example</figcaption></figure><p id="b33e" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">现在，胡安的节点创建了一个<strong class="is hu"> HTLC </strong>，支付给知道可以解决哈希<strong class="is hu">“H”</strong>的秘密的人，带有<strong class="is hu"> 10块退款超时，</strong>的金额为<strong class="is hu"> 1.003 </strong>比特币。你可能会问，我们为什么需要额外的003比特币？这笔额外的钱将用于补偿中间节点参与支付的路由。</p><p id="a36c" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">胡安将<strong class="is hu"> HTLC </strong>发给莎拉；发送给莎拉的<strong class="is hu"> HTLC </strong>意味着，如果莎拉知道秘密，胡安将把他的频道余额的1.003支付给莎拉，或者如果10个街区过去，将退还给莎拉。莎拉并不知道索要被胡安锁定的1.003英镑的秘密，相反，她在给金姆的支付通道上创建了另一个<strong class="is hu"> HTLC </strong>。在这个HTLC <strong class="is hu">上，莎拉将1.002比特币</strong>交给一个知道秘密的人，以解决<strong class="is hu"> 9个区块</strong>的哈希<strong class="is hu"> H </strong>。以同样的方式，Kim将1.001的HTLC提交给她与Ryan的频道的8个块的散列“<strong class="is hu"> H </strong>”。从Sarah和Kim的角度来看，如果秘密<strong class="is hu">“R”</strong>被知道，他们将各获得0.001，如果不被知道，他们什么也不会失去。最后，Ryan向Florence提供了一个HTLC，用1个比特币兑换7个区块来散列“<strong class="is hu"> H </strong>”。<strong class="is hu">至此，佛罗伦萨知道了解决哈希“H”的秘密“R”！因此，她可以从瑞恩那里得到HTLC。<strong class="is hu">她将“R”秘密发送给Ryan </strong>并获得1个比特币。现在Ryan有了秘密<strong class="is hu">【R】</strong>，所以他可以在他们的通道上要求Kim提交的HTLC，并在他们的通道余额上获得0.001比特币。通过路线流回的秘密<strong class="is hu">“R”</strong>允许每个参与者要求他们的通道余额的差异。这是参与者路由支付的激励，他们将“赌注”放在他们的个人渠道余额上(加上费用)，如果秘密被知道，他们可以索回他们的“赌注”并赚取费用。</strong></p><blockquote class="nf ng nh"><p id="1c6a" class="iq ir mk is b it iu iv iw ix iy iz ja ni jc jd je nj jg jh ji nk jk jl jm jn hm dt translated">胡安已经付给弗洛伦斯1个比特币，却没有给她开通直接通道。支付路径中的中间方没有一方相互信任，他们会因帮助支付路径而赚取少量费用。很漂亮不是吗？无红利(ex-dividend)</p></blockquote><p id="7c6c" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">这篇文章试图向你介绍支付渠道和闪电网络。我相信，在深入了解LN之前，对支付渠道有一个基本的了解是有好处的。网上有很多专门关于闪电网的信息，所以我就在这里完成这篇帖子。我希望你学到了一些新东西，你可以在twitter上关注我，了解区块链相关的新闻、话题和见解。</p><h1 id="4b26" class="kc kd ht bd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz dt translated"><strong class="ak">行动号召</strong></h1><p id="f45f" class="pw-post-body-paragraph iq ir ht is b it me iv iw ix mf iz ja jb ml jd je jf mm jh ji jj mn jl jm jn hm dt translated">如果你想深入了解，这里有更多关于LN的链接:</p><ul class=""><li id="305a" class="jo jp ht is b it iu ix iy jb jq jf jr jj js jn jt ju jv jw dt translated">闪电网统计:<a class="ae nm" href="https://shabang.io" rel="noopener ugc nofollow" target="_blank"> https://shabang.io </a></li><li id="f4bd" class="jo jp ht is b it jx ix jy jb jz jf ka jj kb jn jt ju jv jw dt translated">LN测试网explorer &amp; stats:【https://explorer.acinq.co T4】</li><li id="e941" class="jo jp ht is b it jx ix jy jb jz jf ka jj kb jn jt ju jv jw dt translated">starblocks——在LN上用比特币买一杯咖啡！！(测试网):<a class="ae nm" href="https://starblocks.acinq.co/#/" rel="noopener ugc nofollow" target="_blank">https://starblocks.acinq.co/#/</a></li><li id="beb0" class="jo jp ht is b it jx ix jy jb jz jf ka jj kb jn jt ju jv jw dt translated">闪电网络拓扑视图:<a class="ae nm" href="https://lnmainnet.gaben.win" rel="noopener ugc nofollow" target="_blank">https://lnmainnet . gaben . win</a></li></ul><blockquote class="nf ng nh"><p id="751a" class="iq ir mk is b it iu iv iw ix iy iz ja ni jc jd je nj jg jh ji nk jk jl jm jn hm dt translated">如果您想了解更多关于区块链的信息，请加入我们的每周简讯，了解加密领域的所有新闻。T13】</p></blockquote><blockquote class="la"><p id="cf5d" class="lb lc ht bd ld le nn no np nq nr jn ek translated"><a class="ae nm" href="https://coincodecap.com/?utm_source=coinmonks" rel="noopener ugc nofollow" target="_blank">直接在您的收件箱中获得最佳软件交易</a></p></blockquote><figure class="nt nu nv nw nx mt fe ff paragraph-image"><a href="https://coincodecap.com/?utm_source=coinmonks"><div class="fe ff ns"><img src="../Images/7c0b3dfdcbfea594cc0ae7d4f9bf6fcb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1168/format:webp/0*OJ-qb5G6i863msBB.png"/></div></a></figure></div></div>    
</body>
</html>