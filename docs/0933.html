<html>
<head>
<title>How to Import Solidity Files in VS Code with IDE Support</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在支持IDE的VS代码中导入Solidity文件</h1>
<blockquote>原文：<a href="https://medium.com/coinmonks/solidity-import-in-vs-code-the-right-way-82baa1cc5a71?source=collection_archive---------2-----------------------#2018-07-03">https://medium.com/coinmonks/solidity-import-in-vs-code-the-right-way-82baa1cc5a71?source=collection_archive---------2-----------------------#2018-07-03</a></blockquote><div><div class="ef hh hi hj hk hl"/><div class="hm hn ho hp hq"><div class=""/><figure class="fi fk ir is it iu fe ff paragraph-image"><div role="button" tabindex="0" class="iv iw di ix bf iy"><div class="fe ff iq"><img src="../Images/bf89a824a591c2f0d1135834193a4c4e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bXcolG63_Wpwl5VOYt2xuQ.png"/></div></div><figcaption class="jb jc fg fe ff jd je bd b be z ek">Let IDE work for you.</figcaption></figure><p id="56bb" class="pw-post-body-paragraph jf jg ht jh b ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc hm dt translated">在很长一段时间里，我认为让我的VS代码满意外部Solidity文件导入(以 Truffle希望我的方式<a class="ae kd" href="https://truffleframework.com/docs/getting_started/packages-npm#within-your-contracts" rel="noopener ugc nofollow" target="_blank">)是一个失败的原因。我应付红色的尖叫曲线。我学会了忽略和😒。</a></p><figure class="kf kg kh ki fq iu fe ff paragraph-image"><div role="button" tabindex="0" class="iv iw di ix bf iy"><div class="fe ff ke"><img src="../Images/30ead6eb0717ea588f62b73825fa0d25.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MWwJYjwyKTuusJvf08loiQ.png"/></div></div><figcaption class="jb jc fg fe ff jd je bd b be z ek">Enough is enough.</figcaption></figure><h1 id="b87e" class="kj kk ht bd kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg dt translated">TLDR</h1><p id="f5db" class="pw-post-body-paragraph jf jg ht jh b ji lh jk jl jm li jo jp jq lj js jt ju lk jw jx jy ll ka kb kc hm dt translated">如果您正在通过“truffle init”或“truffle unbox”设置一个标准的truffle项目，您可以在VS代码中使用以下<a class="ae kd" href="https://code.visualstudio.com/docs/getstarted/settings" rel="noopener ugc nofollow" target="_blank">设置</a>:</p><pre class="kf kg kh ki fq lm ln lo lp aw lq dt"><span id="3426" class="lr kk ht ln b fv ls lt l lu lv">"solidity.packageDefaultDependenciesContractsDirectory": "",<br/>"solidity.packageDefaultDependenciesDirectory": "node_modules"</span></pre><p id="82bc" class="pw-post-body-paragraph jf jg ht jh b ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc hm dt translated">照常从<a class="ae kd" href="https://truffleframework.com/docs/getting_started/compile#importing-contracts-from-an-external-package" rel="noopener ugc nofollow" target="_blank">外部包</a>导入(使用npm安装后),如下所示:</p><pre class="kf kg kh ki fq lm ln lo lp aw lq dt"><span id="172f" class="lr kk ht ln b fv ls lt l lu lv">import "openzeppelin-solidity/contracts/math/SafeMath.sol";</span></pre><p id="e2bc" class="pw-post-body-paragraph jf jg ht jh b ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc hm dt translated">快乐的可靠性黑客与无错误的IDE，自动完成，定义查找。</p><h1 id="a967" class="kj kk ht bd kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg dt translated">为什么(适当的)进口是有用的</h1><p id="76d0" class="pw-post-body-paragraph jf jg ht jh b ji lh jk jl jm li jo jp jq lj js jt ju lk jw jx jy ll ka kb kc hm dt translated">通过正确的设置，Solidity插件可以从所有导入的文件(以及它们的子文件导入)中自动完成。)自动完成是<a class="ae kd" href="https://github.com/juanfranblanco/vscode-solidity/issues/58" rel="noopener ugc nofollow" target="_blank">还不是上下文相关的</a>，但是给出了一些关于在哪里定义完成元素的信息。</p><figure class="kf kg kh ki fq iu fe ff paragraph-image"><div role="button" tabindex="0" class="iv iw di ix bf iy"><div class="fe ff lw"><img src="../Images/4a6d83f36be32445227979f88eadf250.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*b3ZF74oFmfzru-ZH.png"/></div></div><figcaption class="jb jc fg fe ff jd je bd b be z ek">Two <strong class="bd lx">totalSupply()</strong> functions: one from BasicToken.sol and the other from ERC20.sol which BasicToken inherits</figcaption></figure><p id="d1b7" class="pw-post-body-paragraph jf jg ht jh b ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc hm dt translated">使用<a class="ae kd" href="https://github.com/juanfranblanco/vscode-solidity/pull/80#event-1711277730" rel="noopener ugc nofollow" target="_blank">最新版本</a>，您可以跳转到外部导入的定义以及外部包中定义的变量和函数🎉。</p><figure class="kf kg kh ki fq iu fe ff paragraph-image"><div role="button" tabindex="0" class="iv iw di ix bf iy"><div class="fe ff ly"><img src="../Images/7f6f2a3a9a644e7307b923213f15ad55.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*CzFxt4leGLews1haRVtkbA.gif"/></div></div></figure><p id="9011" class="pw-post-body-paragraph jf jg ht jh b ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc hm dt translated">我通过在LSP ( <a class="ae kd" href="https://code.visualstudio.com/docs/extensionAPI/language-support#_show-definitions-of-a-symbol" rel="noopener ugc nofollow" target="_blank">语言服务器协议</a>)中实现相应的事件来贡献这个功能，因此它也可以在其他ide(Atom、Sublime、Remix)中使用。<strong class="jh hu">在VSCode Solidity中，我们仍然可以为Go to Definition和LSP实现许多功能。前往</strong><a class="ae kd" href="https://github.com/juanfranblanco/vscode-solidity/" rel="noopener ugc nofollow" target="_blank"><strong class="jh hu">Github</strong></a><strong class="jh hu">参加#BUIDL train，如果你有你的愿望清单上的东西。</strong></p><h1 id="e327" class="kj kk ht bd kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg dt translated">导入在Solidity中是如何工作的</h1><figure class="kf kg kh ki fq iu fe ff paragraph-image"><div class="fe ff lz"><img src="../Images/79bdfa0f46b77c0327dcf4ade232b5b1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/1*WJU4vJLUYkvWRRl4PoqVVg.gif"/></div></figure><p id="3191" class="pw-post-body-paragraph jf jg ht jh b ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc hm dt translated">请继续阅读我在Solidity、Truffle和VSCode Solidity插件下解决的挫折和令人讨厌的事情的背景故事。</p><p id="3b58" class="pw-post-body-paragraph jf jg ht jh b ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc hm dt translated">那是一个普通的夜晚，我变得越来越烦躁🤬(又来了！)作者:</p><ul class=""><li id="c12a" class="ma mb ht jh b ji jj jm jn jq mc ju md jy me kc mf mg mh mi dt translated">我不记得我继承的契约构造函数签名</li><li id="209a" class="ma mb ht jh b ji mj jm mk jq ml ju mm jy mn kc mf mg mh mi dt translated">OpenZeppelin不断改变契约实现和接口(理由很充分)</li><li id="6ea6" class="ma mb ht jh b ji mj jm mk jq ml ju mm jy mn kc mf mg mh mi dt translated">VS代码稳定性插件不允许我跳转到我导入的文件</li><li id="5b87" class="ma mb ht jh b ji mj jm mk jq ml ju mm jy mn kc mf mg mh mi dt translated">OpenZeppelin合同被c̶o̶n̶v̶o̶l̶u̶t̶e̶d̶l̶y̶̶n̶e̶s̶t̶e̶d̶分类到嵌套文件夹中</li><li id="522f" class="ma mb ht jh b ji mj jm mk jq ml ju mm jy mn kc mf mg mh mi dt translated">默认情况下，VS代码不允许在node_modules中搜索。</li></ul><p id="a440" class="pw-post-body-paragraph jf jg ht jh b ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc hm dt translated">我决定把我没完没了的鼠标点击和滚动变成更有效率的侦探乐趣(插入分心的程序员笑话。)显然，这是<a class="ae kd" href="https://github.com/juanfranblanco/vscode-solidity/issues/70" rel="noopener ugc nofollow" target="_blank">而不是</a> <a class="ae kd" href="https://github.com/juanfranblanco/vscode-solidity/issues/31" rel="noopener ugc nofollow" target="_blank">一个</a> <a class="ae kd" href="https://github.com/juanfranblanco/vscode-solidity/issues/54" rel="noopener ugc nofollow" target="_blank">不常见的</a> <a class="ae kd" href="https://github.com/juanfranblanco/vscode-solidity/issues/78" rel="noopener ugc nofollow" target="_blank">问题</a>并且(令人震惊的是)Solidity插件被设计为<a class="ae kd" href="https://github.com/juanfranblanco/vscode-solidity#solidity-support-for-visual-studio-code" rel="noopener ugc nofollow" target="_blank">与导入</a>一起工作🤔。</p><p id="5042" class="pw-post-body-paragraph jf jg ht jh b ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc hm dt translated">答案在于前面提到的两个设置，<strong class="jh hu">packagedefaultdependenciescutractsdirectory</strong>和<strong class="jh hu">packagedefaultdependenciesdirect</strong>，以及Solidity对于如何引用<a class="ae kd" href="http://solidity.readthedocs.io/en/develop/layout-of-source-files.html?#importing-other-source-files" rel="noopener ugc nofollow" target="_blank">外部包导入</a>没有标准。</p><p id="95ac" class="pw-post-body-paragraph jf jg ht jh b ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc hm dt translated">对于非本地进口(不是以“.”开头的)并且不是绝对路径)，编译器自行决定如何应用<a class="ae kd" href="http://solidity.readthedocs.io/en/develop/layout-of-source-files.html?#use-in-actual-compilers" rel="noopener ugc nofollow" target="_blank">重映射来解析导入</a>:</p><blockquote class="mo mp mq"><p id="c597" class="jf jg mr jh b ji jj jk jl jm jn jo jp ms jr js jt mt jv jw jx mu jz ka kb kc hm dt translated">当编译器被调用时，不仅可以指定如何发现路径的第一个元素，还可以指定路径前缀重新映射，例如将<code class="eh mv mw mx ln b">github.com/ethereum/dapp-bin/library</code>重新映射到<code class="eh mv mw mx ln b">/usr/local/dapp-bin/library</code>，编译器将从那里读取文件。</p></blockquote><p id="1f58" class="pw-post-body-paragraph jf jg ht jh b ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc hm dt translated"><strong class="jh hu">松露</strong></p><p id="aba5" class="pw-post-body-paragraph jf jg ht jh b ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc hm dt translated">松露使用<a class="ae kd" href="https://github.com/trufflesuite/truffle/tree/7205c9e91c8c3de4996cf9eb679446d5c0b2810e/packages/truffle-resolver" rel="noopener ugc nofollow" target="_blank">松露解析器</a>来解析来自<a class="ae kd" href="https://truffleframework.com/docs/getting_started/packages-ethpm" rel="noopener ugc nofollow" target="_blank"> EthPM </a>和<a class="ae kd" href="https://truffleframework.com/docs/getting_started/packages-npm" rel="noopener ugc nofollow" target="_blank"> NPM </a>的依赖关系。特别是对于NPM，它<a class="ae kd" href="https://github.com/trufflesuite/truffle/blob/c603524f3036f8d3d19641ca774b1133a5142a6e/packages/truffle-resolver/npm.js#L34" rel="noopener ugc nofollow" target="_blank">在<strong class="jh hu"> node_modules </strong>下寻找包</a>，并且只使用文件系统路径替换前缀。</p><p id="e629" class="pw-post-body-paragraph jf jg ht jh b ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc hm dt translated">此外，Truffle声明一个Truffle项目应该使用<strong class="jh hu"> /contracts </strong>来存储<strong class="jh hu"> *。sol </strong>文件和<strong class="jh hu"> /build(/contracts) </strong>用于构建输出。但是，解析器并不强制使用这种项目结构，因为并非所有的npm Solidity包都遵循这种布局。</p><p id="3159" class="pw-post-body-paragraph jf jg ht jh b ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc hm dt translated">因此，我们按包名导入，后跟npm包根目录的相对路径。对于<a class="ae kd" href="https://github.com/OpenZeppelin/openzeppelin-solidity/tree/master/contracts" rel="noopener ugc nofollow" target="_blank"> openzeppelin-solidity </a>，我们使用</p><pre class="kf kg kh ki fq lm ln lo lp aw lq dt"><span id="8edf" class="lr kk ht ln b fv ls lt l lu lv">import "<strong class="ln hu">openzeppelin-solidity</strong>/contracts/math/SafeMath.sol";</span></pre><p id="dad9" class="pw-post-body-paragraph jf jg ht jh b ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc hm dt translated"><strong class="jh hu"> VSCode可靠性</strong></p><p id="5634" class="pw-post-body-paragraph jf jg ht jh b ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc hm dt translated">VSCode Solidity extension提供了两个带有<a class="ae kd" href="https://github.com/juanfranblanco/vscode-solidity/blob/9fc69464314b3f07c02aee3473464608ebba3848/package.json#L143" rel="noopener ugc nofollow" target="_blank">默认值</a>的设置来控制如何解析外部依赖关系:</p><ul class=""><li id="3ed0" class="ma mb ht jh b ji jj jm jn jq mc ju md jy me kc mf mg mh mi dt translated"><strong class="jh hu">solidity . package defaultdependencies directory:</strong>node _ modules</li><li id="64bc" class="ma mb ht jh b ji mj jm mk jq ml ju mm jy mn kc mf mg mh mi dt translated"><strong class="jh hu">solidity . package defaultdependencies contracts目录:</strong>合同</li></ul><p id="1c92" class="pw-post-body-paragraph jf jg ht jh b ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc hm dt translated"><strong class="jh hu">packagedefaultdependenciesdirect</strong>给包添加前缀，并从项目根解析。<strong class="jh hu">packagedefaultdependenciescutractsdirectory</strong>指定在哪里查找*。外部包中的sol文件。</p><pre class="kf kg kh ki fq lm ln lo lp aw lq dt"><span id="6a27" class="lr kk ht ln b fv ls lt l lu lv">import "package/folder1/contract.sol";</span></pre><p id="12cc" class="pw-post-body-paragraph jf jg ht jh b ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc hm dt translated">扩展到</p><pre class="kf kg kh ki fq lm ln lo lp aw lq dt"><span id="2dc3" class="lr kk ht ln b fv ls lt l lu lv">import "{<strong class="ln hu">projectRoot</strong>}/{<strong class="ln hu">packageDefaultDependenciesDirectory</strong>}/package/{<strong class="ln hu">packageDefaultDependenciesContractsDirectory</strong>}/folder1/contract.sol";</span></pre><p id="7d2e" class="pw-post-body-paragraph jf jg ht jh b ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc hm dt translated">虽然默认值<strong class="jh hu">契约</strong>看起来可能是无辜的，但它实际上在Truffle项目中创建了一个副本。先前的导入将扩展到</p><pre class="kf kg kh ki fq lm ln lo lp aw lq dt"><span id="a08e" class="lr kk ht ln b fv ls lt l lu lv">import "{<strong class="ln hu">projectRoot</strong>}/<strong class="ln hu">node_modules</strong>/openzeppelin-solidity/<strong class="ln hu">contracts</strong>/contracts/math/SafeMath.sol";</span></pre><p id="9f7c" class="pw-post-body-paragraph jf jg ht jh b ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc hm dt translated">哎呀。将<strong class="jh hu">packagedefaultdependenciesscontractsdirectory</strong>设置为空将符合Truffle标准🧐.</p><h1 id="7717" class="kj kk ht bd kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg dt translated">额外小费🤫</h1><p id="569d" class="pw-post-body-paragraph jf jg ht jh b ji lh jk jl jm li jo jp jq lj js jt ju lk jw jx jy ll ka kb kc hm dt translated">当VSCode关闭每一个你为了参考而打开但没有编辑的文件时，你是否感到沮丧？这原来是一个<a class="ae kd" href="https://code.visualstudio.com/docs/getstarted/userinterface#_preview-mode" rel="noopener ugc nofollow" target="_blank">特征</a>(？！)不是bug。<strong class="jh hu">双击文件或标签头，可以锁定文件退出预览模式。</strong>您也可以在设置中在特定条件下或完全禁用预览模式。</p><p id="fddc" class="pw-post-body-paragraph jf jg ht jh b ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc hm dt translated">我能理解这对于保持我的工作空间整洁是多么的有用，但是我发现这个功能经常会适得其反。如果文件在一段时间不活动后自动关闭或者隐藏在标签列表中会更好吗？</p><h1 id="8d6f" class="kj kk ht bd kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg dt translated">承认</h1><p id="397f" class="pw-post-body-paragraph jf jg ht jh b ji lh jk jl jm li jo jp jq lj js jt ju lk jw jx jy ll ka kb kc hm dt translated">最后但同样重要的是，我要感谢<a class="my mz gr" href="https://medium.com/u/f35d0f682616?source=post_page-----82baa1cc5a71--------------------------------" rel="noopener" target="_blank"> Juan Blanco </a>的创作和<a class="ae kd" href="https://github.com/juanfranblanco/vscode-solidity#credits" rel="noopener ugc nofollow" target="_blank">在我之前的所有其他贡献者</a>对这个令人惊叹的VSCode Solidity插件的贡献。Go star <a class="ae kd" href="https://github.com/juanfranblanco/vscode-solidity" rel="noopener ugc nofollow" target="_blank"> the repo </a>今天就来表达你的爱吧！</p><figure class="kf kg kh ki fq iu fe ff paragraph-image"><a href="https://cryptofi.co"><div class="fe ff na"><img src="../Images/e7b1dbc6a532a697c6844fdf0f0bbd30.png" data-original-src="https://miro.medium.com/v2/resize:fit:814/format:webp/1*HrFLDXz92JavTZXjhmvU7g.png"/></div></a></figure></div></div>    
</body>
</html>