<html>
<head>
<title>Design of Smart contracts using BDD and Cucumber</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用BDD和Cucumber设计智能合约</h1>
<blockquote>原文：<a href="https://medium.com/coinmonks/design-of-smart-contracts-using-bdd-and-cucumber-4533162fc235?source=collection_archive---------0-----------------------#2019-09-04">https://medium.com/coinmonks/design-of-smart-contracts-using-bdd-and-cucumber-4533162fc235?source=collection_archive---------0-----------------------#2019-09-04</a></blockquote><div><div class="ef hh hi hj hk hl"/><div class="hm hn ho hp hq"><div class=""/><p id="fa95" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">这篇文章展示了如何应用<a class="ae jo" href="https://en.wikipedia.org/wiki/Behavior-driven_development" rel="noopener ugc nofollow" target="_blank"> BDD </a>和<a class="ae jo" href="https://cucumber.io/" rel="noopener ugc nofollow" target="_blank">cumber</a>来设计智能合同。</p><figure class="jq jr js jt fq ju fe ff paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="fe ff jp"><img src="../Images/ebdc148af92d770e992fda5791b44eb8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2-WbaKKZ4lbnzrY_mH8Z_Q.png"/></div></div></figure><h1 id="ddd7" class="kb kc ht bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky dt translated">什么是BDD？</h1><p id="9718" class="pw-post-body-paragraph iq ir ht is b it kz iv iw ix la iz ja jb lb jd je jf lc jh ji jj ld jl jm jn hm dt translated">BDD代表<em class="le">行为驱动开发</em>，它是一种开发方法，基于:</p><ul class=""><li id="29ee" class="lf lg ht is b it iu ix iy jb lh jf li jj lj jn lk ll lm ln dt translated">基于<em class="le">故事</em>、<em class="le">规则</em>和<em class="le">示例</em>的系统行为定义。</li><li id="da5f" class="lf lg ht is b it lo ix lp jb lq jf lr jj ls jn lk ll lm ln dt translated">使用<strong class="is hu"> TDD </strong>(测试驱动开发)将行为定义中确定的场景作为输入。</li></ul><h1 id="b23d" class="kb kc ht bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky dt translated">黄瓜是什么？</h1><p id="1834" class="pw-post-body-paragraph iq ir ht is b it kz iv iw ix la iz ja jb lb jd je jf lc jh ji jj ld jl jm jn hm dt translated">Cucumber是一套应用BDD的工具和机制。它为java和许多其他语言提供了应用BDD的库。</p><h1 id="b9aa" class="kb kc ht bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky dt translated">BBD为什么要设计智能合约？</h1><ul class=""><li id="0dea" class="lf lg ht is b it kz ix la jb lt jf lu jj lv jn lk ll lm ln dt translated">智能合约的主要目标是定义行为——围绕协议的规则和惩罚——</li><li id="7332" class="lf lg ht is b it lo ix lp jb lq jf lr jj ls jn lk ll lm ln dt translated">需求和智能契约设计之间的界限非常模糊。</li><li id="0e26" class="lf lg ht is b it lo ix lp jb lq jf lr jj ls jn lk ll lm ln dt translated">利益相关者、域名所有者等。律师、公证人等。—需要理解智能合同的内容，并且<em class="le"> BDD Cucumber </em>提供了一种高级语言— <a class="ae jo" href="https://cucumber.io/docs/gherkin/reference/" rel="noopener ugc nofollow" target="_blank"> Gherkin </a> —允许利益相关者在没有编程语言知识的情况下理解智能合同。</li><li id="010b" class="lf lg ht is b it lo ix lp jb lq jf lr jj ls jn lk ll lm ln dt translated">BDD Cucumber提出的文档作为智能合约行为的文档是完美的，它不需要额外的文档。</li><li id="9952" class="lf lg ht is b it lo ix lp jb lq jf lr jj ls jn lk ll lm ln dt translated">智能合约中的错误可能是灾难性的，因为它们指定了一项协议，而该协议一旦签署就可以更改。</li></ul><h1 id="576a" class="kb kc ht bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky dt translated">示例:拍卖智能合同</h1><p id="9ab9" class="pw-post-body-paragraph iq ir ht is b it kz iv iw ix la iz ja jb lb jd je jf lc jh ji jj ld jl jm jn hm dt translated">在这个例子中，我们将为<strong class="is hu">拍卖</strong>设计一个<em class="le">智能合同</em>，使用<em class="le"> BDD </em>作为方法论，使用<a class="ae jo" href="https://github.com/cucumber/cucumber-js" rel="noopener ugc nofollow" target="_blank">cumber JS</a>包为nodejs/javascript指定特性。</p><figure class="jq jr js jt fq ju fe ff paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="fe ff lw"><img src="../Images/892450da104390c4ee35e1e0f2975b69.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LOOYk7pooWvumR14lHqW0A.jpeg"/></div></div></figure><h1 id="bfa5" class="kb kc ht bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky dt translated">示例映射:特征、规则和示例</h1><p id="47e2" class="pw-post-body-paragraph iq ir ht is b it kz iv iw ix la iz ja jb lb jd je jf lc jh ji jj ld jl jm jn hm dt translated"><em class="le">示例映射</em>是一种基于<em class="le">示例定义<em class="le">用户故事</em>行为的技术。</em>结果是一个仪表板，上面有与<strong class="is hu"> <em class="le">用户故事</em> </strong> <em class="le"> </em> ( <em class="le">黄卡</em>)<strong class="is hu"><em class="le">规则</em> </strong> ( <em class="le">蓝卡</em> ) <strong class="is hu"> <em class="le"> </em> </strong>和<em class="le">示例</em>  ( <em class="le">绿卡</em> ) <em class="le">。</em></p><p id="efb5" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">下面你会发现<em class="le">智能合约</em>必须遵守的<em class="le">拍卖</em>流程的主要<em class="le">功能</em>的仪表板。</p><h2 id="5216" class="lx kc ht bd kd ly lz ma kh mb mc md kl jb me mf kp jf mg mh kt jj mi mj kx mk dt translated">用户故事"<em class="ml">拍卖开始"</em></h2><p id="f962" class="pw-post-body-paragraph iq ir ht is b it kz iv iw ix la iz ja jb lb jd je jf lc jh ji jj ld jl jm jn hm dt translated">拍卖人通过宣布建议的开价、拍卖物品的起拍价或保留价来开始拍卖。</p><figure class="jq jr js jt fq ju fe ff paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="fe ff mm"><img src="../Images/bb779835a5f2f0902b1b1fa8bfb319a4.png" data-original-src="https://miro.medium.com/v2/resize:fit:848/format:webp/1*luEP4FSZic_e1PDgkKa-Vg.png"/></div></div></figure><p id="ab03" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">上面的用户故事被翻译成cucumber-js的一个特征文件中的<a class="ae jo" href="https://marketplace.visualstudio.com/items?itemName=alexkrechik.cucumberautocomplete" rel="noopener ugc nofollow" target="_blank">小黄瓜</a>。<em class="le">规则</em>(蓝卡)被翻译成<strong class="is hu">场景</strong>，而<em class="le">示例</em>(绿卡)被翻译成<strong class="is hu">给定-何时-然后</strong>的序列</p><figure class="jq jr js jt fq ju"><div class="bz el l di"><div class="mn mo l"/></div><figcaption class="mp mq fg fe ff mr ms bd b be z ek">Cucumber feature for user story Auction opening</figcaption></figure><h2 id="8cfd" class="lx kc ht bd kd ly lz ma kh mb mc md kl jb me mf kp jf mg mh kt jj mi mj kx mk dt translated">用户故事“竞价”</h2><p id="d2f6" class="pw-post-body-paragraph iq ir ht is b it kz iv iw ix la iz ja jb lb jd je jf lc jh ji jj ld jl jm jn hm dt translated">拍卖师从对拍卖品感兴趣的买家那里接受越来越高的出价。拍卖人通常决定最低出价增量，通常在出价变高时提高。</p><figure class="jq jr js jt fq ju fe ff paragraph-image"><div class="fe ff mt"><img src="../Images/33f62e55119fe25b00e89e2021f41f74.png" data-original-src="https://miro.medium.com/v2/resize:fit:1278/format:webp/1*QyACrlWB0CUPqwleUzCCwQ.png"/></div><figcaption class="mp mq fg fe ff mr ms bd b be z ek">Cucumber feature for user story Auction opening</figcaption></figure><p id="2bb6" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">上面的<em class="le">用户故事</em>在cucumber-js的一个特征文件中被翻译成<a class="ae jo" href="https://marketplace.visualstudio.com/items?itemName=alexkrechik.cucumberautocomplete" rel="noopener ugc nofollow" target="_blank">小黄瓜</a>。<em class="le">规则</em>(蓝色卡片)对应于<strong class="is hu">场景</strong>模块<em class="le">示例</em>(绿色卡片)对应于<strong class="is hu">给定-何时-然后</strong>的序列</p><figure class="jq jr js jt fq ju"><div class="bz el l di"><div class="mn mo l"/></div></figure><h1 id="d0e2" class="kb kc ht bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky dt translated">智能合同</h1><p id="6790" class="pw-post-body-paragraph iq ir ht is b it kz iv iw ix la iz ja jb lb jd je jf lc jh ji jj ld jl jm jn hm dt translated"><strong class="is hu">拍卖</strong>智能合约或Dapp将在<a class="ae jo" href="https://solidity.readthedocs.io" rel="noopener ugc nofollow" target="_blank"><em class="le"/></a>中为<a class="ae jo" href="https://www.ethereum.org/" rel="noopener ugc nofollow" target="_blank">以太坊</a>开发，它将打包在一个nodejs项目中。</p><p id="dfda" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">nodejs项目依赖于以下模块:</p><ul class=""><li id="c6f4" class="lf lg ht is b it iu ix iy jb lh jf li jj lj jn lk ll lm ln dt translated"><strong class="is hu"> cucumber </strong>指定在特征中分组的测试。</li><li id="da77" class="lf lg ht is b it lo ix lp jb lq jf lr jj ls jn lk ll lm ln dt translated">ganache-cli 模拟以太坊节点进行测试。</li><li id="d7af" class="lf lg ht is b it lo ix lp jb lq jf lr jj ls jn lk ll lm ln dt translated"><strong class="is hu"> web3 </strong>作为以太坊的客户端。</li><li id="9899" class="lf lg ht is b it lo ix lp jb lq jf lr jj ls jn lk ll lm ln dt translated">用于智能合同编译的solc 。用truffle或从终端编译智能合同是可能的。</li></ul><pre class="jq jr js jt fq mu mv mw mx aw my dt"><span id="f068" class="lx kc ht mv b fv mz na l nb nc">$ npm install cucumber ganache-cli web3 solc --save-dev</span></pre><h2 id="753a" class="lx kc ht bd kd ly lz ma kh mb mc md kl jb me mf kp jf mg mh kt jj mi mj kx mk dt translated">文件夹结构</h2><ul class=""><li id="32a3" class="lf lg ht is b it kz ix la jb lt jf lu jj lv jn lk ll lm ln dt translated"><strong class="is hu">合同。</strong>智能合约的来源</li><li id="9039" class="lf lg ht is b it lo ix lp jb lq jf lr jj ls jn lk ll lm ln dt translated"><strong class="is hu">功能</strong>。此文件夹包含定义特征的文件，它将是用户故事的特征文件。特色语言<a class="ae jo" href="https://cucumber.io/docs/gherkin/reference/" rel="noopener ugc nofollow" target="_blank">小黄瓜</a></li><li id="8d4a" class="lf lg ht is b it lo ix lp jb lq jf lr jj ls jn lk ll lm ln dt translated"><strong class="is hu">特征/步骤定义</strong>。该文件夹依赖于<em class="le">特征</em>，它包含一个文件，该文件中的测试<strong class="is hu">适用于该特征。step_definitions的语言类似于任何javascript测试——想想chain、mocha等。—</strong></li></ul><p id="51f9" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">例如<strong class="is hu"> auction_opening.feature </strong>引用了用户故事“<em class="le"> Auction opening </em>”,而<strong class="is hu">step _ definitions/Auction _ opening _ steps . js</strong>包含了特性<em class="le"> auction_opening </em>的测试</p><h2 id="fbb9" class="lx kc ht bd kd ly lz ma kh mb mc md kl jb me mf kp jf mg mh kt jj mi mj kx mk dt translated">测试的执行</h2><ol class=""><li id="10d7" class="lf lg ht is b it kz ix la jb lt jf lu jj lv jn nd ll lm ln dt translated">编译智能契约(可以从终端使用<a class="ae jo" href="https://www.trufflesuite.com/docs/truffle/getting-started/compiling-contracts" rel="noopener ugc nofollow" target="_blank"> truffle </a>或<a class="ae jo" href="https://solidity.readthedocs.io/en/v0.5.11/using-the-compiler.html" rel="noopener ugc nofollow" target="_blank"> solc </a>来编译契约，我使用<a class="ae jo" href="https://github.com/ethereum/solc-js" rel="noopener ugc nofollow" target="_blank"> solc-js </a>来避免额外的步骤并专注于BDD和cucumber)</li></ol><pre class="jq jr js jt fq mu mv mw mx aw my dt"><span id="6799" class="lx kc ht mv b fv mz na l nb nc">$ npm run compile</span></pre><p id="bf8b" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">2.启动测试</p><pre class="jq jr js jt fq mu mv mw mx aw my dt"><span id="2915" class="lx kc ht mv b fv mz na l nb nc">$ npm test</span></pre><h2 id="acbc" class="lx kc ht bd kd ly lz ma kh mb mc md kl jb me mf kp jf mg mh kt jj mi mj kx mk dt translated">推荐堆栈</h2><p id="90bf" class="pw-post-body-paragraph iq ir ht is b it kz iv iw ix la iz ja jb lb jd je jf lc jh ji jj ld jl jm jn hm dt translated"><a class="ae jo" href="https://code.visualstudio.com/" rel="noopener ugc nofollow" target="_blank"> VS代码</a>用<a class="ae jo" href="https://marketplace.visualstudio.com/items?itemName=alexkrechik.cucumberautocomplete" rel="noopener ugc nofollow" target="_blank"> Cucumber (Gherkin)完全支持</a>插件作为智能合同的编辑器</p><p id="b10a" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated"><a class="ae jo" href="https://www.draw.io/" rel="noopener ugc nofollow" target="_blank"> draw.io </a>作为数字仪表盘的功能—“模拟”仪表盘更好，但不太环保—</p><h1 id="0795" class="kb kc ht bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky dt translated">Github知识库</h1><p id="06b3" class="pw-post-body-paragraph iq ir ht is b it kz iv iw ix la iz ja jb lb jd je jf lc jh ji jj ld jl jm jn hm dt translated"><a class="ae jo" href="https://github.com/joaquin-alfaro/dapp-auction-with-bdd-cucumber" rel="noopener ugc nofollow" target="_blank">https://github . com/Joaquin-alfaro/dapp-auction-with-BDD-cumber</a></p><h1 id="196e" class="kb kc ht bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky dt translated">参考</h1><p id="c7f2" class="pw-post-body-paragraph iq ir ht is b it kz iv iw ix la iz ja jb lb jd je jf lc jh ji jj ld jl jm jn hm dt translated"><a class="ae jo" href="https://cucumber.io/blog/example-mapping-introduction/" rel="noopener ugc nofollow" target="_blank">https://cucumber.io/blog/example-mapping-introduction/</a></p><p id="b3bc" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated"><a class="ae jo" href="https://en.wikipedia.org/wiki/English_auction" rel="noopener ugc nofollow" target="_blank">https://en.wikipedia.org/wiki/English_auction</a></p><div class="ne nf fm fo ng nh"><a href="https://programtheblockchain.com/posts/2018/03/20/writing-a-token-auction-contract/" rel="noopener  ugc nofollow" target="_blank"><div class="ni ab ej"><div class="nj ab nk cl cj nl"><h2 class="bd hu fv z el nm eo ep nn er et hs dt translated">撰写象征性拍卖合同</h2><div class="no l"><h3 class="bd b fv z el nm eo ep nn er et ek translated">这篇文章将展示如何写一份智能合同，将ERC20代币拍卖给出价最高的人。的…</h3></div><div class="np l"><p class="bd b gc z el nm eo ep nn er et ek translated">programtheblockchain.com</p></div></div><div class="nq l"><div class="nr l ns nt nu nq nv jz nh"/></div></div></a></div><blockquote class="nw"><p id="03c0" class="nx ny ht bd nz oa ob oc od oe of jn ek translated"><a class="ae jo" href="https://coincodecap.com/?utm_source=coinmonks" rel="noopener ugc nofollow" target="_blank">直接在您的收件箱中获得最佳软件交易</a></p></blockquote><figure class="oh oi oj ok ol ju fe ff paragraph-image"><a href="https://coincodecap.com/?utm_source=coinmonks"><div class="fe ff og"><img src="../Images/7c0b3dfdcbfea594cc0ae7d4f9bf6fcb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1168/format:webp/0*OJ-qb5G6i863msBB.png"/></div></a></figure></div></div>    
</body>
</html>