<html>
<head>
<title>Triggering Email alerts from the IOTA Tangle</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">从IOTA Tangle触发电子邮件警报</h1>
<blockquote>原文：<a href="https://medium.com/coinmonks/triggering-email-alerts-from-the-iota-tangle-3362219d2846?source=collection_archive---------6-----------------------#2018-06-12">https://medium.com/coinmonks/triggering-email-alerts-from-the-iota-tangle-3362219d2846?source=collection_archive---------6-----------------------#2018-06-12</a></blockquote><div><div class="ef hh hi hj hk hl"/><div class="hm hn ho hp hq"><div class=""/><div class=""><h2 id="a549" class="pw-subtitle-paragraph iq hs ht bd b ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ek translated">DIY指南</h2></div><figure class="jj jk jl jm fq jn fe ff paragraph-image"><div role="button" tabindex="0" class="jo jp di jq bf jr"><div class="fe ff ji"><img src="../Images/cedc13ec7cc938675c1e53c78d6cb122.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*UHn87J7D95gmE53k.png"/></div></div></figure><p id="89ca" class="pw-post-body-paragraph ju jv ht jw b jx jy iu jz ka kb ix kc kd ke kf kg kh ki kj kk kl km kn ko kp hm dt translated">我最近遇到了一个新项目，叫做<a class="ae kq" href="https://totangle.com/" rel="noopener ugc nofollow" target="_blank"> Totangle </a>。Totangle将tangle与Zapier集成在一起，这允许您将tangle上发生的事情集成到您现有的API或工作流中。他们提出的第一个用例是，当您在tangle上获得付款时，设置一个电子邮件提醒。</p><p id="046b" class="pw-post-body-paragraph ju jv ht jw b jx jy iu jz ka kb ix kc kd ke kf kg kh ki kj kk kl km kn ko kp hm dt translated">受此启发，我自己也需要这个工具(我想在收到来自我的中型文章的提示时得到提醒，而不必经常打开钱包)，我想看看是否可以制作一个开源的lambda函数来复制这个基本功能。</p><h1 id="bcc8" class="kr ks ht bd kt ku kv kw kx ky kz la lb iz lc ja ld jc le jd lf jf lg jg lh li dt translated">它是这样工作的:</h1><ul class=""><li id="def6" class="lj lk ht jw b jx ll ka lm kd ln kh lo kl lp kp lq lr ls lt dt translated">我们编写了一个lambda函数，每30分钟左右在tangle上寻找一个<code class="eh lu lv lw lx b">address</code>或<code class="eh lu lv lw lx b">tag</code>。</li><li id="5f50" class="lj lk ht jw b jx ly ka lz kd ma kh mb kl mc kp lq lr ls lt dt translated">如果lambda函数看到以前没有看到的新交易，它会使用SNS向我的电子邮件地址发送一封电子邮件。</li><li id="9e95" class="lj lk ht jw b jx ly ka lz kd ma kh mb kl mc kp lq lr ls lt dt translated">一旦它发送了电子邮件，它会将最近看到的交易保存到某个地方的某个列表中——也许S3现在可以工作，或者将来我们可以使用DynamoDB。</li></ul><h1 id="f36f" class="kr ks ht bd kt ku kv kw kx ky kz la lb iz lc ja ld jc le jd lf jf lg jg lh li dt translated">第一部分:设置lambda</h1><p id="2182" class="pw-post-body-paragraph ju jv ht jw b jx ll iu jz ka lm ix kc kd md kf kg kh me kj kk kl mf kn ko kp hm dt translated">我们将使用优秀的，尽管名字不好的，无服务器框架来管理我们的AWS lambdas和触发器。</p><p id="aa39" class="pw-post-body-paragraph ju jv ht jw b jx jy iu jz ka kb ix kc kd ke kf kg kh ki kj kk kl km kn ko kp hm dt translated">让我们从创建一个新项目开始。</p><pre class="jj jk jl jm fq mg lx mh mi aw mj dt"><span id="94e5" class="mk ks ht lx b fv ml mm l mn mo">$ npm install -g serverless<br/>$ serverless create --template aws-nodejs --path tangle-trigger<br/>$ cd tangle-trigger<br/>$ npm init -y</span></pre><p id="2553" class="pw-post-body-paragraph ju jv ht jw b jx jy iu jz ka kb ix kc kd ke kf kg kh ki kj kk kl km kn ko kp hm dt translated">我们还需要安装iota库，并设置一些好的环境变量</p><pre class="jj jk jl jm fq mg lx mh mi aw mj dt"><span id="07f2" class="mk ks ht lx b fv ml mm l mn mo">$ touch .env<br/>$ npm install --save iota.lib.js</span></pre><p id="b966" class="pw-post-body-paragraph ju jv ht jw b jx jy iu jz ka kb ix kc kd ke kf kg kh ki kj kk kl km kn ko kp hm dt translated">让我们先编辑一下<code class="eh lu lv lw lx b">.env</code>文件:</p><pre class="jj jk jl jm fq mg lx mh mi aw mj dt"><span id="15d7" class="mk ks ht lx b fv ml mm l mn mo">export AWS_PROFILE=default<br/>export IOTA_URL="http://localhost:14265"<br/>export IOTA_ADDRESS="9999"</span></pre><p id="d11c" class="pw-post-body-paragraph ju jv ht jw b jx jy iu jz ka kb ix kc kd ke kf kg kh ki kj kk kl km kn ko kp hm dt translated">我们使用<code class="eh lu lv lw lx b">AWS_PROFILE</code>环境变量来控制将无服务器部署到哪个AWS帐户。我经常不得不在帐户之间导航，所以这个环境变量非常有用。</p><p id="0363" class="pw-post-body-paragraph ju jv ht jw b jx jy iu jz ka kb ix kc kd ke kf kg kh ki kj kk kl km kn ko kp hm dt translated">这两个<code class="eh lu lv lw lx b">IOTA_*</code>环境变量只是占位符，但是我想向您展示如何将它们放入运行的lambda函数中。</p><p id="335b" class="pw-post-body-paragraph ju jv ht jw b jx jy iu jz ka kb ix kc kd ke kf kg kh ki kj kk kl km kn ko kp hm dt translated">让我们给<code class="eh lu lv lw lx b">package.json</code>添加一个<code class="eh lu lv lw lx b">deploy</code>脚本:</p><figure class="jj jk jl jm fq jn"><div class="bz el l di"><div class="mp mq l"/></div></figure><p id="14ef" class="pw-post-body-paragraph ju jv ht jw b jx jy iu jz ka kb ix kc kd ke kf kg kh ki kj kk kl km kn ko kp hm dt translated">接下来，我们需要修改<code class="eh lu lv lw lx b">Serverless.yml </code>文件来定义lambda函数和触发该函数的事件。</p><figure class="jj jk jl jm fq jn"><div class="bz el l di"><div class="mp mq l"/></div></figure><p id="55f8" class="pw-post-body-paragraph ju jv ht jw b jx jy iu jz ka kb ix kc kd ke kf kg kh ki kj kk kl km kn ko kp hm dt translated">现在，我们每分钟都在调度lambda函数——这样我们就不必等待30分钟来调试任何问题。您还可以看到我们是如何通过<code class="eh lu lv lw lx b">IOTA_*</code>环境变量的，这些变量将被自动放置到lambda运行时中。</p><p id="bffb" class="pw-post-body-paragraph ju jv ht jw b jx jy iu jz ka kb ix kc kd ke kf kg kh ki kj kk kl km kn ko kp hm dt translated">我们需要做的最后一件事是实际编写lambda函数！这里有一个占位符<code class="eh lu lv lw lx b">handler.js</code></p><figure class="jj jk jl jm fq jn"><div class="bz el l di"><div class="mp mq l"/></div></figure><p id="ea97" class="pw-post-body-paragraph ju jv ht jw b jx jy iu jz ka kb ix kc kd ke kf kg kh ki kj kk kl km kn ko kp hm dt translated">很简单，对吧？但是它让我们确保我们的环境变量被正确地传入，并且还确保我们的lambda被正确地与<code class="eh lu lv lw lx b"> iota.lib.js</code>依赖项打包在一起。</p><p id="3575" class="pw-post-body-paragraph ju jv ht jw b jx jy iu jz ka kb ix kc kd ke kf kg kh ki kj kk kl km kn ko kp hm dt translated">让我们部署它，并探索一下AWS控制台。</p><pre class="jj jk jl jm fq mg lx mh mi aw mj dt"><span id="b3b9" class="mk ks ht lx b fv ml mm l mn mo">$ npm run deploy</span></pre><p id="83cf" class="pw-post-body-paragraph ju jv ht jw b jx jy iu jz ka kb ix kc kd ke kf kg kh ki kj kk kl km kn ko kp hm dt translated">您应该会看到如下的一些终端输出(我使用的是<code class="eh lu lv lw lx b">yarn</code>而不是<code class="eh lu lv lw lx b">npm</code> btw)。</p><figure class="jj jk jl jm fq jn fe ff paragraph-image"><div role="button" tabindex="0" class="jo jp di jq bf jr"><div class="fe ff mr"><img src="../Images/891295251bf949d61272da5c37682209.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*sYGYTHNzad62dbrW.png"/></div></div></figure><p id="6ad5" class="pw-post-body-paragraph ju jv ht jw b jx jy iu jz ka kb ix kc kd ke kf kg kh ki kj kk kl km kn ko kp hm dt translated">导航到AWS控制台，我们应该能够看到一个Cloudformation堆栈:</p><figure class="jj jk jl jm fq jn fe ff paragraph-image"><div role="button" tabindex="0" class="jo jp di jq bf jr"><div class="fe ff ji"><img src="../Images/618b9d06dc56bf3080b0a3015fa3bb39.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*X7iRpsLZnNjnT_uP.png"/></div></div></figure><p id="94c7" class="pw-post-body-paragraph ju jv ht jw b jx jy iu jz ka kb ix kc kd ke kf kg kh ki kj kk kl km kn ko kp hm dt translated">λ函数:</p><figure class="jj jk jl jm fq jn fe ff paragraph-image"><div role="button" tabindex="0" class="jo jp di jq bf jr"><div class="fe ff ms"><img src="../Images/18c02dc2d1a4dbef88d4f92c370b5805.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*UDnf8X1sntwoOAp5.png"/></div></div></figure><p id="04c5" class="pw-post-body-paragraph ju jv ht jw b jx jy iu jz ka kb ix kc kd ke kf kg kh ki kj kk kl km kn ko kp hm dt translated">以及一些Cloudwatch日志，每次触发lambda时都会写入:</p><figure class="jj jk jl jm fq jn fe ff paragraph-image"><div role="button" tabindex="0" class="jo jp di jq bf jr"><div class="fe ff ji"><img src="../Images/2afc2031a639ac0e03ebe2841b5de362.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*6_ruOpPwzN9fbCnI.png"/></div></div></figure><h1 id="453a" class="kr ks ht bd kt ku kv kw kx ky kz la lb iz lc ja ld jc le jd lf jf lg jg lh li dt translated">第二部分:与纠结对话</h1><p id="fd4d" class="pw-post-body-paragraph ju jv ht jw b jx ll iu jz ka lm ix kc kd md kf kg kh me kj kk kl mf kn ko kp hm dt translated">现在我们有了一个每隔<em class="mt"> n </em>分钟运行一次的基本lambda函数，我们需要一种方法来检查对特定地址的传输。我们将在iota js lib上使用<code class="eh lu lv lw lx b">findTransactionObjects()</code>方法来完成这项工作。</p><p id="aea5" class="pw-post-body-paragraph ju jv ht jw b jx jy iu jz ka kb ix kc kd ke kf kg kh ki kj kk kl km kn ko kp hm dt translated">然而，在我们实现它之前，我们应该想办法在本地运行无服务器功能，否则调试这个功能将是一件非常痛苦的事情。</p><p id="3815" class="pw-post-body-paragraph ju jv ht jw b jx jy iu jz ka kb ix kc kd ke kf kg kh ki kj kk kl km kn ko kp hm dt translated">创建一个名为<code class="eh lu lv lw lx b">local.js</code>的新文件:</p><figure class="jj jk jl jm fq jn"><div class="bz el l di"><div class="mp mq l"/></div></figure><p id="f93e" class="pw-post-body-paragraph ju jv ht jw b jx jy iu jz ka kb ix kc kd ke kf kg kh ki kj kk kl km kn ko kp hm dt translated">现在我们可以用下面的代码运行<code class="eh lu lv lw lx b">local.js</code>:</p><pre class="jj jk jl jm fq mg lx mh mi aw mj dt"><span id="2d71" class="mk ks ht lx b fv ml mm l mn mo">$ node local.js</span></pre><p id="40ba" class="pw-post-body-paragraph ju jv ht jw b jx jy iu jz ka kb ix kc kd ke kf kg kh ki kj kk kl km kn ko kp hm dt translated">您应该会看到如下所示的内容:</p><pre class="jj jk jl jm fq mg lx mh mi aw mj dt"><span id="e4f8" class="mk ks ht lx b fv ml mm l mn mo">CHECKING ADDRESS: undefined</span></pre><p id="021b" class="pw-post-body-paragraph ju jv ht jw b jx jy iu jz ka kb ix kc kd ke kf kg kh ki kj kk kl km kn ko kp hm dt translated">好吧！它只工作了一半。我们需要确保我们的。首先是env文件。我们可以将所有这些放在一个npm脚本中:<code class="eh lu lv lw lx b">package.json</code></p><figure class="jj jk jl jm fq jn"><div class="bz el l di"><div class="mp mq l"/></div></figure><p id="2dec" class="pw-post-body-paragraph ju jv ht jw b jx jy iu jz ka kb ix kc kd ke kf kg kh ki kj kk kl km kn ko kp hm dt translated">现在，当我们运行<code class="eh lu lv lw lx b">yarn run test</code>(或<code class="eh lu lv lw lx b">npm run test</code>)时，我们得到如下结果:</p><pre class="jj jk jl jm fq mg lx mh mi aw mj dt"><span id="d553" class="mk ks ht lx b fv ml mm l mn mo">yarn run v1.6.0<br/>$ source .env &amp;&amp; node local.js<br/>CHECKING ADDRESS: 9999<br/>✨  Done in 0.22s.</span></pre><p id="bdc4" class="pw-post-body-paragraph ju jv ht jw b jx jy iu jz ka kb ix kc kd ke kf kg kh ki kj kk kl km kn ko kp hm dt translated">我们的环境变量被很好地传递进来。让我们和泰戈谈谈</p><h1 id="1d44" class="kr ks ht bd kt ku kv kw kx ky kz la lb iz lc ja ld jc le jd lf jf lg jg lh li dt translated">与纠结对话</h1><p id="ad24" class="pw-post-body-paragraph ju jv ht jw b jx ll iu jz ka lm ix kc kd md kf kg kh me kj kk kl mf kn ko kp hm dt translated">首先，让我们在<code class="eh lu lv lw lx b">.env</code>文件中放一些合适的值:</p><figure class="jj jk jl jm fq jn"><div class="bz el l di"><div class="mp mq l"/></div></figure><p id="87c6" class="pw-post-body-paragraph ju jv ht jw b jx jy iu jz ka kb ix kc kd ke kf kg kh ki kj kk kl km kn ko kp hm dt translated">我目前在新加坡，所以<code class="eh lu lv lw lx b">durian.iotasalad.org</code>似乎很合适。</p><p id="ba13" class="pw-post-body-paragraph ju jv ht jw b jx jy iu jz ka kb ix kc kd ke kf kg kh ki kj kk kl km kn ko kp hm dt translated">让我们更新handler.js来调用api:</p><figure class="jj jk jl jm fq jn"><div class="bz el l di"><div class="mp mq l"/></div></figure><p id="d2c0" class="pw-post-body-paragraph ju jv ht jw b jx jy iu jz ka kb ix kc kd ke kf kg kh ki kj kk kl km kn ko kp hm dt translated">现在，当我们运行我们的测试时，我们应该得到类似如下的结果:</p><figure class="jj jk jl jm fq jn fe ff paragraph-image"><div role="button" tabindex="0" class="jo jp di jq bf jr"><div class="fe ff mu"><img src="../Images/fccc3f1ed8623bda12eb8062d408ce00.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*suWbyb1tWAZ81OJd.png"/></div></div></figure><p id="ee71" class="pw-post-body-paragraph ju jv ht jw b jx jy iu jz ka kb ix kc kd ke kf kg kh ki kj kk kl km kn ko kp hm dt translated">太好了！我们可以查到给定地址的转账记录！现在我们需要计算转移的数量，并确保我们过滤掉已经看到的转移。为此，我们将使用S3自动气象站。</p><p id="0bf2" class="pw-post-body-paragraph ju jv ht jw b jx jy iu jz ka kb ix kc kd ke kf kg kh ki kj kk kl km kn ko kp hm dt translated">让我们安装aws-sdk:</p><pre class="jj jk jl jm fq mg lx mh mi aw mj dt"><span id="8cd9" class="mk ks ht lx b fv ml mm l mn mo">npm install --save aws-sdk</span></pre><p id="4a9d" class="pw-post-body-paragraph ju jv ht jw b jx jy iu jz ka kb ix kc kd ke kf kg kh ki kj kk kl km kn ko kp hm dt translated">现在我们需要添加一个s3存储桶到我们的<code class="eh lu lv lw lx b">serverless.yml</code>文件，以及一个新的环境变量:</p><p id="a42e" class="pw-post-body-paragraph ju jv ht jw b jx jy iu jz ka kb ix kc kd ke kf kg kh ki kj kk kl km kn ko kp hm dt translated"><code class="eh lu lv lw lx b">serverless.yml</code></p><figure class="jj jk jl jm fq jn"><div class="bz el l di"><div class="mp mq l"/></div></figure><p id="aaa9" class="pw-post-body-paragraph ju jv ht jw b jx jy iu jz ka kb ix kc kd ke kf kg kh ki kj kk kl km kn ko kp hm dt translated"><code class="eh lu lv lw lx b">.env</code></p><pre class="jj jk jl jm fq mg lx mh mi aw mj dt"><span id="eb19" class="mk ks ht lx b fv ml mm l mn mo">...<br/>export S3_BUCKET_NAME="tangletrigger"</span></pre><p id="42ee" class="pw-post-body-paragraph ju jv ht jw b jx jy iu jz ka kb ix kc kd ke kf kg kh ki kj kk kl km kn ko kp hm dt translated">好的。现在我们需要稍微整理一下，从s3读写的函数。这是我想到的。</p><p id="ad29" class="pw-post-body-paragraph ju jv ht jw b jx jy iu jz ka kb ix kc kd ke kf kg kh ki kj kk kl km kn ko kp hm dt translated"><code class="eh lu lv lw lx b">handler.js</code></p><figure class="jj jk jl jm fq jn"><div class="bz el l di"><div class="mp mq l"/></div></figure><p id="3e10" class="pw-post-body-paragraph ju jv ht jw b jx jy iu jz ka kb ix kc kd ke kf kg kh ki kj kk kl km kn ko kp hm dt translated">希望这是不言自明的。在这种情况下，我们只是使用tx hash作为关键字将新文件写入s3 bucket。它有点懒，使用数据库会更好，但是s3是免费的，更容易上手。我将让你来建立一个数据库。</p><p id="dc1c" class="pw-post-body-paragraph ju jv ht jw b jx jy iu jz ka kb ix kc kd ke kf kg kh ki kj kk kl km kn ko kp hm dt translated">现在，当在本地再次运行这个命令后，我们可以检查我们的aws bucket:(您需要安装aws cli，否则您可以使用web控制台)</p><pre class="jj jk jl jm fq mg lx mh mi aw mj dt"><span id="e359" class="mk ks ht lx b fv ml mm l mn mo">$ aws s3 ls s3://tangletrigger/<br/>2018-05-30 10:05:01          6 BGTXJCVKTJZR9GVZOVJOUPQTZSFRQYTWMNBWBDNUVHLTMLNLQBNBSJEINSRJFEEXOHUBNOGXMXKEA9999</span></pre><h1 id="4b4e" class="kr ks ht bd kt ku kv kw kx ky kz la lb iz lc ja ld jc le jd lf jf lg jg lh li dt translated">添加电子邮件通知</h1><p id="51e4" class="pw-post-body-paragraph ju jv ht jw b jx ll iu jz ka lm ix kc kd md kf kg kh me kj kk kl mf kn ko kp hm dt translated">最后，如果我们在tangle上看到任何新的事务，我们需要发送一封电子邮件。AWS让SNS变得非常简单，所以首先，让我们在<code class="eh lu lv lw lx b">serverless.yml</code>中添加一个新的SNS主题</p><p id="f562" class="pw-post-body-paragraph ju jv ht jw b jx jy iu jz ka kb ix kc kd ke kf kg kh ki kj kk kl km kn ko kp hm dt translated">我们的<code class="eh lu lv lw lx b">serverless.yml</code>部分现在应该是这样的:</p><figure class="jj jk jl jm fq jn"><div class="bz el l di"><div class="mp mq l"/></div></figure><p id="ad03" class="pw-post-body-paragraph ju jv ht jw b jx jy iu jz ka kb ix kc kd ke kf kg kh ki kj kk kl km kn ko kp hm dt translated">请注意，我们现在已经定义了一个SNS主题，它将发送到在我们的<code class="eh lu lv lw lx b">.env</code>文件中定义的电子邮件，我们使用<code class="eh lu lv lw lx b">Ref</code>函数将它设置为一个环境变量，然后将它传递给我们的lambda。我们将在下面的<code class="eh lu lv lw lx b">publishSNSMessage()</code>中使用它。</p><p id="47f2" class="pw-post-body-paragraph ju jv ht jw b jx jy iu jz ka kb ix kc kd ke kf kg kh ki kj kk kl km kn ko kp hm dt translated">这是我们最后的<code class="eh lu lv lw lx b">handler.js</code>，添加了电子邮件设置。</p><figure class="jj jk jl jm fq jn"><div class="bz el l di"><div class="mp mq l"/></div></figure><p id="481c" class="pw-post-body-paragraph ju jv ht jw b jx jy iu jz ka kb ix kc kd ke kf kg kh ki kj kk kl km kn ko kp hm dt translated">这是一封电子邮件，告诉我我有新的交易:</p><figure class="jj jk jl jm fq jn fe ff paragraph-image"><div role="button" tabindex="0" class="jo jp di jq bf jr"><div class="fe ff mv"><img src="../Images/61b676d6e91ff852ad829b6f0768c023.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*Mw5Hs8dJCZLRxuwD.png"/></div></div></figure><p id="0e06" class="pw-post-body-paragraph ju jv ht jw b jx jy iu jz ka kb ix kc kd ke kf kg kh ki kj kk kl km kn ko kp hm dt translated">测试电子邮件。现在越来越真实了！</p><p id="ef51" class="pw-post-body-paragraph ju jv ht jw b jx jy iu jz ka kb ix kc kd ke kf kg kh ki kj kk kl km kn ko kp hm dt translated">现在，我们只需将通知时间改回30分钟，就可以再次部署它了。</p><p id="74af" class="pw-post-body-paragraph ju jv ht jw b jx jy iu jz ka kb ix kc kd ke kf kg kh ki kj kk kl km kn ko kp hm dt translated">我还将向这个地址发送一个事务，看看会发生什么！</p><figure class="jj jk jl jm fq jn fe ff paragraph-image"><div role="button" tabindex="0" class="jo jp di jq bf jr"><div class="fe ff mw"><img src="../Images/602c201e9de5517396e159c4d0b87d77.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*4JiQob1-eO6cZfo7.png"/></div></div><figcaption class="mx my fg fe ff mz na bd b be z ek">Sending myself 1 IOTA</figcaption></figure><p id="79f1" class="pw-post-body-paragraph ju jv ht jw b jx jy iu jz ka kb ix kc kd ke kf kg kh ki kj kk kl km kn ko kp hm dt translated">现在我需要做的就是等一封邮件。</p><p id="f505" class="pw-post-body-paragraph ju jv ht jw b jx jy iu jz ka kb ix kc kd ke kf kg kh ki kj kk kl km kn ko kp hm dt translated">等了大约一个小时后，我在收件箱里发现了以下内容:</p><figure class="jj jk jl jm fq jn fe ff paragraph-image"><div role="button" tabindex="0" class="jo jp di jq bf jr"><div class="fe ff nb"><img src="../Images/eca5db42b09dba616811a8e6f8a8845b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*G8tAmPQrFXLvEUsu.png"/></div></div><figcaption class="mx my fg fe ff mz na bd b be z ek">Nada. Nothing. Zip.</figcaption></figure><p id="ce01" class="pw-post-body-paragraph ju jv ht jw b jx jy iu jz ka kb ix kc kd ke kf kg kh ki kj kk kl km kn ko kp hm dt translated">让我们看看我们的Cloudwatch日志，看看发生了什么。</p><p id="73cc" class="pw-post-body-paragraph ju jv ht jw b jx jy iu jz ka kb ix kc kd ke kf kg kh ki kj kk kl km kn ko kp hm dt translated">我导航到<code class="eh lu lv lw lx b">CloudWatch</code> &gt; <code class="eh lu lv lw lx b">Logs</code> &gt; <code class="eh lu lv lw lx b">/aws/lambda/TangleTrigger-dev-checkAddress</code>，选择了最新的日志(最上面的那个)。</p><figure class="jj jk jl jm fq jn fe ff paragraph-image"><div role="button" tabindex="0" class="jo jp di jq bf jr"><div class="fe ff ji"><img src="../Images/a0de756fd8c1173659fa1ee82451e7c5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*TErjAilA-IaMpB-5.png"/></div></div></figure><p id="5edc" class="pw-post-body-paragraph ju jv ht jw b jx jy iu jz ka kb ix kc kd ke kf kg kh ki kj kk kl km kn ko kp hm dt translated">嗯。S3好像有点不对劲。</p><p id="b483" class="pw-post-body-paragraph ju jv ht jw b jx jy iu jz ka kb ix kc kd ke kf kg kh ki kj kk kl km kn ko kp hm dt translated">好的。说实话，我有点期待这个。我们的Lambda函数所使用的IAM角色无权与我们的S3 bucket对话，也无权发布到我们之前创建的SNS主题。这很容易解决:</p><p id="78b0" class="pw-post-body-paragraph ju jv ht jw b jx jy iu jz ka kb ix kc kd ke kf kg kh ki kj kk kl km kn ko kp hm dt translated">将以下内容添加到<code class="eh lu lv lw lx b">serverless.yml</code>的提供商部分:</p><figure class="jj jk jl jm fq jn"><div class="bz el l di"><div class="mp mq l"/></div></figure><p id="3b61" class="pw-post-body-paragraph ju jv ht jw b jx jy iu jz ka kb ix kc kd ke kf kg kh ki kj kk kl km kn ko kp hm dt translated">这定义了Lambda函数执行时使用的IAM角色权限，上面我们给它读写s3 bucket的权限，以及发布到我们创建的SNS主题的权限。</p><p id="bce9" class="pw-post-body-paragraph ju jv ht jw b jx jy iu jz ka kb ix kc kd ke kf kg kh ki kj kk kl km kn ko kp hm dt translated">让我们再部署一次，看看会发生什么。</p><figure class="jj jk jl jm fq jn fe ff paragraph-image"><div role="button" tabindex="0" class="jo jp di jq bf jr"><div class="fe ff ji"><img src="../Images/e505a71832a6a6b72cc741ff40d7c2b0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*uud40f1UBjRJZF9X.png"/></div></div><figcaption class="mx my fg fe ff mz na bd b be z ek">IT’S WORKING!</figcaption></figure><p id="e030" class="pw-post-body-paragraph ju jv ht jw b jx jy iu jz ka kb ix kc kd ke kf kg kh ki kj kk kl km kn ko kp hm dt translated">它起作用了。这并不难，是吗？您可以在这里查看完整代码<a class="ae kq" href="https://github.com/vessels-tech/tangletrigger" rel="noopener ugc nofollow" target="_blank">，并确保您查看了我们上面所经历的每个步骤的其他分支。</a></p><p id="5c77" class="pw-post-body-paragraph ju jv ht jw b jx jy iu jz ka kb ix kc kd ke kf kg kh ki kj kk kl km kn ko kp hm dt translated">你设法让它工作了吗？还是卡住了？让我知道。我很乐意帮忙。你也可以通过推特<code class="eh lu lv lw lx b">@lewdaly</code>联系我，或者通过<code class="eh lu lv lw lx b">lwilld</code>联系IOTA Discord。</p><blockquote class="nc nd ne"><p id="c6aa" class="ju jv mt jw b jx jy iu jz ka kb ix kc nf ke kf kg ng ki kj kk nh km kn ko kp hm dt translated">如果你喜欢这篇文章，或者有任何建议或问题，请在评论中告诉我。如果你喜欢这篇文章，给它一个❤️或👏或者随便你们这些疯猫现在怎么称呼它。</p><p id="109b" class="ju jv mt jw b jx jy iu jz ka kb ix kc nf ke kf kg ng ki kj kk nh km kn ko kp hm dt translated"><em class="ht">随时欢迎提示🙌🙌🙌</em> <code class="eh lu lv lw lx b"><em class="ht">BJSLSJNPWSM9QLO9JYJAG9A9LLAUKZAQJGYZLNN9YMBNPCUUS9E9EYE9PIKIKNYHXAPNFAMDGXVIPVKIWGDUVDALPD</em></code></p></blockquote></div></div>    
</body>
</html>