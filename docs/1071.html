<html>
<head>
<title>A guide to perform web queries in DAPP (Part 2)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在DAPP中执行web查询的指南(第2部分)</h1>
<blockquote>原文：<a href="https://medium.com/coinmonks/a-guide-to-perform-web-queries-in-dapp-part-2-98a519399d57?source=collection_archive---------11-----------------------#2018-07-17">https://medium.com/coinmonks/a-guide-to-perform-web-queries-in-dapp-part-2-98a519399d57?source=collection_archive---------11-----------------------#2018-07-17</a></blockquote><div><div class="ef hh hi hj hk hl"/><div class="hm hn ho hp hq"><div class=""/><p id="44af" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">在理解了第1部分中Oraclize的<a class="ae jo" rel="noopener" href="/coinmonks/a-guide-to-perform-web-queries-in-dapp-35683a386044">机制之后，我们可以深入实现DAPP的细节。</a></p><p id="7a3e" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">我们将执行一项合同，该合同:</p><ul class=""><li id="5dc5" class="jp jq ht is b it iu ix iy jb jr jf js jj jt jn ju jv jw jx dt translated">使用coindesk api获取最新的BTC/美元数据</li><li id="0bcb" class="jp jq ht is b it jy ix jz jb ka jf kb jj kc jn ju jv jw jx dt translated">每60秒更新一次</li></ul><p id="1c06" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">注意Oraclize官网使用的fixer.io api已弃用。并且本例中使用的coindesk api将来也可能被弃用。因此，在遵循本教程之前，请验证api。</p><h1 id="57a8" class="kd ke ht bd kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la dt translated">使用Oraclize api</h1><p id="42af" class="pw-post-body-paragraph iq ir ht is b it lb iv iw ix lc iz ja jb ld jd je jf le jh ji jj lf jl jm jn hm dt translated">该合同应该是合同<strong class="is hu"> </strong> <code class="eh lg lh li lj b"><strong class="is hu">usingOraclize</strong></code>的<strong class="is hu">子合同</strong></p><figure class="lk ll lm ln fq lo"><div class="bz el l di"><div class="lp lq l"/></div></figure><p id="fc6d" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">但是，您可能会发现import语句不起作用。一个快速的解决方法是从他们的<a class="ae jo" href="https://github.com/oraclize/ethereum-api/" rel="noopener ugc nofollow" target="_blank"> <strong class="is hu"> repo </strong> </a>下载<code class="eh lg lh li lj b">oraclize.sol</code>文件到你的项目目录。并使用<a class="ae jo" href="https://remix.readthedocs.io/en/latest/tutorial_import.html" rel="noopener ugc nofollow" target="_blank"> <strong class="is hu">实体导入语句</strong> </a>导入<code class="eh lg lh li lj b">oraclize.sol</code>:</p><p id="dd18" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated"><code class="eh lg lh li lj b">import "oraclize.sol";</code></p><h1 id="33f5" class="kd ke ht bd kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la dt translated">添加函数进行查询</h1><p id="1b89" class="pw-post-body-paragraph iq ir ht is b it lb iv iw ix lc iz ja jb ld jd je jf le jh ji jj lf jl jm jn hm dt translated">然后，我们将实现更多的功能:</p><ul class=""><li id="7e64" class="jp jq ht is b it iu ix iy jb jr jf js jj jt jn ju jv jw jx dt translated">每60秒更新一次</li><li id="96b3" class="jp jq ht is b it jy ix jz jb ka jf kb jj kc jn ju jv jw jx dt translated">使用“URL”数据源类型</li><li id="8c8f" class="jp jq ht is b it jy ix jz jb ka jf kb jj kc jn ju jv jw jx dt translated">使用json解析助手获取. rates.GBP属性</li></ul><p id="7b6e" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">通过在回调中添加一个<code class="eh lg lh li lj b">updataPrice</code>函数。更新过程将再次启动。我们指定<code class="eh lg lh li lj b">updataPrice</code>功能在60秒后执行。因此，每隔60秒，我们就会得到一个新的数据。</p><figure class="lk ll lm ln fq lo"><div class="bz el l di"><div class="lp lq l"/></div></figure><h1 id="f43f" class="kd ke ht bd kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la dt translated">处理数据</h1><p id="562a" class="pw-post-body-paragraph iq ir ht is b it lb iv iw ix lc iz ja jb ld jd je jf le jh ji jj lf jl jm jn hm dt translated">然后我们定义一个处理函数来记录数据。</p><pre class="lk ll lm ln fq lr lj ls lt aw lu dt"><span id="504b" class="lv ke ht lj b fv lw lx l ly lz">event LogPriceUpdated(string price); //a function that will log the input string</span></pre><h1 id="ec7b" class="kd ke ht bd kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la dt translated">把所有的放在一起</h1><p id="a8af" class="pw-post-body-paragraph iq ir ht is b it lb iv iw ix lc iz ja jb ld jd je jf le jh ji jj lf jl jm jn hm dt translated">为了保持简洁明了，我们跳过了一些功能。这是使用Oraclize进行web查询的最小可行代码片段。</p><figure class="lk ll lm ln fq lo"><div class="bz el l di"><div class="lp lq l"/></div></figure><h1 id="cc8a" class="kd ke ht bd kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la dt translated">整个代码片段</h1><p id="4f3b" class="pw-post-body-paragraph iq ir ht is b it lb iv iw ix lc iz ja jb ld jd je jf le jh ji jj lf jl jm jn hm dt translated">该代码最初来自http://docs.oraclize.it/#ethereum-quick-start的。</p><figure class="lk ll lm ln fq lo"><div class="bz el l di"><div class="lp lq l"/></div></figure></div><div class="ab cl ma mb hb mc" role="separator"><span class="md bw bk me mf mg"/><span class="md bw bk me mf mg"/><span class="md bw bk me mf"/></div><div class="hm hn ho hp hq"><p id="bf70" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated"><em class="mh">原载于</em><a class="ae jo" href="https://gist.github.com/sksitou/4b79f2726b4cfccf94b2db9d3074ce19" rel="noopener ugc nofollow" target="_blank"><em class="mh">gist.github.com</em></a><em class="mh">。</em></p></div><div class="ab cl ma mb hb mc" role="separator"><span class="md bw bk me mf mg"/><span class="md bw bk me mf mg"/><span class="md bw bk me mf"/></div><div class="hm hn ho hp hq"><p id="0654" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated"><a class="ae jo" rel="noopener" href="/@thebestchef/a-guide-to-perform-web-queries-in-dapp-35683a386044">在DAPP中执行web查询的指南(第1部分)</a> <br/> <a class="ae jo" rel="noopener" href="/@thebestchef/a-guide-to-perform-web-queries-in-dapp-part-3-de27ceb5343a">在DAPP中执行web查询的指南(第3部分)</a></p></div></div>    
</body>
</html>