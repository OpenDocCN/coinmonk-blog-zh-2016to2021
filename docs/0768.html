<html>
<head>
<title>What the hack is Memory and Storage in Solidity?</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Solidity中的内存和存储是什么？</h1>
<blockquote>原文：<a href="https://medium.com/coinmonks/what-the-hack-is-memory-and-storage-in-solidity-6b9e62577305?source=collection_archive---------0-----------------------#2018-06-13">https://medium.com/coinmonks/what-the-hack-is-memory-and-storage-in-solidity-6b9e62577305?source=collection_archive---------0-----------------------#2018-06-13</a></blockquote><div><div class="ef hh hi hj hk hl"/><div class="hm hn ho hp hq"><div class=""/><figure class="fi fk ir is it iu fe ff paragraph-image"><div class="fe ff iq"><img src="../Images/070565ec455b21c7a9f0e095ad9f9cdc.png" data-original-src="https://miro.medium.com/v2/resize:fit:980/format:webp/1*3Ivk20SDKGksv3dGaPkisQ.jpeg"/></div></figure><p id="d523" class="pw-post-body-paragraph ix iy ht iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju hm dt translated">坚固性中最容易混淆的一个概念是如何有效地使用内存和存储。</p><p id="e758" class="pw-post-body-paragraph ix iy ht iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju hm dt translated">本文旨在提供对内存和存储的基本理解，并通过一些例子展示它的有效用法。</p><blockquote class="jv"><p id="4499" class="jw jx ht bd jy jz ka kb kc kd ke ju ek translated"><a class="ae kf" href="https://coincodecap.com" rel="noopener ugc nofollow" target="_blank">发现并回顾最佳区块链软件</a></p></blockquote><p id="aaf4" class="pw-post-body-paragraph ix iy ht iz b ja kg jc jd je kh jg jh ji ki jk jl jm kj jo jp jq kk js jt ju hm dt translated">如果你是solidity的新手，请先阅读下面的文章:</p><p id="05c8" class="pw-post-body-paragraph ix iy ht iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju hm dt translated"><a class="ae kf" href="http://demystifyblockchain.com/2018/06/29/getting-started-with-ethereum-blockchain-development-part-1/" rel="noopener ugc nofollow" target="_blank"> <strong class="iz hu">以太坊区块链开发入门:part-1</strong>T5】</a></p><p id="ec33" class="pw-post-body-paragraph ix iy ht iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju hm dt translated"><a class="ae kf" href="http://demystifyblockchain.com/2018/06/28/getting-started-with-ethereum-blockchain-development/" rel="noopener ugc nofollow" target="_blank"> <strong class="iz hu">以太坊区块链开发入门:第二部分</strong> </a></p><p id="96ef" class="pw-post-body-paragraph ix iy ht iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju hm dt translated">在我们继续之前，让我们了解一下solidity拥有的不同类型的存储:</p><p id="9292" class="pw-post-body-paragraph ix iy ht iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju hm dt translated"><strong class="iz hu">存储:</strong>每个账户拥有的永久内存称为<strong class="iz hu">存储</strong>。存储是一个键值存储，其中键和值都是32字节。</p><p id="71b0" class="pw-post-body-paragraph ix iy ht iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju hm dt translated"><strong class="iz hu">内存:</strong>内存是一个字节- <strong class="iz hu">数组</strong>，它保存其中的数据，直到函数执行。内存从零大小开始，可以通过简单地访问或存储索引大于其当前大小的内存来扩展为32字节块。为了节省汽油，建议尽可能缩小它的尺寸。</p><p id="43a0" class="pw-post-body-paragraph ix iy ht iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju hm dt translated"><strong class="iz hu">栈</strong>:用来存放小的局部变量。它的成本与内存相同，但只能保存有限的值。</p><h1 id="acfb" class="kl km ht bd kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li dt translated"><strong class="ak">消耗空间的同时消耗气体</strong></h1><p id="b9b4" class="pw-post-body-paragraph ix iy ht iz b ja lj jc jd je lk jg jh ji ll jk jl jm lm jo jp jq ln js jt ju hm dt translated">文章的这一部分假设读者对以太坊的气体消耗有一个基本的了解，如果没有参考下面的链接。👇</p><p id="3326" class="pw-post-body-paragraph ix iy ht iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju hm dt translated"><a class="ae kf" href="https://ethereum.stackexchange.com/questions/3/what-is-meant-by-the-term-gas" rel="noopener ugc nofollow" target="_blank"> <strong class="iz hu"> <em class="lo">以太坊里的气是什么？</em> </strong> </a></p><p id="0c74" class="pw-post-body-paragraph ix iy ht iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju hm dt translated">你在以太坊区块链做的每一件事都会耗费一些汽油。让我们试着比较一下存储和内存的气体消耗。</p><p id="4bfc" class="pw-post-body-paragraph ix iy ht iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju hm dt translated"><strong class="iz hu">储气消耗:</strong>储气成本很好理解:</p><ul class=""><li id="073c" class="lp lq ht iz b ja jb je jf ji lr jm ls jq lt ju lu lv lw lx dt translated">当一个值从零设置为非零时，它花费20，000汽油</li><li id="7030" class="lp lq ht iz b ja ly je lz ji ma jm mb jq mc ju lu lv lw lx dt translated">写入现有存储或将值设置为零时，会消耗5,000 gas。</li><li id="00af" class="lp lq ht iz b ja ly je lz ji ma jm mb jq mc ju lu lv lw lx dt translated">非零值设置为零时，5000气<a class="ae kf" href="https://ethereum.stackexchange.com/q/594/42" rel="noopener ugc nofollow" target="_blank"> </a>退款。</li></ul><p id="093e" class="pw-post-body-paragraph ix iy ht iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju hm dt translated">包装储存节省气体仍然是可能的，例如将2个<a class="ae kf" href="http://solidity.readthedocs.io/en/v0.4.21/types.html#integers" rel="noopener ugc nofollow" target="_blank"> uint128 </a>值放在一个键中，而不是使用2个键。</p><p id="1c50" class="pw-post-body-paragraph ix iy ht iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju hm dt translated"><strong class="iz hu">内存气体消耗:</strong>内存扩展的气体消耗在<a class="ae kf" href="http://yellowpaper.io/" rel="noopener ugc nofollow" target="_blank">黄皮书</a>中定义如下:</p><figure class="me mf mg mh fq iu fe ff paragraph-image"><div class="fe ff md"><img src="../Images/512402767b5eccdf7e54610088e44279.png" data-original-src="https://miro.medium.com/v2/resize:fit:648/0*oKdhvMaKWWo71Umk"/></div><figcaption class="mi mj fg fe ff mk ml bd b be z ek">Gas consumption in memory expansion</figcaption></figure><p id="a788" class="pw-post-body-paragraph ix iy ht iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju hm dt translated"><strong class="iz hu"> G_memory </strong>为3，<strong class="iz hu"> a </strong>为分配的256位块字数量。</p><p id="2334" class="pw-post-body-paragraph ix iy ht iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju hm dt translated">对于a = <strong class="iz hu"> 512个组块</strong>，气体消耗量将为(3 * 512 + (512 * 512)/512) = <strong class="iz hu"> 2560单位</strong></p><p id="e479" class="pw-post-body-paragraph ix iy ht iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju hm dt translated"><strong class="iz hu"> <em class="lo">注意:与存储相比，内存使用的成本并不显著。总是使用内存来执行中间计算并将结果存储在存储器中是一个好习惯。</em> </strong></p><h1 id="e7b3" class="kl km ht bd kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li dt translated"><strong class="ak">变量<strong class="ak">存储在</strong>的什么地方？</strong></h1><p id="b2fd" class="pw-post-body-paragraph ix iy ht iz b ja lj jc jd je lk jg jh ji ll jk jl jm lm jo jp jq ln js jt ju hm dt translated">对于每种类型的变量，都有默认的存储位置:</p><ul class=""><li id="4acc" class="lp lq ht iz b ja jb je jf ji lr jm ls jq lt ju lu lv lw lx dt translated">状态变量总是存储在存储器中。</li><li id="df73" class="lp lq ht iz b ja ly je lz ji ma jm mb jq mc ju lu lv lw lx dt translated">函数参数总是在内存中。</li><li id="c0f5" class="lp lq ht iz b ja ly je lz ji ma jm mb jq mc ju lu lv lw lx dt translated">默认情况下，结构、数组或映射类型引用的局部变量存储在存储中。</li><li id="125a" class="lp lq ht iz b ja ly je lz ji ma jm mb jq mc ju lu lv lw lx dt translated">值类型(uint、int等)的局部变量存储在堆栈中。</li></ul><p id="ce72" class="pw-post-body-paragraph ix iy ht iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju hm dt translated">让我们更深入地了解这一点，并理解与内存和存储相关的另一个重要概念！！！</p><figure class="me mf mg mh fq iu"><div class="bz el l di"><div class="mm mn l"/></div></figure><p id="7f34" class="pw-post-body-paragraph ix iy ht iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju hm dt translated"><strong class="iz hu">合同描述:</strong></p><ul class=""><li id="59c5" class="lp lq ht iz b ja jb je jf ji lr jm ls jq lt ju lu lv lw lx dt translated"><strong class="iz hu">契约变量</strong>:映射将键值对存储为用户Id和用户类型。<br/> <em class="lo">映射(uint = &gt; User)用户；</em></li><li id="69a3" class="lp lq ht iz b ja ly je lz ji ma jm mb jq mc ju lu lv lw lx dt translated"><strong class="iz hu">方法:</strong>以下是合同中的方法:</li></ul><p id="e9f1" class="pw-post-body-paragraph ix iy ht iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju hm dt translated">I. <strong class="iz hu"> addUser </strong>:以uint id，uint balance为参数，添加一个用户到映射中。</p><p id="5785" class="pw-post-body-paragraph ix iy ht iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju hm dt translated">二。<strong class="iz hu">update balance</strong>:<strong class="iz hu"/>以uint id，uint balance为参数，更新用户的余额。</p><p id="2dea" class="pw-post-body-paragraph ix iy ht iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju hm dt translated">三。<strong class="iz hu"> getBalance </strong>:以uint id为参数，返回用户的余额。</p><ul class=""><li id="5dcf" class="lp lq ht iz b ja jb je jf ji lr jm ls jq lt ju lu lv lw lx dt translated"><strong class="iz hu">调用合同方法</strong>:您可以在<a class="ae kf" href="http://remix.ethereum.org/#optimize=false&amp;version=soljson-v0.4.24+commit.e67f0147.js" rel="noopener ugc nofollow" target="_blank">在线混音IDE </a>中运行上述合同</li></ul><p id="f792" class="pw-post-body-paragraph ix iy ht iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju hm dt translated">I .通过调用带有参数的<strong class="iz hu"> addUser </strong>方法创建一个用户(id = 1，balance = 10)</p><p id="f4a2" class="pw-post-body-paragraph ix iy ht iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju hm dt translated">二。通过使用参数(id = 1且balance = 20)调用<strong class="iz hu"> updateBalance </strong>方法来更新用户的余额</p><ul class=""><li id="c8c5" class="lp lq ht iz b ja jb je jf ji lr jm ls jq lt ju lu lv lw lx dt translated"><strong class="iz hu">预期输出</strong>:通过带参数(id = 1)调用<strong class="iz hu"> getBalance </strong>方法得到用户的余额。你认为期望值是多少？猜猜看？是2 <strong class="iz hu"> 0还是10 </strong>为什么？🤔</li></ul><h1 id="aece" class="kl km ht bd kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li dt translated">输出是10而不是20。😯</h1><figure class="me mf mg mh fq iu fe ff paragraph-image"><div class="fe ff mo"><img src="../Images/a776f833240105f0d603f4540f7d2572.png" data-original-src="https://miro.medium.com/v2/resize:fit:1024/format:webp/1*ai7XZuVDZqtpxbbCzMqV_g.jpeg"/></div></figure><p id="4932" class="pw-post-body-paragraph ix iy ht iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju hm dt translated"><strong class="iz hu">解释:</strong>在solidity中，当存储类型变量被赋值给内存类型时，它会创建一个新的数据副本。如果对拷贝的数据进行了任何更新，它将不会反映在原始拷贝中。</p><p id="24b4" class="pw-post-body-paragraph ix iy ht iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju hm dt translated">你现在能猜出，你需要对<strong class="iz hu"> updateBalance </strong>方法做什么改变才能使它工作吗？🤔</p><p id="f2fe" class="pw-post-body-paragraph ix iy ht iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju hm dt translated">更改合同中的第17行。将存储位置从内存更改到存储不会创建新的数据副本，而是会创建一个指向存储的指针。因此，用户对象的任何变化都会反映在存储本身中。</p><p id="9712" class="pw-post-body-paragraph ix iy ht iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju hm dt translated"><em class="lo">用户</em> <strong class="iz hu"> <em class="lo">存储</em> </strong> <em class="lo">用户=用户【id】；</em></p><p id="4d0f" class="pw-post-body-paragraph ix iy ht iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju hm dt translated">答对了。！！你现在已经很好地理解了固态中的记忆和存储🙌</p><p id="0a9f" class="pw-post-body-paragraph ix iy ht iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju hm dt translated">在接下来的几篇文章中。我将解释EVM内部和默克尔Pertrica树。</p><p id="fa45" class="pw-post-body-paragraph ix iy ht iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju hm dt translated">快乐编码😇</p><p id="cd41" class="pw-post-body-paragraph ix iy ht iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju hm dt translated"><a class="ae kf" href="https://www.linkedin.com/in/jainsarvesh/" rel="noopener ugc nofollow" target="_blank">linkedin.com/in/jainsarvesh</a>T14<a class="ae kf" rel="noopener" href="/@sarvesh.sgsits">medium.com/@sarvesh.sgsits</a></p><blockquote class="jv"><p id="5b05" class="jw jx ht bd jy jz ka kb kc kd ke ju ek translated">加入Coinmonks <a class="ae kf" href="https://t.me/coincodecap" rel="noopener ugc nofollow" target="_blank">电报频道</a>和<a class="ae kf" href="https://www.youtube.com/c/coinmonks/videos" rel="noopener ugc nofollow" target="_blank"> Youtube频道</a>获取每日<a class="ae kf" href="http://coincodecap.com/" rel="noopener ugc nofollow" target="_blank">加密新闻</a></p></blockquote><h2 id="15d6" class="mp km ht bd kn mq mr ms kr mt mu mv kv ji mw mx kz jm my mz ld jq na nb lh nc dt translated">另外，阅读</h2><ul class=""><li id="20fb" class="lp lq ht iz b ja lj je lk ji nd jm ne jq nf ju lu lv lw lx dt translated"><a class="ae kf" rel="noopener" href="/coinmonks/top-10-crypto-copy-trading-platforms-for-beginners-d0c37c7d698c">复制交易</a> | <a class="ae kf" rel="noopener" href="/coinmonks/crypto-tax-software-ed4b4810e338">加密税务软件</a></li><li id="723e" class="lp lq ht iz b ja ly je lz ji ma jm mb jq mc ju lu lv lw lx dt translated"><a class="ae kf" href="https://coincodecap.com/grid-trading" rel="noopener ugc nofollow" target="_blank">网格交易</a> | <a class="ae kf" rel="noopener" href="/coinmonks/the-best-cryptocurrency-hardware-wallets-of-2020-e28b1c124069">加密硬件钱包</a></li><li id="874f" class="lp lq ht iz b ja ly je lz ji ma jm mb jq mc ju lu lv lw lx dt translated"><a class="ae kf" href="http://Top 4 Telegram Channels for Crypto Traders" rel="noopener ugc nofollow" target="_blank">密码电报信号</a> | <a class="ae kf" rel="noopener" href="/coinmonks/crypto-trading-bot-c2ffce8acb2a">密码交易机器人</a></li><li id="e1e8" class="lp lq ht iz b ja ly je lz ji ma jm mb jq mc ju lu lv lw lx dt translated"><a class="ae kf" href="https://coincodecap.com/bookmap-review-2021-best-trading-software" rel="noopener ugc nofollow" target="_blank"> Bookmap评论</a> | <a class="ae kf" href="https://coincodecap.com/crypto-exchange-usa" rel="noopener ugc nofollow" target="_blank">美国5大最佳加密交易所</a></li><li id="f5bb" class="lp lq ht iz b ja ly je lz ji ma jm mb jq mc ju lu lv lw lx dt translated"><a class="ae kf" href="https://coincodecap.com/ftx-futures-trading" rel="noopener ugc nofollow" target="_blank">如何在FTX交易所交易期货</a> | <a class="ae kf" href="https://coincodecap.com/okex-vs-binance" rel="noopener ugc nofollow" target="_blank"> OKEx vs币安</a></li><li id="719e" class="lp lq ht iz b ja ly je lz ji ma jm mb jq mc ju lu lv lw lx dt translated"><a class="ae kf" href="https://coincodecap.com/coinloan-review" rel="noopener ugc nofollow" target="_blank"> CoinLoan评论</a> | <a class="ae kf" rel="noopener" href="/coinmonks/youhodler-4-easy-ways-to-make-money-98969b9689f2"> YouHodler评论</a> | <a class="ae kf" href="https://coincodecap.com/blockfi-review" rel="noopener ugc nofollow" target="_blank"> BlockFi评论</a></li><li id="4ec1" class="lp lq ht iz b ja ly je lz ji ma jm mb jq mc ju lu lv lw lx dt translated"><a class="ae kf" href="https://coincodecap.com/profittradingapp-for-binance" rel="noopener ugc nofollow" target="_blank">XT.COM评论</a> | <a class="ae kf" href="https://coincodecap.com/xt-com-review" rel="noopener ugc nofollow" target="_blank">币安评论</a></li><li id="3bd4" class="lp lq ht iz b ja ly je lz ji ma jm mb jq mc ju lu lv lw lx dt translated"><a class="ae kf" href="https://coincodecap.com/smithbot-review" rel="noopener ugc nofollow" target="_blank"> SmithBot评论</a> | <a class="ae kf" href="https://coincodecap.com/free-open-source-trading-bots" rel="noopener ugc nofollow" target="_blank"> 4款最佳免费开源交易机器人</a></li><li id="f33b" class="lp lq ht iz b ja ly je lz ji ma jm mb jq mc ju lu lv lw lx dt translated"><a class="ae kf" rel="noopener" href="/coinmonks/crypto-exchange-dd2f9d6f3769">最佳加密交易所</a> | <a class="ae kf" rel="noopener" href="/coinmonks/bitcoin-exchange-in-india-7f1fe79715c9">印度最佳加密交易所</a></li><li id="47a8" class="lp lq ht iz b ja ly je lz ji ma jm mb jq mc ju lu lv lw lx dt translated"><a class="ae kf" rel="noopener" href="/coinmonks/best-crypto-apis-for-developers-5efe3a597a9f">开发人员的最佳加密API</a></li><li id="b359" class="lp lq ht iz b ja ly je lz ji ma jm mb jq mc ju lu lv lw lx dt translated">最佳<a class="ae kf" rel="noopener" href="/coinmonks/top-5-crypto-lending-platforms-in-2020-that-you-need-to-know-a1b675cec3fa">密码借贷平台</a></li><li id="9487" class="lp lq ht iz b ja ly je lz ji ma jm mb jq mc ju lu lv lw lx dt translated">杠杆代币的终极指南</li></ul></div></div>    
</body>
</html>