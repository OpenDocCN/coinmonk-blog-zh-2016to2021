<html>
<head>
<title>Perpetual Swaps in DeFi</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">DeFi中的永久互换</h1>
<blockquote>原文：<a href="https://medium.com/coinmonks/perpetual-swaps-in-defi-749997209ba3?source=collection_archive---------0-----------------------#2021-05-24">https://medium.com/coinmonks/perpetual-swaps-in-defi-749997209ba3?source=collection_archive---------0-----------------------#2021-05-24</a></blockquote><div><div class="ef hh hi hj hk hl"/><div class="hm hn ho hp hq"><figure class="hs ht fm fo hu hv fe ff paragraph-image"><div role="button" tabindex="0" class="hw hx di hy bf hz"><div class="fe ff hr"><img src="../Images/afd0d0fc643e43cab29f52e4469ee17e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0CJoa2Itl3GbC8DOH9meFA.png"/></div></div><figcaption class="ic id fg fe ff ie if bd b be z ek">Racing in Vail, Colorado. Source: Photo by Shichou.</figcaption></figure><div class=""/><div class=""><h2 id="41b7" class="pw-subtitle-paragraph jf ih ii bd b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw ek translated">哪种方法会赢得比赛？</h2></div><p id="6098" class="pw-post-body-paragraph jx jy ii jz b ka kb jj kc kd ke jm kf kg kh ki kj kk kl km kn ko kp kq kr ks hm dt translated">永久掉期以两种不同的形式出现在分散融资(DeFi)中。要么像他们的中央对手一样使用限价订单簿，要么使用自动做市商(AMM)方法。在本文中，我们回顾了当前的方法，并打赌哪种方法将在中期内胜出。</p><h1 id="b738" class="ku kv ii bd kw kx ky kz la lb lc ld le jo lf jp lg jr lh js li ju lj jv lk ll dt translated">1.介绍</h1><p id="96f4" class="pw-post-body-paragraph jx jy ii jz b ka lm jj kc kd ln jm kf kg lo ki kj kk lp km kn ko lq kq kr ks hm dt translated">永久掉期为投资者提供了一种简单的方式来获得资产的杠杆多头和空头敞口。该合约类似于传统的期货合约。BitMEX于2016年[ <a class="ae lr" href="https://www.bitmex.com/app/perpetualContractsGuide" rel="noopener ugc nofollow" target="_blank"> 1 </a> ]为BTCUSD推出了永久性掉期产品。德里比特、FTX、币安、OKEX等其它交易所此后也实施了永久交易。永久债券成为非常受欢迎的集中交易产品，并像其他产品一样，找到了进入DeFi的途径。</p><p id="2462" class="pw-post-body-paragraph jx jy ii jz b ka kb jj kc kd ke jm kf kg kh ki kj kk kl km kn ko kp kq kr ks hm dt translated">我们首先回顾永久掉期产品，然后回顾现货市场的自动做市商(AMMs)。</p><blockquote class="ls lt lu"><p id="aa28" class="jx jy kt jz b ka kb jj kc kd ke jm kf lv kh ki kj lw kl km kn lx kp kq kr ks hm dt translated">如果你熟悉传统的资产管理协议和永久互换，你可以跳到第二部分。</p></blockquote><h2 id="3498" class="ly kv ii bd kw lz ma mb la mc md me le kg mf mg lg kk mh mi li ko mj mk lk ml dt translated">什么是永久互换？</h2><p id="307d" class="pw-post-body-paragraph jx jy ii jz b ka lm jj kc kd ln jm kf kg lo ki kj kk lp km kn ko lq kq kr ks hm dt translated">假设我们在BTCUSD上有一个永久合同。交易者存放抵押品，可以进入多头或空头交易，并可以利用他们的交易。如果合约价格上涨1美元，无杠杆多头交易者赚1美元，如果价格下跌1美元，损失1美元。对于短期合同持有人来说，反之亦然。交易者也支付或接收<em class="kt">资金支付</em>，直到他们平仓。</p><p id="4453" class="pw-post-body-paragraph jx jy ii jz b ka kb jj kc kd ke jm kf kg kh ki kj kk kl km kn ko kp kq kr ks hm dt translated">对于传统期货，随着到期日的临近，其价格向现货价格移动。这是套利的结果(详见[ <a class="ae lr" href="https://www.investopedia.com/ask/answers/06/futuresconvergespot.asp" rel="noopener ugc nofollow" target="_blank"> 2 </a>)。与传统的期货不同，永久债券没有到期日。因此，需要有另一种机制将期货价格拉向现货价格。这个机制就是有<em class="kt">资金支付。如果永久价格高于现货价格，多头支付空头。这降低了产品的长期吸引力，导致长期合约需求的变化，推动价格向现货方向下跌。类似的，如果价格低于现货，空头支付多头，价格向上移动。实际合同规格见例如【<a class="ae lr" href="https://www.bitmex.com/app/perpetualContractsGuide" rel="noopener ugc nofollow" target="_blank"> 1 </a>和【<a class="ae lr" href="https://www.deribit.com/pages/docs/perpetual" rel="noopener ugc nofollow" target="_blank"> 3 </a>】。</em></p><h2 id="c311" class="ly kv ii bd kw lz ma mb la mc md me le kg mf mg lg kk mh mi li ko mj mk lk ml dt translated">自动做市商</h2><p id="f815" class="pw-post-body-paragraph jx jy ii jz b ka lm jj kc kd ln jm kf kg lo ki kj kk lp km kn ko lq kq kr ks hm dt translated">自动做市商(AMMs)出现于2017年Bancor协议，见[ <a class="ae lr" href="https://en.wikipedia.org/wiki/Bancor_(cryptocurrency)" rel="noopener ugc nofollow" target="_blank"> 5 </a> ]，旨在进行现货加密货币交易(相对于期货)。</p><p id="ad59" class="pw-post-body-paragraph jx jy ii jz b ka kb jj kc kd ke jm kf kg kh ki kj kk kl km kn ko kp kq kr ks hm dt translated">传统上，金融市场通过限价订单簿运行，做市商在其中填写买入和卖出<em class="kt">限价订单。</em>限价单是由买卖意向、价格和数量指定的。一个<em class="kt">市场订单</em>是由购买/销售意向和数量定义的。市价单通过将请求金额<em class="kt"> </em>与限价单簿中提供的最佳价格相匹配来执行。</p><p id="6324" class="pw-post-body-paragraph jx jy ii jz b ka kb jj kc kd ke jm kf kg kh ki kj kk kl km kn ko kp kq kr ks hm dt translated">AMMs抛弃限价指令簿，用“流动性提供者”(LPs)取代做市商(即下达限价指令的市场参与者)。有限合伙人存放代币，然后收取费用。通常他们的股份也有风险。与市场秩序类似的是“互换”代币。交换代币的价格由算法决定。例如，传统的<em class="kt"> Bancor型AMM </em>使用一个常数乘积函数:</p><p id="531c" class="pw-post-body-paragraph jx jy ii jz b ka kb jj kc kd ke jm kf kg kh ki kj kk kl km kn ko kp kq kr ks hm dt translated">①<em class="kt">x⋅y = c</em></p><p id="690c" class="pw-post-body-paragraph jx jy ii jz b ka kb jj kc kd ke jm kf kg kh ki kj kk kl km kn ko kp kq kr ks hm dt translated">其中，<em class="kt"> x </em>为第一枚硬币的金额，<em class="kt"> y </em>为第二枚硬币的金额(用同一种货币表示)，c为常数。当下注者投入更多代币时，传统上等量的两个硬币，<em class="kt"> x </em>和<em class="kt"> y </em>被更新，常数<em class="kt"> c </em>增加。当硬币被交换时，必须满足等式(1)。如果市场参与者交换了第一枚硬币的数量<em class="kt"> a </em>，他们收到的第二枚硬币的数量<em class="kt"> b </em>通过确保硬币数量的乘积保持不变来确定，因此对<em class="kt"> b </em>求解以下等式:</p><p id="7e72" class="pw-post-body-paragraph jx jy ii jz b ka kb jj kc kd ke jm kf kg kh ki kj kk kl km kn ko kp kq kr ks hm dt translated">(2) <em class="kt"> (x+a)(y-b) = c </em></p><p id="c0bb" class="pw-post-body-paragraph jx jy ii jz b ka kb jj kc kd ke jm kf kg kh ki kj kk kl km kn ko kp kq kr ks hm dt translated">如果赌注者存入硬币，常数<em class="kt"> c </em>变大，交易者面临的滑点就会减少，这意味着下大单时的价格与下小单时的价格不会相差太远。如果<em class="kt"> c </em>很大，价格是粘性的，套利者很难将价格转移到其他交易所交易的市场价格方向。在这种AMM式的情况下，赌注者面临“非永久性损失”的风险。我们不需要为了这篇文章而一头扎进无常的失落，但是详细的解释可以在这里找到[ <a class="ae lr" href="https://medium.datadriveninvestor.com/impermanent-loss-in-defi-the-risks-involved-in-providing-liquidity-67c54fdf1cfc" rel="noopener ugc nofollow" target="_blank"> 6 </a> ]。</p><p id="2401" class="pw-post-body-paragraph jx jy ii jz b ka kb jj kc kd ke jm kf kg kh ki kj kk kl km kn ko kp kq kr ks hm dt translated">除了Bancor之外，现货市场的AMM定价功能的其他值得注意的实现是<a class="ae lr" href="http://balancer.finance/whitepaper/" rel="noopener ugc nofollow" target="_blank">平衡器</a>，以及<a class="ae lr" href="https://uniswap.org/" rel="noopener ugc nofollow" target="_blank"> Uniswap </a>经历了不同AMM方法(v2、v2.1、v3等)的演变。).</p><h1 id="bb01" class="ku kv ii bd kw kx ky kz la lb lc ld le jo lf jp lg jr lh js li ju lj jv lk ll dt translated">2.AMM vs订单簿</h1><p id="0673" class="pw-post-body-paragraph jx jy ii jz b ka lm jj kc kd ln jm kf kg lo ki kj kk lp km kn ko lq kq kr ks hm dt translated">既然我们已经掌握了现货市场和永续产品的资产管理模型，我们就可以开始评估违约永续产品了。</p><figure class="mn mo mp mq fq hv fe ff paragraph-image"><div class="fe ff mm"><img src="../Images/6626f034efcb35ed3f331f543d14a01f.png" data-original-src="https://miro.medium.com/v2/resize:fit:612/format:webp/1*0ySIRrLoaO1o1pmLSbqQwQ.png"/></div><figcaption class="ic id fg fe ff ie if bd b be z ek"><em class="mr">Ready to start. </em>Source: <a class="ae lr" href="https://play.nintendo.com/news-tips/game-releases/mario-kart-tour-mobile-game-release-date/" rel="noopener ugc nofollow" target="_blank">Nintendo</a>.</figcaption></figure><p id="328d" class="pw-post-body-paragraph jx jy ii jz b ka kb jj kc kd ke jm kf kg kh ki kj kk kl km kn ko kp kq kr ks hm dt translated">在分散式交流中，“跑在前面”通常是一个需要注意的问题。例如，市场买入订单可以由快速交易者以较低的价格买入并以较高的价格卖出给慢速交易者。抢先交易成为区块链交易所的一个问题，因为交易在执行前会向验证者广播，通过更高的采矿费购买优先权或其他取决于区块链的技术，抢先交易是可能的。对于限价订单簿指数和基于AMM的指数来说，前期运作都是一个问题。参见[ <a class="ae lr" href="https://consensys.github.io/smart-contract-best-practices/known_attacks/#front-running" rel="noopener ugc nofollow" target="_blank"> 4 </a> ]可以很好的解释抢跑的问题。一些dex已经实施了隐藏交易的方法来解决这个问题。</p><p id="dca5" class="pw-post-body-paragraph jx jy ii jz b ka kb jj kc kd ke jm kf kg kh ki kj kk kl km kn ko kp kq kr ks hm dt translated">一般来说，给dex带来流动性是相当困难的。传统形式的AMM被认为是“资本低效的”，也就是说，与基于订单簿的模型相比，传统的AMM需要更多的资本来观察相同水平的滑点(=进行大额交易时价格恶化)。对传统AMMs“资本效率低下”的简短解释是，在基于订单簿的交易所中，做市商围绕市场价格下单，但在传统AMMs中，资金隐含在所有价格中。要更深入地了解这一讨论，请参见[ <a class="ae lr" href="https://blog.bancor.network/amplified-liquidity-designing-capital-efficient-automated-market-makers-in-bancor-v2-3cec8891c3a1" rel="noopener ugc nofollow" target="_blank"> 9 </a>。然而，维持资产管理公司的适当流动性水平更简单，因为这里的流动性供应是被动的。相反，对于基于订单簿的交易所，做市商需要在新信息到达时不断调整他们的订单。</p><ol class=""><li id="4f0d" class="ms mt ii jz b ka kb kd ke kg mu kk mv ko mw ks mx my mz na dt translated">正如我们将在本文中看到的，有<em class="kt">种资本高效的AMM永久互换方法</em></li><li id="5f03" class="ms mt ii jz b ka nb kd nc kg nd kk ne ko nf ks mx my mz na dt translated">资产管理系统用被动流动性提供者(LPs)取代了订单簿模型中主动做市商的功能。有限合伙人存放抵押品并在不主动发布限价单的情况下赚取费用。作者认为，与通过被动地从资本高效的AMM赚取费用的有限合伙人吸引足够的流动性相比，在订单模式下，通过活跃的做市商吸引足够的流动性可能更加困难</li><li id="c2df" class="ms mt ii jz b ka nb kd nc kg nd kk ne ko nf ks mx my mz na dt translated">限价订单也可以在基于AMM的DEX中执行，因此即使DEX想要提供限价订单，也不需要订单簿模型</li><li id="ca0a" class="ms mt ii jz b ka nb kd nc kg nd kk ne ko nf ks mx my mz na dt translated">构建DEX所基于的区块链需要能够通过订单簿模式(与AMM模式相反)处理更多的吞吐量</li></ol><p id="1733" class="pw-post-body-paragraph jx jy ii jz b ka kb jj kc kd ke jm kf kg kh ki kj kk kl km kn ko kp kq kr ks hm dt translated">出于这些原因，在当前的DeFi环境下，作者的赌注在于永久互换的<em class="kt"> AMM模型</em>,而不是订单簿模型。因此，以下各节专门讨论永久资产管理制度。</p><h1 id="da03" class="ku kv ii bd kw kx ky kz la lb lc ld le jo lf jp lg jr lh js li ju lj jv lk ll dt translated">3.永久互换的AMMs</h1><p id="50d4" class="pw-post-body-paragraph jx jy ii jz b ka lm jj kc kd ln jm kf kg lo ki kj kk lp km kn ko lq kq kr ks hm dt translated">使用AMM模型的著名永久互换项目有<strong class="jz ij"><em class="kt">F</em></strong><a class="ae lr" href="https://docs.futureswap.com/" rel="noopener ugc nofollow" target="_blank"><strong class="jz ij"><em class="kt">utureSwap</em></strong></a>、<strong class="jz ij"> <em class="kt">永久协议</em> </strong>和<strong class="jz ij"> <em class="kt"> MCDEX </em> </strong>。FutureSwap显然意识到秘密武器是定价功能，他们目前没有透露他们的确切方法。因此，在本文中，我们只剩下两个AMM来评估。</p><p id="280a" class="pw-post-body-paragraph jx jy ii jz b ka kb jj kc kd ke jm kf kg kh ki kj kk kl km kn ko kp kq kr ks hm dt translated">dex上基于订单簿的永久实现的例子有<a class="ae lr" href="https://dydx.exchange/" rel="noopener ugc nofollow" target="_blank"> dYdX </a>、<a class="ae lr" href="https://injectiveprotocol.com/" rel="noopener ugc nofollow" target="_blank">内射</a>和<a class="ae lr" href="https://leverj.io/" rel="noopener ugc nofollow" target="_blank"> Leverj </a>。</p><h2 id="bd42" class="ly kv ii bd kw lz ma mb la mc md me le kg mf mg lg kk mh mi li ko mj mk lk ml dt translated">3.1永久协议</h2><p id="b352" class="pw-post-body-paragraph jx jy ii jz b ka lm jj kc kd ln jm kf kg lo ki kj kk lp km kn ko lq kq kr ks hm dt translated"><a class="ae lr" href="https://docs.perp.fi/" rel="noopener ugc nofollow" target="_blank"> <strong class="jz ij">恒常协议</strong> </a> <strong class="jz ij"> </strong>使用恒常乘积函数，来确定价格，详见第1节:</p><figure class="mn mo mp mq fq hv fe ff paragraph-image"><div class="fe ff ng"><img src="../Images/e1d9e0af7beb94b05fd30be1b6ff2bd5.png" data-original-src="https://miro.medium.com/v2/resize:fit:178/format:webp/1*1dRKInGM_eNKwrldLpSUMQ.png"/></div><figcaption class="ic id fg fe ff ie if bd b be z ek"><strong class="bd nh">Equation 1</strong></figcaption></figure><p id="1605" class="pw-post-body-paragraph jx jy ii jz b ka kb jj kc kd ke jm kf kg kh ki kj kk kl km kn ko kp kq kr ks hm dt translated">其中<em class="kt"> x </em>是第一个代币的金额，<em class="kt"> y </em>是第二个代币的金额(用相同的货币表示)，并且<em class="kt"> c </em>是常数。关于永久价格如何确定的详细示例，请参见<a class="ae lr" rel="noopener" href="/perpetual-protocol/a-deep-dive-into-our-virtual-amm-vamm-40345c522eeb">【7】“永久AMM的深入探讨</a>”。附录A1列出了永久协议的关键要素，这些要素不是阅读本文其余部分的必要知识。</p><p id="2b4c" class="pw-post-body-paragraph jx jy ii jz b ka kb jj kc kd ke jm kf kg kh ki kj kk kl km kn ko kp kq kr ks hm dt translated">在现货市场(如Uniswap v1)，定价函数中的常数<em class="kt"> c </em>是下注多少代币的结果。在永久协议中，<em class="kt"> c </em>由治理(AMM操作符)设置。永久协议团队声明，随着时间的推移，他们希望朝着算法选择<em class="kt"> c </em>的方向发展。</p><p id="d4a5" class="pw-post-body-paragraph jx jy ii jz b ka kb jj kc kd ke jm kf kg kh ki kj kk kl km kn ko kp kq kr ks hm dt translated">如果<em class="kt"> c </em>选得太高，即使是非常大的交易也几乎没有滑点。这对交易者来说最初是好的，但是大额交易可能导致AMM的巨额净敞口，并使系统处于风险之中。抵押品可能会根据利益相关者的情绪和市场价格的变动而快速变化，然而，<em class="kt"> c </em>是由(缓慢的)治理设定的。因此，作者声称当前的永久协议定价方法与潜在风险不一致。</p><figure class="mn mo mp mq fq hv fe ff paragraph-image"><div class="fe ff ni"><img src="../Images/f3ef16a02fbcc578ee4178c1d81d7075.png" data-original-src="https://miro.medium.com/v2/resize:fit:546/format:webp/1*0jQ9QYwKyV6PqlaIao6IEQ.png"/></div><figcaption class="ic id fg fe ff ie if bd b be z ek">Know your risks. Source: <a class="ae lr" href="https://gigazine.net/gsc_news/en/20170717-mario-game-over-screens/" rel="noopener ugc nofollow" target="_blank">Gigazine.net</a></figcaption></figure><p id="3282" class="pw-post-body-paragraph jx jy ii jz b ka kb jj kc kd ke jm kf kg kh ki kj kk kl km kn ko kp kq kr ks hm dt translated">建立一个与AMM面临的风险挂钩的定价函数似乎是合理的。这就是MCDEX 在他们提议的定价方法中所尝试的。</p><h2 id="3bf8" class="ly kv ii bd kw lz ma mb la mc md me le kg mf mg lg kk mh mi li ko mj mk lk ml dt translated">3.2 MCDEX</h2><p id="44ee" class="pw-post-body-paragraph jx jy ii jz b ka lm jj kc kd ln jm kf kg lo ki kj kk lp km kn ko lq kq kr ks hm dt translated">截至2021年5月，<a class="ae lr" href="https://mcdex.io/" rel="noopener ugc nofollow" target="_blank"> MCDEX </a>正在开发其AMM的第3版，其白皮书已经发布，请参见[ <a class="ae lr" href="https://mcdexio.github.io/documents/en/Shared-Liquidity-AMM-of-MAI-PROTOCOL-v3.pdf" rel="noopener ugc nofollow" target="_blank"> 8 </a> ]。我们在这里使用这份白皮书作为参考。</p><blockquote class="ls lt lu"><p id="b0b1" class="jx jy kt jz b ka kb jj kc kd ke jm kf lv kh ki kj lw kl km kn lx kp kq kr ks hm dt translated">MCDEX的定价方法激励交易商减少AMM净敞口。</p></blockquote><p id="cdda" class="pw-post-body-paragraph jx jy ii jz b ka kb jj kc kd ke jm kf kg kh ki kj kk kl km kn ko kp kq kr ks hm dt translated"><strong class="jz ij"> <em class="kt">举例:</em> </strong> <em class="kt">如果多头敞口的交易者有26个ETH，空头敞口的交易者有20个ETH，则AMM的净敞口为-6个ETH。定价函数被定义为使得在这种情况下结束短期交易将具有比结束长期交易更有利的定价。</em></p><p id="1229" class="pw-post-body-paragraph jx jy ii jz b ka kb jj kc kd ke jm kf kg kh ki kj kk kl km kn ko kp kq kr ks hm dt translated">MCDEX共享不同市场的押记抵押品，例如，押记者在USDC提交抵押品以服务ETHUSDC和BTCUSDC市场，因此MCDEX对抵押品使用“池保证金”的名称。附录<em class="kt"> A1 </em>介绍了MCDEX AMM公司的关键要素，阅读本文并不需要了解这些要素。</p><h2 id="5894" class="ly kv ii bd kw lz ma mb la mc md me le kg mf mg lg kk mh mi li ko mj mk lk ml dt translated">MCDEX定价</h2><figure class="mn mo mp mq fq hv fe ff paragraph-image"><div class="fe ff nj"><img src="../Images/e18bc9f5c8a896b2bae3d70220942f40.png" data-original-src="https://miro.medium.com/v2/resize:fit:518/format:webp/1*QOs6fHDLy8KxL1w8SzI-Vw.png"/></div><figcaption class="ic id fg fe ff ie if bd b be z ek">How much? Source: <a class="ae lr" href="https://supermarioemulator.com/" rel="noopener ugc nofollow" target="_blank">Nintendo</a></figcaption></figure><p id="c129" class="pw-post-body-paragraph jx jy ii jz b ka kb jj kc kd ke jm kf kg kh ki kj kk kl km kn ko kp kq kr ks hm dt translated">MXDEX AMM的中间价<em class="kt"> P(mid) </em>定义如下。</p><figure class="mn mo mp mq fq hv fe ff paragraph-image"><div class="fe ff nk"><img src="../Images/bf8060d4e72d30b933c227dbd9e2b7e8.png" data-original-src="https://miro.medium.com/v2/resize:fit:860/format:webp/1*USTljyUNM5w0oO9tovM1zg.png"/></div><figcaption class="ic id fg fe ff ie if bd b be z ek"><strong class="bd nh">Equation 2</strong></figcaption></figure><p id="5f4e" class="pw-post-body-paragraph jx jy ii jz b ka kb jj kc kd ke jm kf kg kh ki kj kk kl km kn ko kp kq kr ks hm dt translated">其中<em class="kt"> P(idx)j </em>代表资产<em class="kt"> j </em>(如BTCUSD价格)<em class="kt">，</em>由<a class="ae lr" href="https://en.wikipedia.org/wiki/Blockchain_oracle" rel="noopener ugc nofollow" target="_blank"> oracle </a>，<em class="kt"> Nj </em>为资产<em class="kt"> j的AMM净风险敞口，β </em>为参数(&gt; 0)，而<em class="kt"> M </em>为称为<em class="kt">池保证金</em>的可用抵押品</p><p id="77d9" class="pw-post-body-paragraph jx jy ii jz b ka kb jj kc kd ke jm kf kg kh ki kj kk kl km kn ko kp kq kr ks hm dt translated">交易者为规模为<em class="kt"> n </em>的交易支付的<strong class="jz ij"> <em class="kt">填充价格</em> </strong>是通过对上述定价函数<em class="kt"> pj(N) </em>从<em class="kt"> Nj </em>到<em class="kt"> Nj+n </em>进行积分并将该积分除以<em class="kt"> n </em>来确定的。我们在<em class="kt">附录A3 </em>中详细展示了这一点。</p><p id="8086" class="pw-post-body-paragraph jx jy ii jz b ka kb jj kc kd ke jm kf kg kh ki kj kk kl km kn ko kp kq kr ks hm dt translated">当<em class="kt"> M → ∞ </em>时，填充价格接近指数价格。当<em class="kt"> M →0 </em>时，对于交易者来说，填充价格越来越偏离指数价格，偏离方向越来越不利(高滑点)。交易越大，滑点越高。与交易规模相比，池保证金越大，滑点越低。最后，滑移也可以通过选择参数<em class="kt">β</em>T50】0来控制。</p><h2 id="3178" class="ly kv ii bd kw lz ma mb la mc md me le kg mf mg lg kk mh mi li ko mj mk lk ml dt translated">潜入泳池边缘</h2><figure class="mn mo mp mq fq hv fe ff paragraph-image"><div class="fe ff nl"><img src="../Images/4d2d31691862f5fca8b08c8e645428c6.png" data-original-src="https://miro.medium.com/v2/resize:fit:284/format:webp/1*DAg6KMBi5ovai_bwwTvBKg.png"/></div><figcaption class="ic id fg fe ff ie if bd b be z ek">Diving. Source: <a class="ae lr" href="https://play.nintendo.com/news-tips/news/super-mario-maker-2-free-final-update-details/" rel="noopener ugc nofollow" target="_blank">Nintendo</a>.</figcaption></figure><p id="9c6f" class="pw-post-body-paragraph jx jy ii jz b ka kb jj kc kd ke jm kf kg kh ki kj kk kl km kn ko kp kq kr ks hm dt translated">定价公式(等式(2))考虑了相对于<strong class="jz ij">池保证金</strong> <em class="kt"> M </em>的交易量。</p><p id="268b" class="pw-post-body-paragraph jx jy ii jz b ka kb jj kc kd ke jm kf kg kh ki kj kk kl km kn ko kp kq kr ks hm dt translated">MCDEX将池保证金M定义为抵押品的价值，使用我们在平仓所有头寸时面临的填充价格，该价格是我们通过对交易金额整合定价函数而获得的。因此，我们对池裕度有如下定义:</p><figure class="mn mo mp mq fq hv fe ff paragraph-image"><div class="fe ff nm"><img src="../Images/7ce3e96b80f9c42c66e3ab2425c84097.png" data-original-src="https://miro.medium.com/v2/resize:fit:726/format:webp/1*eAiR5fyKwhkmAj8GHBXpGA.png"/></div><figcaption class="ic id fg fe ff ie if bd b be z ek"><strong class="bd nh">Equation 3</strong></figcaption></figure><p id="b7ae" class="pw-post-body-paragraph jx jy ii jz b ka kb jj kc kd ke jm kf kg kh ki kj kk kl km kn ko kp kq kr ks hm dt translated">其中<em class="kt"> Mc </em>等于所有未平仓头寸的担保品净值。对于感兴趣的读者，我们在附录<em class="kt"> A2、</em>中详细介绍了这一计算。然而，重点是交易者改变了<em class="kt"> M、</em>，而等式(1)假设了一个常数<em class="kt"> M </em>。</p><blockquote class="ls lt lu"><p id="fbfc" class="jx jy kt jz b ka kb jj kc kd ke jm kf lv kh ki kj lw kl km kn lx kp kq kr ks hm dt translated">因此，当交易者在一个订单中交易金额<em class="ii"> x </em>时，与在<em class="ii"> k </em>订单中交易金额<em class="ii"> x/k </em>时相比，交易者将面临不同的价格，假设在此期间指数价格没有变化。</p></blockquote><p id="8ecd" class="pw-post-body-paragraph jx jy ii jz b ka kb jj kc kd ke jm kf kg kh ki kj kk kl km kn ko kp kq kr ks hm dt translated">我们在<strong class="jz ij">图1 </strong>中说明了定价方法的这一特性。设置参数使得AMM是净多头(<em class="kt"> Nj=3，Mj=50，000美元，p(idx)=2000美元，β=0.05 </em>)，并且交易者进入名义2的多头交易。</p><ul class=""><li id="8cbc" class="ms mt ii jz b ka kb kd ke kg mu kk mv ko mw ks nn my mz na dt translated">AMM是净多头(Nj=3)，因此我们希望多头交易者进入市场，将AMM敞口归零。与此相一致，中间价低于指数价2000美元</li><li id="27bb" class="ms mt ii jz b ka nb kd nc kg nd kk ne ko nf ks nn my mz na dt translated">图1显示，如果多头交易者进行了许多小笔交易，他们得到的平均成交价格会比他们进行1笔交易时得到的好。</li></ul><p id="bc78" class="pw-post-body-paragraph jx jy ii jz b ka kb jj kc kd ke jm kf kg kh ki kj kk kl km kn ko kp kq kr ks hm dt translated"><strong class="jz ij">切蛋糕的时候多点蛋糕？</strong>如果交易者以许多订单结束交易，他们以AMM为代价获得了更好的执行价格。</p><figure class="mn mo mp mq fq hv fe ff paragraph-image"><div class="fe ff no"><img src="../Images/51ef1f74d09aaae2a86a9a1526dae2d8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1152/format:webp/1*XplpoQeElbVXsENoR-uzow.png"/></div><figcaption class="ic id fg fe ff ie if bd b be z ek"><strong class="bd nh">Figure 1: With the MCDEX pricing approach, the fill price for a given amount depends on the number of orders placed (all else equal).</strong></figcaption></figure><h1 id="40da" class="ku kv ii bd kw kx ky kz la lb lc ld le jo lf jp lg jr lh js li ju lj jv lk ll dt translated">4.结论</h1><p id="8b56" class="pw-post-body-paragraph jx jy ii jz b ka lm jj kc kd ln jm kf kg lo ki kj kk lp km kn ko lq kq kr ks hm dt translated">我们认为AMMs是DeFi永久掉期比基于订单簿的dex更有前途的模式。</p><p id="fed9" class="pw-post-body-paragraph jx jy ii jz b ka kb jj kc kd ke jm kf kg kh ki kj kk kl km kn ko kp kq kr ks hm dt translated"><em class="kt">永久协议</em>是DeFi永久协议的简单解决方案。其定价机制与该工具的潜在风险不一致。也就是说，AMM算子通过治理来控制滑移(常数<em class="kt"> c </em>)。如果抵押品可能太薄，<em class="kt"> c </em>应该更高，这样威尔士就不会将AMM置于风险之中。如果抵押品泛滥，c应该更低，以防止太多的滑动。永久协议的目标是通过算法确定<em class="kt"> c </em>，这将是解决这一风险的一个机会。</p><p id="93c3" class="pw-post-body-paragraph jx jy ii jz b ka kb jj kc kd ke jm kf kg kh ki kj kk kl km kn ko kp kq kr ks hm dt translated">MCDEX引入了一个定价函数，它包含了相对于当前抵押品的交易规模。结果，当交易变大时，滑点增加，相对小的交易滑点减少。</p><p id="e3ce" class="pw-post-body-paragraph jx jy ii jz b ka kb jj kc kd ke jm kf kg kh ki kj kk kl km kn ko kp kq kr ks hm dt translated">我们认为MCDEX的定价方法有改进的空间:</p><ol class=""><li id="460b" class="ms mt ii jz b ka kb kd ke kg mu kk mv ko mw ks mx my mz na dt translated">交易者在交易数量x时收到不同的执行价格，与交易数量x乘以数量x/k(其他条件相同)时相反。因此，精明的交易者可以在提高AMM风险的同时提高价格</li><li id="a3e4" class="ms mt ii jz b ka nb kd nc kg nd kk ne ko nf ks mx my mz na dt translated">随着AMM超额抵押的增加，池保证金的计算具有非直观的限制行为(详见附录A2)</li></ol><p id="c241" class="pw-post-body-paragraph jx jy ii jz b ka kb jj kc kd ke jm kf kg kh ki kj kk kl km kn ko kp kq kr ks hm dt translated">MCDEX很好地考虑了“违约瀑布”(谁承担了哪些损失，参见附录A1)。MCDEX不直接包含基础工具的价格波动。我们可以通过滑动参数间接引入波动性。也就是说，滑移参数<em class="kt"> β </em>可以为更高波动性的资产设置得更高。</p><p id="1745" class="pw-post-body-paragraph jx jy ii jz b ka kb jj kc kd ke jm kf kg kh ki kj kk kl km kn ko kp kq kr ks hm dt translated">在当前环境下，MCDEX的方法看起来是最有前途的。作者会把他的鸡蛋放在这个篮子里。🍳</p><p id="880b" class="pw-post-body-paragraph jx jy ii jz b ka kb jj kc kd ke jm kf kg kh ki kj kk kl km kn ko kp kq kr ks hm dt translated"><em class="kt">免责声明:在撰写本文时和可预见的将来，作者与本文中审查的项目没有任何关联、关联、授权、支持、投资或任何方式的联系。</em></p><h1 id="d64a" class="ku kv ii bd kw kx ky kz la lb lc ld le jo lf jp lg jr lh js li ju lj jv lk ll dt translated">参考</h1><p id="da86" class="pw-post-body-paragraph jx jy ii jz b ka lm jj kc kd ln jm kf kg lo ki kj kk lp km kn ko lq kq kr ks hm dt translated">[1]<a class="ae lr" href="https://www.bitmex.com/app/perpetualContractsGuide" rel="noopener ugc nofollow" target="_blank">https://www.bitmex.com/app/perpetualContractsGuide</a><br/>【2】<a class="ae lr" href="https://www.investopedia.com/ask/answers/06/futuresconvergespot.asp" rel="noopener ugc nofollow" target="_blank">https://www . investopedia . com/ask/answers/06/futuresconvergespot . ASP</a><br/>【3】<a class="ae lr" href="https://www.deribit.com/pages/docs/perpetual" rel="noopener ugc nofollow" target="_blank">https://www.deribit.com/pages/docs/perpetual</a><br/>【4】<a class="ae lr" href="https://consensys.github.io/smart-contract-best-practices/known_attacks/#front-running" rel="noopener ugc nofollow" target="_blank">https://consensys . github . io/smart-contract-best-practices/known _ attacks/# front-running</a><br/>【5】<a class="ae lr" href="https://en.wikipedia.org/wiki/Bancor_(cryptocurrency)" rel="noopener ugc nofollow" target="_blank">https://en . Wikipedia . org/wiki/Bancor</a></p><h1 id="d09d" class="ku kv ii bd kw kx ky kz la lb lc ld le jo lf jp lg jr lh js li ju lj jv lk ll dt translated">附录</h1><h2 id="a927" class="ly kv ii bd kw lz ma mb la mc md me le kg mf mg lg kk mh mi li ko mj mk lk ml dt translated">A.1永久议定书的关键要素</h2><p id="7319" class="pw-post-body-paragraph jx jy ii jz b ka lm jj kc kd ln jm kf kg lo ki kj kk lp km kn ko lq kq kr ks hm dt translated">《AMM永久议定书》的<strong class="jz ij">要素</strong>如下。</p><ul class=""><li id="8821" class="ms mt ii jz b ka kb kd ke kg mu kk mv ko mw ks nn my mz na dt translated">交易者在每个市场存入1个代币(如ETHDAI市场的DAI)作为抵押品</li><li id="85e2" class="ms mt ii jz b ka nb kd nc kg nd kk ne ko nf ks nn my mz na dt translated">指数价格来源于oracle，协议规定了<em class="kt">融资利率</em>(定义见第1节“什么是永久掉期”)，类似于集中交易，使用指数与AMM价格的时间加权平均值</li><li id="ca89" class="ms mt ii jz b ka nb kd nc kg nd kk ne ko nf ks nn my mz na dt translated">在存入<em class="kt"> a </em>代币(如戴)并设置杠杆<em class="kt"> L </em>后，交易者被常数乘积函数赋予另一代币(如ETH)的数量<em class="kt"> b </em>，从而在<em class="kt">(</em>中求解<em class="kt"> b </em></li><li id="9302" class="ms mt ii jz b ka nb kd nc kg nd kk ne ko nf ks nn my mz na dt translated">在这个阶段，不需要桩。然而，如果价格大幅上涨，保证金可能会被超过，将没有足够的资金支付对手。因此，永久协议将交易费用集中到一个默认基金中，在这种情况下将被标记。如果这些资金仍然不够，赌注基金被用来弥补AMM的损失。</li></ul><p id="5967" class="pw-post-body-paragraph jx jy ii jz b ka kb jj kc kd ke jm kf kg kh ki kj kk kl km kn ko kp kq kr ks hm dt translated">MCDEX AMM v3的<strong class="jz ij">关键元素</strong>如下。</p><ul class=""><li id="87fe" class="ms mt ii jz b ka kb kd ke kg mu kk mv ko mw ks nn my mz na dt translated">交易员存入1个令牌，作为DEX上<em class="kt">多重</em>永久掉期市场的抵押品。这有时也被称为<em class="kt">共享流动性池</em>。在V3中，ETHUSDC的担保品是USDC，但在以前的版本中是ETH</li><li id="064d" class="ms mt ii jz b ka nb kd nc kg nd kk ne ko nf ks nn my mz na dt translated">指数价格来源于oracle，协议规定给定市场(如ETHUSDC)的<em class="kt">融资利率</em>为AMM净风险敞口与该市场抵押品比率的函数</li><li id="e565" class="ms mt ii jz b ka nb kd nc kg nd kk ne ko nf ks nn my mz na dt translated">交易者存入USDC，设定杠杆，做多或做空。定价激励交易者降低AMM风险。定价是交易后AMM净风险敞口与该市场的抵押品之比的函数。定价还包括最小的买卖差价，如果交易方向降低了AMM敞口，就会得到更有利的价格</li><li id="09d0" class="ms mt ii jz b ka nb kd nc kg nd kk ne ko nf ks nn my mz na dt translated">与永久协议类似，如果保证金抵押品不足，赌注者将分担损失，MCDEX还保留一笔违约基金。MCDEX实施了进一步的措施，作为AMM失败的风险缓解措施:(1)对流动性提供者的提款罚款，以及(2)AMM敞口的上限，超过该上限就不能再进行该方向的交易。“默认瀑布”(损失如何分担)定义得很好。</li></ul><h2 id="7c39" class="ly kv ii bd kw lz ma mb la mc md me le kg mf mg lg kk mh mi li ko mj mk lk ml dt translated">A.2 .池保证金的计算</h2><h2 id="eb38" class="ly kv ii bd kw lz ma mb la mc md me le kg mf mg lg kk mh mi li ko mj mk lk ml dt translated">池边缘</h2><p id="ee25" class="pw-post-body-paragraph jx jy ii jz b ka lm jj kc kd ln jm kf kg lo ki kj kk lp km kn ko lq kq kr ks hm dt translated">为了理解池保证金<em class="kt"> M </em>，我们首先检查单个交易者<em class="kt"> i </em>的净保证金。交易者进入头寸的瞬间，交易者<em class="kt"> i </em>的担保物价值<em class="kt"> Mc </em>通过减去填充价格和数量进行调整:</p><figure class="mn mo mp mq fq hv fe ff paragraph-image"><div class="fe ff np"><img src="../Images/0b13bf09d81b5910f7aec378d69d8ea9.png" data-original-src="https://miro.medium.com/v2/resize:fit:556/format:webp/1*f-35OklEsVYWLc__zh-Wuw.png"/></div><figcaption class="ic id fg fe ff ie if bd b be z ek"><strong class="bd nh">Equation A1</strong></figcaption></figure><p id="533e" class="pw-post-body-paragraph jx jy ii jz b ka kb jj kc kd ke jm kf kg kh ki kj kk kl km kn ko kp kq kr ks hm dt translated">其中<em class="kt"> Ni </em>是交易者<em class="kt"> i </em>的成交名义(如1 ETH)，而<em class="kt"> Po </em>是成交价格。调整后的抵押品<em class="kt"> Mc </em>可用于计算交易者的保证金余额<em class="kt"> Mb </em>:</p><figure class="mn mo mp mq fq hv fe ff paragraph-image"><div class="fe ff nq"><img src="../Images/e2747419ed9ac6b9d82283a17a2cc02d.png" data-original-src="https://miro.medium.com/v2/resize:fit:548/format:webp/1*UaqL4xDWpuiLZvw4-ISCQg.png"/></div><figcaption class="ic id fg fe ff ie if bd b be z ek"><strong class="bd nh">Equation A2</strong></figcaption></figure><p id="f9c3" class="pw-post-body-paragraph jx jy ii jz b ka kb jj kc kd ke jm kf kg kh ki kj kk kl km kn ko kp kq kr ks hm dt translated">其中<em class="kt"> Pt </em>为当前价格。准确地说，价格<em class="kt"> Pt </em>是交易者收到的成交价格。下面的例子应该有助于理解等式(A1)和(A2)。</p><p id="33f3" class="pw-post-body-paragraph jx jy ii jz b ka kb jj kc kd ke jm kf kg kh ki kj kk kl km kn ko kp kq kr ks hm dt translated"><strong class="jz ij"> <em class="kt">例</em> </strong> <em class="kt">:如果交易者在Po=4000美元做空1 ETH (N=-1)，现金Mc=1000美元，根据等式(A1)，Mc设置为5000 (=1000+4000)。使用等式(A2)，我们看到Mb的结果是1000美元(= 5000–4000)，这是因为价格没有变化，因此交易值为0，因此保证金等于存入的现金。现在，如果价格涨到4100美元，做空的交易者损失100美元，我们用等式(A2)得到Mb = 900(= 5000–4100)。</em></p><p id="1f93" class="pw-post-body-paragraph jx jy ii jz b ka kb jj kc kd ke jm kf kg kh ki kj kk kl km kn ko kp kq kr ks hm dt translated">既然我们理解了等式(A1)和(A2 ),我们可以处理AMM曝光。首先，我们将<em class="kt"> Mc </em>(没有指数<em class="kt"> i </em>)定义为所有交易者和所有流动性提供者存入的现金量，减去他们在等式(A1)中的输入量。然后，类似于等式(A2)，我们通过将每个市场1，…，K的当前AMM价格乘以名义价格与<em class="kt"> Mc </em>相加，获得AMM抵押品，称为<em class="kt">池保证金</em>。对于价格，MCDEX计算实际填充价格，因此，我们通过将定价函数从0整合到其名义<em class="kt"> Nj </em>来获得风险敞口:</p><figure class="mn mo mp mq fq hv fe ff paragraph-image"><div class="fe ff nr"><img src="../Images/5ab1e93a46cb1282ce29c7af7deb8aab.png" data-original-src="https://miro.medium.com/v2/resize:fit:802/format:webp/1*rceRU7JLF-HZwAfLKCSZxA.png"/></div><figcaption class="ic id fg fe ff ie if bd b be z ek"><strong class="bd nh">Equation A3</strong></figcaption></figure><p id="3f22" class="pw-post-body-paragraph jx jy ii jz b ka kb jj kc kd ke jm kf kg kh ki kj kk kl km kn ko kp kq kr ks hm dt translated">其中<em class="kt"> pj(n) </em>是在等式(2)中找到的定价函数。</p><p id="9c78" class="pw-post-body-paragraph jx jy ii jz b ka kb jj kc kd ke jm kf kg kh ki kj kk kl km kn ko kp kq kr ks hm dt translated">定价函数，方程(2)，也依赖于<em class="kt"> M </em>，并且求解方程(A3)得到一个二次方程。二次性质意味着存在一些裕度水平，在这些裕度水平上没有对<em class="kt"> M </em>的实值解，否则有两个解。<em class="kt"> M </em>的最终解决方案如下。</p><figure class="mn mo mp mq fq hv fe ff paragraph-image"><div class="fe ff ns"><img src="../Images/2ab70d4aaa4f00becd05b97edd423126.png" data-original-src="https://miro.medium.com/v2/resize:fit:624/format:webp/1*ZYvrgveWR5XeQuNqfEJVOw.png"/></div><figcaption class="ic id fg fe ff ie if bd b be z ek"><strong class="bd nh">Equation A4</strong></figcaption></figure><p id="8765" class="pw-post-body-paragraph jx jy ii jz b ka kb jj kc kd ke jm kf kg kh ki kj kk kl km kn ko kp kq kr ks hm dt translated">其中<em class="kt"> β </em>是滑点参数，<em class="kt"> Pj(idx) </em>指数价格，<em class="kt"> Nj </em>市场j的AMM净敞口。<strong class="jz ij">我们看到，如果填充价格是指数价格，则<em class="kt"> Mb </em>对应于可用的抵押品。</strong>从第一个和第二个等式中，我们看到，如果δ= Mb，则<em class="kt"> Mb=Mc </em>，这是所有AMM净敞口<em class="kt"> Nj </em>都为零的情况。与<em class="kt"> Mb </em>相比，AMM净暴露越高(负或正)，δ越小，M 越低。不那么直观的是，当指数价格上升时，AMM是正的，因此有更好的担保。在δ变为负值之前，AMM停止提供流动性。因此，池余量将在范围<em class="kt"> [0.5 Mb，Mb]内结束。</em></p><h1 id="e4c1" class="ku kv ii bd kw kx ky kz la lb lc ld le jo lf jp lg jr lh js li ju lj jv lk ll dt translated">A.3 .定价</h1><p id="d676" class="pw-post-body-paragraph jx jy ii jz b ka lm jj kc kd ln jm kf kg lo ki kj kk lp km kn ko lq kq kr ks hm dt translated">通过对定价函数积分，我们得到产品<em class="kt"> j </em>交易量<em class="kt"> δ </em>时的填充价格，等式(2):</p><figure class="mn mo mp mq fq hv fe ff paragraph-image"><div class="fe ff nt"><img src="../Images/3c7ce5fe17409e6dfbf68953f6135f7e.png" data-original-src="https://miro.medium.com/v2/resize:fit:318/format:webp/1*yH_jvswzv7Up5f9T1KCWHw.png"/></div><figcaption class="ic id fg fe ff ie if bd b be z ek"><strong class="bd nh">Equation A5</strong></figcaption></figure><p id="ba30" class="pw-post-body-paragraph jx jy ii jz b ka kb jj kc kd ke jm kf kg kh ki kj kk kl km kn ko kp kq kr ks hm dt translated">其中n2 := Nj -δ是交易后的AMM名义值。我们求解积分如下。</p><figure class="mn mo mp mq fq hv fe ff paragraph-image"><div class="fe ff nu"><img src="../Images/bb43bc01576ad957a8310649e9e2f25d.png" data-original-src="https://miro.medium.com/v2/resize:fit:948/format:webp/1*nj4klItpLA2Ss-a4CQz5WQ.png"/></div><figcaption class="ic id fg fe ff ie if bd b be z ek"><strong class="bd nh">Equation A6</strong></figcaption></figure></div></div>    
</body>
</html>