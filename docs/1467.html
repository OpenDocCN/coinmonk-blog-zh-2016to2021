<html>
<head>
<title>Integrating physical devices with IOTA — The IOTA debit card, Part 2</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">将物理设备与IOTA集成—IOTA借记卡，第2部分</h1>
<blockquote>原文：<a href="https://medium.com/coinmonks/integrating-physical-devices-with-iota-the-iota-debit-card-part-2-1f073060ae1d?source=collection_archive---------3-----------------------#2018-09-06">https://medium.com/coinmonks/integrating-physical-devices-with-iota-the-iota-debit-card-part-2-1f073060ae1d?source=collection_archive---------3-----------------------#2018-09-06</a></blockquote><div><div class="ef hh hi hj hk hl"/><div class="hm hn ho hp hq"><div class=""/><p id="be28" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">关于将物理设备与IOTA协议集成的初学者教程系列的第7部分。</p><figure class="jp jq jr js fq jt fe ff paragraph-image"><div role="button" tabindex="0" class="ju jv di jw bf jx"><div class="fe ff jo"><img src="../Images/793768c999d51ac5dfae6dc53f1113d6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*k7Js1ZqZpAooZ9X6m5x7rw.jpeg"/></div></div></figure></div><div class="ab cl ka kb hb kc" role="separator"><span class="kd bw bk ke kf kg"/><span class="kd bw bk ke kf kg"/><span class="kd bw bk ke kf"/></div><div class="hm hn ho hp hq"><h1 id="4539" class="kh ki ht bd kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le dt translated">介绍</h1><p id="24f9" class="pw-post-body-paragraph iq ir ht is b it lf iv iw ix lg iz ja jb lh jd je jf li jh ji jj lj jl jm jn hm dt translated">这是初学者教程系列的第7部分，我们将探索如何将物理设备与IOTA协议相集成。本教程是系列教程的第二部分，我们将尝试用基于IOTA的解决方案复制传统的基于fiat的借记卡支付解决方案。在第二个教程中，我们将构建一个简单的LED电路来代表物理设备，它将允许我们使用新的IOTA借记卡来支付其服务。</p></div><div class="ab cl ka kb hb kc" role="separator"><span class="kd bw bk ke kf kg"/><span class="kd bw bk ke kf kg"/><span class="kd bw bk ke kf"/></div><div class="hm hn ho hp hq"><h1 id="908c" class="kh ki ht bd kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le dt translated">使用案例</h1><p id="3423" class="pw-post-body-paragraph iq ir ht is b it lf iv iw ix lg iz ja jb lh jd je jf li jh ji jj lj jl jm jn hm dt translated">现在，我们已经配置了新的IOTA借记卡，并按照<a class="ae lk" rel="noopener" href="/coinmonks/integrating-physical-devices-with-iota-the-iota-debit-card-part-1-42dc1a05f18">之前的教程</a>中所述准备就绪，我们将把注意力转移到如何使用该卡支付服务上。在<a class="ae lk" rel="noopener" href="/coinmonks/integrating-physical-devices-with-iota-the-iota-debit-card-part-1-42dc1a05f18">之前的教程</a>中，我使用接待处的咖啡机和游泳池储物柜作为我们可以集成新的IOTA借记支付解决方案的例子。但老实说，像这样的支付解决方案可能会集成到任何接受支付服务的机器或设备中，如自动售货机、老虎机、停车计时器或来自<a class="ae lk" rel="noopener" href="/coinmonks/integrating-physical-devices-with-iota-83f4e00cc5bb">第一教程</a>的酒店房间冰箱。为什么就此打住？客人甚至可以使用他的IOTA借记卡来支付酒店餐厅的晚餐或酒店礼品店的商品，防止酒店所有者被Visa或任何其他第三方支付提供商收取额外的费用。可能性基本上是无穷无尽的。</p><p id="f6b4" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">我们将使用第一篇教程<a class="ae lk" rel="noopener" href="/coinmonks/integrating-physical-devices-with-iota-83f4e00cc5bb">中LED供电电路的简化版本</a>来代表本教程中的器件。本教程的主要目的是使用我们的IOTA借记卡发送有价值的交易，因此我们将从第<a class="ae lk" rel="noopener" href="/coinmonks/integrating-physical-devices-with-iota-83f4e00cc5bb">篇教程</a>中删除任何不需要的组件、连线和编码，因为不需要这样做来表达这一点。</p></div><div class="ab cl ka kb hb kc" role="separator"><span class="kd bw bk ke kf kg"/><span class="kd bw bk ke kf kg"/><span class="kd bw bk ke kf"/></div><div class="hm hn ho hp hq"><h1 id="13f0" class="kh ki ht bd kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le dt translated">关于价值交易</h1><p id="198c" class="pw-post-body-paragraph iq ir ht is b it lf iv iw ix lg iz ja jb lh jd je jf li jh ji jj lj jl jm jn hm dt translated">价值事务是在IOTA地址之间传送IOTA令牌IOTA事务，这与我们向tangle发送非价值事务的<a class="ae lk" rel="noopener" href="/coinmonks/integrating-physical-devices-with-iota-using-rfid-with-iota-868c15e0a040">教程5 </a>相反。典型的价值交易实际上由打包在<em class="ll">包</em>中的多个交易组成。<em class="ll">捆绑包</em>由3种交易类型组成:</p><ol class=""><li id="1b28" class="lm ln ht is b it iu ix iy jb lo jf lp jj lq jn lr ls lt lu dt translated">输入从发件人地址中扣除金额的负值交易</li><li id="4689" class="lm ln ht is b it lv ix lw jb lx jf ly jj lz jn lr ls lt lu dt translated">输出TXs <br/>正值交易，为接收方地址增值</li><li id="4207" class="lm ln ht is b it lv ix lw jb lx jf ly jj lz jn lr ls lt lu dt translated">未用交易<br/>将剩余金额从发送方地址转移到新的发送方地址的零和交易。这些交易的目的是防止将来从已经使用的发件人地址消费。</li></ol><p id="b15c" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">虽然这听起来相当复杂，但好消息是我们不必担心设置包的复杂性，这将由PyOTA库来处理。</p><p id="0cdc" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated"><em class="ll">注意！<br/>注意，当束中的所有事务都被执行时，现有IOTA的总量不变，只有IOTA令牌的所有权地址发生了变化。这当然是IOTA协议的基本属性，必须一直执行。</em></p></div><div class="ab cl ka kb hb kc" role="separator"><span class="kd bw bk ke kf kg"/><span class="kd bw bk ke kf kg"/><span class="kd bw bk ke kf"/></div><div class="hm hn ho hp hq"><h1 id="37c3" class="kh ki ht bd kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le dt translated">为项目布线</h1><p id="4f65" class="pw-post-body-paragraph iq ir ht is b it lf iv iw ix lg iz ja jb lh jd je jf li jh ji jj lj jl jm jn hm dt translated">接下来，让我们看一下项目的布线。如前所述，本教程的电路将是第一个教程<a class="ae lk" rel="noopener" href="/coinmonks/integrating-physical-devices-with-iota-83f4e00cc5bb">中使用的电路的简化版本。我将从电路中移除继电器和电池，因为它们不需要演示我们在本教程中试图提出的观点。如果你想将它们包含在你的项目版本中，这是可以的。不管有没有它们，Python代码都可以很好地工作。</a></p><p id="581b" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">如果您尚未设置MFRC522 RFID读写器，请参见<a class="ae lk" rel="noopener" href="/coinmonks/integrating-physical-devices-with-iota-using-rfid-with-iota-868c15e0a040">教程5 </a>了解如何设置。</p><p id="25ca" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">有关连接LED的信息，请参见<a class="ae lk" rel="noopener" href="/coinmonks/integrating-physical-devices-with-iota-83f4e00cc5bb">教程1 </a>。如果你想像我写这篇教程时那样简化LED电路，你可以跳过继电器和电池，直接将LED连接到Raspberry PI GIO引脚。请注意，电路中仍然需要电阻器，否则可能会过载并损坏LED。</p><figure class="jp jq jr js fq jt fe ff paragraph-image"><div role="button" tabindex="0" class="ju jv di jw bf jx"><div class="fe ff ma"><img src="../Images/16b8d8fce571dc254eebae1211f4d5a1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fPYX6gMhhf_GO9AaZwN64g.png"/></div></div></figure><p id="0fc2" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated"><em class="ll">注意！<br/>由于第一个教程中用于接地的引脚6现在被MFRC522占用，我选择使用引脚9作为LED的接地。如果使用试验板，也可以将MFRC522和LED的地连接到试验板上的公共地。</em></p><figure class="jp jq jr js fq jt fe ff paragraph-image"><div class="fe ff mb"><img src="../Images/31470ba708779176d37e10ad76b6c5f7.png" data-original-src="https://miro.medium.com/v2/resize:fit:734/format:webp/1*LyZnkPjYofggUfFNcGhzlg.png"/></div><figcaption class="mc md fg fe ff me mf bd b be z ek">Raspberry PI pin layout</figcaption></figure></div><div class="ab cl ka kb hb kc" role="separator"><span class="kd bw bk ke kf kg"/><span class="kd bw bk ke kf kg"/><span class="kd bw bk ke kf"/></div><div class="hm hn ho hp hq"><h1 id="df38" class="kh ki ht bd kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le dt translated">Python代码</h1><p id="f0b6" class="pw-post-body-paragraph iq ir ht is b it lf iv iw ix lg iz ja jb lh jd je jf li jh ji jj lj jl jm jn hm dt translated">本教程的主要目的是使用我们的IOTA借记卡来支付物理设备的服务。在我的例子中，服务由一个闪烁的LED组成。在我们开始编码之前，让我们快速浏览一下代码背后的逻辑以及它是如何工作的。</p><ol class=""><li id="da1c" class="lm ln ht is b it iu ix iy jb lo jf lp jj lq jn lr ls lt lu dt translated">python脚本首先检查接收者(酒店所有者)地址的余额，这样我们就有了一个基线来监控新的支付何时被添加到该地址。</li><li id="6544" class="lm ln ht is b it lv ix lw jb lx jf ly jj lz jn lr ls lt lu dt translated">接下来，python脚本显示了一条欢迎消息，其中将询问您想要购买多少次“眨眼”。在我的示例中，我将价格设置为1 IOTA，持续闪烁1次。</li><li id="6255" class="lm ln ht is b it lv ix lw jb lx jf ly jj lz jn lr ls lt lu dt translated">接下来，你将被要求持有你的IOTA借记卡靠近RFID阅读器。<br/>一旦RFID读取器检测到卡，Python脚本将从卡中读取IOTA种子。</li><li id="b14d" class="lm ln ht is b it lv ix lw jb lx jf ly jj lz jn lr ls lt lu dt translated">接下来，我们会检查借记卡种子上是否有足够的资金来支付您订购的闪烁次数。</li><li id="d7cc" class="lm ln ht is b it lv ix lw jb lx jf ly jj lz jn lr ls lt lu dt translated">如果资金是确定的，我们定义一个新的交易，然后再把它发送到Tangle。</li><li id="419e" class="lm ln ht is b it lv ix lw jb lx jf ly jj lz jn lr ls lt lu dt translated">接下来，我们开始监控接收者(酒店所有者)地址余额，以查看是否有任何新的资金被添加。意思是，如果来自前一步的交易已被确认。</li><li id="1d94" class="lm ln ht is b it lv ix lw jb lx jf ly jj lz jn lr ls lt lu dt translated">最后，当交易已被确认时，我们闪烁LED的订购次数。</li></ol><p id="b585" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated"><em class="ll">注意！<br/>如果您遵循本系列中之前的教程，您将会意识到地址重用问题，当酒店所有者想要从收集LED闪烁代币的接收者地址花费任何资金时，将会发生该问题。在</em> <a class="ae lk" rel="noopener" href="/coinmonks/integrating-physical-devices-with-iota-price-and-addresses-4f352e321cbb"> <em class="ll">教程4 </em> </a> <em class="ll">中，我们使用带有二维码的LCD显示器作为使用户能够使用他的移动IOTA钱包进行支付的便利方式来解决地址重用问题。现在我们使用我们的IOTA借记卡来进行支付，用户不需要知道什么接收地址正被用于支付LED，这可以全部在幕后管理。如果要针对本项目中的地址重用问题实现解决方案，使用与我们在</em> <a class="ae lk" rel="noopener" href="/coinmonks/integrating-physical-devices-with-iota-price-and-addresses-4f352e321cbb"> <em class="ll">教程4 </em> </a> <em class="ll">中所做的方法类似的方法，不用LCD。</em></p><figure class="jp jq jr js fq jt"><div class="bz el l di"><div class="mg mh l"/></div></figure><p id="1bcf" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">你可以从<a class="ae lk" href="https://gist.github.com/huggre/71c6aadb4e4e3d37018dc3acee5a17a0" rel="noopener ugc nofollow" target="_blank">这里</a>下载源代码</p><h1 id="d204" class="kh ki ht bd kj kk mi km kn ko mj kq kr ks mk ku kv kw ml ky kz la mm lc ld le dt translated">运营项目</h1><p id="f980" class="pw-post-body-paragraph iq ir ht is b it lf iv iw ix lg iz ja jb lh jd je jf li jh ji jj lj jl jm jn hm dt translated">要运行该项目，首先需要将上一节中的代码作为文本文件保存在安装MFR 522-python库的同一文件夹中。</p><p id="eea6" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">请注意，Python程序文件使用。py扩展，所以让我们将该文件保存为覆盆子PI上的<strong class="is hu"><em class="ll">iota _ debit _ card _ pay . py</em></strong>。</p><p id="56df" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">要执行该程序，只需启动一个新的终端窗口，导航到保存<em class="ll"> iota_debit_card_pay.py </em>的文件夹，然后键入:</p><p id="1af1" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated"><strong class="is hu">python _借记卡_pay.py </strong></p><p id="c7f1" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">现在，您应该可以在终端窗口中看到正在执行的代码，其中询问您要购买的闪烁次数。</p></div><div class="ab cl ka kb hb kc" role="separator"><span class="kd bw bk ke kf kg"/><span class="kd bw bk ke kf kg"/><span class="kd bw bk ke kf"/></div><div class="hm hn ho hp hq"><h1 id="fa13" class="kh ki ht bd kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le dt translated">对上一个教程的改进</h1><p id="a00e" class="pw-post-body-paragraph iq ir ht is b it lf iv iw ix lg iz ja jb lh jd je jf li jh ji jj lj jl jm jn hm dt translated">既然我们已经对如何使用PyOTA创建价值交易有了基本的了解，那么在前面的教程中添加一个新选项应该是非常简单的，它将允许我们将资金从酒店所有者种子转移到借记卡种子。您可能还记得，我们具有生成新地址的功能，该地址将在向IOTA借记卡转移新资金时使用。现在，这只是一个扭转本教程中使用的支付过程的问题。我们不是将价值交易从IOTA借记卡种子发送到酒店所有者地址，而是将价值交易从酒店所有者种子发送到IOTA借记卡地址。在<a class="ae lk" rel="noopener" href="/coinmonks/integrating-physical-devices-with-iota-the-iota-debit-card-part-1-42dc1a05f18">上一篇教程</a>的代码中实现这个特性应该是一个很好的学习练习，我会把它留给读者。</p></div><div class="ab cl ka kb hb kc" role="separator"><span class="kd bw bk ke kf kg"/><span class="kd bw bk ke kf kg"/><span class="kd bw bk ke kf"/></div><div class="hm hn ho hp hq"><h1 id="1e48" class="kh ki ht bd kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le dt translated">接下来是什么？</h1><p id="7f60" class="pw-post-body-paragraph iq ir ht is b it lf iv iw ix lg iz ja jb lh jd je jf li jh ji jj lj jl jm jn hm dt translated">您可能已经注意到，使用IOTA借记卡付款时，您不需要任何授权或凭证。虽然在某些用例中这可能是好的，但是在其他用例中这可能是不可接受的。想象一下，如果你丢失了你的IOTA借记卡，而它被一个坏演员捡到了。没有任何保护机制，就没有什么可以阻止他使用你的卡。在下一个教程中，我们将通过为我们的IOTA借记卡实现PIN码授权机制来解决这个问题。敬请关注…</p><p id="5591" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">你可以在这里找到这个系列下一个教程的链接<a class="ae lk" rel="noopener" href="/coinmonks/integrating-physical-devices-with-iota-the-iota-debit-card-part-3-bc0f03b8b2c9"/></p></div><div class="ab cl ka kb hb kc" role="separator"><span class="kd bw bk ke kf kg"/><span class="kd bw bk ke kf kg"/><span class="kd bw bk ke kf"/></div><div class="hm hn ho hp hq"><h1 id="dd3a" class="kh ki ht bd kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le dt translated">贡献</h1><p id="1d06" class="pw-post-body-paragraph iq ir ht is b it lf iv iw ix lg iz ja jb lh jd je jf li jh ji jj lj jl jm jn hm dt translated">如果你想对本教程有所贡献，你可以在这里找到一个Github库<a class="ae lk" href="https://github.com/huggre/the_iota_debit_card_part_2" rel="noopener ugc nofollow" target="_blank"/></p></div><div class="ab cl ka kb hb kc" role="separator"><span class="kd bw bk ke kf kg"/><span class="kd bw bk ke kf kg"/><span class="kd bw bk ke kf"/></div><div class="hm hn ho hp hq"><h1 id="9171" class="kh ki ht bd kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le dt translated">捐款</h1><p id="70bd" class="pw-post-body-paragraph iq ir ht is b it lf iv iw ix lg iz ja jb lh jd je jf li jh ji jj lj jl jm jn hm dt translated">如果你喜欢这个教程，并希望我继续制作其他教程，请随时向下面显示的IOTA地址捐款。</p><figure class="jp jq jr js fq jt fe ff paragraph-image"><div class="fe ff mn"><img src="../Images/f898855aa9f02c497078a9bdbee25534.png" data-original-src="https://miro.medium.com/v2/resize:fit:764/format:webp/1*j2ENIzmDzXcGSgAdY4w-Jw.png"/></div></figure><p id="dc46" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">nyzbhovsmdwabxsacajttwjoqrvvawlbsfqvsjswwbjjlsqknzfc 9 xcrpqsvfqzpbjcjrannpvmmezqjrqsvvgz</p><blockquote class="mo"><p id="8dd0" class="mp mq ht bd mr ms mt mu mv mw mx jn ek translated"><a class="ae lk" href="https://coincodecap.com/?utm_source=coinmonks" rel="noopener ugc nofollow" target="_blank">直接在您的收件箱中获得最佳软件交易</a></p></blockquote><figure class="mz na nb nc nd jt fe ff paragraph-image"><a href="https://coincodecap.com/?utm_source=coinmonks"><div class="fe ff my"><img src="../Images/7c0b3dfdcbfea594cc0ae7d4f9bf6fcb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1168/format:webp/0*OJ-qb5G6i863msBB.png"/></div></a></figure></div></div>    
</body>
</html>