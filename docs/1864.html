<html>
<head>
<title>Advanced EOS Series — Part 2 — Singletons</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">高级EOS系列—第2部分—单件</h1>
<blockquote>原文：<a href="https://medium.com/coinmonks/advanced-eos-series-part-2-singletons-9e903772f71c?source=collection_archive---------4-----------------------#2018-12-07">https://medium.com/coinmonks/advanced-eos-series-part-2-singletons-9e903772f71c?source=collection_archive---------4-----------------------#2018-12-07</a></blockquote><div><div class="ef hh hi hj hk hl"/><div class="hm hn ho hp hq"><figure class="hs ht fm fo hu hv fe ff paragraph-image"><div role="button" tabindex="0" class="hw hx di hy bf hz"><div class="fe ff hr"><img src="../Images/7f9f8579798f603d9fda1694f94a5684.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*aFh0nsIXQHlxxc-wG7llfA@2x.jpeg"/></div></div></figure><div class=""/><p id="93af" class="pw-post-body-paragraph jb jc ie jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">欢迎来到高级EOS开发系列，在这里我将涉及到教程和课程很少涉及的技术和功能。本系列的目的是将您作为应用程序开发人员在EOS网络上完成技能所需的缺失部分汇集在一起。每篇文章都是按照难度排序的，所以如果你想要一个总体的概述，我建议你从第1部分开始，一步步往上。对于本系列的第2部分，我们将着眼于单例，这个例子的所有代码都可以在GitHub 上找到<a class="ae jz" href="https://github.com/MitchPierias/Advanced-EOS-Examples/tree/master/02_Singletons" rel="noopener ugc nofollow" target="_blank">。</a></p><div class="hs ht fm fo hu ka"><a href="https://github.com/MitchPierias/Advanced-EOS-Examples/tree/master/02_Singletons" rel="noopener  ugc nofollow" target="_blank"><div class="kb ab ej"><div class="kc ab kd cl cj ke"><h2 class="bd if fv z el kf eo ep kg er et id dt translated">MitchPierias/高级-EOS-示例</h2><div class="kh l"><h3 class="bd b fv z el kf eo ep kg er et ek translated">一系列EOS合同开发实例。通过创建…为MitchPierias/Advanced-EOS-Examples开发做出贡献</h3></div><div class="ki l"><p class="bd b gc z el kf eo ep kg er et ek translated">github.com</p></div></div><div class="kj l"><div class="kk l kl km kn kj ko ia ka"/></div></div></a></div><blockquote class="kp kq kr"><p id="16c4" class="jb jc ks jd b je jf jg jh ji jj jk jl kt jn jo jp ku jr js jt kv jv jw jx jy hm dt translated">由于这些是高级或扩展的主题，我很危险地假设你已经知道了基础知识，并且正在寻求进一步的知识。因此，这些文章中共享的代码将针对所讨论的主题进行精简。</p></blockquote></div><div class="ab cl kw kx hb ky" role="separator"><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb"/></div><div class="hm hn ho hp hq"><blockquote class="ld"><p id="faf0" class="le lf ie bd lg lh li lj lk ll lm jy ek translated">单例应该用于存储契约状态，或者在只需要一行时作为多索引表的替代。</p></blockquote><h2 id="c33d" class="ln lo ie bd lp lq lr ls lt lu lv lw lx jm ly lz ma jq mb mc md ju me mf mg mh dt translated">坚持</h2><p id="7dec" class="pw-post-body-paragraph jb jc ie jd b je mi jg jh ji mj jk jl jm mk jo jp jq ml js jt ju mm jw jx jy hm dt translated">我们将探索单例作为一种持久化契约状态的方法。鉴于我们的数据只会占用一行，为此使用表将是对资源的浪费。</p><h2 id="a95e" class="ln lo ie bd lp lq mn ls lt lu mo lw lx jm mp lz ma jq mq mc md ju mr mf mg mh dt translated">定义单例</h2><p id="7fdf" class="pw-post-body-paragraph jb jc ie jd b je mi jg jh ji mj jk jl jm mk jo jp jq ml js jt ju mm jw jx jy hm dt translated">对于这个例子，我们将使用一个单例来存储我们的合同配置状态。让我们用一个结构体来定义我们的单例。我们将使用一个名为<code class="eh ms mt mu mv b">closed </code>和<code class="eh ms mt mu mv b">char_count</code>的布尔值来限制用户的帖子大小。</p><pre class="mw mx my mz fq na mv nb nc aw nd dt"><span id="cc2d" class="ln lo ie mv b fv ne nf l ng nh">struct Config {<br/>  bool		closed = false;<br/>  uint32_t	char_count = 144;<br/>};<br/><br/>typedef singleton&lt;N(settings), Config&gt; settings_table;</span></pre><p id="be28" class="pw-post-body-paragraph jb jc ie jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">接下来，我们将为实例创建一个占位符变量，使它在我们的契约上下文中是全局的。</p><pre class="mw mx my mz fq na mv nb nc aw nd dt"><span id="a5ec" class="ln lo ie mv b fv ne nf l ng nh">settings_table config;</span></pre><h2 id="2c14" class="ln lo ie bd lp lq mn ls lt lu mo lw lx jm mp lz ma jq mq mc md ju mr mf mg mh dt translated">初始化单例</h2><p id="02a6" class="pw-post-body-paragraph jb jc ie jd b je mi jg jh ji mj jk jl jm mk jo jp jq ml js jt ju mm jw jx jy hm dt translated">我们可以在每次使用singleton时或者在我们的contracts构造函数中初始化它，这样它在我们的contract的每个动作中都是可用的。我们的合同在这种情况下被命名为<code class="eh ms mt mu mv b">singletons</code>，但你可以叫它什么。</p><pre class="mw mx my mz fq na mv nb nc aw nd dt"><span id="62fb" class="ln lo ie mv b fv ne nf l ng nh">singletons(action_name self) : contract(self), config(_self, _self) {}</span></pre><p id="bc67" class="pw-post-body-paragraph jb jc ie jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">类似于多索引表，初始化单例需要契约代码和范围。在这个例子中，我们将代码和范围都设置为<code class="eh ms mt mu mv b">_self.</code></p><h2 id="12c4" class="ln lo ie bd lp lq mn ls lt lu mo lw lx jm mp lz ma jq mq mc md ju mr mf mg mh dt translated">获取单一值</h2><p id="f059" class="pw-post-body-paragraph jb jc ie jd b je mi jg jh ji mj jk jl jm mk jo jp jq ml js jt ju mm jw jx jy hm dt translated">既然我们已经初始化了单例，我们可以通过读取我们的<code class="eh ms mt mu mv b">char_count</code>值并将其打印到控制台来开始与值交互。</p><pre class="mw mx my mz fq na mv nb nc aw nd dt"><span id="4356" class="ln lo ie mv b fv ne nf l ng nh">auto state = config.get();<br/>print(state.char_count);</span></pre><p id="e255" class="pw-post-body-paragraph jb jc ie jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">就是这样！我们的<code class="eh ms mt mu mv b">config.get()</code>检索我们之前初始化的单例，并将其赋给我们的<code class="eh ms mt mu mv b">state</code>变量。现在我们可以使用点符号来访问我们的<code class="eh ms mt mu mv b">struct</code>的属性。</p><h2 id="f508" class="ln lo ie bd lp lq mn ls lt lu mo lw lx jm mp lz ma jq mq mc md ju mr mf mg mh dt translated">设置单独值</h2><p id="3218" class="pw-post-body-paragraph jb jc ie jd b je mi jg jh ji mj jk jl jm mk jo jp jq ml js jt ju mm jw jx jy hm dt translated">在这个例子中，我们将使用成员函数<code class="eh ms mt mu mv b">singleton.set(STRUCT,PAYER). </code>更新<code class="eh ms mt mu mv b">char_count</code>属性。让我们看两个方法来更新我们的singleton。</p><p id="6414" class="pw-post-body-paragraph jb jc ie jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated"><strong class="jd if">方法1 —内嵌更新</strong></p><p id="3367" class="pw-post-body-paragraph jb jc ie jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">最简单的方法是内联构建我们的struct，在我们设置它的时候直接把它传递给我们的set函数，就像这样；</p><pre class="mw mx my mz fq na mv nb nc aw nd dt"><span id="6eb2" class="ln lo ie mv b fv ne nf l ng nh">config.set(Config{true, 172}, _self);</span></pre><p id="b7e3" class="pw-post-body-paragraph jb jc ie jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">这里我们将<code class="eh ms mt mu mv b">closed</code>设为true，将<code class="eh ms mt mu mv b">char_count </code>设为172，同时委托<code class="eh ms mt mu mv b">_self</code>作为这个RAM的付款人。当你的结构只包含几个属性时，这个方法是干净的，并且保持属性的顺序，但是对于更大的结构，我们需要一个更好的方法。</p><p id="cf63" class="pw-post-body-paragraph jb jc ie jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated"><strong class="jd if">方法2 —检索和更新</strong></p><p id="6938" class="pw-post-body-paragraph jb jc ie jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">接下来，让我们使用获取和更新方法重新打开我们的契约。首先，我们将使用<code class="eh ms mt mu mv b">singleton.get()</code>方法获取当前的<code class="eh ms mt mu mv b">Config</code>状态，设置<code class="eh ms mt mu mv b">closed</code>值，然后再次设置状态。</p><pre class="mw mx my mz fq na mv nb nc aw nd dt"><span id="e7b8" class="ln lo ie mv b fv ne nf l ng nh">auto state = config.get();<br/>state.closed = false;<br/>config.set(state, _self);</span></pre><p id="6a13" class="pw-post-body-paragraph jb jc ie jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">这就是单身，简单！在下一部分中，我们将研究多索引表索引，主要关注使用二级索引。如果您想在我分享更多示例时得到通知，请确保点击<em class="ks">关注</em>。</p><blockquote class="ld"><p id="8096" class="le lf ie bd lg lh li lj lk ll lm jy ek translated"><a class="ae jz" href="https://coincodecap.com/?utm_source=coinmonks" rel="noopener ugc nofollow" target="_blank">直接在您的收件箱中获得最佳软件交易</a></p></blockquote><figure class="nj nk nl nm nn hv fe ff paragraph-image"><a href="https://coincodecap.com/?utm_source=coinmonks"><div class="fe ff ni"><img src="../Images/7c0b3dfdcbfea594cc0ae7d4f9bf6fcb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1168/format:webp/0*OJ-qb5G6i863msBB.png"/></div></a></figure><figure class="mw mx my mz fq hv fe ff paragraph-image"><a href="http://bit.ly/2G71Sp7"><div class="fe ff no"><img src="../Images/449450761cd76f44f9ae574333f9e9af.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fKX2mtg7p1lOs7JmosPLsA.png"/></div></a><figcaption class="np nq fg fe ff nr ns bd b be z ek"><a class="ae jz" href="http://bit.ly/2G71Sp7" rel="noopener ugc nofollow" target="_blank"><strong class="bd nt">Click to read today’s top story</strong></a></figcaption></figure></div></div>    
</body>
</html>