<html>
<head>
<title>How to build a dapp on a private Ethereum network: Part — 4</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在私有以太网上构建dapp:第4部分</h1>
<blockquote>原文：<a href="https://medium.com/coinmonks/how-to-build-a-dapp-on-a-private-ethereum-network-part-4-ea28b6de5cf8?source=collection_archive---------1-----------------------#2020-05-22">https://medium.com/coinmonks/how-to-build-a-dapp-on-a-private-ethereum-network-part-4-ea28b6de5cf8?source=collection_archive---------1-----------------------#2020-05-22</a></blockquote><div><div class="ef hh hi hj hk hl"/><div class="hm hn ho hp hq"><div class=""/><blockquote class="iq ir is"><p id="43e4" class="it iu iv iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hm dt translated">这是一个由5篇文章组成的系列，介绍如何在2个私有以太坊节点的网络上开发一个去中心化的应用程序(dapp ),而无需使用任何第三方API或应用程序(如Infura、MetaMask等)。).本教程涵盖了我在CSIR-CEERI的研究项目中所学到的基本要素。</p><p id="bf00" class="it iu iv iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hm dt translated">我已经介绍了第1-3部分中的第<a class="ae js" rel="noopener" href="/coinmonks/how-to-build-a-dapp-on-a-private-ethereum-network-part-3-31066fedf7a1"> I-VI </a>节。如果你感到失落，你可以通读前3部分，它们的链接在本文底部的<strong class="iw hu">所有系列链接</strong>部分提到。</p></blockquote></div><div class="ab cl jt ju hb jv" role="separator"><span class="jw bw bk jx jy jz"/><span class="jw bw bk jx jy jz"/><span class="jw bw bk jx jy"/></div><div class="hm hn ho hp hq"><blockquote class="ka"><p id="e391" class="kb kc ht bd kd ke kf kg kh ki kj jr ek translated">最近发布—“<a class="ae js" rel="noopener" href="/@themadhackerOI/how-to-build-a-dapp-on-a-private-ethereum-network-part-5-84177d5717be">第5部分:第VIII-IX节</a></p></blockquote></div><div class="ab cl jt ju hb jv" role="separator"><span class="jw bw bk jx jy jz"/><span class="jw bw bk jx jy jz"/><span class="jw bw bk jx jy"/></div><div class="hm hn ho hp hq"><h1 id="85dc" class="kk kl ht bd km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh dt translated">目录</h1><p id="7445" class="pw-post-body-paragraph it iu ht iw b ix li iz ja jb lj jd je lk ll jh ji lm ln jl jm lo lp jp jq jr hm dt translated">在这里，您可以找到我将本教程分成的部分和子部分的列表:</p><p id="da80" class="pw-post-body-paragraph it iu ht iw b ix iy iz ja jb jc jd je lk jg jh ji lm jk jl jm lo jo jp jq jr hm dt translated">一.创建项目</p><p id="8e1b" class="pw-post-body-paragraph it iu ht iw b ix iy iz ja jb jc jd je lk jg jh ji lm jk jl jm lo jo jp jq jr hm dt translated">二。安装先决条件</p><p id="00f6" class="pw-post-body-paragraph it iu ht iw b ix iy iz ja jb jc jd je lk jg jh ji lm jk jl jm lo jo jp jq jr hm dt translated">三。配置网络</p><p id="cbc5" class="pw-post-body-paragraph it iu ht iw b ix iy iz ja jb jc jd je lk jg jh ji lm jk jl jm lo jo jp jq jr hm dt translated">四。设计智能合同</p><p id="7e7e" class="pw-post-body-paragraph it iu ht iw b ix iy iz ja jb jc jd je lk jg jh ji lm jk jl jm lo jo jp jq jr hm dt translated">动词 （verb的缩写）建立松露项目</p><p id="0ddf" class="pw-post-body-paragraph it iu ht iw b ix iy iz ja jb jc jd je lk jg jh ji lm jk jl jm lo jo jp jq jr hm dt translated">不及物动词启动网络</p><p id="3886" class="pw-post-body-paragraph it iu ht iw b ix iy iz ja jb jc jd je lk jg jh ji lm jk jl jm lo jo jp jq jr hm dt translated"><strong class="iw hu"> →七。构建网络应用</strong></p><p id="aa70" class="pw-post-body-paragraph it iu ht iw b ix iy iz ja jb jc jd je lk jg jh ji lm jk jl jm lo jo jp jq jr hm dt translated">八。测试dapp</p><p id="59a5" class="pw-post-body-paragraph it iu ht iw b ix iy iz ja jb jc jd je lk jg jh ji lm jk jl jm lo jo jp jq jr hm dt translated">九。修改dapp</p><p id="ed9c" class="pw-post-body-paragraph it iu ht iw b ix iy iz ja jb jc jd je lk jg jh ji lm jk jl jm lo jo jp jq jr hm dt translated">如果您想跳到某一部分，您可以向下滚动到本文末尾的<strong class="iw hu">所有系列链接</strong>部分。</p></div><div class="ab cl jt ju hb jv" role="separator"><span class="jw bw bk jx jy jz"/><span class="jw bw bk jx jy jz"/><span class="jw bw bk jx jy"/></div><div class="hm hn ho hp hq"><figure class="lr ls lt lu fq lv fe ff paragraph-image"><div class="fe ff lq"><img src="../Images/e150bffd01ab568824cc4801cc9066b8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1052/format:webp/1*8JxDqMU0C8iFVbmXeMj_4w.jpeg"/></div></figure><p id="2622" class="pw-post-body-paragraph it iu ht iw b ix iy iz ja jb jc jd je lk jg jh ji lm jk jl jm lo jo jp jq jr hm dt translated">一道菜的风味完全在于它的味道和感觉。一道精心烹制的菜肴真正得益于它的上菜方式。一点装饰会给它带来有益健康的吸引力。不过没什么特别的，只是一些新鲜的芫荽和一勺奶油。</p><p id="ade6" class="pw-post-body-paragraph it iu ht iw b ix iy iz ja jb jc jd je lk jg jh ji lm jk jl jm lo jo jp jq jr hm dt translated">到目前为止，您已经启动了一个至少包含2个节点的私有以太网，并在网络上部署了<code class="eh ly lz ma mb b">helloworld.sol</code>智能合约。可以通过命令行终端与该系统进行交互。然而，为了使dapp对用户友好，你需要一个GUI。</p><p id="1d6c" class="pw-post-body-paragraph it iu ht iw b ix iy iz ja jb jc jd je lk jg jh ji lm jk jl jm lo jo jp jq jr hm dt translated">为此，我们将借助本文开发前端并与后端链接(第七节)。</p><h1 id="c14a" class="kk kl ht bd km kn mc kp kq kr md kt ku kv me kx ky kz mf lb lc ld mg lf lg lh dt translated">七。构建web应用程序</h1><p id="054d" class="pw-post-body-paragraph it iu ht iw b ix li iz ja jb lj jd je lk ll jh ji lm ln jl jm lo lp jp jq jr hm dt translated">这里，重点不是网页的设计，而是如何将GUI与私有以太网集成。然而，如果项目有一个好的界面，它确实有帮助。这是网页的样子:</p><figure class="lr ls lt lu fq lv fe ff paragraph-image"><div role="button" tabindex="0" class="mi mj di mk bf ml"><div class="fe ff mh"><img src="../Images/52418c1c91514053708f4dd9a2b243e2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*sPuxQQY_K_D60fH1UBYn5A.png"/></div></div><figcaption class="mm mn fg fe ff mo mp bd b be z ek">It’s not pretty, but it gets the job done. Now hurry up, we got code to write!!</figcaption></figure><h2 id="b4f9" class="mq kl ht bd km mr ms mt kq mu mv mw ku lk mx my ky lm mz na lc lo nb nc lg nd dt translated">1.前端:客户端界面</h2><p id="3490" class="pw-post-body-paragraph it iu ht iw b ix li iz ja jb lj jd je lk ll jh ji lm ln jl jm lo lp jp jq jr hm dt translated">这需要<code class="eh ly lz ma mb b">web3</code>和<code class="eh ly lz ma mb b">truffle-contract</code>包，它们又需要<code class="eh ly lz ma mb b">build-essential</code>来设置。在<code class="eh ly lz ma mb b">TruffleDapp</code>文件夹中打开一个终端，运行:</p><pre class="lr ls lt lu fq ne mb nf ng aw nh dt"><span id="1aa9" class="mq kl ht mb b fv ni nj l nk nl">$ sudo apt-get install build-essential<br/>$ npm init<br/>$ npm install truffle-contract@4.0.0-beta.2 --save-dev<br/>$ npm install web3@1.0.0-beta.36 --save-dev</span></pre><p id="ff4e" class="pw-post-body-paragraph it iu ht iw b ix iy iz ja jb jc jd je lk jg jh ji lm jk jl jm lo jo jp jq jr hm dt translated">安装好先决条件后，在<code class="eh ly lz ma mb b">TruffleDapp</code>目录下创建一个名为<code class="eh ly lz ma mb b">client</code>的文件夹，并按照给出的步骤操作。</p><p id="12ff" class="pw-post-body-paragraph it iu ht iw b ix iy iz ja jb jc jd je lk jg jh ji lm jk jl jm lo jo jp jq jr hm dt translated"><strong class="iw hu"> A .创建索引页面</strong></p><p id="83c6" class="pw-post-body-paragraph it iu ht iw b ix iy iz ja jb jc jd je lk jg jh ji lm jk jl jm lo jo jp jq jr hm dt translated">在<code class="eh ly lz ma mb b">TruffleDapp/client</code>存储库中创建一个包含以下内容的<code class="eh ly lz ma mb b">index.html</code>文件:</p><pre class="lr ls lt lu fq ne mb nf ng aw nh dt"><span id="551c" class="mq kl ht mb b fv ni nj l nk nl">&lt;!DOCTYPE html&gt;<br/>&lt;html lang="en"&gt;<br/> &lt;head&gt;<br/>  &lt;meta charset="UTF-8"&gt;<br/>  &lt;meta name="viewport" content="width=device-width, initial-scale=1.0"&gt;<br/>  &lt;meta http-equiv="X-UA-Compatible" content="ie=edge"&gt;<br/>  &lt;title&gt;Sample Dapp&lt;/title&gt;<br/>  &lt;link rel="stylesheet" type="text/css" href="main.css"&gt;<br/> &lt;/head&gt;<br/> &lt;h2&gt;Hello World Ethereum Dapp&lt;/h2&gt;<br/> &lt;body&gt;<br/>  &lt;div&gt;<br/>   &lt;div class="container"&gt;<br/>    &lt;label for="username" class="col-lg-2 control-label"&gt;Enter your name :&lt;/label&gt;<br/>    &lt;input id="username" type="text"/&gt;<br/>   &lt;/div&gt;<br/>   &lt;div&gt;<br/>    &lt;button id="setName"&gt;Save Name&lt;/button&gt;   <br/>    &lt;button id="getName"&gt;Get Name&lt;/button&gt;<br/>   &lt;/div&gt;<br/>  &lt;/div&gt;</span><span id="ead9" class="mq kl ht mb b fv nm nj l nk nl">&lt;div class="container"&gt;<br/>   &lt;div&gt;&lt;label class="center-label" for="output"&gt;OUTPUT --&gt; &lt;/label&gt;<br/>   &lt;div id="output"&gt;None&lt;/div&gt;&lt;/div&gt;<br/>  &lt;/div&gt;</span><span id="2366" class="mq kl ht mb b fv nm nj l nk nl">&lt;div class="container"&gt;<br/>   &lt;div&gt;&lt;label class="center-label" for="errorHolder"&gt;ERROR --&gt; &lt;/label&gt;<br/>   &lt;div id="errorHolder"&gt;None&lt;/div&gt;&lt;/div&gt;<br/>  &lt;/div&gt;</span><span id="5ef4" class="mq kl ht mb b fv nm nj l nk nl">&lt;script src="<a class="ae js" href="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js" rel="noopener ugc nofollow" target="_blank">https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js</a>"&gt;&lt;/script&gt;<br/>  &lt;script src="dist/bundle.js"&gt;&lt;/script&gt;<br/> &lt;/body&gt;<br/>&lt;/html&gt;</span></pre><p id="4fab" class="pw-post-body-paragraph it iu ht iw b ix iy iz ja jb jc jd je lk jg jh ji lm jk jl jm lo jo jp jq jr hm dt translated"><strong class="iw hu"> B .添加CSS </strong></p><p id="4580" class="pw-post-body-paragraph it iu ht iw b ix iy iz ja jb jc jd je lk jg jh ji lm jk jl jm lo jo jp jq jr hm dt translated">HTML文件只定义了网页的基本框架。为了让它们更吸引人，在<code class="eh ly lz ma mb b">client</code>存储库中创建一个<code class="eh ly lz ma mb b">main.css</code>文件，并键入:</p><pre class="lr ls lt lu fq ne mb nf ng aw nh dt"><span id="3727" class="mq kl ht mb b fv ni nj l nk nl">h2 {<br/>  text-align: center;<br/>  padding-bottom: 10px;<br/>}</span><span id="a39a" class="mq kl ht mb b fv nm nj l nk nl">body {<br/>  background-color: rgba(203, 209, 218, 0.877);<br/>  padding: 2em;<br/>  font-family: 'Verdana';<br/>  width: 900px;<br/>  margin: auto;<br/>  font-size: 15px;<br/>}</span><span id="79b2" class="mq kl ht mb b fv nm nj l nk nl">div.Hontainer {<br/>  width: 100%;<br/>  margin: 0 auto;<br/>}</span><span id="b70f" class="mq kl ht mb b fv nm nj l nk nl">label {<br/>  display: inline-block;<br/>  padding: 20px;<br/>  clear: both;<br/>}</span><span id="c0bd" class="mq kl ht mb b fv nm nj l nk nl">#output{<br/>  display: inline-block;<br/>  background-color: aquamarine;<br/>  padding: 1em 10px;<br/>  width: 60%;<br/>}</span><span id="6b0f" class="mq kl ht mb b fv nm nj l nk nl">#errorHolder{<br/>  display: inline-block;<br/>  background-color: coral;<br/>  padding: 1em 10px;<br/>  width: 60%;<br/>}</span><span id="40ea" class="mq kl ht mb b fv nm nj l nk nl">.center-label {<br/>  margin: 1em 1em;<br/>}</span><span id="8b5e" class="mq kl ht mb b fv nm nj l nk nl">input {<br/>  padding:8px;<br/>  width: 60%;<br/>  margin-bottom: 0.5em;<br/>}</span><span id="e0a9" class="mq kl ht mb b fv nm nj l nk nl">button {<br/>  font-family: 'Verdana';<br/>  margin: 1em auto;<br/>  padding: 12px 1em;<br/>  background-color: #1479F5;<br/>  color: white;<br/>  font-size: 15px;<br/>}</span><span id="816e" class="mq kl ht mb b fv nm nj l nk nl">button:hover {<br/>  background-color: rgb(1, 146, 20);<br/>}</span></pre><p id="f3ea" class="pw-post-body-paragraph it iu ht iw b ix iy iz ja jb jc jd je lk jg jh ji lm jk jl jm lo jo jp jq jr hm dt translated">这个CSS模板是从一个不同的项目中借用的，所以它不是为适应这个项目而定制的。</p><p id="2229" class="pw-post-body-paragraph it iu ht iw b ix iy iz ja jb jc jd je lk jg jh ji lm jk jl jm lo jo jp jq jr hm dt translated"><strong class="iw hu"> 4。添加JS功能</strong></p><p id="9ab5" class="pw-post-body-paragraph it iu ht iw b ix iy iz ja jb jc jd je lk jg jh ji lm jk jl jm lo jo jp jq jr hm dt translated">上面使用的HTML组件需要与在web浏览器中执行的相应功能相链接，以执行所需的功能。</p><p id="23f8" class="pw-post-body-paragraph it iu ht iw b ix iy iz ja jb jc jd je lk jg jh ji lm jk jl jm lo jo jp jq jr hm dt translated">这里，本地私有以太坊区块链被用作<code class="eh ly lz ma mb b">web3Provider</code>，来自<code class="eh ly lz ma mb b">truffle-contract</code>包的<code class="eh ly lz ma mb b">TruffleContract</code>被用于访问智能契约方法。在<code class="eh ly lz ma mb b">client</code>存储库中，在编辑器中打开<code class="eh ly lz ma mb b">app.js</code>文件并键入:</p><pre class="lr ls lt lu fq ne mb nf ng aw nh dt"><span id="a849" class="mq kl ht mb b fv ni nj l nk nl">const Web3 = require('web3');<br/>const TruffleContract = require('truffle-contract');<br/>const request = require('request');</span><span id="1ee4" class="mq kl ht mb b fv nm nj l nk nl">App = {</span><span id="b819" class="mq kl ht mb b fv nm nj l nk nl">/*==================================================================<br/>    DEFINE ESSENTIALS<br/>==================================================================*/</span><span id="5add" class="mq kl ht mb b fv nm nj l nk nl">web3Provider: null,<br/>  contracts: {},<br/> currentAccount:{},<br/> <br/> // Integrates web3 with our web app<br/>  initWeb3 : async function (){<br/>    if (process.env.MODE == 'development' || typeof window.web3 === 'undefined'){<br/>      App.web3Provider = new Web3.providers.HttpProvider(process.env.LOCAL_NODE);<br/>    }<br/>    else{<br/>     App.web3Provider = web3.currentProvider;<br/>    }<br/>    web3 = new Web3(App.web3Provider);<br/>    return  await App.initContract(); <br/> },<br/> <br/> // Initialises a variable with IDManagement contract JSON<br/>  initContract : async function (){<br/>    await $.getJSON('HelloWorld.json', function(data){<br/>      var hwArtifact = data;<br/>      App.contracts.helloworld = TruffleContract(hwArtifact);<br/>      App.contracts.helloworld.setProvider(App.web3Provider);     <br/>    })<br/>    return App.bindEvents();<br/> },<br/> <br/> // Binds button clicks to the repective functions<br/>   bindEvents: function() { <br/>  $('#setName').click(App.ExeInputUser);<br/>  $('#getName').click(App.CallDispUser);<br/> },</span><span id="b873" class="mq kl ht mb b fv nm nj l nk nl">// Defines functionality for OUTPUT label<br/>    showMessage: function (msg){<br/>    $('#output').html(msg.toString());<br/>  $('#output').show();<br/>  $('#errorHolder').hide();<br/> },<br/> <br/> // Defines functionality for ERROR label<br/>    showError: function(err){<br/>    $('#errorHolder').html(err.toString());<br/>  $('#errorHolder').show();<br/>  $('#output').hide();<br/> },</span><span id="e279" class="mq kl ht mb b fv nm nj l nk nl">/*==================================================================<br/>    USERNAME SUBMISSION<br/>==================================================================*/</span><span id="6f6b" class="mq kl ht mb b fv nm nj l nk nl">ExeInputUser: function (){</span><span id="a5a1" class="mq kl ht mb b fv nm nj l nk nl">var NAME = $('#username').val();<br/>  console.log("In app.js ExeInputUser", NAME);<br/>  <br/>  if(NAME) {<br/>   // Retrieves user account to perform operations<br/>   web3.eth.getAccounts(function (error,accounts){<br/>    if (error){<br/>     console.log("ERROR getAccounts ExeInputUser");<br/>     App.showError(error);<br/>    }<br/>    App.currentAccount = accounts[0];<br/>    <br/>    // Submits name to the blockchain network<br/>    App.contracts.helloworld.deployed().then(function(obj){<br/>     return obj.inputUser.sendTransaction(NAME, {from:App.currentAccount});<br/>    }).then(function(result){<br/>     console.log(result);<br/>     App.showMessage("Name submitted as a txn");<br/>    }).catch(function (error){<br/>     console.log("ERROR ExeInputUser");<br/>     App.showError(error);<br/>    });<br/>   });<br/>  }<br/>  else {<br/>   App.showError("Valid name is required !");<br/>  }<br/> },</span><span id="80e7" class="mq kl ht mb b fv nm nj l nk nl">/*==================================================================<br/> USERNAME RETRIEVAL<br/>==================================================================*/</span><span id="4bb1" class="mq kl ht mb b fv nm nj l nk nl">CallDispUser : function (){</span><span id="9240" class="mq kl ht mb b fv nm nj l nk nl">var NAME = $('#username').val();</span><span id="fd4c" class="mq kl ht mb b fv nm nj l nk nl">if(NAME) {<br/>   console.log("In app.js CallDispUser");<br/>   web3.eth.getAccounts(function (error,accounts){<br/>    if (error){<br/>     console.log("ERROR getAccounts CallDispUser");<br/>     App.showError(error);<br/>    }<br/>    App.currentAccount = accounts[0];<br/>    <br/>    App.contracts.helloworld.deployed().then(function(instance){<br/>     return instance.dispUser.call({from:App.currentAccount});<br/>    }).then(function(result) {<br/>      console.log("CallDispUser returns : ", result);<br/>      App.showMessage(result);<br/>    }).catch(function (error){<br/>      console.log("ERROR CallRegStatus");<br/>      App.showError(error);<br/>    })<br/>   })<br/>  }<br/>  else {<br/>   App.showError("No output as no name is entered");<br/>  }<br/> },</span><span id="2288" class="mq kl ht mb b fv nm nj l nk nl">/*==================================================================<br/> INITIALISATION : Intialises web3 when webpage is loaded onto browser<br/>==================================================================*/</span><span id="9a71" class="mq kl ht mb b fv nm nj l nk nl">init : async function (){<br/>  await App.initWeb3();<br/>  console.log("In app.js init, initiated App");<br/>  }<br/>}<br/> <br/>$(function() {<br/>  $(window).load(function() {         <br/>   App.init();<br/>  });<br/>});</span></pre><h2 id="e2a4" class="mq kl ht bd km mr ms mt kq mu mv mw ku lk mx my ky lm mz na lc lo nb nc lg nd dt translated">2.设置中间件:Express.js</h2><p id="4714" class="pw-post-body-paragraph it iu ht iw b ix li iz ja jb lj jd je lk ll jh ji lm ln jl jm lo lp jp jq jr hm dt translated">Express.js是一个轻量级的web应用程序框架，它帮助在服务器端组织web应用程序，并支持对web应用程序的所有方面进行管理，从路由到处理请求和网页。第一步是设置一个环境。</p><ul class=""><li id="3c50" class="nn no ht iw b ix iy jb jc lk np lm nq lo nr jr ns nt nu nv dt translated">要安装Express.js，请在<code class="eh ly lz ma mb b">TruffleDapp</code>文件夹(T1)中打开一个终端并运行:</li></ul><pre class="lr ls lt lu fq ne mb nf ng aw nh dt"><span id="507c" class="mq kl ht mb b fv ni nj l nk nl">$ npm install express --save</span></pre><ul class=""><li id="38c3" class="nn no ht iw b ix iy jb jc lk np lm nq lo nr jr ns nt nu nv dt translated">为了定义环境变量，通过在同一个终端窗口中执行来安装<code class="eh ly lz ma mb b">dotenv</code>包:</li></ul><pre class="lr ls lt lu fq ne mb nf ng aw nh dt"><span id="1260" class="mq kl ht mb b fv ni nj l nk nl">$ npm install dotenv --save</span></pre><ul class=""><li id="004d" class="nn no ht iw b ix iy jb jc lk np lm nq lo nr jr ns nt nu nv dt translated">接着，在<code class="eh ly lz ma mb b">TruffleDapp</code>中创建一个<code class="eh ly lz ma mb b">.env</code>文件，并输入:</li></ul><pre class="lr ls lt lu fq ne mb nf ng aw nh dt"><span id="4936" class="mq kl ht mb b fv ni nj l nk nl">IP = "127.0.0.1"<br/>PORT = 3000<br/>MODE = "development"<br/>LOCAL_NODE  = "http://127.0.0.1:8081"</span></pre><p id="62b9" class="pw-post-body-paragraph it iu ht iw b ix iy iz ja jb jc jd je lk jg jh ji lm jk jl jm lo jo jp jq jr hm dt translated">这里，<code class="eh ly lz ma mb b">PORT</code>是我们运行Node.js服务器的端口，<code class="eh ly lz ma mb b">MODE</code>是<code class="eh ly lz ma mb b">truffle-config.js</code>中提到的网络变量，<code class="eh ly lz ma mb b">LOCAL_NODE</code>是本地私有区块链的URL。</p><ul class=""><li id="aa7b" class="nn no ht iw b ix iy jb jc lk np lm nq lo nr jr ns nt nu nv dt translated">接下来，在<code class="eh ly lz ma mb b">TruffleDapp</code>中创建一个<code class="eh ly lz ma mb b">server</code>存储库。在<code class="eh ly lz ma mb b">server</code>文件夹中创建一个<code class="eh ly lz ma mb b">main.js</code>文件，在编辑器中打开并输入:</li></ul><pre class="lr ls lt lu fq ne mb nf ng aw nh dt"><span id="e295" class="mq kl ht mb b fv ni nj l nk nl">require('dotenv').config();</span><span id="2ae2" class="mq kl ht mb b fv nm nj l nk nl">const express = require('express');<br/>const app = express();</span><span id="6d2b" class="mq kl ht mb b fv nm nj l nk nl">const PORT = process.env.PORT || 3000;<br/>const IP = process.env.IP || '127.0.0.1';</span><span id="f905" class="mq kl ht mb b fv nm nj l nk nl">// Enter the path of YOUR project directory<br/>const proj_dir = `/home/amey/Projects/medium-tutorial`;</span><span id="c77c" class="mq kl ht mb b fv nm nj l nk nl">app.use(express.static('client'));<br/>app.use(express.static('build/contracts'));</span><span id="3917" class="mq kl ht mb b fv nm nj l nk nl">// Serves the home page of the project<br/>app.get('/index', (req, res) =&gt; {<br/>  res.sendFile(`${proj_dir}/client/index.html`);<br/>});</span><span id="0cf0" class="mq kl ht mb b fv nm nj l nk nl">app.get('*', (req, res) =&gt; {<br/> res.status(404);<br/> res.send('Oops... this URL does not exist');<br/>});</span><span id="7332" class="mq kl ht mb b fv nm nj l nk nl">app.listen(PORT, IP, () =&gt; {<br/> console.log(`HelloWorld Dapp running on port ${PORT}...`);<br/>});</span></pre><ul class=""><li id="f2e3" class="nn no ht iw b ix iy jb jc lk np lm nq lo nr jr ns nt nu nv dt translated">在<code class="eh ly lz ma mb b">package.json</code>文件的<code class="eh ly lz ma mb b">"scripts"</code>下增加以下声明:</li></ul><pre class="lr ls lt lu fq ne mb nf ng aw nh dt"><span id="a3e9" class="mq kl ht mb b fv ni nj l nk nl">"start": "node server/main.js"</span></pre><ul class=""><li id="4125" class="nn no ht iw b ix iy jb jc lk np lm nq lo nr jr ns nt nu nv dt translated">为了测试web页面是否如预期加载，在T1中运行<code class="eh ly lz ma mb b">$ npm run start</code>并在web浏览器中打开URL<a class="ae js" href="http://localhost:3000/index" rel="noopener ugc nofollow" target="_blank">http://localhost:3000/index</a>。但是，请注意，正如在<code class="eh ly lz ma mb b">.env</code>文件中提到的，由于在<code class="eh ly lz ma mb b">LOCAL_NODE = "http://127.0.0.1:8081"</code>没有运行<code class="eh ly lz ma mb b">geth</code>节点，所以网页将不起作用。</li></ul><p id="9461" class="pw-post-body-paragraph it iu ht iw b ix iy iz ja jb jc jd je lk jg jh ji lm jk jl jm lo jo jp jq jr hm dt translated"><strong class="iw hu"> <em class="iv">注意:</em> </strong>在<code class="eh ly lz ma mb b">app.js</code>中，<code class="eh ly lz ma mb b">require</code>导入的包和外部库无法被浏览器理解。因此，<code class="eh ly lz ma mb b">webpack</code>被用作模块的捆绑器。它的主要目的是捆绑JavaScript文件，以便在浏览器中使用。</p><ul class=""><li id="cf06" class="nn no ht iw b ix iy jb jc lk np lm nq lo nr jr ns nt nu nv dt translated">首先，安装必要的模块。在T1运行:</li></ul><pre class="lr ls lt lu fq ne mb nf ng aw nh dt"><span id="5f2a" class="mq kl ht mb b fv ni nj l nk nl">$ npm install webpack@<!-- -->4.41.4<!-- --> webpack-cli --save-dev</span></pre><ul class=""><li id="29e2" class="nn no ht iw b ix iy jb jc lk np lm nq lo nr jr ns nt nu nv dt translated">不能在客户端直接访问<code class="eh ly lz ma mb b">.env</code>中声明的环境变量。因此，在<code class="eh ly lz ma mb b">DefinePlugin</code>中对它们进行了定义。<code class="eh ly lz ma mb b">node</code>和<code class="eh ly lz ma mb b">externals</code>配置用于修复构建时的webpack错误。添加一个具有以下webpack配置的<code class="eh ly lz ma mb b">webpack.config.js</code>文件:</li></ul><pre class="lr ls lt lu fq ne mb nf ng aw nh dt"><span id="5abc" class="mq kl ht mb b fv ni nj l nk nl">require('dotenv').config();<br/>const webpack = require('webpack');<br/>const path = require('path');<br/> <br/>module.exports = {<br/>  entry: './client/app.js',<br/>  mode: process.env.MODE,<br/>  output: {<br/>    filename: 'bundle.js',<br/>    path: path.resolve(__dirname, 'client/dist')<br/>  },<br/>  plugins: [<br/>    new webpack.DefinePlugin({<br/>      'process.env': {<br/>        'LOCAL_NODE': JSON.stringify(process.env.LOCAL_NODE),<br/>        'MODE':JSON.stringify(process.env.MODE),<br/>      }<br/>    })<br/>  ],<br/>  node: {<br/>    net: 'empty',<br/>    tls: 'empty',<br/>    dns: 'empty'<br/>  },<br/>  externals:[{<br/>    xmlhttprequest: '{XMLHttpRequest:XMLHttpRequest}'<br/>  }]<br/>};</span></pre><ul class=""><li id="2c00" class="nn no ht iw b ix iy jb jc lk np lm nq lo nr jr ns nt nu nv dt translated">在<code class="eh ly lz ma mb b">package.json</code>的<code class="eh ly lz ma mb b">"scripts"</code>部分增加以下内容:</li></ul><pre class="lr ls lt lu fq ne mb nf ng aw nh dt"><span id="0f7e" class="mq kl ht mb b fv ni nj l nk nl">"dev" : "node_modules/.bin/webpack &amp;&amp; node server/main.js",<br/>"webpack": "node_modules/.bin/webpack --watch"</span></pre><ul class=""><li id="1ef1" class="nn no ht iw b ix iy jb jc lk np lm nq lo nr jr ns nt nu nv dt translated">在T1中运行<code class="eh ly lz ma mb b">$ npm run webpack</code>来检查任何webpack构建错误。如果没有错误，可以通过在T1中运行<code class="eh ly lz ma mb b">$ npm run dev</code>然后在web浏览器中打开URL<a class="ae js" href="http://localhost:3000/index" rel="noopener ugc nofollow" target="_blank">http://localhost:3000/index</a>来开始测试dapp。</li></ul><p id="658b" class="pw-post-body-paragraph it iu ht iw b ix iy iz ja jb jc jd je lk jg jh ji lm jk jl jm lo jo jp jq jr hm dt translated">因此，我们构建了一个简单的分散式应用程序，并配有一个交互式GUI组件。我们将以一篇关于测试dapp的文章和一个关于如何修改这个dapp的非常有用的部分来结束这个教程系列。</p></div><div class="ab cl jt ju hb jv" role="separator"><span class="jw bw bk jx jy jz"/><span class="jw bw bk jx jy jz"/><span class="jw bw bk jx jy"/></div><div class="hm hn ho hp hq"><p id="5a45" class="pw-post-body-paragraph it iu ht iw b ix iy iz ja jb jc jd je lk jg jh ji lm jk jl jm lo jo jp jq jr hm dt translated">如果你喜欢这篇文章，请鼓掌10次！请在下面评论，让我知道你的想法，或者如果你想分享一些技巧。</p><p id="4126" class="pw-post-body-paragraph it iu ht iw b ix iy iz ja jb jc jd je lk jg jh ji lm jk jl jm lo jo jp jq jr hm dt translated">我很快会发表更多这样有趣的文章。梗我上 <a class="ae js" href="https://twitter.com/TheMadHacker01" rel="noopener ugc nofollow" target="_blank"> <em class="iv">推特</em> </a> <em class="iv">敬请关注。</em></p></div><div class="ab cl jt ju hb jv" role="separator"><span class="jw bw bk jx jy jz"/><span class="jw bw bk jx jy jz"/><span class="jw bw bk jx jy"/></div><div class="hm hn ho hp hq"><h1 id="e2c7" class="kk kl ht bd km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh dt translated">所有系列链接</h1><p id="8dc5" class="pw-post-body-paragraph it iu ht iw b ix li iz ja jb lj jd je lk ll jh ji lm ln jl jm lo lp jp jq jr hm dt translated">如果你想跳过某一部分，你可以参考下面的链接。请参考下面的<strong class="iw hu">目录</strong>，将一节与其对应的主题进行匹配。</p><p id="5c97" class="pw-post-body-paragraph it iu ht iw b ix iy iz ja jb jc jd je lk jg jh ji lm jk jl jm lo jo jp jq jr hm dt translated"><a class="ae js" rel="noopener" href="/coinmonks/dapp-on-a-private-ethereum-network-1-c8b80695e049">第一部分:第一至第三节</a></p><p id="516e" class="pw-post-body-paragraph it iu ht iw b ix iy iz ja jb jc jd je lk jg jh ji lm jk jl jm lo jo jp jq jr hm dt translated"><a class="ae js" rel="noopener" href="/coinmonks/dapp-on-a-private-ethereum-network-2-a0b282586558">第二部分:第四节</a></p><p id="3f19" class="pw-post-body-paragraph it iu ht iw b ix iy iz ja jb jc jd je lk jg jh ji lm jk jl jm lo jo jp jq jr hm dt translated"><a class="ae js" rel="noopener" href="/@themadhackerOI/how-to-build-a-dapp-on-a-private-ethereum-network-part-3-31066fedf7a1">第三部分:第五至第六节</a></p><p id="6a9e" class="pw-post-body-paragraph it iu ht iw b ix iy iz ja jb jc jd je lk jg jh ji lm jk jl jm lo jo jp jq jr hm dt translated"><a class="ae js" rel="noopener" href="/@themadhackerOI/how-to-build-a-dapp-on-a-private-ethereum-network-part-4-ea28b6de5cf8">第四部分:第七节</a></p><p id="8382" class="pw-post-body-paragraph it iu ht iw b ix iy iz ja jb jc jd je lk jg jh ji lm jk jl jm lo jo jp jq jr hm dt translated"><a class="ae js" rel="noopener" href="/@themadhackerOI/how-to-build-a-dapp-on-a-private-ethereum-network-part-5-84177d5717be">第5部分:第八章至第九章</a></p><blockquote class="ka"><p id="a6b2" class="kb kc ht bd kd ke kf kg kh ki kj jr ek translated"><a class="ae js" href="https://coincodecap.com/?utm_source=coinmonks" rel="noopener ugc nofollow" target="_blank">直接在您的收件箱中获得最佳软件交易</a></p></blockquote><figure class="nx ny nz oa ob lv fe ff paragraph-image"><a href="https://coincodecap.com/?utm_source=coinmonks"><div class="fe ff nw"><img src="../Images/7c0b3dfdcbfea594cc0ae7d4f9bf6fcb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1168/format:webp/0*OJ-qb5G6i863msBB.png"/></div></a></figure></div></div>    
</body>
</html>