<html>
<head>
<title>A Jedi’s guide to Solidity reentrancy attacks</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">绝地指南:坚固的再入攻击</h1>
<blockquote>原文：<a href="https://medium.com/coinmonks/a-jedis-guide-to-solidity-reentrancy-attacks-f5ebfa6405c9?source=collection_archive---------3-----------------------#2018-03-27">https://medium.com/coinmonks/a-jedis-guide-to-solidity-reentrancy-attacks-f5ebfa6405c9?source=collection_archive---------3-----------------------#2018-03-27</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><p id="c031" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">写一份可靠的合同是一回事，但确保参与者的资金安全是另一回事。Solidity试图通过它的编译过程尽可能多地执行，但它取决于创作者是否能带它穿过终点线。</p><p id="5360" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">在我们的前一篇文章中，我们为我们的赌博dApp创建了一个UI，欧比万和尤达大师用它来解决赌博问题。在本文中，我们将研究智能合约中隐藏的安全漏洞或攻击媒介。</p><h2 id="0c70" class="jq jr hu bd js jt ju jv jw jx jy jz ka jc kb kc kd jg ke kf kg jk kh ki kj kk dt translated">安全性</h2><p id="66a1" class="pw-post-body-paragraph ir is hu it b iu kl iw ix iy km ja jb jc kn je jf jg ko ji jj jk kp jm jn jo hn dt translated">每个人都同意，安全是一个问题，是绝对关键的成功大规模区块链采用。我们将使用以下方法来检查我们的智能合约的安全缺陷:</p><ul class=""><li id="f9bc" class="kq kr hu it b iu iv iy iz jc ks jg kt jk ku jo kv kw kx ky dt translated"><a class="ae jp" href="https://remix.ethereum.org" rel="noopener ugc nofollow" target="_blank"> Remix </a> —我们已经在<a class="ae jp" rel="noopener" href="/@cipherz/a-jedis-guide-to-ethereum-part-3b-remix-1b8d98d909d4">之前的一篇文章</a>中广泛使用了这个工具，但是还没有利用它的分析选项卡。</li></ul><h2 id="844e" class="jq jr hu bd js jt ju jv jw jx jy jz ka jc kb kc kd jg ke kf kg jk kh ki kj kk dt translated">再搅拌</h2><p id="e1f2" class="pw-post-body-paragraph ir is hu it b iu kl iw ix iy km ja jb jc kn je jf jg ko ji jj jk kp jm jn jo hn dt translated">在remix中打开我们的<a class="ae jp" href="https://github.com/cipherzzz/JediBetDapp/blob/master/contracts/Bet.sol" rel="noopener ugc nofollow" target="_blank"> Bet.sol </a>智能合约，我们可以在分析选项卡中看到几个问题。在这一点上，我们感兴趣的是潜在的再入脆弱性。</p><figure class="la lb lc ld fq le fe ff paragraph-image"><div class="fe ff kz"><img src="../Images/1df452ae9da460b7306ee576c113536f.png" data-original-src="https://miro.medium.com/v2/resize:fit:722/format:webp/1*uHAUKdcwb09qxxTrsYrx9A.png"/></div></figure><p id="a82e" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">一个<em class="lh">重入</em>条件是当一个参与者可以调用你的契约的函数，并且可能在之前的调用完成一次或多次之前<em class="lh">重入</em>契约。这对于我们这里的可支付函数来说尤其是灾难性的。</p><p id="ff0f" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><strong class="it hv"> Bet.sol —易受攻击的代码</strong></p><figure class="la lb lc ld fq le"><div class="bz el l di"><div class="li lj l"/></div></figure><p id="fe0b" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我们的代码在第4行检查执行地址是赌注接受者还是发起者，这很好。我们已经淘汰了这里大多数的坏演员。<em class="lh">然而，如果其中一个玩家是一个坏演员，他看到了合同中的漏洞，并且只是作为利用该漏洞的一种手段而参与进来，那该怎么办？</em>我们在<em class="lh">线路7、8、11、13、15和16 </em>上的传递函数调用容易受到这样的攻击。如果你注意到我写的转账金额是基于这样的逻辑，即底池或总赢款大约等于玩家的下注金额乘以2。我跟不上支付给每个玩家的金额。因此，在玩家得到支付的情况下，他们可以再次递归调用合同，并且没有检查他们是否已经得到支付。他们基本上可以这样做，直到他们耗尽汽油或合同耗尽。这将是您与另一个与Bet.sol交互的智能合约所做的事情，其中您将有一个默认的回退应付款函数，该函数将在原始调用返回之前再次调用<em class="lh">支出</em>函数。</p><p id="ae4d" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><strong class="it hv"> Bet.sol —已修复</strong></p><figure class="la lb lc ld fq le"><div class="bz el l di"><div class="li lj l"/></div></figure><p id="8693" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我们要做的是所谓的，<em class="lh">乐观会计，</em>在我们发送转移函数之前，我们从玩家的资金中扣除支付金额。这将防止可重入的行为，并且仍然允许在异常情况下还原演绎。我们希望在一般情况下用可靠性契约状态来实现这一点，以防止重入攻击。请注意，我将<em class="lh"> resetGame() </em>和<em class="lh"> getBetOutcome() </em>方法放在转移奖金的调用之前。这是安全的，因为传递函数的任何错误都会恢复我们的契约状态。</p><blockquote class="lk"><p id="6e8e" class="ll lm hu bd ln lo lp lq lr ls lt jo ek translated"><a class="ae jp" href="https://coincodecap.com/?utm_source=coinmonks" rel="noopener ugc nofollow" target="_blank">直接在您的收件箱中获得最佳软件交易</a></p></blockquote><figure class="lv lw lx ly lz le fe ff paragraph-image"><a href="https://coincodecap.com/?utm_source=coinmonks"><div class="fe ff lu"><img src="../Images/7c0b3dfdcbfea594cc0ae7d4f9bf6fcb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1168/format:webp/0*OJ-qb5G6i863msBB.png"/></div></a></figure><p id="ad61" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">其他资源:</p><div class="ma mb fm fo mc md"><a href="https://ethereum.stackexchange.com/questions/28945/testing-for-reentrancy-attacks-in-remix" rel="noopener  ugc nofollow" target="_blank"><div class="me ab ej"><div class="mf ab mg cl cj mh"><h2 class="bd hv fv z el mi eo ep mj er et ht dt translated">remix中的重入攻击测试</h2><div class="mk l"><h3 class="bd b fv z el mi eo ep mj er et ek translated">以太坊栈交换是一个针对以太坊用户的问答网站，是一个去中心化的应用平台和…</h3></div><div class="ml l"><p class="bd b gc z el mi eo ep mj er et ek translated">ethereum.stackexchange.com</p></div></div><div class="mm l"><div class="mn l mo mp mq mm mr lf md"/></div></div></a></div><div class="ma mb fm fo mc md"><a rel="noopener follow" target="_blank" href="/@JusDev1988/reentrancy-attack-on-a-smart-contract-677eae1300f2"><div class="me ab ej"><div class="mf ab mg cl cj mh"><h2 class="bd hv fv z el mi eo ep mj er et ht dt translated">智能合约上的“可重入攻击”</h2><div class="mk l"><h3 class="bd b fv z el mi eo ep mj er et ek translated">Solidity中的错误代价很高，会让你和其他人处于危险之中，所以当…</h3></div><div class="ml l"><p class="bd b gc z el mi eo ep mj er et ek translated">medium.com</p></div></div><div class="mm l"><div class="ms l mo mp mq mm mr lf md"/></div></div></a></div><div class="ma mb fm fo mc md"><a rel="noopener follow" target="_blank" href="/@gus_tavo_guim/reentrancy-attack-on-smart-contracts-how-to-identify-the-exploitable-and-an-example-of-an-attack-4470a2d8dfe4"><div class="me ab ej"><div class="mf ab mg cl cj mh"><h2 class="bd hv fv z el mi eo ep mj er et ht dt translated">智能契约上的可重入攻击:如何识别可利用的和攻击的例子…</h2><div class="mk l"><h3 class="bd b fv z el mi eo ep mj er et ek translated">编写智能合同当然不是一件轻松的事情。代码中引入的一个bug需要花钱，而且很可能不需要…</h3></div><div class="ml l"><p class="bd b gc z el mi eo ep mj er et ek translated">medium.com</p></div></div></div></a></div></div></div>    
</body>
</html>