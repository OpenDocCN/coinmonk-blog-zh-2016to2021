<html>
<head>
<title>Build a Tezos dapp using Taquito and the Beacon SDK</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Taquito和Beacon SDK构建一个Tezos dapp</h1>
<blockquote>原文：<a href="https://medium.com/coinmonks/build-a-tezos-dapp-using-taquito-and-the-beacon-sdk-692d7dc822aa?source=collection_archive---------0-----------------------#2020-06-25">https://medium.com/coinmonks/build-a-tezos-dapp-using-taquito-and-the-beacon-sdk-692d7dc822aa?source=collection_archive---------0-----------------------#2020-06-25</a></blockquote><div><div class="ef hh hi hj hk hl"/><div class="hm hn ho hp hq"><div class=""/><div class=""><h2 id="75fa" class="pw-subtitle-paragraph iq hs ht bd b ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ek translated">使用Tezos开发中最热门的两种技术来构建dapp</h2></div><figure class="jj jk jl jm fq jn fe ff paragraph-image"><div role="button" tabindex="0" class="jo jp di jq bf jr"><div class="fe ff ji"><img src="../Images/116334dc89d8316790f4f752042a1d0e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1eE5Ol-n12DeQMksDerk7Q.jpeg"/></div></div><figcaption class="ju jv fg fe ff jw jx bd b be z ek"><a class="ae jy" href="https://www.vecteezy.com/free-vector/background" rel="noopener ugc nofollow" target="_blank">Background Vectors by Vecteezy</a></figcaption></figure><blockquote class="jz ka kb"><p id="eea6" class="kc kd ke kf b kg kh iu ki kj kk ix kl km kn ko kp kq kr ks kt ku kv kw kx ky hm dt translated">注意:自本文撰写以来，Taquito和Beacon方面已经有了很多更新。要构建使用这两个库的最新版本的dapp，您可以查看<a class="ae jy" href="https://news.ecadlabs.com/how-to-build-your-first-tezos-dapp-2021-edition-b1263b4ba016" rel="noopener ugc nofollow" target="_blank">如何在2021年</a>构建您的第一个dapp。</p></blockquote><p id="85f9" class="pw-post-body-paragraph kc kd ht kf b kg kh iu ki kj kk ix kl kz kn ko kp la kr ks kt lb kv kw kx ky hm dt translated">在过去的六个月里，Tezos上的dapp开发环境已经发生了很大的变化。它从痛苦而漫长的努力变成了公园里的散步。这种变化之所以成为可能，是因为引入了强大的工具，允许开发人员专注于为他们的<a class="ae jy" href="https://blog.coincodecap.com/what-are-dapps-an-ultimate-guide" rel="noopener ugc nofollow" target="_blank">dapp</a>提供价值和功能，而忘记将他们的dapp插入区块链的技术细节。</p><p id="0907" class="pw-post-body-paragraph kc kd ht kf b kg kh iu ki kj kk ix kl kz kn ko kp la kr ks kt lb kv kw kx ky hm dt translated"><a class="ae jy" href="https://tezostaquito.io/" rel="noopener ugc nofollow" target="_blank"> Taquito </a>不需要任何介绍，它是连接您的Tezos dapp和区块链的事实上的工具。但是不要让它的垄断地位诱惑你，它是一个令人惊叹的工具，会让你作为开发者的工作快100倍，也容易100倍。通过几行代码，您的dapp将被设置并连接到区块链和您的智能合约。Taquito将在后台完成所有繁重的工作，因此您不必担心。</p><p id="6654" class="pw-post-body-paragraph kc kd ht kf b kg kh iu ki kj kk ix kl kz kn ko kp la kr ks kt lb kv kw kx ky hm dt translated"><a class="ae jy" href="https://www.walletbeacon.io/" rel="noopener ugc nofollow" target="_blank"> Beacon </a>是由<a class="ae jy" href="https://airgap.it/" rel="noopener ugc nofollow" target="_blank"> Airgap </a>开发的一个工具包，它连接到一个钱包(目前是连接到Airgap钱包)并对要发送到网络的交易进行签名。稳定版是最近才推出的，但已经很有前景了。我们将在本教程中使用Beacon扩展来签署交易，但您也可以使用手机上的钱包！Beacon提供了一个简单、时尚、高效的界面，包含大量信息和可定制的选项！</p><p id="7061" class="pw-post-body-paragraph kc kd ht kf b kg kh iu ki kj kk ix kl kz kn ko kp la kr ks kt lb kv kw kx ky hm dt translated">对于本教程，我选择普通JavaScript来编写dapp，因为它将为您提供使用Taquito和Beacon wallet所需的所有信息，并使代码适应您喜欢的任何框架。我们将构建的dapp非常简单，它连接到我在Carthagenet ( <em class="ke"> testnet </em>)上部署的演示智能合约，以测试不同的功能，dapp有一个按钮来连接您的钱包，一个简单的界面，带有来自区块链和智能合约的信息，它为您提供了两个选项来将数据保存到智能合约中。为了继续阅读，你必须至少掌握HTML/CSS/JS的基本知识，以及<a class="ae jy" href="https://blog.coincodecap.com/tezos-blockchain-a-simple-overview-for-beginners/" rel="noopener ugc nofollow" target="_blank">Tezos区块链是如何工作的</a>。</p></div><div class="ab cl lc ld hb le" role="separator"><span class="lf bw bk lg lh li"/><span class="lf bw bk lg lh li"/><span class="lf bw bk lg lh"/></div><div class="hm hn ho hp hq"><h1 id="590a" class="lj lk ht bd ll lm ln lo lp lq lr ls lt iz lu ja lv jc lw jd lx jf ly jg lz ma dt translated">准备工作区</h1><p id="246d" class="pw-post-body-paragraph kc kd ht kf b kg mb iu ki kj mc ix kl kz md ko kp la me ks kt lb mf kw kx ky hm dt translated">由于本教程并不关注HTML或CSS，我准备了一个样板文件，您可以从Github下载，这样我们就可以更快地开始编写一些JavaScript了😉你会在这个地址找到整个项目<a class="ae jy" href="https://github.com/claudebarde/taquito-beacon-tutorial" rel="noopener ugc nofollow" target="_blank">。您可以跟随本教程并查看。或者你可以删除这个文件，从零开始。</a></p><p id="f753" class="pw-post-body-paragraph kc kd ht kf b kg kh iu ki kj kk ix kl kz kn ko kp la kr ks kt lb kv kw kx ky hm dt translated">首先要做的是下载必要的包。您可以简单地从项目的根目录运行<code class="eh mg mh mi mj b">npm install</code>并检查<code class="eh mg mh mi mj b">package.json</code>文件。您将看到创建Tezos dapp所需的两个主要依赖项:<code class="eh mg mh mi mj b">@taquito/taquito ^6.3.0-wallet.4</code>和<code class="eh mg mh mi mj b">@taquito/beacon-wallet ^6.3.1-beta.0</code>。这些是本教程发布时可用的最新版本。</p><blockquote class="jz ka kb"><p id="c0ac" class="kc kd ke kf b kg kh iu ki kj kk ix kl km kn ko kp kq kr ks kt ku kv kw kx ky hm dt translated">注意:你不需要安装<code class="eh mg mh mi mj b">@airgap/beacon-sdk</code>，因为Taquito会帮你安装！</p></blockquote><p id="a4fd" class="pw-post-body-paragraph kc kd ht kf b kg kh iu ki kj kk ix kl kz kn ko kp la kr ks kt lb kv kw kx ky hm dt translated">如果你检查HTML文件，你会看到它非常简单，一个<code class="eh mg mh mi mj b">main</code>标签包含两个<code class="eh mg mh mi mj b">divs</code>:一个会显示连接你钱包的按钮，一个会显示合约界面。</p><p id="a39c" class="pw-post-body-paragraph kc kd ht kf b kg kh iu ki kj kk ix kl kz kn ko kp la kr ks kt lb kv kw kx ky hm dt translated"><code class="eh mg mh mi mj b">style.css</code>文件包含基本的样式信息，您可能已经注意到了一个<code class="eh mg mh mi mj b">toast.css</code>文件，我们稍后将覆盖Beacon wallet的一些特性时会用到它。</p><p id="0229" class="pw-post-body-paragraph kc kd ht kf b kg kh iu ki kj kk ix kl kz kn ko kp la kr ks kt lb kv kw kx ky hm dt translated">此时，您应该已经在浏览器中安装了Beacon扩展。如果没有，请按照这些说明进行安装。您将需要它来与dapp中的智能合约进行交互。</p></div><div class="ab cl lc ld hb le" role="separator"><span class="lf bw bk lg lh li"/><span class="lf bw bk lg lh li"/><span class="lf bw bk lg lh"/></div><div class="hm hn ho hp hq"><h1 id="ecb3" class="lj lk ht bd ll lm ln lo lp lq lr ls lt iz lu ja lv jc lw jd lx jf ly jg lz ma dt translated">连接您的钱包</h1><p id="9c82" class="pw-post-body-paragraph kc kd ht kf b kg mb iu ki kj mc ix kl kz md ko kp la me ks kt lb mf kw kx ky hm dt translated">让我们现在开始编码吧😅</p><p id="ca2e" class="pw-post-body-paragraph kc kd ht kf b kg kh iu ki kj kk ix kl kz kn ko kp la kr ks kt lb kv kw kx ky hm dt translated">打开一个名为“<em class="ke"> index.js </em>的新JS文件。首先，让我们导入我们需要的依赖项。如果您检查了Github repo中提供的<code class="eh mg mh mi mj b">index.js</code>文件，您可能会在顶部看到<code class="eh mg mh mi mj b">import "babel-polyfill"</code>。这仅需要与本项目中使用的捆扎机<a class="ae jy" href="https://parceljs.org/" rel="noopener ugc nofollow" target="_blank">包</a>一起使用ES6语法。</p><p id="7e95" class="pw-post-body-paragraph kc kd ht kf b kg kh iu ki kj kk ix kl kz kn ko kp la kr ks kt lb kv kw kx ky hm dt translated">接下来，我们导入这个项目所必需的两个依赖项:</p><figure class="jj jk jl jm fq jn fe ff paragraph-image"><div role="button" tabindex="0" class="jo jp di jq bf jr"><div class="fe ff mk"><img src="../Images/81a5269dabc41bec8705dd0263bdebbd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HZ80Ys8u7aAhdVMF-lKL1Q.png"/></div></div></figure><p id="c025" class="pw-post-body-paragraph kc kd ht kf b kg kh iu ki kj kk ix kl kz kn ko kp la kr ks kt lb kv kw kx ky hm dt translated">第一行导入了创建<code class="eh mg mh mi mj b">wallet</code>对象所需的<code class="eh mg mh mi mj b">BeaconWallet</code>类。第二行从Taquito导入<code class="eh mg mh mi mj b">Tezos</code>对象。这是一个多用途的物体，我们将在不同的情况下使用。您还可以看到，我们初始化了一个名为<code class="eh mg mh mi mj b">contractAddress</code>的变量，该变量将保存<a class="ae jy" href="https://better-call.dev/carthagenet/KT1PCLg8Da8T5h5SWibMopPVsxiKg27tSRxx/operations" rel="noopener ugc nofollow" target="_blank">我们想要连接到的契约</a>的地址(在地址可能经常改变的开发过程中非常有用)。</p><p id="706d" class="pw-post-body-paragraph kc kd ht kf b kg kh iu ki kj kk ix kl kz kn ko kp la kr ks kt lb kv kw kx ky hm dt translated">当你运行<code class="eh mg mh mi mj b">npm run dev</code>并在<code class="eh mg mh mi mj b"><a class="ae jy" href="http://localhost:1234," rel="noopener ugc nofollow" target="_blank">http://localhost:1234</a></code><a class="ae jy" href="http://localhost:1234," rel="noopener ugc nofollow" target="_blank"/>上打开一个新窗口时，你会看到一个大的蓝绿色按钮。这是您将点击以连接您的钱包的按钮。首先，我们必须将它连接到初始化钱包的函数:</p><figure class="jj jk jl jm fq jn fe ff paragraph-image"><div role="button" tabindex="0" class="jo jp di jq bf jr"><div class="fe ff mk"><img src="../Images/46ed21bcc03a485906c39a0e6714f11c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*f3Xy4d47B2wvLL8Hg1ByHg.png"/></div></div></figure><p id="ba52" class="pw-post-body-paragraph kc kd ht kf b kg kh iu ki kj kk ix kl kz kn ko kp la kr ks kt lb kv kw kx ky hm dt translated">之后，我们可以开始编写钱包初始化的不同步骤:</p><figure class="jj jk jl jm fq jn fe ff paragraph-image"><div role="button" tabindex="0" class="jo jp di jq bf jr"><div class="fe ff mk"><img src="../Images/646fbeb89c824aea7817f1fbbcc9a2cd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Aj00qRU9Ec6qjzLCLpKLYg.png"/></div></div></figure><p id="826b" class="pw-post-body-paragraph kc kd ht kf b kg kh iu ki kj kk ix kl kz kn ko kp la kr ks kt lb kv kw kx ky hm dt translated">请注意，该函数必须是异步的。下一步包括设置我们之前导入的<code class="eh mg mh mi mj b">Tezos</code>对象。我们将通过调用它的<code class="eh mg mh mi mj b">setProvider</code>方法告诉它我们想要连接到哪个网络(这里是<em class="ke"> Carthagenet </em>):</p><figure class="jj jk jl jm fq jn fe ff paragraph-image"><div role="button" tabindex="0" class="jo jp di jq bf jr"><div class="fe ff ml"><img src="../Images/c47490c06aef313f96e28e0d34559edc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_vOoGgYYdfKWuP9rgNVJ4Q.png"/></div></div></figure><p id="6439" class="pw-post-body-paragraph kc kd ht kf b kg kh iu ki kj kk ix kl kz kn ko kp la kr ks kt lb kv kw kx ky hm dt translated">我通常建议将钱包初始化或交易过程的步骤打包到一个<code class="eh mg mh mi mj b">try ... catch ...</code>语句中，因为很多事情都可能出错，如果事情没有按预期进行，通知用户是至关重要的。</p><p id="e9e2" class="pw-post-body-paragraph kc kd ht kf b kg kh iu ki kj kk ix kl kz kn ko kp la kr ks kt lb kv kw kx ky hm dt translated"><code class="eh mg mh mi mj b">Tezos</code> singleton实例，即从<code class="eh mg mh mi mj b">@taquito/taquito</code>导入的对象(在文档中称为<code class="eh mg mh mi mj b"><a class="ae jy" href="https://tezostaquito.io/typedoc/classes/_taquito_taquito.tezostoolkit.html" rel="noopener ugc nofollow" target="_blank">TezosToolkit</a></code>)有一个名为<code class="eh mg mh mi mj b">setProvider</code>的方法，该方法接受一个具有<a class="ae jy" href="https://tezostaquito.io/typedoc/classes/_taquito_taquito.tezostoolkit.html#setprovider" rel="noopener ugc nofollow" target="_blank">不同属性</a>的对象，其中一个名为<code class="eh mg mh mi mj b">rpc</code>，该属性必须是到Tezos节点RPC接口的链接。我一般用SmartPy提供的，你也可以用自己喜欢的。</p><p id="56df" class="pw-post-body-paragraph kc kd ht kf b kg kh iu ki kj kk ix kl kz kn ko kp la kr ks kt lb kv kw kx ky hm dt translated">既然我们已经告诉了我们的dapp我们想要连接到哪个网络，那么现在是时候照顾好钱包了！首先，我们用从库中导入的类创建一个新的Beacon wallet实例:</p><figure class="jj jk jl jm fq jn fe ff paragraph-image"><div role="button" tabindex="0" class="jo jp di jq bf jr"><div class="fe ff ml"><img src="../Images/aa6a8243853371c7cdef0ebeb9409d01.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vALX6UmJUMCSrjE1_rF9CQ.png"/></div></div></figure><p id="22ba" class="pw-post-body-paragraph kc kd ht kf b kg kh iu ki kj kk ix kl kz kn ko kp la kr ks kt lb kv kw kx ky hm dt translated">新的<code class="eh mg mh mi mj b">wallet</code>对象必须用包含不同选项的对象实例化。至少，您应该为您的dapp提供一个名称，它将出现在用于签署交易的弹出窗口中。我们稍后将添加更多选项。</p><blockquote class="jz ka kb"><p id="5b1a" class="kc kd ke kf b kg kh iu ki kj kk ix kl km kn ko kp kq kr ks kt ku kv kw kx ky hm dt translated">在钱包中设置您的dapp的名称对于一般用户体验来说是一个重要的细节，因为您的dapp的用户将知道他们正在使用的dapp触发了弹出窗口，而不是其他东西。</p></blockquote><p id="fa4a" class="pw-post-body-paragraph kc kd ht kf b kg kh iu ki kj kk ix kl kz kn ko kp la kr ks kt lb kv kw kx ky hm dt translated">然后，用<code class="eh mg mh mi mj b">new BeaconWallet(options)</code>创建一个新的钱包。一旦创建了新的钱包，您就可以通过创建一个带有<code class="eh mg mh mi mj b">type</code>属性的对象来设置您想要连接的网络。默认情况下，信标钱包将连接到<code class="eh mg mh mi mj b">mainnet</code>，但是您也可以使用<code class="eh mg mh mi mj b">carthagenet</code>值连接到Carthagenet或<code class="eh mg mh mi mj b">custom</code>连接到沙盒节点。如果您愿意，您还可以使用<code class="eh mg mh mi mj b">rpcUrl</code>属性指定您想要连接到的RPC URL(如果没有提供，wallet将连接到它的默认RPC访问点)。</p><p id="b92d" class="pw-post-body-paragraph kc kd ht kf b kg kh iu ki kj kk ix kl kz kn ko kp la kr ks kt lb kv kw kx ky hm dt translated">在您决定了网络之后，<code class="eh mg mh mi mj b">wallet</code>对象提供了一个<code class="eh mg mh mi mj b">requestPermissions</code>方法，该方法将请求连接到指定网络并代表您签署交易的许可。一旦允许，你的钱包就配置好了，可以使用了！在此配置步骤中要做的最后一件事是将wallet设置为Taquito的默认wallet:</p><figure class="jj jk jl jm fq jn fe ff paragraph-image"><div role="button" tabindex="0" class="jo jp di jq bf jr"><div class="fe ff ml"><img src="../Images/5221f8e7c1a9de076d0fa5aa382b813f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*T-5FUNEtunEVHCjV1F4YDA.png"/></div></div></figure><p id="a708" class="pw-post-body-paragraph kc kd ht kf b kg kh iu ki kj kk ix kl kz kn ko kp la kr ks kt lb kv kw kx ky hm dt translated">新的Wallet API在<code class="eh mg mh mi mj b">Tezos</code>对象上提供了一个<code class="eh mg mh mi mj b">setWalletProvider</code>方法，允许您向Taquito指示您想要使用的Wallet(在设置好之后)。从现在开始，Taquito将使用Beacon钱包发送交易！</p></div><div class="ab cl lc ld hb le" role="separator"><span class="lf bw bk lg lh li"/><span class="lf bw bk lg lh li"/><span class="lf bw bk lg lh"/></div><div class="hm hn ho hp hq"><h1 id="c9ea" class="lj lk ht bd ll lm ln lo lp lq lr ls lt iz lu ja lv jc lw jd lx jf ly jg lz ma dt translated">更新dapp界面</h1><p id="e957" class="pw-post-body-paragraph kc kd ht kf b kg mb iu ki kj mc ix kl kz md ko kp la me ks kt lb mf kw kx ky hm dt translated">当你创建一个dapp时，总是建议给你的用户提供关于他们账户的基本信息，比如他们的地址和余额。这种反馈表明他们的钱包设置正确，并且dapp连接到区块链和他们的钱包。</p><p id="44b8" class="pw-post-body-paragraph kc kd ht kf b kg kh iu ki kj kk ix kl kz kn ko kp la kr ks kt lb kv kw kx ky hm dt translated">初始化钱包后，你可以很容易地从<code class="eh mg mh mi mj b">wallet.permissions.address</code>获得用户的地址。一旦有了地址，就可以使用Taquito提供的<code class="eh mg mh mi mj b">Tezos</code>对象获得用户的余额:</p><figure class="jj jk jl jm fq jn fe ff paragraph-image"><div role="button" tabindex="0" class="jo jp di jq bf jr"><div class="fe ff ml"><img src="../Images/47460089bd78eee4792d0dc505f96b6c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vfyIkzFQ3TerJVyuLDNlUw.png"/></div></div></figure><p id="e34c" class="pw-post-body-paragraph kc kd ht kf b kg kh iu ki kj kk ix kl kz kn ko kp la kr ks kt lb kv kw kx ky hm dt translated">同时，将契约实例保存在内存中会很有用，这样我们在向区块链发送事务时就可以方便地访问它。多功能的<code class="eh mg mh mi mj b">Tezos</code>物体将再次帮助我们。在新的Wallet API下，使用<code class="eh mg mh mi mj b">Tezos.wallet.at(contractAddress)</code>为您提供了智能契约的抽象。在此过程中，我们可以使用同一个抽象实例来获取契约的存储，并通过调用契约实例上的<code class="eh mg mh mi mj b">storage</code>方法，使用直接来自契约的数据进一步更新我们的dapp接口:</p><figure class="jj jk jl jm fq jn fe ff paragraph-image"><div role="button" tabindex="0" class="jo jp di jq bf jr"><div class="fe ff ml"><img src="../Images/b4dfeaa480d7dde947f30513d12123a7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6cswooRUN1c-zAUO9O362w.png"/></div></div></figure><p id="e536" class="pw-post-body-paragraph kc kd ht kf b kg kh iu ki kj kk ix kl kz kn ko kp la kr ks kt lb kv kw kx ky hm dt translated">现在在现实生活中，你可能会使用一个框架来构建你的dapp，比如React或Vue，但是我们在这里使用的是普通的JS，所以我们必须手动更新DOM。我创建了一个简单的函数来更新HTML标签中的文本，以遵循<a class="ae jy" href="https://en.wikipedia.org/wiki/Don%27t_repeat_yourself" rel="noopener ugc nofollow" target="_blank"> DRY(不要重复自己)原则</a>。首先，我们希望隐藏“Connect”按钮并显示dapp界面，然后用我们从智能合约中获得的数据更新所有值:</p><figure class="jj jk jl jm fq jn fe ff paragraph-image"><div role="button" tabindex="0" class="jo jp di jq bf jr"><div class="fe ff ml"><img src="../Images/7c7adadc972f404e6e51eb54746e9a19.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5G7d0aSSo-azAlPRQUCXpg.png"/></div></div></figure><p id="be83" class="pw-post-body-paragraph kc kd ht kf b kg kh iu ki kj kk ix kl kz kn ko kp la kr ks kt lb kv kw kx ky hm dt translated">这里有一些一般性的观察:</p><ul class=""><li id="f61e" class="mm mn ht kf b kg kh kj kk kz mo la mp lb mq ky mr ms mt mu dt translated">为了避免不必要的代码多次请求地址和余额，我通常更喜欢将用户的地址和余额放在顶层，并在代码的任何地方都可以访问。大多数钱包在用户登录和退出时调度事件，您可以拦截这些事件来修改地址或余额(我们将在后面看到)。</li><li id="fe1c" class="mm mn ht kf b kg mv kj mw kz mx la my lb mz ky mr ms mt mu dt translated">余额总是在microtez中返回，这对于计算来说很好，但是对于dapp用户来说很难阅读。不要忘记用余额除以<code class="eh mg mh mi mj b">1,000,000</code>来得到一个更易读的数字。你可以多做一点，把它弄圆，然后用<code class="eh mg mh mi mj b">toLocaleString("en-US")</code>让它变得更漂亮！</li><li id="338a" class="mm mn ht kf b kg mv kj mw kz mx la my lb mz ky mr ms mt mu dt translated">Taquito将值保存在存储器中，作为由<code class="eh mg mh mi mj b">contractInstance.storage()</code>返回的对象的属性。这样就很容易访问存储中的值(除了稍微复杂一点的地图和大地图)。</li></ul></div><div class="ab cl lc ld hb le" role="separator"><span class="lf bw bk lg lh li"/><span class="lf bw bk lg lh li"/><span class="lf bw bk lg lh"/></div><div class="hm hn ho hp hq"><h1 id="4911" class="lj lk ht bd ll lm ln lo lp lq lr ls lt iz lu ja lv jc lw jd lx jf ly jg lz ma dt translated">更新智能合约中的消息</h1><p id="9edb" class="pw-post-body-paragraph kc kd ht kf b kg mb iu ki kj mc ix kl kz md ko kp la me ks kt lb mf kw kx ky hm dt translated">现在我们的dapp已经准备好玩智能合约了！</p><p id="b21c" class="pw-post-body-paragraph kc kd ht kf b kg kh iu ki kj kk ix kl kz kn ko kp la kr ks kt lb kv kw kx ky hm dt translated">Github存储库中提供的JavaScript文件包含3个函数，用于更改智能合约中的消息和递增/递减一个整数值。我们将在这里编写<code class="eh mg mh mi mj b">changeMessage</code>函数，你也可以尝试自己编写<code class="eh mg mh mi mj b">increment</code>和<code class="eh mg mh mi mj b">decrement</code>函数(如果需要帮助，请发表评论)！</p><p id="99e6" class="pw-post-body-paragraph kc kd ht kf b kg kh iu ki kj kk ix kl kz kn ko kp la kr ks kt lb kv kw kx ky hm dt translated">首先，我们创建一个<code class="eh mg mh mi mj b">changeMessage</code>函数，并将其附加到id为<code class="eh mg mh mi mj b">update-message</code>的按钮的<code class="eh mg mh mi mj b">click</code>事件上:</p><figure class="jj jk jl jm fq jn fe ff paragraph-image"><div role="button" tabindex="0" class="jo jp di jq bf jr"><div class="fe ff na"><img src="../Images/327c1a60d0186ce5ce170d53094e2da1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kxYa1GKwvmIHWf_iVKsHsw.png"/></div></div></figure><p id="f12a" class="pw-post-body-paragraph kc kd ht kf b kg kh iu ki kj kk ix kl kz kn ko kp la kr ks kt lb kv kw kx ky hm dt translated">这是记住一些用户体验建议的好时机。许多dapp用户没有意识到，在mainnet上向一个块添加一个事务实际上需要一分钟(在testnet上大约需要30秒)，他们中的一些人会失去耐心，多次点击确认按钮。这将创建多个交易，他们可能会接受，认为第一个交易没有通过。你必须阻止它。当他们确认一个交易时，你应该禁用界面中可操作的部分，并清楚地告诉他们必须等待。这是接下来两行代码的目标:</p><figure class="jj jk jl jm fq jn fe ff paragraph-image"><div role="button" tabindex="0" class="jo jp di jq bf jr"><div class="fe ff na"><img src="../Images/df670e57632e8be5b1bd16b9ffe3ea57.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-0JGZ20_tlJYKnMZC_yg5w.png"/></div></div></figure><p id="d4be" class="pw-post-body-paragraph kc kd ht kf b kg kh iu ki kj kk ix kl kz kn ko kp la kr ks kt lb kv kw kx ky hm dt translated">现在，在当前事务处理完之前，您的用户不能发送新的事务，他们会看到一个小的微调按钮，表示有东西正在加载，他们应该等待😊同时，我们得到他们在输入中输入的信息。如果您愿意，您可以检查是否有消息或者字符串是否遵循某些规则。</p><p id="fd44" class="pw-post-body-paragraph kc kd ht kf b kg kh iu ki kj kk ix kl kz kn ko kp la kr ks kt lb kv kw kx ky hm dt translated">接下来，是时候再次使用Taquito并发送事务以将消息保存到智能合约中:</p><figure class="jj jk jl jm fq jn fe ff paragraph-image"><div role="button" tabindex="0" class="jo jp di jq bf jr"><div class="fe ff nb"><img src="../Images/f07d9f5c8c6bf0e29bf0cf8c73e5277c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cqiqgIDcpgpqvrXIqLceYQ.png"/></div></div></figure><p id="32c6" class="pw-post-body-paragraph kc kd ht kf b kg kh iu ki kj kk ix kl kz kn ko kp la kr ks kt lb kv kw kx ky hm dt translated">下面是几行代码中发生的情况:</p><ol class=""><li id="5687" class="mm mn ht kf b kg kh kj kk kz mo la mp lb mq ky nc ms mt mu dt translated">我们使用一个<code class="eh mg mh mi mj b">try ... catch ... finally ...</code>语句来包装事务。如果事务由于任何原因失败，您必须通知您的用户，这样他们就可以停止等待，也许可以自己解决问题。</li><li id="60de" class="mm mn ht kf b kg mv kj mw kz mx la my lb mz ky nc ms mt mu dt translated">我们之前保存的契约实例公开了一个<code class="eh mg mh mi mj b">methods</code>属性，该属性包含反映智能契约的入口点的自身属性。在这种情况下，我们想调用<code class="eh mg mh mi mj b">changeMessage</code>，它需要一个字符串作为参数。结果提供了一个<code class="eh mg mh mi mj b">send</code>方法，该方法将把事务发送到Tezos节点，并返回一个承诺，该承诺通过一个事务操作对象进行解析。</li><li id="13fe" class="mm mn ht kf b kg mv kj mw kz mx la my lb mz ky nc ms mt mu dt translated">交易发送后，您必须等待其确认。上面一行返回的事务操作对象提供了一个<code class="eh mg mh mi mj b">confirmation</code>方法。如果没有提供参数，Taquito等待1个块确认。如果您提供一个数字<code class="eh mg mh mi mj b">n</code>作为参数，Taquito将在执行下面几行之前等待<code class="eh mg mh mi mj b">n</code>阻塞确认。</li><li id="21d0" class="mm mn ht kf b kg mv kj mw kz mx la my lb mz ky nc ms mt mu dt translated">如果事务失败，您将获得一个<code class="eh mg mh mi mj b">error</code>对象，可以用它向用户显示一条消息。</li><li id="21c4" class="mm mn ht kf b kg mv kj mw kz mx la my lb mz ky nc ms mt mu dt translated">在事务处理完成或失败之后，您希望通过启用确认按钮并删除微调器来将界面返回到工作状态。</li></ol><p id="59d3" class="pw-post-body-paragraph kc kd ht kf b kg kh iu ki kj kk ix kl kz kn ko kp la kr ks kt lb kv kw kx ky hm dt translated">交易确认后，您可以做几件事:</p><figure class="jj jk jl jm fq jn fe ff paragraph-image"><div role="button" tabindex="0" class="jo jp di jq bf jr"><div class="fe ff nb"><img src="../Images/4b21af95b089850be87c272be8289b0a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*n6ZrRXMa94JEYc-p7P4-Yw.png"/></div></div></figure><ol class=""><li id="07a4" class="mm mn ht kf b kg kh kj kk kz mo la mp lb mq ky nc ms mt mu dt translated">您可以重置消息的值。一般来说，这是一个很好的线索，表明发生了一些事情，消息“消失了”。</li><li id="561c" class="mm mn ht kf b kg mv kj mw kz mx la my lb mz ky nc ms mt mu dt translated">你应该刷新存储器。虽然您也可以只更新包含来自存储区的消息的HTML标记，但最好在事务处理后获取一个新的存储区，以防在事务处理过程中发生其他变化。如果你使用一个框架，你可能有一个带有<code class="eh mg mh mi mj b">storage</code>属性的状态，获取一个新的存储将会更新链接到该状态的接口中的所有数据。</li><li id="a7df" class="mm mn ht kf b kg mv kj mw kz mx la my lb mz ky nc ms mt mu dt translated">您可以做一些其他小的更新，例如获取用户的新余额，以反映交易中记入借方的汽油费用。</li></ol></div><div class="ab cl lc ld hb le" role="separator"><span class="lf bw bk lg lh li"/><span class="lf bw bk lg lh li"/><span class="lf bw bk lg lh"/></div><div class="hm hn ho hp hq"><h1 id="19b8" class="lj lk ht bd ll lm ln lo lp lq lr ls lt iz lu ja lv jc lw jd lx jf ly jg lz ma dt translated">定制Beacon SDK</h1><p id="68d8" class="pw-post-body-paragraph kc kd ht kf b kg mb iu ki kj mc ix kl kz md ko kp la me ks kt lb mf kw kx ky hm dt translated">Beacon SDK提供了多种方式来定制用户的钱包体验。让我们在这里检查其中一个。</p><p id="2fd4" class="pw-post-body-paragraph kc kd ht kf b kg kh iu ki kj kk ix kl kz kn ko kp la kr ks kt lb kv kw kx ky hm dt translated">发送交易以更新智能合约后，您可以在dapp中看到一个弹出窗口，为您提供有关交易的有用信息:</p><figure class="jj jk jl jm fq jn fe ff paragraph-image"><div role="button" tabindex="0" class="jo jp di jq bf jr"><div class="fe ff nd"><img src="../Images/440b4bde6182821fe471c27fdab1c434.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TprSjpS0_jeYa31IF9hZKg.jpeg"/></div></div></figure><p id="7a56" class="pw-post-body-paragraph kc kd ht kf b kg kh iu ki kj kk ix kl kz kn ko kp la kr ks kt lb kv kw kx ky hm dt translated">也许您不希望这个弹出窗口出现，并且您希望提供一个定制的响应，比如祝酒词。不要害怕，因为只需要2分钟就可以完成！</p><p id="55f8" class="pw-post-body-paragraph kc kd ht kf b kg kh iu ki kj kk ix kl kz kn ko kp la kr ks kt lb kv kw kx ky hm dt translated">让我们回到过去。你还记得我们是如何创造新的Beacon钱包的吗？用<code class="eh mg mh mi mj b">new BeaconWallet(options)</code>。对象包含了你的dapp的名字。事实证明，您可以提供更多选项来定制您的dapp！在本教程中，我们将使用一个祝酒词来通知我们的用户，交易已成功发送到网络！</p><p id="b535" class="pw-post-body-paragraph kc kd ht kf b kg kh iu ki kj kk ix kl kz kn ko kp la kr ks kt lb kv kw kx ky hm dt translated">在HTML文件中，你可以在最底部看到toast:<code class="eh mg mh mi mj b">&lt;div id="toast"&gt;Some text...&lt;/div&gt;</code>。在JS文件中，让我们添加一个函数，该函数将在toast中显示一条消息，并在3秒钟后显示和隐藏该消息:</p><figure class="jj jk jl jm fq jn fe ff paragraph-image"><div role="button" tabindex="0" class="jo jp di jq bf jr"><div class="fe ff ne"><img src="../Images/cc4fe7e171629232bbe311d51ab6752e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0RL7xr47flWBa44gP6zPvw.png"/></div></div></figure><p id="8e84" class="pw-post-body-paragraph kc kd ht kf b kg kh iu ki kj kk ix kl kz kn ko kp la kr ks kt lb kv kw kx ky hm dt translated">首先，我们将toast延迟3秒钟，因为在您确认交易后，Beacon wallet窗口大约需要2秒钟才能关闭。然后我们更新toast中的消息，我们显示它3秒钟，然后再次隐藏它。</p><p id="5321" class="pw-post-body-paragraph kc kd ht kf b kg kh iu ki kj kk ix kl kz kn ko kp la kr ks kt lb kv kw kx ky hm dt translated">现在，让我们回到钱包初始化选项，看起来应该是这样的:</p><figure class="jj jk jl jm fq jn fe ff paragraph-image"><div role="button" tabindex="0" class="jo jp di jq bf jr"><div class="fe ff nf"><img src="../Images/b2d86d2e057c42d8d44d3b2d9a3fcd84.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WZ3ff8WBUBidZHGcmVFAiA.png"/></div></div></figure><p id="92f9" class="pw-post-body-paragraph kc kd ht kf b kg kh iu ki kj kk ix kl kz kn ko kp la kr ks kt lb kv kw kx ky hm dt translated">我们将向<code class="eh mg mh mi mj b">options</code>对象添加一个<code class="eh mg mh mi mj b">eventHandlers</code>属性，告诉Beacon当事务请求成功发送时我们想要做什么。<code class="eh mg mh mi mj b">eventHandlers</code>属性接受一个对象，您可以根据想要捕捉的事件设置不同的属性。让我们看看它是如何在请求成功时调度事件的:</p><figure class="jj jk jl jm fq jn fe ff paragraph-image"><div role="button" tabindex="0" class="jo jp di jq bf jr"><div class="fe ff ng"><img src="../Images/961804c0043654ef3e1ee9d6b719754e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GYxdDJrdPnFK2hy0bPb_Dw.png"/></div></div></figure><p id="01aa" class="pw-post-body-paragraph kc kd ht kf b kg kh iu ki kj kk ix kl kz kn ko kp la kr ks kt lb kv kw kx ky hm dt translated">该属性必须是Github repo 的<a class="ae jy" href="https://github.com/airgap-it/beacon-sdk/blob/master/src/events.ts" rel="noopener ugc nofollow" target="_blank">枚举中列出的事件之一。每个事件处理程序接受一个带有<code class="eh mg mh mi mj b">handler</code>属性的对象，您可以将该属性设置为接收事件数据的承诺。当交易成功发送时，我们使用这个承诺来显示我们的祝酒辞。结果如下:</a></p><figure class="jj jk jl jm fq jn fe ff paragraph-image"><div role="button" tabindex="0" class="jo jp di jq bf jr"><div class="fe ff nh"><img src="../Images/4a6dda7eb7e824339489c1eb641d077a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NKihlj0u06tdnTTCQmY-Zw.jpeg"/></div></div></figure><p id="1c31" class="pw-post-body-paragraph kc kd ht kf b kg kh iu ki kj kk ix kl kz kn ko kp la kr ks kt lb kv kw kx ky hm dt translated">现在，默认的信标弹出窗口消失了，取而代之的是我们的祝酒词。使用这种非常简单的方法，您可以定制来自信标wallet的响应，例如在出现错误的情况下或针对不同的事件，如连接到wallet。当用户使用不同的地址登录时，您也可以使用它来更改用户的地址和余额。</p></div><div class="ab cl lc ld hb le" role="separator"><span class="lf bw bk lg lh li"/><span class="lf bw bk lg lh li"/><span class="lf bw bk lg lh"/></div><div class="hm hn ho hp hq"><h1 id="ec9d" class="lj lk ht bd ll lm ln lo lp lq lr ls lt iz lu ja lv jc lw jd lx jf ly jg lz ma dt translated">结论</h1><p id="0e9b" class="pw-post-body-paragraph kc kd ht kf b kg mb iu ki kj mc ix kl kz md ko kp la me ks kt lb mf kw kx ky hm dt translated">这个非常简单的dapp提供了一个机会来展示你现在可以用来构建Tezos的两个最好的工具的优势:Taquito和Beacon SDK。两者都提供了广泛的功能、高水平的定制和一个界面，允许开发人员编写更少的代码，更关注用户体验，而不是与Tezos节点交互的细节。</p><p id="7869" class="pw-post-body-paragraph kc kd ht kf b kg kh iu ki kj kk ix kl kz kn ko kp la kr ks kt lb kv kw kx ky hm dt translated">Taquito的新钱包API朝着使用不同钱包将dapp连接到区块链的方向迈出了一大步，Beacon wallet最终为Tezos dapps提供了一个安全、美观且易于使用的钱包解决方案。</p><blockquote class="ni"><p id="6160" class="nj nk ht bd nl nm nn no np nq nr ky ek translated"><a class="ae jy" href="https://coincodecap.com/?utm_source=coinmonks" rel="noopener ugc nofollow" target="_blank">直接在您的收件箱中获得最佳软件交易</a></p></blockquote><figure class="nt nu nv nw nx jn fe ff paragraph-image"><a href="https://coincodecap.com/?utm_source=coinmonks"><div class="fe ff ns"><img src="../Images/7c0b3dfdcbfea594cc0ae7d4f9bf6fcb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1168/format:webp/0*OJ-qb5G6i863msBB.png"/></div></a></figure><p id="fe5f" class="pw-post-body-paragraph kc kd ht kf b kg kh iu ki kj kk ix kl kz kn ko kp la kr ks kt lb kv kw kx ky hm dt translated">现在生态系统终于准备好迎接更多的dapp开发者了，所以让我们开始建设吧👷‍♀️👷‍♂️</p><p id="2115" class="pw-post-body-paragraph kc kd ht kf b kg kh iu ki kj kk ix kl kz kn ko kp la kr ks kt lb kv kw kx ky hm dt">👇</p><p id="495d" class="pw-post-body-paragraph kc kd ht kf b kg kh iu ki kj kk ix kl kz kn ko kp la kr ks kt lb kv kw kx ky hm dt translated">你也可以通过阅读<a class="ae jy" rel="noopener" href="/@jevonearth/the-start-of-a-better-dapp-wallet-story-for-tezos-7538a399724e"> Jev关于这个主题的最后一篇文章</a>来获得更多关于Taquito和Wallet API的信息。</p></div></div>    
</body>
</html>