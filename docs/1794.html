<html>
<head>
<title>Exploring Non-Fungible Token with Zeppelin Library (ERC721)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用Zeppelin库(ERC721)探索不可替换令牌</h1>
<blockquote>原文：<a href="https://medium.com/coinmonks/exploring-non-fungible-token-with-zeppelin-library-erc721-399cb180cfaf?source=collection_archive---------0-----------------------#2018-11-18">https://medium.com/coinmonks/exploring-non-fungible-token-with-zeppelin-library-erc721-399cb180cfaf?source=collection_archive---------0-----------------------#2018-11-18</a></blockquote><div><div class="ef hh hi hj hk hl"/><div class="hm hn ho hp hq"><div class=""/><h1 id="8376" class="iq ir ht bd is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn dt translated">概观</h1><p id="d598" class="pw-post-body-paragraph jo jp ht jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl hm dt translated">代币大体上可以分为两类:可替代代币和不可替代代币。有很多好文章都在讲区别。这里我只是用简单的例子。我们可以把<strong class="jq hu">代用币</strong>看作日常使用的硬币。如果我昨天向你借了一块钱，今天还给你一块钱，并不要求是同一个硬币，你也很高兴拿回一块钱，没有检查它实际上是你给我的硬币。它是可替换的令牌。对于<strong class="jq hu">不可替代代币</strong>，每个代币都有其独特的特征(颜色、大小、重量、序列号，或者只是一个描述)。一个很好的例子是，如果我们把一只宠物当作纪念品，你不会接受取回一只与我昨天向你借的宠物不同的宠物。每只宠物都是独一无二的。</p><p id="dab4" class="pw-post-body-paragraph jo jp ht jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hm dt translated">我最近读了一篇由CipherZ ( <a class="ae kr" rel="noopener" href="/coinmonks/a-simple-erc-721-example-c3f72b5aa19">链接</a>)发表的好文章，展示了一个简单的ERC-721例子。在本文中，有一个使用Zeppelin库的简单令牌契约<em class="ks"> MyERC721.sol </em>。我采用本文的第一部分，并且不使用本文中的测试步骤。相反，我使用Go Ethereum (geth)客户端与部署的契约进行交互，并观察这些函数是如何被调用的。</p><p id="95aa" class="pw-post-body-paragraph jo jp ht jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hm dt translated">这个部署是通过Truffle框架和一个运行在本地主机上的以太坊模拟器来完成的。包含两部分:<strong class="jq hu">部署MyERC721令牌契约</strong>和<strong class="jq hu">与MyERC721令牌</strong>交互。</p><h1 id="1805" class="iq ir ht bd is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn dt translated">部署MyERC721令牌协定</h1><p id="988c" class="pw-post-body-paragraph jo jp ht jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl hm dt translated">这包括以下步骤</p><ul class=""><li id="c1de" class="kt ku ht jq b jr km jv kn jz kv kd kw kh kx kl ky kz la lb dt translated">构建松露环境和契约代码</li><li id="65d1" class="kt ku ht jq b jr lc jv ld jz le kd lf kh lg kl ky kz la lb dt translated">启动以太坊模拟器(ganache-cli)</li><li id="21fc" class="kt ku ht jq b jr lc jv ld jz le kd lf kh lg kl ky kz la lb dt translated">部署MyERC721合同</li><li id="aad5" class="kt ku ht jq b jr lc jv ld jz le kd lf kh lg kl ky kz la lb dt translated">设置Geth控制台以访问已部署的合同</li></ul><h2 id="1183" class="lh ir ht bd is li lj lk iw ll lm ln ja jz lo lp je kd lq lr ji kh ls lt jm lu dt translated">构建松露环境和契约代码</h2><p id="c14f" class="pw-post-body-paragraph jo jp ht jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl hm dt translated">遵循原始文档中显示的说明。</p><p id="50bf" class="pw-post-body-paragraph jo jp ht jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hm dt translated">步骤1:创建一个项目目录并初始化Truffle环境。创建目录结构。</p><figure class="lw lx ly lz fq ma fe ff paragraph-image"><div class="fe ff lv"><img src="../Images/6cbaec44a3ddd52d5cdb69a384ce80a6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1174/0*LKVO7sTpRzFS6YX4"/></div></figure><p id="53b9" class="pw-post-body-paragraph jo jp ht jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hm dt translated">步骤2:初始npm和安装zeppelin依赖项(已截断)</p><figure class="lw lx ly lz fq ma fe ff paragraph-image"><div class="fe ff lv"><img src="../Images/3e6403ec47a36133a696b40401c14d15.png" data-original-src="https://miro.medium.com/v2/resize:fit:1174/0*OnSt2xdprlwVb8zh"/></div></figure><p id="7e1a" class="pw-post-body-paragraph jo jp ht jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hm dt translated">接受所有默认答案，在npm init之后，我们看到一个文件<em class="ks"> package.json </em>。</p><figure class="lw lx ly lz fq ma fe ff paragraph-image"><div class="fe ff lv"><img src="../Images/31ab4112784320ceb1bf9977b06730f3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1174/0*eHNft94gpMQ0MqT_"/></div></figure><p id="a17f" class="pw-post-body-paragraph jo jp ht jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hm dt translated">安装Zeppelin库。安装后，我们看到一个新的目录<em class="ks"> node_modules </em>和<em class="ks"> zeppelin-solidity </em>已经安装好了。</p><figure class="lw lx ly lz fq ma fe ff paragraph-image"><div class="fe ff lv"><img src="../Images/3e28e3ea5ba21cbfb943b5f085a00b87.png" data-original-src="https://miro.medium.com/v2/resize:fit:1174/0*sodT3ro7DG1n20Y4"/></div></figure><p id="4822" class="pw-post-body-paragraph jo jp ht jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hm dt translated">第三步:修改<em class="ks"> truffle.js </em>以包含本地主机以太坊模拟器。</p><pre class="lw lx ly lz fq md me mf mg aw mh dt"><span id="8730" class="lh ir ht me b fv mi mj l mk ml">module.exports = {<br/>  networks: {<br/>   development: {<br/>    host: '127.0.0.1',<br/>    port: 8545,<br/>    network_id: '*'<br/>   }<br/>  }<br/>};</span></pre><p id="6173" class="pw-post-body-paragraph jo jp ht jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hm dt translated">第四步:在<em class="ks"> /migrations </em>目录下添加<em class="ks"> 2_erc721_migration.js </em>。</p><pre class="lw lx ly lz fq md me mf mg aw mh dt"><span id="4e92" class="lh ir ht me b fv mi mj l mk ml">const MyERC721 = artifacts.require("./MyERC721.sol");</span><span id="420e" class="lh ir ht me b fv mm mj l mk ml">module.exports = async function(deployer) {<br/>  await deployer.deploy(MyERC721, "MyERC721 Token", "MyERC721")<br/>  const erc721 = await MyERC721.deployed()<br/>};</span></pre><p id="f3c6" class="pw-post-body-paragraph jo jp ht jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hm dt translated">请注意，这是我们稍后运行<strong class="jq hu"> truffle migrate </strong>时的实际部署。构造函数(我们稍后会看到)需要两个参数:名称和符号。原文章中使用了相同的名称。在这里，我修改它，使名称和符号是不一样的。</p><p id="483d" class="pw-post-body-paragraph jo jp ht jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hm dt translated">第五步:在/contracts目录下添加<em class="ks"> MyERC721.sol </em>契约。</p><pre class="lw lx ly lz fq md me mf mg aw mh dt"><span id="4f41" class="lh ir ht me b fv mi mj l mk ml">pragma solidity ^0.4.23;</span><span id="4f02" class="lh ir ht me b fv mm mj l mk ml">import "../node_modules/zeppelin-solidity/contracts/token/ERC721/ERC721Token.sol";</span><span id="ed72" class="lh ir ht me b fv mm mj l mk ml">contract MyERC721 is ERC721Token {<br/>    constructor (string _name, string _symbol) public<br/>        ERC721Token(_name, _symbol)<br/>    {<br/>    }</span><span id="3cbb" class="lh ir ht me b fv mm mj l mk ml">/**<br/>    * Custom accessor to create a unique token<br/>    */<br/>    function mintUniqueTokenTo(<br/>        address _to,<br/>        uint256 _tokenId,<br/>        string  _tokenURI<br/>    ) public<br/>    {<br/>        super._mint(_to, _tokenId);<br/>        super._setTokenURI(_tokenId, _tokenURI);<br/>    }<br/>}</span></pre><p id="8a08" class="pw-post-body-paragraph jo jp ht jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hm dt translated">合同代码的快速注释:</p><ul class=""><li id="648b" class="kt ku ht jq b jr km jv kn jz kv kd kw kh kx kl ky kz la lb dt translated">合同<em class="ks"> MyERC721 </em>正在使用<em class="ks"> ERC721Token </em></li><li id="42f9" class="kt ku ht jq b jr lc jv ld jz le kd lf kh lg kl ky kz la lb dt translated"><em class="ks"> MyERC721 </em>的构造函数需要两个参数:名称和符号</li><li id="de61" class="kt ku ht jq b jr lc jv ld jz le kd lf kh lg kl ky kz la lb dt translated">一个新的函数是<em class="ks"> mintUniqueTokenTo() </em>被定义在<em class="ks"> ERC721Token </em>的库之上。需要三个参数:将拥有这个新生成的令牌的帐户地址、这个令牌的标识符(记住这是不可替换的令牌，它有一个唯一的令牌ID)和一个关于这个令牌的描述字符串(URI)。</li><li id="3597" class="kt ku ht jq b jr lc jv ld jz le kd lf kh lg kl ky kz la lb dt translated">执行<em class="ks"> mintUniqueTokenTo() </em>时调用两个函数。它们是内部函数:<em class="ks"> _mint() </em>创建一个新的令牌，以及<em class="ks"> _setTokenURI() </em>为这个令牌设置TokenURI。</li><li id="9f08" class="kt ku ht jq b jr lc jv ld jz le kd lf kh lg kl ky kz la lb dt translated">虽然我们可以根据用例添加更多有意义的函数，但目前<em class="ks"> mintUniqueTokenTo() </em>对于演示公共函数已经足够好了。</li></ul><h2 id="c881" class="lh ir ht bd is li lj lk iw ll lm ln ja jz lo lp je kd lq lr ji kh ls lt jm lu dt translated">启动以太坊模拟器(ganache-cli)</h2><p id="e44e" class="pw-post-body-paragraph jo jp ht jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl hm dt translated">步骤6:这里我们使用<em class="ks"> ganache-cli </em>。其他的ganache也可以，只要RPC在<a class="ae kr" href="http://localhost:8545" rel="noopener ugc nofollow" target="_blank"> http://localhost:8545 </a>上，这个我们之前在<em class="ks"> truffle.js </em>里设置过。</p><figure class="lw lx ly lz fq ma fe ff paragraph-image"><div class="fe ff lv"><img src="../Images/e9c03e32140620ad9301ac2fd5028899.png" data-original-src="https://miro.medium.com/v2/resize:fit:1174/0*uwOVDLlTzM-uwX1C"/></div></figure><p id="69a2" class="pw-post-body-paragraph jo jp ht jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hm dt translated">请注意，启动ganache-cli时使用了助记符。这只是为了保持相同的10个帐户。它可以用任何助记符或不用助记符。</p><h2 id="9056" class="lh ir ht bd is li lj lk iw ll lm ln ja jz lo lp je kd lq lr ji kh ls lt jm lu dt translated">部署MyERC721令牌协定</h2><p id="1876" class="pw-post-body-paragraph jo jp ht jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl hm dt translated">第七步:先用Truffle Compile编译MyERC721契约。</p><figure class="lw lx ly lz fq ma fe ff paragraph-image"><div class="fe ff lv"><img src="../Images/f185c92e7b602e14f31209fdc57969cf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1174/0*1ZQevksCOBx0qV1p"/></div></figure><p id="4a3c" class="pw-post-body-paragraph jo jp ht jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hm dt translated">我们得到一些想法，ERC721Token是建立在许多其他ERC721合同之上的。一些包含函数的定义，而另一些实现函数。</p><p id="3234" class="pw-post-body-paragraph jo jp ht jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hm dt translated">步骤8:使用Truffle Migrate部署(或迁移)MyERC721契约。</p><figure class="lw lx ly lz fq ma fe ff paragraph-image"><div class="fe ff lv"><img src="../Images/682b3b374b9de2f0e39a6b81f26b824b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1174/0*d9gr03Nx_OubFV4l"/></div></figure><p id="4432" class="pw-post-body-paragraph jo jp ht jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hm dt translated">注意，我们现在已经在以太坊模拟器中部署了MyERC721契约<strong class="jq hu"/>。合同地址为0x 62 C1 d 656 a 64d 82 a 69384 E6 be 97 fb9 c 203 ce 8 AC 56。我们将在与这个已部署的契约交互时使用它。</p><h2 id="5137" class="lh ir ht bd is li lj lk iw ll lm ln ja jz lo lp je kd lq lr ji kh ls lt jm lu dt translated">设置Geth控制台以访问已部署的合同</h2><p id="cac9" class="pw-post-body-paragraph jo jp ht jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl hm dt translated">与部署的MyERC721的交互是通过Go Ethereum (geth)控制台完成的。</p><p id="23c6" class="pw-post-body-paragraph jo jp ht jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hm dt translated">步骤9:使用geth attach通过RPC访问以太坊模拟器。</p><figure class="lw lx ly lz fq ma fe ff paragraph-image"><div class="fe ff lv"><img src="../Images/349f818af24ddf5b781ee5d76fe0bd35.png" data-original-src="https://miro.medium.com/v2/resize:fit:1174/0*bQTkCDkgkF4QZQCm"/></div></figure><p id="21da" class="pw-post-body-paragraph jo jp ht jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hm dt translated">为了访问这个部署的契约，需要两条信息:应用程序二进制接口(ABI)和契约地址。在上一步中我们有后者。ABI可以在文件<em class="ks">/build/contracts/myerc 721 . JSON</em>里面获得。这是字符串格式的ABI。</p><pre class="lw lx ly lz fq md me mf mg aw mh dt"><span id="4393" class="lh ir ht me b fv mi mj l mk ml">[ { "constant": true, "inputs": [ { "name": "_interfaceId", "type": "bytes4" } ], "name": "supportsInterface", "outputs": [ { "name": "", "type": "bool" } ], "payable": false, "stateMutability": "view", "type": "function" }, { "constant": true, "inputs": [], "name": "name", "outputs": [ { "name": "", "type": "string" } ], "payable": false, "stateMutability": "view", "type": "function" }, { "constant": true, "inputs": [ { "name": "_tokenId", "type": "uint256" } ], "name": "getApproved", "outputs": [ { "name": "", "type": "address" } ], "payable": false, "stateMutability": "view", "type": "function" }, { "constant": false, "inputs": [ { "name": "_to", "type": "address" }, { "name": "_tokenId", "type": "uint256" } ], "name": "approve", "outputs": [], "payable": false, "stateMutability": "nonpayable", "type": "function" }, { "constant": true, "inputs": [], "name": "totalSupply", "outputs": [ { "name": "", "type": "uint256" } ], "payable": false, "stateMutability": "view", "type": "function" }, { "constant": true, "inputs": [], "name": "InterfaceId_ERC165", "outputs": [ { "name": "", "type": "bytes4" } ], "payable": false, "stateMutability": "view", "type": "function" }, { "constant": false, "inputs": [ { "name": "_from", "type": "address" }, { "name": "_to", "type": "address" }, { "name": "_tokenId", "type": "uint256" } ], "name": "transferFrom", "outputs": [], "payable": false, "stateMutability": "nonpayable", "type": "function" }, { "constant": true, "inputs": [ { "name": "_owner", "type": "address" }, { "name": "_index", "type": "uint256" } ], "name": "tokenOfOwnerByIndex", "outputs": [ { "name": "", "type": "uint256" } ], "payable": false, "stateMutability": "view", "type": "function" }, { "constant": false, "inputs": [ { "name": "_from", "type": "address" }, { "name": "_to", "type": "address" }, { "name": "_tokenId", "type": "uint256" } ], "name": "safeTransferFrom", "outputs": [], "payable": false, "stateMutability": "nonpayable", "type": "function" }, { "constant": true, "inputs": [ { "name": "_tokenId", "type": "uint256" } ], "name": "exists", "outputs": [ { "name": "", "type": "bool" } ], "payable": false, "stateMutability": "view", "type": "function" }, { "constant": true, "inputs": [ { "name": "_index", "type": "uint256" } ], "name": "tokenByIndex", "outputs": [ { "name": "", "type": "uint256" } ], "payable": false, "stateMutability": "view", "type": "function" }, { "constant": true, "inputs": [ { "name": "_tokenId", "type": "uint256" } ], "name": "ownerOf", "outputs": [ { "name": "", "type": "address" } ], "payable": false, "stateMutability": "view", "type": "function" }, { "constant": true, "inputs": [ { "name": "_owner", "type": "address" } ], "name": "balanceOf", "outputs": [ { "name": "", "type": "uint256" } ], "payable": false, "stateMutability": "view", "type": "function" }, { "constant": true, "inputs": [], "name": "symbol", "outputs": [ { "name": "", "type": "string" } ], "payable": false, "stateMutability": "view", "type": "function" }, { "constant": false, "inputs": [ { "name": "_to", "type": "address" }, { "name": "_approved", "type": "bool" } ], "name": "setApprovalForAll", "outputs": [], "payable": false, "stateMutability": "nonpayable", "type": "function" }, { "constant": false, "inputs": [ { "name": "_from", "type": "address" }, { "name": "_to", "type": "address" }, { "name": "_tokenId", "type": "uint256" }, { "name": "_data", "type": "bytes" } ], "name": "safeTransferFrom", "outputs": [], "payable": false, "stateMutability": "nonpayable", "type": "function" }, { "constant": true, "inputs": [ { "name": "_tokenId", "type": "uint256" } ], "name": "tokenURI", "outputs": [ { "name": "", "type": "string" } ], "payable": false, "stateMutability": "view", "type": "function" }, { "constant": true, "inputs": [ { "name": "_owner", "type": "address" }, { "name": "_operator", "type": "address" } ], "name": "isApprovedForAll", "outputs": [ { "name": "", "type": "bool" } ], "payable": false, "stateMutability": "view", "type": "function" }, { "inputs": [ { "name": "_name", "type": "string" }, { "name": "_symbol", "type": "string" } ], "payable": false, "stateMutability": "nonpayable", "type": "constructor" }, { "anonymous": false, "inputs": [ { "indexed": true, "name": "_from", "type": "address" }, { "indexed": true, "name": "_to", "type": "address" }, { "indexed": true, "name": "_tokenId", "type": "uint256" } ], "name": "Transfer", "type": "event" }, { "anonymous": false, "inputs": [ { "indexed": true, "name": "_owner", "type": "address" }, { "indexed": true, "name": "_approved", "type": "address" }, { "indexed": true, "name": "_tokenId", "type": "uint256" } ], "name": "Approval", "type": "event" }, { "anonymous": false, "inputs": [ { "indexed": true, "name": "_owner", "type": "address" }, { "indexed": true, "name": "_operator", "type": "address" }, { "indexed": false, "name": "_approved", "type": "bool" } ], "name": "ApprovalForAll", "type": "event" }, { "constant": false, "inputs": [ { "name": "_to", "type": "address" }, { "name": "_tokenId", "type": "uint256" }, { "name": "_tokenURI", "type": "string" } ], "name": "mintUniqueTokenTo", "outputs": [], "payable": false, "stateMutability": "nonpayable", "type": "function" } ]</span></pre><p id="80c3" class="pw-post-body-paragraph jo jp ht jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hm dt translated">步骤10:定义变量abi(截断)</p><figure class="lw lx ly lz fq ma fe ff paragraph-image"><div role="button" tabindex="0" class="mn mo di mp bf mq"><div class="fe ff lv"><img src="../Images/7edaeafafa8b7104a572632b4bfdfd3f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1174/0*Hd8AR11Ech2Jpp9x"/></div></div></figure><p id="63b9" class="pw-post-body-paragraph jo jp ht jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hm dt translated">步骤11:访问已部署的合同</p><figure class="lw lx ly lz fq ma fe ff paragraph-image"><div class="fe ff lv"><img src="../Images/52793f108cf2aa92f85fa0b5696e1660.png" data-original-src="https://miro.medium.com/v2/resize:fit:1174/0*_O8sQEolxKfXHbUe"/></div></figure><p id="2c34" class="pw-post-body-paragraph jo jp ht jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hm dt translated">现在我们有了对象<em class="ks"> deployedMyERC721 </em>，这是已部署的契约。当我们查看它包含的内容时，只需键入<em class="ks"> deployedMyERC721 </em>，它包含ABI、地址，最重要的是，<em class="ks"> deployedMyERC721 </em>可以访问的许多函数(或方法)。</p><p id="ee1c" class="pw-post-body-paragraph jo jp ht jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hm dt translated">这里是<em class="ks"> deployedMyERC721 </em>的底部，我们可以看到功能。</p><figure class="lw lx ly lz fq ma fe ff paragraph-image"><div class="fe ff lv"><img src="../Images/a22df582b6b5b125c147b5f620ec314d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1174/0*zxiOGZ6I7Bl53M8B"/></div></figure><h1 id="8a11" class="iq ir ht bd is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn dt translated">与MyERC721令牌交互</h1><p id="ed5b" class="pw-post-body-paragraph jo jp ht jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl hm dt translated">我们首先创建一个初始状态。它可以是任何东西，所以我们只是创建这个简单的场景。</p><p id="530c" class="pw-post-body-paragraph jo jp ht jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hm dt translated"><em class="ks">以太坊账户的作用</em></p><p id="ffb7" class="pw-post-body-paragraph jo jp ht jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hm dt translated">Ganache-cli自带10个以太坊账号。这里eth.accounts[0]是部署MyERC721的帐户。当新令牌被“铸造”时，它被发送到其他帐户(例如，eth.accounts[1]、eth.accounts[2]等)。)</p><p id="a7e9" class="pw-post-body-paragraph jo jp ht jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hm dt translated"><em class="ks">令牌表</em></p><p id="4d92" class="pw-post-body-paragraph jo jp ht jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hm dt translated">我们最初铸造了三个令牌，令牌ID #1、#2和#3，每个令牌都有一个URI作为描述。令牌#1和#2被分配给eth.accounts[1]，而令牌#3被分配给eth.accounts[2]。</p><figure class="lw lx ly lz fq ma fe ff paragraph-image"><div role="button" tabindex="0" class="mn mo di mp bf mq"><div class="fe ff mr"><img src="../Images/99303f7a7679746c89a72aa08a1dabeb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DU994Ym-8OKLwFbskHNJKg.png"/></div></div></figure><p id="ac91" class="pw-post-body-paragraph jo jp ht jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hm dt translated">我们将完成以下步骤</p><ul class=""><li id="f61e" class="kt ku ht jq b jr km jv kn jz kv kd kw kh kx kl ky kz la lb dt translated">检查已部署合同的信息(创建前)</li><li id="15cf" class="kt ku ht jq b jr lc jv ld jz le kd lf kh lg kl ky kz la lb dt translated">铸造代币并分配给所有者</li><li id="f50d" class="kt ku ht jq b jr lc jv ld jz le kd lf kh lg kl ky kz la lb dt translated">令牌生成后检查信息</li><li id="9d03" class="kt ku ht jq b jr lc jv ld jz le kd lf kh lg kl ky kz la lb dt translated">简单令牌传输</li><li id="fa56" class="kt ku ht jq b jr lc jv ld jz le kd lf kh lg kl ky kz la lb dt translated">高级令牌传输:批准</li></ul><h2 id="1c11" class="lh ir ht bd is li lj lk iw ll lm ln ja jz lo lp je kd lq lr ji kh ls lt jm lu dt translated">检查已部署合同的信息(创建前)</h2><p id="e601" class="pw-post-body-paragraph jo jp ht jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl hm dt translated">步骤12:检查名称和符号。请注意，名称和符号是在部署(迁移)合同时给出的。</p><figure class="lw lx ly lz fq ma fe ff paragraph-image"><div class="fe ff lv"><img src="../Images/d2992610d215285b35ce947df6bd7bd4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1174/0*lbTjgKngb9gJm5tb"/></div></figure><p id="721d" class="pw-post-body-paragraph jo jp ht jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hm dt translated">步骤13:检查是否有代币发行，即代币的总供应量</p><figure class="lw lx ly lz fq ma fe ff paragraph-image"><div class="fe ff lv"><img src="../Images/d625d9935d2203976947ca079e2d1f9b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1174/0*aWk9HfWhgRQsX9Bk"/></div></figure><h2 id="9928" class="lh ir ht bd is li lj lk iw ll lm ln ja jz lo lp je kd lq lr ji kh ls lt jm lu dt translated">铸造令牌并分配给所有者</h2><p id="3efd" class="pw-post-body-paragraph jo jp ht jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl hm dt translated">我们调用的函数是mintUniqueTokenTo()，给出所有者、令牌ID和令牌URI。该命令是从eth.accounts[0]发出的。</p><p id="4d18" class="pw-post-body-paragraph jo jp ht jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hm dt translated">步骤14:根据我们的设计发行三个代币。</p><figure class="lw lx ly lz fq ma fe ff paragraph-image"><div class="fe ff lv"><img src="../Images/59fb3226db3f55d136104feb49971eb5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1174/0*rpXfEs2EZ9PdXxyp"/></div></figure><h2 id="2347" class="lh ir ht bd is li lj lk iw ll lm ln ja jz lo lp je kd lq lr ji kh ls lt jm lu dt translated">令牌生成后检查信息</h2><p id="7140" class="pw-post-body-paragraph jo jp ht jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl hm dt translated">我们可以调用几个函数来观察当前状态。</p><p id="841c" class="pw-post-body-paragraph jo jp ht jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hm dt translated">步骤15:检查令牌的总供应量</p><figure class="lw lx ly lz fq ma fe ff paragraph-image"><div class="fe ff ms"><img src="../Images/d17c684bbef0e1a981a45ddf8788ada8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1178/0*CBrG03LJ7rMDCtZ5"/></div></figure><p id="242e" class="pw-post-body-paragraph jo jp ht jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hm dt translated">正如所料，我们现在有三个令牌。</p><p id="6f6b" class="pw-post-body-paragraph jo jp ht jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hm dt translated">步骤16:根据令牌ID检查令牌的详细信息。我们将首先检查令牌是否存在。</p><figure class="lw lx ly lz fq ma fe ff paragraph-image"><div class="fe ff lv"><img src="../Images/429c84d986c1c14c95f9dd1dfc645d59.png" data-original-src="https://miro.medium.com/v2/resize:fit:1174/0*f4oOmnFRIjZ0oDqZ"/></div></figure><p id="a382" class="pw-post-body-paragraph jo jp ht jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hm dt translated">对于那些尚未生成的令牌ID(例如令牌ID 4)，该函数返回false。</p><p id="0f53" class="pw-post-body-paragraph jo jp ht jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hm dt translated">步骤17:检查这些令牌的URI</p><figure class="lw lx ly lz fq ma fe ff paragraph-image"><div class="fe ff lv"><img src="../Images/dfd94a09ab9c0cb7c638afdd96160318.png" data-original-src="https://miro.medium.com/v2/resize:fit:1174/0*ygzU4o_2cfpJ2m--"/></div></figure><p id="272c" class="pw-post-body-paragraph jo jp ht jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hm dt translated">步骤18:检查这些令牌的所有权</p><figure class="lw lx ly lz fq ma fe ff paragraph-image"><div class="fe ff lv"><img src="../Images/2c3c893b905ade7824a1909cfa4b6e98.png" data-original-src="https://miro.medium.com/v2/resize:fit:1174/0*eJlBW1kJwxQesG-b"/></div></figure><p id="9da3" class="pw-post-body-paragraph jo jp ht jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hm dt translated">步骤19:检查每个账户的余额</p><figure class="lw lx ly lz fq ma fe ff paragraph-image"><div class="fe ff lv"><img src="../Images/932af5c4fce353aa3129a5ddbba8a28f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1174/0*aNdRFotp3mK4vlac"/></div></figure><p id="cbf4" class="pw-post-body-paragraph jo jp ht jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hm dt translated">这里我们看到只有eth.accounts[1]和[2]收到了令牌。</p><h2 id="2ea0" class="lh ir ht bd is li lj lk iw ll lm ln ja jz lo lp je kd lq lr ji kh ls lt jm lu dt translated">简单令牌传输</h2><p id="37f3" class="pw-post-body-paragraph jo jp ht jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl hm dt translated">我们将执行一个简单的令牌转移:令牌所有者将令牌转移到另一个帐户。在我们的示例中，eth.accounts[1]将令牌#2转移到eth.accounts[2]。</p><p id="b354" class="pw-post-body-paragraph jo jp ht jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hm dt translated">步骤20:再次检查令牌#2的所有权，以及eth.accounts[1]和eth.accounts[2]的余额</p><figure class="lw lx ly lz fq ma fe ff paragraph-image"><div class="fe ff lv"><img src="../Images/65d3a575c2d46895910ee1053b1863a4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1174/0*fExIKG7bMJvdUggv"/></div></figure><p id="dd4f" class="pw-post-body-paragraph jo jp ht jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hm dt translated">第21步:使用函数<em class="ks"> transferFrom() </em>传递令牌。注意，这个函数是从eth.accounts[1]调用的，它是令牌#2的当前所有者。需要三个参数:<em class="ks"> from </em>、<em class="ks"> to </em>和<em class="ks">token ID</em>。</p><figure class="lw lx ly lz fq ma fe ff paragraph-image"><div class="fe ff lv"><img src="../Images/2c6e5aafc156befe18b05c7295f8ee1e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1174/0*Za37sFYgtp05wlqY"/></div></figure><p id="b5fe" class="pw-post-body-paragraph jo jp ht jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hm dt translated">步骤22:现在再次检查令牌#2的所有者和两个帐户的余额。</p><figure class="lw lx ly lz fq ma fe ff paragraph-image"><div class="fe ff lv"><img src="../Images/75c9da56247021fffa3248fc698a8609.png" data-original-src="https://miro.medium.com/v2/resize:fit:1174/0*O9vwiDOAP5FwwMJf"/></div></figure><p id="d542" class="pw-post-body-paragraph jo jp ht jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hm dt translated">我们看到令牌已成功转移，帐户余额信息正确。</p><figure class="lw lx ly lz fq ma fe ff paragraph-image"><div role="button" tabindex="0" class="mn mo di mp bf mq"><div class="fe ff mr"><img src="../Images/a79b185aae52ddb4afb1dd6f96607cf0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*y8am58V8nP9Pay7g0iL1yA.png"/></div></div></figure><h2 id="5250" class="lh ir ht bd is li lj lk iw ll lm ln ja jz lo lp je kd lq lr ji kh ls lt jm lu dt translated">高级令牌传输:批准</h2><p id="3d9d" class="pw-post-body-paragraph jo jp ht jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl hm dt translated">在前面的简单传输案例中，transferFrom()由令牌的所有者调用。存在第三方帐户调用函数transferFrom()的情况。在这种情况下，在第三方帐户可以调用该功能之前，需要令牌所有者的批准。</p><p id="f2ad" class="pw-post-body-paragraph jo jp ht jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hm dt translated">假设在我们的例子中，eth.accounts[1]将批准eth.accounts[0]将令牌#1转移到eth.accounts[2]。</p><p id="4934" class="pw-post-body-paragraph jo jp ht jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hm dt translated">第二十三步:不允许未审批的转账。在任何批准之前，eth.accounts[0]尝试调用<em class="ks"> transferFrom() </em>来转移令牌#1(当前由eth.accounts[1]拥有)，调用失败。</p><figure class="lw lx ly lz fq ma fe ff paragraph-image"><div class="fe ff lv"><img src="../Images/d718e2c0f2852e3cd4348ebff9d8ebb5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1174/0*IiE1ZX4mBNpt6UkJ"/></div></figure><p id="e12e" class="pw-post-body-paragraph jo jp ht jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hm dt translated">步骤24:现在eth.accounts[1]批准eth.accounts[0]使令牌#1可从eth.accounts[0]转移。我们首先查看令牌#1中是否有任何具有<em class="ks"> getApproved() </em>的批准者。调用函数<em class="ks"> approve() </em>后，我们再次检查。</p><figure class="lw lx ly lz fq ma fe ff paragraph-image"><div class="fe ff lv"><img src="../Images/766e2372c9ce58934a3087b3816676ca.png" data-original-src="https://miro.medium.com/v2/resize:fit:1174/0*NsASPhKg37lvGUAx"/></div></figure><p id="ee46" class="pw-post-body-paragraph jo jp ht jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hm dt translated">第25步:我们重复第23步。这次转移成功了。</p><figure class="lw lx ly lz fq ma fe ff paragraph-image"><div class="fe ff lv"><img src="../Images/4957ab48ee0a9a2d58fd4fa36d6bda32.png" data-original-src="https://miro.medium.com/v2/resize:fit:1174/0*z6SQjWmJ3eFqJbP6"/></div></figure><figure class="lw lx ly lz fq ma fe ff paragraph-image"><div role="button" tabindex="0" class="mn mo di mp bf mq"><div class="fe ff mr"><img src="../Images/a64d8e0e4ec25ce8ba5a79c7a3078d78.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zUp7BA7Zg3M3C_khqksYDQ.png"/></div></div></figure><h1 id="5315" class="iq ir ht bd is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn dt translated">摘要</h1><p id="aa5c" class="pw-post-body-paragraph jo jp ht jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl hm dt translated">Zeppelin为创建不可替换的令牌(ERC721)提供了很好的库。在本文中，我们基于Zeppelin部署了一个非常简单的令牌，并观察了令牌是如何记录在契约中的，令牌是如何通过契约函数调用进行传输的，以及之后会发生什么。</p><p id="cf2b" class="pw-post-body-paragraph jo jp ht jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hm dt translated">还有一些功能可用。您可以使用此设置来探索它们。</p><p id="807f" class="pw-post-body-paragraph jo jp ht jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hm dt translated">再次感谢CipherZ，我的工作建立在他的文章之上。以下是文章原文(<a class="ae kr" rel="noopener" href="/coinmonks/a-simple-erc-721-example-c3f72b5aa19">链接</a>)。</p><blockquote class="mt"><p id="104e" class="mu mv ht bd mw mx my mz na nb nc kl ek translated"><a class="ae kr" href="https://coincodecap.com/?utm_source=coinmonks" rel="noopener ugc nofollow" target="_blank">直接在您的收件箱中获得最佳软件交易</a></p></blockquote><figure class="ne nf ng nh ni ma fe ff paragraph-image"><a href="https://coincodecap.com/?utm_source=coinmonks"><div class="fe ff nd"><img src="../Images/7c0b3dfdcbfea594cc0ae7d4f9bf6fcb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1168/format:webp/0*OJ-qb5G6i863msBB.png"/></div></a></figure></div></div>    
</body>
</html>