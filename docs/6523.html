<html>
<head>
<title>Solidity — Random Numbers</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">坚固性——随机数</h1>
<blockquote>原文：<a href="https://medium.com/coinmonks/solidity-random-numbers-f54e1272c7dd?source=collection_archive---------1-----------------------#2021-12-19">https://medium.com/coinmonks/solidity-random-numbers-f54e1272c7dd?source=collection_archive---------1-----------------------#2021-12-19</a></blockquote><div><div class="ef hh hi hj hk hl"/><div class="hm hn ho hp hq"><div class=""/><figure class="fi fk ir is it iu fe ff paragraph-image"><div role="button" tabindex="0" class="iv iw di ix bf iy"><div class="fe ff iq"><img src="../Images/6ed9a57f09da92616793e236f4003011.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3dYdmpecHy1QoCyGLV-f4g.png"/></div></div></figure><p id="559a" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">希望您知道，纯粹在链上生成随机数是不可能的。你需要使用像chainlink这样的服务，但是说实话，伪随机对于大多数需求来说已经足够了。</p><p id="707a" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">然而，有时你需要多个随机数，事情就开始变得昂贵了。</p><h1 id="9a4a" class="jz ka ht bd kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw dt translated">比特移位</h1><p id="e18b" class="pw-post-body-paragraph jb jc ht jd b je kx jg jh ji ky jk jl jm kz jo jp jq la js jt ju lb jw jx jy hm dt translated">位操作真的很有趣，或者说我已经深入研究了一些非常晦涩的文章。无论哪种方式，它都非常有用，可以用来节省你的汽油。</p><h2 id="939e" class="lc ka ht bd kb ld le lf kf lg lh li kj jm lj lk kn jq ll lm kr ju ln lo kv lp dt translated">什么是移位？</h2><p id="365a" class="pw-post-body-paragraph jb jc ht jd b je kx jg jh ji ky jk jl jm kz jo jp jq la js jt ju lb jw jx jy hm dt translated">比我更聪明、更有经验的人已经讨论过这个主题和其他字节操作技术:</p><div class="lq lr fm fo ls lt"><a rel="noopener follow" target="_blank" href="/@imolfar/bitwise-operations-and-bit-manipulation-in-solidity-ethereum-1751f3d2e216"><div class="lu ab ej"><div class="lv ab lw cl cj lx"><h2 class="bd hu fv z el ly eo ep lz er et hs dt translated">以太坊中的位运算和位操作</h2><div class="ma l"><h3 class="bd b fv z el ly eo ep lz er et ek translated">是的，以太坊是世界上的计算机，虽然可能是最贵的一台。因为存储是最大的…</h3></div><div class="mb l"><p class="bd b gc z el ly eo ep lz er et ek translated">medium.com</p></div></div><div class="mc l"><div class="md l me mf mg mc mh iz lt"/></div></div></a></div><h2 id="de17" class="lc ka ht bd kb ld le lf kf lg lh li kj jm lj lk kn jq ll lm kr ju ln lo kv lp dt translated">我们如何在RNG中使用移位？</h2><p id="4e9d" class="pw-post-body-paragraph jb jc ht jd b je kx jg jh ji ky jk jl jm kz jo jp jq la js jt ju lb jw jx jy hm dt translated">好的，想象你需要为你的RPG NFT产生10个随机数。您可以创建这样的东西:</p><figure class="mi mj mk ml fq iu"><div class="bz el l di"><div class="mm mn l"/></div></figure><p id="8cb6" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">问题是你必须打十次电话。</p><p id="4314" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">有一个很好的解决方案:</p><figure class="mi mj mk ml fq iu"><div class="bz el l di"><div class="mm mn l"/></div></figure><p id="1df1" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">就像这样，我们只需要创建一个randomHash，然后使用位操作来创建10个所需的随机数。</p><p id="b7e4" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">值得注意的是，移位并不意味着你可以永远移位，你会用完所有的位。如果你有一个uint256变量，并且你正在移位&gt; &gt; 16，你只能移位16次，cos 16 x 16 = 256。</p><p id="bf3a" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">我个人认为如果有一些概念的视觉解释会更容易，并且认为其他人可能会发现位移动的视觉是有帮助的。</p><figure class="mi mj mk ml fq iu fe ff paragraph-image"><div class="fe ff mo"><img src="../Images/7ff9b5e07763daf1e654f6a116937a69.png" data-original-src="https://miro.medium.com/v2/resize:fit:1288/format:webp/1*QAys21B8mdldnB-r8fKcqA.png"/></div><figcaption class="mp mq fg fe ff mr ms bd b be z ek">uint256 &gt;&gt; 8, notice the angle versus &gt;&gt; 16 below</figcaption></figure><p id="10f7" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">这就是如果你超越了现有的数据会发生什么。uint256 &gt;&gt; 16，20次:</p><figure class="mi mj mk ml fq iu fe ff paragraph-image"><div class="fe ff mt"><img src="../Images/469d2fe4f4c0a23e791cdc05d3bda1d4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1388/format:webp/1*ORPIlad_dr8fuLWjuhrmPQ.png"/></div></figure><h1 id="d1a8" class="jz ka ht bd kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw dt translated">带跟踪的随机数</h1><p id="7a1d" class="pw-post-body-paragraph jb jc ht jd b je kx jg jh ji ky jk jl jm kz jo jp jq la js jt ju lb jw jx jy hm dt translated">有时你需要从现有列表中选择一个随机数，同时跟踪你已经选择的数字。</p><p id="77f8" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">在javascript中，这种任务是微不足道的，但是在solidity中，您真的需要在方法上花些心思来节省汽油。</p><h2 id="1196" class="lc ka ht bd kb ld le lf kf lg lh li kj jm lj lk kn jq ll lm kr ju ln lo kv lp dt translated">来自固定总体的随机令牌Id</h2><p id="87e6" class="pw-post-body-paragraph jb jc ht jd b je kx jg jh ji ky jk jl jm kz jo jp jq la js jt ju lb jw jx jy hm dt translated">假设你有一个NFT项目，有10k个代币，你想随机地把它们铸造出来。大多数方法需要大量的循环和数据存储，这可能会变得昂贵，并有耗尽的风险。</p><h2 id="05c7" class="lc ka ht bd kb ld le lf kf lg lh li kj jm lj lk kn jq ll lm kr ju ln lo kv lp dt translated">神奇的阵列</h2><p id="d4ac" class="pw-post-body-paragraph jb jc ht jd b je kx jg jh ji ky jk jl jm kz jo jp jq la js jt ju lb jw jx jy hm dt translated">我不知道这个方法的正确名称是什么，所以我就称它为神奇数组:)</p><figure class="mi mj mk ml fq iu"><div class="bz el l di"><div class="mm mn l"/></div></figure><p id="c3e1" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated"><strong class="jd hu"> MAX_POPULATION: </strong>是我们正在创建的NFT的人口数。</p><p id="9b6e" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated"><strong class="jd hu"> ids: </strong>是一个长度等于MAX_POPULATION的空数组。如果MAX_POPULATION为5，那么我们的数组将如下所示:</p><pre class="mi mj mk ml fq mu mv mw mx aw my dt"><span id="3a89" class="lc ka ht mv b fv mz na l nb nc">[0,0,0,0,0]</span></pre><p id="927f" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">当pickId()被调用时，在0和数组长度之间生成一个<strong class="jd hu">随机数索引</strong>。这很重要，因为我们将减少数组的长度，从而减少可能的随机数索引的范围。</p><p id="f9b1" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">接下来的几行代码是神奇的事情开始发生的地方。我会尽我所能解释它。</p><h2 id="31cd" class="lc ka ht bd kb ld le lf kf lg lh li kj jm lj lk kn jq ll lm kr ju ln lo kv lp dt translated">一传</h2><p id="ea8d" class="pw-post-body-paragraph jb jc ht jd b je kx jg jh ji ky jk jl jm kz jo jp jq la js jt ju lb jw jx jy hm dt translated">想象一下我们的数组[0，0，0，0，0]，它有5个元素，但是每个元素都是0。感觉有点没用吧？酷的是，这非常有帮助。</p><p id="7814" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">想象我们的<strong class="jd hu"> randomIndex </strong>值为2。我们检查数组中的索引2，我们可以看到值为0，因此我们将返回的值<strong class="jd hu"> id </strong>设置为我们刚刚检查的索引<strong class="jd hu"> 2。</strong></p><pre class="mi mj mk ml fq mu mv mw mx aw my dt"><span id="9217" class="lc ka ht mv b fv mz na l nb nc">[0, 0, 0, 0, 0]<br/>[2] = 0<br/>id = 2</span></pre><p id="1788" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">现在我们有了一个id值，我们需要编辑我们的数组来反映刚刚发生的事情，并确保我们不会丢失任何id。听起来对数组有很多期望。</p><p id="7fca" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">如果我们不编辑数组，值为2的randomIndex会产生完全相同的返回值，我们不希望两个NFT的tokenId都为2。为了解决这个问题，我们检查数组中的最后一个元素是否等于0</p><pre class="mi mj mk ml fq mu mv mw mx aw my dt"><span id="0fd7" class="lc ka ht mv b fv mz na l nb nc">if(ids[ids.length-1] == 0)</span></pre><p id="0a69" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">如果是，我们用最后一个数组元素的索引值替换ids[randomIndex]处的值。看起来像这样</p><pre class="mi mj mk ml fq mu mv mw mx aw my dt"><span id="158d" class="lc ka ht mv b fv mz na l nb nc">randomIndex = 2<br/>[0, 0, 4, 0, 0]</span></pre><p id="9781" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">最后，我们需要通过弹出最后一个元素来缩小数组。这导致我们的数组看起来像这样。</p><pre class="mi mj mk ml fq mu mv mw mx aw my dt"><span id="6154" class="lc ka ht mv b fv mz na l nb nc">[0, 0, 4, 0]</span></pre><h2 id="7a43" class="lc ka ht bd kb ld le lf kf lg lh li kj jm lj lk kn jq ll lm kr ju ln lo kv lp dt translated">第二遍</h2><p id="13a0" class="pw-post-body-paragraph jb jc ht jd b je kx jg jh ji ky jk jl jm kz jo jp jq la js jt ju lb jw jx jy hm dt translated">当我们选择下一个<strong class="jd hu"> id </strong>时，<strong class="jd hu"> randomIndex </strong>值再次显示为2。感觉这可能是个问题，对吧——不，我们已经解决了。</p><p id="e5b3" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">首先，我们检查数组中索引2处的值是否等于0。我们可以看到它等于4</p><pre class="mi mj mk ml fq mu mv mw mx aw my dt"><span id="5364" class="lc ka ht mv b fv mz na l nb nc">[0, 0, 4, 0]</span></pre><p id="0523" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">在第一遍中，我们的索引值等于0，因此我们返回了值为2的<strong class="jd hu"> randomIndex </strong>。这次我们有一个值4，所以我们返回4。</p><p id="7e18" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">就像第一遍一样，我们需要编辑数组来反映刚刚发生的事情。导致我们的阵列现在看起来像这样:</p><pre class="mi mj mk ml fq mu mv mw mx aw my dt"><span id="c505" class="lc ka ht mv b fv mz na l nb nc">[0, 0, 3]</span></pre><h2 id="958e" class="lc ka ht bd kb ld le lf kf lg lh li kj jm lj lk kn jq ll lm kr ju ln lo kv lp dt translated">第三遍</h2><p id="f324" class="pw-post-body-paragraph jb jc ht jd b je kx jg jh ji ky jk jl jm kz jo jp jq la js jt ju lb jw jx jy hm dt translated">难道你不知道，<strong class="jd hu"> randomIndex </strong>又掷出了2。</p><p id="5ae0" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">这一次，索引2处的值是3，因此我们将返回3并编辑数组以反映该事件。</p><p id="3e3a" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">这一次情况有所不同，数组中的最后一个值不等于0，所以我们必须做一些不同的事情，最终得到的数组是</p><pre class="mi mj mk ml fq mu mv mw mx aw my dt"><span id="5b3a" class="lc ka ht mv b fv mz na l nb nc">[0, 0]</span></pre><h2 id="1eb7" class="lc ka ht bd kb ld le lf kf lg lh li kj jm lj lk kn jq ll lm kr ju ln lo kv lp dt translated">魔法阵列</h2><p id="4d58" class="pw-post-body-paragraph jb jc ht jd b je kx jg jh ji ky jk jl jm kz jo jp jq la js jt ju lb jw jx jy hm dt translated">我知道这可能有点棘手，我第一次玩它的时候，我只是在纸上绘制数组，以确保我完全理解这个概念。</p><h2 id="2a6a" class="lc ka ht bd kb ld le lf kf lg lh li kj jm lj lk kn jq ll lm kr ju ln lo kv lp dt translated">圣诞玩笑</h2><p id="7ab6" class="pw-post-body-paragraph jb jc ht jd b je kx jg jh ji ky jk jl jm kz jo jp jq la js jt ju lb jw jx jy hm dt translated">上面的魔术数组代码示例可以优化，你能看到如何优化吗？</p><h1 id="60d1" class="jz ka ht bd kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw dt translated">去哪里找我</h1><p id="66d3" class="pw-post-body-paragraph jb jc ht jd b je kx jg jh ji ky jk jl jm kz jo jp jq la js jt ju lb jw jx jy hm dt translated">我通常可以在酷猫不和谐频道<br/> <a class="ae nd" href="https://t.co/PjlbnmaW3a?amp=1" rel="noopener ugc nofollow" target="_blank">找到https://discord.gg/WhBAAHnSz4</a></p><p id="ee46" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">或者在推特上<br/><a class="ae nd" href="https://twitter.com/xtremetom" rel="noopener ugc nofollow" target="_blank">https://twitter.com/xtremetom</a></p><p id="7e4a" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated"><a class="ae nd" href="https://twitter.com/coolcatsnft" rel="noopener ugc nofollow" target="_blank">https://twitter.com/coolcatsnft</a></p><h1 id="c36d" class="jz ka ht bd kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw dt translated">最后一句话</h1><p id="b28f" class="pw-post-body-paragraph jb jc ht jd b je kx jg jh ji ky jk jl jm kz jo jp jq la js jt ju lb jw jx jy hm dt translated">我觉得这么说很傻，但我收到了太多的信息，我觉得这可能会为你我节省一些时间。</p><p id="994f" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">我在酷猫上全职工作，工作忙得不可开交，所以很遗憾我不得不拒绝每一份工作邀请。</p><p id="20ef" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">但是我总是愿意尽我所能分享资源和建议。</p><blockquote class="ne"><p id="887b" class="nf ng ht bd nh ni nj nk nl nm nn jy ek translated">交易新手？试试<a class="ae nd" rel="noopener" href="/coinmonks/crypto-trading-bot-c2ffce8acb2a">加密交易机器人</a>或者<a class="ae nd" rel="noopener" href="/coinmonks/top-10-crypto-copy-trading-platforms-for-beginners-d0c37c7d698c">复制交易</a></p></blockquote></div></div>    
</body>
</html>