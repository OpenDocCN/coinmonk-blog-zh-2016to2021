<html>
<head>
<title>Redistribute Lightning Channel’s Balances</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">重新分配闪电渠道的余额</h1>
<blockquote>原文：<a href="https://medium.com/coinmonks/redistribute-lightning-channels-balances-9ba3265584ee?source=collection_archive---------3-----------------------#2019-01-04">https://medium.com/coinmonks/redistribute-lightning-channels-balances-9ba3265584ee?source=collection_archive---------3-----------------------#2019-01-04</a></blockquote><div><div class="ef hh hi hj hk hl"/><div class="hm hn ho hp hq"><div class=""/><div class=""><h2 id="f853" class="pw-subtitle-paragraph iq hs ht bd b ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ek translated">当一个闪电通道资金过多而另一个资金过少时该怎么办。</h2></div><figure class="jj jk jl jm fq jn fe ff paragraph-image"><div role="button" tabindex="0" class="jo jp di jq bf jr"><div class="fe ff ji"><img src="../Images/845b0be2fd78dfcd914110bc242581cf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KudVFeq3G_jHgz2sbUFwTg.jpeg"/></div></div></figure><h2 id="0556" class="ju jv ht bd jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr dt translated">过多和过少的缺点</h2><p id="0974" class="pw-post-body-paragraph ks kt ht ku b kv kw iu kx ky kz ix la kf lb lc ld kj le lf lg kn lh li lj lk hm dt translated">闪电网络渠道被设计成双向支付渠道。这意味着如果爱丽丝和鲍勃有一个闪电通道，那么爱丽丝可以向鲍勃付款，反之亦然，鲍勃可以向爱丽丝付款。如果条件合适。</p><p id="286f" class="pw-post-body-paragraph ks kt ht ku b kv ll iu kx ky lm ix la kf ln lc ld kj lo lf lg kn lp li lj lk hm dt translated">实际上，事情是这样发生的:Alice资助Bob一个频道。在这个初始状态下，所有通道的余额都属于Alice。因此，Alice可以向Bob发送付款，但是Bob没有任何东西要发送给Alice。直到爱丽丝通过渠道送来一些钱。并且如果其中一方将所有可用余额发送给另一方，同样的情况可能会发生。在这种情况下，支付渠道只是单向的，只在一个方向起作用。</p><p id="486a" class="pw-post-body-paragraph ks kt ht ku b kv ll iu kx ky lm ix la kf ln lc ld kj lo lf lg kn lp li lj lk hm dt translated">一个普通的<a class="ae lq" href="https://lightningpeach.com/ln-monitor" rel="noopener ugc nofollow" target="_blank">雷电网络节点大约有5个通道</a>。一些渠道可能只有单向交易有余额。因此，对Alice来说，典型的情况可能是只有几个用于支出支付的通道和几个用于收入支付的通道。这个案例有它的缺点。如果Alice的一两个伙伴暂时脱机，可能会严重影响Alice发送或接收事务的能力。此外，爱丽丝可以在双方之间转移支付。对于单向信道，这个特征也有严重的限制。</p><h2 id="ec88" class="ju jv ht bd jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr dt translated">能做些什么</h2><p id="c676" class="pw-post-body-paragraph ks kt ht ku b kv kw iu kx ky kz ix la kf lb lc ld kj le lf lg kn lh li lj lk hm dt translated">如果节点将一些资金从其一个渠道转移到另一个渠道，则可以优化渠道余额的分布:</p><ol class=""><li id="cd7e" class="lr ls ht ku b kv ll ky lm kf lt kj lu kn lv lk lw lx ly lz dt translated">为自己开具发票</li><li id="98b3" class="lr ls ht ku b kv ma ky mb kf mc kj md kn me lk lw lx ly lz dt translated">通过外发渠道发出付款</li><li id="207f" class="lr ls ht ku b kv ma ky mb kf mc kj md kn me lk lw lx ly lz dt translated">在网络间转移支付</li><li id="fa82" class="lr ls ht ku b kv ma ky mb kf mc kj md kn me lk lw lx ly lz dt translated">通过输入通道将它带回来</li></ol><p id="1aea" class="pw-post-body-paragraph ks kt ht ku b kv ll iu kx ky lm ix la kf ln lc ld kj lo lf lg kn lp li lj lk hm dt translated">这样，传出通道将为将来的传入事务保留一些空间。类似地，传入通道将为传出事务保留一些空间。使用的单向信道变成双向的。</p><figure class="jj jk jl jm fq jn fe ff paragraph-image"><div role="button" tabindex="0" class="jo jp di jq bf jr"><div class="fe ff ji"><img src="../Images/1fc45f94aea675ab3b27f4a355c4d55e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xoAZbuo_lbc-7kgkLsZTiQ.jpeg"/></div></div></figure><h1 id="9398" class="mf jv ht bd jw mg mh mi ka mj mk ml ke iz mm ja ki jc mn jd km jf mo jg kq mp dt translated">技术零件</h1><p id="3901" class="pw-post-body-paragraph ks kt ht ku b kv kw iu kx ky kz ix la kf lb lc ld kj le lf lg kn lh li lj lk hm dt translated">我正在运行<a class="ae lq" href="https://github.com/ElementsProject/lightning/releases" rel="noopener ugc nofollow" target="_blank"> c-lightning 0.6.2rc1 </a>作为我的闪电节点。我正在使用<a class="ae lq" href="https://github.com/ElementsProject/lightning/tree/master/contrib/pylightning" rel="noopener ugc nofollow" target="_blank"> pylightning </a>来用Python更容易地管理lightning客户端。</p><h2 id="b0a7" class="ju jv ht bd jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr dt translated">调查当前形势</h2><p id="e079" class="pw-post-body-paragraph ks kt ht ku b kv kw iu kx ky kz ix la kf lb lc ld kj le lf lg kn lh li lj lk hm dt translated">下面是几行Python代码，用于显示连接通道上的可用余额:</p><figure class="jj jk jl jm fq jn"><div class="bz el l di"><div class="mq mr l"/></div></figure><p id="ef19" class="pw-post-body-paragraph ks kt ht ku b kv ll iu kx ky lm ix la kf ln lc ld kj lo lf lg kn lp li lj lk hm dt translated">结果如下:</p><figure class="jj jk jl jm fq jn fe ff paragraph-image"><div role="button" tabindex="0" class="jo jp di jq bf jr"><div class="fe ff ms"><img src="../Images/4dd4cacab13df42382d25026ccb7587c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZDW2N2_qExxzOnnwW9oMVQ.png"/></div></div><figcaption class="mt mu fg fe ff mv mw bd b be z ek">I am going to redistribute the balances between the red framed channels</figcaption></figure><p id="54d0" class="pw-post-body-paragraph ks kt ht ku b kv ll iu kx ky lm ix la kf ln lc ld kj lo lf lg kn lp li lj lk hm dt translated">其中100%是我的，它是一个传出通道，没有为传入交易预留。其中0%是我的，是传入渠道。</p><p id="9e27" class="pw-post-body-paragraph ks kt ht ku b kv ll iu kx ky lm ix la kf ln lc ld kj lo lf lg kn lp li lj lk hm dt translated">我用红色标记了两个节点进行演示:<br/>0279 c 22 ed 7 a 068d 10 DC 1 a 38 AE 66 D2 d 6461 e 269226 c 60258 c 021 B1 ddcdfe 4 b 00 BC 4看起来适合于接收付款。还有<a class="ae lq" href="https://1ml.com/node/0390b5d4492dc2f5318e5233ab2cebf6d48914881a33ef6a9c6bcdbb433ad986d0" rel="noopener ugc nofollow" target="_blank">0390 b5 d 4492 dc2f 5318 e 5233 ab 2 cebf 6d 48914881 a 33 ef 6a 9 c 6 BC dbb 433 ad 986d 0</a>看起来很适合一个外向的人。<br/>我将尝试在他们之间转移一些资金。</p><h2 id="8ef3" class="ju jv ht bd jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr dt translated">优化分配</h2><p id="8b5c" class="pw-post-body-paragraph ks kt ht ku b kv kw iu kx ky kz ix la kf lb lc ld kj le lf lg kn lh li lj lk hm dt translated">困难的部分来了。有一些复杂的管理工作，包括路线规划、路线费用计算、发票处理、发送带有支付散列的交易等。</p><p id="f9be" class="pw-post-body-paragraph ks kt ht ku b kv ll iu kx ky lm ix la kf ln lc ld kj lo lf lg kn lp li lj lk hm dt translated">实际上只需要三个参数:</p><ol class=""><li id="7a9a" class="lr ls ht ku b kv ll ky lm kf lt kj lu kn lv lk lw lx ly lz dt translated">传出节点id:节点的公钥，付款通过它传出</li><li id="724f" class="lr ls ht ku b kv ma ky mb kf mc kj md kn me lk lw lx ly lz dt translated">传入节点id:节点的公共密钥，通过它支付回来</li><li id="227c" class="lr ls ht ku b kv ma ky mb kf mc kj md kn me lk lw lx ly lz dt translated">以毫卫星为单位的汇款金额</li></ol><p id="7dbe" class="pw-post-body-paragraph ks kt ht ku b kv ll iu kx ky lm ix la kf ln lc ld kj lo lf lg kn lp li lj lk hm dt translated">这里有一个脚本，它接受这三个参数并为我们做所有其他的工作。</p><figure class="jj jk jl jm fq jn"><div class="bz el l di"><div class="mq mr l"/></div><figcaption class="mt mu fg fe ff mv mw bd b be z ek">The code is in the public domain without any warranty, use it with your own responsibility.</figcaption></figure><p id="d49b" class="pw-post-body-paragraph ks kt ht ku b kv ll iu kx ky lm ix la kf ln lc ld kj lo lf lg kn lp li lj lk hm dt translated">让我们试着重新分配一些资金，看看会发生什么:</p><figure class="jj jk jl jm fq jn fe ff paragraph-image"><div role="button" tabindex="0" class="jo jp di jq bf jr"><div class="fe ff mx"><img src="../Images/f0ee4d91e639877c13109296b367130a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*G8sxWYjrFEpVjVGWiOJgug.png"/></div></div><figcaption class="mt mu fg fe ff mv mw bd b be z ek">redistribute.py is running</figcaption></figure><p id="377e" class="pw-post-body-paragraph ks kt ht ku b kv ll iu kx ky lm ix la kf ln lc ld kj lo lf lg kn lp li lj lk hm dt translated">重新分配成功。幸运的是，传出和传入节点之间有一个开放的通道。因此，我可以选择一个包含三个步骤的路由:传出节点、传入节点和我的节点。结果如下:</p><figure class="jj jk jl jm fq jn fe ff paragraph-image"><div role="button" tabindex="0" class="jo jp di jq bf jr"><div class="fe ff my"><img src="../Images/8d3f9a2576369c3e6704dcb85b1b2a7d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YzDbBgSBEeS9HstBGB14fA.png"/></div></div><figcaption class="mt mu fg fe ff mv mw bd b be z ek">The two channels now have some reserve for incoming and outgoing transactions.</figcaption></figure><p id="b881" class="pw-post-body-paragraph ks kt ht ku b kv ll iu kx ky lm ix la kf ln lc ld kj lo lf lg kn lp li lj lk hm dt translated">我通过节点发送了0.015 BTC或55美元，这花费了我0.00000305015 BTC或1便士(2019年1月价格)。</p><p id="8058" class="pw-post-body-paragraph ks kt ht ku b kv ll iu kx ky lm ix la kf ln lc ld kj lo lf lg kn lp li lj lk hm dt translated">只需付出很少的努力，在闪电通道之间重新分配资金就相对便宜，而且可能会增加网络的弹性和可用性。</p></div><div class="ab cl mz na hb nb" role="separator"><span class="nc bw bk nd ne nf"/><span class="nc bw bk nd ne nf"/><span class="nc bw bk nd ne"/></div><div class="hm hn ho hp hq"><p id="9909" class="pw-post-body-paragraph ks kt ht ku b kv ll iu kx ky lm ix la kf ln lc ld kj lo lf lg kn lp li lj lk hm dt translated">感谢阅读！如果你喜欢它，打开一个频道到<a class="ae lq" href="https://1ml.com/node/03d67f36c4f81789e2fe425028bacc96b199813eae426c517f589a45f1136c1fe5" rel="noopener ugc nofollow" target="_blank">我的闪电网络节点</a>，或者在Medium或者<a class="ae lq" href="https://twitter.com/gallizoli" rel="noopener ugc nofollow" target="_blank"> Twitter </a>上关注我！欢迎反馈意见和建议！</p><blockquote class="ng"><p id="95ae" class="nh ni ht bd nj nk nl nm nn no np lk ek translated"><a class="ae lq" href="https://coincodecap.com/?utm_source=coinmonks" rel="noopener ugc nofollow" target="_blank">直接在您的收件箱中获得最佳软件交易</a></p></blockquote><figure class="nr ns nt nu nv jn fe ff paragraph-image"><a href="https://coincodecap.com/?utm_source=coinmonks"><div class="fe ff nq"><img src="../Images/7c0b3dfdcbfea594cc0ae7d4f9bf6fcb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1168/format:webp/0*OJ-qb5G6i863msBB.png"/></div></a></figure><figure class="jj jk jl jm fq jn fe ff paragraph-image"><a href="https://cryptofi.co"><div class="fe ff nw"><img src="../Images/e7b1dbc6a532a697c6844fdf0f0bbd30.png" data-original-src="https://miro.medium.com/v2/resize:fit:814/format:webp/1*HrFLDXz92JavTZXjhmvU7g.png"/></div></a></figure></div></div>    
</body>
</html>