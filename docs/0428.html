<html>
<head>
<title>Register .test domain with ENS</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">注册。用ENS测试域</h1>
<blockquote>原文：<a href="https://medium.com/coinmonks/register-test-domain-with-ens-72b04c30d5ea?source=collection_archive---------5-----------------------#2018-05-03">https://medium.com/coinmonks/register-test-domain-with-ens-72b04c30d5ea?source=collection_archive---------5-----------------------#2018-05-03</a></blockquote><div><div class="ef hh hi hj hk hl"/><div class="hm hn ho hp hq"><div class=""/><p id="2de4" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">Cee，five，ef，dee，ef，four，ow，six，seven，哦等等，是ow，seven，six，bee…这当然不是你想分享以太坊地址或Swarm和IPFS内容散列的方式。你复制并发送它或扫描二维码，但这种体验仍然不如使用容易记忆、可读的名称。同样，正如DNS为IP地址解决了这个问题一样，ENS的目标是在以太坊生态系统中缓解这个问题。</p><figure class="jp jq jr js fq jt fe ff paragraph-image"><div class="fe ff jo"><img src="../Images/a8c8377868f64f51a7fc1831c39ba016.png" data-original-src="https://miro.medium.com/v2/resize:fit:814/format:webp/1*tKzucvbuZhTGK0JMJfgCMw.png"/></div><figcaption class="jw jx fg fe ff jy jz bd b be z ek">Ethereum Name Service logo</figcaption></figure><p id="118a" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">ENS代表以太坊名称服务，这是一组在以太坊区块链上提供分布式命名系统的智能合约。ENS本身不是以太坊栈的一部分，而是一个<a class="ae ka" href="https://github.com/ethereum/EIPs/issues/137" rel="noopener ugc nofollow" target="_blank">社区驱动的规范</a>，你可以很容易地使用你的自定义域名解析器来扩展它。</p><p id="aa89" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">在本教程中，我将指导您完成在Rinkeby上注册测试域的过程。您可以很容易地将以下步骤应用于其他只改变地址的测试网。</p><p id="d9e7" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">与Mainnet或Ropsten上不同，Rinkeby上的ENS不支持。eth域，并且仅限于使用. test域。正在注册。测试域名更快，因为它不需要你通过<a class="ae ka" href="https://docs.ens.domains/en/latest/userguide.html#auctions" rel="noopener ugc nofollow" target="_blank">拍卖</a>过程。测试域也在28天后到期，这使得它足以在开发阶段使用。</p><h1 id="c600" class="kb kc ht bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky dt translated">注册。测试域</h1><p id="6ebb" class="pw-post-body-paragraph iq ir ht is b it kz iv iw ix la iz ja jb lb jd je jf lc jh ji jj ld jl jm jn hm dt translated">在我们开始之前，让我们下载一下<a class="ae ka" href="https://github.com/ethereum/ens/blob/master/ensutils-testnet.js" rel="noopener ugc nofollow" target="_blank"> ensutils-testnet.js </a>，它包含了一些ABI和helper函数，可以使这个过程更加简单。硬编码的ENS地址对我们没有好处，因为我们想使用Rinkeby，而不是Ropsten。另一方面，如果你想在Ropsten上注册一个名字，你就万事俱备了。前往<a class="ae ka" href="https://github.com/ethereum/ens/blob/master/ensutils-testnet.js#L220" rel="noopener ugc nofollow" target="_blank">线220 </a>并更改ENS合同地址。</p><pre class="jp jq jr js fq le lf lg lh aw li dt"><span id="7995" class="lj kc ht lf b fv lk ll l lm ln">var ens = ensContract.at(<br/>  '0xe7410170f87102df0055eb195163a03b7f2bff4a'<br/>);</span></pre><p id="7999" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">我已经准备了一个要点，包含了在Rinkeby上运行ensutils所需的所有更改:<a class="ae ka" href="https://gist.github.com/MichalZalecki/db02810da8e582d0494adb2c5fd31f3c#file-ensutils-rinkeby-js" rel="noopener ugc nofollow" target="_blank"> ensutils-rinkeby.js </a>。</p><ul class=""><li id="3e10" class="lo lp ht is b it iu ix iy jb lq jf lr jj ls jn lt lu lv lw dt translated">主网上的ENS:<code class="eh lx ly lz lf b">0x314159265dd8dbb310642f98f50c066173c1259b</code></li><li id="a228" class="lo lp ht is b it ma ix mb jb mc jf md jj me jn lt lu lv lw dt translated">Ropsten上的ENS:<code class="eh lx ly lz lf b">0x112234455c3a32fd11230c42e7bccd4a84e02010</code></li><li id="f829" class="lo lp ht is b it ma ix mb jb mc jf md jj me jn lt lu lv lw dt translated">ENS on Rinkeby: <code class="eh lx ly lz lf b">0xe7410170f87102df0055eb195163a03b7f2bff4a</code></li></ul><p id="2711" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">完成后，使用geth连接到正在运行的Ethereum节点，并加载ensutils脚本。</p><pre class="jp jq jr js fq le lf lg lh aw li dt"><span id="9f14" class="lj kc ht lf b fv lk ll l lm ln">$ geth attach <a class="ae ka" href="http://127.0.0.1:8545" rel="noopener ugc nofollow" target="_blank">http://127.0.0.1:8545</a><br/>&gt; loadScript("./ensutils-rinkeby.js")</span></pre><p id="ec88" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">在我们注册之前，让我们检查一下您想要拥有的名称是否可用。</p><pre class="jp jq jr js fq le lf lg lh aw li dt"><span id="a669" class="lj kc ht lf b fv lk ll l lm ln">&gt; testRegistrar.expiryTimes(web3.sha3("michalzalecki"))<br/>0</span></pre><p id="9c8f" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">如果返回的时间戳是0，或者是过去的，那么你可以注册这个名字。</p><pre class="jp jq jr js fq le lf lg lh aw li dt"><span id="15bf" class="lj kc ht lf b fv lk ll l lm ln">&gt; testRegistrar.register(web3.sha3("michalzalecki"), eth.accounts[0], {from: eth.accounts[0]})</span><span id="1225" class="lj kc ht lf b fv mf ll l lm ln">0x986a21970a14258fae1bfc952e731ec88cb94818d78a4c68212da312e6eee2f0</span></pre><p id="c915" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">等待区块链包含事务。现在，您可以通过重新检查到期时间和所有者来确认注册。</p><pre class="jp jq jr js fq le lf lg lh aw li dt"><span id="94cb" class="lj kc ht lf b fv lk ll l lm ln">&gt; testRegistrar.expiryTimes(web3.sha3("michalzalecki"))<br/>1527679534</span><span id="6952" class="lj kc ht lf b fv mf ll l lm ln">&gt; ens.owner(namehash("michalzalecki.test"))<br/>"0xY0urAdd355"</span></pre><p id="f674" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">恭喜你，你已经在ENS上出名了！</p><h1 id="ba23" class="kb kc ht bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky dt translated">公共解析器</h1><p id="75b5" class="pw-post-body-paragraph iq ir ht is b it kz iv iw ix la iz ja jb lb jd je jf lc jh ji jj ld jl jm jn hm dt translated">你拥有一个名字，但它还没有解决任何问题。你需要一个解析器。据我所知，在撰写本文时，Rinkeby上还没有官方的公共解析程序。好消息是任何人都可以创建和部署一个。如果您不想创建解析器，请跳到下一节。</p><p id="10ee" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">克隆ENS存储库，安装依赖项并删除构建目录。</p><pre class="jp jq jr js fq le lf lg lh aw li dt"><span id="db90" class="lj kc ht lf b fv lk ll l lm ln">git clone https://github.com/ethereum/ens npm install rm -rf build</span></pre><p id="5eba" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">更改松露配置，这样你就可以部署到Rinkeby。</p><pre class="jp jq jr js fq le lf lg lh aw li dt"><span id="9691" class="lj kc ht lf b fv lk ll l lm ln"><em class="mg">// truffle.js</em><br/>module.exports <strong class="lf hu">=</strong> {<br/>  networks: {<br/>    rinkeby: {<br/>      host: "127.0.0.1",<br/>      port: 8545,<br/>      network_id: 4<br/>    },<br/>  },<br/>  solc: {<br/>    optimizer: {<br/>      enabled: <strong class="lf hu">true</strong>,<br/>      runs: 200,<br/>    },<br/>  },<br/>};</span></pre><p id="2037" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">我们不需要部署所有契约，只需要部署PublicResolver。让我们删除不必要的迁移文件并创建一个新的。</p><pre class="jp jq jr js fq le lf lg lh aw li dt"><span id="23e8" class="lj kc ht lf b fv lk ll l lm ln"><em class="mg">// 2_public_resolver.js</em><br/><strong class="lf hu">const</strong> PublicResolver <strong class="lf hu">=</strong> artifacts.require("./PublicResolver.sol");<br/><br/><strong class="lf hu">const</strong> ENS <strong class="lf hu">=</strong> "0xe7410170f87102df0055eb195163a03b7f2bff4a";<br/><br/>module.exports <strong class="lf hu">=</strong> <strong class="lf hu">function</strong>(deployer) {<br/>  deployer.deploy(PublicResolver, ENS);<br/>};</span></pre><p id="308d" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">最后一步是运行迁移。</p><pre class="jp jq jr js fq le lf lg lh aw li dt"><span id="163c" class="lj kc ht lf b fv lk ll l lm ln">./node_modules/.bin/truffle migrate --network rinkeby</span></pre><p id="fc74" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">如果你想知道更多关于在Etherscan上验证你的合同的信息，并给你的解析器一点可信度，那么读一下我的另一个教程:</p><div class="mh mi fm fo mj mk"><a rel="noopener follow" target="_blank" href="/coinmonks/how-to-verify-smart-contract-on-etherscan-b9a79cb8793a"><div class="ml ab ej"><div class="mm ab mn cl cj mo"><h2 class="bd hu fv z el mp eo ep mq er et hs dt translated">如何在Etherscan上验证智能合约？</h2><div class="mr l"><h3 class="bd b fv z el mp eo ep mq er et ek translated">为什么要验证您的智能合同？看情况。这主要取决于您的用例。它总是下来…</h3></div><div class="ms l"><p class="bd b gc z el mp eo ep mq er et ek translated">medium.com</p></div></div><div class="mt l"><div class="mu l mv mw mx mt my ju mk"/></div></div></a></div><h1 id="0f70" class="kb kc ht bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky dt translated">解析域</h1><p id="62ae" class="pw-post-body-paragraph iq ir ht is b it kz iv iw ix la iz ja jb lb jd je jf lc jh ji jj ld jl jm jn hm dt translated">我们需要将我们的名字指向解析器，并设置一个我们的域要解析的地址。如果你没有你的解析器，你可以用我的。</p><pre class="jp jq jr js fq le lf lg lh aw li dt"><span id="15de" class="lj kc ht lf b fv lk ll l lm ln"><strong class="lf hu">&gt;</strong> publicResolver <strong class="lf hu">=</strong> resolverContract.at("0x5d20cf83cb385e06d2f2a892f9322cd4933eacdc")</span><span id="2c66" class="lj kc ht lf b fv mf ll l lm ln"><strong class="lf hu">&gt;</strong> ens.setResolver(namehash("michalzalecki.test"), publicResolver.address, {from: eth.accounts[0]})</span><span id="87fd" class="lj kc ht lf b fv mf ll l lm ln">0x939da269d9cf314ef61cba8226501b2f140383b968b6274f74a99b36bc7b986b</span></pre><p id="e17b" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">现在，您可以检查ENS是否保存了您的域的解析器地址</p><pre class="jp jq jr js fq le lf lg lh aw li dt"><span id="6f1c" class="lj kc ht lf b fv lk ll l lm ln"><strong class="lf hu">&gt;</strong> ens.resolver(namehash("michalzalecki.test"))<br/>"0x5d20cf83cb385e06d2f2a892f9322cd4933eacdc"</span></pre><p id="7289" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">我将把域设置为指向我的帐户地址，但此时它可以是任何地址。</p><pre class="jp jq jr js fq le lf lg lh aw li dt"><span id="e797" class="lj kc ht lf b fv lk ll l lm ln">&gt; publicResolver.setAddr(namehash("michalzalecki.test"), eth.accounts[0], {from: eth.accounts[0]})</span><span id="9580" class="lj kc ht lf b fv mf ll l lm ln">0x621a39c3cb0af3d951102453e11fb6f037918c2a63731c3b519b11d639ce22c0</span></pre><p id="eee7" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">现在让我们看看我们的域解析到哪个地址。我们可以通过直接调用public resolver或者使用getAddr helper函数来实现。</p><pre class="jp jq jr js fq le lf lg lh aw li dt"><span id="9927" class="lj kc ht lf b fv lk ll l lm ln"><strong class="lf hu">&gt;</strong> getAddr("michalzalecki.test")<br/>"0x7d20cb28c496a76173ee828ecacfb08deb379e8d"</span><span id="695e" class="lj kc ht lf b fv mf ll l lm ln"><strong class="lf hu">&gt;</strong> publicResolver.addr(namehash("michalzalecki.test"))<br/>"0x7d20cb28c496a76173ee828ecacfb08deb379e8d"</span></pre><p id="e6bc" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">如果您想在客户端或oracle上解析地址，那么您已经拥有了所需的所有工具。您可以使用ensutils的解析器和帮助器函数的ABI。也有<a class="ae ka" href="https://www.npmjs.com/package/ethereum-ens" rel="noopener ugc nofollow" target="_blank">以太坊-ens </a>但是它不支持web3 1.0。</p><h1 id="8736" class="kb kc ht bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky dt translated">结论</h1><p id="f1db" class="pw-post-body-paragraph iq ir ht is b it kz iv iw ix la iz ja jb lb jd je jf lc jh ji jj ld jl jm jn hm dt translated">ENS是一个伟大的项目，它试图让以太坊成为一个更友好的地方。虽然开发人员体验还不是很好，但它是一个强大的基础，并且广泛采用了流行的项目，如MyEtherWallet、MetaMask或Mist。</p><p id="56ef" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">当然，ENS的内容比我们在这里介绍的要多。有一个合适的<a class="ae ka" href="https://docs.ens.domains/en/latest/" rel="noopener ugc nofollow" target="_blank">文档</a>可以回答许多问题并提供多个例子。如果你想更多地了解这个项目及其背后的人，可以喝杯咖啡，看看尼克·约翰逊的演讲— <a class="ae ka" href="https://www.youtube.com/watch?v=Cr2Iik6aD9s" rel="noopener ugc nofollow" target="_blank">以太坊ENS —以太坊名称服务</a>。</p></div><div class="ab cl mz na hb nb" role="separator"><span class="nc bw bk nd ne nf"/><span class="nc bw bk nd ne nf"/><span class="nc bw bk nd ne"/></div><div class="hm hn ho hp hq"><p id="e644" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated"><em class="mg">原载于2018年5月3日</em><a class="ae ka" href="https://michalzalecki.com/register-test-domain-with-ens/" rel="noopener ugc nofollow" target="_blank"><em class="mg">【michalzalecki.com】</em></a><em class="mg">。</em></p></div></div>    
</body>
</html>