<html>
<head>
<title>On-chain document verification; a proof of concept.</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">链上文件验证；概念证明。</h1>
<blockquote>原文：<a href="https://medium.com/coinmonks/on-chain-document-verification-a-proof-of-concept-18d811fe8fa5?source=collection_archive---------4-----------------------#2018-09-27">https://medium.com/coinmonks/on-chain-document-verification-a-proof-of-concept-18d811fe8fa5?source=collection_archive---------4-----------------------#2018-09-27</a></blockquote><div><div class="ef hh hi hj hk hl"/><div class="hm hn ho hp hq"><div class=""/><blockquote class="iq"><p id="0fa0" class="ir is ht bd it iu iv iw ix iy iz ja ek translated">区块链不保证真理；它们保护真理和谎言不被日后篡改。—尼克·萨伯</p></blockquote><p id="1ef5" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx ja hm dt translated">因为区块链是一个分散的和不可变的分类账，它有可能提供文件欺诈预防。</p><p id="7ef7" class="pw-post-body-paragraph jb jc ht jd b je jy jg jh ji jz jk jl jm ka jo jp jq kb js jt ju kc jw jx ja hm dt translated">例如，文凭和证书可能是一个很好的用例——潜在雇主只需查询区块链，然后在出示此类文件后验证其真实性。学生可以将这些文档放在一个所谓的数字文件夹中，终生携带，存储在一个不能关闭的数据库中，并且没有停机时间。</p><p id="61c7" class="pw-post-body-paragraph jb jc ht jd b je jy jg jh ji jz jk jl jm ka jo jp jq kb js jt ju kc jw jx ja hm dt translated">在区块链上，存储的不是文档本身，而是加密哈希。这不仅符合GDPR准则并保护文件持有者/所有者的隐私，而且还保证了防水验证；如果有人篡改文凭或证书，就会产生不同的加密哈希，与存储在区块链上的哈希不一致。</p><p id="7713" class="pw-post-body-paragraph jb jc ht jd b je jy jg jh ji jz jk jl jm ka jo jp jq kb js jt ju kc jw jx ja hm dt translated">一旦文档被提交到区块链，它可能只是实现上述承诺。但是，我们如何防止一个坏演员提交一份欺诈性的文件呢？是的，我们可以让公证人来验证文件，但是……公证人是一个现实世界中的实体，可能是中央集权的，这样我们就摆脱了区块链的不信任本质。我们不能相信外链中介。</p><p id="7318" class="pw-post-body-paragraph jb jc ht jd b je jy jg jh ji jz jk jl jm ka jo jp jq kb js jt ju kc jw jx ja hm dt translated">理想情况下，我们需要通过一种分散的、对不良行为者有弹性的一致算法来验证链上的文档。这种共识模式的参与者是所谓的先知，他们因说真话而获得经济上的奖励(因说谎而受到经济上的惩罚)。</p><p id="297a" class="pw-post-body-paragraph jb jc ht jd b je jy jg jh ji jz jk jl jm ka jo jp jq kb js jt ju kc jw jx ja hm dt translated">智能合约的象征性经济学是对先知参与的激励，共识算法的<a class="ae kd" href="https://en.wikipedia.org/wiki/Prisoner%27s_dilemma" rel="noopener ugc nofollow" target="_blank">囚徒困境</a>是防止他们做出恶劣行为的原因(例如，在他们被要求验证的文件的真实性上撒谎)。验证链上文档的真实性是很重要的，因为一旦我们离开链并进入现实世界，我们就失去了区块链的不可信任的本质。</p><p id="c4a8" class="pw-post-body-paragraph jb jc ht jd b je jy jg jh ji jz jk jl jm ka jo jp jq kb js jt ju kc jw jx ja hm dt translated">请注意，本文并没有为您提供可以插入到项目中的现成的智能合约。本文仅仅是链上文档验证背后的一个后勤练习，以伪代码的形式呈现给你。话虽如此，我们还是开始吧。</p></div><div class="ab cl ke kf hb kg" role="separator"><span class="kh bw bk ki kj kk"/><span class="kh bw bk ki kj kk"/><span class="kh bw bk ki kj"/></div><div class="hm hn ho hp hq"><h2 id="3935" class="kl km ht bd kn ko kp kq kr ks kt ku kv jm kw kx ky jq kz la lb ju lc ld le lf dt translated">智能合同# 1；管理神谕</h2><p id="b75e" class="pw-post-body-paragraph jb jc ht jd b je lg jg jh ji lh jk jl jm li jo jp jq lj js jt ju lk jw jx ja hm dt translated">在其最基本的形式中，Oracle只是一个(公钥)地址和一些关于Oracle的元数据，比如名称或头衔。契约#1包含(公钥)地址到结构的映射，后者保存元数据(以及余额，稍后将详细介绍)。</p><pre class="ll lm ln lo fq lp lq lr ls aw lt dt"><span id="27ec" class="kl km ht lq b fv lu lv l lw lx"><strong class="lq hu">struct</strong> Oracle {<br/>  string  <strong class="lq hu">public</strong>  name;<br/>  <!-- -->uint256 <strong class="lq hu">private</strong> balance;<br/>}</span><span id="b191" class="kl km ht lq b fv ly lv l lw lx"><strong class="lq hu">mapping</strong> (address =&gt; Oracle) <strong class="lq hu">public</strong> oracles;</span></pre><p id="e3b9" class="pw-post-body-paragraph jb jc ht jd b je jy jg jh ji jz jk jl jm ka jo jp jq kb js jt ju kc jw jx ja hm dt translated">合同#1的管理员(可能是将合同部署到区块链的地址)能够向合同添加或删除Oracles。如果其他任何人试图修改Oracles，就会抛出一个异常，事务被恢复。</p><p id="a997" class="pw-post-body-paragraph jb jc ht jd b je jy jg jh ji jz jk jl jm ka jo jp jq kb js jt ju kc jw jx ja hm dt translated">神谕本身需要向这个契约支付X量的ETH，才能参与共识算法。这个重要的先决条件是，如果先知对文件的真实性撒谎，共识算法就可以惩罚他或她。</p><p id="aca7" class="pw-post-body-paragraph jb jc ht jd b je jy jg jh ji jz jk jl jm ka jo jp jq kb js jt ju kc jw jx ja hm dt translated">至于可见性，我们认为公众可见性没有任何问题。这允许第三方审计Oracles。</p></div><div class="ab cl ke kf hb kg" role="separator"><span class="kh bw bk ki kj kk"/><span class="kh bw bk ki kj kk"/><span class="kh bw bk ki kj"/></div><div class="hm hn ho hp hq"><h2 id="6cff" class="kl km ht bd kn ko kp kq kr ks kt ku kv jm kw kx ky jq kz la lb ju lc ld le lf dt translated">智能合同# 2；上传文档</h2><p id="32c9" class="pw-post-body-paragraph jb jc ht jd b je lg jg jh ji lh jk jl jm li jo jp jq lj js jt ju lk jw jx ja hm dt translated">该合同允许文档的持有者/所有者将其上传到区块链。然后，文档存储在一个字节数组中。</p><pre class="ll lm ln lo fq lp lq lr ls aw lt dt"><span id="33b1" class="kl km ht lq b fv lu lv l lw lx"><strong class="lq hu">enum</strong> Vote { None, Valid, Invalid }</span><span id="5af7" class="kl km ht lq b fv ly lv l lw lx"><strong class="lq hu">struct</strong> Document {<br/>  bytes[] data;<br/>  uint256 balance;<br/>  uint256 timestamp;<br/>  uint256 voteCount;<br/>  <strong class="lq hu">mapping</strong> (address =&gt; Vote) votes<br/>}</span><span id="ddff" class="kl km ht lq b fv ly lv l lw lx"><strong class="lq hu">mapping</strong> (address =&gt; Document) <strong class="lq hu">private</strong> documents</span></pre><p id="3a1a" class="pw-post-body-paragraph jb jc ht jd b je jy jg jh ji jz jk jl jm ka jo jp jq kb js jt ju kc jw jx ja hm dt translated">请注意，这些字节的可见性只对先知是禁止的。除了神谕之外，任何人都不允许查询这份合同中的文件。</p><p id="95d6" class="pw-post-body-paragraph jb jc ht jd b je jy jg jh ji jz jk jl jm ka jo jp jq kb js jt ju kc jw jx ja hm dt translated">契约#2的构造者采用了契约#1的地址，在此拒绝除神谕之外的任何人…</p><ol class=""><li id="4482" class="lz ma ht jd b je jy ji jz jm mb jq mc ju md ja me mf mg mh dt translated">查询已上传的文档，以及</li><li id="f42a" class="lz ma ht jd b je mi ji mj jm mk jq ml ju mm ja me mf mg mh dt translated">参与共识算法。</li></ol><p id="939b" class="pw-post-body-paragraph jb jc ht jd b je jy jg jh ji jz jk jl jm ka jo jp jq kb js jt ju kc jw jx ja hm dt translated">上传功能(允许持有者/所有者上传文件)是所谓的<strong class="jd hu">应付款</strong>。这允许共识算法在共识期结束时支付先知们的贡献。</p><pre class="ll lm ln lo fq lp lq lr ls aw lt dt"><span id="1440" class="kl km ht lq b fv lu lv l lw lx"><strong class="lq hu">function</strong> upload(bytes[] _bytes) <strong class="lq hu">public</strong> <strong class="lq hu">payable</strong> {<br/>  ...<br/>}</span></pre><p id="42cb" class="pw-post-body-paragraph jb jc ht jd b je jy jg jh ji jz jk jl jm ka jo jp jq kb js jt ju kc jw jx ja hm dt translated">持有人/所有者需要为他/她的提交支付最低ETH金额(否则，将引发异常)。如果持有人/所有人决定支付高于最低金额的金额，那么他/她的文件很可能会更快获得批准。</p><p id="4e16" class="pw-post-body-paragraph jb jc ht jd b je jy jg jh ji jz jk jl jm ka jo jp jq kb js jt ju kc jw jx ja hm dt translated">文档上传后会发出一个事件，通知Oracles。请注意，我们至少需要3个Oracles，并且它们都需要为契约#1贡献至少X个ETH，否则将引发异常，事务将被恢复。</p><p id="ac3a" class="pw-post-body-paragraph jb jc ht jd b je jy jg jh ji jz jk jl jm ka jo jp jq kb js jt ju kc jw jx ja hm dt translated">本质上，共识算法是这样工作的；我们至少需要3个神谕(越多越好)，在我们达成共识之前，我们需要至少51%的神谕给合同#2相同的答案。一旦达成共识，合同#2将…</p><ol class=""><li id="1e6b" class="lz ma ht jd b je jy ji jz jm mb jq mc ju md ja me mf mg mh dt translated">计算文档字节的加密哈希，以及</li><li id="9df4" class="lz ma ht jd b je mi ji mj jm mk jq ml ju mm ja me mf mg mh dt translated">将加密散列存储在智能契约#3中(稍后将详细介绍)</li></ol><p id="d5b6" class="pw-post-body-paragraph jb jc ht jd b je jy jg jh ji jz jk jl jm ka jo jp jq kb js jt ju kc jw jx ja hm dt translated">请注意，上面的场景假设51%的先知认为文档是有效的。如果他们决定文档不是真实的，则没有加密散列被提交给契约#3。</p><p id="d74c" class="pw-post-body-paragraph jb jc ht jd b je jy jg jh ji jz jk jl jm ka jo jp jq kb js jt ju kc jw jx ja hm dt translated">我们将合同#2中的字节保留1周。这应该给先知们足够的机会来参与共识算法。1周后，合同#2将…</p><ol class=""><li id="7dc7" class="lz ma ht jd b je jy ji jz jm mb jq mc ju md ja me mf mg mh dt translated">将文件持有人/所有人支付给合同#2的ETH金额支付给按照一致结果回答的先知，除以先知的数量，以及</li><li id="086c" class="lz ma ht jd b je mi ji mj jm mk jq ml ju mm ja me mf mg mh dt translated">惩罚那些确实参与了但其答案不符合共识结果的先知，以及</li><li id="1329" class="lz ma ht jd b je mi ji mj jm mk jq ml ju mm ja me mf mg mh dt translated">将上传到合同#2的字节清零</li></ol><p id="2c8a" class="pw-post-body-paragraph jb jc ht jd b je jy jg jh ji jz jk jl jm ka jo jp jq kb js jt ju kc jw jx ja hm dt translated">请注意，上传到合同#2的字节在1周后总是被清零，不管是否达成共识。</p><p id="95f6" class="pw-post-body-paragraph jb jc ht jd b je jy jg jh ji jz jk jl jm ka jo jp jq kb js jt ju kc jw jx ja hm dt translated">我们如何跟踪文档1周的生命周期，以及我们何时确定文档是否过期？坚固性不包括计时器吧？这是一个好问题。虽然共识算法本身是由Oracle参与触发的(例如，回答关于上传真实性的合同#2)，但对合同#2来说，最好的事情是持有人/所有者上传文档。换句话说:每次有人上传一个文档到契约#2，后者然后枚举所有其他文档，然后将过期的文档清零。</p><p id="d018" class="pw-post-body-paragraph jb jc ht jd b je jy jg jh ji jz jk jl jm ka jo jp jq kb js jt ju kc jw jx ja hm dt translated">事件已发出…</p><ol class=""><li id="53fb" class="lz ma ht jd b je jy ji jz jm mb jq mc ju md ja me mf mg mh dt translated">在文件已上传至合同#2后，特此通知先知，以及</li><li id="e289" class="lz ma ht jd b je mi ji mj jm mk jq ml ju mm ja me mf mg mh dt translated">一旦达成共识，特此通知文件持有人/所有人，以及</li><li id="4698" class="lz ma ht jd b je mi ji mj jm mk jq ml ju mm ja me mf mg mh dt translated">一旦文件过期，特此通知先知。如果此时未达成共识，则该事件还会通知文档的持有者/所有者。</li></ol><blockquote class="mn mo mp"><p id="b945" class="jb jc mq jd b je jy jg jh ji jz jk jl mr ka jo jp ms kb js jt mt kc jw jx ja hm dt translated">除了上面的字节数组，我们可以将文档上传到<a class="ae kd" href="https://swarm-guide.readthedocs.io" rel="noopener ugc nofollow" target="_blank"> Swarm </a>，然后向Oracles提供Swarm中内容的十六进制地址字符串，供他们下载。但是为了这篇文章的缘故，我们暂时把事情放在智能合约中。</p></blockquote></div><div class="ab cl ke kf hb kg" role="separator"><span class="kh bw bk ki kj kk"/><span class="kh bw bk ki kj kk"/><span class="kh bw bk ki kj"/></div><div class="hm hn ho hp hq"><h2 id="4993" class="kl km ht bd kn ko kp kq kr ks kt ku kv jm kw kx ky jq kz la lb ju lc ld le lf dt translated">智能合同# 3；无限期存储指纹</h2><p id="a926" class="pw-post-body-paragraph jb jc ht jd b je lg jg jh ji lh jk jl jm li jo jp jq lj js jt ju lk jw jx ja hm dt translated">一旦达成共识，就计算文档的加密散列，然后存储在契约#3中</p><pre class="ll lm ln lo fq lp lq lr ls aw lt dt"><span id="b7f0" class="kl km ht lq b fv lu lv l lw lx"><strong class="lq hu">mapping</strong> (bytes32 =&gt; address) <strong class="lq hu">public</strong> hashes </span></pre><p id="4480" class="pw-post-body-paragraph jb jc ht jd b je jy jg jh ji jz jk jl jm ka jo jp jq kb js jt ju kc jw jx ja hm dt translated">不言而喻，虽然散列对每个人都是公开的，但只有契约#2被允许将新散列推送到契约#3。</p><p id="d616" class="pw-post-body-paragraph jb jc ht jd b je jy jg jh ji jz jk jl jm ka jo jp jq kb js jt ju kc jw jx ja hm dt translated">智能合同#3允许任何dApp验证…</p><ol class=""><li id="c5f9" class="lz ma ht jd b je jy ji jz jm mb jq mc ju md ja me mf mg mh dt translated">文档是否可信(否则，散列就不会存在于契约#3中)，以及</li><li id="cef9" class="lz ma ht jd b je mi ji mj jm mk jq ml ju mm ja me mf mg mh dt translated">该文档是否属于提交该文档的人的(公钥)地址</li></ol></div><div class="ab cl ke kf hb kg" role="separator"><span class="kh bw bk ki kj kk"/><span class="kh bw bk ki kj kk"/><span class="kh bw bk ki kj"/></div><div class="hm hn ho hp hq"><p id="c3ba" class="pw-post-body-paragraph jb jc ht jd b je jy jg jh ji jz jk jl jm ka jo jp jq kb js jt ju kc jw jx ja hm dt translated"><em class="mq">本文由</em><a class="ae kd" href="https://www.linkedin.com/in/ceciel-van-helden-61b96619" rel="noopener ugc nofollow" target="_blank"><em class="mq">Ceciel van Helden</em></a><em class="mq">合著，V-ID </em>  <em class="mq">首席程序员。</em></p><blockquote class="iq"><p id="dfb7" class="ir is ht bd it iu mu mv mw mx my ja ek translated"><a class="ae kd" href="https://coincodecap.com/?utm_source=coinmonks" rel="noopener ugc nofollow" target="_blank">直接在您的收件箱中获得最佳软件交易</a></p></blockquote><figure class="na nb nc nd ne nf fe ff paragraph-image"><a href="https://coincodecap.com/?utm_source=coinmonks"><div class="fe ff mz"><img src="../Images/7c0b3dfdcbfea594cc0ae7d4f9bf6fcb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1168/format:webp/0*OJ-qb5G6i863msBB.png"/></div></a></figure></div></div>    
</body>
</html>