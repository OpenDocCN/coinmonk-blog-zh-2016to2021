<html>
<head>
<title>How DApp users can interact with your Smart Contracts with ZERO ETH</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">DApp用户如何通过ZERO ETH与您的智能合约互动</h1>
<blockquote>原文：<a href="https://medium.com/coinmonks/how-dapp-users-can-interact-with-your-smart-contracts-with-zero-eth-d0b664b355ce?source=collection_archive---------0-----------------------#2019-09-23">https://medium.com/coinmonks/how-dapp-users-can-interact-with-your-smart-contracts-with-zero-eth-d0b664b355ce?source=collection_archive---------0-----------------------#2019-09-23</a></blockquote><div><div class="ef hh hi hj hk hl"/><div class="hm hn ho hp hq"><div class=""/><div class=""><h2 id="785c" class="pw-subtitle-paragraph iq hs ht bd b ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ek translated">如果你希望主流采用，你的区块链用户不应该为你的基础设施买单。</h2></div><figure class="jj jk jl jm fq jn fe ff paragraph-image"><div role="button" tabindex="0" class="jo jp di jq bf jr"><div class="fe ff ji"><img src="../Images/1a01fdf3e8ffefad324b93d31e479511.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rPVk9s0UyrlxTOZvfLKXZQ.png"/></div></div><figcaption class="ju jv fg fe ff jw jx bd b be z ek">Lightstreams RelayServer on Sirius Test Network</figcaption></figure><p id="9d2b" class="pw-post-body-paragraph jy jz ht ka b kb kc iu kd ke kf ix kg kh ki kj kk kl km kn ko kp kq kr ks kt hm dt translated">这个问题众所周知。为了执行转移交易或与特定的应用程序智能合约进行交互，您需要支付以太网中的基础设施成本(gas)。没有用户，尤其是区块链生态系统的新用户，会愿意这样做。FREEMIUM模式在目前的Web2栈中如此广泛的实现是有原因的。买之前先尝一尝。</p><p id="efaa" class="pw-post-body-paragraph jy jz ht ka b kb kc iu kd ke kf ix kg kh ki kj kk kl km kn ko kp kq kr ks kt hm dt translated">在本文中，您将了解如何通过5个步骤在您的DApp中实现一个名为GSN的<strong class="ka hu">新以太坊概念来代表您的用户支付交易。</strong></p><h1 id="a142" class="ku kv ht bd kw kx ky kz la lb lc ld le iz lf ja lg jc lh jd li jf lj jg lk ll dt translated">加油站网络</h1><p id="c96f" class="pw-post-body-paragraph jy jz ht ka b kb lm iu kd ke ln ix kg kh lo kj kk kl lp kn ko kp lq kr ks kt hm dt translated">GSN是一个由网络安全公司<a class="ae lr" href="https://www.tabookey.com/" rel="noopener ugc nofollow" target="_blank"> TabooKey </a>设计和开发的概念。TabooKey在2018年12月提交了一份官方<a class="ae lr" href="https://github.com/ethereum/EIPs/blob/master/EIPS/eip-1613.md" rel="noopener ugc nofollow" target="_blank"> EIP-1613 </a>设计草案。</p><figure class="jj jk jl jm fq jn fe ff paragraph-image"><div role="button" tabindex="0" class="jo jp di jq bf jr"><div class="fe ff ls"><img src="../Images/6d2121fa1e3be7888c38ba59b73de535.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wO8eqrFNoX2vCi3UV_nCgA.png"/></div></div><figcaption class="ju jv fg fe ff jw jx bd b be z ek">src: <a class="ae lr" href="https://github.com/ethereum/EIPs/blob/master/EIPS/eip-1613.md" rel="noopener ugc nofollow" target="_blank">https://github.com/ethereum/EIPs/blob/master/EIPS/eip-1613.md</a></figcaption></figure><p id="34d6" class="pw-post-body-paragraph jy jz ht ka b kb kc iu kd ke kf ix kg kh ki kj kk kl km kn ko kp kq kr ks kt hm dt translated">复杂？</p><p id="2687" class="pw-post-body-paragraph jy jz ht ka b kb kc iu kd ke kf ix kg kh ki kj kk kl km kn ko kp kq kr ks kt hm dt translated">别担心。这个概念后来被已建立的以太坊审计公司<a class="ae lr" href="https://openzeppelin.com/" rel="noopener ugc nofollow" target="_blank"> OpenZeppelin </a> (OZ)采用并增强，他们开发了一套友好的JS助手工具来简化GSN的使用。</p><h2 id="8aa4" class="lt kv ht bd kw lu lv lw la lx ly lz le kh ma mb lg kl mc md li kp me mf lk mg dt translated">步骤0:选择你的以太坊兼容的区块链网络</h2><p id="27d9" class="pw-post-body-paragraph jy jz ht ka b kb lm iu kd ke ln ix kg kh lo kj kk kl lp kn ko kp lq kr ks kt hm dt translated">我将在<a class="ae lr" href="https://github.com/lightstreams-network/lightchain" rel="noopener ugc nofollow" target="_blank"> Lightstream的PoA以太坊兼容区块链</a>上演示使用方法。</p><p id="6ee6" class="pw-post-body-paragraph jy jz ht ka b kb kc iu kd ke kf ix kg kh ki kj kk kl km kn ko kp kq kr ks kt hm dt translated">为什么？</p><ul class=""><li id="5d25" class="mh mi ht ka b kb kc ke kf kh mj kl mk kp ml kt mm mn mo mp dt translated">解决天然气问题只是解决方案的一部分。主流应用需要快速响应。遗憾的是，以太坊的15s积木不能保证TX不会被还原，这对于任何面对交互式DApp的用户来说都是不够的。Lightstreams在3s块中提供即时终结。</li><li id="ca06" class="mh mi ht ka b kb mq ke mr kh ms kl mt kp mu kt mm mn mo mp dt translated">已经部署的RelayHub和活动的<a class="ae lr" href="https://gsn.sirius.lightstreams.io/getaddr" rel="noopener ugc nofollow" target="_blank"> RelayServer </a>意味着您不必担心之前可视化的复杂GSN图的一半，并且<strong class="ka hu">可以专注于您的应用业务案例</strong>。</li></ul><figure class="jj jk jl jm fq jn fe ff paragraph-image"><div role="button" tabindex="0" class="jo jp di jq bf jr"><div class="fe ff mv"><img src="../Images/bbf68a2b19661de847160050cf886b3c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*o5ivHmUgnJcIQcEkRtQJUg.png"/></div></div><figcaption class="ju jv fg fe ff jw jx bd b be z ek">Pre-deployed Lightstream’s RelayServer</figcaption></figure><h2 id="5fda" class="lt kv ht bd kw lu lv lw la lx ly lz le kh ma mb lg kl mc md li kp me mf lk mg dt translated">步骤1:使用您现有的智能合同</h2><p id="03f5" class="pw-post-body-paragraph jy jz ht ka b kb lm iu kd ke ln ix kg kh lo kj kk kl lp kn ko kp lq kr ks kt hm dt translated">例如，假设你有一个简单的<code class="eh mw mx my mz b">Voter.sol</code>智能合同，你的用户可以投票赞成或投票反对某个任意值。</p><pre class="jj jk jl jm fq na mz nb nc aw nd dt"><span id="086f" class="lt kv ht mz b fv ne nf l ng nh">contract Voter {<br/>    uint256 public count;<br/><br/>    event Voted(uint256 newCount, address account);<br/><br/>    function upVote() public {<br/>        address lastVoter = _msgSender();<br/>        count++;<br/><br/>        emit Voted(count, lastVoter);<br/>    }<br/><br/>    function downVote() public {<br/>        address lastVoter = _msgSender();<br/>        count--;<br/><br/>        emit Voted(count, lastVoter);<br/>    }<br/>}</span></pre><h2 id="cf65" class="lt kv ht bd kw lu lv lw la lx ly lz le kh ma mb lg kl mc md li kp me mf lk mg dt translated">第二步:继承气体自由的特点</h2><p id="4a8f" class="pw-post-body-paragraph jy jz ht ka b kb lm iu kd ke ln ix kg kh lo kj kk kl lp kn ko kp lq kr ks kt hm dt translated">继承<a class="ae lr" href="https://raw.githubusercontent.com/lightstreams-network/lightstreams-js-sdk/master/contracts/utils/GSN.sol" rel="noopener ugc nofollow" target="_blank"> GSN.sol </a>将你的传统SC转换成GSN兼容的。<code class="eh mw mx my mz b">GSN.sol</code>正在延长官方<a class="ae lr" href="https://github.com/OpenZeppelin/openzeppelin-contracts/blob/master/contracts/GSN/GSNRecipient.sol" rel="noopener ugc nofollow" target="_blank"> OpenZeppelin，TabooKey合同</a>。</p><pre class="jj jk jl jm fq na mz nb nc aw nd dt"><span id="2f48" class="lt kv ht mz b fv ne nf l ng nh">npm i --save lightstreams-js-sdk<br/>import "@lightstreams-js-sdk/contracts/utils/GSN.sol";<br/><br/>contract Voter is GSN {</span></pre><h2 id="43b6" class="lt kv ht bd kw lu lv lw la lx ly lz le kh ma mb lg kl mc md li kp me mf lk mg dt translated">步骤3:在全局RelayHub中注册Voter.sol SC</h2><p id="071d" class="pw-post-body-paragraph jy jz ht ka b kb lm iu kd ke ln ix kg kh lo kj kk kl lp kn ko kp lq kr ks kt hm dt translated">部署<code class="eh mw mx my mz b">Voter.sol</code>并调用<code class="eh mw mx my mz b">initialize</code>方法。作为<code class="eh mw mx my mz b">RELAY_HUB</code>参数，指定“<a class="ae lr" href="https://explorer.sirius.lightstreams.io/addr/0xecf278654f73000f9cb3b05858158ac49c29ed68" rel="noopener ugc nofollow" target="_blank">0x ECF 278654 f 73000 F9 CB 3b 05858158 AC 49 c 29 ed 68</a>”。</p><p id="6b04" class="pw-post-body-paragraph jy jz ht ka b kb kc iu kd ke kf ix kg kh ki kj kk kl km kn ko kp kq kr ks kt hm dt translated">这是部署在Lightstream的<strong class="ka hu"> Sirius </strong>测试网络上的官方RelayHub。</p><pre class="jj jk jl jm fq na mz nb nc aw nd dt"><span id="4e99" class="lt kv ht mz b fv ne nf l ng nh">voter.initialize(RELAY_HUB)</span></pre><h2 id="238d" class="lt kv ht bd kw lu lv lw la lx ly lz le kh ma mb lg kl mc md li kp me mf lk mg dt translated">步骤4:为用户交易付费</h2><p id="3c86" class="pw-post-body-paragraph jy jz ht ka b kb lm iu kd ke ln ix kg kh lo kj kk kl lp kn ko kp lq kr ks kt hm dt translated">用户交易将是免费的，但投票应用程序仍需为此付费。这是通过在RelayHub中预先资助您希望无气体的SC来实现的。</p><p id="8a12" class="pw-post-body-paragraph jy jz ht ka b kb kc iu kd ke kf ix kg kh ki kj kk kl km kn ko kp kq kr ks kt hm dt translated">安装OZ GSN助手:</p><pre class="jj jk jl jm fq na mz nb nc aw nd dt"><span id="1bf8" class="lt kv ht mz b fv ne nf l ng nh">"@openzeppelin/gsn-helpers": "0.1.9",</span></pre><p id="cf6c" class="pw-post-body-paragraph jy jz ht ka b kb kc iu kd ke kf ix kg kh ki kj kk kl km kn ko kp kq kr ks kt hm dt translated">导入<code class="eh mw mx my mz b">fundRecipient</code>方法:</p><pre class="jj jk jl jm fq na mz nb nc aw nd dt"><span id="f69a" class="lt kv ht mz b fv ne nf l ng nh">const { fundRecipient } = require('@openzeppelin/gsn-helpers');</span></pre><p id="2392" class="pw-post-body-paragraph jy jz ht ka b kb kc iu kd ke kf ix kg kh ki kj kk kl km kn ko kp kq kr ks kt hm dt translated">为<code class="eh mw mx my mz b">Voter.sol</code>提供您愿意为用户交易支付的尽可能多的天然气费用:</p><pre class="jj jk jl jm fq na mz nb nc aw nd dt"><span id="723a" class="lt kv ht mz b fv ne nf l ng nh">await fundRecipient(web3, {<br/>  recipient: voter.address,<br/>  relayHubAddress: RELAY_HUB,<br/>  amount: web3.utils.toWei("10", "ether"),<br/>  from: YOUR_PHT_ACCOUNT<br/>});</span></pre><h2 id="ef7d" class="lt kv ht bd kw lu lv lw la lx ly lz le kh ma mb lg kl mc md li kp me mf lk mg dt translated">第五步:让用户执行免费交易</h2><p id="0776" class="pw-post-body-paragraph jy jz ht ka b kb lm iu kd ke ln ix kg kh lo kj kk kl lp kn ko kp lq kr ks kt hm dt translated">为了做到这一点，您将需要一个用HTTP中继功能修饰的特殊Web3 lib。为什么？因为用户的无汽油交易现在将被提交到前面提到的<strong class="ka hu"> HTTP中继服务器</strong><a class="ae lr" href="https://gsn.sirius.lightstreams.io/getaddr" rel="noopener ugc nofollow" target="_blank">https://gsn.sirius.lightstreams.io/getaddr</a>并且在它们被广播到区块链之前被修饰。</p><p id="4d1f" class="pw-post-body-paragraph jy jz ht ka b kb kc iu kd ke kf ix kg kh ki kj kk kl km kn ko kp kq kr ks kt hm dt translated">需要Lightstream调整后的OZ网络库:</p><pre class="jj jk jl jm fq na mz nb nc aw nd dt"><span id="32b6" class="lt kv ht mz b fv ne nf l ng nh">const { fromConnection } = require('@lightstreams-js-sdk/node_modules/openzeppelin/network');</span></pre><p id="84e8" class="pw-post-body-paragraph jy jz ht ka b kb kc iu kd ke kf ix kg kh ki kj kk kl km kn ko kp kq kr ks kt hm dt translated">创建一个新的GSN powered Web3对象:</p><pre class="jj jk jl jm fq na mz nb nc aw nd dt"><span id="e319" class="lt kv ht mz b fv ne nf l ng nh">gsnCtx = await fromConnection(<br/>  web3.eth.currentProvider.host, {<br/>    gsn: {<br/>      dev: false,<br/>      signKey: emptyAcc.privateKey<br/>    }<br/>});</span><span id="4186" class="lt kv ht mz b fv ni nf l ng nh">web3 = gsnCtx.lib;</span></pre><blockquote class="nj"><p id="b18d" class="nk nl ht bd nm nn no np nq nr ns kt ek translated">执行无气TX！</p></blockquote><pre class="nt nu nv nw nx na mz nb nc aw nd dt"><span id="ce61" class="lt kv ht mz b fv ne nf l ng nh">const voterGSN = await new gsnCtx.lib.eth.Contract(voter.abi, voter.address);<br/><br/>const tx = await <strong class="mz hu">voterGSN.methods.upVote</strong>().send({<br/>  from: <strong class="mz hu">emptyAcc.address</strong>,<br/>  gasPrice: gasPrice,<br/>  gasLimit: "1000000",<br/>});</span></pre><figure class="jj jk jl jm fq jn fe ff paragraph-image"><div role="button" tabindex="0" class="jo jp di jq bf jr"><div class="fe ff ny"><img src="../Images/aa2ae51bb4c74450f10611e02155c8f6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*uFGawvOQ_SJBC9Ci26MBrQ.png"/></div></div><figcaption class="ju jv fg fe ff jw jx bd b be z ek">PS: Notice the fast ~3s block time</figcaption></figure><p id="336f" class="pw-post-body-paragraph jy jz ht ka b kb kc iu kd ke kf ix kg kh ki kj kk kl km kn ko kp kq kr ks kt hm dt translated">完整源代码请点击<a class="ae lr" href="https://raw.githubusercontent.com/lightstreams-network/lightstreams-js-sdk/master/test/04_gsn_voter.js" rel="noopener ugc nofollow" target="_blank">此处</a>:</p><figure class="jj jk jl jm fq jn"><div class="bz el l di"><div class="nz oa l"/></div></figure><p id="a59d" class="pw-post-body-paragraph jy jz ht ka b kb kc iu kd ke kf ix kg kh ki kj kk kl km kn ko kp kq kr ks kt hm dt translated">我还有几个问题，可以问谁，在哪里问？</p><p id="2b91" class="pw-post-body-paragraph jy jz ht ka b kb kc iu kd ke kf ix kg kh ki kj kk kl km kn ko kp kq kr ks kt hm dt translated">首先感谢大家的关注！请在下面留言或在LinkedIn上给我发消息，我会很乐意支持你的GSN整合。</p><h1 id="528a" class="ku kv ht bd kw kx ky kz la lb lc ld le iz lf ja lg jc lh jd li jf lj jg lk ll dt translated">结论</h1><p id="c827" class="pw-post-body-paragraph jy jz ht ka b kb lm iu kd ke ln ix kg kh lo kj kk kl lp kn ko kp lq kr ks kt hm dt translated">如果将正确的技术结合在一起，区块链的主流采用指日可待。</p><p id="37e5" class="pw-post-body-paragraph jy jz ht ka b kb kc iu kd ke kf ix kg kh ki kj kk kl km kn ko kp kq kr ks kt hm dt translated">请访问Lightstreams文档，立即开始开发主流、响应迅速的应用程序。</p><p id="a247" class="pw-post-body-paragraph jy jz ht ka b kb kc iu kd ke kf ix kg kh ki kj kk kl km kn ko kp kq kr ks kt hm dt translated"><a class="ae lr" href="https://docs.lightstreams.network/" rel="noopener ugc nofollow" target="_blank">https://docs . light streams . network</a></p><p id="598b" class="pw-post-body-paragraph jy jz ht ka b kb kc iu kd ke kf ix kg kh ki kj kk kl km kn ko kp kq kr ks kt hm dt translated"><strong class="ka hu"> <em class="ob"> PS: </em> </strong> <em class="ob">特别感谢OpenZeppelin团队(Andrew、Nicolas、Igor和Marti)在GSN整合中对我们的支持！</em></p><blockquote class="nj"><p id="fdfb" class="nk nl ht bd nm nn oc od oe of og kt ek translated"><a class="ae lr" href="https://coincodecap.com/?utm_source=coinmonks" rel="noopener ugc nofollow" target="_blank">直接在您的收件箱中获得最佳软件交易</a></p></blockquote><figure class="nt nu nv nw nx jn fe ff paragraph-image"><a href="https://coincodecap.com/?utm_source=coinmonks"><div class="fe ff oh"><img src="../Images/7c0b3dfdcbfea594cc0ae7d4f9bf6fcb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1168/format:webp/0*OJ-qb5G6i863msBB.png"/></div></a></figure></div></div>    
</body>
</html>