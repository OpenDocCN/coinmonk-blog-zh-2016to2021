<html>
<head>
<title>Ethernaut Lvl 5 Token Walkthrough: How to abuse arithmetic underflows and overflows</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Ethernaut Lvl 5令牌演练:如何滥用算术下溢和上溢</h1>
<blockquote>原文：<a href="https://medium.com/coinmonks/ethernaut-lvl-5-walkthrough-how-to-abuse-arithmetic-underflows-and-overflows-2c614fa86b74?source=collection_archive---------3-----------------------#2018-08-22">https://medium.com/coinmonks/ethernaut-lvl-5-walkthrough-how-to-abuse-arithmetic-underflows-and-overflows-2c614fa86b74?source=collection_archive---------3-----------------------#2018-08-22</a></blockquote><div><div class="ef hh hi hj hk hl"/><div class="hm hn ho hp hq"><div class=""/><div class=""><h2 id="558e" class="pw-subtitle-paragraph iq hs ht bd b ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ek translated">这是一个围绕<a class="ae ji" href="https://openzeppelin.org/" rel="noopener ugc nofollow" target="_blank"> Zeppelin </a>团队的<a class="ae ji" href="https://ethernaut.zeppelin.solutions/" rel="noopener ugc nofollow" target="_blank">智能合约安全拼图</a>的<a class="ae ji" rel="noopener" href="/@nicolezhu">深度系列</a>。我会给你直接的资源和你需要的关键概念来100%自己解决这些难题。</h2></div><p id="0839" class="pw-post-body-paragraph jj jk ht jl b jm jn iu jo jp jq ix jr js jt ju jv jw jx jy jz ka kb kc kd ke hm dt translated">这个等级需要你将你的契约的20个代币增加到更多。</p></div><div class="ab cl kf kg hb kh" role="separator"><span class="ki bw bk kj kk kl"/><span class="ki bw bk kj kk kl"/><span class="ki bw bk kj kk"/></div><div class="hm hn ho hp hq"><h1 id="e27d" class="km kn ht bd ko kp kq kr ks kt ku kv kw iz kx ja ky jc kz jd la jf lb jg lc ld dt translated"><code class="eh le lf lg lh b">Integer Overflow and Underflows</code></h1><p id="9770" class="pw-post-body-paragraph jj jk ht jl b jm li iu jo jp lj ix jr js lk ju jv jw ll jy jz ka lm kc kd ke hm dt translated">像C和C++一样，Solidity是一种低级编码语言，它没有处理存储限制的故障保险。这与Ruby和Python开发人员可能习惯的不同。</p><p id="30fc" class="pw-post-body-paragraph jj jk ht jl b jm jn iu jo jp jq ix jr js jt ju jv jw jx jy jz ka kb kc kd ke hm dt translated">以太坊的智能合约存储槽每个都是256位，即32字节。Solidity既支持有符号整数，也支持高达256位的无符号整数<code class="eh le lf lg lh b">uint</code>。</p><p id="daed" class="pw-post-body-paragraph jj jk ht jl b jm jn iu jo jp jq ix jr js jt ju jv jw jx jy jz ka kb kc kd ke hm dt translated">这意味着当你的数字低于或高于分配的存储位时，你的算术运算容易发生下溢和上溢错误。</p><blockquote class="ln lo lp"><p id="4172" class="jj jk lq jl b jm jn iu jo jp jq ix jr lr jt ju jv ls jx jy jz lt kb kc kd ke hm dt translated">注意:最大可能的uint256等于<code class="eh le lf lg lh b">115792089237316195423570985008687907853269984665640564039457584007913129639935</code>——希望足以代表你所需要的</p></blockquote><figure class="lu lv lw lx fq ly"><div class="bz el l di"><div class="lz ma l"/></div></figure><p id="a8fa" class="pw-post-body-paragraph jj jk ht jl b jm jn iu jo jp jq ix jr js jt ju jv jw jx jy jz ka kb kc kd ke hm dt translated">下面是上面代码片段的可视化:</p><figure class="lu lv lw lx fq ly fe ff paragraph-image"><div role="button" tabindex="0" class="mc md di me bf mf"><div class="fe ff mb"><img src="../Images/3cc49e1967d352c13a6de8a487e1bc27.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xAYyHOxwWcMUU5ycSbCp8Q.jpeg"/></div></div></figure><p id="ed3c" class="pw-post-body-paragraph jj jk ht jl b jm jn iu jo jp jq ix jr js jt ju jv jw jx jy jz ka kb kc kd ke hm dt translated">这使得自行处理算术运算符的契约变得脆弱。通常，我们从<a class="ae ji" href="https://github.com/OpenZeppelin/openzeppelin-solidity/blob/master/contracts/math/SafeMath.sol" rel="noopener ugc nofollow" target="_blank"> safemath.sol </a>库中继承数学运算符。</p></div><div class="ab cl kf kg hb kh" role="separator"><span class="ki bw bk kj kk kl"/><span class="ki bw bk kj kk kl"/><span class="ki bw bk kj kk"/></div><div class="hm hn ho hp hq"><figure class="lu lv lw lx fq ly fe ff paragraph-image"><div role="button" tabindex="0" class="mc md di me bf mf"><div class="fe ff mi"><img src="../Images/f5be8edbc039c458b34988c25d79331c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ss1F88SfjFv_UHqPnhiEoA.png"/></div></div></figure><h1 id="b309" class="km kn ht bd ko kp mj kr ks kt mk kv kw iz ml ja ky jc mm jd la jf mn jg lc ld dt translated">详细演练</h1><ol class=""><li id="560e" class="mo mp ht jl b jm li jp lj js mq jw mr ka ms ke mt mu mv mw dt translated">注意Telephone.sol的<code class="eh le lf lg lh b">changeOwner</code>函数检查是否<code class="eh le lf lg lh b">(tx.origin != msg.sender)</code>。看起来我们可以通过场景3成功触发该功能:</li></ol><p id="8b4a" class="pw-post-body-paragraph jj jk ht jl b jm jn iu jo jp jq ix jr js jt ju jv jw jx jy jz ka kb kc kd ke hm dt translated">2.创建一个电话合同，<code class="eh le lf lg lh b">Telephony</code>作为合同a。在<code class="eh le lf lg lh b">Telephony</code>中实例化合同B，即您的phone.sol:</p><pre class="lu lv lw lx fq mx lh my mz aw na dt"><span id="1b1e" class="nb kn ht lh b fv nc nd l ne nf">contract Telephony {</span><span id="e3d1" class="nb kn ht lh b fv ng nd l ne nf">Telephone public phone = Telephone(YOUR_INSTANCE_ADDR_HERE);<br/>    //TODO...<br/>}</span></pre><p id="1b29" class="pw-post-body-paragraph jj jk ht jl b jm jn iu jo jp jq ix jr js jt ju jv jw jx jy jz ka kb kc kd ke hm dt translated">3.在<code class="eh le lf lg lh b">Telephony</code>中创建一个<code class="eh le lf lg lh b">changeOwner</code>函数，调用<code class="eh le lf lg lh b">Telephone</code>中的<code class="eh le lf lg lh b">changeOwner</code>函数，即玩电话游戏。</p><pre class="lu lv lw lx fq mx lh my mz aw na dt"><span id="a8b4" class="nb kn ht lh b fv nc nd l ne nf">function changeOwner(address _owner) public {<br/>    phone.changeOwner(_owner);<br/>}</span></pre><p id="9413" class="pw-post-body-paragraph jj jk ht jl b jm jn iu jo jp jq ix jr js jt ju jv jw jx jy jz ka kb kc kd ke hm dt translated">4.注意控制台中的<code class="eh le lf lg lh b">await contract.owner()</code>现在显示您的用户钱包是所有者！</p></div><div class="ab cl kf kg hb kh" role="separator"><span class="ki bw bk kj kk kl"/><span class="ki bw bk kj kk kl"/><span class="ki bw bk kj kk"/></div><div class="hm hn ho hp hq"><h1 id="c35c" class="km kn ht bd ko kp kq kr ks kt ku kv kw iz kx ja ky jc kz jd la jf lb jg lc ld dt translated">关键安全要点</h1><ul class=""><li id="dca1" class="mo mp ht jl b jm li jp lj js mq jw mr ka ms ke nh mu mv mw dt translated">使用<a class="ae ji" href="https://github.com/OpenZeppelin/openzeppelin-solidity/blob/master/contracts/math/SafeMath.sol" rel="noopener ugc nofollow" target="_blank"> SafeMath.sol </a>来处理简单的数学运算</li></ul><h1 id="fd2d" class="km kn ht bd ko kp mj kr ks kt mk kv kw iz ml ja ky jc mm jd la jf mn jg lc ld dt translated">借助Solidity Koans深入了解</h1><ul class=""><li id="fd7f" class="mo mp ht jl b jm li jp lj js mq jw mr ka ms ke nh mu mv mw dt translated">查看第二级<a class="ae ji" href="https://github.com/nczhu/soliditykoans" rel="noopener ugc nofollow" target="_blank"> Solidity Koans </a>(灵感来自Ruby Koans)用一些Zen TDD来实践这个概念！</li></ul><h1 id="e8d5" class="km kn ht bd ko kp mj kr ks kt mk kv kw iz ml ja ky jc mm jd la jf mn jg lc ld dt translated">更多级别</h1><div class="ni nj fm fo nk nl"><a rel="noopener follow" target="_blank" href="/@nicolezhu/ethernaut-lvl-4-walkthrough-how-to-abuse-tx-origin-msg-sender-ef37d6751c8"><div class="nm ab ej"><div class="nn ab no cl cj np"><h2 class="bd hu fv z el nq eo ep nr er et hs dt translated">Ethernaut Lvl 4电话演练:如何滥用tx.origin &amp; msg.sender</h2><div class="ns l"><h3 class="bd b fv z el nq eo ep nr er et ek translated">这是一个围绕齐柏林团队的智能合同安全难题的深入系列。我会给你直接的资源…</h3></div><div class="nt l"><p class="bd b gc z el nq eo ep nr er et ek translated">medium.com</p></div></div><div class="nu l"><div class="nv l nw nx ny nu nz mg nl"/></div></div></a></div><div class="ni nj fm fo nk nl"><a rel="noopener follow" target="_blank" href="/coinmonks/ethernaut-lvl-6-walkthrough-how-to-abuse-the-delicate-delegatecall-466b26c429e4"><div class="nm ab ej"><div class="nn ab no cl cj np"><h2 class="bd hu fv z el nq eo ep nr er et hs dt translated">Ethernaut Lvl 6委托演练:如何滥用微妙的委托调用</h2><div class="ns l"><h3 class="bd b fv z el nq eo ep nr er et ek translated">这是一个围绕齐柏林团队的智能合同安全难题的深入系列。我会给你直接的资源…</h3></div><div class="nt l"><p class="bd b gc z el nq eo ep nr er et ek translated">medium.com</p></div></div><div class="nu l"><div class="oa l nw nx ny nu nz mg nl"/></div></div></a></div><blockquote class="ob"><p id="a845" class="oc od ht bd oe of og oh oi oj ok ke ek translated"><a class="ae ji" href="https://coincodecap.com/?utm_source=coinmonks" rel="noopener ugc nofollow" target="_blank">在您的收件箱中直接获得最佳软件交易</a></p></blockquote><figure class="om on oo op oq ly fe ff paragraph-image"><a href="https://coincodecap.com/?utm_source=coinmonks"><div class="fe ff ol"><img src="../Images/7c0b3dfdcbfea594cc0ae7d4f9bf6fcb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1168/format:webp/0*OJ-qb5G6i863msBB.png"/></div></a></figure></div></div>    
</body>
</html>