<html>
<head>
<title>Payroll Smart Contract on Ethereum</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">以太坊上的智能工资合同</h1>
<blockquote>原文：<a href="https://medium.com/coinmonks/payroll-smart-contract-on-ethereum-ae536e49403d?source=collection_archive---------1-----------------------#2018-03-02">https://medium.com/coinmonks/payroll-smart-contract-on-ethereum-ae536e49403d?source=collection_archive---------1-----------------------#2018-03-02</a></blockquote><div><div class="ef hh hi hj hk hl"/><div class="hm hn ho hp hq"><div class=""/><figure class="fi fk ir is it iu fe ff paragraph-image"><div role="button" tabindex="0" class="iv iw di ix bf iy"><div class="fe ff iq"><img src="../Images/aec0ecff76e3a8f632bdb38f0730ef41.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*n9k7Diqh5TMnnEAC3FWqrw.jpeg"/></div></div></figure><p id="c738" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">在本帖中，我们将回顾使用<a class="ae jz" href="http://truffleframework.com/" rel="noopener ugc nofollow" target="_blank"> Truffle </a>和<a class="ae jz" href="https://github.com/OpenZeppelin/zeppelin-solidity" rel="noopener ugc nofollow" target="_blank"> Open Zeppelin </a>用<a class="ae jz" href="https://solidity.readthedocs.io/en/develop/" rel="noopener ugc nofollow" target="_blank"> Solidity </a>编写的工资智能合同。你可以在这里找到回购<a class="ae jz" href="https://github.com/NFhbar/payroll" rel="noopener ugc nofollow" target="_blank">。</a></p></div><div class="ab cl ka kb hb kc" role="separator"><span class="kd bw bk ke kf kg"/><span class="kd bw bk ke kf kg"/><span class="kd bw bk ke kf"/></div><div class="hm hn ho hp hq"><p id="2945" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">让我们确保您在全球范围内安装了Truffle:</p><pre class="kh ki kj kk fq kl km kn ko aw kp dt"><span id="d402" class="kq kr ht km b fv ks kt l ku kv">$ npm install -g truffle</span></pre><p id="484d" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">将我的<a class="ae jz" href="https://github.com/NFhbar/payroll" rel="noopener ugc nofollow" target="_blank"> repo </a>克隆到您的本地机器并安装:</p><pre class="kh ki kj kk fq kl km kn ko aw kp dt"><span id="1ea4" class="kq kr ht km b fv ks kt l ku kv">$ npm install</span></pre><p id="9a79" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">您现在可以使用Truffle develop来编译、迁移和运行测试:</p><pre class="kh ki kj kk fq kl km kn ko aw kp dt"><span id="b622" class="kq kr ht km b fv ks kt l ku kv">$ truffle develop<br/>truffle(develop)&gt; compile<br/>truffle(develop)&gt; migrate<br/>truffle(develop)&gt; test</span></pre><p id="b3bd" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">好了，说够了，让我们看一些代码。</p></div><div class="ab cl ka kb hb kc" role="separator"><span class="kd bw bk ke kf kg"/><span class="kd bw bk ke kf kg"/><span class="kd bw bk ke kf"/></div><div class="hm hn ho hp hq"><p id="8d36" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">该契约遵循类似于Zeppelin的<a class="ae jz" href="https://github.com/OpenZeppelin/zeppelin-solidity/blob/master/contracts/token/ERC20/ERC20.sol" rel="noopener ugc nofollow" target="_blank"> ERC20 </a>标准的接口方法，其中定义了接口契约。在我们的例子中，工资界面由下式给出:</p><figure class="kh ki kj kk fq iu"><div class="bz el l di"><div class="kw kx l"/></div></figure><p id="b53b" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">您可以看到，我们拥有管理员工和支付所需的所有功能。现在，我们来看看主合同:<code class="eh ky kz la km b"><a class="ae jz" href="https://github.com/NFhbar/payroll/blob/master/contracts/Payroll.sol" rel="noopener ugc nofollow" target="_blank">Payroll.sol</a></code>。</p></div><div class="ab cl ka kb hb kc" role="separator"><span class="kd bw bk ke kf kg"/><span class="kd bw bk ke kf kg"/><span class="kd bw bk ke kf"/></div><div class="hm hn ho hp hq"><p id="9f21" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated"><code class="eh ky kz la km b">Payroll.sol</code>有三个导入:</p><pre class="kh ki kj kk fq kl km kn ko aw kp dt"><span id="da12" class="kq kr ht km b fv ks kt l ku kv">import './InterfacePayroll.sol';<br/>import './EmployeeStorage.sol';<br/>import './EmployeeToken.sol';</span></pre><p id="00d7" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">允许设置存储变量:</p><pre class="kh ki kj kk fq kl km kn ko aw kp dt"><span id="8daf" class="kq kr ht km b fv ks kt l ku kv">/*<br/>*  Storage<br/>*/<br/>InterfaceEmployeeStorage public employeeStorage;<br/>EmployeeToken public employeeToken;</span></pre><p id="8efe" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated"><code class="eh ky kz la km b">EmployeeStorage.sol</code>定义了员工结构:</p><pre class="kh ki kj kk fq kl km kn ko aw kp dt"><span id="3ada" class="kq kr ht km b fv ks kt l ku kv">/*<br/>*  Storage<br/>*/<br/>struct Employee {<br/>     bool exists;<br/>     uint256 id;<br/>     address accountAddress;</span><span id="9e0d" class="kq kr ht km b fv lb kt l ku kv">     address tokenContractAddress;<br/>     uint256 latestPayday;<br/>     uint256 monthlySalary;<br/>}</span></pre><p id="3e99" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated"><code class="eh ky kz la km b">EmployeeToken.sol</code>是一个简单的ERC20标准合同:</p><figure class="kh ki kj kk fq iu"><div class="bz el l di"><div class="kw kx l"/></div></figure></div><div class="ab cl ka kb hb kc" role="separator"><span class="kd bw bk ke kf kg"/><span class="kd bw bk ke kf kg"/><span class="kd bw bk ke kf"/></div><div class="hm hn ho hp hq"><p id="ae0a" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated"><code class="eh ky kz la km b">Payroll.sol</code>的构造函数由下式给出:</p><pre class="kh ki kj kk fq kl km kn ko aw kp dt"><span id="2a45" class="kq kr ht km b fv ks kt l ku kv">/*<br/>* Public functions<br/>*/<br/>/// <a class="ae jz" href="http://twitter.com/dev" rel="noopener ugc nofollow" target="_blank">@dev</a> Contract constructor sets storage and token.<br/>function Payroll()<br/>    public<br/>{<br/>   setEmployeeStorage(new EmployeeStorage());<br/>   setEmployeeToken(new EmployeeToken());<br/>}</span></pre><p id="47a9" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">它只是设置员工存储和员工令牌。合同所有者现在可以通过<code class="eh ky kz la km b">InterfacePayroll.sol.</code>中定义的任何功能来管理员工。员工可以通过拨打以下电话请求在给定的支付期内获得报酬:</p><pre class="kh ki kj kk fq kl km kn ko aw kp dt"><span id="1db7" class="kq kr ht km b fv ks kt l ku kv">/// <a class="ae jz" href="http://twitter.com/dev" rel="noopener ugc nofollow" target="_blank">@dev</a> allows employee to get payed.<br/>/// <a class="ae jz" href="http://twitter.com/param" rel="noopener ugc nofollow" target="_blank">@param</a> _payPeriod of requested payment.<br/>function getPay (uint256 _payPeriod)<br/>      public<br/>      employeePayPeriodExists(_payPeriod)<br/>      enoughTokensLeft()<br/>{<br/>      uint256 employeeSalary =        employeeStorage.getMonthlySalary(msg.sender);<br/>      employeeToken.transfer(msg.sender, employeeSalary);</span><span id="b034" class="kq kr ht km b fv lb kt l ku kv">        uint256 newPayday = employeeStorage.getLatestPayday(msg.sender);<br/>        newPayday++;<br/>        employeeStorage.setlatestPayday(msg.sender, newPayday);<br/>        EmployeePayed(msg.sender, newPayday--);</span><span id="929d" class="kq kr ht km b fv lb kt l ku kv">}</span></pre><p id="fd12" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated"><code class="eh ky kz la km b">Payroll.sol</code>也有几个事件供dapp观看:</p><pre class="kh ki kj kk fq kl km kn ko aw kp dt"><span id="ddfb" class="kq kr ht km b fv ks kt l ku kv">/*<br/>*  Events<br/>*/<br/>event Deposit(address indexed sender, uint value);<br/>event NewEmployee(address indexed newEmployee);<br/>event EmployeeAddressChange(address indexed newAddress);</span><span id="7427" class="kq kr ht km b fv lb kt l ku kv">event EmployeePaydayChange(address indexed employeeAddress, uint indexed newPayday);</span><span id="1162" class="kq kr ht km b fv lb kt l ku kv">event EmployeeSalaryChange(address indexed employeeAddress, uint indexed newSalary);</span><span id="166f" class="kq kr ht km b fv lb kt l ku kv">event EmployeeRemoved(address indexed employeeAddress, uint indexed_id);</span><span id="6045" class="kq kr ht km b fv lb kt l ku kv">event EmployeePayed(address indexed employeeAddress, uint payPeriod);</span></pre></div><div class="ab cl ka kb hb kc" role="separator"><span class="kd bw bk ke kf kg"/><span class="kd bw bk ke kf kg"/><span class="kd bw bk ke kf"/></div><div class="hm hn ho hp hq"><p id="3267" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">现在工资支付期被设定为一个简单的<code class="eh ky kz la km b">uint</code>，但它可以很容易地被设定为一个由所有者指定的实际时间框架。</p></div><div class="ab cl ka kb hb kc" role="separator"><span class="kd bw bk ke kf kg"/><span class="kd bw bk ke kf kg"/><span class="kd bw bk ke kf"/></div><div class="hm hn ho hp hq"><p id="02fd" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">就是这样！如果你更愿意在重新制作这份合同，我为你准备了一个<a class="ae jz" href="https://gist.github.com/NFhbar/15a80e5785080e499099581799d3b5f2" rel="noopener ugc nofollow" target="_blank">要点</a>供你使用。</p><blockquote class="lc"><p id="f32a" class="ld le ht bd lf lg lh li lj lk ll jy ek translated"><a class="ae jz" href="https://coincodecap.com/?utm_source=coinmonks" rel="noopener ugc nofollow" target="_blank">直接在您的收件箱中获得最佳软件交易</a></p></blockquote><figure class="ln lo lp lq lr iu fe ff paragraph-image"><a href="https://coincodecap.com/?utm_source=coinmonks"><div class="fe ff lm"><img src="../Images/7c0b3dfdcbfea594cc0ae7d4f9bf6fcb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1168/format:webp/0*OJ-qb5G6i863msBB.png"/></div></a></figure><p id="6a51" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">非常感谢你阅读这篇文章！如果你觉得这篇文章很有用<strong class="jd hu">，请点击这篇文章，并确保关注我的更多常规内容</strong>，也请查看我的<a class="ae jz" href="https://github.com/NFhbar" rel="noopener ugc nofollow" target="_blank"> Github </a>，因为我定期发布示例代码和项目。如果你有任何问题，欢迎在下面回复或者给我发邮件。</p><p id="4dc8" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">编码快乐！</p><figure class="kh ki kj kk fq iu fe ff paragraph-image"><a href="http://bit.ly/2G71Sp7"><div class="fe ff ls"><img src="../Images/449450761cd76f44f9ae574333f9e9af.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fKX2mtg7p1lOs7JmosPLsA.png"/></div></a></figure></div></div>    
</body>
</html>