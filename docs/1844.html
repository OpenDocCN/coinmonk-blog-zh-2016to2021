<html>
<head>
<title>Mechanics of privacy coins: Part I</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">保密硬币的机制:第一部分</h1>
<blockquote>原文：<a href="https://medium.com/coinmonks/private-transactions-part-i-9c4d64086135?source=collection_archive---------1-----------------------#2018-12-01">https://medium.com/coinmonks/private-transactions-part-i-9c4d64086135?source=collection_archive---------1-----------------------#2018-12-01</a></blockquote><div><div class="ef hh hi hj hk hl"/><div class="hm hn ho hp hq"><div class=""/><figure class="fi fk ir is it iu fe ff paragraph-image"><div role="button" tabindex="0" class="iv iw di ix bf iy"><div class="fe ff iq"><img src="../Images/20c7a96362d5d37b74bf8b4e76913cc5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7qx0mxCUJ6k_Lt6OcD_YSw.jpeg"/></div></div><figcaption class="jb jc fg fe ff jd je bd b be z ek">Quentin Massys. The Tax Collectors, ca. 1500</figcaption></figure><p id="1c27" class="pw-post-body-paragraph jf jg ht jh b ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc hm dt translated">这是深入研究隐私协议<strong class="jh hu"> <em class="kd"> CoinJoin </em> </strong>(比特币)、Monero、ZCash和Mimblewimble内部的系列文章的第一部分。目标是给出一个概念性的和更详细的解释，说明存储在公共分类账中的资金转移是如何匿名的，并且可以被任何感兴趣的一方验证——这是两个看似矛盾的要求。这部分探讨coin join——一种仅使用普通比特币交易的隐私协议。</p><h2 id="8349" class="ke kf ht bd kg kh ki kj kk kl km kn ko jq kp kq kr ju ks kt ku jy kv kw kx ky dt translated">TL；速度三角形定位法(dead reckoning)</h2><ul class=""><li id="c038" class="kz la ht jh b ji lb jm lc jq ld ju le jy lf kc lg lh li lj dt translated">比特币交易转让消费UTXO的权利</li><li id="396e" class="kz la ht jh b ji lk jm ll jq lm ju ln jy lo kc lg lh li lj dt translated">取消几个比特币地址的匿名可能会导致严重的隐私泄露，因为大多数交易都可以追溯</li><li id="bd96" class="kz la ht jh b ji lk jm ll jq lm ju ln jy lo kc lg lh li lj dt translated">至少15%的比特币区块链可以去匿名化</li><li id="cbf7" class="kz la ht jh b ji lk jm ll jq lm ju ln jy lo kc lg lh li lj dt translated">比特币交易可能在单笔交易中花费属于不同地址的UTXOs</li><li id="871e" class="kz la ht jh b ji lk jm ll jq lm ju ln jy lo kc lg lh li lj dt translated">CoinJoin将来自不同方的UTXOs输出到单个事务中，从而使接收者无法区分</li><li id="eda2" class="kz la ht jh b ji lk jm ll jq lm ju ln jy lo kc lg lh li lj dt translated">CoinJoin的一个主要缺点是它需要另一方参与混合事务(尽管各方可能保持完全匿名)</li></ul><h2 id="4489" class="ke kf ht bd kg kh ki kj kk kl km kn ko jq kp kq kr ju ks kt ku jy kv kw kx ky dt translated">回归基础:UTXOs</h2><p id="c731" class="pw-post-body-paragraph jf jg ht jh b ji lb jk jl jm lc jo jp jq lp js jt ju lq jw jx jy lr ka kb kc hm dt translated">首先，让我们更详细地考察一下基于比特币UTXO的交易的内部工作原理。我们描述的交易结构和签名方案是特定于比特币的(更准确地说，是SegWit之前的版本)。尽管如此，基于UTXO的会计将是我们的基本模型，因为它被我们在适当的时候将要考虑的所有硬币所采用。</p><p id="2c27" class="pw-post-body-paragraph jf jg ht jh b ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc hm dt translated">比特币分类账不是保留一份有余额的账户列表(像以太坊一样)，而是包含每个UTXO(代表未用交易输出)的地址信息。当Alice将1BTC转移给Bob时，她创建了一个事务，将她拥有的一些UTXOs(比如说<code class="eh ls lt lu lv b">utxo_1, utxo_2</code>)作为输入，并将两个新的UTXOs <code class="eh ls lt lu lv b">utxo_Bob</code>和<code class="eh ls lt lu lv b">utxo_Alice</code>作为输出。<code class="eh ls lt lu lv b">utxo_Bob</code>的值是1BTC，<code class="eh ls lt lu lv b">utxo_Alice</code>是“变化”。</p><p id="c3f1" class="pw-post-body-paragraph jf jg ht jh b ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc hm dt translated">当挖掘节点接收到Alice的事务时，它执行简单的验证检查</p><ol class=""><li id="5580" class="kz la ht jh b ji jj jm jn jq lw ju lx jy ly kc lz lh li lj dt translated"><code class="eh ls lt lu lv b">utxo_1</code>和<code class="eh ls lt lu lv b">utxo_2</code>从未作为输入包含在另一项交易中(即它们确实是未使用的交易输出),并且</li><li id="8df9" class="kz la ht jh b ji lk jm ll jq lm ju ln jy lo kc lz lh li lj dt translated">交易输入的总价值等于交易输出的总价值。</li></ol><p id="2dad" class="pw-post-body-paragraph jf jg ht jh b ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc hm dt translated">更棘手的部分是确保只有Bob有权在未来花费<code class="eh ls lt lu lv b">utxo_Bob</code>。这是通过一个聪明的机制来实现的，该机制在创建时解锁附加到每个UTXO的脚本。脚本是一个小程序，用一种特殊的非图灵完整语言编写，指令数量很少。为了将UTXO作为输入之一包含在新事务中，必须包含一些数据，以便UTXO解锁脚本返回<code class="eh ls lt lu lv b">True</code>(免责声明:这是前<a class="ae ma" href="https://en.bitcoin.it/wiki/Segregated_Witness" rel="noopener ugc nofollow" target="_blank"> SegWit </a>状态。现代比特币交易使用的方案略有不同。不过，老派的非SegWit交易仍然有效。</p><p id="1e97" class="pw-post-body-paragraph jf jg ht jh b ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc hm dt translated">比如<code class="eh ls lt lu lv b">utxo_Bob</code>的解锁脚本(爱丽丝附)可以是这样的</p><pre class="mb mc md me fq mf lv mg mh aw mi dt"><span id="82f1" class="ke kf ht lv b fv mj mk l ml mm">&lt;Bob's public key&gt; OP_CHECKSIG</span></pre><p id="1f0a" class="pw-post-body-paragraph jf jg ht jh b ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc hm dt translated">注意，它只包含公共信息，所以Alice可以将这个脚本附加到<code class="eh ls lt lu lv b">utxo_Bob</code>上，因为她知道Bob的钱包地址(粗略地说，就是他的公钥模散列)。反过来，在交易被包括在块中并且该块被接受之后，鲍勃可以验证他确实将获得花费<code class="eh ls lt lu lv b">utxo_Bob</code>的权利。省略了许多技术细节，例如这里的<a class="ae ma" href="https://www.oreilly.com/library/view/mastering-bitcoin/9781491902639/ch05.html" rel="noopener ugc nofollow" target="_blank">这里的</a>和<a class="ae ma" href="https://en.bitcoin.it/wiki/OP_CHECKSIG" rel="noopener ugc nofollow" target="_blank">这里的</a>，上面的脚本粗略地指出，为了将<code class="eh ls lt lu lv b">utxo_Bob</code>用作输入，应该提供一些附加数据<code class="eh ls lt lu lv b">sig</code>,以便</p><pre class="mb mc md me fq mf lv mg mh aw mi dt"><span id="c946" class="ke kf ht lv b fv mj mk l ml mm">return secp256k1.verify(sig, &lt;Bob’s public key&gt;, sha256(sha256(tx)))</span></pre><p id="a04a" class="pw-post-body-paragraph jf jg ht jh b ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc hm dt translated">评估为<code class="eh ls lt lu lv b">True</code>。这里的重点是，只有知道Bob私钥的人才能产生<code class="eh ls lt lu lv b">sig</code>。由于<code class="eh ls lt lu lv b">sha256(sha256(tx))</code>足够随机且ECDSA足够安全，因此这一事实几乎得到了保证。例如，黑客可能试图通过梳理Bob之前签署的交易来找到<code class="eh ls lt lu lv b">sig</code>。这种天真的尝试注定要失败——所有形式<code class="eh ls lt lu lv b">sha256(sha256(tx))</code>的散列都是不同的。另一方面，Bob使用他的私钥和任何字节序列生成<code class="eh ls lt lu lv b">sig</code>，尤其是<code class="eh ls lt lu lv b">sha256(sha256(tx))</code>，这是一项常规任务。所以没有任何与爱丽丝的直接交流(甚至不在线！)鲍勃可以安全地接受比特币到他公开宣布的地址，并放心，除了他没有人可以花这些资金。</p><h2 id="360b" class="ke kf ht bd kg kh ki kj kk kl km kn ko jq kp kq kr ju ks kt ku jy kv kw kx ky dt translated">比特币是安全的，但不是匿名的</h2><p id="0c55" class="pw-post-body-paragraph jf jg ht jh b ji lb jk jl jm lc jo jp jq lp js jt ju lq jw jx jy lr ka kb kc hm dt translated">让我们首先描述区块链取证可能利用的潜在匿名泄露(按严重程度递减):</p><ol class=""><li id="e0b3" class="kz la ht jh b ji jj jm jn jq lw ju lx jy ly kc lz lh li lj dt translated">将地址A与控制私钥的真实个人/实体进行匹配。</li><li id="ca7c" class="kz la ht jh b ji lk jm ll jq lm ju ln jy lo kc lz lh li lj dt translated">提供证据，证明A的所有人已经转移了一些钱给B(可能通过一些中介交易)。</li><li id="2b75" class="kz la ht jh b ji lk jm ll jq lm ju ln jy lo kc lz lh li lj dt translated">提供证据证明地址A的所有者拥有X数量的密码(可能在多个帐户上)。</li></ol><p id="03eb" class="pw-post-body-paragraph jf jg ht jh b ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc hm dt translated">中本聪争辩说，既然任何人都可以匿名创建比特币地址，1)就不是严重的隐私威胁。回到比特币主要通过采矿获得的时代，这可能是真的。如今，由于无处不在的KYC/反洗钱要求强加于主要的加密交易所，许多比特币地址可以与真实身份相关联。更糟糕的是，仅仅通过分析公开可用的Bitcointalk和Twitter个人资料，<a class="ae ma" href="https://arxiv.org/pdf/1801.07501.pdf" rel="noopener ugc nofollow" target="_blank">有可能</a>到<a class="ae ma" href="https://arxiv.org/pdf/1502.01657.pdf" rel="noopener ugc nofollow" target="_blank">利用数据挖掘技术提取</a>大量关于地址所有者的信息。与2)相结合，可以跟踪多得惊人的交易。对于那些一直认为暗网意味着执法部门对交易对手一无所知的人来说，这是个坏消息(抱歉，<a class="ae ma" href="https://www.wired.com/2015/04/silk-road-1/" rel="noopener ugc nofollow" target="_blank">恐惧海盗罗伯茨</a>)。Bitfury <a class="ae ma" href="https://nulltx.com/bitfury-group-unveils-technique-to-analyze-bitcoin-transactions/" rel="noopener ugc nofollow" target="_blank">声称</a>已经能够取消不少于16%的所有比特币地址的匿名化。</p><p id="c4ea" class="pw-post-body-paragraph jf jg ht jh b ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc hm dt translated">请注意，虽然1)至少需要一些数据scarping，但关于2)、3)、4)的信息是完全开放的(对于通常的比特币交易)并且可以免费获得<a class="ae ma" href="https://www.blockchain.com/explorer" rel="noopener ugc nofollow" target="_blank"/>(并且它经常被宣传为无许可DLT的一个功能)。</p><h2 id="390b" class="ke kf ht bd kg kh ki kj kk kl km kn ko jq kp kq kr ju ks kt ku jy kv kw kx ky dt translated">CoinJoin</h2><p id="a269" class="pw-post-body-paragraph jf jg ht jh b ji lb jk jl jm lc jo jp jq lp js jt ju lq jw jx jy lr ka kb kc hm dt translated">至少对于比特币交易来说，1)很大程度上取决于2)。事实上，通过简单地将资金从账户A转移到其他账户B(或多个账户，这是推荐的)，如果很难证明这样的资金转移已经完成，应该是相当安全的。但是，如果所有比特币交易都被设计成公开存储，那么怎么可能隐藏资金转移呢？</p><p id="be9d" class="pw-post-body-paragraph jf jg ht jh b ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc hm dt translated">早在2013年，格雷格·麦克斯韦(Greg Maxwell)就提出了基础概念(CoinJoin)。比特币有很多种商业隐私解决方案，<a class="ae ma" href="https://bitcoinmagazine.com/articles/bitcoin-privacycoin-tech-making-bitcoin-more-private/" rel="noopener ugc nofollow" target="_blank">这里的</a>是一个全面且最新的评论。他们中的大多数人都以某种形式实现了CoinJoin的想法，主要是因为它不需要在比特币协议层面做出任何改变。</p><p id="7067" class="pw-post-body-paragraph jf jg ht jh b ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc hm dt translated">所以想法如下。回想一下，比特币交易是一个UTXOs列表:输入(花费)和输出。发送者为每个输入UXO提供一个解锁脚本，并在输出中锁定每个UXO。在下列情况下，交易有效</p><p id="dc2e" class="pw-post-body-paragraph jf jg ht jh b ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc hm dt translated">[规则1]所有输入均已成功解锁</p><p id="d084" class="pw-post-body-paragraph jf jg ht jh b ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc hm dt translated">[规则2]输入的总和等于输出的总和。</p><p id="1a4f" class="pw-post-body-paragraph jf jg ht jh b ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc hm dt translated">这两个规则并不是说所有的输入都不应该来自同一个地址，输出也不应该以某种方式连接。因此，在一次交易中花费来自不相关地址的不同UTXOs是完全合法的。现在假设爱丽丝想给鲍勃发1BTC，同时卡罗尔想给戴夫发1BTC。爱丽丝和卡罗尔都想掩盖他们的行踪，所以不用追踪交易</p><pre class="mb mc md me fq mf lv mg mh aw mi dt"><span id="5388" class="ke kf ht lv b fv mj mk l ml mm">tx1: A-&gt;B; tx2: C-&gt;D</span></pre><p id="bda7" class="pw-post-body-paragraph jf jg ht jh b ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc hm dt translated">它们可以形成单个交易</p><pre class="mb mc md me fq mf lv mg mh aw mi dt"><span id="bffb" class="ke kf ht lv b fv mj mk l ml mm">tx: {<br/>  inputs: [<br/>    {1BTC; &lt;Alice' Sig&gt;},<br/>    {1BTC; &lt;Carol's Sig&gt;}, <br/>  ],<br/>  outputs: [<br/>    {1BTC; &lt;Bob's PK&gt;},<br/>    {1BTC; &lt;Dave's PK&gt;}<br/>  ] <br/>}</span></pre><p id="9e51" class="pw-post-body-paragraph jf jg ht jh b ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc hm dt translated">现在很难说爱丽丝是和鲍勃交易还是和戴夫交易；卡罗尔也是。上面的伪代码远非有效的比特币交易，但传达了CoinJoin的窍门。</p><figure class="mb mc md me fq iu fe ff paragraph-image"><div role="button" tabindex="0" class="iv iw di ix bf iy"><div class="fe ff mn"><img src="../Images/d159886cd7b94d6cfa1962631c0c9742.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5uICL2T5PLZ4arzHXlA6sQ.png"/></div></div><figcaption class="jb jc fg fe ff jd je bd b be z ek">Greg Maxwell’s original explanation. <a class="ae ma" href="https://bitcointalk.org/index.php?topic=279249.0" rel="noopener ugc nofollow" target="_blank">Source</a></figcaption></figure><h2 id="fb38" class="ke kf ht bd kg kh ki kj kk kl km kn ko jq kp kq kr ju ks kt ku jy kv kw kx ky dt translated">CoinJoin的缺点</h2><p id="e304" class="pw-post-body-paragraph jf jg ht jh b ji lb jk jl jm lc jo jp jq lp js jt ju lq jw jx jy lr ka kb kc hm dt translated">CoinJoin的主要缺点是必须找到愿意参与“混合”交易的匹配交易对手。如果没有足够多的参与地址，聚类分析仍可能揭示(或至少显著缩小)收件人集合。</p><p id="768a" class="pw-post-body-paragraph jf jg ht jh b ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc hm dt translated">其次，爱丽丝寄给鲍勃一轮比特币的情况很少。小额支付可能需要与不同的交易对手进行多次混合交易，从而增加了整体复杂性，同时减少了匿名性集合(即无法与Alice交易区分的交易集合)。</p><p id="0c17" class="pw-post-body-paragraph jf jg ht jh b ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc hm dt translated">Monero、ZCash和MimbleWimble解决了这两个问题，尽管方式有很大不同。将细节留给本系列的下一部分，这里有一个小难题:</p><ul class=""><li id="0cec" class="kz la ht jh b ji jj jm jn jq lw ju lx jy ly kc lg lh li lj dt translated"><strong class="jh hu"> Monero和ZCash </strong>(采用非常不同的方法)使用了一个非常不直观的事实，即粗略地说，在既不知道<em class="kd"/>公钥<em class="kd">也不知道</em>正在转移的<em class="kd"> </em>金额的情况下，验证【规则1】和【规则2】都是可能的。Monero本质上是使用加密类固醇的CoinJoin(具有盲态UTXO值和诱饵交易方)。ZCash使用zk证明，从而生成一个更大的匿名集。</li><li id="ce39" class="kz la ht jh b ji lk jm ll jq lm ju ln jy lo kc lg lh li lj dt translated">MimbleWimble 是一种完全不同的东西，尽管底层的加密原语与Monero的相似。MimbleWimble甚至没有通常意义上的私钥和地址。相反，使用具体UTXO的权利是以一种复杂但效率惊人的方式(存储和处理方式)实现的。</li></ul></div><div class="ab cl mo mp hb mq" role="separator"><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt"/></div><div class="hm hn ho hp hq"><p id="4427" class="pw-post-body-paragraph jf jg ht jh b ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc hm dt translated">声明:所有不准确的地方都是我的(但我努力不说谎)。</p><p id="458e" class="pw-post-body-paragraph jf jg ht jh b ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc hm dt translated"><em class="kd">如果你喜欢这篇文章，请在Twitter上关注我:@dizhel，我偶尔会在那里发布加密信息。</em></p><figure class="mb mc md me fq iu fe ff paragraph-image"><a href="http://bit.ly/2G71Sp7"><div class="fe ff mv"><img src="../Images/449450761cd76f44f9ae574333f9e9af.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fKX2mtg7p1lOs7JmosPLsA.png"/></div></a><figcaption class="jb jc fg fe ff jd je bd b be z ek"><a class="ae ma" href="http://bit.ly/2G71Sp7" rel="noopener ugc nofollow" target="_blank"><strong class="bd mw">Click to read today’s top story</strong></a></figcaption></figure></div></div>    
</body>
</html>