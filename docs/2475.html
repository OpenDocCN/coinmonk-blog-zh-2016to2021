<html>
<head>
<title>ZK Rollup &amp; Optimistic Rollup (En)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">ZK累计和乐观累计(En)</h1>
<blockquote>原文：<a href="https://medium.com/coinmonks/zk-rollup-optimistic-rollup-70c01295231b?source=collection_archive---------0-----------------------#2019-10-24">https://medium.com/coinmonks/zk-rollup-optimistic-rollup-70c01295231b?source=collection_archive---------0-----------------------#2019-10-24</a></blockquote><div><div class="ef hh hi hj hk hl"/><div class="hm hn ho hp hq"><div class=""/><blockquote class="iq ir is"><p id="08ec" class="it iu iv iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hm dt translated">ZK汇总并不是一个新的想法。它是由巴里·怀特哈特在大约一年前提出的。同时，Vitalik在EF研究论坛有一篇比较完整的文章。该实现由Matter Labs和Iden3开发。在深入研究了zk-SNARKs之后，我直到最近才有时间看zk汇总。除了ZK汇总，让我们来看看由约翰·阿德勒首先介绍的<a class="ae js" href="https://ethresear.ch/t/minimal-viable-merged-consensus/5617" rel="noopener ugc nofollow" target="_blank">乐观汇总。</a></p></blockquote></div><div class="ab cl jt ju hb jv" role="separator"><span class="jw bw bk jx jy jz"/><span class="jw bw bk jx jy jz"/><span class="jw bw bk jx jy"/></div><div class="hm hn ho hp hq"><p id="416a" class="pw-post-body-paragraph it iu ht iw b ix iy iz ja jb jc jd je ka jg jh ji kb jk jl jm kc jo jp jq jr hm dt translated">当ZK汇总被提出时，它被定义为第2层解决方案。今年年初，它以“等离子伊格尼丝”的名字出版。那是因为等离子非常火，去年已经有了很大的进步，也被定义为第二层解决方案。基于这些原因，开发人员将等离子体命名为。但是这项技术与等离子的精神完全不同。遭到社区抗议后，后来又恢复了Rollup这个名字(开发者的说法)，所以搜索‘等离子伊格尼丝’什么也找不到。最近，Rollup被重新命名为半第2层解决方案，这是一个有点第2层，但不是第2层… XD</p><p id="70a8" class="pw-post-body-paragraph it iu ht iw b ix iy iz ja jb jc jd je ka jg jh ji kb jk jl jm kc jo jp jq jr hm dt translated">ZK汇总的简要说明是第2层解决方案，其中数据放置在链上。在你理解ZK卷之前，让我解释一下原来第二层的问题是什么。以等离子为例，等离子只是把等离子块的hash放在以太坊主链上。这意味着离线处理成百上千的事务，而链上只有几十个字节。这是等离子的理念，但也是设计中最困难的部分——数据可用性。</p><p id="a0b7" class="pw-post-body-paragraph it iu ht iw b ix iy iz ja jb jc jd je ka jg jh ji kb jk jl jm kc jo jp jq jr hm dt translated">如果有人想离开血浆链，他们需要一个机制来收回这笔钱。在血浆中，它被称为退出游戏(主链上没有数据所以侧链参与者需要提供证据)，这意味着每个人都必须保存数据量才能挑战。相比用主链的体验，只需要一个钱包，下载块数据是没有必要的。等离子的用户体验不够好。挑战期的另一个问题是，用户需要一直在线才能挑战某人，否则如果错过挑战期，他们可能会损失金钱(因为使用防欺诈证明，而不是有效性证明)。简而言之，由于数据的可获得性，它存在以下问题:</p><p id="96e3" class="pw-post-body-paragraph it iu ht iw b ix iy iz ja jb jc jd je ka jg jh ji kb jk jl jm kc jo jp jq jr hm dt translated">1.用户需要经常在线<br/> 2。需要下载一些数据</p><p id="24ec" class="pw-post-body-paragraph it iu ht iw b ix iy iz ja jb jc jd je ka jg jh ji kb jk jl jm kc jo jp jq jr hm dt translated">这会导致糟糕的用户体验。</p><blockquote class="kd"><p id="5441" class="ke kf ht bd kg kh ki kj kk kl km jr ek translated"><strong class="ak">如何在不占用大量空间的情况下将数据放在链上？</strong></p></blockquote><p id="4cda" class="pw-post-body-paragraph it iu ht iw b ix kn iz ja jb ko jd je ka kp jh ji kb kq jl jm kc kr jp jq jr hm dt translated">首先，我们来解释一下整体架构。像血浆，有一个智能合同存款。有中继帮助将交易发送到智能合约(在Plasma中称为操作员)。除了发送交易之外，中继者还需要生成SNARK证明，并将证明一起发送以供验证。</p><p id="c344" class="pw-post-body-paragraph it iu ht iw b ix iy iz ja jb jc jd je ka jg jh ji kb jk jl jm kc jo jp jq jr hm dt translated">智能合约部分可以想象成ERC20，每个参与者的余额都记录在合约中。区别在于，ECR20交易是标准交易，这意味着在每笔交易中只允许一次“转账”。在汇总中，数百次'转让'将被打包成一次交易。合同可以把这些‘转让’拆开来验证。</p><p id="f506" class="pw-post-body-paragraph it iu ht iw b ix iy iz ja jb jc jd je ka jg jh ji kb jk jl jm kc jo jp jq jr hm dt translated">在智能合约中，两个merkle树用于记录。一种是记录地址，所以只有一个索引可以表示一个地址(未注册索引的值为零)，在设计中，使用3字节长度的索引，一个地址的量从原来的20字节减少到3字节。另一棵树记录余额和随机数。</p><figure class="kt ku kv kw fq kx fe ff paragraph-image"><div class="fe ff ks"><img src="../Images/6f0da569a58a0cfe8851a93931a3cea0.png" data-original-src="https://miro.medium.com/v2/resize:fit:568/0*PxHGQAM1BPqbDLkL"/></div><figcaption class="la lb fg fe ff lc ld bd b be z ek">Merkle Tree of Addresses</figcaption></figure><p id="f9fa" class="pw-post-body-paragraph it iu ht iw b ix iy iz ja jb jc jd je ka jg jh ji kb jk jl jm kc jo jp jq jr hm dt translated">下面是数据格式(这是最初的提议，在当前的实现中要小一些)，</p><figure class="kt ku kv kw fq kx fe ff paragraph-image"><div role="button" tabindex="0" class="lf lg di lh bf li"><div class="fe ff le"><img src="../Images/f6cff8afcf62b1a6b4f29175238a1858.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*qj6a7Jhr0oe8kcOF"/></div></div></figure><p id="d997" class="pw-post-body-paragraph it iu ht iw b ix iy iz ja jb jc jd je ka jg jh ji kb jk jl jm kc jo jp jq jr hm dt translated">因为用索引作为地址的代表，所以只需要3个字节(2个⁴地址)，而<strong class="iw hu">值的基本单位</strong> 10^-6 ETH，这样就只有15个字节代表一个事务。只需要花费892 gas(虽然<strong class="iw hu">值</strong>是6个字节，但是文章中假设大部分事务只会使用4个字节，所以算法是13个字节* 68 + 2个字节* 4 = 892)，ETH传输花费21K gas，所以可以提高事务速度。</p><figure class="kt ku kv kw fq kx fe ff paragraph-image"><div role="button" tabindex="0" class="lf lg di lh bf li"><div class="fe ff lj"><img src="../Images/c412b69a38d7134178d45d8c6574c20c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*8NN1YOYlgr2NkPF-"/></div></div><figcaption class="la lb fg fe ff lc ld bd b be z ek"><a class="ae js" href="https://vitalik.ca/general/2019/08/28/hybrid_layer_2.html" rel="noopener ugc nofollow" target="_blank">https://vitalik.ca/general/2019/08/28/hybrid_layer_2.html</a></figcaption></figure><blockquote class="kd"><p id="6ecf" class="ke kf ht bd kg kh lk ll lm ln lo jr ek translated"><strong class="ak">为什么交易速度可以提高？还要了解</strong>的计算<strong class="ak">的交易速度</strong></p></blockquote><p id="682f" class="pw-post-body-paragraph it iu ht iw b ix kn iz ja jb ko jd je ka kp jh ji kb kq jl jm kc kr jp jq jr hm dt translated">今天一个街区的气限大概是8M左右，所以如果大家只是简单的在以太坊上做ETH传送的话，速度大概是</p><blockquote class="iq ir is"><p id="cd51" class="it iu iv iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hm dt translated">8M / 21K / 15 ~= 25 tps</p></blockquote><p id="6a50" class="pw-post-body-paragraph it iu ht iw b ix iy iz ja jb jc jd je ka jg jh ji kb jk jl jm kc jo jp jq jr hm dt translated">所以，目前的瓶颈是气限。如果降低交易费用或者提高一个区块的气限，可以获得更好的交易速度(但也造成了其他问题)。ZK汇总通过减少事务数据量，可以提高事务处理速度。让我们看看使用ZK汇总后，事务处理的速度有多快。</p><blockquote class="iq ir is"><p id="807f" class="it iu iv iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hm dt translated">(8M — 600K(防ZK-SNARK)—50K(开销))/ 892 / 15 ~= 550 tps</p></blockquote><p id="46da" class="pw-post-body-paragraph it iu ht iw b ix iy iz ja jb jc jd je ka jg jh ji kb jk jl jm kc jo jp jq jr hm dt translated">这个数字是Vitalik文章“在链上扩展到大约500 tx/sec”的标题。但实际上并不那么理想。在作者Barry的实现中，只有268 tps左右。因为一旦账户余额被更新，智能合同抛出一个事件，这是额外的汽油费用。然而，这样的设计对应用程序来说也更友好。</p><p id="0b14" class="pw-post-body-paragraph it iu ht iw b ix iy iz ja jb jc jd je ka jg jh ji kb jk jl jm kc jo jp jq jr hm dt translated">数据是链上的，由zk-SNARK验证，也就是说链上的数据是经过验证的。因此，在第2层中存在上述问题，需要挑战，需要下载数据等等。这也意味着没有必要相信继电器，因为他们不可能做任何坏事。在最坏的情况下，他们只是停止发送您的交易。</p><blockquote class="kd"><p id="9f1a" class="ke kf ht bd kg kh ki kj kk kl km jr ek translated"><strong class="ak">现实是我们所期待的……</strong></p></blockquote><p id="690e" class="pw-post-body-paragraph it iu ht iw b ix kn iz ja jb ko jd je ka kp jh ji kb kq jl jm kc kr jp jq jr hm dt translated">zk-SNARK就像是灵丹妙药，看似能解决一切，其实并没有那么完美。除了可信设置，最大的问题是需要很大的计算能力。在Barry提供的数据中，如果relayer的电脑是7G内存加20G硬盘交换，大概只能产生20 tx/sec。远低于预期的500 tps。所以这个方案最大的问题是如何解决计算问题。</p><blockquote class="kd"><p id="fa7c" class="ke kf ht bd kg kh ki kj kk kl km jr ek translated">并行计算！</p></blockquote><p id="581f" class="pw-post-body-paragraph it iu ht iw b ix kn iz ja jb ko jd je ka kp jh ji kb kq jl jm kc kr jp jq jr hm dt translated">物质实验室提出了多算子模型和并行计算。多运营商模式，如小区块链，使用DPOS(委托股权证明)，并随机挑选区块生产商。选定的块生产者可以收集交易，生成证明并提交。这种方法也避免了集中化。如果中继器受到恶意攻击，整个网络仍然可以运行。另一方面也为并行计算铺平了道路。零知识证明的生成非常耗时。因此，基于多中继模型，Matter Labs提出了一个两阶段的“提交-验证”方法。首先在链上提交块，然后用SNARK proof验证它们(如下所示)。通过一些数据优化，结果可以达到1600 tps。</p><figure class="kt ku kv kw fq kx fe ff paragraph-image"><div class="fe ff lp"><img src="../Images/2997ac3192cf96365fbf4cb037a10681.png" data-original-src="https://miro.medium.com/v2/resize:fit:1280/0*mFjdBbhX5BbUxAUe"/></div></figure><p id="3442" class="pw-post-body-paragraph it iu ht iw b ix iy iz ja jb jc jd je ka jg jh ji kb jk jl jm kc jo jp jq jr hm dt translated"><a class="ae js" rel="noopener" href="/matter-labs/introducing-matter-testnet-502fab5a6f17">https://medium . com/matter-labs/introducing-matter-testnet-502 fab 5a 6 f 17</a></p><blockquote class="kd"><p id="ef30" class="ke kf ht bd kg kh ki kj kk kl km jr ek translated">延迟时间…</p></blockquote><p id="30a4" class="pw-post-body-paragraph it iu ht iw b ix kn iz ja jb ko jd je ka kp jh ji kb kq jl jm kc kr jp jq jr hm dt translated">这听起来很棒，但由于您的交易分为两个阶段，从交付到验证需要几个街区。等待时间将比当前情况更长。当然，用户能接受多长的延迟目前还不得而知。这是一种权衡，节省了交易费用，提高了交易速度，但也增加了承诺延迟。这一切在解决方案上线之前还是知道的。</p><p id="8126" class="pw-post-body-paragraph it iu ht iw b ix iy iz ja jb jc jd je ka jg jh ji kb jk jl jm kc jo jp jq jr hm dt translated">今年早些时候，维塔利克在台北谈到了一个先进版本的ZK汇总-ZK ZK汇总。更多细节参见<a class="ae js" rel="noopener" href="/@trenton.v/transcript-scalable-blockchains-as-data-layers-vitalik-buterin-11aa18b37e07">这篇文章</a>。</p><h1 id="c3b3" class="lq lr ht bd ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn dt translated">血浆和乐观汇总</h1><p id="74bc" class="pw-post-body-paragraph it iu ht iw b ix mo iz ja jb mp jd je ka mq jh ji kb mr jl jm kc ms jp jq jr hm dt translated">乐观汇总的想法来自约翰在英孚研究论坛上的帖子。在这里，我只介绍一些简单的区别。</p><p id="bea5" class="pw-post-body-paragraph it iu ht iw b ix iy iz ja jb jc jd je ka jg jh ji kb jk jl jm kc jo jp jq jr hm dt translated">这个概念也是将数据放在链上，但不使用zk-SNARK进行验证，以实现通用应用。 中的<strong class="iw hu"> <em class="iv">改为用户签名(65字节)，因为我们需要知道谁在没有SNARK的情况下签署了交易。数据量变大，可想而知需要耗费更多的汽油。这意味着交易速度将低于ZK汇总。另一部分是因为不使用zk-SNARK进行验证，所以需要一个验证游戏来保证数据验证。这里就不赘述了。如果我有时间，我会写更多关于等离子/乐观向上的细节。</em></strong></p><p id="4dc3" class="pw-post-body-paragraph it iu ht iw b ix iy iz ja jb jc jd je ka jg jh ji kb jk jl jm kc jo jp jq jr hm dt translated">据估计，交易速度约为100 tps。如果签名方法更改为BLS，则可以增加到450 tps。有了EIP2028，gas会下降，预计交易速度会达到400/2000 tps。</p></div><div class="ab cl jt ju hb jv" role="separator"><span class="jw bw bk jx jy jz"/><span class="jw bw bk jx jy jz"/><span class="jw bw bk jx jy"/></div><div class="hm hn ho hp hq"><p id="afa7" class="pw-post-body-paragraph it iu ht iw b ix iy iz ja jb jc jd je ka jg jh ji kb jk jl jm kc jo jp jq jr hm dt translated"><em class="iv">感谢艾德勒</em><a class="ae js" href="https://twitter.com/jadler0" rel="noopener ugc nofollow" target="_blank"><em class="iv"/></a><em class="iv">的正确性。</em></p><p id="8ce9" class="pw-post-body-paragraph it iu ht iw b ix iy iz ja jb jc jd je ka jg jh ji kb jk jl jm kc jo jp jq jr hm dt translated">参考资料:<br/> <a class="ae js" href="https://ethresear.ch/t/on-chain-scaling-to-potentially-500-tx-sec-through-mass-tx-validation/3477" rel="noopener ugc nofollow" target="_blank">通过批量发送验证，链上扩展至潜在约500 tx/秒</a> <br/> <a class="ae js" rel="noopener" href="/matter-labs/introducing-matter-testnet-502fab5a6f17">引入物质测试网</a> <br/> <a class="ae js" rel="noopener" href="/plasma-group/ethereum-smart-contracts-in-l2-optimistic-rollup-2c1cef2ec537">乐观汇总</a> <br/> <a class="ae js" href="https://ethresear.ch/t/minimal-viable-merged-consensus/5617" rel="noopener ugc nofollow" target="_blank">最小可行合并共识</a></p><figure class="kt ku kv kw fq kx fe ff paragraph-image"><a href="https://coincodecap.com"><div class="fe ff lj"><img src="../Images/673b3528e0b341cca62769c9baa632cd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bcTJUjFtXf1QtlWzlS04XQ.jpeg"/></div></a></figure><blockquote class="kd"><p id="8bc2" class="ke kf ht bd kg kh lk ll lm ln lo jr ek translated"><a class="ae js" href="https://coincodecap.com/?utm_source=coinmonks" rel="noopener ugc nofollow" target="_blank">直接在您的收件箱中获得最佳软件交易</a></p></blockquote><figure class="mu mv mw mx my kx fe ff paragraph-image"><a href="https://coincodecap.com/?utm_source=coinmonks"><div class="fe ff mt"><img src="../Images/7c0b3dfdcbfea594cc0ae7d4f9bf6fcb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1168/format:webp/0*OJ-qb5G6i863msBB.png"/></div></a></figure></div></div>    
</body>
</html>