<html>
<head>
<title>Return values in solidity contracts</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">可靠性合同中的返回值</h1>
<blockquote>原文：<a href="https://medium.com/coinmonks/return-values-in-solidity-contracts-2a034b31d553?source=collection_archive---------1-----------------------#2018-04-11">https://medium.com/coinmonks/return-values-in-solidity-contracts-2a034b31d553?source=collection_archive---------1-----------------------#2018-04-11</a></blockquote><div><div class="ef hh hi hj hk hl"/><div class="hm hn ho hp hq"><figure class="hs ht fm fo hu hv fe ff paragraph-image"><div class="fe ff hr"><img src="../Images/dbb7e66f6d0ebe043cadac34051e0355.png" data-original-src="https://miro.medium.com/v2/resize:fit:540/format:webp/1*Hj0aiq3v8W5c6NvyzIBMvw.png"/></div></figure><div class=""/><div class=""><h2 id="5258" class="pw-subtitle-paragraph ix hz ia bd b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo ek translated">如果唯一的其他选择是恢复，没有必要返回一个布尔值</h2></div><p id="3f47" class="pw-post-body-paragraph jp jq ia jr b js jt jb ju jv jw je jx jy jz ka kb kc kd ke kf kg kh ki kj kk hm dt translated">我在各种渠道看到过这样的评论:对于一个返回错误输入的函数来说，在成功时返回一个布尔值<code class="eh kl km kn ko b">true</code>是一个很好的实践。</p><pre class="kp kq kr ks fq kt ko ku kv aw kw dt"><span id="159f" class="kx ky ia ko b fv kz la l lb lc">function doSomething(uint someData) public returns (bool) {<br/>   require(someCondition);<br/>   ....doSomethingHere;<br/>   return true;<br/>}</span></pre><p id="ad1b" class="pw-post-body-paragraph jp jq ia jr b js jt jb ju jv jw je jx jy jz ka kb kc kd ke kf kg kh ki kj kk hm dt translated">这种观点从根本上说是有缺陷的，因为返回值绝对是<strong class="jr ib"> <em class="ld">无用</em> </strong>。</p><blockquote class="le"><p id="5b72" class="lf lg ia bd lh li lj lk ll lm ln kk ek translated"><a class="ae lo" href="https://coincodecap.com" rel="noopener ugc nofollow" target="_blank">发现并回顾最佳区块链软件</a></p></blockquote><p id="a320" class="pw-post-body-paragraph jp jq ia jr b js lp jb ju jv lq je jx jy lr ka kb kc ls ke kf kg lt ki kj kk hm dt translated">可以通过多种方式调用合同的函数</p><ol class=""><li id="2013" class="lu lv ia jr b js jt jv jw jy lw kc lx kg ly kk lz ma mb mc dt translated">作为交易的一部分从外部拥有的地址</li><li id="449d" class="lu lv ia jr b js md jv me jy mf kc mg kg mh kk lz ma mb mc dt translated">使用命名调用从同一个或另一个协定中</li><li id="1756" class="lu lv ia jr b js md jv me jy mf kc mg kg mh kk lz ma mb mc dt translated">使用未命名调用从同一个或另一个合同</li></ol><p id="e518" class="pw-post-body-paragraph jp jq ia jr b js jt jb ju jv jw je jx jy jz ka kb kc kd ke kf kg kh ki kj kk hm dt translated">我可能用错了#2和#3的名字，所以我会给出例子</p><p id="41d3" class="pw-post-body-paragraph jp jq ia jr b js jt jb ju jv jw je jx jy jz ka kb kc kd ke kf kg kh ki kj kk hm dt translated">让我们看看下面的合同，它可以在rinkeby网络上找到，网址为“<a class="ae lo" href="https://rinkeby.etherscan.io/address/0x7ad782e914b3523cb2690c3b92594c12f06d279d#code" rel="noopener ugc nofollow" target="_blank">0x7ad 782 e 914 b 3523 CB 2690 C3 b 92594 c 12 f 06d 279d</a></p><pre class="kp kq kr ks fq kt ko ku kv aw kw dt"><span id="0f84" class="kx ky ia ko b fv kz la l lb lc">contract a {<br/>    function testReturn(bool die) public  {<br/>        require(!die);<br/>    }<br/>}</span></pre><h1 id="7902" class="mi ky ia bd mj mk ml mm mn mo mp mq mr jg ms jh mt jj mu jk mv jm mw jn mx my dt translated">从外部拥有的地址(EOA)打电话</h1><p id="dfda" class="pw-post-body-paragraph jp jq ia jr b js mz jb ju jv na je jx jy nb ka kb kc nc ke kf kg nd ki kj kk hm dt translated">这将包括启动我的密码或我的钱包，</p><ul class=""><li id="b114" class="lu lv ia jr b js jt jv jw jy lw kc lx kg ly kk ne ma mb mc dt translated">选择合同页面，</li><li id="4862" class="lu lv ia jr b js md jv me jy mf kc mg kg mh kk ne ma mb mc dt translated">插入以下ABI</li></ul><pre class="kp kq kr ks fq kt ko ku kv aw kw dt"><span id="894f" class="kx ky ia ko b fv kz la l lb lc">[{"constant":false,"inputs":[{"name":"die","type":"bool"}],"name":"testReturn","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"}]</span></pre><p id="8de5" class="pw-post-body-paragraph jp jq ia jr b js jt jb ju jv jw je jx jy jz ka kb kc kd ke kf kg kh ki kj kk hm dt translated">这给了你这个屏幕</p><figure class="kp kq kr ks fq hv fe ff paragraph-image"><div role="button" tabindex="0" class="ng nh di ni bf nj"><div class="fe ff nf"><img src="../Images/5d7b81cffc41610041daaf90dcc1a9df.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Ghj1tCAtK-WIZUGh0dlthA.png"/></div></div></figure><ul class=""><li id="fa85" class="lu lv ia jr b js jt jv jw jy lw kc lx kg ly kk ne ma mb mc dt translated">并使用true或false调用testReturn函数</li></ul><figure class="kp kq kr ks fq hv fe ff paragraph-image"><div class="fe ff nk"><img src="../Images/53046d872dfcc668af186b003c4ac72d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1192/format:webp/1*HIJCPrgNrFgoI1A5BzNbvg.png"/></div></figure><p id="41cc" class="pw-post-body-paragraph jp jq ia jr b js jt jb ju jv jw je jx jy jz ka kb kc kd ke kf kg kh ki kj kk hm dt translated">务必记住从Rinkeby网络使用rinkeby测试乙醚进行此操作(<em class="ld">可从水龙头. rinkeby.io </em>获得)</p><p id="7cc9" class="pw-post-body-paragraph jp jq ia jr b js jt jb ju jv jw je jx jy jz ka kb kc kd ke kf kg kh ki kj kk hm dt translated">运行该功能后，您可以在etherscan中检查日志。</p><ul class=""><li id="3ce1" class="lu lv ia jr b js jt jv jw jy lw kc lx kg ly kk ne ma mb mc dt translated">用die = `true '调用它，事务恢复(myCrypto / MEW将试图阻止您这样做)</li><li id="d393" class="lu lv ia jr b js md jv me jy mf kc mg kg mh kk ne ma mb mc dt translated">用die = `false '调用它，事务成功</li></ul><p id="8dcc" class="pw-post-body-paragraph jp jq ia jr b js jt jb ju jv jw je jx jy jz ka kb kc kd ke kf kg kh ki kj kk hm dt translated">在这两种情况下，你只看到成功或失败。添加一个布尔返回值不会获得更多信息，因为来自EOA的事务无法返回一个即使通过检查区块链也能读取的值。</p><h1 id="3c03" class="mi ky ia bd mj mk ml mm mn mo mp mq mr jg ms jh mt jj mu jk mv jm mw jn mx my dt translated">从协定中调用命名函数</h1><p id="ceca" class="pw-post-body-paragraph jp jq ia jr b js mz jb ju jv na je jx jy nb ka kb kc nc ke kf kg nd ki kj kk hm dt translated">一个契约可以很容易地调用另一个契约</p><pre class="kp kq kr ks fq kt ko ku kv aw kw dt"><span id="69f0" class="kx ky ia ko b fv kz la l lb lc">contract test {<br/>    a public ab = a(<a class="ae lo" href="https://rinkeby.etherscan.io/address/0x7ad782e914b3523cb2690c3b92594c12f06d279d#code" rel="noopener ugc nofollow" target="_blank">0x7aD782E914B3523Cb2690C3B92594c12F06D279D</a>);</span><span id="758e" class="kx ky ia ko b fv nl la l lb lc">    function testIt(bool die) {<br/>        ab.testReturn(die);<br/>    }<br/>}</span></pre><p id="a657" class="pw-post-body-paragraph jp jq ia jr b js jt jb ju jv jw je jx jy jz ka kb kc kd ke kf kg kh ki kj kk hm dt translated">事实是，你从下面的例子中什么也得不到</p><pre class="kp kq kr ks fq kt ko ku kv aw kw dt"><span id="2c1d" class="kx ky ia ko b fv kz la l lb lc">contract b {<br/>    function testReturn(bool die) public returns (bool) {<br/>        require(!die);<br/>        return true;<br/>    }<br/>}</span><span id="39d8" class="kx ky ia ko b fv nl la l lb lc">contract test {<br/>    b public ab = a(<a class="ae lo" href="https://rinkeby.etherscan.io/address/0x7ad782e914b3523cb2690c3b92594c12f06d279d#code" rel="noopener ugc nofollow" target="_blank">0x7aD782E914B3523Cb2690C3B92594c12F06D279D</a>);</span><span id="4a06" class="kx ky ia ko b fv nl la l lb lc">    function testIt(bool die) {<br/>        if (ab.testReturn(die)) {<br/>            log0("OK");<br/>        } else {<br/>            log0("BAD");<br/>        }<br/>    }</span><span id="8966" class="kx ky ia ko b fv nl la l lb lc">}</span></pre><p id="b1e8" class="pw-post-body-paragraph jp jq ia jr b js jt jb ju jv jw je jx jy jz ka kb kc kd ke kf kg kh ki kj kk hm dt translated">虽然您可以测试返回结果，但它永远不会返回false。如果<code class="eh kl km kn ko b">ab.testReturn</code>恢复，调用事务也恢复，因此“BAD”将永远不会被记录。</p><h1 id="91a8" class="mi ky ia bd mj mk ml mm mn mo mp mq mr jg ms jh mt jj mu jk mv jm mw jn mx my dt translated">从协定中调用未命名的函数</h1><p id="6b00" class="pw-post-body-paragraph jp jq ia jr b js mz jb ju jv na je jx jy nb ka kb kc nc ke kf kg nd ki kj kk hm dt translated">也可以像这样通过从另一个契约发送一个原始事务来调用一个公共函数</p><pre class="kp kq kr ks fq kt ko ku kv aw kw dt"><span id="9161" class="kx ky ia ko b fv kz la l lb lc">contract test {<br/>    address public ab = <a class="ae lo" href="https://rinkeby.etherscan.io/address/0x7ad782e914b3523cb2690c3b92594c12f06d279d#code" rel="noopener ugc nofollow" target="_blank">0x7aD782E914B3523Cb2690C3B92594c12F06D279D</a>;<br/>    <br/>    function testReturn(bytes data) public {<br/>        if (ab.call.value(0)(msg.data)) {<br/>            log0("OK");<br/>        } else {<br/>            log0("notOK");<br/>        }<br/>    }<br/>}</span></pre><p id="2889" class="pw-post-body-paragraph jp jq ia jr b js jt jb ju jv jw je jx jy jz ka kb kc kd ke kf kg kh ki kj kk hm dt translated">在这种情况下，您需要传入指示调用所需的字节，这是通过接受函数签名的keccak256的前4个字节，后跟包含0(假)或1(真)的32个字节来完成的。</p><p id="6472" class="pw-post-body-paragraph jp jq ia jr b js jt jb ju jv jw je jx jy jz ka kb kc kd ke kf kg kh ki kj kk hm dt translated">你可以在林克比网上的`<a class="ae lo" href="https://rinkeby.etherscan.io/address/0x5178224d088a43260db46e46eb2c26e60fd1a3cd#code" rel="noopener ugc nofollow" target="_blank">0x 5178224d 088 a 43260 db 46 e 46 EB 2 c 26 e 60 FD 1 a3 CD</a>看到这样的合同。</p><p id="c660" class="pw-post-body-paragraph jp jq ia jr b js jt jb ju jv jw je jx jy jz ka kb kc kd ke kf kg kh ki kj kk hm dt translated">在这种情况下，即使调用恢复，您也会得到一个返回值，因为返回值只是告诉您子事务是否成功。</p><p id="93c1" class="pw-post-body-paragraph jp jq ia jr b js jt jb ju jv jw je jx jy jz ka kb kc kd ke kf kg kh ki kj kk hm dt translated">不幸的是，Etherscan在查看Rinkeby时有一些问题——它无法获得两个事务的日志，但是如果您检查日志，您会看到后续的事务记录正常，而失败的事务记录不正常，如下面的日志所示</p><pre class="kp kq kr ks fq kt ko ku kv aw kw dt"><span id="5f8d" class="kx ky ia ko b fv kz la l lb lc">0x892236e1eca9a65235dcb213c7548030332def523cc0c620e423d5f64208739e OK</span><span id="b905" class="kx ky ia ko b fv nl la l lb lc">0xa51bccf52e207c7a3ce54759894bf3cebcc23aaa3315f2c6ae238fb12d6bc8fc<br/>notOK</span></pre><h1 id="00f8" class="mi ky ia bd mj mk ml mm mn mo mp mq mr jg ms jh mt jj mu jk mv jm mw jn mx my dt translated">结论</h1><p id="e213" class="pw-post-body-paragraph jp jq ia jr b js mz jb ju jv na je jx jy nb ka kb kc nc ke kf kg nd ki kj kk hm dt translated">如果一个函数只有两个选项——运行或恢复——让它返回一个状态标志来指示它是否成功是没有意义的。</p><p id="2b13" class="pw-post-body-paragraph jp jq ia jr b js jt jb ju jv jw je jx jy jz ka kb kc kd ke kf kg kh ki kj kk hm dt translated">如果您对它进行未命名的调用，返回值指示调用成功或失败，而不管它返回的任何变量，如果您通过name* 调用它，它将在失败时恢复调用约定，因此布尔回复不传递任何额外信息。</p><h1 id="32b7" class="mi ky ia bd mj mk ml mm mn mo mp mq mr jg ms jh mt jj mu jk mv jm mw jn mx my dt translated">事后思考</h1><p id="71f3" class="pw-post-body-paragraph jp jq ia jr b js mz jb ju jv na je jx jy nb ka kb kc nc ke kf kg nd ki kj kk hm dt translated">很有可能我忽略了一些东西——但是到目前为止，还没有人能指出我推理中的一个缺陷。如果你能找到这样一种情况，当被调用的契约恢复或返回true时，返回一个布尔值真的很有用，请在评论中告诉我。</p><blockquote class="le"><p id="355a" class="lf lg ia bd lh li lj lk ll lm ln kk ek translated">加入Coinmonks <a class="ae lo" href="https://t.me/coincodecap" rel="noopener ugc nofollow" target="_blank">电报频道</a>和<a class="ae lo" href="https://www.youtube.com/c/coinmonks/videos" rel="noopener ugc nofollow" target="_blank"> Youtube频道</a>获取每日<a class="ae lo" href="http://coincodecap.com/" rel="noopener ugc nofollow" target="_blank">加密新闻</a></p></blockquote><h2 id="15d6" class="kx ky ia bd mj nm nn no mn np nq nr mr jy ns nt mt kc nu nv mv kg nw nx mx ny dt translated">另外，阅读</h2><ul class=""><li id="20fb" class="lu lv ia jr b js mz jv na jy nz kc oa kg ob kk ne ma mb mc dt translated"><a class="ae lo" rel="noopener" href="/coinmonks/top-10-crypto-copy-trading-platforms-for-beginners-d0c37c7d698c">复制交易</a> | <a class="ae lo" rel="noopener" href="/coinmonks/crypto-tax-software-ed4b4810e338">加密税务软件</a></li><li id="723e" class="lu lv ia jr b js md jv me jy mf kc mg kg mh kk ne ma mb mc dt translated"><a class="ae lo" href="https://coincodecap.com/grid-trading" rel="noopener ugc nofollow" target="_blank">网格交易</a> | <a class="ae lo" rel="noopener" href="/coinmonks/the-best-cryptocurrency-hardware-wallets-of-2020-e28b1c124069">加密硬件钱包</a></li><li id="874f" class="lu lv ia jr b js md jv me jy mf kc mg kg mh kk ne ma mb mc dt translated"><a class="ae lo" href="http://Top 4 Telegram Channels for Crypto Traders" rel="noopener ugc nofollow" target="_blank">密码电报信号</a> | <a class="ae lo" rel="noopener" href="/coinmonks/crypto-trading-bot-c2ffce8acb2a">密码交易机器人</a></li><li id="f33b" class="lu lv ia jr b js md jv me jy mf kc mg kg mh kk ne ma mb mc dt translated"><a class="ae lo" rel="noopener" href="/coinmonks/crypto-exchange-dd2f9d6f3769">最佳加密交易所</a> | <a class="ae lo" rel="noopener" href="/coinmonks/bitcoin-exchange-in-india-7f1fe79715c9">最佳加密交易所</a></li><li id="47a8" class="lu lv ia jr b js md jv me jy mf kc mg kg mh kk ne ma mb mc dt translated">开发人员的最佳加密API</li><li id="b359" class="lu lv ia jr b js md jv me jy mf kc mg kg mh kk ne ma mb mc dt translated">最佳<a class="ae lo" rel="noopener" href="/coinmonks/top-5-crypto-lending-platforms-in-2020-that-you-need-to-know-a1b675cec3fa">密码借贷平台</a></li><li id="3c98" class="lu lv ia jr b js md jv me jy mf kc mg kg mh kk ne ma mb mc dt translated"><a class="ae lo" rel="noopener" href="/coinmonks/free-crypto-signals-48b25e61a8da">免费加密信号</a> | <a class="ae lo" rel="noopener" href="/coinmonks/crypto-trading-bot-c2ffce8acb2a">加密交易机器人</a></li><li id="9487" class="lu lv ia jr b js md jv me jy mf kc mg kg mh kk ne ma mb mc dt translated"><a class="ae lo" rel="noopener" href="/coinmonks/leveraged-token-3f5257808b22">杠杆代币的终极指南</a></li></ul></div></div>    
</body>
</html>