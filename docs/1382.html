<html>
<head>
<title>Ethernaut Lvl 7 Force Walkthrough — How to selfdestruct and create an Ether blackhole</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">以太吕7部队演练-如何自毁和创造一个以太黑洞</h1>
<blockquote>原文：<a href="https://medium.com/coinmonks/ethernaut-lvl-7-walkthrough-how-to-selfdestruct-and-create-an-ether-blackhole-eb5bb72d2c57?source=collection_archive---------1-----------------------#2018-08-23">https://medium.com/coinmonks/ethernaut-lvl-7-walkthrough-how-to-selfdestruct-and-create-an-ether-blackhole-eb5bb72d2c57?source=collection_archive---------1-----------------------#2018-08-23</a></blockquote><div><div class="ef hh hi hj hk hl"/><div class="hm hn ho hp hq"><div class=""/><div class=""><h2 id="e203" class="pw-subtitle-paragraph iq hs ht bd b ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ek translated">这是一个围绕<a class="ae ji" href="https://openzeppelin.org/" rel="noopener ugc nofollow" target="_blank"> Zeppelin </a>团队的<a class="ae ji" href="https://ethernaut.zeppelin.solutions/" rel="noopener ugc nofollow" target="_blank">智能合约安全拼图</a>的<a class="ae ji" rel="noopener" href="/@nicolezhu">深度系列</a>。我们学习关键的可靠性概念，以便100%靠自己解决难题。</h2></div><p id="47d0" class="pw-post-body-paragraph jj jk ht jl b jm jn iu jo jp jq ix jr js jt ju jv jw jx jy jz ka kb kc kd ke hm dt translated">这个级别需要你发送醚到一个空的合同。</p></div><div class="ab cl kf kg hb kh" role="separator"><span class="ki bw bk kj kk kl"/><span class="ki bw bk kj kk kl"/><span class="ki bw bk kj kk"/></div><div class="hm hn ho hp hq"><h1 id="e27d" class="km kn ht bd ko kp kq kr ks kt ku kv kw iz kx ja ky jc kz jd la jf lb jg lc ld dt translated"><code class="eh le lf lg lh b">What is selfdestruct</code></h1><blockquote class="li"><p id="1266" class="lj lk ht bd ll lm ln lo lp lq lr ke ek translated">自毁是一个大的红色按钮，让你放弃你的智能合同，并把所有剩余的醚转移到另一个地址</p></blockquote><figure class="lt lu lv lw lx ly fe ff paragraph-image"><div class="fe ff ls"><img src="../Images/89f6ac35a29d88743be526012449cb35.png" data-original-src="https://miro.medium.com/v2/resize:fit:620/format:webp/0*HAmV6X1ab6x42WpT.jpg"/></div></figure><p id="814e" class="pw-post-body-paragraph jj jk ht jl b jm jn iu jo jp jq ix jr js jt ju jv jw jx jy jz ka kb kc kd ke hm dt translated"><code class="eh le lf lg lh b">selfdestruct(address)</code>是低级操作码调用，<em class="mb">别名为前者，</em>名不副实，<code class="eh le lf lg lh b">suicide()</code>函数。与其他交易不同，<code class="eh le lf lg lh b">selfdestruct()</code> <strong class="jl hu">消耗负气</strong>——所以把它想成一个清理无效合同的垃圾收集激励。</p><h2 id="f163" class="mc kn ht bd ko md me mf ks mg mh mi kw js mj mk ky jw ml mm la ka mn mo lc mp dt translated">何时自毁</h2><p id="94d5" class="pw-post-body-paragraph jj jk ht jl b jm mq iu jo jp mr ix jr js ms ju jv jw mt jy jz ka mu kc kd ke hm dt translated">合同所有者通常包括在以下情况下调用的<code class="eh le lf lg lh b">selfdestruct</code>期权:</p><ul class=""><li id="05da" class="mv mw ht jl b jm jn jp jq js mx jw my ka mz ke na nb nc nd dt translated"><strong class="jl hu">弃用有缺陷的合同:</strong>当智能合同有缺陷或不希望的方面时，创建者可以销毁合同，并将剩余的以太网转发到备份地址。</li><li id="7174" class="mv mw ht jl b jm ne jp nf js ng jw nh ka ni ke na nb nc nd dt translated"><strong class="jl hu">清理过时的旧合同。这被视为释放以太坊区块链存储空间的最佳实践。</strong></li></ul><p id="ea4f" class="pw-post-body-paragraph jj jk ht jl b jm jn iu jo jp jq ix jr js jt ju jv jw jx jy jz ka kb kc kd ke hm dt translated">如何实现<code class="eh le lf lg lh b">selfdestruct</code>的一个例子是:</p><pre class="nj nk nl nm fq nn lh no np aw nq dt"><span id="73c0" class="mc kn ht lh b fv nr ns l nt nu"><strong class="lh hu">function</strong> close() <strong class="lh hu">public</strong> onlyOwner {<br/>    //recommended: emit an event as well<br/>    selfdestruct(owner);<br/>}</span></pre><figure class="nj nk nl nm fq ly fe ff paragraph-image"><div role="button" tabindex="0" class="nw nx di ny bf nz"><div class="fe ff nv"><img src="../Images/1def4dd76ec2365d0dce3beba88557db.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*Ki8KzkY-lCMheCNy.jpg"/></div></div><figcaption class="oa ob fg fe ff oc od bd b be z ek">The selfdestruct option makes everything ok when it might not be</figcaption></figure></div><div class="ab cl kf kg hb kh" role="separator"><span class="ki bw bk kj kk kl"/><span class="ki bw bk kj kk kl"/><span class="ki bw bk kj kk"/></div><div class="hm hn ho hp hq"><h2 id="95b4" class="mc kn ht bd ko md me mf ks mg mh mi kw js mj mk ky jw ml mm la ka mn mo lc mp dt translated">有趣的事实:<code class="eh le lf lg lh b">selfdestruct</code>目前是您的合同接收乙醚的三种方法之一</h2><p id="2fe9" class="pw-post-body-paragraph jj jk ht jl b jm mq iu jo jp mr ix jr js ms ju jv jw mt jy jz ka mu kc kd ke hm dt translated"><strong class="jl hu">方法1 —通过应付款函数:</strong>之前，我们讨论过<a class="ae ji" href="https://hackernoon.com/ethernaut-lvl-1-walkthrough-how-to-abuse-the-fallback-function-118057b68b56" rel="noopener ugc nofollow" target="_blank">回退函数</a>是为了<em class="mb">有意</em>允许您的合同从其他合同和外部钱包接收乙醚。但是如果不存在这样的<code class="eh le lf lg lh b">payable</code>函数，您的合同仍然有另外两种间接接收资金的方式:</p><p id="fa49" class="pw-post-body-paragraph jj jk ht jl b jm jn iu jo jp jq ix jr js jt ju jv jw jx jy jz ka kb kc kd ke hm dt translated"><strong class="jl hu">方法2 —获得采矿奖励:</strong>合同地址可以被指定为采矿区块奖励的接受者。</p><p id="dbeb" class="pw-post-body-paragraph jj jk ht jl b jm jn iu jo jp jq ix jr js jt ju jv jw jx jy jz ka kb kc kd ke hm dt translated"><strong class="jl hu">方法3 —来自已销毁的合同:</strong>如前所述，<code class="eh le lf lg lh b">selfdestruct</code>允许您指定一个备份地址来接收您正在销毁的合同中剩余的醚。</p></div><div class="ab cl kf kg hb kh" role="separator"><span class="ki bw bk kj kk kl"/><span class="ki bw bk kj kk kl"/><span class="ki bw bk kj kk"/></div><div class="hm hn ho hp hq"><h2 id="7f50" class="mc kn ht bd ko md me mf ks mg mh mi kw js mj mk ky jw ml mm la ka mn mo lc mp dt translated"><strong class="ak">警告:小心转发自毁醚到任何智能合约。</strong></h2><p id="9d3c" class="pw-post-body-paragraph jj jk ht jl b jm mq iu jo jp mr ix jr js ms ju jv jw mt jy jz ka mu kc kd ke hm dt translated">在这一级，我们将乙醚转移到一个没有提取或转移能力的空合同。这意味着我们实际上是将测试醚倒入黑洞——永远不会再被使用。千万不要在main-net上这样做，因为它会永远占用普遍有限的以太网数量(和你自己的钱)!</p></div><div class="ab cl kf kg hb kh" role="separator"><span class="ki bw bk kj kk kl"/><span class="ki bw bk kj kk kl"/><span class="ki bw bk kj kk"/></div><div class="hm hn ho hp hq"><h1 id="2426" class="km kn ht bd ko kp kq kr ks kt ku kv kw iz kx ja ky jc kz jd la jf lb jg lc ld dt translated">详细演练</h1><figure class="nj nk nl nm fq ly fe ff paragraph-image"><div role="button" tabindex="0" class="nw nx di ny bf nz"><div class="fe ff oe"><img src="../Images/c295feeba261676e18031c7e810c468a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QiNr8MixJYVX2EJU_AX5LA.png"/></div></div></figure><ol class=""><li id="fdec" class="mv mw ht jl b jm jn jp jq js mx jw my ka mz ke of nb nc nd dt translated">注意<strong class="jl hu"> Force.sol </strong>是一个空合同，不能通过直接转账收款。这使我们剩下方法2和3。让我们签订一份自由合同，把剩余的部分转给Force.sol！</li><li id="ac73" class="mv mw ht jl b jm ne jp nf js ng jw nh ka ni ke of nb nc nd dt translated">在<a class="ae ji" href="http://remix.ethereum.org/" rel="noopener ugc nofollow" target="_blank"> Remix IDE </a>中或者使用<a class="ae ji" href="http://truffleframework.com/" rel="noopener ugc nofollow" target="_blank"> truffle </a>框架，发起如下自毁契约:</li></ol><pre class="nj nk nl nm fq nn lh no np aw nq dt"><span id="8ed0" class="mc kn ht lh b fv nr ns l nt nu">contract SelfDestructingContract {<br/>}</span></pre><p id="3015" class="pw-post-body-paragraph jj jk ht jl b jm jn iu jo jp jq ix jr js jt ju jv jw jx jy jz ka kb kc kd ke hm dt translated">3.允许此合同接收乙醚，以便它可以有一个平衡:</p><pre class="nj nk nl nm fq nn lh no np aw nq dt"><span id="5111" class="mc kn ht lh b fv nr ns l nt nu">function collect() public payable returns(uint) {<br/>    return address(this).balance;<br/>}</span></pre><p id="cdba" class="pw-post-body-paragraph jj jk ht jl b jm jn iu jo jp jq ix jr js jt ju jv jw jx jy jz ka kb kc kd ke hm dt translated">在这一点上，转发你的合同一些醚！</p><p id="acb7" class="pw-post-body-paragraph jj jk ht jl b jm jn iu jo jp jq ix jr js jt ju jv jw jx jy jz ka kb kc kd ke hm dt translated">4.允许此契约自毁并将所有剩余的醚转发给Force.sol。</p><pre class="nj nk nl nm fq nn lh no np aw nq dt"><span id="9acd" class="mc kn ht lh b fv nr ns l nt nu">function selfDestroy() public {<br/>    address addr = //your Force.sol instance here<br/>    selfdestruct(addr);<br/>}</span></pre><p id="32bb" class="pw-post-body-paragraph jj jk ht jl b jm jn iu jo jp jq ix jr js jt ju jv jw jx jy jz ka kb kc kd ke hm dt translated">5.调用<code class="eh le lf lg lh b">selfDestroy()</code>。你的Force.sol实例现在已经成为所有以太的永久水槽！</p></div><div class="ab cl kf kg hb kh" role="separator"><span class="ki bw bk kj kk kl"/><span class="ki bw bk kj kk kl"/><span class="ki bw bk kj kk"/></div><div class="hm hn ho hp hq"><h1 id="c35c" class="km kn ht bd ko kp kq kr ks kt ku kv kw iz kx ja ky jc kz jd la jf lb jg lc ld dt translated">关键安全要点</h1><ul class=""><li id="68ed" class="mv mw ht jl b jm mq jp mr js og jw oh ka oi ke na nb nc nd dt translated"><strong class="jl hu">永远不要相信你自己的会计:</strong>即使作为合同的所有者，你也不能控制合同的余额。切勿将合同余额用作会计或授权检查。</li><li id="aaa2" class="mv mw ht jl b jm ne jp nf js ng jw nh ka ni ke na nb nc nd dt translated">即使你没有实现自毁()，也仍然有可能通过任何<a class="ae ji" rel="noopener" href="/coinmonks/ethernaut-lvl-6-walkthrough-how-to-abuse-the-delicate-delegatecall-466b26c429e4"> delegatecall </a>()漏洞实现。</li><li id="08d0" class="mv mw ht jl b jm ne jp nf js ng jw nh ka ni ke na nb nc nd dt translated">如果您实现了一个<code class="eh le lf lg lh b">selfdestruct</code>，I)验证<code class="eh le lf lg lh b">msg.sender = owner</code>和ii) <strong class="jl hu">发出一个事件</strong>，用于此契约的外部依赖和未来参考。</li></ul><h1 id="fd2d" class="km kn ht bd ko kp oj kr ks kt ok kv kw iz ol ja ky jc om jd la jf on jg lc ld dt translated">更多级别</h1><div class="oo op fm fo oq or"><a rel="noopener follow" target="_blank" href="/coinmonks/ethernaut-lvl-6-walkthrough-how-to-abuse-the-delicate-delegatecall-466b26c429e4"><div class="os ab ej"><div class="ot ab ou cl cj ov"><h2 class="bd hu fv z el ow eo ep ox er et hs dt translated">Ethernaut Lvl 6委托演练:如何滥用微妙的委托调用</h2><div class="oy l"><h3 class="bd b fv z el ow eo ep ox er et ek translated">这是一个围绕齐柏林团队的智能合同安全难题的深入系列。我会给你直接的资源…</h3></div><div class="oz l"><p class="bd b gc z el ow eo ep ox er et ek translated">medium.com</p></div></div><div class="pa l"><div class="pb l pc pd pe pa pf lz or"/></div></div></a></div><div class="oo op fm fo oq or"><a rel="noopener follow" target="_blank" href="/coinmonks/how-to-read-private-variables-in-contract-storage-with-truffle-ethernaut-lvl-8-walkthrough-b2382741da9f"><div class="os ab ej"><div class="ot ab ou cl cj ov"><h2 class="bd hu fv z el ow eo ep ox er et hs dt translated">Ethernaut Lvl 8 Vault演练—如何读取契约存储中的“私有”变量(使用…</h2><div class="oy l"><h3 class="bd b fv z el ow eo ep ox er et ek translated">这是一个围绕齐柏林团队的智能合同安全难题的深入系列。我们学习关键的可靠性概念…</h3></div><div class="oz l"><p class="bd b gc z el ow eo ep ox er et ek translated">medium.com</p></div></div><div class="pa l"><div class="pg l pc pd pe pa pf lz or"/></div></div></a></div><blockquote class="li"><p id="ab32" class="lj lk ht bd ll lm ph pi pj pk pl ke ek translated"><a class="ae ji" href="https://coincodecap.com/?utm_source=coinmonks" rel="noopener ugc nofollow" target="_blank">直接在您的收件箱中获得最佳软件交易</a></p></blockquote><figure class="lt lu lv lw lx ly fe ff paragraph-image"><a href="https://coincodecap.com/?utm_source=coinmonks"><div class="fe ff pm"><img src="../Images/7c0b3dfdcbfea594cc0ae7d4f9bf6fcb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1168/format:webp/0*OJ-qb5G6i863msBB.png"/></div></a></figure></div></div>    
</body>
</html>