<html>
<head>
<title>Do you even unit test Solidity code bro/sis?</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">ä½ ç”šè‡³å•å…ƒæµ‹è¯•å¯é æ€§ä»£ç bro/sisï¼Ÿ</h1>
<blockquote>åŸæ–‡ï¼š<a href="https://medium.com/coinmonks/do-you-even-unit-test-solidity-code-bro-sis-3ae0599873c0?source=collection_archive---------6-----------------------#2018-05-30">https://medium.com/coinmonks/do-you-even-unit-test-solidity-code-bro-sis-3ae0599873c0?source=collection_archive---------6-----------------------#2018-05-30</a></blockquote><div><div class="ef hh hi hj hk hl"/><div class="hm hn ho hp hq"><div class=""/><figure class="fi fk ir is it iu fe ff paragraph-image"><div class="fe ff iq"><img src="../Images/19828a16c658817f415e2d0c1d469a25.png" data-original-src="https://miro.medium.com/v2/resize:fit:1052/format:webp/0*-YSr2xmdJ0Wk0hYl.jpg"/></div><figcaption class="ix iy fg fe ff iz ja bd b be z ek"><a class="ae jb" href="https://memegenerator.net/instance/55088928/office-space-that-would-be-great-if-you-could-test-your-code-that-would-be-great" rel="noopener ugc nofollow" target="_blank">source</a></figcaption></figure><p id="4fa0" class="pw-post-body-paragraph jc jd ht je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hm dt translated">åœ¨è¿‡å»çš„å‡ å‘¨é‡Œï¼Œæˆ‘æœ‰æœºä¼šåœ¨ä¸€äº›é»‘å®¢é©¬æ‹‰æ¾ä¸Šç¼–å†™solidityä»£ç ã€‚æœ¬ç€é»‘å®¢é©¬æ‹‰æ¾çš„ç²¾ç¥ï¼Œæˆ‘ä»¬æ²¡æœ‰ç¼–å†™ä»»ä½•å•å…ƒæµ‹è¯•ã€‚åœ¨æˆ‘çœ‹æ¥ï¼Œè¿™äº›é»‘å®¢é©¬æ‹‰æ¾çš„ç›®çš„æ˜¯åœ¨æœ‰é™çš„æ—¶é—´å†…åˆ¶é€ å‡ºå¯è¡Œçš„äº§å“ã€‚ä½†æ˜¯ç°åœ¨æƒ³æƒ³ï¼Œå†™ä»»ä½•solidityä»£ç éƒ½æ˜¯ç›¸å½“å±é™©çš„ã€‚å¦‚æœä»¥å¤ªåŠä¸»ç½‘å‡ºç°é—®é¢˜ï¼Œä½ å°±å¯ä»¥ç©çœŸé’±äº†ï¼</p><p id="c508" class="pw-post-body-paragraph jc jd ht je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hm dt translated">ç¼–å†™å•å…ƒæµ‹è¯•é€šå¸¸æœ‰åŠ©äºç¡®ä¿ä¸€æ®µä»£ç æ»¡è¶³å…¶é¢„æœŸçš„åŠŸèƒ½ã€‚å•å…ƒæµ‹è¯•è¿˜å¯ä»¥ç¡®ä¿è¿™æ®µä»£ç ä¸ä¼šåšå®ƒä¸æƒ³åšçš„äº‹æƒ…ã€‚è¿™ä¸¤ä¸ªåŸå› åœ¨ç¼–å†™å¯é çš„æ™ºèƒ½åˆåŒæ—¶éå¸¸é‡è¦ã€‚ä½ å¿…é¡»ç¡®è®¤ä½ çš„ä»£ç åšäº†ä½ è®¤ä¸ºå®ƒåšçš„äº‹æƒ…ï¼Œå¹¶ä¸”ç¡®è®¤å®ƒæ²¡æœ‰åšå…¶ä»–å±é™©çš„äº‹æƒ…ã€‚ğŸ™ƒ</p><p id="e324" class="pw-post-body-paragraph jc jd ht je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hm dt translated">æ³¨æ„:solidityæµ‹è¯•ä¸åŒäºassert()ã€revert()ã€require()ï¼Œåè€…æ˜¯solidityæä¾›çš„é”™è¯¯å¤„ç†APIã€‚è¿™é‡Œ<em class="ka"/><a class="ae jb" href="https://media.consensys.net/when-to-use-revert-assert-and-require-in-solidity-61fb2c0e5a57" rel="noopener ugc nofollow" target="_blank"><em class="ka">å¯ä»¥å¾ˆå¥½çš„è§£é‡Šè¿™äº›æ˜¯åšä»€ä¹ˆç”¨çš„ã€‚</em></a></p><p id="aa04" class="pw-post-body-paragraph jc jd ht je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hm dt translated">å¯¹æˆ‘ä»¬æ¥è¯´å¹¸è¿çš„æ˜¯ï¼ŒTruffle frameworkçš„ä¼˜ç§€äººå‘˜æä¾›äº†ä¸€äº›éå¸¸å¥½çš„åŠ©æ‰‹ç±»ï¼Œå¦‚æœä½ æ˜¯ä¸€ä¸ªä»¥å‰äº†è§£è¿‡å…¶ä»–è¯­è¨€å’Œæ¡†æ¶çš„å¼€å‘äººå‘˜ï¼Œè¿™äº›ç±»ä¼šè®©solidityå•å…ƒæµ‹è¯•æ„Ÿè§‰åƒæ˜¯åº”è¯¥çš„ã€‚ä¸¤ä¸ªä¸»è¦ç±»åˆ«æ˜¯:</p><ol class=""><li id="0fc8" class="kb kc ht je b jf jg jj jk jn kd jr ke jv kf jz kg kh ki kj dt translated">truffle/Assert.sol ( <a class="ae jb" href="https://github.com/trufflesuite/truffle/blob/beta/lib/testing/Assert.sol" rel="noopener ugc nofollow" target="_blank">é“¾æ¥</a></li><li id="109d" class="kb kc ht je b jf kk jj kl jn km jr kn jv ko jz kg kh ki kj dt translated">å—èŒ/éƒ¨ç½²åœ°å€. sol</li></ol><p id="7369" class="pw-post-body-paragraph jc jd ht je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hm dt translated">Assert.solåŒ…å«æ‚¨å°†ç”¨äºå•å…ƒæµ‹è¯•çš„æ‰€æœ‰åŠ©æ‰‹æ–¹æ³•ã€‚ä¾‹å¦‚equal()å³å¦‚æœä¸¤ä¸ªå€¼ç›¸ç­‰ï¼ŒnotEqual()å³å¦‚æœä¸¤ä¸ªå€¼ä¸ç›¸ç­‰ï¼ŒisEmpty()ã€isNotEmpty()ã€isZero()ã€isNotZero()ã€isTrue()ã€isFalse()ã€isAbove()ã€isAtLeast()ã€isBelow()ã€isAtMost()ç­‰ã€‚æ‰€æœ‰åŠ©æ‰‹æ–¹æ³•çš„å®Œæ•´åˆ—è¡¨å¯ä»¥åœ¨<a class="ae jb" href="https://github.com/trufflesuite/truffle/blob/beta/lib/testing/Assert.sol" rel="noopener ugc nofollow" target="_blank">è¿™é‡Œ</a>æ‰¾åˆ°ã€‚</p><p id="11a2" class="pw-post-body-paragraph jc jd ht je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hm dt translated">å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªè¿™æ ·çš„åˆåŒâ€¦</p><pre class="kp kq kr ks fq kt ku kv kw aw kx dt"><span id="bbc8" class="ky kz ht ku b fv la lb l lc ld">pragma solidity ^0.4.2;</span><span id="2119" class="ky kz ht ku b fv le lb l lc ld">contract SimpleStorage {</span><span id="bc85" class="ky kz ht ku b fv le lb l lc ld">uint storedData;</span><span id="9b97" class="ky kz ht ku b fv le lb l lc ld">function set(uint x) public {</span><span id="c4ba" class="ky kz ht ku b fv le lb l lc ld">  storedData = x;</span><span id="a552" class="ky kz ht ku b fv le lb l lc ld">}</span><span id="f0a3" class="ky kz ht ku b fv le lb l lc ld">function get() public view returns (uint) {</span><span id="0302" class="ky kz ht ku b fv le lb l lc ld">  return storedData;</span><span id="0bba" class="ky kz ht ku b fv le lb l lc ld">}</span><span id="ea89" class="ky kz ht ku b fv le lb l lc ld">}</span></pre><p id="5b9b" class="pw-post-body-paragraph jc jd ht je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hm dt translated">ä¸Šé¢çš„å¥‘çº¦æœ‰ä¸¤ä¸ªå…¬å…±å‡½æ•°ã€‚æˆ‘ä»¬å¯èƒ½ä¼šå†³å®šå°†è¿™ä¸¤ä¸ªä»£ç å—è§†ä¸ºä¸¤ä¸ªç‹¬ç«‹çš„åŠŸèƒ½æˆ–å½¼æ­¤çš„è¡¥å……ã€‚æ‰€ä»¥æˆ‘ä»¬å¯èƒ½ä¼šå†³å®šå¯¹å®ƒä»¬éƒ½ä½¿ç”¨ä¸€ä¸ªå•å…ƒæµ‹è¯•ã€‚</p><p id="3832" class="pw-post-body-paragraph jc jd ht je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hm dt translated">æœ‰ä¸¤ç§æ–¹æ³•å¯ä»¥æµ‹è¯•è¿™ä¸ªæ™ºèƒ½åˆçº¦ã€‚ä½¿ç”¨truffle frameworkï¼Œä½ å¿…é¡»åœ¨solidityä¸­ç¼–å†™solidityæµ‹è¯•æˆ–è€…Javascript mochaæµ‹è¯•ã€‚</p><p id="481b" class="pw-post-body-paragraph jc jd ht je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hm dt translated">åœ¨solidityä¸­ç¼–å†™æµ‹è¯•çœ‹èµ·æ¥ä¼šåƒè¿™æ ·ã€‚</p><pre class="kp kq kr ks fq kt ku kv kw aw kx dt"><span id="ef13" class="ky kz ht ku b fv la lb l lc ld">pragma solidity ^0.4.2;</span><span id="e467" class="ky kz ht ku b fv le lb l lc ld">import "truffle/Assert.sol";</span><span id="0e31" class="ky kz ht ku b fv le lb l lc ld">import "truffle/DeployedAddresses.sol";</span><span id="2a3c" class="ky kz ht ku b fv le lb l lc ld">import "../contracts/SimpleStorage.sol";</span><span id="38cb" class="ky kz ht ku b fv le lb l lc ld">contract TestSimpleStorage {</span><span id="63ff" class="ky kz ht ku b fv le lb l lc ld">function testItStoresAValue() public {<br/>SimpleStorage simpleStorage = SimpleStorage(DeployedAddresses.SimpleStorage());<br/>simpleStorage.set(89);<br/>uint expected = 89;<br/>Assert.equal(simpleStorage.get(), expected, "It should store the value 89.");<br/>}</span><span id="81e6" class="ky kz ht ku b fv le lb l lc ld">}</span></pre><p id="61c2" class="pw-post-body-paragraph jc jd ht je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hm dt translated">è¿™é‡Œï¼Œæˆ‘ä»¬é¦–å…ˆå°†ä¸¤ä¸ªåŠ©æ‰‹ç±»<em class="ka"> Assert.sol </em>å’Œ<em class="ka"> DeployedAddresses.sol </em>å¯¼å…¥åˆ°è¿™ä¸ªæµ‹è¯•å¥‘çº¦ä¸­ã€‚ç„¶åï¼Œæˆ‘ä»¬åˆ›å»ºæˆ‘ä»¬çš„å¥‘çº¦ï¼Œå¹¶å°†å…¶å‘½åä¸º<em class="ka"> TestSimpleStorage </em>ã€‚è¯·æ³¨æ„ï¼Œæˆ‘ä»¬éµå¾ªäº†å—èŒæ–‡æ¡£ä¸­æè¿°çš„å‘½åçº¦å®šã€‚æ‰€æœ‰æµ‹è¯•åˆåŒéƒ½å¿…é¡»ä»¥å¤§å†™çš„<code class="eh lf lg lh ku b">T</code>å¼€å¤´<code class="eh lf lg lh ku b">Test</code>ã€‚</p><p id="81fb" class="pw-post-body-paragraph jc jd ht je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hm dt translated">ç„¶åæˆ‘ä»¬å®šä¹‰ä¸€ä¸ªæµ‹è¯•æ–¹æ³•<em class="ka"> testItStoresAValue() </em>ï¼Œè¿™é‡Œæˆ‘ä»¬ä¹Ÿéµå¾ªä¸€ä¸ªå‘½åçº¦å®šï¼Œä»<code class="eh lf lg lh ku b">Test</code>å¼€å§‹ï¼Œä½¿ç”¨å°å†™çš„<code class="eh lf lg lh ku b">t</code>ã€‚åœ¨æ­¤æ–¹æ³•ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨DeployedAddresseså¼•ç”¨æ¥è·å–SimpleStorageå¥‘çº¦çš„å¯¹è±¡ã€‚ç„¶åï¼Œæˆ‘ä»¬åªéœ€è°ƒç”¨SimpleStorageå¥‘çº¦çš„setæ–¹æ³•ï¼Œä¸ºå¥‘çº¦ä¸­çš„å˜é‡storedDataè®¾ç½®ä¸€ä¸ªå€¼(89)ã€‚</p><p id="285d" class="pw-post-body-paragraph jc jd ht je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hm dt translated">è¿™ä¸ªå•å…ƒæµ‹è¯•çš„ç›®çš„æ˜¯æ£€æŸ¥å¦‚æœæˆ‘ä»¬åœ¨SimpleStorageå¥‘çº¦ä¸­ç”¨set()æ–¹æ³•è®¾ç½®ä¸€ä¸ªå€¼ï¼Œåœ¨æˆ‘ä»¬è°ƒç”¨get()æ–¹æ³•æ—¶ï¼Œæˆ‘ä»¬åº”è¯¥å¾—åˆ°ç›¸åŒçš„å€¼ã€‚</p><p id="ab26" class="pw-post-body-paragraph jc jd ht je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hm dt translated"><em class="ka"> testItStoresAValue() </em>æ–¹æ³•çš„æœ€åä¸€è¡Œä½¿ç”¨Assert helperç±»æ¥å®Œæˆè¿™é¡¹å·¥ä½œã€‚ä½¿ç”¨<em class="ka"> Assert.equal() </em>æˆ‘ä»¬æ£€æŸ¥å½“æˆ‘ä»¬è°ƒç”¨<em class="ka"> get() </em>æ—¶å¾—åˆ°çš„å€¼æ˜¯å¦ç­‰äºæˆ‘ä»¬è®¾ç½®çš„åˆå§‹å€¼89ã€‚æˆ‘ä»¬æµ‹è¯•çš„å¯é æ€§éƒ¨åˆ†åˆ°æ­¤ç»“æŸã€‚ç°åœ¨è®©æˆ‘ä»¬å†™ä¸€äº›Javascriptã€‚</p><p id="f5a7" class="pw-post-body-paragraph jc jd ht je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hm dt translated">å¦ä¸€ä¸ªé€‰æ‹©æ˜¯ç”¨javascriptç¼–å†™æ™ºèƒ½åˆçº¦æµ‹è¯•ï¼Œå³ä½¿ç”¨javascriptä¸­çš„Mochaç¼–å†™æµ‹è¯•ã€‚</p><pre class="kp kq kr ks fq kt ku kv kw aw kx dt"><span id="2cff" class="ky kz ht ku b fv la lb l lc ld">var SimpleStorage = artifacts.require("SimpleStorage");</span><span id="783c" class="ky kz ht ku b fv le lb l lc ld">contract('SimpleStorage', function(accounts) {</span><span id="a84d" class="ky kz ht ku b fv le lb l lc ld">it("...should store the value 89.", function() {<br/>  return SimpleStorage.deployed().then(function(instance) { </span><span id="7abf" class="ky kz ht ku b fv le lb l lc ld">    simpleStorageInstance = instance;<br/>    return simpleStorageInstance.set(89, {from: accounts[0]});<br/>  }).then(function() {<br/>    return simpleStorageInstance.get.call();<br/>  }).then(function(storedData) {<br/>    assert.equal(storedData, 89, "The value 89 was not stored.");<br/>  });<br/>});</span><span id="a555" class="ky kz ht ku b fv le lb l lc ld">});</span></pre><p id="438b" class="pw-post-body-paragraph jc jd ht je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hm dt translated">ä¸Šé¢å¾ˆç®€å•ï¼Œæˆ‘ä»¬ç”¨å¥‘çº¦å¯¹è±¡ç”¨89è°ƒç”¨<em class="ka"> set() </em>æ–¹æ³•å¹¶é€šè¿‡è°ƒç”¨getæ–¹æ³•ç¡®è®¤89è¢«å­˜å‚¨ã€‚è¿™é‡Œæˆ‘ä»¬æ–­è¨€ä½¿ç”¨mochaçš„åŠ©æ‰‹ç±»ã€‚</p><p id="7331" class="pw-post-body-paragraph jc jd ht je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hm dt translated">è¿™ä¸ªæ•™ç¨‹çš„ä»£ç æ˜¯<a class="ae jb" href="https://github.com/akinmail/solidity-unit-test-tutorial" rel="noopener ugc nofollow" target="_blank">è¿™é‡Œæ˜¯</a>ã€‚</p></div></div>    
</body>
</html>