<html>
<head>
<title>Ethereum Essence: Complex Consensus Operations</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">以太坊本质:复杂的共识操作</h1>
<blockquote>原文：<a href="https://medium.com/coinmonks/ethereum-essence-complex-consensus-operations-9d63d419950b?source=collection_archive---------2-----------------------#2019-05-02">https://medium.com/coinmonks/ethereum-essence-complex-consensus-operations-9d63d419950b?source=collection_archive---------2-----------------------#2019-05-02</a></blockquote><div><div class="ef hh hi hj hk hl"/><div class="hm hn ho hp hq"><div class=""/><figure class="fi fk ir is it iu fe ff paragraph-image"><div role="button" tabindex="0" class="iv iw di ix bf iy"><div class="fe ff iq"><img src="../Images/f192686866bd668c1a90a9d4372f4622.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Tqw8cGfzqCcd5suHPa9LYw.png"/></div></div></figure><p id="e4ad" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">想象所有的人过着和平的生活。呦呼……</p><p id="edbb" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">灵魂渴望社会和平，但要实现这一点，共识这一难题需要解决。我们又来了。</p><p id="7fbc" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated"><strong class="jd hu">先说上下文:</strong> <br/>一个去中心化的系统最重要的一块是它的共识层。但是，<strong class="jd hu">“共识”</strong>是什么意思呢？根据定义，它是一个群体作为一个整体达成的意见或立场。它可能意味着大多数相关人员的一致意见或判断。</p><p id="83f5" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated"><strong class="jd hu">共识协议通常可以被认为具有:</strong></p><ul class=""><li id="fbd8" class="ka kb ht jd b je jf ji jj jm kc jq kd ju ke jy kf kg kh ki dt translated">提出建议的一组<strong class="jd hu">提议者</strong></li><li id="1e00" class="ka kb ht jd b je kj ji kk jm kl jq km ju kn jy kf kg kh ki dt translated">将<strong class="jd hu">提议</strong>标记为有效的一组测试</li><li id="3a6e" class="ka kb ht jd b je kj ji kk jm kl jq km ju kn jy kf kg kh ki dt translated">一组投票人对每个提案进行投票</li><li id="b29c" class="ka kb ht jd b je kj ji kk jm kl jq km ju kn jy kf kg kh ki dt translated">一个<strong class="jd hu">投票机制</strong>决定一个提议是被接受还是被否决</li><li id="1511" class="ka kb ht jd b je kj ji kk jm kl jq km ju kn jy kf kg kh ki dt translated">决策达成时触发的一组动作</li></ul><p id="4a7d" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated"><strong class="jd hu">投票机制可以:</strong></p><ul class=""><li id="4ccc" class="ka kb ht jd b je jf ji jj jm kc jq kd ju ke jy kf kg kh ki dt translated">设定关于谁可以投票以及投票人是否需要通过知识测试的规则</li><li id="5161" class="ka kb ht jd b je kj ji kk jm kl jq km ju kn jy kf kg kh ki dt translated">有算法来计算每一票的权重</li><li id="7611" class="ka kb ht jd b je kj ji kk jm kl jq km ju kn jy kf kg kh ki dt translated">为触发投票后或投票期间的操作设置投票分数或时间阈值</li></ul><p id="0dd3" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">形式化:我们有一个<code class="eh ko kp kq kr b">Consensus</code>函数，输入参数:提案、投票机制、在<code class="eh ko kp kq kr b">timestamp</code>的投票分数、投票池。输出将是在<code class="eh ko kp kq kr b">timestamp</code>时间的决策快照:在某个时间点，根据使用的投票机制和到该时间点为止汇总的投票数据，该提案是否被认为被接受。</p><p id="580d" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">投票池是有投票权的选民总数，不管他们是否投票。</p><pre class="ks kt ku kv fq kw kr kx ky aw kz dt"><span id="11d1" class="la lb ht kr b fv lc ld l le lf">function Consensus(<br/>   Proposal proposal,<br/>   VotingMechanism mechanism,<br/>   address[] votingPool,<br/>   VotingScore voting_score_at_timestamp<br/>)<br/>   public<br/>   returns (Decision decision);</span></pre><h1 id="2cd1" class="lg lb ht bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc dt translated">共识引擎</h1><p id="05e7" class="pw-post-body-paragraph jb jc ht jd b je md jg jh ji me jk jl jm mf jo jp jq mg js jt ju mh jw jx jy hm dt translated">以太坊目前使用工作证明作为其共识协议。我们将简要看看它是如何工作的。</p><p id="4b84" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated"><strong class="jd hu">第一阶段</strong>本身可以被认为是一个共识协议:<br/>用户可以提议实际上是链状态转换的事务。它们使用它们的以太坊客户端将事务添加到事务队列中，并进一步传播给它所连接的对等体。这些对等点遵循相同的流程，事务最终到达以太坊客户端，这些客户端也可以挖掘事务。在这一点上，每个矿工就像一个“投票者”，决定他们是否要在下一个区块中包括该交易。他们有自己的投票机制，基于相关的天然气价格和交易的天然气成本。他们还需要通过一项严格的密码测试，才能获得提案权。决策是事务数组的形式，可以构成下一个块。</p><p id="f9ab" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated"><strong class="jd hu">第二阶段</strong>是关于客户对应该用块进一步扩展哪个链版本的共识。矿工提出块，由于网络传播延迟，多个链叉同时并存。每个客户端节点根据以太坊当前使用的贪婪最重观察子树(GHOST)协议“投票”选择哪个分支有效。</p><p id="51f1" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">但是以太坊具有图灵完全表达能力，这意味着它可以成为建立更高层次共识的平台。</p><h1 id="5462" class="lg lb ht bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc dt translated">布尔共识</h1><p id="7c64" class="pw-post-body-paragraph jb jc ht jd b je md jg jh ji me jk jl jm mf jo jp jq mg js jt ju mh jw jx jy hm dt translated">在接下来的部分中，我们将只探索布尔值决策(类似于二元共识)。也就是说，投票人可以将<code class="eh ko kp kq kr b">false</code>或<code class="eh ko kp kq kr b">true</code>分配给一个提案。</p><p id="8983" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">为了构建一个通用的(基于布尔的)共识协议，应该考虑对以下内容进行细粒度投票:</p><ul class=""><li id="7939" class="ka kb ht jd b je jf ji jj jm kc jq kd ju ke jy kf kg kh ki dt translated">功能执行</li><li id="7e13" class="ka kb ht jd b je kj ji kk jm kl jq km ju kn jy kf kg kh ki dt translated">数据类型</li><li id="997e" class="ka kb ht jd b je kj ji kk jm kl jq km ju kn jy kf kg kh ki dt translated">数据类型和记录</li><li id="c34b" class="ka kb ht jd b je kj ji kk jm kl jq km ju kn jy kf kg kh ki dt translated">地址</li><li id="736f" class="ka kb ht jd b je kj ji kk jm kl jq km ju kn jy kf kg kh ki dt translated">以上的混合</li></ul><h1 id="ee51" class="lg lb ht bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc dt translated">共识记忆</h1><p id="bd74" class="pw-post-body-paragraph jb jc ht jd b je md jg jh ji me jk jl jm mf jo jp jq mg js jt ju mh jw jx jy hm dt translated">共识意味着一群人对某事达成一致。为了提高效率，必须登记一致同意的结果。必须记住这一点，以免一次又一次地经历表决过程。</p><p id="7679" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">结果可以作为<strong class="jd hu">决策</strong>、<strong class="jd hu">权限</strong>和<strong class="jd hu">声明</strong>存储在链上。可以附加关于结果的附加信息——例如，添加包含投票统计和数据的文件的群散列。</p><p id="dea7" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">我们可以进一步说<strong class="jd hu">投票过程可以持续</strong>(在线或离线)——如果观点或假设改变，人们可以改变他们的想法。因此，权限可以被视为某个时间点的记忆化结果。</p><h2 id="ed2f" class="la lb ht bd lh mi mj mk ll ml mm mn lp jm mo mp lt jq mq mr lx ju ms mt mb mu dt translated">功能执行的权限</h2><p id="4111" class="pw-post-body-paragraph jb jc ht jd b je md jg jh ji me jk jl jm mf jo jp jq mg js jt ju mh jw jx jy hm dt translated">这种许可并不局限于谁(EOAs)和什么合同可以执行单个合同功能的共识:还可以有控制什么功能可以调用/执行给定功能的许可。<br/>您还可以定义具有相似权限类型的功能类别。例如，<code class="eh ko kp kq kr b">update()</code>和<code class="eh ko kp kq kr b">remove()</code>函数可能具有相同的权限，这取决于<code class="eh ko kp kq kr b">insert()</code>的执行者。</p><p id="351f" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">如果您想在以太坊上构建一个可互操作的共识引擎，您可能想区分EVM和非EVM环境。假设您想要使用EVM协议中的一个函数:这样的函数需要是<code class="eh ko kp kq kr b">public</code>。但是，您可能不希望从非EVM环境中调用这个函数，例如从JavaScript dapp中调用。</p><h2 id="1c38" class="la lb ht bd lh mi mj mk ll ml mm mn lp jm mo mp lt jq mq mr lx ju ms mt mb mu dt translated">数据类型和记录的权限</h2><p id="6878" class="pw-post-body-paragraph jb jc ht jd b je md jg jh ji me jk jl jm mf jo jp jq mg js jt ju mh jw jx jy hm dt translated">想象一个一致的身份协议:用户可能决定将一种身份数据类型的CRUD权限授予某个可信的第三方。一个这样的第三方仅能够验证用户身份的一部分，并代表用户在线管理它。第二个可以管理另一种身份数据类型。想想Twitter在用户的身份合同上附上用户句柄证明，或者政府实体附上身份散列。</p><p id="cffe" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">因此，您可以对数据类型和数据记录本身拥有细粒度的权限。</p><h2 id="1326" class="la lb ht bd lh mi mj mk ll ml mm mn lp jm mo mp lt jq mq mr lx ju ms mt mb mu dt translated">地址权限</h2><p id="9949" class="pw-post-body-paragraph jb jc ht jd b je md jg jh ji me jk jl jm mf jo jp jq mg js jt ju mh jw jx jy hm dt translated">这种许可可以被认为是一种基于角色的访问控制机制。一个以太坊地址(EOAs或contracts)可以被另一个具有更高权限的地址授予权限，并给予更低层次的权限。</p><h2 id="7563" class="la lb ht bd lh mi mj mk ll ml mm mn lp jm mo mp lt jq mq mr lx ju ms mt mb mu dt translated">权限组合</h2><p id="fc90" class="pw-post-body-paragraph jb jc ht jd b je md jg jh ji me jk jl jm mf jo jp jq mg js jt ju mh jw jx jy hm dt translated">以上类型的权限可以组合使用。例如，您可以只授予以太坊地址更新特定数据类型的数据记录属性值的权限，而不允许它更新其他属性或删除该记录。</p><h2 id="3659" class="la lb ht bd lh mi mj mk ll ml mm mn lp jm mo mp lt jq mq mr lx ju ms mt mb mu dt translated">要求</h2><p id="33d2" class="pw-post-body-paragraph jb jc ht jd b je md jg jh ji me jk jl jm mf jo jp jq mg js jt ju mh jw jx jy hm dt translated">索赔的一些例子是:</p><ul class=""><li id="3f2b" class="ka kb ht jd b je jf ji jj jm kc jq kd ju ke jy kf kg kh ki dt translated">用户被授予成为协议变更的技术审查者的权利</li><li id="bb34" class="ka kb ht jd b je kj ji kk jm kl jq km ju kn jy kf kg kh ki dt translated">用户声称年龄超过18岁，因此在法律上被允许使用服务</li></ul><p id="5207" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">作为投票过程的结果，用户可以获得某个身份、角色或者甚至对数字商品的所有权。索赔是这一结果的永久记录。</p><h1 id="96b9" class="lg lb ht bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc dt translated">一致布尔运算</h1><p id="8f43" class="pw-post-body-paragraph jb jc ht jd b je md jg jh ji me jk jl jm mf jo jp jq mg js jt ju mh jw jx jy hm dt translated">让我们假设我们有一些既定的权限。我们可以通过对现有权限进行布尔运算来定义额外的权限。</p><p id="700a" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">例如，Bob想要在公共文件系统文件夹中进行更改。他想把一个文件从那个文件夹移到另一个文件夹。系统需要检查Bob对该文件的权限、用于改变父文件的文件更新功能、用于移除子文件的当前父文件夹及其更新功能、用于添加子文件的新文件夹及其更新功能。</p><p id="f00c" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">只有当聚集权限的最终结果为真时，Bob才被允许移动该文件。</p><p id="5943" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">计算Bob是否可以移动文件所需的布尔运算序列可以通过提议和投票来完成。一旦该序列被接受，任何想要这样做的人都可以使用它。</p><h1 id="b06c" class="lg lb ht bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc dt translated">元共识:共识链</h1><p id="cf31" class="pw-post-body-paragraph jb jc ht jd b je md jg jh ji me jk jl jm mf jo jp jq mg js jt ju mh jw jx jy hm dt translated">我们已经讨论了一些难题。谜题本身就是一个<strong class="jd hu">一般共识引擎</strong>。一种协议，允许您通过使用其自身来构建其他共识协议，从而就新协议的设计达成共识。</p><p id="3b78" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">流程应该是这样的:Alice提出了一个新的投票机制，并在链上提交它(该机制本身甚至可以包含指向Swarm存储的脚本文件的指针)。Alice没有权限将投票机制直接添加到协议中。因此，系统宣布提交并创建一个新的投票资源。人们现在可以讨论和投票(在线或离线)。开发人员可以以提交的形式对这个新机制进行测试。</p><p id="13c2" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">如果投票成功，Alice的投票机制可以完全注册到协议中，并且Alice可以自动被授予一些新的权限，例如“机制更新的审阅者”。</p><p id="b246" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">诸如此类。这是对未来的共识。</p><p id="540c" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated"><strong class="jd hu">这是一个到目前为止已经描述过的依赖关系图。</strong></p><figure class="ks kt ku kv fq iu fe ff paragraph-image"><div role="button" tabindex="0" class="iv iw di ix bf iy"><div class="fe ff mv"><img src="../Images/007fc4195044b0150c8f6c0a98be4f01.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*alZBWmPqbp5RJQEigTiQlw.png"/></div></div></figure><h1 id="bbdc" class="lg lb ht bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc dt translated">共识生命周期</h1><p id="5e3f" class="pw-post-body-paragraph jb jc ht jd b je md jg jh ji me jk jl jm mf jo jp jq mg js jt ju mh jw jx jy hm dt translated">事实上的<strong class="jd hu">共识</strong>和观点上的<strong class="jd hu">共识</strong>是有区别的。对意见的共识遭受易变性和侵蚀。</p><p id="a47e" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">虽然对事实的一致意见也可以(至少部分地)通过编程达成，但对观点的一致意见可能需要持续运行的灵活的允许/不允许协议。因此，生命周期可以是:</p><ul class=""><li id="ed3d" class="ka kb ht jd b je jf ji jj jm kc jq kd ju ke jy kf kg kh ki dt translated"><strong class="jd hu">创作</strong></li><li id="22ff" class="ka kb ht jd b je kj ji kk jm kl jq km ju kn jy kf kg kh ki dt translated"><strong class="jd hu">突变</strong></li><li id="a8d2" class="ka kb ht jd b je kj ji kk jm kl jq km ju kn jy kf kg kh ki dt translated"><strong class="jd hu">侵蚀</strong></li></ul><p id="4d0f" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">我已经提到过权限有一个有限的生命周期，也就是说，如果正在进行的投票结果发生变化，权限可以改变。</p><p id="9f87" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">从道德的角度来看，任何需要达成共识的事情都应该作为一个<strong class="jd hu">持续的投票过程</strong>来实施。人们应该能够在任何时候撤回对一个想法的支持。一个制度只有在以下情况下才是民主和道德的:</p><ul class=""><li id="23d3" class="ka kb ht jd b je jf ji jj jm kc jq kd ju ke jy kf kg kh ki dt translated">任何人都可以提出一项变革，并为此启动投票程序</li><li id="9164" class="ka kb ht jd b je kj ji kk jm kl jq km ju kn jy kf kg kh ki dt translated">任何先前批准的更改都可以通过投票恢复(上下文已经改变，新投票者的涌入，旧投票者的消失，等等。)</li></ul><p id="23ec" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated"><strong class="jd hu">实现协议的连续投票:</strong></p><ul class=""><li id="a4db" class="ka kb ht jd b je jf ji jj jm kc jq kd ju ke jy kf kg kh ki dt translated">人们可以提交一个包含测试和审计所需的所有源代码和信息的协议变更</li><li id="bf2c" class="ka kb ht jd b je kj ji kk jm kl jq km ju kn jy kf kg kh ki dt translated">启用对协议变更的投票</li><li id="644f" class="ka kb ht jd b je kj ji kk jm kl jq km ju kn jy kf kg kh ki dt translated">如果达到正的阈值投票分数，则自动接受变更</li><li id="ff67" class="ka kb ht jd b je kj ji kk jm kl jq km ju kn jy kf kg kh ki dt translated">投票可以继续进行，如果达到了否定的投票分数，更改将再次被自动禁用</li><li id="291a" class="ka kb ht jd b je kj ji kk jm kl jq km ju kn jy kf kg kh ki dt translated">在这一点上，可以继续投票，也可以提出一项提案，要求取消提议的变更</li></ul><p id="f37f" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">可以有一组自动化测试，可以对提议的变更运行，如果测试没有通过，可以标记提议并暂停投票。这可以通过用于不可信计算的分散协议来实现。</p><h1 id="cbee" class="lg lb ht bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc dt translated">结论</h1><p id="222c" class="pw-post-body-paragraph jb jc ht jd b je md jg jh ji me jk jl jm mf jo jp jq mg js jt ju mh jw jx jy hm dt translated">今天我们只探讨了在以太坊上使用二进制共识的方法。有更多类型的共识可以探索。但是这一次。</p><p id="d56b" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">从这方面来说，以太坊共识引擎有很大的成长和进化空间。我们正处于探索不同类型的共识能够实现什么的初级阶段。复杂的共识操作将扩展并打开新的发现视野。</p><p id="14bf" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">因此，我对区块链的反对者说:你还什么都没看到！</p><blockquote class="mw"><p id="108c" class="mx my ht bd mz na nb nc nd ne nf jy ek translated"><a class="ae ng" href="https://coincodecap.com/?utm_source=coinmonks" rel="noopener ugc nofollow" target="_blank">在您的收件箱中直接获得最佳软件交易</a></p></blockquote><figure class="ni nj nk nl nm iu fe ff paragraph-image"><a href="https://coincodecap.com/?utm_source=coinmonks"><div class="fe ff nh"><img src="../Images/7c0b3dfdcbfea594cc0ae7d4f9bf6fcb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1168/format:webp/0*OJ-qb5G6i863msBB.png"/></div></a></figure></div></div>    
</body>
</html>