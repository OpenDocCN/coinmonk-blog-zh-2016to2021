<html>
<head>
<title>Solidity Smart Contracts Walk-through Series Part-2</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Solidity智能合约演练系列第2部分</h1>
<blockquote>原文：<a href="https://medium.com/coinmonks/solidity-smart-contracts-walk-through-series-part-2-d526c5d5782e?source=collection_archive---------3-----------------------#2019-10-10">https://medium.com/coinmonks/solidity-smart-contracts-walk-through-series-part-2-d526c5d5782e?source=collection_archive---------3-----------------------#2019-10-10</a></blockquote><div><div class="ef hh hi hj hk hl"/><div class="hm hn ho hp hq"><div class=""/><figure class="fi fk ir is it iu fe ff paragraph-image"><div role="button" tabindex="0" class="iv iw di ix bf iy"><div class="fe ff iq"><img src="../Images/7a21d3d1b36dac5fe05eeecd4bf8cbe6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3ASLszygs5ByqIc43fJc9A.jpeg"/></div></div><figcaption class="jb jc fg fe ff jd je bd b be z ek">Photo by <a class="ae jf" href="https://unsplash.com/@tierramallorca?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">Tierra Mallorca</a> on <a class="ae jf" href="https://unsplash.com/s/photos/property?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="183b" class="pw-post-body-paragraph jg jh ht ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated">这是智能合同演练系列的第2部分<strong class="ji hu">。在接下来的帖子中，我将向您深入介绍我们的物业租赁智能合同的技术实现细节。代码库可以在这里找到<a class="ae jf" href="https://github.com/Harry-027/Solidity-Smart-Contracts-Walkthrough" rel="noopener ugc nofollow" target="_blank"><strong class="ji hu"/></a><strong class="ji hu">。</strong></strong></p><p id="4f08" class="pw-post-body-paragraph jg jh ht ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated"><strong class="ji hu">出租物业用例::</strong></p><p id="7327" class="pw-post-body-paragraph jg jh ht ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated">整体用例非常简单。用户将根据给定的属性将自己注册为潜在客户。业主将决定哪个用户将成为租户。承租人将按照约定的到期日支付租金。要存储在合同中的租金金额。业主可以从合同中收回相同的租金。如果租户没有在到期日支付租金，业主可以对租户提出警告。允许所有者在至少2天的时间间隔内提出警告。如果房客超过了警告界限，房主可以将房客逐出房屋。</p><p id="765d" class="pw-post-body-paragraph jg jh ht ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated"><strong class="ji hu">我们开始吧……</strong></p><p id="4f64" class="pw-post-body-paragraph jg jh ht ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated">下面是我们定义的数据结构:</p><figure class="kf kg kh ki fq iu fe ff paragraph-image"><div role="button" tabindex="0" class="iv iw di ix bf iy"><div class="fe ff ke"><img src="../Images/c5068d0959a1d381d1bd7d44b7ac1758.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qga5oK_UuY2NTL_ZmMuTbA.png"/></div></div><figcaption class="jb jc fg fe ff jd je bd b be z ek">comment against each property field defines their respective role</figcaption></figure><p id="a8c3" class="pw-post-body-paragraph jg jh ht ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated">这里我们定义了<strong class="ji hu"> Property </strong> struct，它将记录物业的详细信息，如名称、地址、是否出租的物业、租金金额、租金间隔、租金到期日、警告次数、警告限制&amp;租户钱包地址。我们有<strong class="ji hu">monthly rent status</strong>struct，它将帮助我们存储每个月的租金状态。我们还有各种映射— <strong class="ji hu">月</strong>、<strong class="ji hu">租户注册</strong> &amp; <strong class="ji hu">租金支付状态。</strong></p><figure class="kf kg kh ki fq iu fe ff paragraph-image"><div role="button" tabindex="0" class="iv iw di ix bf iy"><div class="fe ff kj"><img src="../Images/64ba38692469d052878041621226aeca.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xGkogsX6gS434HuQZ9rS7w.png"/></div></div></figure><p id="ed49" class="pw-post-body-paragraph jg jh ht ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated">我们已经定义了事件，这将帮助我们记录成功的事务。我们正在设置属性所有者，属性细节和构造函数本身的月份映射。构造函数只被调用一次(当契约被部署时)。</p><figure class="kf kg kh ki fq iu fe ff paragraph-image"><div role="button" tabindex="0" class="iv iw di ix bf iy"><div class="fe ff kk"><img src="../Images/57d6b204d2619e60d7c244f80d48f8d9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*uL73YCQHuUZGq38JXuq1XQ.png"/></div></div></figure><p id="a98a" class="pw-post-body-paragraph jg jh ht ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated">上面显示的是隔离和区分我们的合同的各种功能的各种修饰符。</p><figure class="kf kg kh ki fq iu fe ff paragraph-image"><div role="button" tabindex="0" class="iv iw di ix bf iy"><div class="fe ff kl"><img src="../Images/1ba4b873173456e1b58fbcbb706b5254.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Savdhy5XOC8nRc_1f5FBiA.png"/></div></div></figure><p id="b80a" class="pw-post-body-paragraph jg jh ht ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated">任何用户都可以通过调用<strong class="ji hu">registra tenant</strong>方法来表达他/她对出租物业的兴趣。如果该物业未出租，它将为给定用户设置<strong class="ji hu"> tenantRegistry </strong>映射。业主将通过调用<strong class="ji hu"> confirmTenant </strong>方法，输入为<strong class="ji hu">各自的用户钱包地址</strong>，来确认哪个用户应该成为租户。这将最终确定租户，将物业<strong class="ji hu">已租</strong>状态标记为真&amp;将根据<strong class="ji hu">租金间隔</strong>设置<strong class="ji hu">租金到期日</strong>。</p><blockquote class="km kn ko"><p id="26de" class="jg jh kp ji b jj jk jl jm jn jo jp jq kq js jt ju kr jw jx jy ks ka kb kc kd hm dt translated">注意—这里所有基于日期的计算都基于unix时间戳。<strong class="ji hu"> <em class="ht">现在</em> </strong>是给我们包含我们事务的块的时间戳的关键字。然而，这不是准确的时间戳，但它会给出允许范围内的时间。</p></blockquote><figure class="kf kg kh ki fq iu fe ff paragraph-image"><div role="button" tabindex="0" class="iv iw di ix bf iy"><div class="fe ff kt"><img src="../Images/5bdc5ef67346fdc2d7bbfd497f944862.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SgZamrdIc0O46U88vN-I-w.png"/></div></div></figure><p id="5b50" class="pw-post-body-paragraph jg jh ht ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated">方法<strong class="ji hu"> payRent </strong>将允许租户支付给定月份的租金。请注意，只有当发送的金额等于要支付的租金金额时，才会接受租金。它还将设置<strong class="ji hu">下一个到期日</strong> &amp;如果有的话，将<strong class="ji hu">租户警告</strong>重置为0。</p><blockquote class="km kn ko"><p id="f358" class="jg jh kp ji b jj jk jl jm jn jo jp jq kq js jt ju kr jw jx jy ks ka kb kc kd hm dt translated">注意——如果函数参数(也包括返回参数)是struct、array、mapping或string类型，那么应该清楚地指出它们的数据位置——或者是<strong class="ji hu">内存，或者是存储</strong>。如果函数是<strong class="ji hu">外部</strong>，应该将数据位置设为<strong class="ji hu">调用数据</strong>。关于内存&amp;存储模型如何工作的更多信息，请点击这里<strong class="ji hu"><a class="ae jf" rel="noopener" href="/coinmonks/what-the-hack-is-memory-and-storage-in-solidity-6b9e62577305"><strong class="ji hu">。</strong></a></strong></p></blockquote><p id="8016" class="pw-post-body-paragraph jg jh ht ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated">方法<strong class="ji hu"> getRentStatus </strong>将允许任何人检查任何给定月份的租金状态。</p><blockquote class="km kn ko"><p id="95bc" class="jg jh kp ji b jj jk jl jm jn jo jp jq kq js jt ju kr jw jx jy ks ka kb kc kd hm dt translated">注意——任何struct类型的函数作用域变量都应该清楚地指出它的数据位置— <strong class="ji hu">内存或存储</strong>,因为这有助于编译器做出基于事务的决定。注意，在<strong class="ji hu"> getRentStatus </strong>方法中，我们返回每个字段，因为返回完整的结构是不可能的。Solidity只将struct作为变量的松散包来实现。</p></blockquote><figure class="kf kg kh ki fq iu fe ff paragraph-image"><div role="button" tabindex="0" class="iv iw di ix bf iy"><div class="fe ff ku"><img src="../Images/e1d9267da86a7a763f5d1dfd8b81dc7f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fg5UbsfBqLaQ4OlLni6ODg.png"/></div></div></figure><p id="d227" class="pw-post-body-paragraph jg jh ht ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated"><strong class="ji hu">提取租金</strong>将允许业主从合同地址提取月租金。它还会将相应月份的<strong class="ji hu"> rentInStore </strong>映射重置为0，因为不允许所有者在同一个月提取两次租金。</p><figure class="kf kg kh ki fq iu fe ff paragraph-image"><div role="button" tabindex="0" class="iv iw di ix bf iy"><div class="fe ff kv"><img src="../Images/38eb422fab812d4ac0a540b18eb314cf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CUcyznKsXWh-igjGb3hKwg.png"/></div></div></figure><p id="33f0" class="pw-post-body-paragraph jg jh ht ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated">只有在以下情况下，业主才可以警告承租人未交租金-</p><ul class=""><li id="03e7" class="kw kx ht ji b jj jk jn jo jr ky jv kz jz la kd lb lc ld le dt translated">承租人尚未支付租金，到期日已到。</li><li id="521f" class="kw kx ht ji b jj lf jn lg jr lh jv li jz lj kd lb lc ld le dt translated">在<strong class="ji hu">(现在—警告时间&gt; 172800000) </strong>之前至少2天提出的最后警告(如果有的话)。</li></ul><p id="1828" class="pw-post-body-paragraph jg jh ht ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated">将会触发一个<strong class="ji hu">警告事件</strong>，该事件可以通过使用<strong class="ji hu"> web3 api </strong>的用户界面来监听，以便警告租户关于未决租金。另外<strong class="ji hu">警告计数</strong>将增加。</p><p id="8869" class="pw-post-body-paragraph jg jh ht ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated">业主也可以在达到警告限制的情况下解雇租户。调用<strong class="ji hu"> dismissTenant </strong>方法也会将属性<strong class="ji hu">租用</strong>状态重置为false。</p></div><div class="ab cl lk ll hb lm" role="separator"><span class="ln bw bk lo lp lq"/><span class="ln bw bk lo lp lq"/><span class="ln bw bk lo lp"/></div><div class="hm hn ho hp hq"><p id="e58b" class="pw-post-body-paragraph jg jh ht ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated">我希望你喜欢！请务必查看下一部分，我们将在其中讨论业务合作智能合同。</p><p id="2af3" class="pw-post-body-paragraph jg jh ht ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated"><em class="kp">其他部分:</em> <a class="ae jf" rel="noopener" href="/@harish0y2j/solidity-smart-contracts-walk-through-series-part-1-90075f4e9da6"> <em class="kp"> Part-1 </em> </a> <em class="kp">，</em><a class="ae jf" rel="noopener" href="/@harish0y2j/solidity-smart-contracts-walk-through-series-part-2-d526c5d5782e"><em class="kp">Part-2</em></a><em class="kp">，</em> <a class="ae jf" rel="noopener" href="/@harish0y2j/solidity-smart-contracts-walk-through-series-part-3-480ba8019ab9"> <em class="kp"> Part-3 </em> </a></p><p id="f5cb" class="pw-post-body-paragraph jg jh ht ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated">代码库可以在这里找到<a class="ae jf" href="https://github.com/Harry-027/Solidity-Smart-Contracts-Walkthrough" rel="noopener ugc nofollow" target="_blank">。</a></p><blockquote class="lr"><p id="2930" class="ls lt ht bd lu lv lw lx ly lz ma kd ek translated"><a class="ae jf" href="https://coincodecap.com/?utm_source=coinmonks" rel="noopener ugc nofollow" target="_blank">直接在您的收件箱中获得最佳软件交易</a></p></blockquote><figure class="mc md me mf mg iu fe ff paragraph-image"><a href="https://coincodecap.com/?utm_source=coinmonks"><div class="fe ff mb"><img src="../Images/7c0b3dfdcbfea594cc0ae7d4f9bf6fcb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1168/format:webp/0*OJ-qb5G6i863msBB.png"/></div></a></figure></div></div>    
</body>
</html>