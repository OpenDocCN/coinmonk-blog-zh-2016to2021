<html>
<head>
<title>Write A Simple Contract On Top Of Ethereum</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在以太坊上写一个简单的合同</h1>
<blockquote>原文：<a href="https://medium.com/coinmonks/write-a-simple-contract-on-top-of-ethereum-92b543594e84?source=collection_archive---------1-----------------------#2018-05-02">https://medium.com/coinmonks/write-a-simple-contract-on-top-of-ethereum-92b543594e84?source=collection_archive---------1-----------------------#2018-05-02</a></blockquote><div><div class="ef hh hi hj hk hl"/><div class="hm hn ho hp hq"><div class=""/><p id="20fa" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">在本文中，我将向您展示如何在以太坊的基础上创建一个智能契约。智能合约是以太坊上面的一个程序。有人说智能合约是一个不可阻挡的应用。我们将在<a class="ae jo" href="https://remix.ethereum.org." rel="noopener ugc nofollow" target="_blank">https://remix.ethereum.org</a>使用一个web应用程序来建立一个智能合同。这是一个在线编辑器，用于学习如何构建一个简单的智能合同。在这个web应用程序中，我们使用Solidity编程语言。Solidity是一种编程语言，通常用于编写智能合同。您将看到一个投票应用程序的智能合同示例。</p><figure class="jq jr js jt fq ju fe ff paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="fe ff jp"><img src="../Images/f0d8c7ececd69cd6af5efd016688135c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gsI8VnDkYxI-yKaugSDBTQ.png"/></div></div><figcaption class="kb kc fg fe ff kd ke bd b be z ek">A default page in Remix.Ethereum.org</figcaption></figure><p id="77bb" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">让我们写下我们的第一份合同。您可以清除browser/ballot.sol的全部内容，也可以单击左上角的按钮创建一个新文件。</p><figure class="jq jr js jt fq ju fe ff paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="fe ff jp"><img src="../Images/ee017fc0f427cb0c5244e355f420855a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*o8-EB12wGKu056ekEpa0lQ.png"/></div></div><figcaption class="kb kc fg fe ff kd ke bd b be z ek">Add new file button</figcaption></figure><figure class="jq jr js jt fq ju fe ff paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="fe ff jp"><img src="../Images/fd414beaa48b1b93e77904becce9c8fa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zG5RDyPHiPbjpwgQe0IjtQ.png"/></div></div><figcaption class="kb kc fg fe ff kd ke bd b be z ek">Giving a new file name</figcaption></figure><p id="7ce9" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">将其命名为“auction.sol”。</p><p id="9061" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">现在我们准备写一份智能合同。你要写的第一行是:</p><pre class="jq jr js jt fq kf kg kh ki aw kj dt"><span id="ecee" class="kk kl ht kg b fv km kn l ko kp">pragma solidity ^0.4.19;</span></pre><p id="c607" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">这是告诉哪个编译器可以编译这个代码的指令。禁止使用0.4.18及更低版本。0.5版本也是禁止的。版本0.4.20，0.4.21都可以。在https://github.com/ethereum/solc-js/releases<a class="ae jo" href="https://github.com/ethereum/solc-js/releases" rel="noopener ugc nofollow" target="_blank">看到的最新版本是0.4.23，这是本文撰写时的版本。web应用程序中使用的Solidity编译器是最新版本。如果单击“设置”选项卡，您可以看到该信息。你会看到在web应用程序中使用的Solidity编译器。</a></p><figure class="jq jr js jt fq ju fe ff paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="fe ff jp"><img src="../Images/bfcb039dcd145ce50def96502a3a0d33.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rmclOk5qzr_OV1n6z9PXxg.png"/></div></div><figcaption class="kb kc fg fe ff kd ke bd b be z ek">Settings tab</figcaption></figure><figure class="jq jr js jt fq ju fe ff paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="fe ff kq"><img src="../Images/1dd015f5f5a01cf3dc29c5b5f40a5821.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gblOAegIJXsYFVKYy4DelA.png"/></div></div><figcaption class="kb kc fg fe ff kd ke bd b be z ek">Solidity compiler</figcaption></figure><p id="aeb4" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">然后，您将键入:</p><pre class="jq jr js jt fq kf kg kh ki aw kj dt"><span id="e953" class="kk kl ht kg b fv km kn l ko kp">contract Auction {</span><span id="fe94" class="kk kl ht kg b fv kr kn l ko kp">}</span></pre><p id="68b1" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">这是我们的框架合同。在其他主流编程如Python中，Java最接近的东西是“class”关键字。它是一个表示契约的代码块。像其他编程语言中的<em class="ks">类</em>一样，它有代表契约本身状态的变量和函数(方法)。</p><p id="f9fe" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">在其他编程语言中，你有一个<em class="ks">类</em>和一个对象。类是对象的模板。合同就是这样。合同的源代码就是模板。如果在其他编程语言中，您在模板之外创建了一个对象，那么在这里您部署了一个契约。换句话说，部署契约基本上是创建类对象的同义词。</p><p id="e402" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">在Remix编辑器中，很容易做到这一点。转到运行选项卡，然后确保在单击创建按钮之前使用JavaScript VM环境。</p><figure class="jq jr js jt fq ju fe ff paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="fe ff kt"><img src="../Images/3a6f5777cd2f4977c7c24348c95c726a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qKgPpGwqzMqzWxXAknYCig.png"/></div></div><figcaption class="kb kc fg fe ff kd ke bd b be z ek">Creating a smart contract</figcaption></figure><figure class="jq jr js jt fq ju fe ff paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="fe ff jp"><img src="../Images/7bc938154b64ad254572a0dd6de030b6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MV3tg7jLaQ-0eGhUN4LsOA.png"/></div></div><figcaption class="kb kc fg fe ff kd ke bd b be z ek">Contract created</figcaption></figure><p id="b453" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">这里，我们将契约部署到本地JavaScript虚拟机。但是可以部署到以太坊主网但是需要付费。我的意思是，在JavaScript虚拟机中，你仍然需要付费。但是在JavaScript VM中，他们每个账号免费赠送100个乙醚(假乙醚；以太坊主网不接受这些以太)。如果你注意到，该帐户不再有100以太，而是99.999999以太。部署合同需要支付少量费用。智能合约在这一点上不做任何事情。</p><p id="9574" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">让我们为这个智能契约写一些变量。我们要写一个智能合同，可以是拍卖行。我们有一个代表拍卖行的经理，他的目的仅仅是部署合同和完成拍卖。有一个卖家想要拍卖物品。有出价人对该物品出价。</p><pre class="jq jr js jt fq kf kg kh ki aw kj dt"><span id="c8ff" class="kk kl ht kg b fv km kn l ko kp"> address public manager;<br/> address public seller;<br/> uint public latestBid;<br/> address public latestBidder;</span></pre><p id="5432" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">Solidity就像其他编程语言一样。它有整数类型的变量。这里的Uint表示无符号整数(不能保存负值)。它有字符串、数组和其他数据类型，这是一门像样的编程语言所能提供的。但是有一种特殊的数据类型叫做address，它是非常独特的。这里的地址不像C编程语言中的指针。不要把它当成内存中的地址。此处的地址表示智能合同所在的位置，或者您的帐户所在的位置。地址类似于0x ca 35 b 7d 915458 ef 540 ade 6068 dfe 2 f 44 e 8 fa 733 c。</p><p id="2c77" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">如果你注意到，一旦你修改了合同，账户的余额就会被重新设置。最好删除该合同，然后重新部署该合同，以查看更改的效果。</p><figure class="jq jr js jt fq ju fe ff paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="fe ff jp"><img src="../Images/af58adc490c3b62048bbf07cd077b520.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Mrx3ibg0GHyqHc0lqnRw3A.png"/></div></div><figcaption class="kb kc fg fe ff kd ke bd b be z ek">Deleting the contract</figcaption></figure><p id="f0ff" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">变量之后，我们需要写构造函数。它是可选的。此构造函数是一个特殊的函数，在部署协定时最初运行。</p><pre class="jq jr js jt fq kf kg kh ki aw kj dt"><span id="aa22" class="kk kl ht kg b fv km kn l ko kp"> constructor() public {<br/>   manager = msg.sender;<br/> }</span></pre><p id="17f6" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated"><em class="ks"> () </em>表示该函数不接受任何参数。<em class="ks"> Public </em>关键字表示该函数可以从外部调用。在构造函数内部，我们可以看到，有一个特殊的变量<em class="ks"> msg </em>。我们从未声明过<em class="ks">消息</em>变量。它从哪里来？当您从外部调用该函数时(在这种情况下，它是在您创建智能契约时隐式调用的)，变量<em class="ks"> msg </em>表示运行该函数的地址。在这种情况下，<em class="ks"> msg </em>变量的属性<em class="ks"> sender </em>是运行该函数的“某人”的地址。还有其他属性(我们将在后面研究)。</p><p id="8029" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">在构造函数之后，我们可以编写函数来设置初始出价量。</p><pre class="jq jr js jt fq kf kg kh ki aw kj dt"><span id="62dc" class="kk kl ht kg b fv km kn l ko kp"> function auction(uint bid) public {<br/>   latestBid = bid * 1 ether; //1 ether is 1000000000000000000;<br/>   seller = msg.sender;<br/> }</span></pre><p id="22ff" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">这个函数接受一个参数，一个无符号整数变量。这里，该函数期望任何无符号整数在被存储到变量<em class="ks"> latestBid </em>之前将被乘以‘1 ether ’,该变量也是无符号整数。我们希望以魏货币存储投标。以太坊不只有1种货币。就像比特币有比特币币和satoshi币。都代表你有多少比特币。但是1比特币大于1聪。我们将出价存储为最低货币。魏之于以太坊，就像是satoshi之于比特币。1乙醚是100000000000000000魏。</p><p id="56df" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">然后我们将运行这个函数的“某人”的地址存储到<em class="ks">卖家</em>变量中。请记住，部署合同的人可能不同于调用拍卖功能的人。</p><p id="d5ce" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">那么我们如何运行拍卖功能呢？</p><p id="c3b8" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">首先，我们通过再次单击“Create”按钮来重新部署智能合约。之后，您可以检查manager变量值(您可以检查它，因为它被声明为public)。请注意，它与您在帐户选择框中使用的地址相同。</p><figure class="jq jr js jt fq ju fe ff paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="fe ff ku"><img src="../Images/bafe49e48da28cca350d411573b128e4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4NBAS5stZfFfF8mzaazbyQ.png"/></div></div><figcaption class="kb kc fg fe ff kd ke bd b be z ek">The manager variable can be inspected</figcaption></figure><p id="3ff5" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">要运行拍卖功能，我们可以单击拍卖按钮。在此之前，让我们将帐户选择框更改为其他帐户。我们不希望经理和销售人员是同一个人。默认情况下，账户选择框有5个账户。选择了不同于您使用过的那个。然后，在拍卖按钮右侧的输入字段中输入数值。在这种情况下，我们希望将初始出价设置为2 ether。所以第二种。然后点击拍卖按钮。</p><figure class="jq jr js jt fq ju fe ff paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="fe ff kv"><img src="../Images/590076d888661415d764d19a85b35baa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*c5rESlToRzHUR-xobSPMDg.png"/></div></div><figcaption class="kb kc fg fe ff kd ke bd b be z ek">Execute the auction function</figcaption></figure><p id="59f7" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">然后，我们需要创建一个出价功能，人们可以举手出价。</p><pre class="jq jr js jt fq kf kg kh ki aw kj dt"><span id="b8f4" class="kk kl ht kg b fv km kn l ko kp">function bid() public payable {<br/>  require(msg.value &gt; latestBid);<br/> <br/>  if (latestBidder != 0x0) {<br/>    latestBidder.transfer(latestBid);<br/>  }<br/>  latestBidder = msg.sender;<br/>  latestBid = msg.value;<br/>}</span></pre><p id="0976" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">这个函数会被很多人调用很多次。我们假设人们想要出价高于其他人。因此，我们在该函数中做的第一件事是检查他们随该函数调用发送的金额是否大于<em class="ks"> latestBid </em>，如果未初始化，该值将为0。什么？！！你可以在调用函数的同时发送一笔钱。我会告诉你有多快。</p><p id="d830" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">在这个策略中，我们有这样的策略，如果我们有更大的出价，我们就把先前的出价返回给它的出价者。我们将最新的投标人及其出价保存在变量中。这里，你可以看到<em class="ks">消息</em>变量除了<em class="ks">发送方</em>之外还有其他属性，即<em class="ks">值</em>。<em class="ks">值</em>属性是您在调用函数时发送的金额。您在值输入字段中输入您想要发送的钱(在本例中只需输入4)。但是将右侧的选择框从wei更改为ether。最后，点击出价按钮。确保你使用除了经理和卖家账户之外的其他账户。</p><figure class="jq jr js jt fq ju fe ff paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="fe ff kw"><img src="../Images/6c46be78a0484b0068aec28f9ef03f2d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SLO3WVoQ8wQGv1rgr82DIg.png"/></div></div><figcaption class="kb kc fg fe ff kd ke bd b be z ek">Send money along the invocation of the function</figcaption></figure><p id="c207" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">运行bid函数后，您会注意到账户中的钱变成了95.99999以太。那是因为你给合同送去的钱多达4以太。您可以检查<em class="ks">最新投标</em>和<em class="ks">最新投标</em>以查看更新的投标。</p><figure class="jq jr js jt fq ju fe ff paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="fe ff kw"><img src="../Images/6cd57b717fbd1ae0aca5dfa544d639bf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QIOuLuyMFY_HHSMk0CYB3Q.png"/></div></div><figcaption class="kb kc fg fe ff kd ke bd b be z ek">After bidding process</figcaption></figure><p id="99ac" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">你可以换个账号，用更高的金额出价。你会注意到那4块乙醚会被退还给之前的竞标者。</p><p id="499b" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">最后一部分将完成拍卖功能。简单来说，智能合同拍卖流程的策略将由经理关闭。此功能只能通过经理地址执行。</p><pre class="jq jr js jt fq kf kg kh ki aw kj dt"><span id="b08c" class="kk kl ht kg b fv km kn l ko kp">function finishAuction() restricted public {<br/>  seller.transfer(address(this).balance);<br/>}<br/> <br/>modifier restricted() {<br/>  require(msg.sender == manager);<br/>  _;<br/>}</span></pre><p id="001a" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">在这里，你可以看到<em class="ks">修饰语</em>关键字。在<em class="ks">修饰符</em>函数中，你可以看到我们检查执行这个函数的人是否是<em class="ks">管理者</em>。然后就是<em class="ks"> _ </em>语句。这个<em class="ks"> _ </em>将把控制传递回这个修改函数所应用的函数。在<em class="ks">完成动作</em>函数中，我们使用地址<em class="ks">卖方</em>并执行其方法<em class="ks">传送</em>。方法<em class="ks">转账</em>接受一个说法，你想送多少钱。这指的是智能契约，我们在调用它的<em class="ks"> balance </em>属性之前将它转换为address类型。简单地说，<em class="ks">地址(本)。余额</em>指智能合约中的所有资金。如果您执行此功能，<em class="ks">卖家</em>账户将会增加资金。确保您作为<em class="ks">经理</em>执行该功能。如果你不这样做，你会发现交易失败。</p><figure class="jq jr js jt fq ju fe ff paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="fe ff kq"><img src="../Images/0ef8c41c9e03d238da110e12f06ed008.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tPUaOdA9b7mfp3CGhQiHyA.png"/></div></div><figcaption class="kb kc fg fe ff kd ke bd b be z ek">Transaction fails</figcaption></figure><p id="d9cb" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">这种智能合同有许多改进之处。我们将在以后的文章中探讨这个问题。这是完整的源代码:</p><pre class="jq jr js jt fq kf kg kh ki aw kj dt"><span id="ced6" class="kk kl ht kg b fv km kn l ko kp">pragma solidity ^0.4.19;</span><span id="4590" class="kk kl ht kg b fv kr kn l ko kp">contract Auction {<br/>  address public manager;<br/>  address public seller;<br/>  uint public latestBid;<br/>  address public latestBidder;<br/> <br/>  constructor() public {<br/>    manager = msg.sender;<br/>  }<br/> <br/>  function auction(uint bid) public {<br/>    latestBid = bid * 1 ether; //1000000000000000000;<br/>    seller = msg.sender;<br/>  }<br/> <br/>  function bid() public payable {<br/>    require(msg.value &gt; latestBid);<br/> <br/>    if (latestBidder != 0x0) {<br/>      latestBidder.transfer(latestBid);<br/>    }<br/>    latestBidder = msg.sender;<br/>    latestBid = msg.value;<br/>  }<br/> <br/>  function finishAuction() restricted public {<br/>    seller.transfer(address(this).balance);<br/>  }<br/> <br/>  modifier restricted() {<br/>    require(msg.sender == manager);<br/>    _;<br/>  }<br/>}</span></pre></div></div>    
</body>
</html>