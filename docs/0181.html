<html>
<head>
<title>Smart Contract Security Pt III — Gas Limits</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">智能合同安全第三部分—气体限制</h1>
<blockquote>原文：<a href="https://medium.com/coinmonks/smart-contract-security-pt-iii-gas-limits-4c48c7d0eba0?source=collection_archive---------0-----------------------#2018-03-23">https://medium.com/coinmonks/smart-contract-security-pt-iii-gas-limits-4c48c7d0eba0?source=collection_archive---------0-----------------------#2018-03-23</a></blockquote><div><div class="ef hh hi hj hk hl"/><div class="hm hn ho hp hq"><div class=""/><figure class="fi fk ir is it iu fe ff paragraph-image"><div role="button" tabindex="0" class="iv iw di ix bf iy"><div class="fe ff iq"><img src="../Images/ac9e2a54a2bac43b1626622d07baf715.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dW-r-jWTtGx1xCBimByPkA.jpeg"/></div></div></figure><p id="a28c" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">以太坊是一种加密货币，允许开发人员用一种叫做Solidity的编程语言编写dApps(去中心化应用程序)。其背后的基本前提是，任何编写的dApps都将被网络中的矿工执行，有效地创建了一个全局计算机！</p><p id="68cb" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">虽然这听起来很棒，但提出的一个明显问题是，如果有人在网络上部署大量虚拟合同，实际上导致了DDoS(分布式拒绝服务)攻击，会发生什么？为了解决这个问题，网络要求用户为部署智能合同并与之交互而付费。一个乙醚的最小单位是一个卫。供参考:</p><ul class=""><li id="0bb3" class="jz ka ht jd b je jf ji jj jm kb jq kc ju kd jy ke kf kg kh dt translated">1魏= 1魏</li><li id="6b7c" class="jz ka ht jd b je ki ji kj jm kk jq kl ju km jy ke kf kg kh dt translated">1千微/巴贝奇= 1⁰微</li><li id="55b0" class="jz ka ht jd b je ki ji kj jm kk jq kl ju km jy ke kf kg kh dt translated">1 megawei / lovelace = 1⁰⁶魏</li><li id="003f" class="jz ka ht jd b je ki ji kj jm kk jq kl ju km jy ke kf kg kh dt translated">1千兆微/香农= 1⁰⁹微</li><li id="6e60" class="jz ka ht jd b je ki ji kj jm kk jq kl ju km jy ke kf kg kh dt translated">1微醚/ szabo = 1⁰魏</li><li id="f394" class="jz ka ht jd b je ki ji kj jm kk jq kl ju km jy ke kf kg kh dt translated">1米利醚/芬尼=1⁰⁵·魏</li><li id="0bd2" class="jz ka ht jd b je ki ji kj jm kk jq kl ju km jy ke kf kg kh dt translated">1乙醚= 1⁰ ⁸魏</li></ul><p id="7ea0" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">燃气成本简单地说就是燃气*燃气价格(单位为魏)。原因是，如果以太坊的交易价格没有与以太本身的价格紧密联系。</p></div><div class="ab cl kn ko hb kp" role="separator"><span class="kq bw bk kr ks kt"/><span class="kq bw bk kr ks kt"/><span class="kq bw bk kr ks"/></div><div class="hm hn ho hp hq"><h2 id="5256" class="ku kv ht bd kw kx ky kz la lb lc ld le jm lf lg lh jq li lj lk ju ll lm ln lo dt translated">以太智能合约之王</h2><p id="9f78" class="pw-post-body-paragraph jb jc ht jd b je lp jg jh ji lq jk jl jm lr jo jp jq ls js jt ju lt jw jx jy hm dt translated">当智能合约耗尽汽油时，事情就可能开始出错。</p><p id="ca7a" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">2016年2月，一款名为“以太之王”的dApp游戏(想想:山中之王，但你要支付比当前最高价格更多的以太才能登顶)提出了一个安全漏洞，允许有人通过欺骗的方式成为国王。</p><p id="9f4c" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">实现这种利用的方式相对简单。首先，一个聪明的合同发送KoTE合同足以成为新的国王，虽然只有2300气(最低)。</p><figure class="lv lw lx ly fq iu fe ff paragraph-image"><div class="fe ff lu"><img src="../Images/8fc4722db6bda5ae6708ceff31a61556.png" data-original-src="https://miro.medium.com/v2/resize:fit:1384/format:webp/1*2lrw1QMofomWUXMoAaOnYQ.png"/></div><figcaption class="lz ma fg fe ff mb mc bd b be z ek">Not from the KoTE contract, just an example of what was going on.</figcaption></figure><p id="7103" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">使用send()的问题是，如果由于没有足够的气体而失败，那么不会抛出错误，代码会继续执行。</p><p id="428d" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">在KoTE的例子中，在一个新国王支付了新的价格成为国王之后，前一个国王将通过send()方法得到补偿。然而，由于没有足够的汽油，前国王失去了他的补偿，新国王被设定在合同中。</p><p id="4834" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">以太坊社区对此的解决方案是支持拉推支付。这实质上意味着，智能合约应该通知钱包/用户，然后收取以太网(提取支付)，而不是直接支付钱包(推送支付)。回到KoTE，一个简单的事件告诉前一任国王他们被出价超过，然后允许他们手动查询智能合同并收取他们的补偿。</p></div><div class="ab cl kn ko hb kp" role="separator"><span class="kq bw bk kr ks kt"/><span class="kq bw bk kr ks kt"/><span class="kq bw bk kr ks"/></div><div class="hm hn ho hp hq"><h2 id="f0c2" class="ku kv ht bd kw kx ky kz la lb lc ld le jm lf lg lh jq li lj lk ju ll lm ln lo dt translated">解决方法</h2><p id="2547" class="pw-post-body-paragraph jb jc ht jd b je lp jg jh ji lq jk jl jm lr jo jp jq ls js jt ju lt jw jx jy hm dt translated">在需要支付多个用户的情况下，支持拉式支付也是非常重要的。许多开发人员倾向于简单地遍历每个需要支付的用户，然后手动支付。然而，正如我们现在所知，如果循环的规模太大，那么智能合约可能会耗尽天然气来执行所有这些支付，导致资金被锁定。</p><p id="d4e9" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">从这种利用中得到的一些关键收获是:</p><ul class=""><li id="4a54" class="jz ka ht jd b je jf ji jj jm kb jq kc ju kd jy ke kf kg kh dt translated">避免使用send()函数，因为它会在出现缺气异常时无声地失败。</li><li id="5d36" class="jz ka ht jd b je ki ji kj jm kk jq kl ju km jy ke kf kg kh dt translated">处理付款时，使用拉而不是推。</li><li id="f722" class="jz ka ht jd b je ki ji kj jm kk jq kl ju km jy ke kf kg kh dt translated">确保开发人员对以太坊虚拟机(运行智能合约的环境)有一个牢固的理解</li><li id="df38" class="jz ka ht jd b je ki ji kj jm kk jq kl ju km jy ke kf kg kh dt translated">不仅要测试契约的代码，还要测试在各种情况下与契约的交互</li></ul></div><div class="ab cl kn ko hb kp" role="separator"><span class="kq bw bk kr ks kt"/><span class="kq bw bk kr ks kt"/><span class="kq bw bk kr ks"/></div><div class="hm hn ho hp hq"><p id="11ab" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">来自一方或多方的外部审计可以防止这种攻击，因为审计是逐行进行的。</p><p id="41b3" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">CanYa未来的Bountysource平台将允许智能合约开发者发布他们的代码，以检查任何安全漏洞。这些检查通常以智能合同审计的形式进行。</p><p id="f108" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">审计包括对整个代码库的逐行注释，突出代码中任何主要和次要的漏洞。此外，还可以编写自动化测试来确保程序按预期运行。</p><p id="a365" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">Bountysource也有很多其他更新正在进行中，比如新的界面和更多的开发路线图功能！</p><blockquote class="md"><p id="172e" class="me mf ht bd mg mh mi mj mk ml mm jy ek translated"><a class="ae mn" href="https://coincodecap.com/?utm_source=coinmonks" rel="noopener ugc nofollow" target="_blank">在您的收件箱中直接获得最佳软件交易</a></p></blockquote><figure class="mp mq mr ms mt iu fe ff paragraph-image"><a href="https://coincodecap.com/?utm_source=coinmonks"><div class="fe ff mo"><img src="../Images/7c0b3dfdcbfea594cc0ae7d4f9bf6fcb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1168/format:webp/0*OJ-qb5G6i863msBB.png"/></div></a></figure></div></div>    
</body>
</html>