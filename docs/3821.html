<html>
<head>
<title>Create and deploy a DeFi App to Ethereum</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">创建一个DeFi应用程序并将其部署到以太坊</h1>
<blockquote>原文：<a href="https://medium.com/coinmonks/create-and-deploy-a-defi-app-to-ethereum-a02bb680aa78?source=collection_archive---------0-----------------------#2020-12-31">https://medium.com/coinmonks/create-and-deploy-a-defi-app-to-ethereum-a02bb680aa78?source=collection_archive---------0-----------------------#2020-12-31</a></blockquote><div><div class="ef hh hi hj hk hl"/><div class="hm hn ho hp hq"><h2 id="95f4" class="hr hs ht bd b gc hu hv hw hx hy hz ek ia translated" aria-label="kicker paragraph">分散金融</h2><div class=""/><div class=""><h2 id="3ba1" class="pw-subtitle-paragraph iz ic ht bd b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq ek translated">将ERC20代币存入智能合同并铸造农场代币</h2></div><figure class="js jt ju jv fq jw fe ff paragraph-image"><div role="button" tabindex="0" class="jx jy di jz bf ka"><div class="fe ff jr"><img src="../Images/dfff9ecc88f3b356dea1b402475ced4f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ULGtG5gGAUYjBtxTO9D5Ew.jpeg"/></div></div><figcaption class="kd ke fg fe ff kf kg bd b be z ek"><a class="ae kh" href="https://pixabay.com/photos/ethereum-cryptocurrency-3818347/" rel="noopener ugc nofollow" target="_blank">Ethereum Cryptocurrency The Value — Free photo on Pixabay</a></figcaption></figure></div><div class="ab cl ki kj hb kk" role="separator"><span class="kl bw bk km kn ko"/><span class="kl bw bk km kn ko"/><span class="kl bw bk km kn"/></div><div class="hm hn ho hp hq"><p id="5afe" class="pw-post-body-paragraph kp kq ht kr b ks kt jd ku kv kw jg kx ky kz la lb lc ld le lf lg lh li lj lk hm dt translated">分散融资在2020年非常受欢迎，并将在未来几年保持增长。它包括分散的金融服务，如分散的交易所(如Uniswap、Curve、Balancer)和分散的借贷(如Aave)。它们是开源的，大部分都是在以太坊上构建的。</p><p id="4c40" class="pw-post-body-paragraph kp kq ht kr b ks kt jd ku kv kw jg kx ky kz la lb lc ld le lf lg lh li lj lk hm dt translated">在本文中，我们将构建一个具有可靠性的DeFi应用程序，用户可以将一个ERC20令牌存入智能合约，智能合约将铸造并向用户转移农场令牌。用户稍后可以通过在智能合同上烧录他们的场令牌来撤回他们的ERC20令牌，ERC20令牌将被转移回给他们。</p></div><div class="ab cl ki kj hb kk" role="separator"><span class="kl bw bk km kn ko"/><span class="kl bw bk km kn ko"/><span class="kl bw bk km kn"/></div><div class="hm hn ho hp hq"><h1 id="dae9" class="ll lm ht bd ln lo lp lq lr ls lt lu lv ji lw jj lx jl ly jm lz jo ma jp mb mc dt translated">安装松露和加纳切</h1><p id="37df" class="pw-post-body-paragraph kp kq ht kr b ks md jd ku kv me jg kx ky mf la lb lc mg le lf lg mh li lj lk hm dt translated">如果这是您第一次编写智能合同，您将需要设置您的环境。我们要用两个工具:<a class="ae kh" href="https://www.trufflesuite.com/" rel="noopener ugc nofollow" target="_blank">松露</a>和<a class="ae kh" href="https://www.trufflesuite.com/ganache" rel="noopener ugc nofollow" target="_blank"> Ganache </a>。</p><p id="0c11" class="pw-post-body-paragraph kp kq ht kr b ks kt jd ku kv kw jg kx ky kz la lb lc ld le lf lg lh li lj lk hm dt translated">Truffle是为以太坊开发智能合约的开发环境和测试框架。有了Truffle，就可以很容易地在区块链建立和部署智能合约。Ganache允许我们创建一个本地以太坊区块链来测试智能合约。它模拟真实网络的功能，前10个帐户由100个测试以太网资助，从而使智能合约部署和测试变得轻松自如。Ganache可以作为桌面应用程序和命令行工具使用。对于本文，我们将使用UI桌面应用程序。</p><figure class="js jt ju jv fq jw fe ff paragraph-image"><div role="button" tabindex="0" class="jx jy di jz bf ka"><div class="fe ff mi"><img src="../Images/025fefde248a7e58d966daa8fcc0a75e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*V1iQ5onbLbT5Ib2QaiOSyg.png"/></div></div><figcaption class="kd ke fg fe ff kf kg bd b be z ek">Ganache UI desktop application</figcaption></figure><p id="8c35" class="pw-post-body-paragraph kp kq ht kr b ks kt jd ku kv kw jg kx ky kz la lb lc ld le lf lg lh li lj lk hm dt translated">要创建项目，请运行以下命令</p><p id="dbb6" class="pw-post-body-paragraph kp kq ht kr b ks kt jd ku kv kw jg kx ky kz la lb lc ld le lf lg lh li lj lk hm dt translated"><code class="eh mj mk ml mm b">mkdir YourProjectName<br/>cd YourProjectName<br/>truffle init</code></p><p id="1580" class="pw-post-body-paragraph kp kq ht kr b ks kt jd ku kv kw jg kx ky kz la lb lc ld le lf lg lh li lj lk hm dt translated">这将为我们的智能合约的开发和部署创建一个空白项目。创建的项目结构如下:</p><ul class=""><li id="d667" class="mn mo ht kr b ks kt kv kw ky mp lc mq lg mr lk ms mt mu mv dt translated"><code class="eh mj mk ml mm b">contracts</code>:solidity智能合约文件夹</li><li id="7944" class="mn mo ht kr b ks mw kv mx ky my lc mz lg na lk ms mt mu mv dt translated"><code class="eh mj mk ml mm b">migrations</code>:部署脚本文件夹</li><li id="e86c" class="mn mo ht kr b ks mw kv mx ky my lc mz lg na lk ms mt mu mv dt translated"><code class="eh mj mk ml mm b">test</code>:测试我们智能合约的文件夹</li><li id="5728" class="mn mo ht kr b ks mw kv mx ky my lc mz lg na lk ms mt mu mv dt translated"><code class="eh mj mk ml mm b">truffle-config.js</code>:松露配置文件</li></ul><h1 id="c58a" class="ll lm ht bd ln lo nb lq lr ls nc lu lv ji nd jj lx jl ne jm lz jo nf jp mb mc dt translated">创建ERC20令牌</h1><p id="6ba2" class="pw-post-body-paragraph kp kq ht kr b ks md jd ku kv me jg kx ky mf la lb lc mg le lf lg mh li lj lk hm dt translated">首先，我们需要创建我们的ERC20令牌，我们将使用它在智能合约上下注。为了创建我们的可替换令牌，我们首先需要安装OpenZeppelin库。该库包含ERC20和ERC721等标准的实现。要安装它，请运行以下命令:</p><p id="e405" class="pw-post-body-paragraph kp kq ht kr b ks kt jd ku kv kw jg kx ky kz la lb lc ld le lf lg lh li lj lk hm dt translated"><code class="eh mj mk ml mm b">npm install @openzeppelin/contracts</code></p><p id="e5ad" class="pw-post-body-paragraph kp kq ht kr b ks kt jd ku kv kw jg kx ky kz la lb lc ld le lf lg lh li lj lk hm dt translated">使用<code class="eh mj mk ml mm b">openzeppelin</code>库，我们可以用下面的solidity代码创建名为<code class="eh mj mk ml mm b">MyToken</code>的ERC20令牌:</p><figure class="js jt ju jv fq jw"><div class="bz el l di"><div class="ng nh l"/></div><figcaption class="kd ke fg fe ff kf kg bd b be z ek">Create our ERC20 token</figcaption></figure><p id="f01b" class="pw-post-body-paragraph kp kq ht kr b ks kt jd ku kv kw jg kx ky kz la lb lc ld le lf lg lh li lj lk hm dt translated">在上面的代码中:</p><ul class=""><li id="bc66" class="mn mo ht kr b ks kt kv kw ky mp lc mq lg mr lk ms mt mu mv dt translated">第3行:我们从包含这个令牌标准实现的<code class="eh mj mk ml mm b">openzeppelin</code>导入契约<code class="eh mj mk ml mm b">ERC20.sol</code>。</li><li id="0302" class="mn mo ht kr b ks mw kv mx ky my lc mz lg na lk ms mt mu mv dt translated">第5行:我们继承了<code class="eh mj mk ml mm b">ERC20.sol</code>契约。</li><li id="8913" class="mn mo ht kr b ks mw kv mx ky my lc mz lg na lk ms mt mu mv dt translated">第6行:我们调用<code class="eh mj mk ml mm b">ERC20.sol</code>构造函数，并将<code class="eh mj mk ml mm b">name</code>和<code class="eh mj mk ml mm b">symbol</code>参数分别作为<code class="eh mj mk ml mm b">"MyToken"</code>和<code class="eh mj mk ml mm b">"MTKN"</code>传递。</li><li id="b3f7" class="mn mo ht kr b ks mw kv mx ky my lc mz lg na lk ms mt mu mv dt translated">第7行:我们为正在部署智能合约的帐户铸造并转移100万个令牌(我们对ERC20令牌使用默认的18位小数，这意味着如果我们要铸造1个令牌，您将把它表示为10000000000000000，1带有18个零)。</li></ul><p id="a176" class="pw-post-body-paragraph kp kq ht kr b ks kt jd ku kv kw jg kx ky kz la lb lc ld le lf lg lh li lj lk hm dt translated">我们可以在下面看到<code class="eh mj mk ml mm b">ERC20.sol</code>构造函数的实现，其中<code class="eh mj mk ml mm b">_decimals</code>字段被设置为18:</p><figure class="js jt ju jv fq jw"><div class="bz el l di"><div class="ng nh l"/></div><figcaption class="kd ke fg fe ff kf kg bd b be z ek">ERC20.sol constructor</figcaption></figure><h1 id="88dc" class="ll lm ht bd ln lo nb lq lr ls nc lu lv ji nd jj lx jl ne jm lz jo nf jp mb mc dt translated">部署ERC20令牌</h1><p id="7ce7" class="pw-post-body-paragraph kp kq ht kr b ks md jd ku kv me jg kx ky mf la lb lc mg le lf lg mh li lj lk hm dt translated">在<code class="eh mj mk ml mm b">migrations</code>文件夹中，创建一个名为<code class="eh mj mk ml mm b">2_deploy_Tokens.js</code>的文件。这个文件是我们部署ERC20令牌和FarmToken智能合约的地方。下面的代码用于部署我们的<code class="eh mj mk ml mm b">MyToken.sol</code>合同:</p><figure class="js jt ju jv fq jw"><div class="bz el l di"><div class="ng nh l"/></div><figcaption class="kd ke fg fe ff kf kg bd b be z ek">Deploy ERC20 token</figcaption></figure><p id="4d80" class="pw-post-body-paragraph kp kq ht kr b ks kt jd ku kv kw jg kx ky kz la lb lc ld le lf lg lh li lj lk hm dt translated">为了编译我们的智能契约，我们必须首先检查我们的solidity编译器版本。您可以通过运行以下命令进行检查:</p><p id="2a21" class="pw-post-body-paragraph kp kq ht kr b ks kt jd ku kv kw jg kx ky kz la lb lc ld le lf lg lh li lj lk hm dt translated"><code class="eh mj mk ml mm b">truffle version</code></p><p id="8414" class="pw-post-body-paragraph kp kq ht kr b ks kt jd ku kv kw jg kx ky kz la lb lc ld le lf lg lh li lj lk hm dt translated">默认版本是<code class="eh mj mk ml mm b">Solidity v0.5.16</code>。由于我们的令牌是使用solidity版本<code class="eh mj mk ml mm b">0.6.2</code>编写的，如果我们运行命令来编译我们的契约，我们将会得到一个编译器错误。为了指定使用哪个solidity编译器版本，转到文件<code class="eh mj mk ml mm b">truffle-config.js</code>并设置所需的编译器版本，如下所示:</p><figure class="js jt ju jv fq jw"><div class="bz el l di"><div class="ng nh l"/></div><figcaption class="kd ke fg fe ff kf kg bd b be z ek">truffle-config.js</figcaption></figure><p id="cc2a" class="pw-post-body-paragraph kp kq ht kr b ks kt jd ku kv kw jg kx ky kz la lb lc ld le lf lg lh li lj lk hm dt translated">现在，我们可以通过运行以下命令来编译我们的智能合约:</p><p id="cbaf" class="pw-post-body-paragraph kp kq ht kr b ks kt jd ku kv kw jg kx ky kz la lb lc ld le lf lg lh li lj lk hm dt translated"><code class="eh mj mk ml mm b">truffle compile</code></p><p id="346e" class="pw-post-body-paragraph kp kq ht kr b ks kt jd ku kv kw jg kx ky kz la lb lc ld le lf lg lh li lj lk hm dt translated">编译之后，我们现在可以部署令牌了。为此，打开Ganache并选择“快速启动”选项来启动本地以太坊区块链。要部署我们的合同，请运行:</p><p id="2a02" class="pw-post-body-paragraph kp kq ht kr b ks kt jd ku kv kw jg kx ky kz la lb lc ld le lf lg lh li lj lk hm dt translated"><code class="eh mj mk ml mm b">truffle migrate</code></p><p id="57f4" class="pw-post-body-paragraph kp kq ht kr b ks kt jd ku kv kw jg kx ky kz la lb lc ld le lf lg lh li lj lk hm dt translated">用于部署我们的合同的地址是Ganache向我们显示的地址列表中的第一个地址。为了验证这一点，我们可以打开Ganache桌面应用程序，我们可以验证第一个帐户的以太网余额已经减少，这是由于部署我们的智能合同的以太网成本:</p><figure class="js jt ju jv fq jw fe ff paragraph-image"><div role="button" tabindex="0" class="jx jy di jz bf ka"><div class="fe ff ni"><img src="../Images/148bdc6b034e56ab4c8f3f734b699f02.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1iJ9VRlyLuza58HL3DLfpg.png"/></div></div><figcaption class="kd ke fg fe ff kf kg bd b be z ek">Ganache desktop application</figcaption></figure><p id="3cc1" class="pw-post-body-paragraph kp kq ht kr b ks kt jd ku kv kw jg kx ky kz la lb lc ld le lf lg lh li lj lk hm dt translated">为了验证100万个<code class="eh mj mk ml mm b">MyToken</code>令牌已经被发送到部署者地址，我们可以使用Truffle控制台与我们部署的智能契约进行交互。</p><blockquote class="nj nk nl"><p id="e6b3" class="kp kq nm kr b ks kt jd ku kv kw jg kx nn kz la lb no ld le lf np lh li lj lk hm dt translated"><a class="ae kh" href="https://www.trufflesuite.com/docs/truffle/getting-started/using-truffle-develop-and-the-console" rel="noopener ugc nofollow" target="_blank"> Truffle控制台是一个基本的交互式控制台，可以连接到任何以太坊客户端。</a></p></blockquote><p id="85f2" class="pw-post-body-paragraph kp kq ht kr b ks kt jd ku kv kw jg kx ky kz la lb lc ld le lf lg lh li lj lk hm dt translated">为了与我们的智能合同进行交互，请运行以下命令:</p><p id="5be4" class="pw-post-body-paragraph kp kq ht kr b ks kt jd ku kv kw jg kx ky kz la lb lc ld le lf lg lh li lj lk hm dt translated"><code class="eh mj mk ml mm b">truffle console</code></p><p id="e7b4" class="pw-post-body-paragraph kp kq ht kr b ks kt jd ku kv kw jg kx ky kz la lb lc ld le lf lg lh li lj lk hm dt translated">现在，我们可以在终端中编写以下命令:</p><ul class=""><li id="a95e" class="mn mo ht kr b ks kt kv kw ky mp lc mq lg mr lk ms mt mu mv dt translated">获取智能合约:<code class="eh mj mk ml mm b">myToken = await MyToken.deployed()</code></li><li id="70dd" class="mn mo ht kr b ks mw kv mx ky my lc mz lg na lk ms mt mu mv dt translated">从加纳切:<code class="eh mj mk ml mm b">accounts = await web3.eth.getAccounts()</code>获取账户数组</li><li id="54b7" class="mn mo ht kr b ks mw kv mx ky my lc mz lg na lk ms mt mu mv dt translated">获取第一个账户的余额:<code class="eh mj mk ml mm b">balance = await myToken.balanceOf(accounts[0])</code></li><li id="1ae4" class="mn mo ht kr b ks mw kv mx ky my lc mz lg na lk ms mt mu mv dt translated">从18位小数格式化余额:<code class="eh mj mk ml mm b">web3.utils.fromWei(balance.toString())</code></li></ul><p id="ed08" class="pw-post-body-paragraph kp kq ht kr b ks kt jd ku kv kw jg kx ky kz la lb lc ld le lf lg lh li lj lk hm dt translated">通过运行上面的命令，我们将看到第一个地址实际上有一百万个MyTokens:</p><figure class="js jt ju jv fq jw fe ff paragraph-image"><div class="fe ff nq"><img src="../Images/1a58a5458448d10920cb1ca5b1db3a28.png" data-original-src="https://miro.medium.com/v2/resize:fit:1034/format:webp/1*AQlj9A7dw-qtY4QAD3Bpxw.png"/></div><figcaption class="kd ke fg fe ff kf kg bd b be z ek">First address has 1000000 MyTokens</figcaption></figure><h1 id="3a05" class="ll lm ht bd ln lo nb lq lr ls nc lu lv ji nd jj lx jl ne jm lz jo nf jp mb mc dt translated">创建FarmToken智能合同</h1><p id="0d84" class="pw-post-body-paragraph kp kq ht kr b ks md jd ku kv me jg kx ky mf la lb lc mg le lf lg mh li lj lk hm dt translated">FarmToken智能合约将有3个功能:</p><ul class=""><li id="4a7e" class="mn mo ht kr b ks kt kv kw ky mp lc mq lg mr lk ms mt mu mv dt translated"><code class="eh mj mk ml mm b">balance()</code>:获取FarmToken智能合约上的MyToken余额。</li><li id="b7c3" class="mn mo ht kr b ks mw kv mx ky my lc mz lg na lk ms mt mu mv dt translated"><code class="eh mj mk ml mm b">deposit(uint256 _amount)</code>:代表用户将MyToken转移到FarmToken智能合约，然后创建并转移FarmToken给用户。</li><li id="ec91" class="mn mo ht kr b ks mw kv mx ky my lc mz lg na lk ms mt mu mv dt translated"><code class="eh mj mk ml mm b">withdraw(uint256 _amount)</code>:刻录用户的FarmTokens，将MyTokens转移到用户的地址。</li></ul><p id="f79b" class="pw-post-body-paragraph kp kq ht kr b ks kt jd ku kv kw jg kx ky kz la lb lc ld le lf lg lh li lj lk hm dt translated">让我们看看FarmToken构造函数:</p><figure class="js jt ju jv fq jw"><div class="bz el l di"><div class="ng nh l"/></div><figcaption class="kd ke fg fe ff kf kg bd b be z ek">FarmToken.sol</figcaption></figure><ul class=""><li id="c0e0" class="mn mo ht kr b ks kt kv kw ky mp lc mq lg mr lk ms mt mu mv dt translated">第3–6行:我们正在从openzeppelin导入以下合同:<code class="eh mj mk ml mm b">IERC20.sol</code>、<code class="eh mj mk ml mm b">Address.sol</code>、<code class="eh mj mk ml mm b">SafeERC20.sol</code>和<code class="eh mj mk ml mm b">ERC20.sol</code>。</li><li id="a336" class="mn mo ht kr b ks mw kv mx ky my lc mz lg na lk ms mt mu mv dt translated">第8行:FarmToken将从ERC20契约继承。</li><li id="a122" class="mn mo ht kr b ks mw kv mx ky my lc mz lg na lk ms mt mu mv dt translated">第14–19行:FarmToken构造函数将接收MyToken契约的地址作为参数，我们将把它的契约赋给我们的公共变量<code class="eh mj mk ml mm b">token</code>。</li></ul><p id="aa6d" class="pw-post-body-paragraph kp kq ht kr b ks kt jd ku kv kw jg kx ky kz la lb lc ld le lf lg lh li lj lk hm dt translated">让我们实现<code class="eh mj mk ml mm b">balance()</code>函数。它将不会接收任何参数，并将返回这个智能合约上MyToken的余额。它的实现如下所示:</p><figure class="js jt ju jv fq jw"><div class="bz el l di"><div class="ng nh l"/></div><figcaption class="kd ke fg fe ff kf kg bd b be z ek">balance function</figcaption></figure><p id="2eb2" class="pw-post-body-paragraph kp kq ht kr b ks kt jd ku kv kw jg kx ky kz la lb lc ld le lf lg lh li lj lk hm dt translated">对于<code class="eh mj mk ml mm b">deposit(uint256 _amount)</code>函数，它将接收用户想要存入的金额作为参数，并且它将铸造和转移FarmTokens给用户:</p><figure class="js jt ju jv fq jw"><div class="bz el l di"><div class="ng nh l"/></div><figcaption class="kd ke fg fe ff kf kg bd b be z ek">deposit function</figcaption></figure><p id="94e6" class="pw-post-body-paragraph kp kq ht kr b ks kt jd ku kv kw jg kx ky kz la lb lc ld le lf lg lh li lj lk hm dt translated">对于<code class="eh mj mk ml mm b">withdraw(uint256 _amount)</code>函数，我们将接收用户想要刻录的FarmTokens数量作为参数，然后将相同数量的MyTokens传输回用户:</p><figure class="js jt ju jv fq jw"><div class="bz el l di"><div class="ng nh l"/></div><figcaption class="kd ke fg fe ff kf kg bd b be z ek">withdraw function</figcaption></figure><p id="f31c" class="pw-post-body-paragraph kp kq ht kr b ks kt jd ku kv kw jg kx ky kz la lb lc ld le lf lg lh li lj lk hm dt translated">现在，我们将部署我们的智能合约。为此，我们将返回到文件<code class="eh mj mk ml mm b">2_deploy_Tokens.js</code>并添加要部署的新合同:</p><figure class="js jt ju jv fq jw"><div class="bz el l di"><div class="ng nh l"/></div><figcaption class="kd ke fg fe ff kf kg bd b be z ek">2_deploy_MyTokenAndFarmToken.js</figcaption></figure><p id="36b6" class="pw-post-body-paragraph kp kq ht kr b ks kt jd ku kv kw jg kx ky kz la lb lc ld le lf lg lh li lj lk hm dt translated">注意，在部署FarmToken时，我们将已部署的MyToken契约的地址作为参数传递。</p><p id="ee9d" class="pw-post-body-paragraph kp kq ht kr b ks kt jd ku kv kw jg kx ky kz la lb lc ld le lf lg lh li lj lk hm dt translated">现在，运行<code class="eh mj mk ml mm b">truffle compile</code>和<code class="eh mj mk ml mm b">truffle migrate</code>来部署我们的合同。</p><p id="2b47" class="pw-post-body-paragraph kp kq ht kr b ks kt jd ku kv kw jg kx ky kz la lb lc ld le lf lg lh li lj lk hm dt translated">让我们测试我们的智能合约。我们将创建一个脚本来自动化这个过程，而不是使用<code class="eh mj mk ml mm b">truffle console</code>来与我们的智能合同进行交互。创建一个名为<code class="eh mj mk ml mm b">scripts</code>的文件夹，并添加下面的文件<code class="eh mj mk ml mm b">getMyTokenBalance.js</code>。它将检查FarmToken智能合约上MyTokens的余额:</p><figure class="js jt ju jv fq jw"><div class="bz el l di"><div class="ng nh l"/></div><figcaption class="kd ke fg fe ff kf kg bd b be z ek"><code class="eh mj mk ml mm b">getMyTokenBalance.js</code></figcaption></figure><p id="8cec" class="pw-post-body-paragraph kp kq ht kr b ks kt jd ku kv kw jg kx ky kz la lb lc ld le lf lg lh li lj lk hm dt translated">要执行此脚本，请运行以下cli命令:</p><p id="5c85" class="pw-post-body-paragraph kp kq ht kr b ks kt jd ku kv kw jg kx ky kz la lb lc ld le lf lg lh li lj lk hm dt translated"><code class="eh mj mk ml mm b">truffle exec .\scripts\getMyTokenBalance.js</code></p><p id="ea6e" class="pw-post-body-paragraph kp kq ht kr b ks kt jd ku kv kw jg kx ky kz la lb lc ld le lf lg lh li lj lk hm dt translated">我们将得到预期的结果，即0。</p><p id="d9a9" class="pw-post-body-paragraph kp kq ht kr b ks kt jd ku kv kw jg kx ky kz la lb lc ld le lf lg lh li lj lk hm dt translated">现在，让我们将MyToken与智能合约关联起来。因为函数<code class="eh mj mk ml mm b">deposit(uint256 _amount)</code>从ERC20调用函数<code class="eh mj mk ml mm b">safeTransferFrom</code>，所以用户必须首先批准智能合约以代表用户传输MyToken。因此，在下面的脚本中，我们将首先批准这一步骤，然后调用函数:</p><figure class="js jt ju jv fq jw"><div class="bz el l di"><div class="ng nh l"/></div><figcaption class="kd ke fg fe ff kf kg bd b be z ek">transferMyTokenToFarmToken.js</figcaption></figure><p id="f24e" class="pw-post-body-paragraph kp kq ht kr b ks kt jd ku kv kw jg kx ky kz la lb lc ld le lf lg lh li lj lk hm dt translated">要运行这个脚本:<code class="eh mj mk ml mm b">truffle exec .\scripts\transferMyTokenToFarmToken.js</code>。您应该在控制台上看到:</p><figure class="js jt ju jv fq jw fe ff paragraph-image"><div class="fe ff nr"><img src="../Images/16b18b7a0886cd6ceb12339809221100.png" data-original-src="https://miro.medium.com/v2/resize:fit:784/format:webp/1*MoekE2QCw7vB98u5dl7ang.png"/></div><figcaption class="kd ke fg fe ff kf kg bd b be z ek">output of <code class="eh mj mk ml mm b">transferMyTokenToFarmToken.js</code></figcaption></figure><p id="49f3" class="pw-post-body-paragraph kp kq ht kr b ks kt jd ku kv kw jg kx ky kz la lb lc ld le lf lg lh li lj lk hm dt translated">正如我们所看到的，我们已经成功地将MyTokens存放到智能合约中，因为第一个帐户现在有了FarmTokens。</p><p id="6392" class="pw-post-body-paragraph kp kq ht kr b ks kt jd ku kv kw jg kx ky kz la lb lc ld le lf lg lh li lj lk hm dt translated">为了退出:</p><figure class="js jt ju jv fq jw"><div class="bz el l di"><div class="ng nh l"/></div><figcaption class="kd ke fg fe ff kf kg bd b be z ek">withdrawMyTokenFromTokenFarm.js</figcaption></figure><p id="5542" class="pw-post-body-paragraph kp kq ht kr b ks kt jd ku kv kw jg kx ky kz la lb lc ld le lf lg lh li lj lk hm dt translated">要运行这个脚本:<code class="eh mj mk ml mm b">truffle exec .\scripts\withdrawMyTokenFromTokenFarm.js</code>。正如我们在下面的输出中看到的，我们成功地取回了MyTokens，并烧毁了FarmTokens:</p><figure class="js jt ju jv fq jw fe ff paragraph-image"><div role="button" tabindex="0" class="jx jy di jz bf ka"><div class="fe ff ns"><img src="../Images/16b49a053c7d5195ffb1e11279076a91.png" data-original-src="https://miro.medium.com/v2/resize:fit:766/format:webp/1*jHYlTFg0NgGbhASpsRvc0w.png"/></div></div><figcaption class="kd ke fg fe ff kf kg bd b be z ek">output of withdrawMyTokenFromTokenFarm.js</figcaption></figure><h1 id="e5ef" class="ll lm ht bd ln lo nb lq lr ls nc lu lv ji nd jj lx jl ne jm lz jo nf jp mb mc dt translated">结论</h1><p id="09cb" class="pw-post-body-paragraph kp kq ht kr b ks md jd ku kv me jg kx ky mf la lb lc mg le lf lg mh li lj lk hm dt translated">在本文中，我们用Truffle和Ganache设置了我们的开发环境，并创建了一个DeFi应用程序，用户可以在其中存放my token并获取farm token，并且可以通过烧毁他们的farm token来收回my token。</p><p id="73bf" class="pw-post-body-paragraph kp kq ht kr b ks kt jd ku kv kw jg kx ky kz la lb lc ld le lf lg lh li lj lk hm dt translated">如果你有兴趣了解更多关于DeFi的知识，下面的参考资料部分有一些关于这个主题的有趣文章。</p><p id="cd5b" class="pw-post-body-paragraph kp kq ht kr b ks kt jd ku kv kw jg kx ky kz la lb lc ld le lf lg lh li lj lk hm dt translated">下面的GitHub repo提供了所有这些代码:</p><p id="0975" class="pw-post-body-paragraph kp kq ht kr b ks kt jd ku kv kw jg kx ky kz la lb lc ld le lf lg lh li lj lk hm dt translated"><a class="ae kh" href="https://github.com/strykerin/DeFi-Token-Farm" rel="noopener ugc nofollow" target="_blank">strykerin/DeFi-Token-Farm(github.com)</a></p><h1 id="21c2" class="ll lm ht bd ln lo nb lq lr ls nc lu lv ji nd jj lx jl ne jm lz jo nf jp mb mc dt translated">参考</h1><p id="cc7f" class="pw-post-body-paragraph kp kq ht kr b ks md jd ku kv me jg kx ky mf la lb lc mg le lf lg mh li lj lk hm dt translated"><a class="ae kh" href="https://docs.openzeppelin.com/contracts/3.x/" rel="noopener ugc nofollow" target="_blank">合同— OpenZeppelin文档</a></p><p id="122f" class="pw-post-body-paragraph kp kq ht kr b ks kt jd ku kv kw jg kx ky kz la lb lc ld le lf lg lh li lj lk hm dt translated"><a class="ae kh" href="https://www.trufflesuite.com/" rel="noopener ugc nofollow" target="_blank">智能合约的甜蜜工具| Truffle套件</a></p><p id="2131" class="pw-post-body-paragraph kp kq ht kr b ks kt jd ku kv kw jg kx ky kz la lb lc ld le lf lg lh li lj lk hm dt translated"><a class="ae kh" href="https://www.trufflesuite.com/ganache" rel="noopener ugc nofollow" target="_blank">加纳切|松露组曲</a></p><p id="5d5a" class="pw-post-body-paragraph kp kq ht kr b ks kt jd ku kv kw jg kx ky kz la lb lc ld le lf lg lh li lj lk hm dt translated"><a class="ae kh" href="https://99bitcoins.com/what-is-defi/" rel="noopener ugc nofollow" target="_blank">什么是DeFi？初学者指南(2021年更新)</a></p><p id="bd95" class="pw-post-body-paragraph kp kq ht kr b ks kt jd ku kv kw jg kx ky kz la lb lc ld le lf lg lh li lj lk hm dt translated"><a class="ae kh" href="https://defipulse.com/" rel="noopener ugc nofollow" target="_blank">DeFi——DeFi Pulse的分散财务排行榜</a></p><h2 id="6ff6" class="nt lm ht bd ln nu nv nw lr nx ny nz lv ky oa ob lx lc oc od lz lg oe of mb hz dt translated">另外，阅读</h2><ul class=""><li id="6ed0" class="mn mo ht kr b ks md kv me ky og lc oh lg oi lk ms mt mu mv dt translated"><a class="ae kh" href="http://blog.coincodecap.com/go/learn" rel="noopener ugc nofollow" target="_blank">学习以太坊和Web3开发</a></li><li id="259b" class="mn mo ht kr b ks mw kv mx ky my lc mz lg na lk ms mt mu mv dt translated">最好的<a class="ae kh" rel="noopener" href="/coinmonks/crypto-trading-bot-c2ffce8acb2a">密码交易机器人</a></li><li id="5241" class="mn mo ht kr b ks mw kv mx ky my lc mz lg na lk ms mt mu mv dt translated"><a class="ae kh" rel="noopener" href="/coinmonks/3commas-review-an-excellent-crypto-trading-bot-2020-1313a58bec92">3商业评论</a></li><li id="2850" class="mn mo ht kr b ks mw kv mx ky my lc mz lg na lk ms mt mu mv dt translated"><a class="ae kh" rel="noopener" href="/coinmonks/pionex-review-exchange-with-crypto-trading-bot-1e459d0191ea"> Pionex回顾</a></li><li id="25b2" class="mn mo ht kr b ks mw kv mx ky my lc mz lg na lk ms mt mu mv dt translated"><a class="ae kh" rel="noopener" href="/coinmonks/aax-exchange-review-2021-67c5ea09330c"> AAX交易所评论</a> |推荐代码、交易费用、利弊</li><li id="ab2a" class="mn mo ht kr b ks mw kv mx ky my lc mz lg na lk ms mt mu mv dt translated"><a class="ae kh" rel="noopener" href="/coinmonks/deribit-review-options-fees-apis-and-testnet-2ca16c4bbdb2"> Deribit审查</a> |选项、费用、API和Testnet</li><li id="6778" class="mn mo ht kr b ks mw kv mx ky my lc mz lg na lk ms mt mu mv dt translated"><a class="ae kh" rel="noopener" href="/coinmonks/ftx-crypto-exchange-review-53664ac1198f"> FTX密码交易所评论</a></li><li id="1a62" class="mn mo ht kr b ks mw kv mx ky my lc mz lg na lk ms mt mu mv dt translated"><a class="ae kh" rel="noopener" href="/coinmonks/ngrave-zero-review-c465cf8307fc">n零审核</a></li><li id="a108" class="mn mo ht kr b ks mw kv mx ky my lc mz lg na lk ms mt mu mv dt translated"><a class="ae kh" rel="noopener" href="/coinmonks/bybit-exchange-review-dbd570019b71"> Bybit交换审查</a></li><li id="cfc6" class="mn mo ht kr b ks mw kv mx ky my lc mz lg na lk ms mt mu mv dt translated"><a class="ae kh" rel="noopener" href="/coinmonks/3commas-vs-pionex-vs-cryptohopper-best-crypto-bot-6a98d2baa203"> 3Commas vs Cryptohopper </a></li><li id="51e2" class="mn mo ht kr b ks mw kv mx ky my lc mz lg na lk ms mt mu mv dt translated">最好的比特币<a class="ae kh" rel="noopener" href="/coinmonks/the-best-cryptocurrency-hardware-wallets-of-2020-e28b1c124069?source=friends_link&amp;sk=324dd9ff8556ab578d71e7ad7658ad7c">硬件钱包</a></li><li id="4268" class="mn mo ht kr b ks mw kv mx ky my lc mz lg na lk ms mt mu mv dt translated"><a class="ae kh" rel="noopener" href="/coinmonks/top-10-crypto-copy-trading-platforms-for-beginners-d0c37c7d698c">密码本交易平台</a></li><li id="8fd1" class="mn mo ht kr b ks mw kv mx ky my lc mz lg na lk ms mt mu mv dt translated">最佳<a class="ae kh" href="https://blog.coincodecap.com/best-monero-wallets" rel="noopener ugc nofollow" target="_blank"> monero钱包</a></li><li id="5d5d" class="mn mo ht kr b ks mw kv mx ky my lc mz lg na lk ms mt mu mv dt translated"><a class="ae kh" href="https://blog.coincodecap.com/ledger-nano-s-vs-x" rel="noopener ugc nofollow" target="_blank">莱杰纳米s vs x </a></li><li id="5243" class="mn mo ht kr b ks mw kv mx ky my lc mz lg na lk ms mt mu mv dt translated"><a class="ae kh" href="https://blog.coincodecap.com/bitsgap-3commas-quadency" rel="noopener ugc nofollow" target="_blank">bits gap vs 3 commas vs quad ency</a></li><li id="69bb" class="mn mo ht kr b ks mw kv mx ky my lc mz lg na lk ms mt mu mv dt translated">最好的<a class="ae kh" rel="noopener" href="/coinmonks/best-crypto-tax-tool-for-my-money-72d4b430816b">加密税务软件</a></li><li id="7c4f" class="mn mo ht kr b ks mw kv mx ky my lc mz lg na lk ms mt mu mv dt translated"><a class="ae kh" rel="noopener" href="/coinmonks/the-best-crypto-trading-platforms-in-2020-the-definitive-guide-updated-c72f8b874555">最佳加密交易平台</a></li><li id="85de" class="mn mo ht kr b ks mw kv mx ky my lc mz lg na lk ms mt mu mv dt translated">最佳<a class="ae kh" rel="noopener" href="/coinmonks/top-5-crypto-lending-platforms-in-2020-that-you-need-to-know-a1b675cec3fa">加密贷款平台</a></li><li id="ab33" class="mn mo ht kr b ks mw kv mx ky my lc mz lg na lk ms mt mu mv dt translated"><a class="ae kh" href="https://blog.coincodecap.com/ledger-nano-s-vs-trezor-one-ledger-nano-x-trezor-t" rel="noopener ugc nofollow" target="_blank">莱杰纳米S vs特雷佐one vs特雷佐T vs莱杰纳米X </a></li><li id="9efe" class="mn mo ht kr b ks mw kv mx ky my lc mz lg na lk ms mt mu mv dt translated"><a class="ae kh" rel="noopener" href="/coinmonks/blockfi-vs-celsius-vs-hodlnaut-8a1cc8c26630">block fi vs Celsius</a>vs Hodlnaut</li><li id="1dc3" class="mn mo ht kr b ks mw kv mx ky my lc mz lg na lk ms mt mu mv dt translated">Bitsgap评论——一个轻松赚钱的加密交易机器人</li><li id="2401" class="mn mo ht kr b ks mw kv mx ky my lc mz lg na lk ms mt mu mv dt translated"><a class="ae kh" rel="noopener" href="/coinmonks/quadency-review-a-crypto-trading-automation-platform-3068eaa374e1"> Quadency Review </a> -为专业人士打造的加密交易机器人</li><li id="2791" class="mn mo ht kr b ks mw kv mx ky my lc mz lg na lk ms mt mu mv dt translated"><a class="ae kh" rel="noopener" href="/coinmonks/primexbt-review-88e0815be858"> PrimeXBT评论</a> |杠杆交易、费用和交易</li><li id="4fc4" class="mn mo ht kr b ks mw kv mx ky my lc mz lg na lk ms mt mu mv dt translated"><a class="ae kh" href="https://blog.coincodecap.com/altrady-reivew" rel="noopener ugc nofollow" target="_blank">alt ready审查</a></li><li id="eb27" class="mn mo ht kr b ks mw kv mx ky my lc mz lg na lk ms mt mu mv dt translated"><a class="ae kh" rel="noopener" href="/coinmonks/ellipal-titan-review-85e9071dd029">埃利帕尔泰坦评论</a></li><li id="dc32" class="mn mo ht kr b ks mw kv mx ky my lc mz lg na lk ms mt mu mv dt translated"><a class="ae kh" href="https://blog.coincodecap.com/secux-stone-hardware-wallet-review" rel="noopener ugc nofollow" target="_blank"> SecuX Stone评论</a></li><li id="5279" class="mn mo ht kr b ks mw kv mx ky my lc mz lg na lk ms mt mu mv dt translated"><a class="ae kh" rel="noopener" href="/coinmonks/blockfi-review-53096053c097"> BlockFi评论</a> |赚取高达8.6%的加密利息</li><li id="6e2e" class="mn mo ht kr b ks mw kv mx ky my lc mz lg na lk ms mt mu mv dt translated"><a class="ae kh" href="https://blog.coincodecap.com/coinrule-review-a-perfect-trading-bot" rel="noopener ugc nofollow" target="_blank">共同规则审查</a></li><li id="6a8a" class="mn mo ht kr b ks mw kv mx ky my lc mz lg na lk ms mt mu mv dt translated"><a class="ae kh" href="https://bitquery.io/blog/best-blockchain-analysis-tools-and-software" rel="noopener ugc nofollow" target="_blank">最佳区块链分析工具</a></li><li id="b037" class="mn mo ht kr b ks mw kv mx ky my lc mz lg na lk ms mt mu mv dt translated"><a class="ae kh" rel="noopener" href="/coinmonks/crypto-arbitrage-guide-how-to-make-money-as-a-beginner-62bfe5c868f6">加密套利</a>指南:新手如何赚钱</li><li id="b46f" class="mn mo ht kr b ks mw kv mx ky my lc mz lg na lk ms mt mu mv dt translated">最佳加密制图工具</li><li id="ef45" class="mn mo ht kr b ks mw kv mx ky my lc mz lg na lk ms mt mu mv dt translated">了解比特币的<a class="ae kh" rel="noopener" href="/coinmonks/what-are-the-best-books-to-learn-bitcoin-409aeb9aff4b">最佳书籍有哪些？</a></li></ul><blockquote class="oj"><p id="b751" class="ok ol ht bd om on oo op oq or os lk ek translated"><a class="ae kh" rel="noopener" href="/coinmonks/newsletters/coinmonks">直接在您的收件箱中获得最佳软件交易</a></p></blockquote><figure class="ou ov ow ox oy jw fe ff paragraph-image"><a href="https://medium.com/coinmonks/newsletters/coinmonks"><div class="fe ff ot"><img src="../Images/160ce73bd06d46c2250251e7d5969f9d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1168/format:webp/1*BoDnKUyK8p4hitHAJZ5Pdw.png"/></div></a></figure></div></div>    
</body>
</html>