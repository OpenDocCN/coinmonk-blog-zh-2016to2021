<html>
<head>
<title>Misadventures in React with Ethereum</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">与以太坊反应中的不幸</h1>
<blockquote>原文：<a href="https://medium.com/coinmonks/misadventures-in-react-with-ethereum-7ab3d4ee1af6?source=collection_archive---------7-----------------------#2018-04-14">https://medium.com/coinmonks/misadventures-in-react-with-ethereum-7ab3d4ee1af6?source=collection_archive---------7-----------------------#2018-04-14</a></blockquote><div><div class="ef hh hi hj hk hl"/><div class="hm hn ho hp hq"><div class=""/><p id="c524" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">天啊，我讨厌Javascript！25年前我开始学习的第一门语言是基于<a class="ae jo" href="https://en.wikipedia.org/wiki/Commodore_Plus/4" rel="noopener ugc nofollow" target="_blank"> Commodore Plus </a> /4的，后来我升级到了Amstrad CPC 6128。然后在大学我学了Pascal和汇编，最后在大学学了C和C++。</p><p id="7ac6" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">我这么说，是因为我是一个80和90年代的孩子，这都是关于过程语言和面向对象语言的——这也是我如何从本质上学会编写软件的方法。这些年来，我已经学会了Python、Perl和Ruby(Ruby on Rails的忠实粉丝)等等。</p><p id="ac16" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">当我开始为我的机器学习工作编写ETL工具时，我尝试了Javascript(准确地说，不是我在90年代/90年代在HTML页面中使用的一些蹩脚的JS ),并且几乎把<a class="ae jo" href="https://www.toptal.com/nodejs/top-10-common-nodejs-developer-mistakes" rel="noopener ugc nofollow" target="_blank">列为Node.js开发人员</a>犯的10个最常见的错误，我自己也添加了一些。</p><p id="b7e0" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">作为一名程序员，我很差劲，但我热爱制造东西，修理东西，把机器推得越远越好；所以我破解代码，复制粘贴，然后我<a class="ae jo" href="http://rea.tech/getting-shit-done/" rel="noopener ugc nofollow" target="_blank">把事情做完</a>。我是技术债务先生，我为此感到羞耻——20年来，我内心深处一直想成为一名leet程序员，但我的大脑并不是这样工作的。作为一名架构师，我的职业生涯主要是在开发人员和业务的交叉点上，现在我是微软开源项目的技术主管。我是一个系统人员，我在设计时着眼于大局，但我明白事情在幕后是如何运作的。</p><p id="0ba6" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">我强调这一点，因为它正在侵蚀我。我看到漂亮的代码(我知道代码中的漂亮是什么样子)，我希望能够那样想，那样做。我可以和开发人员交流，我们可以一起设计伟大的系统，但是他们的技能让我感到困惑。</p><p id="e5ef" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">所以我用了几周前我拼凑的东西作为内联Javascript和一些ETL等等。我可以想象出区块链以太坊。</p><figure class="jp jq jr js fq jt"><div class="bz el l di"><div class="ju jv l"/></div></figure><p id="1339" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">我对我几个小时的工作印象深刻，并认为这是一个完美的兼职项目，使这成为一项服务，不只是完成狗屎，而是做好它。</p><p id="06a1" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">我第一次遇到Angular时，内心和外部都在哭泣，因为整个事情对我来说是多么完全陌生。我问了一些非常有能力的开发人员，我是否应该考虑Angular、Vue或React来解决这个问题，除了一些“Vue是未来”的评论之外，响亮的回答是React。我喜欢这个答案，因为这也意味着如果我想为移动设备编写代码，我可以使用React Native(在过去的生活中，我为我的IOS和Android应用程序使用了<a class="ae jo" href="https://www.appcelerator.com/" rel="noopener ugc nofollow" target="_blank"> Appcelerator </a>)。</p><p id="546c" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">在微软，我们订阅了Safari在线图书，我开始在React上尽可能多地阅读。O'Reilly的书<a class="ae jo" href="http://shop.oreilly.com/product/0636920049579.do" rel="noopener ugc nofollow" target="_blank"> Learning React </a>是迄今为止帮助最大的一本书，因为它很早就推动你理解函数式编程。</p><p id="2660" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">我不得不承认，当我听到人们谈论FP的时候，我还以为他们谈论的是程序和事情。我现在意识到我是多么的错误，并且仍然对“胖箭头”语法，为什么FP更好，以及——有太多的事情让我对整个情况感到困惑。但是我明白它帮助我成为一个更好的程序员，我感觉如果我能理解这一点，我将成为一个更好的软件设计师。我将不再复制粘贴，我将不再满足于完成任务。</p></div><div class="ab cl jw jx hb jy" role="separator"><span class="jz bw bk ka kb kc"/><span class="jz bw bk ka kb kc"/><span class="jz bw bk ka kb"/></div><div class="hm hn ho hp hq"><p id="7217" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">我从高层次上了解到。就像Angular做的一样，React允许我将我的应用组件化，这样我就可以有谨慎的元素来工作。</p><p id="3cb5" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">我意识到这是有价值的，因为我最初在以太坊可视化器上的工作很快就变成了一团混乱的Javascript函数意大利面条，而且漏洞百出，以至于我不愿意把它推到我的<a class="ae jo" href="https://github.com/justindavies/VisualiseEthereum" rel="noopener ugc nofollow" target="_blank"> GitHub repo </a>上，但我做到了。你可以在<a class="ae jo" href="http://inkl.in" rel="noopener ugc nofollow" target="_blank"> http://inkl.in </a>看到它的下一个版本。我说“实时”是因为它是相同的代码，每个以太坊块都有不同的JSON文件中的力图可视化读数。没有什么动态，除了看起来有点漂亮之外，它不是很有用。</p><p id="196e" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">当我在彭博工作时，我亲眼看到了将数据转化为信息是多么重要，彭博可以从全球交易所获得所有的市场数据，并使其对大量受众变得有价值。</p><p id="cf78" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">这里我们有区块链，整个链是可读和开源的——这激发了我的兴趣。你能从数据中获得哪些有用的信息？</p><p id="fbab" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">所以我现在开始使用React来制作一个可视化的交互式以太坊浏览器。我已经学会了如何以编程方式解析以太坊数据、契约，如何清理数据，使其成为参考数据，并能够查询它的一些用途(尽管我们将在后面看到它有多有用)</p><p id="84eb" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">(非常粗略的)数据流是…</p><figure class="jp jq jr js fq jt fe ff paragraph-image"><div role="button" tabindex="0" class="ke kf di kg bf kh"><div class="fe ff kd"><img src="../Images/fcd679d7903078e2bdd2b93bc8c38ea7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*22S6L9jm2SX9jiYeyeKZ-A.png"/></div></div></figure></div><div class="ab cl jw jx hb jy" role="separator"><span class="jz bw bk ka kb kc"/><span class="jz bw bk ka kb kc"/><span class="jz bw bk ka kb"/></div><div class="hm hn ho hp hq"><p id="4639" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">正如朱莉·沃尔特斯所说:让我们从头开始。</p><p id="d860" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">为了能够查询以太坊区块链，你需要下载数据库本身。比较简单；在你的机器上安装<a class="ae jo" href="https://github.com/ethereum/go-ethereum/wiki/geth" rel="noopener ugc nofollow" target="_blank"> Geth </a>或<a class="ae jo" href="https://www.parity.io/" rel="noopener ugc nofollow" target="_blank">奇偶校验</a>。</p><p id="4d98" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">默认情况下，奇偶校验将尝试对区块链进行快速同步(在编写本文时，数据库中有超过500万个数据块)。您应该能够在几个小时内在本地获得一大块数据库。它可以做到这一点，因为您的机器不需要验证所有先前验证的块。下载完数据库快照后，它的速度确实慢了下来，看起来它开始验证收到的数据块。总而言之，花了大约24个小时才在本地更新。</p><p id="0730" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">Geth和Parity都有一个RPC接口，可以通过Web3接口以各种语言访问。我不得不说，对于开始查询区块链来说，该文档非常好(带有示例)。</p><p id="5360" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">我开始摆弄YouTube视频^up的Javascript接口，但是当我意识到我需要开始将数据转换成可以查询的格式时，我开始使用<a class="ae jo" href="https://github.com/izetex/web3-eth" rel="noopener ugc nofollow" target="_blank"> Ruby Web3 Gem </a>进行批量导入。</p><p id="222b" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">对于我的本地开发人员实例，我将使用安装在Mac上的Mongo，并将Mongoid用于Ruby的接口。</p><figure class="jp jq jr js fq jt"><div class="bz el l di"><div class="kk jv l"/></div></figure><p id="d6db" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">一开始，我将Mongo中的数据组织为:</p><pre class="jp jq jr js fq kl km kn ko aw kp dt"><span id="6141" class="kq kr ht km b fv ks kt l ku kv">block: {<br/>  block_id: NUMBER<br/>  transactions: [tx1, tx2, tx3]<br/>}</span></pre><p id="799a" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">但我意识到，在文档中查询数组的复杂性和低效率不允许我在区块链上通过合同或令牌进行有效搜索——我认为这是收集有用信息的关键数据点。</p><p id="b80d" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">现在数据的格式是以太坊交易与集合中文档的1:1映射。</p><p id="9838" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">代码应该相对自我解释，也许除了同步检查。</p><p id="f3ec" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">当以太坊客户端连接到网络时，它将尝试在本地同步数据库。当这种情况发生时，你真的只能读取和导入本地数据，你不能查询网络本身。因为我不想等待，所以我会询问本地RPC端点最新同步的数据块是什么</p><pre class="jp jq jr js fq kl km kn ko aw kp dt"><span id="6ba1" class="kq kr ht km b fv ks kt l ku kv">web3.eth.syncing</span></pre><p id="892a" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">在生产中，假设它将完全同步，并且只接收网络上出现的新数据块。</p><p id="dc8a" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">这是我们需要打电话的时候</p><pre class="jp jq jr js fq kl km kn ko aw kp dt"><span id="bb7d" class="kq kr ht km b fv ks kt l ku kv">web3.eth.blockNumber</span></pre><p id="ac62" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">在我的设计中，导入脚本实际上将位于Kubernetes集群上的一个容器中(就像奇偶校验一样，作为服务运行)，它将循环接收任何新数据。我知道我可以订阅新街区的事件，但我并不期待实时数据，我对近实时数据和一些弹性很满意，以确保我拥有所有数据。1分钟的延迟不会导致任何数据= &gt;信息质量问题。</p></div><div class="ab cl jw jx hb jy" role="separator"><span class="jz bw bk ka kb kc"/><span class="jz bw bk ka kb kc"/><span class="jz bw bk ka kb"/></div><div class="hm hn ho hp hq"><p id="92c1" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">我现在有很多可查询格式的数据——还有很多事情要做才能理解，这是我将在接下来的几周内记录的旅程。</p><p id="7ac0" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">哦，最后一次统计(我仍然没有摄取所有数据)，我看到超过150，000，000个文档从我可怜的Mac SSD中打出来。但是对于现在的开发环境来说，这已经足够了。</p><figure class="jp jq jr js fq jt"><div class="bz el l di"><div class="kw jv l"/></div></figure></div></div>    
</body>
</html>