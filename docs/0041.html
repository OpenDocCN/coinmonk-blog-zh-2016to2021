<html>
<head>
<title>Deploying hyperledger-fabric on AWS using ansible</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用ansible在AWS上部署hyperledger-fabric</h1>
<blockquote>原文：<a href="https://medium.com/coinmonks/deploying-hyperledger-fabric-on-aws-using-ansible-c2b240eac83f?source=collection_archive---------0-----------------------#2017-12-06">https://medium.com/coinmonks/deploying-hyperledger-fabric-on-aws-using-ansible-c2b240eac83f?source=collection_archive---------0-----------------------#2017-12-06</a></blockquote><div><div class="ef hh hi hj hk hl"/><div class="hm hn ho hp hq"><div class=""/><p id="48b3" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">Hyperledger-fabric是一个模块化的区块链架构，允许开发人员开发应用程序来解决他们的业务用例。该框架的使用案例是多样化的，不仅限于ICO或加密货币。然而，由于结构体系结构的复杂性，许多人在部署结构体系结构时遇到了问题。</p><p id="a932" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">其中一个原因是，由于fabric严重依赖docker，像我这样愿意实现该架构的许多开发人员并不太了解docker，或者对它的了解有限或很少。</p><p id="3511" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">另一个原因是hyperledger-fabric是区块链许可的，所以你不会发现太多基于这个架构的展示应用，不像以太坊是公共区块链。</p><p id="f3fb" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">写这篇文章的目的不是解释hyperledger fabric的基本架构，而是关注部署阶段，因为这是大多数人被困的地方。</p><p id="1a4e" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">在这个系列文章中，我将讨论以下主题</p><p id="9855" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">1-在多个aws服务器上部署hyperledger结构</p><p id="87eb" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">2-将node-sdk等客户端与现有网络集成，这样您就可以在sdk基础上构建web应用程序</p><p id="837b" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated"><strong class="is hu">先决条件:</strong></p><p id="fcee" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">1-您必须对hyperledger-fabric体系结构及其工作原理有基本的了解</p><p id="5fe2" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">1-您必须有一个aws帐户。</p><p id="4b55" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">2-你应该有一台ubuntu机器。</p><p id="268e" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">3- Git应该安装在本地系统上。如果您还没有安装它，您可以通过键入以下命令来安装它</p><blockquote class="jo jp jq"><p id="5ed2" class="iq ir jr is b it iu iv iw ix iy iz ja js jc jd je jt jg jh ji ju jk jl jm jn hm dt translated">(sudo apt安装git)</p></blockquote><p id="630f" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated"><strong class="is hu">在AWS上设置面料:</strong></p><p id="25db" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">为了在aws上部署，我们将使用ansible脚本。Ansible是一个自动化工具，它可以在任何特定的服务器上执行一组预定义的任务，因此它不会手动配置每个服务器，而是会针对ansible配置文件中定义的特定服务器自动运行一些命令。</p><p id="6520" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">为了让ansible工作，我们需要在我们的本地机器上配置它，我们通常称之为ansible controller。</p><p id="2c61" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated"><strong class="is hu">在本地机器上配置ansi ble:</strong></p><p id="df06" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">虽然ansible配置非常简单，并且在hyperledger-cello docs(<a class="ae jv" href="https://github.com/hyperledger/cello/tree/master/src/agent/ansible" rel="noopener ugc nofollow" target="_blank">https://github . com/hyperledger/cello/tree/master/src/agent/ansi ble</a>)上有很好的记录，但是我将在这里写下所有的命令。</p><p id="af31" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">首先通过键入以下命令克隆官方hyperledger-cello库。</p><blockquote class="jo jp jq"><p id="21c8" class="iq ir jr is b it iu iv iw ix iy iz ja js jc jd je jt jg jh ji ju jk jl jm jn hm dt translated">git克隆<a class="ae jv" href="https://github.com/hyperledger/cello.git" rel="noopener ugc nofollow" target="_blank">https://github.com/hyperledger/cello.git</a></p></blockquote><p id="c3d2" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">现在要在本地机器上安装ansible，运行下面的命令。它将安装ansible工作所需的所有软件包</p><pre class="jw jx jy jz fq ka kb kc kd aw ke dt"><span id="58d7" class="kf kg ht kb b fv kh ki l kj kk">sudo apt-get update<br/>sudo apt-get install python-dev python-pip libssl-dev libffi-dev -y<br/>sudo pip install --upgrade pip<br/>sudo pip install 'ansible&gt;=2.3.0.0'</span></pre><p id="7fa2" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">现在你需要在你的系统中做的最后一件事就是安装云相关的包。如果您正在使用aws，则需要安装awsboto如果您正在使用openstack，则需要安装OpenStack shade。因为我们关注aws部署，所以我们将在本地机器上安装aws依赖包。运行以下命令来安装aws boto。它既可以从apt软件包管理器安装，也可以从pip安装。</p><pre class="jw jx jy jz fq ka kb kc kd aw ke dt"><span id="22aa" class="kf kg ht kb b fv kh ki l kj kk">`sudo pip install -U boto<br/> sudo pip install -U boto3</span></pre><p id="fc1c" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">这里-U标志代表升级，所以如果你已经安装了这些软件包，它将升级到最新的。</p><p id="e627" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">现在导航到cello中的一个可行目录</p><p id="3f25" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">我将尝试解释与aws相关的主要目录的用途，以便您可以根据您的用例/场景轻松配置</p><p id="09fe" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">主ansible目录包含几个配置文件，如aws.yml、azure.yml，这些文件是针对特定环境的。您不需要更改这些配置文件。</p><p id="2ced" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">如果你看一下aws.yml文件(<a class="ae jv" href="https://github.com/hyperledger/cello/blob/master/src/agent/ansible/aws.yml" rel="noopener ugc nofollow" target="_blank">https://github . com/hyperledger/cello/blob/master/src/agent/ansi ble/AWS . yml</a>)，它包含了正确设置fabric需要运行哪些任务的说明。</p><p id="5f4c" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">与aws相关的另一个配置文件是<code class="eh kl km kn kb b">vars</code>`目录下的AWS . yml(<a class="ae jv" href="https://github.com/hyperledger/cello/tree/master/src/agent/ansible/vars" rel="noopener ugc nofollow" target="_blank">https://github . com/hyperledger/cello/tree/master/src/agent/ansi ble/vars</a>)，需要稍加改动。让我们看一下配置文件</p><pre class="jw jx jy jz fq ka kb kc kd aw ke dt"><span id="536c" class="kf kg ht kb b fv kh ki l kj kk">---<br/># AWS Keys will be use to provision EC2 instances on AWS Cloud<br/>auth: {<br/>  auth_url: "",<br/>  # This should be your AWS Access Key ID<br/>  username: "AKIAJCA47Q46DOT2M7WA",<br/>  # This should be your AWS Secret Access Key<br/>  # can be passed as part of cmd line when running the playbook<br/>  password: "{{ password | default(lookup('env', 'AWS_SECRET_KEY')) }}"<br/>}</span><span id="2dd3" class="kf kg ht kb b fv ko ki l kj kk"># These variable defines AWS cloud provision attributes<br/>cluster: {<br/>  region_name: "us-east-1",     #TODO  Dynamic fetch<br/>  availability_zone: "", #TODO  Dynamic fetch based on region<br/>  security_group: "Fabric",</span><span id="7529" class="kf kg ht kb b fv ko ki l kj kk">target_os: "ubuntu",<br/>  image_name: "ubuntu/images/hvm-ssd/ubuntu-xenial-16.04-amd64-*",<br/>  image_id: "ami-d15a75c7",<br/>  flavor_name: "t2.medium",  # "m2.medium" is big enough for Fabric<br/>  ssh_user: "ubuntu",<br/>  validate_certs: True,<br/>  private_net_name: "demonet",</span><span id="f9a7" class="kf kg ht kb b fv ko ki l kj kk">public_key_file: "/home/mobaid/.ssh/id_rsa.pub",<br/>  private_key_file: "/home/mobaid/.ssh/id_rsa",<br/>  ssh_key_name: "finalmvp",<br/>  # This variable indicate what IP should be used, only valid values are<br/>  # private_ip or public_ip<br/>  node_ip: "public_ip",</span><span id="d797" class="kf kg ht kb b fv ko ki l kj kk">container_network: {<br/>    Network: "172.16.0.0/16",<br/>    SubnetLen: 24,<br/>    SubnetMin: "172.16.0.0",<br/>    SubnetMax: "172.16.255.0",<br/>    Backend: {<br/>      Type: "udp",<br/>      port: 8285 <br/>    }<br/>  },</span><span id="7c7a" class="kf kg ht kb b fv ko ki l kj kk">service_ip_range: "172.15.0.0/24",<br/>  dns_service_ip: "172.15.0.4",</span><span id="a113" class="kf kg ht kb b fv ko ki l kj kk"># the section defines preallocated IP addresses for each node, if there is no<br/>  # preallocated IPs, leave it blank<br/>  node_ips: [ ],</span><span id="65f6" class="kf kg ht kb b fv ko ki l kj kk"># fabric network node names expect to be using a clear pattern, this defines<br/>  # the prefix for the node names.<br/>  name_prefix: "fabric",<br/>  domain: "fabricnet",</span><span id="554f" class="kf kg ht kb b fv ko ki l kj kk"># stack_size determines how many virtual or physical machines we will have<br/>  # each machine will be named ${name_prefix}001 to ${name_prefix}${stack_size}</span><span id="aa94" class="kf kg ht kb b fv ko ki l kj kk">stack_size: 3,</span><span id="2b72" class="kf kg ht kb b fv ko ki l kj kk">etcdnodes: ["fabric001", "fabric002", "fabric003"],<br/>  builders: ["fabric001"],</span><span id="add2" class="kf kg ht kb b fv ko ki l kj kk">flannel_repo: "<a class="ae jv" href="https://github.com/coreos/flannel/releases/download/v0.7.1/flannel-v0.7.1-linux-amd64.tar.gz" rel="noopener ugc nofollow" target="_blank">https://github.com/coreos/flannel/releases/download/v0.7.1/flannel-v0.7.1-linux-amd64.tar.gz</a>",<br/>  etcd_repo: "<a class="ae jv" href="https://github.com/coreos/etcd/releases/download/v3.2.0/etcd-v3.2.0-linux-amd64.tar.gz" rel="noopener ugc nofollow" target="_blank">https://github.com/coreos/etcd/releases/download/v3.2.0/etcd-v3.2.0-linux-amd64.tar.gz</a>",<br/>  k8s_repo: "<a class="ae jv" href="https://storage.googleapis.com/kubernetes-release/release/v1.7.0/bin/linux/amd64/" rel="noopener ugc nofollow" target="_blank">https://storage.googleapis.com/kubernetes-release/release/v1.7.0/bin/linux/amd64/</a>",</span><span id="28e7" class="kf kg ht kb b fv ko ki l kj kk">go_ver: "1.8.3",</span><span id="8aa9" class="kf kg ht kb b fv ko ki l kj kk"># If volume want to be used, specify a size in GB, make volume size 0 if wish<br/>  # not to use volume from your cloud<br/>  volume_size: 8,</span><span id="a1c6" class="kf kg ht kb b fv ko ki l kj kk"># cloud block device name presented on virtual machines.<br/>  block_device_name: "/dev/vdb"<br/>}</span></pre><p id="9d1d" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">首先你需要在认证部分改变<code class="eh kl km kn kb b">username</code>。您需要从您的aws帐户生成AWS访问密钥Id和AWS秘密访问令牌。一旦生成了这些密钥，就用您的密钥替换那个<code class="eh kl km kn kb b">AWS Access Key Id</code>。关于您的秘密访问令牌，请将其保存在其他地方。你以后会需要这把钥匙。</p><p id="4b3f" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated"><strong class="is hu">集群部分:C </strong>集群部分定义你的区域名称和安全组。当您运行ansible脚本时，它将在特定区域创建集群，并创建名为<code class="eh kl km kn kb b">Fabric</code>的安全组。如果您想更改安全组名称，您可以在此文件中进行更改。</p><p id="d322" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated"><strong class="is hu"> Target_os部分</strong>:这个部分定义了应该在amazon集群上安装什么操作系统。有一件事你需要确保你的aws帐户应该能够托管<code class="eh kl km kn kb b">t2.medium</code>实例。正常情况下，免费的aws帐户有<code class="eh kl km kn kb b">t2.micro</code>个实例的限制，这对于运行光纤网络来说是不够的。我会告诉你原因，在这篇文章的后面，当我来解释织物布局。</p><p id="b8e2" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">下一部分与公钥/私钥部分相关。Ansible会将公钥和私钥存储在您的本地ssh目录中，这样以后您就可以从您的终端ssh到您的ubuntu实例中。你需要注意的一件事是<code class="eh kl km kn kb b">ssh_key_name</code>`。你应该从你的aws账户这里【https://console.aws.amazon.com/ec2/v2/home? T2】生成并下载你的ssh密钥对region = us-east-1 # key pairs:sort = keyName并用您的密钥对名称替换<code class="eh kl km kn kb b">ssh_key_name</code>’。当登录ubuntu实例时，您需要提供ssh密钥路径。</p><p id="0213" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated"><strong class="is hu"> Stack_Size </strong> : Stack_size定义您想要放入fabric架构中的服务器数量。默认情况下，ansible使用3台服务器，但您可以根据自己的需求增加或减少它。</p><p id="7fe0" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated"><strong class="is hu">配置织物布局:</strong></p><p id="fdeb" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">在这一部分中，我们将配置fabric layout，它基本上说明了我们的服务器中将有多少组织、对等体和订购服务以及它们的组合。Ansible默认使用此配置文件在aws上部署fabric。(<a class="ae jv" href="https://github.com/hyperledger/cello/blob/master/src/agent/ansible/vars/bc1st.yml" rel="noopener ugc nofollow" target="_blank">https://github . com/hyperledger/cello/blob/master/src/agent/ansi ble/vars/bc1st . yml</a>)</p><p id="e8d9" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">让我们来看看这个文件</p><blockquote class="jo jp jq"><p id="5e4b" class="iq ir jr is b it iu iv iw ix iy iz ja js jc jd je jt jg jh ji ju jk jl jm jn hm dt translated">— - <br/> #结构源库的URL<br/>GIT _ URL:"<a class="ae jv" href="http://gerrit.hyperledger.org/r/fabric" rel="noopener ugc nofollow" target="_blank">http://gerrit.hyperledger.org/r/fabric</a>"</p><p id="a8e6" class="iq ir jr is b it iu iv iw ix iy iz ja js jc jd je jt jg jh ji ju jk jl jm jn hm dt translated"># gerrit补丁集引用应由GERRIT自动设置<br/># GERRIT _ ref spec:" refs/changes/23/11523/3 " # 1 . 0 . 0<br/># GERRIT _ ref spec:" refs/changes/47/12047/3 " # 1 . 0 . 1<br/>GERRIT _ ref spec:" refs/changes/13/13113/1 "</p><p id="a26e" class="iq ir jr is b it iu iv iw ix iy iz ja js jc jd je jt jg jh ji ju jk jl jm jn hm dt translated">#此变量定义结构网络属性<br/>结构:{</p><p id="4b44" class="iq ir jr is b it iu iv iw ix iy iz ja js jc jd je jt jg jh ji ju jk jl jm jn hm dt translated">#连接到服务器的用户<br/> ssh_user: "ubuntu "，</p><p id="234f" class="iq ir jr is b it iu iv iw ix iy iz ja js jc jd je jt jg jh ji ju jk jl jm jn hm dt translated">#选项为" goleveldb "，" CouchDB "，默认为goleveldb <br/> peer_db: "CouchDB "，<br/> tls: false，</p><p id="3f97" class="iq ir jr is b it iu iv iw ix iy iz ja js jc jd je jt jg jh ji ju jk jl jm jn hm dt translated">#以下部分定义了光纤网络将如何组成<br/> # cas表示认证机构容器<br/> # peers表示对等容器<br/># orders表示订购方容器<br/> # kafka表示kafka容器<br/> #所有名称都必须是小写。数字字符不能用于开始<br/> #或结束名称。字符点(。)只能用于同行和订购者的名称中。<br/>网络:{<br/>fabric 001:{<br/>cas:[" ca1st . orga "]，<br/>同行:["anchor@peer1st.orga "，" anchor@peer1st.orgb"]，<br/>订购者:[" order 1 ST . orgc "，" order 1 ST . orgd "]，<br/>动物园管理员:["zookeeper1st"]，<br/>卡夫卡:["kafka1st"] <br/> }，【T18</p><p id="4400" class="iq ir jr is b it iu iv iw ix iy iz ja js jc jd je jt jg jh ji ju jk jl jm jn hm dt translated">baseimage_tag: "1.0.2 "，<br/> ca: { tag: "1.0.2 "，admin: "admin "，adminpw: "adminpw" } <br/> }</p></blockquote><p id="ea2a" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">这个布局文件告诉ansible在三个ubuntu服务器上部署4-organizations和他们的同行，数据库设置为<code class="eh kl km kn kb b">couchdb</code>`。在4个组织中，orgc和orgd充当订购服务，而orga和orgb将是涉及资产转移的主要参与者。</p><p id="653f" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">因为有多个订购服务，所以我们需要kafka和zookeeper服务器的共识机制。在这个布局文件中，我们定义了3个kafka和zookeeper服务器，对于这个网络来说足够了。但是，对于较大的网络，您应该正确计算这些kafka服务器的规模。您可以定义尽可能多的kafka服务器，但要确保它不会过度破坏您的应用程序。</p><p id="ba19" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">在这篇文章的上面，我提到过<code class="eh kl km kn kb b">t2.micro</code>实例不足以运行这个fabric布局。原因是zookeeper和Kafka需要至少1 GB内存才能正常工作，而t2.micro实例无法提供。如果你运行微实例，你可能会在kafka容器中得到<code class="eh kl km kn kb b">Memory corruption</code>错误。</p><p id="1b27" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">文件中的其余内容不言自明。如果您对这个配置文件有任何疑问，请告诉我。</p><p id="ef71" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated"><strong class="is hu">其他重要文件:</strong></p><p id="746c" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated"><code class="eh kl km kn kb b"><strong class="is hu">ansible/role/deploy_compose</strong></code>`:该文件夹包含从channel_artifacts到instantiate_chaincode关于fabric设置的所有必要代码。</p><p id="a569" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated"><strong class="is hu"> Chaincode </strong>:如果您想要更改Chaincode，请导航到<a class="ae jv" href="https://github.com/hyperledger/cello/tree/master/src/agent/ansible/roles/deploy_compose/fabricsetup/templates" rel="noopener ugc nofollow" target="_blank">https://github . com/hyperledger/cello/tree/master/src/agent/ansi ble/roles/deploy _ compose/fabric setup/templates</a>并将您的chaincode粘贴到文件<code class="eh kl km kn kb b">firstcode.go</code>中</p><p id="79ae" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated"><strong class="is hu">背书策略:</strong>如需更改背书策略，导航至<code class="eh kl km kn kb b">dochannel.j2</code>`(<a class="ae jv" href="https://github.com/hyperledger/cello/blob/master/src/agent/ansible/roles/deploy_compose/fabricsetup/templates/dochannel.j2" rel="noopener ugc nofollow" target="_blank">https://github . com/hyperledger/cello/blob/master/src/agent/ansi ble/roles/deploy _ compose/fabric setup/templates/doc hannel . J2</a>)，根据您的业务需求更改策略。</p><p id="9fae" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">修改完所有这些内容后，从ansible目录运行脚本，如下所示。</p><p id="7312" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">导出您之前保存的AWS秘密访问密钥</p><blockquote class="jo jp jq"><p id="0786" class="iq ir jr is b it iu iv iw ix iy iz ja js jc jd je jt jg jh ji ju jk jl jm jn hm dt translated"><code class="eh kl km kn kb b">export AWS_SECRET_KEY="your secret key of your aws account"</code></p></blockquote><p id="657c" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">下一次运行ansible命令</p><blockquote class="jo jp jq"><p id="80a9" class="iq ir jr is b it iu iv iw ix iy iz ja js jc jd je jt jg jh ji ju jk jl jm jn hm dt translated">ansi ble-playbook-e " mode = apply " AWS . yml</p></blockquote><p id="ebff" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">根据您的互联网连接，此命令可能需要一段时间。</p><p id="7a9e" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">当命令正确完成时，您将得到如下输出</p><figure class="jw jx jy jz fq kq fe ff paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="fe ff kp"><img src="../Images/252f9f3b8496589bc34f4a4e4105d2a3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Yyw53YQ-FHhAQAvhjm91Iw.png"/></div></div></figure><p id="498e" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated"><strong class="is hu">调用查询:</strong></p><p id="005e" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">现在，为了测试我们部署的fabric服务器是否正常工作，我们将调用一些查询，看看每个对等点是否得到相同的结果..</p><p id="47ee" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">你应该在这里看到你所有正在运行的实例<a class="ae jv" href="https://console.aws.amazon.com/ec2/v2/home?region=us-east-1#Instances:sort=instanceState" rel="noopener ugc nofollow" target="_blank">https://console.aws.amazon.com/ec2/v2/home?region = us-east-1 # Instances:sort = instanceState</a></p><p id="eec2" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">现在使用您的ssh密钥登录到这些实例，您应该看到一些docker容器根据您的fabric布局运行。</p><p id="4060" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">因为没有客户端与这个网络集成，所以您需要从对等容器调用查询。通过键入以下命令转到对等容器</p><blockquote class="jo jp jq"><p id="6e71" class="iq ir jr is b it iu iv iw ix iy iz ja js jc jd je jt jg jh ji ju jk jl jm jn hm dt translated">码头工人的狂欢</p></blockquote><p id="0c4c" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">对于频道列表</p><blockquote class="jo jp jq"><p id="ca85" class="iq ir jr is b it iu iv iw ix iy iz ja js jc jd je jt jg jh ji ju jk jl jm jn hm dt translated">对等提取通道-o <orderer container="" name=""> :7050</orderer></p></blockquote><p id="c2a8" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">您应该得到通道名<code class="eh kl km kn kb b">firstchannel</code>’,因为ansible在默认情况下使用该名称创建通道。</p><p id="4b4f" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">要从对等终端调用事务，请运行以下命令</p><pre class="jw jx jy jz fq ka kb kc kd aw ke dt"><span id="df87" class="kf kg ht kb b fv kh ki l kj kk">peer chaincode invoke -o &lt;orderer container name&gt; -C &lt;channel_name&gt; -n &lt;chaincode name&gt; -c '{"Args":["invoke","a","b","10"]}'</span></pre><p id="64af" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">这将调用事务并将<code class="eh kl km kn kb b">10</code>从<code class="eh kl km kn kb b">a</code>转移到<code class="eh kl km kn kb b">b</code></p><p id="725d" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">要检查<code class="eh kl km kn kb b">a</code>的平衡，运行以下命令。</p><pre class="jw jx jy jz fq ka kb kc kd aw ke dt"><span id="4755" class="kf kg ht kb b fv kh ki l kj kk">peer chaincode query -C &lt;channel name&gt; -n &lt;chaincode name&gt; -c '{"Args":["query","a"]}'</span></pre><p id="cfff" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">您可以用类似方式在其他服务器上检查结果。如果您得到相同的结果，这意味着您的结构网络在多个服务器上正常工作，并且所有对等点和订购服务都相互连接。</p><p id="1a0e" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">在下一篇文章中，我们将把node-sdk这样的客户端与这个现有的网络集成起来，并创建公共api，这样您就可以从任何地方通过调用它们的api来运行基本的区块链命令。</p><blockquote class="kx"><p id="36c1" class="ky kz ht bd la lb lc ld le lf lg jn ek translated"><a class="ae jv" href="https://coincodecap.com/?utm_source=coinmonks" rel="noopener ugc nofollow" target="_blank">在您的收件箱中直接获得最佳软件交易</a></p></blockquote><figure class="li lj lk ll lm kq fe ff paragraph-image"><a href="https://coincodecap.com/?utm_source=coinmonks"><div class="fe ff lh"><img src="../Images/7c0b3dfdcbfea594cc0ae7d4f9bf6fcb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1168/format:webp/0*OJ-qb5G6i863msBB.png"/></div></a></figure></div></div>    
</body>
</html>