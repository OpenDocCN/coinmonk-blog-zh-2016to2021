<html>
<head>
<title>How to automatically verify smart contracts on Etherscan &amp; Bscscan with Truffle</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何用Truffle自动验证Etherscan &amp; Bscscan上的智能合约</h1>
<blockquote>原文：<a href="https://medium.com/coinmonks/how-to-auto-verify-smart-contracts-on-etherscan-bscscan-with-truffle-1d061e6f31ed?source=collection_archive---------3-----------------------#2021-07-28">https://medium.com/coinmonks/how-to-auto-verify-smart-contracts-on-etherscan-bscscan-with-truffle-1d061e6f31ed?source=collection_archive---------3-----------------------#2021-07-28</a></blockquote><div><div class="ef hh hi hj hk hl"/><div class="hm hn ho hp hq"><div class=""/><p id="8168" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">智能合同验证对于分散的项目非常重要。您可以通过自动合同验证在etherscan.io上发布您的项目代码。此外，当您验证合同时，etherscan.io上将提供读写功能交互。</p><p id="a57a" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">虽然etherscan.io上可以进行手动验证，但是直接用Truffle进行自动验证是最佳实践。</p><h1 id="59d9" class="jo jp ht bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl dt translated">创建一个松露项目</h1><p id="39cb" class="pw-post-body-paragraph iq ir ht is b it km iv iw ix kn iz ja jb ko jd je jf kp jh ji jj kq jl jm jn hm dt translated">用t <em class="kr"> ruffle init </em>开始你的项目</p><pre class="ks kt ku kv fq kw kx ky kz aw la dt"><span id="9220" class="lb jp ht kx b fv lc ld l le lf">mkdir truffle-project<br/>cd truffle-project<br/>truffle init</span></pre><p id="e1fa" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">在这个命令之后，您就有了一个样板松露项目。</p><p id="bb26" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">让我们编写一个简单的智能契约。</p><pre class="ks kt ku kv fq kw kx ky kz aw la dt"><span id="b6af" class="lb jp ht kx b fv lc ld l le lf">touch contracts/NumberStorage.sol</span></pre><p id="c9fd" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">将以下行添加到NumberStorage.sol:</p><figure class="ks kt ku kv fq lg"><div class="bz el l di"><div class="lh li l"/></div></figure><p id="9ff2" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">将以下行添加到truffle-config.js</p><pre class="ks kt ku kv fq kw kx ky kz aw la dt"><span id="5249" class="lb jp ht kx b fv lc ld l le lf">compilers: {<br/>  solc: {<br/>    version: "0.8.6", // Fetch exact version from solc-bin (default: truffle's version)<br/>    docker: false, // Use "0.5.1" you've installed locally with docker (default: false)<br/>    settings: {<br/>      // See the solidity docs for advice about optimization and evmVersion<br/>      optimizer: {<br/>        enabled: true,<br/>        runs: 200,<br/>      },<br/>      evmVersion: "byzantium",<br/>    },<br/>  },<br/>},</span></pre><p id="46c5" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">编译合同时，您应该会看到一条成功消息:</p><pre class="ks kt ku kv fq kw kx ky kz aw la dt"><span id="cf84" class="lb jp ht kx b fv lc ld l le lf">truffle compile</span></pre><p id="9143" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">输出:</p><pre class="ks kt ku kv fq kw kx ky kz aw la dt"><span id="ab29" class="lb jp ht kx b fv lc ld l le lf">&gt; Compiled successfully using:<br/>   - solc: 0.8.6+commit.11564f7e.Emscripten.clang</span></pre><h1 id="b128" class="jo jp ht bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl dt translated">向项目中添加truffle验证插件</h1><pre class="ks kt ku kv fq kw kx ky kz aw la dt"><span id="f05e" class="lb jp ht kx b fv lc ld l le lf">yarn add -D truffle-plugin-verify</span></pre><p id="e57b" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">然后将插件数组中的truffle-plugin-verify添加到truffle-config.js中</p><pre class="ks kt ku kv fq kw kx ky kz aw la dt"><span id="61f8" class="lb jp ht kx b fv lc ld l le lf">plugins: [<br/>  'truffle-plugin-verify'<br/>]</span></pre><p id="923c" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">我们将安装2个软件包。一个给。env文件，另一个用于私钥。您可以使用私钥提供程序或助记键提供程序。两个都行。</p><pre class="ks kt ku kv fq kw kx ky kz aw la dt"><span id="a533" class="lb jp ht kx b fv lc ld l le lf">yarn add -D dotenv truffle-privatekey-provider</span></pre><p id="08a0" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">将这些行添加到truffle-config.js的顶部</p><pre class="ks kt ku kv fq kw kx ky kz aw la dt"><span id="5da2" class="lb jp ht kx b fv lc ld l le lf">require('dotenv').config()<br/>const PrivateKeyProvider = require("truffle-privatekey-provider");</span></pre><h1 id="3d41" class="jo jp ht bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl dt translated">在Etherscan.io上创建一个api密钥</h1><p id="5017" class="pw-post-body-paragraph iq ir ht is b it km iv iw ix kn iz ja jb ko jd je jf kp jh ji jj kq jl jm jn hm dt translated">我们需要生成一个etherscan.io API密钥。在这里注册并生成你的API密匙:【https://etherscan.io/myapikey T2】</p><p id="cb06" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">然后向truffle-config.js添加api-keys</p><pre class="ks kt ku kv fq kw kx ky kz aw la dt"><span id="da5c" class="lb jp ht kx b fv lc ld l le lf">api_keys: {<br/>  etherscan: process.env.ETHERSCAN_API_KEY<br/>}</span></pre><h1 id="41a1" class="jo jp ht bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl dt translated">在Infura上创建api密钥</h1><figure class="ks kt ku kv fq lg fe ff paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><div class="fe ff lk"><img src="../Images/0247c8259be33fd9d4b6905e01c02acc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*oTGiLXzuSsFP4ZLa9qyopA.png"/></div></div><figcaption class="lr ls fg fe ff lt lu bd b be z ek">infura.io dashboard</figcaption></figure><p id="9b60" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">在infura.io上创建一个账号，创建一个以太坊项目(【https://infura.io/dashboard/ethereum】T4)。单击您最近创建的项目的设置。</p><p id="7fcd" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">选择<strong class="is hu"> Rinkeby </strong> testnet并复制你的URL。网址应该是这样的:<a class="ae lj" href="https://rinkeby.infura.io/v3/167ee585da3c42e4a2a9c42476f9000f" rel="noopener ugc nofollow" target="_blank">https://rinkeby.infura.io/v3/Y</a>我们的_项目_ID</p><h1 id="5e5d" class="jo jp ht bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl dt translated">为部署添加Rinkeby网络</h1><p id="dfc2" class="pw-post-body-paragraph iq ir ht is b it km iv iw ix kn iz ja jb ko jd je jf kp jh ji jj kq jl jm jn hm dt translated">我们即将部署我们的智能合同。我们需要将Rinkeby网络配置添加到truffle-config.js中</p><pre class="ks kt ku kv fq kw kx ky kz aw la dt"><span id="38c4" class="lb jp ht kx b fv lc ld l le lf">networks: {<br/>  rinkeby: {<br/>    provider: () =&gt; new PrivateKeyProvider(process.env.PRIVATE_KEY, process.env.RINKEBY_INFURA_URL),<br/>    network_id: 4,       // Ropsten's id<br/>    gas: 5500000,        // Ropsten has a lower block limit than mainnet<br/>    confirmations: 2,    // # of confs to wait between deployments. (default: 0)<br/>    timeoutBlocks: 200,  // # of blocks before a deployment times out  (minimum/default: 50)<br/>    skipDryRun: true     // Skip dry run before migrations? (default: false for public nets )<br/>  },<br/>},</span></pre><h1 id="4adf" class="jo jp ht bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl dt translated">创造。env文件并添加环境变量</h1><pre class="ks kt ku kv fq kw kx ky kz aw la dt"><span id="1a49" class="lb jp ht kx b fv lc ld l le lf">touch .env</span></pre><p id="c0a7" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">。env文件应该包含:</p><pre class="ks kt ku kv fq kw kx ky kz aw la dt"><span id="3c21" class="lb jp ht kx b fv lc ld l le lf">RINKEBY_INFURA_URL=https://rinkeby.infura.io/v3/YOUR_INFURA_PROJECT_URL<br/>PRIVATE_KEY=YOUR_PRIVATE_KEY<br/>ETHERSCAN_API_KEY=YOUR_ETHERSCAN_API_KEY</span></pre><h1 id="1289" class="jo jp ht bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl dt translated">为合同部署创建迁移</h1><pre class="ks kt ku kv fq kw kx ky kz aw la dt"><span id="6b36" class="lb jp ht kx b fv lc ld l le lf">truffle create migration NumberStorage</span></pre><p id="cfb9" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">您将在migrations文件夹中看到一个新文件。我们将把这些行添加到number_storage.js中</p><pre class="ks kt ku kv fq kw kx ky kz aw la dt"><span id="37ee" class="lb jp ht kx b fv lc ld l le lf">module.exports = async function(deployer) {<br/>  const NumberStorage = artifacts.require("NumberStorage");<br/><br/>  await deployer.deploy(NumberStorage);<br/>  const contract = await NumberStorage.deployed();<br/><br/>  console.log("Contract address:", contract.address)<br/>};</span></pre><h1 id="dbf3" class="jo jp ht bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl dt translated">部署合同</h1><pre class="ks kt ku kv fq kw kx ky kz aw la dt"><span id="5961" class="lb jp ht kx b fv lc ld l le lf">truffle migrate --network rinkeby</span></pre><p id="1226" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">部署合同需要几分钟时间。</p><figure class="ks kt ku kv fq lg fe ff paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><div class="fe ff lv"><img src="../Images/788d0627e94fad30771187db54022fe1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cyBhnCejMiKLPvC2kM8sTw.png"/></div></div></figure><p id="9320" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">部署完成后，您将看到以下消息:</p><figure class="ks kt ku kv fq lg fe ff paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><div class="fe ff lw"><img src="../Images/926deecb404e6e61b0dc3a5d9242a768.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*J-2HlKCdAmY0fSgSUaHKpg.png"/></div></div></figure><p id="b3ea" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">合同还没核实，我们来核实一下。</p><h1 id="84b0" class="jo jp ht bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl dt translated">核实合同</h1><pre class="ks kt ku kv fq kw kx ky kz aw la dt"><span id="ecde" class="lb jp ht kx b fv lc ld l le lf">truffle run verify NumberStorage --network rinkeby</span></pre><p id="cf6a" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">需要一段时间来验证。</p></div><div class="ab cl lx ly hb lz" role="separator"><span class="ma bw bk mb mc md"/><span class="ma bw bk mb mc md"/><span class="ma bw bk mb mc"/></div><div class="hm hn ho hp hq"><p id="b152" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">合同已验证:<a class="ae lj" href="https://rinkeby.etherscan.io/address/0x15E772Be5e36a70D36C0117E6Fb1455053c38094#contracts" rel="noopener ugc nofollow" target="_blank">https://rinke by . ethers can . io/address/0x 15 e 772 be 5 e 36 a 70d 36 c 0117 E6 FB 1455053 c 38094 #合同</a></p><p id="8a40" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">项目所在地:<a class="ae lj" href="https://github.com/mhkafadar/truffle-auto-verify-contracts" rel="noopener ugc nofollow" target="_blank">https://github.com/mhkafadar/truffle-auto-verify-contracts</a></p><h2 id="3693" class="lb jp ht bd jq me mf mg ju mh mi mj jy jb mk ml kc jf mm mn kg jj mo mp kk mq dt translated">另外，阅读</h2><div class="mr ms fm fo mt mu"><a href="https://blog.coincodecap.com/metamask-for-binance-smart-chain" rel="noopener  ugc nofollow" target="_blank"><div class="mv ab ej"><div class="mw ab mx cl cj my"><h2 class="bd hu fv z el mz eo ep na er et hs dt translated">为币安智能链设置元掩码</h2><div class="nb l"><h3 class="bd b fv z el mz eo ep na er et ek translated">在本文中，我们将向您展示如何为币安智能链设置元掩码？在进行设置步骤之前…</h3></div><div class="nc l"><p class="bd b gc z el mz eo ep na er et ek translated">blog.coincodecap.com</p></div></div><div class="nd l"><div class="ne l nf ng nh nd ni lp mu"/></div></div></a></div></div></div>    
</body>
</html>