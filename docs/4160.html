<html>
<head>
<title>Finding Missing Auth bugs in EOSIO Smart Contracts</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在EOSIO智能合同中查找缺失的验证错误</h1>
<blockquote>原文：<a href="https://medium.com/coinmonks/finding-missing-auth-bugs-in-eosio-smart-contracts-242400e10cdc?source=collection_archive---------10-----------------------#2021-03-08">https://medium.com/coinmonks/finding-missing-auth-bugs-in-eosio-smart-contracts-242400e10cdc?source=collection_archive---------10-----------------------#2021-03-08</a></blockquote><div><div class="ef hh hi hj hk hl"/><div class="hm hn ho hp hq"><div class=""/><figure class="fi fk ir is it iu fe ff paragraph-image"><div role="button" tabindex="0" class="iv iw di ix bf iy"><div class="fe ff iq"><img src="../Images/c693594dd7b1450ea3adf11f7b31eee5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*nG0HqhICo9OXaBwM.png"/></div></div></figure><p id="f469" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">这是一系列博客文章，我将在其中介绍一些常见的EOSIO智能合约漏洞，然后解释我们如何使用我们的EOSIO漏洞扫描器<a class="ae jz" href="https://klevoya.com/inspect/" rel="noopener ugc nofollow" target="_blank"> Inspect </a>来执行静态分析，以发现这些漏洞。</p><p id="0f22" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">本周，我将关注缺失的授权。</p><h1 id="8534" class="ka kb ht bd kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx dt translated">漏洞</h1><p id="31e1" class="pw-post-body-paragraph jb jc ht jd b je ky jg jh ji kz jk jl jm la jo jp jq lb js jt ju lc jw jx jy hm dt translated">在EOSIO中，开发人员可以使用两个函数来控制智能合约动作的授权，方法是检查所声明的动作授权是否等于应该能够运行该动作的帐户。这些是:</p><ul class=""><li id="e115" class="ld le ht jd b je jf ji jj jm lf jq lg ju lh jy li lj lk ll dt translated">require_auth(帐户[，权限])</li><li id="be4d" class="ld le ht jd b je lm ji ln jm lo jq lp ju lq jy li lj lk ll dt translated">has_auth(帐户)</li></ul><p id="776e" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">由于缺少授权控制，易受攻击的智能合同向不受信任的帐户(如恶意方)授予授权，以:</p><ul class=""><li id="4fcb" class="ld le ht jd b je jf ji jj jm lf jq lg ju lh jy li lj lk ll dt translated">访问/修改特权智能合同资源，例如智能合同表，</li><li id="ae34" class="ld le ht jd b je lm ji ln jm lo jq lp ju lq jy li lj lk ll dt translated">代表易受攻击的协定调用其他协定的函数，或者</li><li id="a712" class="ld le ht jd b je lm ji ln jm lo jq lp ju lq jy li lj lk ll dt translated">执行任务关键型合同操作，例如代币提款。</li></ul><p id="d826" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">让我们来看一个例子，其中设置了一个智能合同，它为EOS io RAM(EOS io称之为链上数据库)存储成本付费，在这种情况下，应该检查对数据库的每次写入，以确保调用包含数据库写入的动作的实体具有这样做的适当授权。否则，可能会写入不正确的数据，或者发生RAM填充攻击(参见下文的严重性)。</p><p id="92e4" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">在下面的操作代码中，尽管在定位调用(将数据写入_users表)之前有一个require_auth()调用，但用户不是RAM支付者，这允许任何用户使用合同帐户自己的RAM写入数据库，从而使合同容易受到RAM填充攻击。</p><figure class="lr ls lt lu fq iu"><div class="bz el l di"><div class="lv lw l"/></div><figcaption class="lx ly fg fe ff lz ma bd b be z ek">Unsafe smart contract action.</figcaption></figure><p id="e0d0" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">修改操作，使用户为RAM付费，使操作免受RAM填充攻击(因为用户不再使用合同的RAM资源):</p><figure class="lr ls lt lu fq iu"><div class="bz el l di"><div class="lv lw l"/></div><figcaption class="lx ly fg fe ff lz ma bd b be z ek">Smart contract action modified to make it safe.</figcaption></figure><h1 id="8668" class="ka kb ht bd kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx dt translated">严重</h1><p id="e206" class="pw-post-body-paragraph jb jc ht jd b je ky jg jh ji kz jk jl jm la jo jp jq lb js jt ju lc jw jx jy hm dt translated">这种类型的漏洞的影响是黑客可以:</p><ul class=""><li id="7995" class="ld le ht jd b je jf ji jj jm lf jq lg ju lh jy li lj lk ll dt translated">写入/修改/删除RAM中存储的任何数据，这些数据没有受到适当授权检查的充分保护，</li><li id="c9a6" class="ld le ht jd b je lm ji ln jm lo jq lp ju lq jy li lj lk ll dt translated">表面上应该只为智能合同的管理员/特权用户保留的呼叫功能，</li><li id="b14c" class="ld le ht jd b je lm ji ln jm lo jq lp ju lq jy li lj lk ll dt translated">在EOSIO中，RAM不是免费的，因此黑客可以用虚假数据填充智能合约的RAM，耗尽dAPP的资源，从而导致合法用户拒绝服务。</li></ul><h1 id="1c24" class="ka kb ht bd kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx dt translated">使用Inspect查找漏洞</h1><p id="2346" class="pw-post-body-paragraph jb jc ht jd b je ky jg jh ji kz jk jl jm la jo jp jq lb js jt ju lc jw jx jy hm dt translated">Inspect采用了一种称为静态分析的技术。静态分析是通过对计算机程序的源代码或某种中间表示进行推理来完成的，而不是实际执行它。</p><p id="df38" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">通过Inspect，我们对WASM二进制代码执行静态分析，这是反编译，然后提升到一个专有的中间表示(IR)。Inspect然后获取IR，将其表示在数据库中，我们可以从中挖掘已知漏洞的模式。</p><p id="e9c0" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">对包含上述智能合约操作的智能合约运行Inspect会产生以下结果:</p><pre class="lr ls lt lu fq mb mc md me aw mf dt"><span id="fd11" class="mg kb ht mc b fv mh mi l mj mk">Auth Violation: ✘ Action: emplaceself1 Insn: ($fel) = db_store_i64($feb, $fec, $fef, $feh, $fej, $fek)</span></pre><p id="934f" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">第一个动作被正确地标记为违反授权检查。当Inspect对WASM字节代码进行操作时，它会报告EOSIO内在db_store_i64()上发生的违例，该违例对应于调用launte()的情况。</p><p id="cefb" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">第二个动作不被报告，因为它是安全的。</p><p id="4078" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">在真实的分析场景中，下一步是将这个结果与源代码相关联，并确认这确实是一个漏洞。</p><p id="a27f" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">还有什么？接下来您希望我覆盖哪些漏洞？</p></div><div class="ab cl ml mm hb mn" role="separator"><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq"/></div><div class="hm hn ho hp hq"><p id="7c06" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated"><em class="ms">原载于2021年3月8日</em><a class="ae jz" href="https://klevoya.com/blog/finding-missing-auth-bugs-in-eosio-smart-contracts/" rel="noopener ugc nofollow" target="_blank"><em class="ms">【https://klevoya.com】</em></a><em class="ms">。</em></p><blockquote class="mt"><p id="7ca0" class="mu mv ht bd mw mx my mz na nb nc jy ek translated">加入Coinmonks <a class="ae jz" href="https://t.me/joinchat/EPmjKpNYwRMsBI4p" rel="noopener ugc nofollow" target="_blank"> Telegram group </a>并了解加密交易和投资</p></blockquote><h2 id="bd97" class="mg kb ht bd kc nd ne nf kg ng nh ni kk jm nj nk ko jq nl nm ks ju nn no kw np dt translated">另外，阅读</h2><ul class=""><li id="d3eb" class="ld le ht jd b je ky ji kz jm nq jq nr ju ns jy li lj lk ll dt translated"><a class="ae jz" href="https://blog.coincodecap.com/margin-trading" rel="noopener ugc nofollow" target="_blank">什么是融资融券交易</a></li><li id="6ed0" class="ld le ht jd b je lm ji ln jm lo jq lp ju lq jy li lj lk ll dt translated">最好的<a class="ae jz" rel="noopener" href="/coinmonks/crypto-trading-bot-c2ffce8acb2a">密码交易机器人</a> | <a class="ae jz" href="https://blog.coincodecap.com/grid-trading" rel="noopener ugc nofollow" target="_blank">网格交易</a></li><li id="5241" class="ld le ht jd b je lm ji ln jm lo jq lp ju lq jy li lj lk ll dt translated"><a class="ae jz" rel="noopener" href="/coinmonks/3commas-review-an-excellent-crypto-trading-bot-2020-1313a58bec92">3商业评论</a> | <a class="ae jz" rel="noopener" href="/coinmonks/pionex-review-exchange-with-crypto-trading-bot-1e459d0191ea"> Pionex评论</a> | <a class="ae jz" rel="noopener" href="/coinmonks/coinrule-review-2021-a-beginner-friendly-crypto-trading-bot-daf0504848ba"> Coinrule评论</a></li><li id="25b2" class="ld le ht jd b je lm ji ln jm lo jq lp ju lq jy li lj lk ll dt translated"><a class="ae jz" rel="noopener" href="/coinmonks/aax-exchange-review-2021-67c5ea09330c"> AAX交易所评论</a> | <a class="ae jz" rel="noopener" href="/coinmonks/deribit-review-options-fees-apis-and-testnet-2ca16c4bbdb2">德里比特评论</a> | <a class="ae jz" rel="noopener" href="/coinmonks/ftx-crypto-exchange-review-53664ac1198f"> FTX交易所评论</a></li><li id="1a62" class="ld le ht jd b je lm ji ln jm lo jq lp ju lq jy li lj lk ll dt translated"><a class="ae jz" rel="noopener" href="/coinmonks/ngrave-zero-review-c465cf8307fc">n零复习</a> | <a class="ae jz" rel="noopener" href="/coinmonks/phemex-review-4cfba0b49e28"> Phemex复习</a> | <a class="ae jz" rel="noopener" href="/coinmonks/primexbt-review-88e0815be858"> PrimeXBT复习</a></li><li id="a108" class="ld le ht jd b je lm ji ln jm lo jq lp ju lq jy li lj lk ll dt translated"><a class="ae jz" rel="noopener" href="/coinmonks/bybit-exchange-review-dbd570019b71"> Bybit Exchange审查</a> | <a class="ae jz" rel="noopener" href="/coinmonks/bityard-review-7d104239be35"> Bityard审查</a> | <a class="ae jz" href="https://blog.coincodecap.com/coinspot-review" rel="noopener ugc nofollow" target="_blank"> CoinSpot审查</a></li><li id="cfc6" class="ld le ht jd b je lm ji ln jm lo jq lp ju lq jy li lj lk ll dt translated"><a class="ae jz" rel="noopener" href="/coinmonks/3commas-vs-pionex-vs-cryptohopper-best-crypto-bot-6a98d2baa203">3 commas vs Cryptohopper</a>|<a class="ae jz" rel="noopener" href="/coinmonks/earn-crypto-interest-b10b810fdda3">赚取加密利息</a></li><li id="51e2" class="ld le ht jd b je lm ji ln jm lo jq lp ju lq jy li lj lk ll dt translated">最好的比特币<a class="ae jz" rel="noopener" href="/coinmonks/the-best-cryptocurrency-hardware-wallets-of-2020-e28b1c124069?source=friends_link&amp;sk=324dd9ff8556ab578d71e7ad7658ad7c">硬件钱包</a> | <a class="ae jz" rel="noopener" href="/coinmonks/bitbox02-review-your-swiss-bitcoin-hardware-wallet-c36c88fff29"> BitBox02回顾</a></li><li id="4268" class="ld le ht jd b je lm ji ln jm lo jq lp ju lq jy li lj lk ll dt translated"><a class="ae jz" rel="noopener" href="/coinmonks/ledger-vs-ngrave-zero-7e40f0c1d694">总账vs n平均</a> | <a class="ae jz" rel="noopener" href="/coinmonks/ledger-nano-s-vs-x-battery-hardware-price-storage-59a6663fe3b0">总账nano s vs x </a></li><li id="5c15" class="ld le ht jd b je lm ji ln jm lo jq lp ju lq jy li lj lk ll dt translated"><a class="ae jz" rel="noopener" href="/coinmonks/top-10-crypto-copy-trading-platforms-for-beginners-d0c37c7d698c">密码本交易平台</a></li><li id="8fd1" class="ld le ht jd b je lm ji ln jm lo jq lp ju lq jy li lj lk ll dt translated"><a class="ae jz" rel="noopener" href="/coinmonks/coinloan-review-18128b9badc4"> CoinLoan审查</a> | <a class="ae jz" rel="noopener" href="/coinmonks/youhodler-4-easy-ways-to-make-money-98969b9689f2"> YouHodler审查</a> | <a class="ae jz" rel="noopener" href="/coinmonks/blockfi-review-53096053c097"> BlockFi审查</a></li><li id="5243" class="ld le ht jd b je lm ji ln jm lo jq lp ju lq jy li lj lk ll dt translated">最好的<a class="ae jz" rel="noopener" href="/coinmonks/best-crypto-tax-tool-for-my-money-72d4b430816b">加密税务软件</a> | <a class="ae jz" rel="noopener" href="/coinmonks/cointracking-review-a-reliable-cryptocurrency-tax-software-5114e3eb5737">硬币追踪评论</a></li><li id="7c4f" class="ld le ht jd b je lm ji ln jm lo jq lp ju lq jy li lj lk ll dt translated">最佳<a class="ae jz" rel="noopener" href="/coinmonks/top-5-crypto-lending-platforms-in-2020-that-you-need-to-know-a1b675cec3fa">加密借贷平台</a> | <a class="ae jz" rel="noopener" href="/coinmonks/leveraged-token-3f5257808b22">杠杆代币</a></li><li id="ab33" class="ld le ht jd b je lm ji ln jm lo jq lp ju lq jy li lj lk ll dt translated"><a class="ae jz" rel="noopener" href="/coinmonks/blockfi-vs-celsius-vs-hodlnaut-8a1cc8c26630">block fi vs Celsius</a>|<a class="ae jz" rel="noopener" href="/coinmonks/hodlnaut-review-best-way-to-hodl-is-to-earn-interest-on-your-bitcoin-6658a8c19edf">Hodlnaut Review</a></li><li id="1dc3" class="ld le ht jd b je lm ji ln jm lo jq lp ju lq jy li lj lk ll dt translated"><a class="ae jz" rel="noopener" href="/coinmonks/bitsgap-review-a-crypto-trading-bot-that-makes-easy-money-a5d88a336df2"> Bitsgap审查</a> | <a class="ae jz" rel="noopener" href="/coinmonks/quadency-review-a-crypto-trading-automation-platform-3068eaa374e1"> Quadency审查</a> | <a class="ae jz" rel="noopener" href="/coinmonks/bitbns-review-38256a07e161"> Bitbns审查</a></li><li id="d689" class="ld le ht jd b je lm ji ln jm lo jq lp ju lq jy li lj lk ll dt translated"><a class="ae jz" rel="noopener" href="/coinmonks/ellipal-titan-review-85e9071dd029">埃利帕尔泰坦评论</a> | <a class="ae jz" rel="noopener" href="/coinmonks/secux-stone-hardware-wallet-review-15-discount-coupon-2020-7577032faa6e">赛克斯斯通评论</a></li><li id="5279" class="ld le ht jd b je lm ji ln jm lo jq lp ju lq jy li lj lk ll dt translated"><a class="ae jz" rel="noopener" href="/coinmonks/localbitcoins-review-6cc001c6ed56">本地比特币审核</a> | <a class="ae jz" href="https://blog.coincodecap.com/cryptocurrency-savings-accounts" rel="noopener ugc nofollow" target="_blank">加密货币储蓄账户</a></li><li id="c46f" class="ld le ht jd b je lm ji ln jm lo jq lp ju lq jy li lj lk ll dt translated">最佳<a class="ae jz" href="https://bitquery.io/blog/best-blockchain-analysis-tools-and-software" rel="noopener ugc nofollow" target="_blank">区块链分析</a>工具| <a class="ae jz" rel="noopener" href="/coinmonks/earn-bitcoin-6e8bd3c592d9">赚比特币</a></li><li id="b037" class="ld le ht jd b je lm ji ln jm lo jq lp ju lq jy li lj lk ll dt translated"><a class="ae jz" rel="noopener" href="/coinmonks/crypto-arbitrage-guide-how-to-make-money-as-a-beginner-62bfe5c868f6">加密套利</a>指南| <a class="ae jz" rel="noopener" href="/coinmonks/how-to-short-bitcoin-568a2d0b4ae5">如何做空比特币</a></li><li id="b46f" class="ld le ht jd b je lm ji ln jm lo jq lp ju lq jy li lj lk ll dt translated">最佳<a class="ae jz" rel="noopener" href="/coinmonks/what-are-the-best-charting-platforms-for-cryptocurrency-trading-85aade584d80">加密制图工具</a> | <a class="ae jz" rel="noopener" href="/coinmonks/crypto-exchange-dd2f9d6f3769">最佳加密交易所</a></li><li id="00df" class="ld le ht jd b je lm ji ln jm lo jq lp ju lq jy li lj lk ll dt translated"><a class="ae jz" rel="noopener" href="/coinmonks/buy-bitcoin-in-india-feb50ddfef94">如何在印度购买比特币？</a> | <a class="ae jz" rel="noopener" href="/coinmonks/wazirx-review-5c811b074f5b">瓦济克斯审查</a></li><li id="5524" class="ld le ht jd b je lm ji ln jm lo jq lp ju lq jy li lj lk ll dt translated"><a class="ae jz" rel="noopener" href="/coinmonks/bitcoin-exchange-in-india-7f1fe79715c9">印度比特币交易所</a> | <a class="ae jz" rel="noopener" href="/coinmonks/bitcoin-savings-account-e65b13f92451">比特币储蓄账户</a></li><li id="ef45" class="ld le ht jd b je lm ji ln jm lo jq lp ju lq jy li lj lk ll dt translated"><a class="ae jz" rel="noopener" href="/coinmonks/coindcx-review-8444db3621a2"> CoinDCX评论</a> | <a class="ae jz" href="https://blog.coincodecap.com/crypto-margin-trading-exchanges" rel="noopener ugc nofollow" target="_blank">加密保证金交易交易所</a></li></ul><blockquote class="mt"><p id="b751" class="mu mv ht bd mw mx nt nu nv nw nx jy ek translated"><a class="ae jz" rel="noopener" href="/coinmonks/newsletters/coinmonks">直接在您的收件箱中获得最佳软件交易</a></p></blockquote><figure class="nz oa ob oc od iu fe ff paragraph-image"><a href="https://medium.com/coinmonks/newsletters/coinmonks"><div class="fe ff ny"><img src="../Images/160ce73bd06d46c2250251e7d5969f9d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1168/format:webp/1*BoDnKUyK8p4hitHAJZ5Pdw.png"/></div></a></figure></div></div>    
</body>
</html>