<html>
<head>
<title>How to Export the Entire Ethereum Blockchain to CSV in 2 hours for $10</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在2小时内以10美元的价格将整个Ethereum Blockchain导出到CSV</h1>
<blockquote>原文：<a href="https://medium.com/coinmonks/how-to-export-the-entire-ethereum-blockchain-to-csv-in-2-hours-for-10-69fef511e9a2?source=collection_archive---------0-----------------------#2018-05-27">https://medium.com/coinmonks/how-to-export-the-entire-ethereum-blockchain-to-csv-in-2-hours-for-10-69fef511e9a2?source=collection_archive---------0-----------------------#2018-05-27</a></blockquote><div><div class="ef hh hi hj hk hl"/><div class="hm hn ho hp hq"><div class=""/><p id="9c17" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">在我的上一篇文章<a class="ae jo" rel="noopener" href="/@medvedev1088/exporting-and-analyzing-ethereum-blockchain-f5353414a94e">导出和分析Ethereum Blockchain </a>中，我介绍了<a class="ae jo" href="https://github.com/medvedev1088/ethereum-etl" rel="noopener ugc nofollow" target="_blank"> Ethereum ETL </a>工具，并提供了将Ethereum数据导出到CSV文件并在Amazon Athena和QuickSight中进行分析的分步说明(也请阅读Google BigQuery上的<a class="ae jo" rel="noopener" href="/@medvedev1088/ethereum-blockchain-on-google-bigquery-283fb300f579">Ethereum block chain</a>)。</p><p id="d5cc" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">在本文中，我将向您展示如何使用<a class="ae jo" href="https://aws.amazon.com/datapipeline/" rel="noopener ugc nofollow" target="_blank"> AWS数据管道</a>和<a class="ae jo" href="https://aws.amazon.com/autoscaling" rel="noopener ugc nofollow" target="_blank"> AWS自动缩放</a>将导出过程并行化为几十个和几百个实例，并将导出时间减少到几个小时甚至几分钟，同时由于有了<a class="ae jo" href="https://aws.amazon.com/ec2/spot/" rel="noopener ugc nofollow" target="_blank">EC2 Spot instance</a>，可以保持低成本。</p><p id="a746" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">整个过程分为4个步骤:</p><ul class=""><li id="26b1" class="jp jq ht is b it iu ix iy jb jr jf js jj jt jn ju jv jw jx dt translated">增加AWS限额</li><li id="de57" class="jp jq ht is b it jy ix jz jb ka jf kb jj kc jn ju jv jw jx dt translated">准备自定义AMI</li><li id="1d0e" class="jp jq ht is b it jy ix jz jb ka jf kb jj kc jn ju jv jw jx dt translated">创建数据管道</li><li id="4140" class="jp jq ht is b it jy ix jz jb ka jf kb jj kc jn ju jv jw jx dt translated">创建自动缩放组</li></ul><h2 id="1bd5" class="kd ke ht bd kf kg kh ki kj kk kl km kn jb ko kp kq jf kr ks kt jj ku kv kw kx dt translated">增加AWS限额</h2><p id="5dff" class="pw-post-body-paragraph iq ir ht is b it ky iv iw ix kz iz ja jb la jd je jf lb jh ji jj lc jl jm jn hm dt translated">AWS维护每个帐户的服务限额，以帮助保证AWS资源的可用性，并最小化新客户的计费风险。当您使用AWS时，某些服务限制会随着时间的推移自动提高，尽管大多数AWS服务要求您手动请求提高限制。此过程可能需要几个小时或几天时间。</p><p id="7a29" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">对于此任务，您需要增加:</p><ul class=""><li id="fbd7" class="jp jq ht is b it iu ix iy jb jr jf js jj jt jn ju jv jw jx dt translated">数据管道中每个管道限制的对象:1000。<em class="ld">单个管道出口400万块以上，只需要增加即可。</em></li><li id="2dcf" class="jp jq ht is b it jy ix jz jb ka jf kb jj kc jn ju jv jw jx dt translated">EC2斑点实例:100。<em class="ld">如果您的账户是新账户，他们只会先将其增加到20个或更低。</em></li></ul><p id="c237" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">您可以在这里找到关于如何增加限额的详细说明<a class="ae jo" href="https://docs.aws.amazon.com/general/latest/gr/aws_service_limits.html" rel="noopener ugc nofollow" target="_blank">https://docs . AWS . Amazon . com/general/last/gr/AWS _ service _ limits . html</a></p><h2 id="d140" class="kd ke ht bd kf kg kh ki kj kk kl km kn jb ko kp kq jf kr ks kt jj ku kv kw kx dt translated">准备自定义AMI</h2><p id="0261" class="pw-post-body-paragraph iq ir ht is b it ky iv iw ix kz iz ja jb la jd je jf lb jh ji jj lc jl jm jn hm dt translated">此处列出了数据管道定制AMI的要求<a class="ae jo" href="https://docs.aws.amazon.com/datapipeline/latest/DeveloperGuide/dp-custom-ami.html" rel="noopener ugc nofollow" target="_blank">https://docs . AWS . Amazon . com/Data Pipeline/last/developer guide/DP-custom-AMI . html</a>:</p><p id="b196" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">如果你运行的是Ubuntu，你需要按照这些说明<a class="ae jo" href="https://aws.amazon.com/premiumsupport/knowledge-center/new-user-accounts-linux-instance/" rel="noopener ugc nofollow" target="_blank">创建一个名为<code class="eh le lf lg lh b">ec2-user</code>的账户【https://AWS . Amazon . com/premium support/knowledge-center/new-user-accounts-Linux-instance/】。</a></p><p id="b9e1" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">您还需要将<code class="eh le lf lg lh b">ec2-user</code>添加到<code class="eh le lf lg lh b">sudoers</code>文件中。打开终端窗口并键入:</p><pre class="li lj lk ll fq lm lh ln lo aw lp dt"><span id="7096" class="kd ke ht lh b fv lq lr l ls lt">sudo visudo</span></pre><p id="ead1" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">在文件底部，键入以下内容:</p><pre class="li lj lk ll fq lm lh ln lo aw lp dt"><span id="be5e" class="kd ke ht lh b fv lq lr l ls lt">ec2-user ALL=(ALL) NOPASSWD: ALL<!-- --> </span></pre><p id="76d3" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">一些以太坊ETL相关的检查:</p><ul class=""><li id="cab4" class="jp jq ht is b it iu ix iy jb jr jf js jj jt jn ju jv jw jx dt translated">按照这里的说明安装Geth<a class="ae jo" href="https://geth.ethereum.org/docs/install-and-build/installing-geth" rel="noopener ugc nofollow" target="_blank">https://Geth . ether eum . org/docs/install-and-build/installing-Geth</a></li><li id="67f1" class="jp jq ht is b it jy ix jz jb ka jf kb jj kc jn ju jv jw jx dt translated">确保系统上安装了python 3.5或更高版本，并且<code class="eh le lf lg lh b">python3</code>二进制文件在<code class="eh le lf lg lh b">PATH</code>中。</li><li id="c9ef" class="jp jq ht is b it jy ix jz jb ka jf kb jj kc jn ju jv jw jx dt translated">将以太坊ETL克隆到<code class="eh le lf lg lh b">/home/ec2-user/ethereum-etl</code></li></ul><pre class="li lj lk ll fq lm lh ln lo aw lp dt"><span id="5ac2" class="kd ke ht lh b fv lq lr l ls lt">&gt; git clone <a class="ae jo" href="https://github.com/medvedev1088/ethereum-etl" rel="noopener ugc nofollow" target="_blank">https://github.com/medvedev1088/ethereum-etl</a><br/>&gt; cd ethereum-etl<br/>&gt; pip3 install -e .</span></pre><ul class=""><li id="a602" class="jp jq ht is b it iu ix iy jb jr jf js jj jt jn ju jv jw jx dt translated">确保geth下载了您想要导出的块:</li></ul><pre class="li lj lk ll fq lm lh ln lo aw lp dt"><span id="ccef" class="kd ke ht lh b fv lq lr l ls lt">&gt; geth attach <br/>&gt; eth.syncing<br/>{<br/>  currentBlock: <strong class="lh hu">5583296</strong>,<br/>  highestBlock: 5583377,<br/>  knownStates: 65750401,<br/>  pulledStates: 65729512,<br/>  startingBlock: 5268399<br/>}</span></pre><ul class=""><li id="b5ee" class="jp jq ht is b it iu ix iy jb jr jf js jj jt jn ju jv jw jx dt translated">确保geth在启动时启动。最简单的方法是将其添加到crontab:</li></ul><pre class="li lj lk ll fq lm lh ln lo aw lp dt"><span id="c4a2" class="kd ke ht lh b fv lq lr l ls lt">&gt; echo "nohup geth --cache=1024 &amp;" &gt; ~/geth/start.sh &amp;&amp; chmod +x ~/geth/start.sh<br/>&gt; crontab -e<br/>@reboot  /home/ec2-user/geth/start.sh &gt;&gt;/home/ec2-user/geth/crontab.log 2&gt;&amp;1</span></pre><ul class=""><li id="7e86" class="jp jq ht is b it iu ix iy jb jr jf js jj jt jn ju jv jw jx dt translated">下载并配置DataPipeline TaskRunner。相关说明可以在这里找到<a class="ae jo" href="https://docs.aws.amazon.com/datapipeline/latest/DeveloperGuide/dp-how-task-runner-user-managed.html" rel="noopener ugc nofollow" target="_blank">https://docs . AWS . Amazon . com/data pipeline/latest/developer guide/DP-how-task-runner-user-managed . html</a></li></ul><p id="eb67" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">下载完jar文件后，创建包含以下内容的<code class="eh le lf lg lh b">~/task-runner/start.sh</code>文件:</p><pre class="li lj lk ll fq lm lh ln lo aw lp dt"><span id="b7d3" class="kd ke ht lh b fv lq lr l ls lt">nohup java -jar /home/ec2-user/task-runner/TaskRunner-1.0.jar --config /home/ec2-user/task-runner/credentials.json --workerGroup=ethereum-etl --region=us-east-1 --logUri=s3://&lt;your_bucket&gt;/task-runner/logs --tasks 1 &amp;</span></pre><p id="769e" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">credentials.json文件应该包含您的访问权限和可以访问S3存储桶的帐户的密钥:</p><pre class="li lj lk ll fq lm lh ln lo aw lp dt"><span id="6072" class="kd ke ht lh b fv lq lr l ls lt">{ "access-id":<em class="ld">"MyAccessKeyID"</em>, "private-key": <em class="ld">"MySecretAccessKey"</em> }</span></pre><p id="a0b9" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">将其添加到crontab:</p><pre class="li lj lk ll fq lm lh ln lo aw lp dt"><span id="13ad" class="kd ke ht lh b fv lq lr l ls lt">chmod +x ~/task-runner/start.sh</span><span id="97f1" class="kd ke ht lh b fv lu lr l ls lt">crontab -e<br/>@reboot  /home/ec2-user/task-runner/start.sh &gt;&gt;/home/ec2-user/task-runner/crontab.log 2&gt;&amp;1</span></pre><ul class=""><li id="442f" class="jp jq ht is b it iu ix iy jb jr jf js jj jt jn ju jv jw jx dt translated">创建一个新的AMI并记住它的ID。它将在下一步中使用。</li></ul><h2 id="3b9d" class="kd ke ht bd kf kg kh ki kj kk kl km kn jb ko kp kq jf kr ks kt jj ku kv kw kx dt translated">创建数据管道</h2><p id="6a7d" class="pw-post-body-paragraph iq ir ht is b it ky iv iw ix kz iz ja jb la jd je jf lb jh ji jj lc jl jm jn hm dt translated">为了创建管道，我使用了对流层<a class="ae jo" href="https://github.com/cloudtools/troposphere" rel="noopener ugc nofollow" target="_blank">https://github.com/cloudtools/troposphere</a>，这是一个Python库来创建AWS云结构描述。</p><ul class=""><li id="cb84" class="jp jq ht is b it iu ix iy jb jr jf js jj jt jn ju jv jw jx dt translated">克隆以太坊导出管道:</li></ul><pre class="li lj lk ll fq lm lh ln lo aw lp dt"><span id="256b" class="kd ke ht lh b fv lq lr l ls lt">&gt; git clone <a class="ae jo" href="https://github.com/medvedev1088/ethereum-export-pipeline" rel="noopener ugc nofollow" target="_blank">https://github.com/medvedev1088/ethereum-export-pipeline</a><br/>&gt; cd ethereum-export-pipeline</span></pre><ul class=""><li id="cb7b" class="jp jq ht is b it iu ix iy jb jr jf js jj jt jn ju jv jw jx dt translated">编辑文件<code class="eh le lf lg lh b">config.py</code>并修改您想要导出的块范围。默认情况下，将导出前500万个块:</li></ul><figure class="li lj lk ll fq lv"><div class="bz el l di"><div class="lw lx l"/></div></figure><ul class=""><li id="38b3" class="jp jq ht is b it iu ix iy jb jr jf js jj jt jn ju jv jw jx dt translated">生成CloudFormation模板文件:</li></ul><pre class="li lj lk ll fq lm lh ln lo aw lp dt"><span id="28d5" class="kd ke ht lh b fv lq lr l ls lt">&gt; python3 generate_export_pipeline_template.py --output export_pipeline.template</span></pre><ul class=""><li id="f7d1" class="jp jq ht is b it iu ix iy jb jr jf js jj jt jn ju jv jw jx dt translated">登录https://console.aws.amazon.com/cloudformation/home?弗吉尼亚州的云形成控制台地区=美国东部-1 </li><li id="b715" class="jp jq ht is b it jy ix jz jb ka jf kb jj kc jn ju jv jw jx dt translated">通过指定生成的<code class="eh le lf lg lh b">export_pipeline.template</code>文件创建新的堆栈。您需要更改将上载CSV文件的存储桶名称。您也可以自定义<strong class="is hu">命令</strong>字段，例如，如果您只需要导出块、交易或ERC20传输，您可以删除部分脚本。</li></ul><figure class="li lj lk ll fq lv fe ff paragraph-image"><div role="button" tabindex="0" class="lz ma di mb bf mc"><div class="fe ff ly"><img src="../Images/0a2cd98d0cfde6ed3343e791f89c5c8b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WkWA8-yusd3dxFjv0-cY4g.png"/></div></div></figure><ul class=""><li id="b98c" class="jp jq ht is b it iu ix iy jb jr jf js jj jt jn ju jv jw jx dt translated">登录弗吉尼亚州北部<a class="ae jo" href="https://console.aws.amazon.com/datapipeline/home" rel="noopener ugc nofollow" target="_blank">https://console.aws.amazon.com/datapipeline/home</a>的数据管道控制台，确保管道已创建。您可以在建筑师视图中看到它。</li></ul><figure class="li lj lk ll fq lv fe ff paragraph-image"><div role="button" tabindex="0" class="lz ma di mb bf mc"><div class="fe ff mf"><img src="../Images/ee456daf876aa999c7a7be35edbf3fc1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NBJFSiwiy3ulP8FIrFFS8g.png"/></div></div></figure><p id="fb25" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">创建管道后，它将等待工人开始运行活动。</p><h2 id="3507" class="kd ke ht bd kf kg kh ki kj kk kl km kn jb ko kp kq jf kr ks kt jj ku kv kw kx dt translated">创建自动缩放组</h2><ul class=""><li id="9b6d" class="jp jq ht is b it ky ix kz jb mg jf mh jj mi jn ju jv jw jx dt translated">登录您所在地区的自动缩放控制台<a class="ae jo" href="https://console.aws.amazon.com/ec2/autoscaling/home" rel="noopener ugc nofollow" target="_blank">https://console.aws.amazon.com/ec2/autoscaling/home</a></li><li id="ab92" class="jp jq ht is b it jy ix jz jb ka jf kb jj kc jn ju jv jw jx dt translated"><strong class="is hu">创建启动配置:</strong></li><li id="b0c7" class="jp jq ht is b it jy ix jz jb ka jf kb jj kc jn ju jv jw jx dt translated">选择您在上一步中创建的AMI。</li><li id="3270" class="jp jq ht is b it jy ix jz jb ka jf kb jj kc jn ju jv jw jx dt translated">选择<code class="eh le lf lg lh b">t2.medium</code>实例类型。(正如AusIV在此指出的<a class="ae jo" href="https://www.reddit.com/r/ethdev/comments/8oyjz8/how_to_export_the_entire_ethereum_blockchain_to/" rel="noopener ugc nofollow" target="_blank">https://www . Reddit . com/r/ethdev/comments/8oyjz8/how _ export _ the _ all _ ether eum _区块链_ to/</a>T2】可能是一个更好的选择，如果您尝试了，请告诉我)</li><li id="e531" class="jp jq ht is b it jy ix jz jb ka jf kb jj kc jn ju jv jw jx dt translated">在配置详细信息页面上，选中<strong class="is hu">请求现货实例</strong>框，并指定您愿意支付的最高价格。它还会向您显示所选实例类型的当前现货价格。在我创作ASG的时候，现货价格比点播价格低3倍。</li></ul><figure class="li lj lk ll fq lv fe ff paragraph-image"><div class="fe ff mj"><img src="../Images/2fb65c70716ddc5dec6950fa342fa016.png" data-original-src="https://miro.medium.com/v2/resize:fit:1354/format:webp/1*ip4frl6sT3bzN1rCL04eOw.png"/></div></figure><ul class=""><li id="8ba0" class="jp jq ht is b it iu ix iy jb jr jf js jj jt jn ju jv jw jx dt translated">选择安全组并继续创建向导。</li><li id="090d" class="jp jq ht is b it jy ix jz jb ka jf kb jj kc jn ju jv jw jx dt translated"><strong class="is hu">创建自动缩放组:</strong></li><li id="adf1" class="jp jq ht is b it jy ix jz jb ka jf kb jj kc jn ju jv jw jx dt translated">选择您在上一步中创建的启动配置。</li><li id="0be8" class="jp jq ht is b it jy ix jz jb ka jf kb jj kc jn ju jv jw jx dt translated">指定组大小—您希望并行导出多少个CSV实例。</li><li id="bdc1" class="jp jq ht is b it jy ix jz jb ka jf kb jj kc jn ju jv jw jx dt translated">继续执行向导。</li></ul><p id="f06f" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">创建ASG后，您可以在“活动历史记录”选项卡中看到它启动新实例:</p><figure class="li lj lk ll fq lv fe ff paragraph-image"><div role="button" tabindex="0" class="lz ma di mb bf mc"><div class="fe ff mk"><img src="../Images/de007d3aae30ccdc8fdf43c1a8cb5520.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bCB2COAx3kC1jOhb3uTuhw.png"/></div></div></figure><p id="89cc" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">您可以检查您的数据管道，在数据管道控制台的<strong class="is hu">执行详细信息</strong>页面的实例上开始运行活动，为您提供所有的详细信息和日志:</p><figure class="li lj lk ll fq lv fe ff paragraph-image"><div role="button" tabindex="0" class="lz ma di mb bf mc"><div class="fe ff ml"><img src="../Images/955c78640d3fce69cd04c70aa632eac5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*T_xEK1f1aR39EjtPdRUAtQ.png"/></div></div></figure><p id="729a" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">每个实例一次将运行10个活动，不幸的是这个数字是不可定制的。</p><p id="f307" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">CSV文件将位于您在创建管道时指定的S3桶中。</p><p id="df31" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">该过程完成后，您需要手动删除自动缩放组和数据管道堆栈。</p><p id="9963" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">您可能希望将CSV转换为Parquet，以优化查询性能。你可以在这里找到说明:<a class="ae jo" rel="noopener" href="/@medvedev1088/converting-ethereum-etl-files-to-parquet-399e048ddd30">将以太坊ETL文件转换成拼花</a></p><p id="7185" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">另请参阅:</p><ul class=""><li id="a039" class="jp jq ht is b it iu ix iy jb jr jf js jj jt jn ju jv jw jx dt translated"><a class="ae jo" rel="noopener" href="/google-cloud/how-to-query-balances-for-all-ethereum-addresses-in-bigquery-fb594e4034a7">如何在BigQuery中查询所有以太坊地址的余额</a></li><li id="3111" class="jp jq ht is b it jy ix jz jb ka jf kb jj kc jn ju jv jw jx dt translated"><a class="ae jo" rel="noopener" href="/google-cloud/real-time-ethereum-notifications-for-everyone-for-free-a76e72e45026">实时以太坊免费通知大家</a></li><li id="c458" class="jp jq ht is b it jy ix jz jb ka jf kb jj kc jn ju jv jw jx dt translated"><a class="ae jo" href="https://cloud.google.com/blog/products/data-analytics/ethereum-bigquery-how-we-built-dataset" rel="noopener ugc nofollow" target="_blank">big query中的以太坊:我们如何构建这个数据集</a></li><li id="5cb7" class="jp jq ht is b it jy ix jz jb ka jf kb jj kc jn ju jv jw jx dt translated">在推特上关注我们:<a class="ae jo" href="https://twitter.com/EthereumETL" rel="noopener ugc nofollow" target="_blank">https://twitter.com/EthereumETL</a></li></ul></div></div>    
</body>
</html>