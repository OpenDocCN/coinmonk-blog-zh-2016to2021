<html>
<head>
<title>Hyperledger Fabric: Extending the FabCar network with ExpressJS REST Api</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Hyperledger Fabric:使用ExpressJS REST Api扩展FabCar网络</h1>
<blockquote>原文：<a href="https://medium.com/coinmonks/hyperledger-fabric-extending-the-fabcar-example-with-a-expressjs-rest-api-c270710ebbc9?source=collection_archive---------0-----------------------#2018-07-01">https://medium.com/coinmonks/hyperledger-fabric-extending-the-fabcar-example-with-a-expressjs-rest-api-c270710ebbc9?source=collection_archive---------0-----------------------#2018-07-01</a></blockquote><div><div class="ef hh hi hj hk hl"/><div class="hm hn ho hp hq"><div class=""/><figure class="fi fk ir is it iu fe ff paragraph-image"><div class="fe ff iq"><img src="../Images/82ae0ac6aa8af48d9dc8ade9e08d1809.png" data-original-src="https://miro.medium.com/v2/resize:fit:1280/format:webp/1*uUtslGr1xq4Kf_kuzB1Vaw.png"/></div></figure><h1 id="0cf9" class="ix iy ht bd iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju dt translated">开始前</h1><p id="d359" class="pw-post-body-paragraph jv jw ht jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks hm dt translated">我认为扩展从<strong class="jx hu"> Hyperledger Fabric </strong>文档提供的<a class="ae kt" href="http://hyperledger-fabric.readthedocs.io/en/latest/write_first_app.html" rel="noopener ugc nofollow" target="_blank">基本示例</a>中学习到的概念的最佳方式，如<a class="ae kt" href="http://hyperledger-fabric.readthedocs.io/en/latest/understand_fabcar_network.html" rel="noopener ugc nofollow" target="_blank"> fabcar </a>，是增加一层额外的复杂性。我在接下来的帖子中的意图是在<strong class="jx hu"> Salesforce </strong>中集成定制开发。</p><p id="84e8" class="pw-post-body-paragraph jv jw ht jx b jy ku ka kb kc kv ke kf kg kw ki kj kk kx km kn ko ky kq kr ks hm dt translated">在这种情况下，我将向<strong class="jx hu"> fabcar </strong>网络添加一个<a class="ae kt" href="https://expressjs.com/" rel="noopener ugc nofollow" target="_blank"> ExpressJS REST API </a>。</p><p id="a867" class="pw-post-body-paragraph jv jw ht jx b jy ku ka kb kc kv ke kf kg kw ki kj kk kx km kn ko ky kq kr ks hm dt translated">在我的案例中，我是在一个数字海洋的实例中完成的。但是你可以使用任何实例(<strong class="jx hu"> Heroku，...</strong>)按照步骤使用<strong class="jx hu"> Ubuntu 16.04 </strong>。</p><p id="fbba" class="pw-post-body-paragraph jv jw ht jx b jy ku ka kb kc kv ke kf kg kw ki kj kk kx km kn ko ky kq kr ks hm dt translated">首先，我推荐一下相关文献的讲座:</p><p id="6caf" class="pw-post-body-paragraph jv jw ht jx b jy ku ka kb kc kv ke kf kg kw ki kj kk kx km kn ko ky kq kr ks hm dt translated"><a class="ae kt" href="http://hyperledger-fabric.readthedocs.io/en/latest/understand_fabcar_network.html" rel="noopener ugc nofollow" target="_blank">了解Fabcar网络</a>。</p><p id="e08d" class="pw-post-body-paragraph jv jw ht jx b jy ku ka kb kc kv ke kf kg kw ki kj kk kx km kn ko ky kq kr ks hm dt translated"><a class="ae kt" href="http://hyperledger-fabric.readthedocs.io/en/latest/blockchain.html" rel="noopener ugc nofollow" target="_blank">简介</a></p><p id="c3e4" class="pw-post-body-paragraph jv jw ht jx b jy ku ka kb kc kv ke kf kg kw ki kj kk kx km kn ko ky kq kr ks hm dt translated">建立你的第一个人际网络</p><p id="22c9" class="pw-post-body-paragraph jv jw ht jx b jy ku ka kb kc kv ke kf kg kw ki kj kk kx km kn ko ky kq kr ks hm dt translated">然后按照<a class="ae kt" href="http://hyperledger-fabric.readthedocs.io/en/latest/write_first_app.html" rel="noopener ugc nofollow" target="_blank">编写你的第一个App </a>教程。我会推荐它，在本地做。</p><h1 id="1468" class="ix iy ht bd iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju dt translated">Fabcar网络架构:</h1><p id="b4fb" class="pw-post-body-paragraph jv jw ht jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks hm dt translated">根据文件:</p><blockquote class="kz la lb"><p id="7089" class="jv jw lc jx b jy ku ka kb kc kv ke kf ld kw ki kj le kx km kn lf ky kq kr ks hm dt translated">F <!-- --> abcar使用<strong class="jx hu">“基本网络”</strong>样本作为其有限开发网络。它由<strong class="jx hu">一个配置为使用<strong class="jx hu"> CouchDB </strong>作为状态数据库的单个对等节点</strong>，一个<strong class="jx hu">单个“solo”排序节点</strong>，<strong class="jx hu">一个认证机构(CA) </strong>和一个用于执行命令的<strong class="jx hu"> CLI容器组成。</strong></p></blockquote><p id="e26e" class="pw-post-body-paragraph jv jw ht jx b jy ku ka kb kc kv ke kf kg kw ki kj kk kx km kn ko ky kq kr ks hm dt">…</p><blockquote class="kz la lb"><p id="6445" class="jv jw lc jx b jy ku ka kb kc kv ke kf ld kw ki kj le kx km kn lf ky kq kr ks hm dt translated">这些组件由<code class="eh lg lh li lj b">./startFabric.sh</code>脚本引导，该脚本还:</p><p id="ec8a" class="jv jw lc jx b jy ku ka kb kc kv ke kf ld kw ki kj le kx km kn lf ky kq kr ks hm dt translated">1.创建一个通道并将对等体加入到通道中。</p><p id="a88c" class="jv jw lc jx b jy ku ka kb kc kv ke kf ld kw ki kj le kx km kn lf ky kq kr ks hm dt translated">2.将<code class="eh lg lh li lj b">fabcar</code>智能契约(fabric-samples/chain code/fab car)安装到对等方的文件系统上，并在通道上实例化它(实例化启动一个容器)</p><p id="4b9c" class="jv jw lc jx b jy ku ka kb kc kv ke kf ld kw ki kj le kx km kn lf ky kq kr ks hm dt translated">3.调用<code class="eh lg lh li lj b">initLedger</code>函数，用10辆不同的汽车填充渠道分类帐。</p></blockquote><h1 id="0483" class="ix iy ht bd iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju dt translated">安装ExpressJS</h1><p id="dbe3" class="pw-post-body-paragraph jv jw ht jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks hm dt translated">下一步是转到您的实例(记住您需要安装docker)，并安装<a class="ae kt" href="http://hyperledger-fabric.readthedocs.io/en/latest/install.html" rel="noopener ugc nofollow" target="_blank">需求</a>。</p><p id="2269" class="pw-post-body-paragraph jv jw ht jx b jy ku ka kb kc kv ke kf kg kw ki kj kk kx km kn ko ky kq kr ks hm dt translated">一个可选的步骤是检查到目前为止一切都好，再次做<a class="ae kt" href="http://hyperledger-fabric.readthedocs.io/en/latest/write_first_app.html" rel="noopener ugc nofollow" target="_blank">写你的第一个应用</a>，但是现在在实例中。</p><p id="97d7" class="pw-post-body-paragraph jv jw ht jx b jy ku ka kb kc kv ke kf kg kw ki kj kk kx km kn ko ky kq kr ks hm dt translated">所以如果一切正确，接下来就是安装文件夹<strong class="jx hu">中的express js-fabric-samples/fab car</strong>。只需遵循此处解释的标准程序:</p><div class="lk ll fm fo lm ln"><a href="https://expressjs.com/en/starter/installing.html" rel="noopener  ugc nofollow" target="_blank"><div class="lo ab ej"><div class="lp ab lq cl cj lr"><h2 class="bd hu fv z el ls eo ep lt er et hs dt translated">安装Express</h2><div class="lu l"><h3 class="bd b fv z el ls eo ep lt er et ek translated">要临时安装Express而不将其添加到依赖项列表中，请执行以下操作:</h3></div><div class="lv l"><p class="bd b gc z el ls eo ep lt er et ek translated">expressjs.com</p></div></div></div></a></div><p id="e1fa" class="pw-post-body-paragraph jv jw ht jx b jy ku ka kb kc kv ke kf kg kw ki kj kk kx km kn ko ky kq kr ks hm dt translated">然后，它需要创建<strong class="jx hu">server . js。</strong>你可以在我的<a class="ae kt" href="https://bitbucket.org/krukmat/fabcar-expressjs/src/master/fabcar/server.js" rel="noopener ugc nofollow" target="_blank">库</a>中查看我的例子。想法是发布教程中描述的<strong class="jx hu">查询</strong>方法。</p><p id="b39e" class="pw-post-body-paragraph jv jw ht jx b jy ku ka kb kc kv ke kf kg kw ki kj kk kx km kn ko ky kq kr ks hm dt translated">在这种情况下，NodeJS将在<strong class="jx hu"> 8080 </strong>运行，但是您可以更改它。</p><p id="42c9" class="pw-post-body-paragraph jv jw ht jx b jy ku ka kb kc kv ke kf kg kw ki kj kk kx km kn ko ky kq kr ks hm dt translated">因此，现在您可以简单地运行:</p><blockquote class="kz la lb"><p id="69c0" class="jv jw lc jx b jy ku ka kb kc kv ke kf ld kw ki kj le kx km kn lf ky kq kr ks hm dt translated">node server.js</p></blockquote><p id="e555" class="pw-post-body-paragraph jv jw ht jx b jy ku ka kb kc kv ke kf kg kw ki kj kk kx km kn ko ky kq kr ks hm dt translated">要检查它，您只需在本地实例中从终端执行curl操作:</p><pre class="lw lx ly lz fq ma lj mb mc aw md dt"><span id="8b77" class="me iy ht lj b fv mf mg l mh mi">curl http://localhost:8081/api/query</span></pre><p id="bcaa" class="pw-post-body-paragraph jv jw ht jx b jy ku ka kb kc kv ke kf kg kw ki kj kk kx km kn ko ky kq kr ks hm dt translated">您应该会看到这样的内容:</p><blockquote class="kz la lb"><p id="8d23" class="jv jw lc jx b jy ku ka kb kc kv ke kf ld kw ki kj le kx km kn lf ky kq kr ks hm dt translated"><em class="ht">{ " response ":"[{ \ " Key \ ":\ " car 0 \ "，\"Record\":{\"colour\":\"blue\ "，\"make\":\"Toyota\ "，\"model\":\"Prius\ "，\"owner\":\ "外川智子\"}，{\"Key\":\"CAR1\ "，\"Record\":{\"colour\":\"red\ "，\"make\":\"Ford\ "，\"model\":\"Mustang\ "，\"owner\":\"Brad\"}，{\"Key\":\"CAR2\ "，\ " Record \ ":{ \ " colour \ ":{ \ " colour</em></p></blockquote><p id="19c0" class="pw-post-body-paragraph jv jw ht jx b jy ku ka kb kc kv ke kf kg kw ki kj kk kx km kn ko ky kq kr ks hm dt translated">现在，我们需要设置接受来自实例的外部请求。接下来是数字海洋中需要的一些指南。</p><h1 id="27d9" class="ix iy ht bd iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju dt translated">外部访问的要求</h1><p id="b683" class="pw-post-body-paragraph jv jw ht jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks hm dt translated">下一个特别适用于数字海洋实例，但你可能会在Heroku，Google等其他服务中发现一些相似之处。您需要:</p><p id="3169" class="pw-post-body-paragraph jv jw ht jx b jy ku ka kb kc kv ke kf kg kw ki kj kk kx km kn ko ky kq kr ks hm dt translated"><a class="ae kt" href="https://www.digitalocean.com/community/tutorials/how-to-set-up-a-node-js-application-for-production-on-ubuntu-16-04" rel="noopener ugc nofollow" target="_blank">配置<strong class="jx hu"> </strong> NodeJS从Nginx </a>访问。</p><p id="60b3" class="pw-post-body-paragraph jv jw ht jx b jy ku ka kb kc kv ke kf kg kw ki kj kk kx km kn ko ky kq kr ks hm dt translated"><a class="ae kt" href="https://www.digitalocean.com/community/tutorials/iptables-essentials-common-firewall-rules-and-commands" rel="noopener ugc nofollow" target="_blank">配置iptables从外部访问网络</a></p><h1 id="ed07" class="ix iy ht bd iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju dt translated">结论</h1><p id="90d7" class="pw-post-body-paragraph jv jw ht jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks hm dt translated">这是一个在<strong class="jx hu"> Hyperledger Fabric </strong>和通过一个简单的<strong class="jx hu"> ExpressJS Rest API app </strong>给出输出之间集成的简单例子。</p><p id="92b9" class="pw-post-body-paragraph jv jw ht jx b jy ku ka kb kc kv ke kf kg kw ki kj kk kx km kn ko ky kq kr ks hm dt translated">下一次将是一个雄心勃勃的步骤:将这个API与<strong class="jx hu"> Salesforce中的定制开发集成。</strong></p><p id="6975" class="pw-post-body-paragraph jv jw ht jx b jy ku ka kb kc kv ke kf kg kw ki kj kk kx km kn ko ky kq kr ks hm dt translated">编码快乐！</p></div></div>    
</body>
</html>