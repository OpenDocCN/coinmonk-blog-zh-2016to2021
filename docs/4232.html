<html>
<head>
<title>Running a standalone private Geth node for non-production purpose</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">出于非生产目的运行独立的私有Geth节点</h1>
<blockquote>原文：<a href="https://medium.com/coinmonks/running-a-standalone-private-geth-node-for-non-production-purpose-d6e0ff226150?source=collection_archive---------4-----------------------#2021-03-18">https://medium.com/coinmonks/running-a-standalone-private-geth-node-for-non-production-purpose-d6e0ff226150?source=collection_archive---------4-----------------------#2021-03-18</a></blockquote><div><div class="ef hh hi hj hk hl"/><div class="hm hn ho hp hq"><div class=""/><div class=""><h2 id="480f" class="pw-subtitle-paragraph iq hs ht bd b ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ek translated">以最少的步骤导入具有足够预分配余额的预定义密钥。</h2></div><figure class="jj jk jl jm fq jn fe ff paragraph-image"><div role="button" tabindex="0" class="jo jp di jq bf jr"><div class="fe ff ji"><img src="../Images/afe1d7f057961ab10b79e10174f7bfe2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8qhslzVj-eRhjUj9ZXpiBw.jpeg"/></div></div><figcaption class="ju jv fg fe ff jw jx bd b be z ek">Photos by <a class="ae jy" href="https://unsplash.com/@xps" rel="noopener ugc nofollow" target="_blank">XPS</a> from <a class="ae jy" href="https://unsplash.com/" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><h1 id="3509" class="jz ka ht bd kb kc kd ke kf kg kh ki kj iz kk ja kl jc km jd kn jf ko jg kp kq dt translated">介绍</h1><p id="c21c" class="pw-post-body-paragraph kr ks ht kt b ku kv iu kw kx ky ix kz la lb lc ld le lf lg lh li lj lk ll lm hm dt translated">一个简单的以太坊节点对于测试或概念验证是必要的。虽然有众所周知的<a class="ae jy" href="https://github.com/trufflesuite/ganache" rel="noopener ugc nofollow" target="_blank"> Ganache </a>或者<a class="ae jy" href="https://github.com/trufflesuite/ganache-cli" rel="noopener ugc nofollow" target="_blank"> Ganache CLI </a>(正式名称为TestRPC)，但是有时候你可能想要在测试或者更早的环境中Geth。</p><p id="bfa0" class="pw-post-body-paragraph kr ks ht kt b ku ln iu kw kx lo ix kz la lp lc ld le lq lg lh li lr lk ll lm hm dt translated">以太网最昂贵的任务之一是保证账户安全(保护私钥不被泄露)。但是在<strong class="kt hu">非生产</strong>环境中，对账户的安全性要求不是很高，而是优选使用根本不安全的预定义密钥，以使提供初始余额的任务更加简单和可编程。在这些情况下，以下特征是有利的。</p><ul class=""><li id="a61d" class="ls lt ht kt b ku ln kx lo la lu le lv li lw lm lx ly lz ma dt translated"><strong class="kt hu">使用预定义的密钥自动创建预定义的账户。</strong></li><li id="6697" class="ls lt ht kt b ku mb kx mc la md le me li mf lm lx ly lz ma dt translated"><strong class="kt hu">预定义账户从一开始就自动解锁。</strong></li><li id="8d0e" class="ls lt ht kt b ku mb kx mc la md le me li mf lm lx ly lz ma dt translated"><strong class="kt hu">预定义账户有巨额余额。</strong>(为以后的特定应用账户提供足够的资金)</li><li id="d8ec" class="ls lt ht kt b ku mb kx mc la md le me li mf lm lx ly lz ma dt translated"><strong class="kt hu">更少的节点甚至只有一个节点就足够了。</strong></li></ul><p id="991c" class="pw-post-body-paragraph kr ks ht kt b ku ln iu kw kx lo ix kz la lp lc ld le lq lg lh li lr lk ll lm hm dt translated">Geth是传播最广泛的以太坊客户端软件，提供了许多强大的功能。这些特性似乎更侧重于生产环境，因此应用上述非面向生产的需求会相当复杂。<br/>对于Ganache CLI，只需使用<code class="eh mg mh mi mj b">--account</code>和<code class="eh mg mh mi mj b">--unlock</code>选项，即可满足上述要求。<br/>尽管Geth并不那么简单，但您仍然可以使用脚本预加载和genesis配置来满足这些要求。</p></div><div class="ab cl mk ml hb mm" role="separator"><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp"/></div><div class="hm hn ho hp hq"><h1 id="7c69" class="jz ka ht bd kb kc mr ke kf kg ms ki kj iz mt ja kl jc mu jd kn jf mv jg kp kq dt translated">准备钥匙</h1><p id="9464" class="pw-post-body-paragraph kr ks ht kt b ku kv iu kw kx ky ix kz la lb lc ld le lf lg lh li lj lk ll lm hm dt translated">下面显示了5个私钥和后面使用的相应地址。对于开发或测试环境，使用预定义的键没有问题，甚至是有利可图的。<br/>你可以通过在线生成器或像Python中的<code class="eh mg mh mi mj b"><a class="ae jy" href="https://eth-account.readthedocs.io/en/stable/" rel="noopener ugc nofollow" target="_blank">eth-account</a></code>这样的库轻松获得新的密钥和地址。</p><pre class="jj jk jl jm fq mw mj mx my aw mz dt"><span id="0d6e" class="na ka ht mj b fv nb nc l nd ne">[<br/>[ ba75c5fd16ae1151dc9f961e94e219994c6335a5b4148c624142243fb76306d6,<br/>  d3ae0500e21008c89ca4746be7522340c67f5730 ],<br/>[ 097dd6aedb87b3b5e541cfb9ef8d4beb7a66084dd80d99c2e51aeabeae320980,<br/>  76aaacd6169017644ba7530b7d956e1fcc0178ad ],<br/>[ abae82647f5881a398f7eede8910803d65470a7cbaee9ddda90dcdcdc8dcdacf,<br/>  eb875bb0eec43d779c4d539ca34e89fb0868d867 ],<br/>[ cc1af47cbc9de0c9a1e1049c1a62ddb9e08440d16093803d74e93f1cea3458ee,<br/>  0ccca39f9c169996c8380bf7c529dc3b9ff6198a ],<br/>[ 3e48c4e748b8f5baf6f870c5c4d2a0147390c94e778a9ca67de945bffeb2f72a,<br/>  d738b71007cffbec9b0a7e99088b132858f5e270 ],<br/>]</span></pre></div><div class="ab cl mk ml hb mm" role="separator"><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp"/></div><div class="hm hn ho hp hq"><h1 id="c037" class="jz ka ht bd kb kc mr ke kf kg ms ki kj iz mt ja kl jc mu jd kn jf mv jg kp kq dt translated">生成生成块</h1><p id="c62e" class="pw-post-body-paragraph kr ks ht kt b ku kv iu kw kx ky ix kz la lb lc ld le lf lg lh li lj lk ll lm hm dt translated">对于Geth，在启动新网络(即使是只有一个节点的专用网络)之前，应该使用如下genesis配置创建一个genesis块。</p><p id="e13b" class="pw-post-body-paragraph kr ks ht kt b ku ln iu kw kx lo ix kz la lp lc ld le lq lg lh li lr lk ll lm hm dt translated">起源配置可以定义特定账户的预付余额。下面的配置将为先前准备的每个帐户分配10个wei。<br/>该配置仅提供余额，但不会在服务器端创建这些帐户。您可以稍后在服务器或客户端(如MetaMask)上创建这些帐户。甚至它们已经在别处被创造出来了。不管怎样，这些账户在这个网络中会有巨大的余额。</p><pre class="jj jk jl jm fq mw mj mx my aw mz dt"><span id="8bca" class="na ka ht mj b fv nb nc l nd ne">{<br/>  "config": {<br/>    "chainId": 2021,<br/>    "homesteadBlock": 0,<br/>    "eip150Block": 0,<br/>    "eip155Block": 0,<br/>    "eip158Block": 0,<br/>    "byzantiumBlock": 0,<br/>    "constantinopleBlock": 0,<br/>    "petersburgBlock": 0,<br/>    "istanbulBlock": 0,    <br/>    "muirglacierblock": 0,<br/>    "ethash": {<br/>      "fixeddifficulty": 100<br/>    }<br/>  },<br/>  "nonce": "0x0",<br/>  "difficulty": "0x60",<br/>  "gasLimit": "0x1fffffffffffff",<br/>  "coinbase": "0x0000000000000000000000000000000000000000",<br/>  "alloc": {<br/><strong class="mj hu">    "d3ae0500e21008c89ca4746be7522340c67f5730": <br/>      { "balance": "10000000000000000000000" },<br/>    "76aaacd6169017644ba7530b7d956e1fcc0178ad":<br/>      { "balance": "10000000000000000000000" },<br/>    "eb875bb0eec43d779c4d539ca34e89fb0868d867":<br/>      { "balance": "10000000000000000000000" },<br/>    "0ccca39f9c169996c8380bf7c529dc3b9ff6198a":<br/>      { "balance": "10000000000000000000000" },<br/>    "d738b71007cffbec9b0a7e99088b132858f5e270":<br/>      { "balance": "10000000000000000000000" }<br/></strong>  }<br/>}</span></pre><p id="0a14" class="pw-post-body-paragraph kr ks ht kt b ku ln iu kw kx lo ix kz la lp lc ld le lq lg lh li lr lk ll lm hm dt translated">要生成一个genesis块，执行<code class="eh mg mh mi mj b">geth init</code>命令。该命令将只创建一个genesis块，而不启动服务器进程。</p><pre class="jj jk jl jm fq mw mj mx my aw mz dt"><span id="9c19" class="na ka ht mj b fv nb nc l nd ne">$ geth --datadir ./data <strong class="mj hu">init genesis.json</strong></span></pre></div><div class="ab cl mk ml hb mm" role="separator"><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp"/></div><div class="hm hn ho hp hq"><h1 id="9b8b" class="jz ka ht bd kb kc mr ke kf kg ms ki kj iz mt ja kl jc mu jd kn jf mv jg kp kq dt translated">启动独立Geth节点</h1><p id="828f" class="pw-post-body-paragraph kr ks ht kt b ku kv iu kw kx ky ix kz la lb lc ld le lf lg lh li lj lk ll lm hm dt translated">初始余额是分配的，所以在服务器上创建帐户并解锁它们就剩下了。即使在测试环境中，解锁几个有巨大余额的帐户也会造成无意的麻烦，尤其是对于有大量成员的项目。但是，在开发和测试时，它会方便得多。此外，如果网络只处理天然气，而不是货币，这些平衡不会产生严重的问题。<br/>当然，这些账户只能用于将必要的以太网分发到其他账户进行应用。预定义帐户不应直接用作应用程序帐户，应用程序帐户可能在智能合同上具有特殊角色和权限。</p><p id="1503" class="pw-post-body-paragraph kr ks ht kt b ku ln iu kw kx lo ix kz la lp lc ld le lq lg lh li lr lk ll lm hm dt translated">Geth不提供命令行选项来自动导入密钥/账户，尽管它有<code class="eh mg mh mi mj b">--unlock</code>选项和<code class="eh mg mh mi mj b">-password</code>选项来解锁已经创建的账户。所有这些情况都使得导入帐户和自动解锁帐户变得困难。<br/>但是，有一种方法可以在使用<code class="eh mg mh mi mj b"><strong class="kt hu">--preload</strong></code>或<code class="eh mg mh mi mj b">--exec</code>选项启动Geth时执行脚本。</p><p id="c156" class="pw-post-body-paragraph kr ks ht kt b ku ln iu kw kx lo ix kz la lp lc ld le lq lg lh li lr lk ll lm hm dt translated">下面是一个脚本导入密钥，解锁帐户，然后用第一个帐户启动一个miner线程。该脚本使用Geth的控制台API，包括<code class="eh mg mh mi mj b"><a class="ae jy" href="https://geth.ethereum.org/docs/rpc/ns-personal#personal_listaccounts" rel="noopener ugc nofollow" target="_blank"><strong class="kt hu">personal.listAccounts</strong></a></code>、<code class="eh mg mh mi mj b"><a class="ae jy" href="https://geth.ethereum.org/docs/rpc/ns-personal#personal_importrawkey" rel="noopener ugc nofollow" target="_blank"><strong class="kt hu">personal.importRawKey()</strong></a></code>、<code class="eh mg mh mi mj b"><a class="ae jy" href="https://geth.ethereum.org/docs/rpc/ns-personal#personal_unlockaccount" rel="noopener ugc nofollow" target="_blank"><strong class="kt hu">personal.unlockAccount()</strong></a></code>、<code class="eh mg mh mi mj b"><a class="ae jy" href="https://geth.ethereum.org/docs/rpc/ns-miner#miner_setetherbase" rel="noopener ugc nofollow" target="_blank"><strong class="kt hu">miner.setEtherbase()</strong></a></code>、<code class="eh mg mh mi mj b"><a class="ae jy" href="https://geth.ethereum.org/docs/rpc/ns-miner#miner_start" rel="noopener ugc nofollow" target="_blank"><strong class="kt hu">miner.start()</strong></a></code>函数。这些是Geth的原生函数，可以用比标准<code class="eh mg mh mi mj b">web3.js</code>更少的输入在Geth控制台中使用。</p><p id="fcd2" class="pw-post-body-paragraph kr ks ht kt b ku ln iu kw kx lo ix kz la lp lc ld le lq lg lh li lr lk ll lm hm dt translated"><code class="eh mg mh mi mj b"><strong class="kt hu">personal.importRawKey()</strong></code>函数导入指定的密钥，并用它创建一个新账户。这是持久的，因此足以被调用一次。但是，<code class="eh mg mh mi mj b"><strong class="kt hu">personal.unlockAccount()</strong></code>不是<strong class="kt hu">持久而是只在当前Geth实例下有效。因此，无论何时启动Geth进程，都需要调用解锁。</strong></p><figure class="jj jk jl jm fq jn"><div class="bz el l di"><div class="nf ng l"/></div></figure><p id="adc2" class="pw-post-body-paragraph kr ks ht kt b ku ln iu kw kx lo ix kz la lp lc ld le lq lg lh li lr lk ll lm hm dt translated">从1.9版本开始，Geth控制台基于ECMAScript 5.1的纯Go实现。因此，ECMAScript的最新特性，如<code class="eh mg mh mi mj b">await</code> / <code class="eh mg mh mi mj b">async</code>语句、<code class="eh mg mh mi mj b">let</code> / <code class="eh mg mh mi mj b">const</code>语句和<code class="eh mg mh mi mj b">for...of</code>循环，还没有包括在内。</p><p id="eb32" class="pw-post-body-paragraph kr ks ht kt b ku ln iu kw kx lo ix kz la lp lc ld le lq lg lh li lr lk ll lm hm dt translated">下面的命令行将启动一个独立的Geth实例来预处理上面的脚本。</p><pre class="jj jk jl jm fq mw mj mx my aw mz dt"><span id="154f" class="na ka ht mj b fv nb nc l nd ne">$ geth --datadir ./data --nodiscover --verbosity 2 --maxpeers 0 \<br/>       <strong class="mj hu">--allow-insecure-unlock</strong> \<br/>       <strong class="mj hu">--preload ./scripts/geth-setup-accounts.js</strong> \<br/>       --http --http.addr localhost --http.port 8545 \<br/>       console &gt;&gt; geth.log 2&gt;&amp;1</span></pre></div><div class="ab cl mk ml hb mm" role="separator"><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp"/></div><div class="hm hn ho hp hq"><h1 id="7a24" class="jz ka ht bd kb kc mr ke kf kg ms ki kj iz mt ja kl jc mu jd kn jf mv jg kp kq dt translated">快速试验</h1><p id="f646" class="pw-post-body-paragraph kr ks ht kt b ku kv iu kw kx ky ix kz la lb lc ld le lf lg lh li lj lk ll lm hm dt translated">Geth实例启动后，您可以通过<code class="eh mg mh mi mj b"><strong class="kt hu">geth attach</strong></code>命令从其他终端访问该流程。</p><p id="3688" class="pw-post-body-paragraph kr ks ht kt b ku ln iu kw kx lo ix kz la lp lc ld le lq lg lh li lr lk ll lm hm dt translated">下面是一个快速测试，显示一切正常。当重复自己时，在发送事务后需要一点时间。</p><figure class="jj jk jl jm fq jn fe ff paragraph-image"><div role="button" tabindex="0" class="jo jp di jq bf jr"><div class="fe ff nh"><img src="../Images/a12fe7268347a79b95292ff5a2655bfe.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wExaqxLiBJAdkqSLxNEcAw.png"/></div></div></figure></div></div>    
</body>
</html>