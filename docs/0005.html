<html>
<head>
<title>RavenDB com .NET Core</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">RavenDB 与 .NET Core</h1>
<blockquote>原文：<a href="https://medium.com/coinmonks/ravendb-com-net-core-1f008d7479a6?source=collection_archive---------2-----------------------#2017-07-04">https://medium.com/coinmonks/ravendb-com-net-core-1f008d7479a6?source=collection_archive---------2-----------------------#2017-07-04</a></blockquote><div><div class="ef hh hi hj hk hl"/><div class="hm hn ho hp hq"><div class=""/><p id="cb5d" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">使用 .NET Core 使用 NoSQL 数据库中的数据</p><figure class="jp jq jr js fq jt fe ff paragraph-image"><div class="fe ff jo"><img src="../Images/26f0519b28c6ef6b38a7e9d95a3c56d6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1040/format:webp/1*cZe5dEJHt0wmb8MSzlRwCA.png"/></div></figure><p id="c6c0" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">大家好,今天我们将介绍如何在.NET Core应用程序中访问NoSQL数据库中的数据。在本例中,我们将使用 RavenDB。</p><p id="0f27" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">什么是<strong class="is hu">RavenDB</strong>?在WEB 上快速搜索并翻译了一些文本,我们得出了以下结论:“<em class="jw"> RavenDB 是一个基于文档的数据库,我们不是像 SQL Server 或 MySQL 那样将数据存储在行和列中,而是将数据存储在 JSON 文档中。</em></p><p id="3753" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">最吸引我注意的一点是,它是在.NET中开发的,其代码由社区维护,这种情况在Microsoft项目中变得越来越普遍。如果你想冒险进入你的源代码,请关注 GitHub <a class="ae jx" href="https://github.com/ravendb/ravendb" rel="noopener ugc nofollow" target="_blank"> RavenDB </a> 和 <a class="ae jx" href="https://ravendb.net/docs/article-page/3.5/csharp" rel="noopener ugc nofollow" target="_blank"> 文档 </a> 的链接。</p><p id="cf0b" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">我们的第一步是安装<strong class="is hu"><em class="jw">RavenDB</em></strong>,之后我们将使用<em class="jw">Web API</em>模板创建一个.NET Core项目来执行我们的第一次集成。</p><p id="fabf" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">要安装<strong class="is hu">RavenDB</strong>很简单,只需在<a class="ae jx" href="https://ravendb.net/downloads" rel="noopener ugc nofollow" target="_blank">链接</a>下载它的可执行文件并选择稳定版本,之后默认的Windows<strong class="is hu">next</strong><strong class="is hu">next finish</strong>,一旦它完成安装和设置,它会在你的桌面上创建一个名为<strong class="is hu"><em class="jw">RavenDB Studio</em></strong><em class="jw">的快捷方式,只要点击它,它就会在你的浏览器中打开我们银行的管理。我们可以在下面的图片中看到第一步:</em></p><figure class="jp jq jr js fq jt fe ff paragraph-image"><div role="button" tabindex="0" class="jz ka di kb bf kc"><div class="fe ff jy"><img src="../Images/b249e064e3aea9976d0f164a3f0edf0d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*2v_0QYyfQc1c3u9e.png"/></div></div></figure><p id="7d12" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">现在我们已经安装了它,我们的下一步是创建我们的项目,在本文中,我们将使用 .NET Core API 模板。为了使帖子不会太长,我们将从VS 2017中使用上述模板创建的简单项目开始。随着项目的开放,我们现在需要添加对<strong class="is hu"> <em class="jw"> RevenDB </em> </strong>的依赖。为此,只需直接点击参考按钮,然后转到<strong class="is hu"><em class="jw">NuGet</em></strong>并选择包,如下图所示:</p><figure class="jp jq jr js fq jt fe ff paragraph-image"><div class="fe ff kd"><img src="../Images/31b0a6a75992606384ae4c6215663ca0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1358/format:webp/0*ioa5eC_ySneGnAYB.png"/></div></figure><p id="45a6" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">对于那些不熟悉.NET Core的新框架的人,上一步将为我们的项目依赖项添加一个新的引用,只需展开<em class="jw">依赖关系</em>-&gt;<em class="jw">Nuget</em>即可查看我们的.dll。我们可以在下面的图片中看到这一步。</p><figure class="jp jq jr js fq jt fe ff paragraph-image"><div class="fe ff ke"><img src="../Images/307fdac5c81464598a873a7f5abc8743.png" data-original-src="https://miro.medium.com/v2/resize:fit:754/format:webp/1*jEYAMjkPAb1Nsmx_Hy79Tg.png"/></div></figure><p id="df8f" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">在本文中,我们将使用动词<em class="jw">POST,GET,GET By Id,PUT和Delete</em>。让我们开始输入数据。为此,请将代码复制并粘贴到您的 <em class="jw"> Controller </em>,在本文中,我们将使用在新的.NET API项目中默认创建的 <em class="jw"> ValuesController </em>。</p><pre class="jp jq jr js fq kf kg kh ki aw kj dt"><span id="58fa" class="kk kl ht kg b fv km kn l ko kp">        [HttpPost]<br/>        public ActionResult Post([FromBody]User user)<br/>        {<br/>            if (user == null)<br/>            {<br/>                return NotFound("Sorry !!");<br/>            }</span><span id="0905" class="kk kl ht kg b fv kq kn l ko kp">using (var ds = new DocumentStore { Url = "<a class="ae jx" href="http://localhost:8024/" rel="noopener ugc nofollow" target="_blank">http://localhost:8024/</a>" }.Initialize())<br/>            {<br/>                using (var session = ds.OpenSession("db_home"))<br/>                {</span><span id="b0c0" class="kk kl ht kg b fv kq kn l ko kp">session.Store(user);<br/>                    session.SaveChanges();<br/>                }<br/>            }</span><span id="c14b" class="kk kl ht kg b fv kq kn l ko kp">return Ok("Congratulations !!");<br/>        }</span></pre><p id="745d" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">让我们理解上面的方法,我们正在创建一个实例<strong class="is hu"><em class="jw">DocumentStore</em></strong><strong class="is hu">RavenDB</strong>,并传递我们服务器的URL(快捷方式在浏览器中打开的URL),然后启动它。之后,我们打开一个会话与我们的文档 <strong class="is hu"> <em class="jw"> db_home, </em> </strong> 并输入数据到 <strong class="is hu"> session.Store </strong>,这将采取我们的新用户,并在调用后插入文档 <em class="jw"> SaveChanges </em> ()。</p><p id="b37c" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">现在我们需要创建我们的 <strong class="is hu"> 用户模型 </strong> 。为此,在您的<strong class="is hu">Solution<em class="jw"/></strong>中创建一个名为<strong class="is hu"><em class="jw">Model </em></strong>的新文件夹,并在其中创建一个名为<em class="jw">User </em>的类并将代码粘贴到下面。</p><pre class="jp jq jr js fq kf kg kh ki aw kj dt"><span id="fe66" class="kk kl ht kg b fv km kn l ko kp">    public class User<br/>    {<br/>        public Guid Id { get; private set; }<br/>        public string Name { get; set; }<br/>        public int Age { get; set; }<br/>    }</span></pre><p id="54cf" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">完成后,我们需要向我们的<strong class="is hu">API</strong>发送一个POST来插入我们的第一个记录。为此,我们将使用Postman作为Google Chrome插件,帮助我们测试HTTP请求。打开 Postman 后,在 Headers 中添加 Content-Type application/json,然后将代码粘贴到工具的正文中:</p><pre class="jp jq jr js fq kf kg kh ki aw kj dt"><span id="be26" class="kk kl ht kg b fv km kn l ko kp">{  <br/> "Name": "Thiago",<br/> "Age": "32"<br/> }</span></pre><p id="0b6a" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">现在轮流设计我们的API,然后发送帖子以创建我们的用户。</p><p id="90fa" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">现在让我们验证这一步,转到 <strong class="is hu"> RavenDB </strong> 的管理,注意我们现在在我们的文档中列出了我们的第一个记录。我们可以在下面的图片中看到这个结果:</p><figure class="jp jq jr js fq jt fe ff paragraph-image"><div role="button" tabindex="0" class="jz ka di kb bf kc"><div class="fe ff jy"><img src="../Images/9596bd7169d4bfa84706f2212c2de30a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*4OMCGzI9kPHF7_qi.png"/></div></div></figure><p id="3d52" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">现在我们转到Get方法,将代码复制到下面并粘贴到您的<strong class="is hu">控制器</strong> 。</p><pre class="jp jq jr js fq kf kg kh ki aw kj dt"><span id="b300" class="kk kl ht kg b fv km kn l ko kp">        [HttpGet]<br/>        public IList Get()<br/>        {<br/>            IList users = new List&lt;User&gt;();</span><span id="21e2" class="kk kl ht kg b fv kq kn l ko kp">using (var ds = new DocumentStore { Url = "<a class="ae jx" href="http://localhost:8024/" rel="noopener ugc nofollow" target="_blank">http://localhost:8024/</a>" }.Initialize())<br/>            {<br/>                using (var session = ds.OpenSession("db_home"))<br/>                {<br/>                    users = (from user in session.Query&lt;User&gt;()<br/>                             select user).ToList();<br/>                }<br/>            }</span><span id="8c75" class="kk kl ht kg b fv kq kn l ko kp">return users;<br/>        }</span></pre><p id="e91c" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">上面的代码类似于我们的POST代码,唯一的区别是我们正在执行查询并使用Linq获取所有数据,然后将其传递给我们的users变量。这里有趣的一点是,我们不需要进行解析,甚至不需要对d进行解析,它将识别数据并将其分配给我们的模型。下图显示了此步骤的结果:</p><figure class="jp jq jr js fq jt fe ff paragraph-image"><div class="fe ff kr"><img src="../Images/908f12bcabd7d074d2ac8e8d6e79a08e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1156/format:webp/1*-Vg-1HoNI8mlOYBDG48u8g.png"/></div></figure><p id="1e8c" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">现在,为了能够通过您的ID搜索我们的用户,只需将代码放入您的控制器即可。</p><pre class="jp jq jr js fq kf kg kh ki aw kj dt"><span id="a8cb" class="kk kl ht kg b fv km kn l ko kp">        [HttpGet("{id}")]<br/>        public User Get(Guid id)<br/>        {<br/>            using (var ds = new DocumentStore { Url = "<a class="ae jx" href="http://localhost:8024/" rel="noopener ugc nofollow" target="_blank">http://localhost:8024/</a>" }.Initialize())<br/>            {<br/>                using (var session = ds.OpenSession("db_home"))<br/>                {<br/>                    return session.Load&lt;User&gt;("users/" + id);<br/>                }<br/>            }<br/>         }</span></pre><p id="2ae2" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">注意,我们添加了一个新的代码,即 session.Load(),我们可以通过传递参数 users/id 来查找我们的用户。现在,为了让我们验证它,只需在浏览器中调用 /api/values 项目的 URL + 我们要查找的用户指南。</p><p id="426d" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">我们可以在下面的图像中看到这个结果,注意我们正在传递Guid作为参数,然后我们添加了一个断点,以便我们可以看到进入方法的代码。</p><figure class="jp jq jr js fq jt fe ff paragraph-image"><div role="button" tabindex="0" class="jz ka di kb bf kc"><div class="fe ff ks"><img src="../Images/e7c4fde550166f88eb0373447b6c57bd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nps3X9CdpNYmU39LeGZguw.png"/></div></div></figure><p id="f0ce" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">现在让我们更新我们的记录。为此,我们将使用方法<strong class="is hu">PUT</strong>,将代码粘贴到您的<strong class="is hu">Controller</strong>中,然后运行代码,以便我们可以使用Postman发送更新。</p><pre class="jp jq jr js fq kf kg kh ki aw kj dt"><span id="0d83" class="kk kl ht kg b fv km kn l ko kp">        [HttpPut("{id}")]<br/>        public void Put(Guid id, [FromBody]User user)<br/>        {<br/>            using (var ds = new DocumentStore { Url = "<a class="ae jx" href="http://localhost:8024/" rel="noopener ugc nofollow" target="_blank">http://localhost:8024/</a>" }.Initialize())<br/>            {<br/>                using (var session = ds.OpenSession("db_home"))<br/>                {<br/>                    user.Id = id;<br/>                    session.Store(user);<br/>                    session.SaveChanges();</span><span id="ee56" class="kk kl ht kg b fv kq kn l ko kp">              }<br/>            }<br/>        }</span></pre><p id="4946" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">我们可以观察到,该方法类似于我们的帖子,但由于我们正在传递我们的用户的ID,它将理解它不是一个新的记录,并更新而不是插入它。现在在Postman中,我们需要将我们的对象添加到您的body中:</p><pre class="jp jq jr js fq kf kg kh ki aw kj dt"><span id="af6f" class="kk kl ht kg b fv km kn l ko kp">{  <br/> "Name": "Thiago S Adriano",<br/> "Age": "32"<br/>}</span></pre><p id="4851" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">这样做,通过发送我们的对象,它将更新我们的注册表。</p><p id="d4a7" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">好吧,为了完成我们的文章,让我们创建我们的Delete方法。为此,将代码粘贴到您的<strong class="is hu">Controller</strong>中,注意它的语法类似于我们的<strong class="is hu">PUT</strong>方法。</p><pre class="jp jq jr js fq kf kg kh ki aw kj dt"><span id="a8a3" class="kk kl ht kg b fv km kn l ko kp">        // DELETE api/values/5<br/>        [HttpDelete("{id}")]<br/>        public void Delete(Guid id)<br/>        {<br/>            using (var ds = new DocumentStore { Url = "<a class="ae jx" href="http://localhost:8024/" rel="noopener ugc nofollow" target="_blank">http://localhost:8024/</a>" }.Initialize())<br/>            {<br/>                using (var session = ds.OpenSession("db_home"))<br/>                {<br/>                    var user = session.Load&lt;User&gt;("users/" + id);</span><span id="ca0a" class="kk kl ht kg b fv kq kn l ko kp">if (user != null)<br/>                    {<br/>                        session.Delete(user);<br/>                    }<br/>                }<br/>            }<br/>        }</span></pre><p id="faa7" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">现在再次使用Postman并传递我们的注册表ID,它将从我们的数据库中删除它。</p><p id="4ea2" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">因此,我们能够通过与NoSQL银行集成的.NET Core API Web应用程序的所有RestFul动词。请按照本文中的代码链接 <a class="ae jx" href="https://github.com/programadriano/apidotcore-ravenDB/blob/master/README.md" rel="noopener ugc nofollow" target="_blank"> github </a> 。</p><blockquote class="kt"><p id="2f8e" class="ku kv ht bd kw kx ky kz la lb lc jn ek translated">Get Best Software Deals Directly In Your Inbox(T11)</p></blockquote><figure class="le lf lg lh li jt fe ff paragraph-image"><a href="https://coincodecap.com/?utm_source=coinmonks"><div class="fe ff ld"><img src="../Images/7c0b3dfdcbfea594cc0ae7d4f9bf6fcb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1168/format:webp/0*OJ-qb5G6i863msBB.png"/></div></a></figure></div></div>    
</body>
</html>