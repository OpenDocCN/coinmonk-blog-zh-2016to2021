<html>
<head>
<title>ERC-777 A New Advanced Token Standard</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">ERC-777一种新的高级令牌标准</h1>
<blockquote>原文：<a href="https://medium.com/coinmonks/erc-777-a-new-advanced-token-standard-c841788ab3cb?source=collection_archive---------1-----------------------#2018-04-13">https://medium.com/coinmonks/erc-777-a-new-advanced-token-standard-c841788ab3cb?source=collection_archive---------1-----------------------#2018-04-13</a></blockquote><div><div class="ef hh hi hj hk hl"/><div class="hm hn ho hp hq"><div class=""/><p id="1dc3" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">ERC(以太坊征求意见)-777</p><p id="92dd" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">引入了一个新的高级令牌标准来建立一个演进的令牌标准，该标准吸取了approve()和前面提到的send-Token-to-contract-issue等错误概念。</p><p id="6d4f" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">此外，ERC-777使用新标准ERC-820:使用注册契约的伪自检，该注册契约允许注册契约的元数据，以提供简单类型的自检。这允许向后兼容和其他功能扩展，具体取决于对to地址的EIP-820查找所返回的ITokenRecipient，以及目标契约所实现的功能。</p><p id="2279" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">ERC-777从使用ERC-20令牌中吸取了很多经验，例如白名单运营商，提供符合以太网的send(…)接口，使用ERC-820覆盖和调整功能以实现向后兼容。</p><figure class="jp jq jr js fq jt fe ff paragraph-image"><div role="button" tabindex="0" class="ju jv di jw bf jx"><div class="fe ff jo"><img src="../Images/fef7fe2949033a06687fc620b26aec5c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7x0g2nRJi3wyzhaTqqG7_A.png"/></div></div><figcaption class="ka kb fg fe ff kc kd bd b be z ek">ERC-777 Token Transfer Messaging Calls</figcaption></figure><p id="b2c2" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">该标准试图改进广泛使用的<a class="ae ke" href="https://github.com/ethereum/EIPs/issues/20" rel="noopener ugc nofollow" target="_blank"> ERC-20 </a>令牌标准。该标准的主要优点是:</p><ol class=""><li id="c033" class="kf kg ht is b it iu ix iy jb kh jf ki jj kj jn kk kl km kn dt translated">使用与以太相同的原理，即令牌通过<code class="eh ko kp kq kr b">send(dest, value, data)</code>发送。</li><li id="7a71" class="kf kg ht is b it ks ix kt jb ku jf kv jj kw jn kk kl km kn dt translated">可以在任何契约和任何常规地址中定义一个<code class="eh ko kp kq kr b">tokensReceived</code>,当收到令牌时触发该代码。这避免了ERC-20标准中需要的双重呼叫。</li><li id="a433" class="kf kg ht is b it ks ix kt jb ku jf kv jj kw jn kk kl km kn dt translated">契约和常规地址都可以通过注册一个阻止发送的<code class="eh ko kp kq kr b">tokensToSend</code>函数来控制和拒绝它们发送的令牌。</li><li id="9574" class="kf kg ht is b it ks ix kt jb ku jf kv jj kw jn kk kl km kn dt translated">契约和常规地址都可以通过注册一个抛出拒绝接收令牌的<code class="eh ko kp kq kr b">tokensReceived</code>函数来控制和拒绝接收哪些令牌。</li><li id="2bcd" class="kf kg ht is b it ks ix kt jb ku jf kv jj kw jn kk kl km kn dt translated">令牌持有者可以“授权”和“撤销”能够管理其令牌的操作员。这些操作者通常是经过验证的合同，如交易所、支票处理器或自动收费系统。</li><li id="787a" class="kf kg ht is b it ks ix kt jb ku jf kv jj kw jn kk kl km kn dt translated">每个令牌交易包含一个<code class="eh ko kp kq kr b">userData</code>字节字段和一个类似的<code class="eh ko kp kq kr b">operatorData</code>——在运营商交易的情况下——分别由用户(发送者)和运营商自由使用，以将数据传递给接收者。</li><li id="de4a" class="kf kg ht is b it ks ix kt jb ku jf kv jj kw jn kk kl km kn dt translated">它可以以向后兼容的方式用于不包含<code class="eh ko kp kq kr b">tokensReceived</code>功能的钱包。</li></ol><h2 id="6e2b" class="kx ky ht bd kz la lb lc ld le lf lg lh jb li lj lk jf ll lm ln jj lo lp lq lr dt translated">规格</h2><p id="d553" class="pw-post-body-paragraph iq ir ht is b it ls iv iw ix lt iz ja jb lu jd je jf lv jh ji jj lw jl jm jn hm dt translated">ERC-777代币(代币合同)</p><pre class="jp jq jr js fq lx kr ly lz aw ma dt"><span id="7a23" class="kx ky ht kr b fv mb mc l md me">interface ERC777Token {</span><span id="372f" class="kx ky ht kr b fv mf mc l md me">function name() public constant returns (string);</span><span id="4bd8" class="kx ky ht kr b fv mf mc l md me">function symbol() public constant returns (string);</span><span id="b4f0" class="kx ky ht kr b fv mf mc l md me">function totalSupply() public constant returns (uint256);</span><span id="bf17" class="kx ky ht kr b fv mf mc l md me">function granularity() public constant returns (uint256);</span><span id="6cfc" class="kx ky ht kr b fv mf mc l md me">function balanceOf(address owner) public constant returns (uint256);</span><span id="6531" class="kx ky ht kr b fv mf mc l md me"><br/>// transfer is modified to send in ERC-777</span><span id="f93b" class="kx ky ht kr b fv mf mc l md me">function send(address to, uint256 amount) public;</span><span id="740b" class="kx ky ht kr b fv mf mc l md me">function send(address to, uint256 amount, bytes userData) public;<br/></span><span id="36ce" class="kx ky ht kr b fv mf mc l md me">function authorizeOperator(address operator) public;</span><span id="7c16" class="kx ky ht kr b fv mf mc l md me">function revokeOperator(address operator) public;</span><span id="b368" class="kx ky ht kr b fv mf mc l md me">function isOperatorFor(address operator, address tokenHolder) public constant returns (bool);</span><span id="698d" class="kx ky ht kr b fv mf mc l md me">function operatorSend(address from, address to, uint256 amount, bytes userData, bytes operatorData) public;<br/></span><span id="a968" class="kx ky ht kr b fv mf mc l md me">event Sent(</span><span id="006b" class="kx ky ht kr b fv mf mc l md me">address indexed operator,</span><span id="534d" class="kx ky ht kr b fv mf mc l md me">address indexed from,</span><span id="b7b2" class="kx ky ht kr b fv mf mc l md me">address indexed to,</span><span id="e305" class="kx ky ht kr b fv mf mc l md me">uint256 amount,</span><span id="f8ac" class="kx ky ht kr b fv mf mc l md me">bytes userData,</span><span id="6351" class="kx ky ht kr b fv mf mc l md me">bytes operatorData</span><span id="5333" class="kx ky ht kr b fv mf mc l md me">);</span><span id="961d" class="kx ky ht kr b fv mf mc l md me">event Minted(address indexed operator, address indexed to, uint256 amount, bytes operatorData);</span><span id="c5a3" class="kx ky ht kr b fv mf mc l md me">event Burned(address indexed operator, address indexed from, uint256 amount, bytes userData, bytes operatorData);</span><span id="db0f" class="kx ky ht kr b fv mf mc l md me">event AuthorizedOperator(address indexed operator, address indexed tokenHolder);</span><span id="6765" class="kx ky ht kr b fv mf mc l md me">event RevokedOperator(address indexed operator, address indexed tokenHolder);</span><span id="6192" class="kx ky ht kr b fv mf mc l md me">}</span></pre><p id="a1b3" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">令牌合同必须通过ERC-820注册<code class="eh ko kp kq kr b">ERC777Token</code>接口。</p><p id="5c54" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">基本单位令牌必须是10 ⁸</p><h2 id="5844" class="kx ky ht bd kz la lb lc ld le lf lg lh jb li lj lk jf ll lm ln jj lo lp lq lr dt translated">标志；徽标</h2><figure class="jp jq jr js fq jt fe ff paragraph-image"><div class="fe ff mg"><img src="../Images/6f4eab8f7f06b73e4d98efc57fdc00bc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1370/format:webp/1*0dzH18K3qWqukxIT1twf6A.png"/></div><figcaption class="ka kb fg fe ff kc kd bd b be z ek">ERC-777 Token Standard Logo</figcaption></figure><p id="a21d" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">该徽标根据<a class="ae ke" href="http://creativecommons.org/licenses/by-sa/4.0/" rel="noopener ugc nofollow" target="_blank">知识共享署名-共享4.0国际许可协议</a>进行许可，附加限制是该徽标不得用于广告、宣传或以任何方式与不符合ERC-777标准的技术(如令牌)相关联。</p><h2 id="bdf1" class="kx ky ht bd kz la lb lc ld le lf lg lh jb li lj lk jf ll lm ln jj lo lp lq lr dt translated">基本原理</h2><p id="e9fc" class="pw-post-body-paragraph iq ir ht is b it ls iv iw ix lt iz ja jb lu jd je jf lv jh ji jj lw jl jm jn hm dt translated">该标准解决了<a class="ae ke" href="https://github.com/ethereum/EIPs/issues/223" rel="noopener ugc nofollow" target="_blank"> EIP-223 </a>的一些问题，并通过允许运营商(通常是合同)以与允许无限<code class="eh ko kp kq kr b">approve</code>的ERC-20相同的方式管理令牌而更进一步。</p><p id="e648" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">此外，ERC-820的使用允许向后兼容钱包和代理合同，而不必重新部署。</p><h2 id="5198" class="kx ky ht bd kz la lb lc ld le lf lg lh jb li lj lk jf ll lm ln jj lo lp lq lr dt translated">向后兼容性(ERC-20令牌)</h2><p id="dc94" class="pw-post-body-paragraph iq ir ht is b it ls iv iw ix lt iz ja jb lu jd je jf lv jh ji jj lw jl jm jn hm dt translated">这个EIP没有引入向后不兼容性，并且与旧的ERC-20令牌标准兼容。</p><p id="5a9c" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">这个EIP没有使用<code class="eh ko kp kq kr b">transfer</code>和<code class="eh ko kp kq kr b">transferFrom</code>，而是使用<code class="eh ko kp kq kr b">send</code>和<code class="eh ko kp kq kr b">operatorSend</code>来避免错误地知道你正在使用哪个接口。</p><p id="cea0" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">该标准允许实现ERC-20功能<code class="eh ko kp kq kr b">transfer</code>、<code class="eh ko kp kq kr b">transferFrom</code>、<code class="eh ko kp kq kr b">approve</code>和<code class="eh ko kp kq kr b">allowance</code>，以使令牌与ERC-20兼容。</p><p id="fe90" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">令牌可以实现<code class="eh ko kp kq kr b">decimals()</code>以实现向后兼容性。如果实现，它必须总是返回18。</p><p id="5d24" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">因此，一个令牌合同可以同时实现ERC-20和ERC-777。只读功能(如<code class="eh ko kp kq kr b">name</code>、<code class="eh ko kp kq kr b">symbol</code>、<code class="eh ko kp kq kr b">balanceOf</code>、<code class="eh ko kp kq kr b">totalSupply</code>)和内部数据(如余额映射)重叠没有问题。但是请注意，以下功能在ERC-777中是强制性的，必须执行:<code class="eh ko kp kq kr b">name</code>、<code class="eh ko kp kq kr b">symbol</code>。(<code class="eh ko kp kq kr b">decimal</code>不是ERC-777标准的一部分。)</p><p id="d28f" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">两种标准的写入方法是分离的，可以彼此独立操作。请注意，ERC-20函数应该仅限于从旧的契约中调用。</p><p id="8e61" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">如果令牌合同实现了ERC-20，则必须通过ERC-820注册<code class="eh ko kp kq kr b">ERC20Token</code>接口。如果契约具有启用或禁用ERC-20方法的开关，则每次触发该开关时，令牌契约必须通过ERC-820相应地注册或注销<code class="eh ko kp kq kr b">ERC20Token</code>接口。</p><p id="e9ab" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">执行ERC-20的新合同的唯一区别是通过ERC-820登记<code class="eh ko kp kq kr b">ERC777TokensSender</code>和<code class="eh ko kp kq kr b">ERC777TokensRecipient</code>优先于ERC-20。这意味着，即使在ERC-20 <code class="eh ko kp kq kr b">transfer</code>调用中，令牌合约也必须通过ERC-820检查<code class="eh ko kp kq kr b">from</code> / <code class="eh ko kp kq kr b">to</code>地址是否实现了<code class="eh ko kp kq kr b">tokensToSend</code> / <code class="eh ko kp kq kr b">tokensReceived</code>，并在可用时调用它。注意，当调用合同上的ERC-20 <code class="eh ko kp kq kr b">transfer</code>时，如果合同没有实现<code class="eh ko kp kq kr b">tokensReceived</code>，那么<code class="eh ko kp kq kr b">transfer</code>调用仍然应该被接受，即使这意味着令牌可能会被锁定。</p><p id="247c" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">下表总结了通过ERC-777和ERC-20发送、铸造和转移令牌时，令牌合同必须采取的不同措施:</p><p id="2070" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">如果<code class="eh ko kp kq kr b">tokensToSend</code>未执行，则无需采取特殊措施。转让必须继续进行，只有在另一个条件未被满足时，如缺乏资金或<code class="eh ko kp kq kr b">tokensReceived</code>中的一个障碍，转让才被取消。</p><p id="0616" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated"><strong class="is hu">优点:</strong></p><p id="b8d5" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">深思熟虑、不断发展的令牌接口，从ERC协议20的使用中汲取经验</p><p id="335f" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">使用新的标准请求ERC-820进行自检，允许增加功能</p><p id="fefc" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">白名单操作符非常有用，比批准/允许更有必要，因为批准/允许通常是无限的</p><p id="ee0b" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated"><strong class="is hu"> CONS: </strong></p><p id="4413" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">才刚刚开始，复杂的构造需要依赖契约调用</p><p id="8cec" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">依赖性增加了安全问题的可能性:首先，安全问题不是在ERC-777飞机上发现的(并得到解决)，而是在更新的ERC-820飞机上发现的</p><p id="ba2e" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated"><strong class="is hu">ERC 20令牌的问题:</strong></p><p id="16a4" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">如何将代币转换为合约？</p><p id="0fa3" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">-我们可以将代币发送到任何以太坊地址，这意味着我们也可以将代币发送到不支持代币的合同，永久锁定代币。</p><p id="8759" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">-更糟糕的是:即使令牌可以手动移动，也很难区分哪些令牌来自谁，并尝试将它们发送回去。</p><p id="a5a6" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">解决方案:ERC20曾经有一个“批准”功能，允许您批准转移到一个合同，然后创建第二个事务，让合同知道它已经被批准。</p><p id="1441" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">ERC777允许在不需要以太网的情况下进行链外签名传输，或使用zksnarks或ring签名为令牌添加隐私的私有传输。</p><p id="a530" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated"><strong class="is hu">ERC 777的特点:</strong></p><p id="6fb4" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">1)向后兼容</p><p id="c8bd" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">-使其与ERC20更重要的功能兼容</p><p id="91c8" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">2)更安全、更简单地发送至合同</p><p id="a199" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">-引入了一个新的传输函数，该函数添加了一个名为bytes的字段，您可以在该字段中向传输添加任何标识信息，它会自动让接收合同知道发生了传输。</p><p id="be1b" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">3)将十进制设置为默认值18</p><p id="8cbd" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">4)添加批准的操作员</p><h2 id="3dfa" class="kx ky ht bd kz la lb lc ld le lf lg lh jb li lj lk jf ll lm ln jj lo lp lq lr dt translated"><strong class="ak">参考文献</strong></h2><p id="c658" class="pw-post-body-paragraph iq ir ht is b it ls iv iw ix lt iz ja jb lu jd je jf lv jh ji jj lw jl jm jn hm dt translated"><em class="mh"> Github EIP问题777:</em><a class="ae ke" href="https://github.com/ethereum/EIPs/issues/777" rel="noopener ugc nofollow" target="_blank">T5】https://github.com/ethereum/EIPs/issues/777</a></p><p id="831d" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated"><em class="mh"> Github本标准的官方资源库:</em><a class="ae ke" href="https://github.com/jacquesd/eip777" rel="noopener ugc nofollow" target="_blank"><em class="mh">jacquesd/EIP 777</em></a><em class="mh">。</em></p><figure class="jp jq jr js fq jt"><div class="bz el l di"><div class="mi mj l"/></div></figure></div></div>    
</body>
</html>