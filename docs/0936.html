<html>
<head>
<title>Ethereum Smart Contracts in Azure</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Azure中的以太坊智能合约</h1>
<blockquote>原文：<a href="https://medium.com/coinmonks/ethereum-smart-contracts-in-azure-99a1768a585e?source=collection_archive---------5-----------------------#2018-07-03">https://medium.com/coinmonks/ethereum-smart-contracts-in-azure-99a1768a585e?source=collection_archive---------5-----------------------#2018-07-03</a></blockquote><div><div class="ef hh hi hj hk hl"/><div class="hm hn ho hp hq"><div class=""/><figure class="fi fk ir is it iu fe ff paragraph-image"><div class="fe ff iq"><img src="../Images/b92cfe3795548dbf17a1e9249d7039b8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1238/format:webp/1*NKR2ylT_9V-oAVvvpIu9lw.png"/></div></figure><p id="c356" class="pw-post-body-paragraph ix iy ht iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju hm dt translated">最近，以太坊在加密货币领域加快了步伐。截至本博客发表之日，1 ETH等于474美元。截至目前，这是继比特币之后需求第二大的加密货币。</p><p id="6267" class="pw-post-body-paragraph ix iy ht iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju hm dt translated">在Azure中，我们可以使用以太坊创建自己的私人区块链。这篇博客是关于如何建立Azure区块链联盟以及如何在你的本地机器上建立一个开发环境的。然后，我们将创建一个示例智能契约，并在本地测试它。最后，我们将把经过测试的智能合约部署到Azure以太坊区块链中。</p><p id="ac61" class="pw-post-body-paragraph ix iy ht iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju hm dt translated"><strong class="iz hu">成立Azure以太坊区块链联盟</strong></p><p id="6757" class="pw-post-body-paragraph ix iy ht iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju hm dt translated">可以如下设置以太坊区块链Azure。</p><p id="c9bc" class="pw-post-body-paragraph ix iy ht iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju hm dt translated">首先创建一个Azure帐户。你可以免费预装200美元来创建它。前往portal.azure.com的<a class="ae jv" href="https://portal.azure.com/" rel="noopener ugc nofollow" target="_blank">创建您的账户。</a></p><p id="faad" class="pw-post-body-paragraph ix iy ht iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju hm dt translated">账号创建完成后，需要创建以太坊财团领袖，以区块链开始。搜索以太坊中的一切，并执行以下步骤。</p><figure class="jx jy jz ka fq iu fe ff paragraph-image"><div class="fe ff jw"><img src="../Images/40d7fab769ba27201d431271bbd45aed.png" data-original-src="https://miro.medium.com/v2/resize:fit:1260/format:webp/0*u1DgchDj9nLaguW5.png"/></div></figure><p id="9a37" class="pw-post-body-paragraph ix iy ht iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju hm dt translated">然后你需要如下创建以太坊网络。</p><figure class="jx jy jz ka fq iu fe ff paragraph-image"><div class="fe ff kb"><img src="../Images/cc2e9cee6583608d48904a51f72d55cb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1130/format:webp/0*k20lAwuUWZZ1YicF.png"/></div></figure><p id="55b0" class="pw-post-body-paragraph ix iy ht iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju hm dt translated">创建网络后，您需要如下设置基本设置。</p><figure class="jx jy jz ka fq iu fe ff paragraph-image"><div class="fe ff jw"><img src="../Images/9cd0ed551641b4ac3e28570318fa1ef7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1260/format:webp/0*jqkVSrt3tWvjd_dT.png"/></div></figure><p id="af6a" class="pw-post-body-paragraph ix iy ht iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju hm dt translated">然后，您需要指定网络规模和性能。挖掘节点的数量决定了执行挖掘过程的速度。接下来，您需要执行以太网凭证设置。验证过程后，您可以购买网络。</p><figure class="jx jy jz ka fq iu fe ff paragraph-image"><div class="fe ff jw"><img src="../Images/55c0079bce6b424f02d54cc6af9a4a8b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1260/format:webp/0*sNGese_P3YDnMTtk.png"/></div></figure><p id="757f" class="pw-post-body-paragraph ix iy ht iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju hm dt translated">在Azure中部署新创建的区块链网络需要一些时间。</p><p id="d8c4" class="pw-post-body-paragraph ix iy ht iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju hm dt translated">成功部署后，您将能够获得如下设置。</p><figure class="jx jy jz ka fq iu fe ff paragraph-image"><div class="fe ff kc"><img src="../Images/d7c6b0f9914077abc807ce9878fc772b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1138/format:webp/0*EHEup75Q1NOjtOaG.png"/></div></figure><p id="aa29" class="pw-post-body-paragraph ix iy ht iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju hm dt translated">您可以访问管理站点并查看您的网络状态，如下所示。</p><figure class="jx jy jz ka fq iu fe ff paragraph-image"><div class="fe ff jw"><img src="../Images/ac7ad4727ebff131cf64a5c42e0aab4f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1260/format:webp/0*FA8mDZ0ArpQpik7M.png"/></div></figure><p id="649a" class="pw-post-body-paragraph ix iy ht iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju hm dt translated">所以现在我们有足够的乙醚来玩了。</p><p id="529d" class="pw-post-body-paragraph ix iy ht iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju hm dt translated">我们可以通过使用Metamask ( MetaMask是一个Chrome插件，可以充当加密货币钱包)进行一些交易来测试新创建的以太坊端点。</p><p id="0c07" class="pw-post-body-paragraph ix iy ht iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju hm dt translated">您可以在MetaMask中输入Azure Ethereum RPC端点，并按如下方式进行连接。</p><figure class="jx jy jz ka fq iu fe ff paragraph-image"><div role="button" tabindex="0" class="kd ke di kf bf kg"><div class="fe ff jw"><img src="../Images/2d529213c400a8f34ae6140e2b8d154a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1260/format:webp/0*Yn1ORbH7YnmpNhBk.png"/></div></div></figure><p id="fe1e" class="pw-post-body-paragraph ix iy ht iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju hm dt translated">然后你可以从你的Azure帐户发送一些乙醚到这个钱包作为测试。将元掩码地址复制到剪贴板，然后发送如下内容。</p><figure class="jx jy jz ka fq iu fe ff paragraph-image"><div class="fe ff jw"><img src="../Images/bfc7027be929d40d4e1373730938e20d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1260/format:webp/0*MBHO4Vwhdy13RI_v.png"/></div></figure><p id="70e3" class="pw-post-body-paragraph ix iy ht iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju hm dt translated"><strong class="iz hu">设置开发环境</strong></p><p id="2b45" class="pw-post-body-paragraph ix iy ht iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju hm dt translated">我希望现在你已经了解了区块链的基本原理。现在是建立环境开始我们的开发工作的好时机。以下是我们将在此设置中使用的工具列表。</p><ol class=""><li id="364b" class="kh ki ht iz b ja jb je jf ji kj jm kk jq kl ju km kn ko kp dt translated">铬</li><li id="c5bb" class="kh ki ht iz b ja kq je kr ji ks jm kt jq ku ju km kn ko kp dt translated">元掩码</li><li id="b301" class="kh ki ht iz b ja kq je kr ji ks jm kt jq ku ju km kn ko kp dt translated">Visual Studio(我使用的是企业版，但是Visual Studio代码对于我们的工作来说已经足够了)</li><li id="cfc3" class="kh ki ht iz b ja kq je kr ji ks jm kt jq ku ju km kn ko kp dt translated">NodeJS包管理器</li><li id="d9b5" class="kh ki ht iz b ja kq je kr ji ks jm kt jq ku ju km kn ko kp dt translated">巧克力</li><li id="cbe2" class="kh ki ht iz b ja kq je kr ji ks jm kt jq ku ju km kn ko kp dt translated">饭桶</li><li id="803d" class="kh ki ht iz b ja kq je kr ji ks jm kt jq ku ju km kn ko kp dt translated">Windows构建工具</li><li id="234a" class="kh ki ht iz b ja kq je kr ji ks jm kt jq ku ju km kn ko kp dt translated">测试RPC</li><li id="d4f4" class="kh ki ht iz b ja kq je kr ji ks jm kt jq ku ju km kn ko kp dt translated">松露</li></ol><p id="3eea" class="pw-post-body-paragraph ix iy ht iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju hm dt translated">MetaMask:这是一个chrome插件，你可以从这个<a class="ae jv" href="https://www.google.lk/url?sa=t&amp;rct=j&amp;q=&amp;esrc=s&amp;source=web&amp;cd=1&amp;cad=rja&amp;uact=8&amp;ved=0ahUKEwiXjeavoe_VAhXMqo8KHTJxAcQQFggjMAA&amp;url=https%3A%2F%2Fchrome.google.com%2Fwebstore%2Fdetail%2Fmetamask%2Fnkbihfbeogaeaoehlefnkodbefgpgknn&amp;usg=AFQjCNE5yVOgbJ5sdbIuFRiPl0TMEdCbpg" rel="noopener ugc nofollow" target="_blank">链接</a>获得。</p><p id="aab9" class="pw-post-body-paragraph ix iy ht iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju hm dt translated">Visual Studio:可以获得免费版的<a class="ae jv" href="https://code.visualstudio.com/download" rel="noopener ugc nofollow" target="_blank"> Visual Studio代码</a>。</p><p id="4f88" class="pw-post-body-paragraph ix iy ht iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju hm dt translated">Node JS:从<a class="ae jv" href="https://nodejs.org/en/" rel="noopener ugc nofollow" target="_blank">这里</a>取。</p><p id="178a" class="pw-post-body-paragraph ix iy ht iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju hm dt translated">Chocolatey:我们需要使用PowerShell(在Windows中)来安装所需的软件包。首先，我们需要将PowerShell执行策略更改为“RemoteSign ”,如下所示。这允许我们运行安装巧克力所需的脚本。</p><pre class="jx jy jz ka fq kv kw kx ky aw kz dt"><span id="4611" class="la lb ht kw b fv lc ld l le lf"><em class="lg">Set-ExecutionPolicy -ExecutionPolicy RemoteSigned</em></span></pre><p id="ef58" class="pw-post-body-paragraph ix iy ht iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju hm dt translated">然后转到Chocolatey站点，复制以下命令进行安装。</p><pre class="jx jy jz ka fq kv kw kx ky aw kz dt"><span id="e880" class="la lb ht kw b fv lc ld l le lf"><em class="lg">iex ((New-Object System.Net.WebClient).DownloadString(‘https://chocolatey.org/install.ps1'))</em></span></pre><p id="9183" class="pw-post-body-paragraph ix iy ht iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju hm dt translated">GIT:我们可以使用choco命令来安装GIT。</p><pre class="jx jy jz ka fq kv kw kx ky aw kz dt"><span id="7244" class="la lb ht kw b fv lc ld l le lf"><em class="lg">choco install git</em></span></pre><p id="783c" class="pw-post-body-paragraph ix iy ht iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju hm dt translated">这将安装其他有用的组件，如SSH。</p><p id="8da0" class="pw-post-body-paragraph ix iy ht iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju hm dt translated">然后，我们需要使用以下命令使用NPM安装节点附加构建工具。</p><pre class="jx jy jz ka fq kv kw kx ky aw kz dt"><span id="8fc2" class="la lb ht kw b fv lc ld l le lf"><em class="lg">npm install -g node-gyp</em></span></pre><p id="6c6d" class="pw-post-body-paragraph ix iy ht iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju hm dt translated">然后，Windows使用以下命令构建工具。</p><pre class="jx jy jz ka fq kv kw kx ky aw kz dt"><span id="4394" class="la lb ht kw b fv lc ld l le lf"><em class="lg">npm install — global — production windows-build-tools</em></span></pre><p id="98a8" class="pw-post-body-paragraph ix iy ht iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju hm dt translated">接下来，我们需要安装名为Test-RPC的本地以太坊测试服务器，以便测试我们的区块链。</p><pre class="jx jy jz ka fq kv kw kx ky aw kz dt"><span id="5683" class="la lb ht kw b fv lc ld l le lf"><em class="lg">npm install -g ethereumjs-testrpc</em></span></pre><p id="7f18" class="pw-post-body-paragraph ix iy ht iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju hm dt translated">接下来是松露工具集。Truffle用于执行我们的智能合约代码的编译。</p><pre class="jx jy jz ka fq kv kw kx ky aw kz dt"><span id="becf" class="la lb ht kw b fv lc ld l le lf"><em class="lg">npm install -g truffle</em></span></pre><p id="8aa5" class="pw-post-body-paragraph ix iy ht iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju hm dt translated"><strong class="iz hu">智能合同基础知识</strong></p><p id="05b1" class="pw-post-body-paragraph ix iy ht iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju hm dt translated">我们将使用名为Solidity的语言来创建我们的智能合约。比特币区块链也支持这种语言。</p><p id="eec0" class="pw-post-body-paragraph ix iy ht iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju hm dt translated">Solidity是一种面向对象的Javascript风格的语言。这是2014年首次推出的。</p><p id="6de5" class="pw-post-body-paragraph ix iy ht iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju hm dt translated">首先，我们需要使用Solidity创建一个项目。我们可以使用Truffle创建一个示例演示应用程序。使用Powershell为您的项目创建一个文件夹，并使用以下命令创建一个项目。</p><pre class="jx jy jz ka fq kv kw kx ky aw kz dt"><span id="0538" class="la lb ht kw b fv lc ld l le lf"><em class="lg">truffle init</em></span></pre><p id="4876" class="pw-post-body-paragraph ix iy ht iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju hm dt translated">您可以使用Visual Studio代码打开这个项目，您将看到init命令相应地创建了几个文件夹和文件。</p><p id="b0b0" class="pw-post-body-paragraph ix iy ht iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju hm dt translated">在合同文件夹中创建以下文件，并给出扩展名。sol(例如:HelloWorld.sol)</p><figure class="jx jy jz ka fq iu fe ff paragraph-image"><div class="fe ff lh"><img src="../Images/fe9e6df5d9a6af305ef752a11b6c8d87.png" data-original-src="https://miro.medium.com/v2/resize:fit:744/format:webp/0*QmikDlt8l8TnY4zE.png"/></div></figure><pre class="jx jy jz ka fq kv kw kx ky aw kz dt"><span id="ec66" class="la lb ht kw b fv lc ld l le lf">1  pragma solidity ^<strong class="kw hu">0.4</strong>.<strong class="kw hu">4</strong>;<br/>2<br/>3  contract HelloWorld<br/>4  {<br/>5          <strong class="kw hu">function</strong> SayHello() returns (string) {<br/>6                <strong class="kw hu">return</strong> ("Hello World!");<br/>7          }<br/>8  }</span></pre><p id="316f" class="pw-post-body-paragraph ix iy ht iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju hm dt translated">我们在这里使用的是0.4.4版本的solidity，整个项目必须在一个特定的solidity版本下运行。在本例中，我们创建了一个简单Helloworld契约，并返回一个字符串值。</p><p id="cd78" class="pw-post-body-paragraph ix iy ht iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju hm dt translated">您需要做的下一件事是更新部署工件。转到deploy_contracts文件，并按如下方式更新它。truffle init命令创建了很少的其他契约和部署工件。只是暂时忽略它们，并相应地更新HelloWorld。</p><pre class="jx jy jz ka fq kv kw kx ky aw kz dt"><span id="98de" class="la lb ht kw b fv lc ld l le lf"> 1  <strong class="kw hu">var</strong> ConvertLib = artifacts.require("./ConvertLib.sol");<br/> 2  <strong class="kw hu">var</strong> MetaCoin = artifacts.require("./MetaCoin.sol");<br/> 3  <strong class="kw hu">var</strong> HelloWorld = artifcats.require("./HelloWorld.sol");<br/> 4<br/> 5  module.exports = <strong class="kw hu">function</strong>(deployer) {<br/> 6     deployer.deploy(ConvertLib);<br/> 7     deployer.link(ConvertLib, MetaCoin);<br/> 8     deployer.deploy(MetaCoin);<br/> 9     deployer.deploy(HelloWorld);<br/>10  };</span></pre><p id="e109" class="pw-post-body-paragraph ix iy ht iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju hm dt translated"><strong class="iz hu">测试智能合约</strong></p><p id="2c0b" class="pw-post-body-paragraph ix iy ht iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju hm dt translated">我们需要使用已经安装的TestRPC来测试创建的智能契约。打开Poweshell终端并启动TestRPC实例，如下所示。</p><figure class="jx jy jz ka fq iu fe ff paragraph-image"><div class="fe ff jw"><img src="../Images/4c2daa3d6c7f7928da18bd778d22baae.png" data-original-src="https://miro.medium.com/v2/resize:fit:1260/format:webp/0*gjlMvyLsoryTprRj.png"/></div></figure><p id="4d7d" class="pw-post-body-paragraph ix iy ht iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju hm dt translated">正如您所看到的，TestRPC服务器运行在端口8545上，它创建了一组私钥和帐户来开始我们的测试。</p><p id="0510" class="pw-post-body-paragraph ix iy ht iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju hm dt translated">使用以下命令编译代码。</p><p id="5ace" class="pw-post-body-paragraph ix iy ht iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju hm dt translated"><em class="lg">松露编译</em></p><p id="e24d" class="pw-post-body-paragraph ix iy ht iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju hm dt translated">编译成功后，您需要将合同迁移到区块链中。</p><p id="4390" class="pw-post-body-paragraph ix iy ht iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju hm dt translated"><em class="lg">块菌迁徙</em></p><figure class="jx jy jz ka fq iu fe ff paragraph-image"><div class="fe ff li"><img src="../Images/f030aeef8f1d324006d943b367738a1c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1072/format:webp/0*o_LkSJP1Q0w2xgri.png"/></div></figure><p id="7b75" class="pw-post-body-paragraph ix iy ht iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju hm dt translated">您可以看到，成功迁移后会创建相应的地址。</p><p id="7119" class="pw-post-body-paragraph ix iy ht iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju hm dt translated">您可以使用truffle控制台编写一个小的Javascript代码，并测试您的合同应用程序，如下所示。</p><figure class="jx jy jz ka fq iu fe ff paragraph-image"><div class="fe ff jw"><img src="../Images/0a3f2b84c40c928be9de37e97fd4e212.png" data-original-src="https://miro.medium.com/v2/resize:fit:1260/format:webp/0*T87aPOVY5TuM6jdH.png"/></div></figure><p id="8890" class="pw-post-body-paragraph ix iy ht iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju hm dt translated"><strong class="iz hu">签订智能合同</strong></p><p id="9794" class="pw-post-body-paragraph ix iy ht iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju hm dt translated">所以现在我们做了HelloWorld应用程序。但是让我们尝试用智能合同做一些现实的事情，它与我们的Azure以太坊区块链相关联。撰写智能合同有4个主要步骤。</p><p id="a8fb" class="pw-post-body-paragraph ix iy ht iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju hm dt translated">1.写</p><p id="eac8" class="pw-post-body-paragraph ix iy ht iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju hm dt translated">2.编制</p><p id="6418" class="pw-post-body-paragraph ix iy ht iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju hm dt translated">3.部署</p><p id="dd8b" class="pw-post-body-paragraph ix iy ht iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju hm dt translated">4.互动</p><p id="a5b4" class="pw-post-body-paragraph ix iy ht iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju hm dt translated">创建一个新目录(在我的例子中是MarksDemo ),初始化一个truffle项目，并使用Visual Studio打开，如前一步所述。删除所有不需要的sol文件和部署工件。</p><p id="6fb6" class="pw-post-body-paragraph ix iy ht iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju hm dt translated">添加以下sol文件并编译。</p><pre class="jx jy jz ka fq kv kw kx ky aw kz dt"><span id="dd7a" class="la lb ht kw b fv lc ld l le lf"> 1 pragma solidity ^<strong class="kw hu">0.4</strong>.<strong class="kw hu">4</strong>;<br/> 2 contract MarksStore{<br/> 3     mapping(string =&gt; <strong class="kw hu">int</strong>) StudentMarks;<br/> 4     <strong class="kw hu">function</strong> AddPersonScore(string name, <strong class="kw hu">int</strong> startingMarks){<br/> 5         <strong class="kw hu">if</strong>(StudentMarks[name]&gt;<strong class="kw hu">0</strong>)<br/> 6         {<br/> 7             assert(<strong class="kw hu">true</strong>);<br/> 8         }<br/> 9         <strong class="kw hu">else</strong>{<br/>10        StudentMarks[name] = startingMarks;<br/>11        }        <br/>12   }<br/>13<br/>14   <strong class="kw hu">function</strong> GetMarks(string name) returns (<strong class="kw hu">int</strong>){<br/>15        <strong class="kw hu">return</strong> StudentMarks[name];<br/>16    }<br/>17    <br/>18 }</span></pre><p id="58ba" class="pw-post-body-paragraph ix iy ht iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju hm dt translated">运行测试RPC服务器并迁移已编译的协定。</p><p id="e9b4" class="pw-post-body-paragraph ix iy ht iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju hm dt translated">打开松露控制台，执行以下命令</p><p id="2c1b" class="pw-post-body-paragraph ix iy ht iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju hm dt translated"><em class="lg"> &gt; var标志</em></p><p id="cf13" class="pw-post-body-paragraph ix iy ht iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju hm dt translated"><em class="lg"> &gt; MarksStore.deployed()。然后(function(deployed){ marks = deployed；});</em></p><p id="48af" class="pw-post-body-paragraph ix iy ht iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju hm dt translated"><em class="lg">标记&gt;标记。AddPersonScore("Priyal "，27)；</em></p><p id="f46e" class="pw-post-body-paragraph ix iy ht iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju hm dt translated">您将能够看到添加了块哈希、交易哈希、块序列号等的联系人..</p><figure class="jx jy jz ka fq iu fe ff paragraph-image"><div class="fe ff jw"><img src="../Images/07224e19462e30aaf2935c656e12ef88.png" data-original-src="https://miro.medium.com/v2/resize:fit:1260/format:webp/0*G_LIkOshpeMhMqlx.png"/></div></figure><p id="a6c7" class="pw-post-body-paragraph ix iy ht iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju hm dt translated">您可以使用GetMarks方法来检索持久标记。</p><p id="f534" class="pw-post-body-paragraph ix iy ht iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju hm dt translated"><em class="lg"> &gt;标记。get marks . call(" Priyal ")；</em></p><p id="a53a" class="pw-post-body-paragraph ix iy ht iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju hm dt translated">你将能够成功地看到结果。</p><p id="17f1" class="pw-post-body-paragraph ix iy ht iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju hm dt translated"><strong class="iz hu">将智能合约部署到Azure区块链</strong></p><p id="7e31" class="pw-post-body-paragraph ix iy ht iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju hm dt translated">到目前为止，我们已经测试了本地TestRPC服务器中的所有内容。现在是时候把我们的合同发给Azure区块链了。</p><p id="26fd" class="pw-post-body-paragraph ix iy ht iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju hm dt translated">为此，我们需要在truffle.js文件中输入一个条目，指定我们的生产环境，如下所示。</p><pre class="jx jy jz ka fq kv kw kx ky aw kz dt"><span id="84d1" class="la lb ht kw b fv lc ld l le lf"> 1  module.exports = {<br/> 2    networks: {<br/> 3      development: {<br/> 4        host: "localhost",<br/> 5        port: <strong class="kw hu">8545</strong>,<br/> 6        network_id: "*" // Match any network id<br/> 7      },<br/> 8        production: {<br/> 9        host: "bcgvy6jty.eastus.cloudapp.azure.com",<br/>10        port: <strong class="kw hu">8545</strong>,<br/>11        network_id: "*" // Match any network id<br/>12      }<br/>13  <br/>14    }<br/>15  };</span></pre><p id="832a" class="pw-post-body-paragraph ix iy ht iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju hm dt translated">生产主机是您的Azure以太坊-RPC-端点地址。</p><p id="84e0" class="pw-post-body-paragraph ix iy ht iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju hm dt translated">然后尝试使用以下命令进行部署</p><p id="7dca" class="pw-post-body-paragraph ix iy ht iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju hm dt translated"><em class="lg"> &gt;块菌迁移—网络生产</em></p><p id="7341" class="pw-post-body-paragraph ix iy ht iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju hm dt translated">你肯定会得到一个错误:)。这是因为我们的Azure端点不信任我们的连接，它正在防止未经授权的更改。为了解决这个问题，我们需要使用SSH登录Azure端点并执行以下更改。</p><p id="5fcd" class="pw-post-body-paragraph ix iy ht iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju hm dt translated">要登录SSH会话，我们需要使用Azure中的SSH-TO-FIRST-TX-NODE参数。</p><p id="6deb" class="pw-post-body-paragraph ix iy ht iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju hm dt translated">使用SSH-TO-FIRST-TX-NODE中的值连接到SSH门户。</p><p id="4bfb" class="pw-post-body-paragraph ix iy ht iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju hm dt translated">然后，您需要连接到geth控制台，如下所示。</p><p id="09a0" class="pw-post-body-paragraph ix iy ht iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju hm dt translated"><em class="lg">T27】geth attach</em></p><p id="918b" class="pw-post-body-paragraph ix iy ht iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju hm dt translated">当提示符可用时，键入以下命令解锁。</p><figure class="jx jy jz ka fq iu fe ff paragraph-image"><div class="fe ff jw"><img src="../Images/b99e89d1dda9bade6b90cd5e3bf3e7f4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1260/format:webp/0*ZlTb_8NnEsRxKBue.png"/></div></figure><p id="1a01" class="pw-post-body-paragraph ix iy ht iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju hm dt translated">在TX节点中工作时，保持此控制台打开。</p><p id="c0a0" class="pw-post-body-paragraph ix iy ht iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju hm dt translated">现在，它应该成功迁移，如下所示。</p><figure class="jx jy jz ka fq iu fe ff paragraph-image"><div class="fe ff lj"><img src="../Images/6dc23254b57a57b8071f7dc33fb52b6a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1084/format:webp/0*ORphRPyzrg0PQPrr.png"/></div></figure><p id="6a2f" class="pw-post-body-paragraph ix iy ht iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju hm dt translated">然后，我们可以在Azure中创建一个智能合约，并使用AddMarks和GetMarks方法测试功能，就像我们在本地网络中进行开发一样。</p><h1 id="291b" class="lk lb ht bd ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg dt translated"><strong class="ak">结论</strong></h1><p id="a0a6" class="pw-post-body-paragraph ix iy ht iz b ja mh jc jd je mi jg jh ji mj jk jl jm mk jo jp jq ml js jt ju hm dt translated">在这篇博文中，我们在Azure cloud中部署了一个全功能的以太坊智能合约，并使用Metamask wallet测试了交易。然后，我们在本地以太坊网络中构建并测试一个简单的智能合约，然后将其部署到我们的Azure区块链中。</p><p id="df20" class="pw-post-body-paragraph ix iy ht iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju hm dt translated">我希望您已经对Azure中的智能合约开发和部署有了基本的了解。</p><p id="626b" class="pw-post-body-paragraph ix iy ht iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju hm dt translated">感谢阅读！</p></div></div>    
</body>
</html>