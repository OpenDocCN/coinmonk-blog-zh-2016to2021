<html>
<head>
<title>EOSIO Smart Contracts Tutorial</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">EOSIO智能合同教程</h1>
<blockquote>原文：<a href="https://medium.com/coinmonks/eosio-smart-contracts-tutorial-f22c3bb364d9?source=collection_archive---------0-----------------------#2018-04-29">https://medium.com/coinmonks/eosio-smart-contracts-tutorial-f22c3bb364d9?source=collection_archive---------0-----------------------#2018-04-29</a></blockquote><div><div class="ef hh hi hj hk hl"/><div class="hm hn ho hp hq"><div class=""/><figure class="fi fk ir is it iu fe ff paragraph-image"><div role="button" tabindex="0" class="iv iw di ix bf iy"><div class="fe ff iq"><img src="../Images/39979dad47644b5c2a4af3eea4e3e2c8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*-pvfRYlVYVr7__nY."/></div></div><figcaption class="jb jc fg fe ff jd je bd b be z ek"><a class="ae jf" href="https://www.investinblockchain.com/eosio-dawn/" rel="noopener ugc nofollow" target="_blank">source</a></figcaption></figure><h1 id="00bb" class="jg jh ht bd ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd dt translated">0.必需的背景知识</h1><ul class=""><li id="b3da" class="ke kf ht kg b kh ki kj kk kl km kn ko kp kq kr ks kt ku kv dt translated"><strong class="kg hu"> C / C++体验</strong></li><li id="dda6" class="ke kf ht kg b kh kw kj kx kl ky kn kz kp la kr ks kt ku kv dt translated"><strong class="kg hu"> Linux / Mac OS体验</strong></li><li id="69db" class="ke kf ht kg b kh kw kj kx kl ky kn kz kp la kr ks kt ku kv dt translated"><strong class="kg hu">命令行知识</strong></li></ul><h1 id="2ef6" class="jg jh ht bd ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd dt translated">1.EOSIO智能合约的基础知识</h1><h2 id="306b" class="lb jh ht bd ji lc ld le jm lf lg lh jq kl li lj ju kn lk ll jy kp lm ln kc lo dt translated">1.1.通信模型</h2><p id="b55d" class="pw-post-body-paragraph lp lq ht kg b kh ki lr ls kj kk lt lu kl lv lw lx kn ly lz ma kp mb mc md kr hm dt translated">EOSIO智能合约以动作和共享内存数据库访问的形式相互通信。合同中可以定义两种通信模式:</p><ul class=""><li id="dd0f" class="ke kf ht kg b kh me kj mf kl mg kn mh kp mi kr ks kt ku kv dt translated"><strong class="kg hu">内嵌</strong>。保证Inline与当前事务一起执行或展开；无论成功或失败，都不会传达任何通知。内联操作具有与原始事务相同的作用域和权限。</li><li id="ad09" class="ke kf ht kg b kh kw kj kx kl ky kn kz kp la kr ks kt ku kv dt translated"><strong class="kg hu">延期</strong>。延期将由制作人自行决定；可以传递通信结果，也可以简单地超时。延期可以到达不同的范围，并携带发送它们的契约的权限。</li></ul><blockquote class="mj"><p id="3f84" class="mk ml ht bd mm mn mo mp mq mr ms kr ek translated"><a class="ae jf" href="https://coincodecap.com" rel="noopener ugc nofollow" target="_blank">发现并回顾最佳区块链软件</a></p></blockquote><h2 id="131c" class="lb jh ht bd ji lc mt le jm lf mu lh jq kl mv lj ju kn mw ll jy kp mx ln kc lo dt translated">1.2.行动与交易</h2><p id="9dc6" class="pw-post-body-paragraph lp lq ht kg b kh ki lr ls kj kk lt lu kl lv lw lx kn ly lz ma kp mb mc md kr hm dt translated">一个动作代表一个操作，而一个事务是一个或多个动作的集合。一个契约和一个账户以行动的形式交流。动作可以单独发送，或者以组合的形式发送，如果它们打算作为一个整体执行的话。</p><h2 id="3de7" class="lb jh ht bd ji lc ld le jm lf lg lh jq kl li lj ju kn lk ll jy kp lm ln kc lo dt translated">1.3.交易确认</h2><p id="a06c" class="pw-post-body-paragraph lp lq ht kg b kh ki lr ls kj kk lt lu kl lv lw lx kn ly lz ma kp mb mc md kr hm dt translated">接收到一个事务散列并不意味着该事务已经被确认，它只意味着该节点无误地接受了它，这也意味着有很大概率其他生产者会接受它。</p><p id="1bc3" class="pw-post-body-paragraph lp lq ht kg b kh me lr ls kj mf lt lu kl my lw lx kn mz lz ma kp na mc md kr hm dt translated">通过确认，您应该可以在交易历史记录中看到该交易及其包含的块号。</p><h1 id="b3c2" class="jg jh ht bd ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd dt translated">2.启动私有区块链</h1><p id="fc43" class="pw-post-body-paragraph lp lq ht kg b kh ki lr ls kj kk lt lu kl lv lw lx kn ly lz ma kp mb mc md kr hm dt translated">您可以使用以下命令启动自己的单节点区块链:</p><pre class="nb nc nd ne fq nf ng nh ni aw nj dt"><span id="9f2d" class="lb jh ht ng b fv nk nl l nm nn">$ nodeos -e -p eosio --plugin eosio::wallet_api_plugin --plugin eosio::chain_api_plugin --plugin eosio::account_history_api_plugin</span></pre><p id="1b6c" class="pw-post-body-paragraph lp lq ht kg b kh me lr ls kj mf lt lu kl my lw lx kn mz lz ma kp na mc md kr hm dt translated">假设一切正常，您应该每0.5秒看到一条块生成消息。</p><p id="61e6" class="pw-post-body-paragraph lp lq ht kg b kh me lr ls kj mf lt lu kl my lw lx kn mz lz ma kp na mc md kr hm dt translated">这意味着您当地的区块链是活的，生产块，并准备使用。</p><h1 id="459e" class="jg jh ht bd ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd dt translated">3.创建钱包</h1><p id="4769" class="pw-post-body-paragraph lp lq ht kg b kh ki lr ls kj kk lt lu kl lv lw lx kn ly lz ma kp mb mc md kr hm dt translated">钱包是授权在区块链上进行操作所必需的私有密钥的存储库。这些密钥存储在使用为您生成的密码加密的磁盘上。该密码应存储在安全的密码管理器中。</p><pre class="nb nc nd ne fq nf ng nh ni aw nj dt"><span id="3c76" class="lb jh ht ng b fv nk nl l nm nn">$ cleos wallet create<br/>Creating wallet: default<br/>Save password to use in the future to unlock this wallet.<br/>Without password imported keys will not be retrievable.<br/>"PW5JuBXoXJ8JHiCTXfXcYuJabjF9f9UNNqHJjqDVY7igVffe3pXub"</span></pre><p id="10d9" class="pw-post-body-paragraph lp lq ht kg b kh me lr ls kj mf lt lu kl my lw lx kn mz lz ma kp na mc md kr hm dt translated">出于这个简单开发环境的目的，您的钱包由您的本地<code class="eh no np nq ng b">nodeos</code>通过我们在启动<code class="eh no np nq ng b">nodeos</code>时启用的<code class="eh no np nq ng b">eosio::wallet_api_plugin</code>来管理。无论何时重启<code class="eh no np nq ng b">nodeos</code>，你都必须先解锁钱包，然后才能使用里面的钥匙。</p><pre class="nb nc nd ne fq nf ng nh ni aw nj dt"><span id="4394" class="lb jh ht ng b fv nk nl l nm nn">$ cleos wallet unlock --password PW5JuBXoXJ8JHiCTXfXcYuJabjF9f9UNNqHJjqDVY7igVffe3pXub<br/>Unlocked: default</span></pre><p id="de65" class="pw-post-body-paragraph lp lq ht kg b kh me lr ls kj mf lt lu kl my lw lx kn mz lz ma kp na mc md kr hm dt translated">在命令行上直接使用密码通常是不安全的，因为密码会被记录到bash历史记录中，所以您也可以在交互模式下解锁:</p><pre class="nb nc nd ne fq nf ng nh ni aw nj dt"><span id="4a39" class="lb jh ht ng b fv nk nl l nm nn">$ cleos wallet unlock<br/>password:</span></pre><p id="82e5" class="pw-post-body-paragraph lp lq ht kg b kh me lr ls kj mf lt lu kl my lw lx kn mz lz ma kp na mc md kr hm dt translated">为了安全起见，通常不使用钱包时最好把它锁上。要在不关机的情况下锁定您的钱包，您可以:</p><pre class="nb nc nd ne fq nf ng nh ni aw nj dt"><span id="e636" class="lb jh ht ng b fv nk nl l nm nn">$ cleos wallet lock<br/>Locked: default</span></pre><p id="de72" class="pw-post-body-paragraph lp lq ht kg b kh me lr ls kj mf lt lu kl my lw lx kn mz lz ma kp na mc md kr hm dt translated">在本教程的剩余部分，您需要解锁您的钱包。</p><p id="ba4e" class="pw-post-body-paragraph lp lq ht kg b kh me lr ls kj mf lt lu kl my lw lx kn mz lz ma kp na mc md kr hm dt translated">将<code class="eh no np nq ng b">eosio</code>账户的主密钥导入您的钱包。主密钥可以在<code class="eh no np nq ng b">nodeos</code>的config文件夹中的<code class="eh no np nq ng b">config.ini</code>文件中找到。在本例中，使用了默认的config文件夹。在MacOS上，这将是在<code class="eh no np nq ng b">~/Library/Application Support/eosio/nodeos/config</code>。</p><pre class="nb nc nd ne fq nf ng nh ni aw nj dt"><span id="b6b0" class="lb jh ht ng b fv nk nl l nm nn">$ cleos wallet import 5KQwrPbwdL6PhXujxW37FSSQZ1JiwsST4cqQzDeyXtP79zkvFD3<br/>imported private key for: EOS6MRyAjQq8ud7hVNYcfnVPJqcVpscN5So8BhtHuGYqET5GDW5CV</span></pre><h1 id="b1b8" class="jg jh ht bd ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd dt translated">4.加载Bios合同</h1><p id="fcda" class="pw-post-body-paragraph lp lq ht kg b kh ki lr ls kj kk lt lu kl lv lw lx kn ly lz ma kp mb mc md kr hm dt translated">Bios合同使您能够直接控制其他帐户的资源分配，并访问其他特权API调用。在公共区块链中，此契约将管理令牌的堆叠和取消堆叠，以便为CPU和网络活动预留带宽，并为契约预留内存。</p><pre class="nb nc nd ne fq nf ng nh ni aw nj dt"><span id="1072" class="lb jh ht ng b fv nk nl l nm nn">$ cleos set contract eosio build/contracts/eosio.bios -p eosio<br/>Reading WAST/WASM from build/contracts/eosio.bios/eosio.bios.wast...<br/>Assembling WASM...<br/>Publishing contract...<br/>executed transaction: bb7fb236627de8ff4247064cd8b1bf8f266b9385491a94bd6ca26d26145fbe75  3288 bytes  2200576 cycles<br/>#         eosio &lt;= eosio::setcode               {"account":"eosio","vmtype":0,"vmversion":0,"code":"0061736d0100000001581060037f7e7f0060057f7e7e7e7e...<br/>#         eosio &lt;= eosio::setabi                {"account":"eosio","abi":{"types":[],"structs":[{"name":"set_account_limits","base":"","fields":[{"n...</span></pre><p id="9373" class="pw-post-body-paragraph lp lq ht kg b kh me lr ls kj mf lt lu kl my lw lx kn mz lz ma kp na mc md kr hm dt translated">代码定义了契约如何运行，abi描述了如何在参数的二进制和json表示之间进行转换。该命令序列的结果是<code class="eh no np nq ng b">cleos</code>生成了一个包含两个动作<code class="eh no np nq ng b">eosio::setcode</code>和<code class="eh no np nq ng b">eosio::setabi</code>的事务。可以理解为:由<code class="eh no np nq ng b">eosio</code>定义的动作<code class="eh no np nq ng b">setcode</code>由与<code class="eh no np nq ng b">{args...}</code>的<code class="eh no np nq ng b">eosio</code>契约执行</p><p id="d306" class="pw-post-body-paragraph lp lq ht kg b kh me lr ls kj mf lt lu kl my lw lx kn mz lz ma kp na mc md kr hm dt translated">这个调用的最后一个参数是<code class="eh no np nq ng b">-p eosio</code>。这告诉<code class="eh no np nq ng b">cleos</code>使用<code class="eh no np nq ng b">eosio</code>帐户的活动授权签署该操作，即使用我们之前导入的<code class="eh no np nq ng b">eosio</code>帐户的私钥签署该操作。</p><h1 id="a988" class="jg jh ht bd ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd dt translated">5.创建帐户</h1><p id="d1fc" class="pw-post-body-paragraph lp lq ht kg b kh ki lr ls kj kk lt lu kl lv lw lx kn ly lz ma kp mb mc md kr hm dt translated">既然我们已经设置了基本系统合同，我们可以开始创建我们自己的帐户。我们将创建两个帐户，<code class="eh no np nq ng b">user</code>和<code class="eh no np nq ng b">tester</code>，并且我们需要将一个密钥与每个帐户相关联。在本例中，两个帐户将使用相同的密钥。</p><p id="4234" class="pw-post-body-paragraph lp lq ht kg b kh me lr ls kj mf lt lu kl my lw lx kn mz lz ma kp na mc md kr hm dt translated">为此，我们首先为帐户生成一个密钥。</p><pre class="nb nc nd ne fq nf ng nh ni aw nj dt"><span id="fbbb" class="lb jh ht ng b fv nk nl l nm nn">$ cleos create key<br/>Private key: 5JxykKNaPZjhBETmfip8aDuP3UaZrCNBBznx17qFo4Sbyk7pE9Q<br/>Public key: EOS5zgUiXJxDNvP8HJRrzXdSEdnL3S4MW8c86257HAMyqmmz2dGsZ</span></pre><p id="1247" class="pw-post-body-paragraph lp lq ht kg b kh me lr ls kj mf lt lu kl my lw lx kn mz lz ma kp na mc md kr hm dt translated">然后我们将这个密钥导入我们的钱包:</p><pre class="nb nc nd ne fq nf ng nh ni aw nj dt"><span id="0fa5" class="lb jh ht ng b fv nk nl l nm nn">$ cleos wallet import 5JxykKNaPZjhBETmfip8aDuP3UaZrCNBBznx17qFo4Sbyk7pE9Q<br/>imported private key for: EOS5zgUiXJxDNvP8HJRrzXdSEdnL3S4MW8c86257HAMyqmmz2dGsZ</span></pre><h2 id="8c60" class="lb jh ht bd ji lc ld le jm lf lg lh jq kl li lj ju kn lk ll jy kp lm ln kc lo dt translated">5.1.创建两个用户帐户</h2><p id="0ce9" class="pw-post-body-paragraph lp lq ht kg b kh ki lr ls kj kk lt lu kl lv lw lx kn ly lz ma kp mb mc md kr hm dt translated">接下来，我们将创建两个帐户，<code class="eh no np nq ng b">user</code>和<code class="eh no np nq ng b">tester</code>，使用我们在上面创建和导入的密钥。<code class="eh no np nq ng b">create account</code>子命令需要两个密钥，一个用于OwnerKey(在生产环境中应该保持高度安全),另一个用于ActiveKey。</p><pre class="nb nc nd ne fq nf ng nh ni aw nj dt"><span id="41fa" class="lb jh ht ng b fv nk nl l nm nn">$ cleos create account eosio user EOS5zgUiXJxDNvP8HJRrzXdSEdnL3S4MW8c86257HAMyqmmz2dGsZ EOS5zgUiXJxDNvP8HJRrzXdSEdnL3S4MW8c86257HAMyqmmz2dGsZ<br/>executed transaction: 8aedb926cc1ca31642ada8daf4350833c95cbe98b869230f44da76d70f6d6242  364 bytes  1000 cycles<br/>#         eosio &lt;= eosio::newaccount            {"creator":"eosio","name":"user","owner":{"threshold":1,"keys":<br/>​<br/>$ cleos create account eosio tester EOS5zgUiXJxDNvP8HJRrzXdSEdnL3S4MW8c86257HAMyqmmz2dGsZ EOS5zgUiXJxDNvP8HJRrzXdSEdnL3S4MW8c86257HAMyqmmz2dGsZ<br/>executed transaction: 414cf0dc7740d22474992779b2416b0eabdbc91522c16521307dd682051af083 366 bytes  1000 cycles<br/>#         eosio &lt;= eosio::newaccount            {"creator":"eosio","name":"tester","owner":{"threshold":1,"keys":</span></pre><p id="8827" class="pw-post-body-paragraph lp lq ht kg b kh me lr ls kj mf lt lu kl my lw lx kn mz lz ma kp na mc md kr hm dt translated">我们可以查询由我们的密钥控制的所有帐户:</p><pre class="nb nc nd ne fq nf ng nh ni aw nj dt"><span id="3980" class="lb jh ht ng b fv nk nl l nm nn">$ cleos get accounts EOS5zgUiXJxDNvP8HJRrzXdSEdnL3S4MW8c86257HAMyqmmz2dGsZ<br/>{<br/>  "account_names": [<br/>    "tester",<br/>    "user"<br/>  ]<br/>}</span></pre><h1 id="e9f3" class="jg jh ht bd ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd dt translated">6.部署令牌合同</h1><p id="610b" class="pw-post-body-paragraph lp lq ht kg b kh ki lr ls kj kk lt lu kl lv lw lx kn ly lz ma kp mb mc md kr hm dt translated"><code class="eh no np nq ng b">eosio.token</code>契约允许创建许多不同的令牌，它们都运行在同一契约上，但可能由不同的用户管理。在部署令牌合约之前，我们必须创建一个帐户来部署它。</p><pre class="nb nc nd ne fq nf ng nh ni aw nj dt"><span id="470c" class="lb jh ht ng b fv nk nl l nm nn">$ cleos create account eosio eosio.token EOS5zgUiXJxDNvP8HJRrzXdSEdnL3S4MW8c86257HAMyqmmz2dGsZ EOS5zgUiXJxDNvP8HJRrzXdSEdnL3S4MW8c86257HAMyqmmz2dGsZ</span></pre><p id="4e2b" class="pw-post-body-paragraph lp lq ht kg b kh me lr ls kj mf lt lu kl my lw lx kn mz lz ma kp na mc md kr hm dt translated">然后我们可以部署在<code class="eh no np nq ng b">${EOSIO_SOURCE}/build/contracts/eosio.token</code>中找到的合同</p><pre class="nb nc nd ne fq nf ng nh ni aw nj dt"><span id="1c95" class="lb jh ht ng b fv nk nl l nm nn">$ cleos set contract eosio.token build/contracts/eosio.token -p eosio.token<br/>Reading WAST...<br/>Assembling WASM...<br/>Publishing contract...<br/>executed transaction: 528bdbce1181dc5fd72a24e4181e6587dace8ab43b2d7ac9b22b2017992a07ad  8708 bytes  10000 cycles<br/>#         eosio &lt;= eosio::setcode               {"account":"eosio.token","vmtype":0,"vmversion":0,"code":"0061736d0100000001ce011d60067f7e7f7f7f7f00...<br/>#         eosio &lt;= eosio::setabi                {"account":"eosio.token","abi":{"types":[],"structs":[{"name":"transfer","base":"","fields":[{"name"...</span></pre><h2 id="eba0" class="lb jh ht bd ji lc ld le jm lf lg lh jq kl li lj ju kn lk ll jy kp lm ln kc lo dt translated">6.1.创建EOS令牌</h2><p id="88a0" class="pw-post-body-paragraph lp lq ht kg b kh ki lr ls kj kk lt lu kl lv lw lx kn ly lz ma kp mb mc md kr hm dt translated">您可以查看<code class="eh no np nq ng b">contracts/eosio.token/eosio.token.hpp</code>定义的<code class="eh no np nq ng b">eosio.token</code>界面</p><p id="80c0" class="pw-post-body-paragraph lp lq ht kg b kh me lr ls kj mf lt lu kl my lw lx kn mz lz ma kp na mc md kr hm dt translated">要创建一个新令牌，我们必须调用带有适当参数的<code class="eh no np nq ng b">create(...)</code>动作。此命令将使用最大供应的符号来唯一地将此令牌与其他令牌区分开。发行人将有权调用发行和/或执行其他操作，如冻结、召回和将所有者列入白名单。</p><p id="1857" class="pw-post-body-paragraph lp lq ht kg b kh me lr ls kj mf lt lu kl my lw lx kn mz lz ma kp na mc md kr hm dt translated">使用位置参数调用此方法的简明方法是:</p><pre class="nb nc nd ne fq nf ng nh ni aw nj dt"><span id="d0cf" class="lb jh ht ng b fv nk nl l nm nn">$ cleos push action eosio.token create '[ "eosio", "1000000000.0000 EOS", 0, 0, 0]' -p eosio.token<br/>executed transaction: 0e49a421f6e75f4c5e09dd738a02d3f51bd18a0cf31894f68d335cd70d9c0e12  260 bytes  1000 cycles<br/>#   eosio.token &lt;= eosio.token::create          {"issuer":"eosio","maximum_supply":"1000000000.0000 EOS","can_freeze":0,"can_recall":0,"can_whitelis...</span></pre><p id="0171" class="pw-post-body-paragraph lp lq ht kg b kh me lr ls kj mf lt lu kl my lw lx kn mz lz ma kp na mc md kr hm dt translated">或者，使用命名参数以更详细的方式调用此方法:</p><pre class="nb nc nd ne fq nf ng nh ni aw nj dt"><span id="a663" class="lb jh ht ng b fv nk nl l nm nn">$ cleos push action eosio.token create '{"issuer":"eosio", "maximum_supply":"1000000000.0000 EOS", "can_freeze":0, "can_recall":0, "can_whitelist":0}' -p eosio.token<br/>executed transaction: 0e49a421f6e75f4c5e09dd738a02d3f51bd18a0cf31894f68d335cd70d9c0e12  260 bytes  1000 cycles<br/>#   eosio.token &lt;= eosio.token::create          {"issuer":"eosio","maximum_supply":"10</span></pre><p id="db19" class="pw-post-body-paragraph lp lq ht kg b kh me lr ls kj mf lt lu kl my lw lx kn mz lz ma kp na mc md kr hm dt translated">该命令创建了一个新的令牌<code class="eh no np nq ng b">EOS</code>，精度为4分米，最大供应量为1000000000.0000 EOS。</p><h2 id="d4b7" class="lb jh ht bd ji lc ld le jm lf lg lh jq kl li lj ju kn lk ll jy kp lm ln kc lo dt translated">6.2.向帐户“用户”颁发令牌</h2><p id="fe69" class="pw-post-body-paragraph lp lq ht kg b kh ki lr ls kj kk lt lu kl lv lw lx kn ly lz ma kp mb mc md kr hm dt translated">现在我们已经创建了令牌，发行者可以向我们之前创建的帐户<code class="eh no np nq ng b">user</code>发行新的令牌。</p><pre class="nb nc nd ne fq nf ng nh ni aw nj dt"><span id="e926" class="lb jh ht ng b fv nk nl l nm nn">$ cleos push action eosio.token issue '[ "user", "100.0000 EOS", "memo" ]' -p eosio<br/>executed transaction: 822a607a9196112831ecc2dc14ffb1722634f1749f3ac18b73ffacd41160b019  268 bytes  1000 cycles<br/>#   eosio.token &lt;= eosio.token::issue           {"to":"user","quantity":"100.0000 EOS","memo":"memo"}<br/>&gt;&gt; issue<br/>#   eosio.token &lt;= eosio.token::transfer        {"from":"eosio","to":"user","quantity":"100.0000 EOS","memo":"memo"}<br/>&gt;&gt; transfer<br/>#         eosio &lt;= eosio.token::transfer        {"from":"eosio","to":"user","quantity":"100.0000 EOS","memo":"memo"}<br/>#          user &lt;= eosio.token::transfer        {"from":"eosio","to":"user","quantity":"100.0000 EOS","memo":"memo"}</span></pre><p id="e76e" class="pw-post-body-paragraph lp lq ht kg b kh me lr ls kj mf lt lu kl my lw lx kn mz lz ma kp na mc md kr hm dt translated">这次输出包含几个不同的动作:一个发布和三个转移。虽然我们签署的唯一动作是<code class="eh no np nq ng b">issue</code>，但是<code class="eh no np nq ng b">issue</code>动作执行了一个“内联传输”并且“内联传输”通知了发送者和接收者账户。输出指示所有被调用的操作处理程序、它们被调用的顺序，以及操作是否生成了任何输出。</p><p id="1180" class="pw-post-body-paragraph lp lq ht kg b kh me lr ls kj mf lt lu kl my lw lx kn mz lz ma kp na mc md kr hm dt translated">从技术上讲，<code class="eh no np nq ng b">eosio.token</code>合同可以跳过<code class="eh no np nq ng b">inline transfer</code>合同，选择直接修改余额。然而，在这种情况下，<code class="eh no np nq ng b">eosio.token</code>契约遵循我们的令牌约定，要求所有账户余额都可以通过引用它们的转账操作的总和来导出。它还要求通知资金的发送者和接收者，以便他们可以自动处理存款和取款。</p><p id="19a5" class="pw-post-body-paragraph lp lq ht kg b kh me lr ls kj mf lt lu kl my lw lx kn mz lz ma kp na mc md kr hm dt translated">如果您想看到实际广播的事务，您可以使用<code class="eh no np nq ng b">-d -j</code>选项来指示“不广播”和“将事务作为json返回”。</p><pre class="nb nc nd ne fq nf ng nh ni aw nj dt"><span id="f069" class="lb jh ht ng b fv nk nl l nm nn">$ cleos push action eosio.token issue '["user", "100.0000 EOS", "memo"]' -p eosio -d -j<br/>{<br/>  "expiration": "2018-04-25T23:50:50",<br/>  "region": 0,<br/>  "ref_block_num": 20835,<br/>  "ref_block_prefix": 3876493376,<br/>  "max_net_usage_words": 0,<br/>  "max_kcpu_usage": 0,<br/>  "delay_sec": 0,<br/>  "context_free_actions": [],<br/>  "actions": [{<br/>      "account": "eosio.token",<br/>      "name": "issue",<br/>      "authorization": [{<br/>          "actor": "eosio",<br/>          "permission": "active"<br/>        }<br/>      ],<br/>      "data": "00000000007015d640420f000000000004454f5300000000046d656d6f"<br/>    }<br/>  ],<br/>  "signatures": [<br/>    "EOSJwTiuUfr3iD4tTAeVYU8KP4GrV6jCyFiqPVZtWMKeisR7pr8moXYAaxhyf4VAhacPFea57eMKLbFCTaBxzBxqKiqLNBc9X"<br/>  ],<br/>  "context_free_data": []</span></pre><h2 id="fdd6" class="lb jh ht bd ji lc ld le jm lf lg lh jq kl li lj ju kn lk ll jy kp lm ln kc lo dt translated">6.3.将代币转移到帐户“测试者”</h2><p id="c3bd" class="pw-post-body-paragraph lp lq ht kg b kh ki lr ls kj kk lt lu kl lv lw lx kn ly lz ma kp mb mc md kr hm dt translated">现在帐户<code class="eh no np nq ng b">user</code>有代币了，我们将转移一些到帐户<code class="eh no np nq ng b">tester</code>。我们指出<code class="eh no np nq ng b">user</code>使用权限参数<code class="eh no np nq ng b">-p user</code>授权了这个动作。</p><pre class="nb nc nd ne fq nf ng nh ni aw nj dt"><span id="4826" class="lb jh ht ng b fv nk nl l nm nn">$ cleos push action eosio.token transfer '[ "user", "tester", "25.0000 EOS", "m" ]' -p user<br/>executed transaction: bd6da0a70e386a5302d02c481d80a7bd19409169d0bab035090b1d3867d29391  256 bytes  111616 cycles<br/>#   eosio.token &lt;= eosio.token::transfer        {"from":"user","to":"tester","quantity":"25.0000 EOS","memo":"m"}<br/>&gt;&gt; transfer<br/>#          user &lt;= eosio.token::transfer        {"from":"user","to":"tester","quantity":"25.0000 EOS","memo":"m"}<br/>#        tester &lt;= eosio.token::transfer        {"from":"user","to":"tester","quantity":"25.0000 EOS","memo":"m"}</span></pre><h1 id="cb48" class="jg jh ht bd ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd dt translated">7.部署交换合同</h1><p id="31b2" class="pw-post-body-paragraph lp lq ht kg b kh ki lr ls kj kk lt lu kl lv lw lx kn ly lz ma kp mb mc md kr hm dt translated">类似于上面显示的例子，我们可以部署<code class="eh no np nq ng b">exchange</code>契约。<code class="eh no np nq ng b">exchange</code>合同提供了创造和交易货币的能力。假设这是从EOSIO源代码的根目录运行的。</p><pre class="nb nc nd ne fq nf ng nh ni aw nj dt"><span id="4219" class="lb jh ht ng b fv nk nl l nm nn">$ cleos create account eosio exchange EOS5zgUiXJxDNvP8HJRrzXdSEdnL3S4MW8c86257HAMyqmmz2dGsZ EOS5zgUiXJxDNvP8HJRrzXdSEdnL3S4MW8c86257HAMyqmmz2dGsZ<br/>executed transaction: 6337ac311a5df1fb9ed9b1f8728b2ea67b2bc9663c06cf6e0797d12d7280572e  352 bytes  102400 cycles<br/>#         eosio &lt;= eosio::newaccount            {"creator":"eosio","name":"exchange","owner":{"threshold":1,"keys":[{"key":"EOS5zgUiXJxDNvP8HJRrzXdS...</span></pre><h2 id="87d8" class="lb jh ht bd ji lc ld le jm lf lg lh jq kl li lj ju kn lk ll jy kp lm ln kc lo dt translated">7.1.部署Eosio.msig合同</h2><p id="fe4b" class="pw-post-body-paragraph lp lq ht kg b kh ki lr ls kj kk lt lu kl lv lw lx kn ly lz ma kp mb mc md kr hm dt translated"><code class="eh no np nq ng b">eosio.msig</code>契约允许多方异步签署一个交易。EOSIO在基本级别上支持多重签名(multisig ),但它需要一个同步边信道来传送和签名数据。<code class="eh no np nq ng b">Eosio.msig</code>是一种更加用户友好的异步提议、批准并最终发布多方同意的交易的方式。</p><p id="3811" class="pw-post-body-paragraph lp lq ht kg b kh me lr ls kj mf lt lu kl my lw lx kn mz lz ma kp na mc md kr hm dt translated">以下步骤可用于部署<code class="eh no np nq ng b">eosio.msig</code>合同。</p><pre class="nb nc nd ne fq nf ng nh ni aw nj dt"><span id="8524" class="lb jh ht ng b fv nk nl l nm nn">$ cleos create account eosio eosio.msig EOS5zgUiXJxDNvP8HJRrzXdSEdnL3S4MW8c86257HAMyqmmz2dGsZ EOS5zgUiXJxDNvP8HJRrzXdSEdnL3S4MW8c86257HAMyqmmz2dGsZ<br/>executed transaction: ccf74668c29d9c581aa64692f9d24df43d0cdba40366bd1c33a598b2feb198d4  352 bytes  102400 cycles<br/>#         eosio &lt;= eosio::newaccount            {"creator":"eosio","name":"eosio.msig","owner":{"threshold":1,"keys":[{"key":"EOS5zgUiXJxDNvP8HJRrzX...</span></pre><h1 id="451d" class="jg jh ht bd ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd dt translated">8.部署Hello World合约</h1><p id="0bc2" class="pw-post-body-paragraph lp lq ht kg b kh ki lr ls kj kk lt lu kl lv lw lx kn ly lz ma kp mb mc md kr hm dt translated">我们现在将创建我们的第一个“hello world”合同。创建一个名为“hello”的新文件夹，将cd放入该文件夹，然后创建一个包含以下内容的文件“hello.cpp ”:</p><p id="5867" class="pw-post-body-paragraph lp lq ht kg b kh me lr ls kj mf lt lu kl my lw lx kn mz lz ma kp na mc md kr hm dt translated"><strong class="kg hu"> hello/hello.cpp </strong></p><pre class="nb nc nd ne fq nf ng nh ni aw nj dt"><span id="354f" class="lb jh ht ng b fv nk nl l nm nn">#include &lt;eosiolib/eosio.hpp&gt;<br/>#include &lt;eosiolib/print.hpp&gt;<br/>using namespace eosio;<br/>​<br/>class hello : public eosio::contract {<br/>  public:<br/>      using contract::contract;<br/>​<br/>      /// @abi action <br/>      void hi( account_name user ) {<br/>         print( "Hello, ", name{user} );<br/>      }<br/>};<br/>​<br/>EOSIO_ABI( hello, (hi) )</span></pre><p id="32fd" class="pw-post-body-paragraph lp lq ht kg b kh me lr ls kj mf lt lu kl my lw lx kn mz lz ma kp na mc md kr hm dt translated">您可以将代码编译成web程序集(。wast)如下:</p><pre class="nb nc nd ne fq nf ng nh ni aw nj dt"><span id="cfe7" class="lb jh ht ng b fv nk nl l nm nn">$ eosiocpp -o hello.wast hello.cpp</span></pre><p id="4c78" class="pw-post-body-paragraph lp lq ht kg b kh me lr ls kj mf lt lu kl my lw lx kn mz lz ma kp na mc md kr hm dt translated">现在生成abi:</p><pre class="nb nc nd ne fq nf ng nh ni aw nj dt"><span id="ac23" class="lb jh ht ng b fv nk nl l nm nn">$ eosiocpp -g hello.abi hello.cpp<br/>Generated hello.abi</span></pre><p id="8932" class="pw-post-body-paragraph lp lq ht kg b kh me lr ls kj mf lt lu kl my lw lx kn mz lz ma kp na mc md kr hm dt translated">创建帐户并上传合同:</p><pre class="nb nc nd ne fq nf ng nh ni aw nj dt"><span id="2540" class="lb jh ht ng b fv nk nl l nm nn">$ cleos create account eosio hello.code EOS5zgUiXJxDNvP8HJRrzXdSEdnL3S4MW8c86257HAMyqmmz2dGsZ EOS5zgUiXJxDNvP8HJRrzXdSEdnL3S4MW8c86257HAMyqmmz2dGsZ<br/>...<br/>$ cleos set contract hello.code ../hello -p hello.code<br/>...</span></pre><p id="6c15" class="pw-post-body-paragraph lp lq ht kg b kh me lr ls kj mf lt lu kl my lw lx kn mz lz ma kp na mc md kr hm dt translated">现在我们可以运行合同了:</p><pre class="nb nc nd ne fq nf ng nh ni aw nj dt"><span id="8265" class="lb jh ht ng b fv nk nl l nm nn">$ cleos push action hello.code hi '["user"]' -p user<br/>executed transaction: 2b4691674e206f69fd68ea458ea152405d436ba19ae06af5a697d38bfbbca2e4  232 bytes  102400 cycles<br/>#    hello.code &lt;= hello.code::hi               {"user":"user"}<br/>&gt;&gt; Hello, user</span></pre><p id="4175" class="pw-post-body-paragraph lp lq ht kg b kh me lr ls kj mf lt lu kl my lw lx kn mz lz ma kp na mc md kr hm dt translated">这时契约允许任何人授权它，我们也可以说:</p><pre class="nb nc nd ne fq nf ng nh ni aw nj dt"><span id="bc15" class="lb jh ht ng b fv nk nl l nm nn">$ cleos push action hello.code hi '["tester"]' -p tester<br/>executed transaction: c9b765e80f3b31b8946f18f59ed3f70495af769acb4923799e3bf647ee1df8d5  232 bytes  102400 cycles<br/>#    hello.code &lt;= hello.code::hi               {"user":"tester"}<br/>&gt;&gt; Hello, tester</span></pre><figure class="nb nc nd ne fq iu fe ff paragraph-image"><a href="http://bit.ly/2G71Sp7"><div class="fe ff nr"><img src="../Images/449450761cd76f44f9ae574333f9e9af.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fKX2mtg7p1lOs7JmosPLsA.png"/></div></a></figure></div></div>    
</body>
</html>