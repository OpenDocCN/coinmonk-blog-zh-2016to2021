<html>
<head>
<title>Storage vs Memory in Solidity</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">存储与存储的稳固性</h1>
<blockquote>原文：<a href="https://medium.com/coinmonks/storage-vs-memory-in-solidity-8251847186fd?source=collection_archive---------1-----------------------#2018-02-16">https://medium.com/coinmonks/storage-vs-memory-in-solidity-8251847186fd?source=collection_archive---------1-----------------------#2018-02-16</a></blockquote><div><div class="ef hh hi hj hk hl"/><div class="hm hn ho hp hq"><figure class="hs ht fm fo hu hv fe ff paragraph-image"><div class="fe ff hr"><img src="../Images/e5cb51a66632030a3966a545a5ed2620.png" data-original-src="https://miro.medium.com/v2/resize:fit:568/format:webp/1*QZBp_BLjEAqciVUJ2bCc0g.jpeg"/></div><figcaption class="hy hz fg fe ff ia ib bd b be z ek">Lest we forget…</figcaption></figure><div class=""/><p id="16a6" class="pw-post-body-paragraph jb jc ie jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">一个让你思考的简单例子</p><p id="3bcb" class="pw-post-body-paragraph jb jc ie jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">我今天看了一些solidity代码，我对它感到很困惑，所以我决定把它浓缩成一个简单的例子，解释内存和存储之间的区别。</p><p id="5949" class="pw-post-body-paragraph jb jc ie jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">使用remix，我创建了一个契约，其结构映射如下</p><pre class="jz ka kb kc fq kd ke kf kg aw kh dt"><span id="36eb" class="ki kj ie ke b fv kk kl l km kn">struct St {<br/>        uint256  amountPaid;<br/>        uint256  amountOut;<br/>        bool registered;<br/>}<br/>mapping(address =&gt; St) store;</span></pre><p id="df05" class="pw-post-body-paragraph jb jc ie jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">如果我想在某人汇款时更新他的<code class="eh ko kp kq ke b">amountPaid</code>,我通常会这样做(忽略安全数学和其他重要问题)</p><pre class="jz ka kb kc fq kd ke kf kg aw kh dt"><span id="b908" class="ki kj ie ke b fv kk kl l km kn">function addMemFunds() public payable {<br/>  St memory mine = store[msg.sender];<br/>  mine.amountPaid += msg.value; // and the other members<br/>  store[msg.sender] = mine;<br/>}  </span></pre><p id="680d" class="pw-post-body-paragraph jb jc ie jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">我很惊讶地发现下面的方法也有效。*</p><pre class="jz ka kb kc fq kd ke kf kg aw kh dt"><span id="0909" class="ki kj ie ke b fv kk kl l km kn">function addStorFunds() public payable {<br/>  St storage mine = store[msg.sender];<br/>  mine.amountPaid += msg.value;<br/>}</span></pre><p id="0325" class="pw-post-body-paragraph jb jc ie jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">*是的，它可能在文档中，但我从未找到它。<br/>看起来我们是在使用一个指向结构的指针，而不是复制它。</p><p id="c24e" class="pw-post-body-paragraph jb jc ie jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">完整的代码可以在<a class="ae kr" href="https://gist.github.com/DaveAppleton/c13257ba5b68e04b4cfdbce501c9293e" rel="noopener ugc nofollow" target="_blank"> github gist </a>中找到，并且可以通过这个链接直接加载到remix】中</p><figure class="jz ka kb kc fq hv fe ff paragraph-image"><div role="button" tabindex="0" class="kt ku di kv bf kw"><div class="fe ff ks"><img src="../Images/94c0dd0c02762986511922815d727ec2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bApqfY3cN4mNnwymiXW8nw.png"/></div></div><figcaption class="hy hz fg fe ff ia ib bd b be z ek">Compile and launch the contract</figcaption></figure><figure class="jz ka kb kc fq hv fe ff paragraph-image"><div role="button" tabindex="0" class="kt ku di kv bf kw"><div class="fe ff kx"><img src="../Images/99050e52f5bb9318c402d2729cb42f67.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*g_R_Clr872-RH0S_NtNofw.png"/></div></div><figcaption class="hy hz fg fe ff ia ib bd b be z ek">click on “mine” to see the balance</figcaption></figure><figure class="jz ka kb kc fq hv fe ff paragraph-image"><div role="button" tabindex="0" class="kt ku di kv bf kw"><div class="fe ff ks"><img src="../Images/5c478aa2f0617a7077dbc9901663c714.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XMHgBV9UVvsmXsff1ie_gQ.png"/></div></div><figcaption class="hy hz fg fe ff ia ib bd b be z ek">Set a value</figcaption></figure><figure class="jz ka kb kc fq hv fe ff paragraph-image"><div role="button" tabindex="0" class="kt ku di kv bf kw"><div class="fe ff ky"><img src="../Images/1605b98af3f47c32c438ce8a93e9f416.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*sWuLVWYkdTR6rmbBvqW2xg.png"/></div></div><figcaption class="hy hz fg fe ff ia ib bd b be z ek">Click on either addStorFunds or addMemFunds and the value increases</figcaption></figure><p id="4628" class="pw-post-body-paragraph jb jc ie jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">一旦你这样做了，你可以通过调用带有值的<code class="eh ko kp kq ke b">addMemFail</code>来证明没有它内存不会增加。你会看到点击<code class="eh ko kp kq ke b">mine</code>显示该值没有被更新。</p><blockquote class="kz"><p id="1d88" class="la lb ie bd lc ld le lf lg lh li jy ek translated"><a class="ae kr" href="https://coincodecap.com/?utm_source=coinmonks" rel="noopener ugc nofollow" target="_blank">直接在您的收件箱中获得最佳软件交易</a></p></blockquote><figure class="lk ll lm ln lo hv fe ff paragraph-image"><a href="https://coincodecap.com/?utm_source=coinmonks"><div class="fe ff lj"><img src="../Images/7c0b3dfdcbfea594cc0ae7d4f9bf6fcb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1168/format:webp/0*OJ-qb5G6i863msBB.png"/></div></a></figure></div></div>    
</body>
</html>