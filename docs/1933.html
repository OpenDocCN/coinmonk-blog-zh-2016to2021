<html>
<head>
<title>Upgrading to Truffle 5 🍨</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">升级到Truffle 5🍨</h1>
<blockquote>原文：<a href="https://medium.com/coinmonks/upgrading-to-truffle-5-22aedc7c2a4d?source=collection_archive---------5-----------------------#2019-01-03">https://medium.com/coinmonks/upgrading-to-truffle-5-22aedc7c2a4d?source=collection_archive---------5-----------------------#2019-01-03</a></blockquote><div><div class="ef hh hi hj hk hl"/><div class="hm hn ho hp hq"><div class=""/><div class=""><h2 id="6308" class="pw-subtitle-paragraph iq hs ht bd b ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ek translated">我们❤️的比特和我们😠—总体而言，这是一个具有强大功能的可靠版本。</h2></div><figure class="ji jj jk jl fq jm fe ff paragraph-image"><div class="ab fr cl jn"><img src="../Images/26328fb0a2f7ed9e1fce177a6ed99e5d.png" data-original-src="https://miro.medium.com/v2/format:webp/1*SFMV617Li-NZRuezy4xKqA.png"/></div></figure><p id="5620" class="pw-post-body-paragraph jq jr ht js b jt ju iu jv jw jx ix jy jz ka kb kc kd ke kf kg kh ki kj kk kl hm dt translated"><a class="ae km" href="https://github.com/trufflesuite/truffle/releases/tag/v5.0.0#user-content-what-s-new-in-truffle-v5-interacting-with-your-contracts-websockets" rel="noopener ugc nofollow" target="_blank">松露5 </a>是松露框架的一次大修和返工。目前以太坊领域有几个相互竞争的框架，但Truffle是市场领导者，也是最常用的，所以绝对值得保留👀在<a class="ae km" href="https://github.com/trufflesuite/truffle" rel="noopener ugc nofollow" target="_blank">松露总部</a>发生的事情。</p><p id="ea90" class="pw-post-body-paragraph jq jr ht js b jt ju iu jv jw jx ix jy jz ka kb kc kd ke kf kg kh ki kj kk kl hm dt translated">我们已经广泛使用Truffle超过18个月了，从原始的Web3JS库切换到完整的构建管道，支持测试套件集成、CLI工具、多网络支持和部署工具等功能。</p><p id="9e12" class="pw-post-body-paragraph jq jr ht js b jt ju iu jv jw jx ix jy jz ka kb kc kd ke kf kg kh ki kj kk kl hm dt translated">我们对松露4有一些小小的不满，但它在去年为我们提供了很好的服务，但随着最近松露5的发布，升级的渴望正在接近我们。我们去找它，下面是我们在通往松露5号的路上发现的一些最好和最差的部分。</p><p id="c50d" class="pw-post-body-paragraph jq jr ht js b jt ju iu jv jw jx ix jy jz ka kb kc kd ke kf kg kh ki kj kk kl hm dt translated"><strong class="js hu"> Web3JS 1.0 </strong> ✅</p><p id="fa0c" class="pw-post-body-paragraph jq jr ht js b jt ju iu jv jw jx ix jy jz ka kb kc kd ke kf kg kh ki kj kk kl hm dt translated">Truffle现在与最新的<a class="ae km" href="https://web3js.readthedocs.io/en/1.0/index.html" rel="noopener ugc nofollow" target="_blank"> Web3JS </a>捆绑在一起，这有许多新的补充，但我们最喜欢的是我们在处理事务时使用<a class="ae km" href="https://web3js.readthedocs.io/en/1.0/callbacks-promises-events.html#promievent" rel="noopener ugc nofollow" target="_blank"> <em class="kn"> PromiEvent </em> </a>构造的能力，例如:</p><figure class="ji jj jk jl fq jm"><div class="bz el l di"><div class="ko kp l"/></div></figure><p id="bec7" class="pw-post-body-paragraph jq jr ht js b jt ju iu jv jw jx ix jy jz ka kb kc kd ke kf kg kh ki kj kk kl hm dt translated">这是处理向网络提交交易的更流畅的方式。以前我们所拥有的只是一个简单的<a class="ae km" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise" rel="noopener ugc nofollow" target="_blank">承诺</a>,不幸的是，当一个交易可能会有几种状态时，这个承诺并不总是合适的。以前，我们使用类似监听事件和每X秒检查一次计时器的方法来解决这个问题，最近的变化使它感觉<em class="kn">正确</em>。</p><p id="d449" class="pw-post-body-paragraph jq jr ht js b jt ju iu jv jw jx ix jy jz ka kb kc kd ke kf kg kh ki kj kk kl hm dt translated"><strong class="js hu">异步/等待</strong> ✅</p><p id="b3a3" class="pw-post-body-paragraph jq jr ht js b jt ju iu jv jw jx ix jy jz ka kb kc kd ke kf kg kh ki kj kk kl hm dt translated">所有的Web3调用都是async/await——无论是在测试、迁移还是webapp中使用它们——这使得大多数情况下的生活变得更加简单。</p><p id="cb13" class="pw-post-body-paragraph jq jr ht js b jt ju iu jv jw jx ix jy jz ka kb kc kd ke kf kg kh ki kj kk kl hm dt translated"><strong class="js hu">附加网络配置</strong> ✅</p><p id="b8df" class="pw-post-body-paragraph jq jr ht js b jt ju iu jv jw jx ix jy jz ka kb kc kd ke kf kg kh ki kj kk kl hm dt translated">额外的配置选项对我们很有用，我们通常将交易定价在低端，因为我们并不总是需要它们立即通过，使用新的配置，我们可以增加超时和阻止确认，例如:</p><figure class="ji jj jk jl fq jm"><div class="bz el l di"><div class="ko kp l"/></div></figure><p id="5a7c" class="pw-post-body-paragraph jq jr ht js b jt ju iu jv jw jx ix jy jz ka kb kc kd ke kf kg kh ki kj kk kl hm dt translated">这意味着我们可以更有信心运行迁移，而不用担心时间，这在Truffle 4迁移中确实发生了。</p><p id="549f" class="pw-post-body-paragraph jq jr ht js b jt ju iu jv jw jx ix jy jz ka kb kc kd ke kf kg kh ki kj kk kl hm dt translated"><strong class="js hu">回复原因字符串</strong> ✅</p><p id="9e25" class="pw-post-body-paragraph jq jr ht js b jt ju iu jv jw jx ix jy jz ka kb kc kd ke kf kg kh ki kj kk kl hm dt translated">一个期待已久的新功能——给Solidity和Web3带来了最新的变化。测试现在可以验证失败原因，如果需要，前端逻辑可以显示这个原因。</p><figure class="ji jj jk jl fq jm"><div class="bz el l di"><div class="ko kp l"/></div></figure><p id="5884" class="pw-post-body-paragraph jq jr ht js b jt ju iu jv jw jx ix jy jz ka kb kc kd ke kf kg kh ki kj kk kl hm dt translated">这使我们能够加强测试，并在一个场合发现假阳性。此外，在需要时将这些原因呈现给前端是诊断潜在问题的一大优势。</p><p id="d4a5" class="pw-post-body-paragraph jq jr ht js b jt ju iu jv jw jx ix jy jz ka kb kc kd ke kf kg kh ki kj kk kl hm dt translated"><strong class="js hu">bignome . js到BN.js </strong>😠</p><p id="57a2" class="pw-post-body-paragraph jq jr ht js b jt ju iu jv jw jx ix jy jz ka kb kc kd ke kf kg kh ki kj kk kl hm dt translated">从<a class="ae km" href="https://github.com/trufflesuite/truffle/releases/tag/v5.0.0#user-content-breaking-changes" rel="noopener ugc nofollow" target="_blank">bignome . js切换到BN.js </a>的变化让我们大吃一惊。我们升级所花的大部分时间都是在进行数千次测试，这些测试利用BigNumber并将它们转换为bn . js——我知道web3 1.0的引入迫使我们进行了这一迁移，我只是希望有一种更简单的方法来完成它。我还发现了将BN.js与<strong class="js hu"> <em class="kn"> bn-chai </em> </strong>和<strong class="js hu"> should.js </strong>一起使用的问题，详见<a class="ae km" href="https://github.com/EthWorks/bn-chai/issues/2" rel="noopener ugc nofollow" target="_blank">此处</a>。</p><p id="c7f6" class="pw-post-body-paragraph jq jr ht js b jt ju iu jv jw jx ix jy jz ka kb kc kd ke kf kg kh ki kj kk kl hm dt translated"><strong class="js hu">从ASCII到HEX的显式转换</strong>😠</p><p id="44ff" class="pw-post-body-paragraph jq jr ht js b jt ju iu jv jw jx ix jy jz ka kb kc kd ke kf kg kh ki kj kk kl hm dt translated">这似乎是一个不必要的改变，大概Truffle在调用时知道方法参数和签名，所以我认为显式转换为十六进制的新要求似乎是一个不必要的改变，理想情况下，它会以某种方式为我进行类型转换。</p><blockquote class="kq kr ks"><p id="d3ac" class="jq jr kn js b jt ju iu jv jw jx ix jy kt ka kb kc ku ke kf kg kv ki kj kk kl hm dt translated">类型为<code class="eh kw kx ky kz b"><em class="ht">bytes</em></code>的函数参数现在必须使用<code class="eh kw kx ky kz b"><a class="ae km" href="https://web3js.readthedocs.io/en/1.0/web3-utils.html#asciitohex" rel="noopener ugc nofollow" target="_blank"><em class="ht">web3.utils.asciiToHex()</em></a></code>转换为十六进制字节字符串。</p></blockquote><h2 id="d89f" class="la lb ht bd lc ld le lf lg lh li lj lk jz ll lm ln kd lo lp lq kh lr ls lt lu dt translated">结论</h2><p id="490c" class="pw-post-body-paragraph jq jr ht js b jt lv iu jv jw lw ix jy jz lx kb kc kd ly kf kg kh lz kj kk kl hm dt translated">总结来说，最新的Truffle 5版本是一个巨大的改进，应该被所有运行生产就绪的Truffle部署的人考虑。所有参与的人都应该为这个版本投入的成千上万个小时和承诺感到骄傲。以上只是一些我们喜欢的新功能，我们计划在未来探索和利用更多的新功能。</p><p id="df7b" class="pw-post-body-paragraph jq jr ht js b jt ju iu jv jw jx ix jy jz ka kb kc kd ke kf kg kh ki kj kk kl hm dt translated">我们将继续使用和支持松露，并看到它非常积极的未来。完整的发行说明可以在这里找到<a class="ae km" href="https://github.com/trufflesuite/truffle/releases/tag/v5.0.0#user-content-what-s-new-in-truffle-v5-interacting-with-your-contracts-websockets" rel="noopener ugc nofollow" target="_blank">https://github . com/truffle suite/truffle/releases/tag/v 5 . 0 . 0 # user-content-what-s-new-in-truffle-V5-interactive-with-your-contracts-web sockets</a></p><p id="3725" class="pw-post-body-paragraph jq jr ht js b jt ju iu jv jw jx ix jy jz ka kb kc kd ke kf kg kh ki kj kk kl hm dt translated">祝平安和新年快乐！<a class="ae km" href="http://blockrocket.tech" rel="noopener ugc nofollow" target="_blank"> blockrocket.tech </a></p><p id="b637" class="pw-post-body-paragraph jq jr ht js b jt ju iu jv jw jx ix jy jz ka kb kc kd ke kf kg kh ki kj kk kl hm dt translated">在twitter上关注我们— <a class="ae km" href="https://twitter.com/blockrockettech" rel="noopener ugc nofollow" target="_blank"> @blockrockettech </a></p><p id="74be" class="pw-post-body-paragraph jq jr ht js b jt ju iu jv jw jx ix jy jz ka kb kc kd ke kf kg kh ki kj kk kl hm dt translated">报名参加我们的社区聚会— <a class="ae km" href="https://meetup.com/BlockchainManchesterMeetup" rel="noopener ugc nofollow" target="_blank">区块链曼彻斯特</a></p><blockquote class="ma"><p id="d1cd" class="mb mc ht bd md me mf mg mh mi mj kl ek translated"><a class="ae km" href="https://coincodecap.com/?utm_source=coinmonks" rel="noopener ugc nofollow" target="_blank">在您的收件箱中直接获得最佳软件交易</a></p></blockquote><figure class="ml mm mn mo mp jm fe ff paragraph-image"><a href="https://coincodecap.com/?utm_source=coinmonks"><div class="fe ff mk"><img src="../Images/7c0b3dfdcbfea594cc0ae7d4f9bf6fcb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1168/format:webp/0*OJ-qb5G6i863msBB.png"/></div></a></figure><figure class="ji jj jk jl fq jm fe ff paragraph-image"><a href="http://bit.ly/2G71Sp7"><div class="fe ff mq"><img src="../Images/449450761cd76f44f9ae574333f9e9af.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fKX2mtg7p1lOs7JmosPLsA.png"/></div></a><figcaption class="mr ms fg fe ff mt mu bd b be z ek"><strong class="bd mv">Read today’s Top Story</strong></figcaption></figure></div></div>    
</body>
</html>