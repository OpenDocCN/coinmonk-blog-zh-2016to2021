<html>
<head>
<title>DevOps toolkits: ELK stack — organizing log data</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">DevOps工具包:ELK堆栈—组织日志数据</h1>
<blockquote>原文：<a href="https://medium.com/coinmonks/when-you-throw-a-web-crawler-to-a-devops-elk-9a2a7cccf95a?source=collection_archive---------3-----------------------#2018-11-09">https://medium.com/coinmonks/when-you-throw-a-web-crawler-to-a-devops-elk-9a2a7cccf95a?source=collection_archive---------3-----------------------#2018-11-09</a></blockquote><div><div class="ef hh hi hj hk hl"/><div class="hm hn ho hp hq"><div class=""/><div class=""><h2 id="a763" class="pw-subtitle-paragraph iq hs ht bd b ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ek translated"><a class="ae ji" rel="noopener" href="/coinmonks/when-you-throw-a-web-crawler-to-a-devops-supervisord-562765606f7b">第一部分—主管</a></h2></div><figure class="jk jl jm jn fq jo fe ff paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="fe ff jj"><img src="../Images/22d50f9bc4b9beaca03e4243eadb799b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*vs8T2O-ejURzaDAo"/></div></div><figcaption class="jv jw fg fe ff jx jy bd b be z ek"><a class="ae ji" href="http://www.idfor-solutions.com/elasticsearch-logstash-kibana-expertise/" rel="noopener ugc nofollow" target="_blank">source</a></figcaption></figure><p id="07d1" class="pw-post-body-paragraph jz ka ht kb b kc kd iu ke kf kg ix kh ki kj kk kl km kn ko kp kq kr ks kt ku hm dt translated"><strong class="kb hu">ELK stack——一种可扩展的日志数据组织方式。</strong></p><p id="8643" class="pw-post-body-paragraph jz ka ht kb b kc kd iu ke kf kg ix kh ki kj kk kl km kn ko kp kq kr ks kt ku hm dt translated">在增加了监控器以增强网络爬虫的稳定性之后，我们将要解决另一个主要问题——<strong class="kb hu">可观测性</strong>。</p><p id="5868" class="pw-post-body-paragraph jz ka ht kb b kc kd iu ke kf kg ix kh ki kj kk kl km kn ko kp kq kr ks kt ku hm dt translated">主管确实输出了我们代码的日志。但是，我们如何读取这些日志呢？使用grep？还是打开记事本按ctrl-f找bug？日志太原始了，还不可读。它必须以一种有组织的方式进行。</p><p id="34c4" class="pw-post-body-paragraph jz ka ht kb b kc kd iu ke kf kg ix kh ki kj kk kl km kn ko kp kq kr ks kt ku hm dt translated">在这里，我们介绍了麋鹿栈，这是一个有点矫枉过正的任务，但它是确定的，因为它只是一个教程。</p><h1 id="572b" class="kv kw ht bd kx ky kz la lb lc ld le lf iz lg ja lh jc li jd lj jf lk jg ll lm dt translated">什么是麋鹿</h1><p id="5a48" class="pw-post-body-paragraph jz ka ht kb b kc ln iu ke kf lo ix kh ki lp kk kl km lq ko kp kq lr ks kt ku hm dt translated">ELK由三部分组成:</p><ul class=""><li id="716a" class="ls lt ht kb b kc kd kf kg ki lu km lv kq lw ku lx ly lz ma dt translated">电子弹性搜索</li><li id="5519" class="ls lt ht kb b kc mb kf mc ki md km me kq mf ku lx ly lz ma dt translated">L — Logstash</li><li id="36ee" class="ls lt ht kb b kc mb kf mc ki md km me kq mf ku lx ly lz ma dt translated">基巴纳</li></ul><figure class="jk jl jm jn fq jo fe ff paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="fe ff mg"><img src="../Images/5adecef32d8dabd8b7b3227895d791ac.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*LChzrTxPSzXdKljW.png"/></div></div><figcaption class="jv jw fg fe ff jx jy bd b be z ek"><a class="ae ji" href="https://hackernoon.com/elastic-stack-a-brief-introduction-794bc7ff7d4f" rel="noopener ugc nofollow" target="_blank">source</a></figcaption></figure><p id="f987" class="pw-post-body-paragraph jz ka ht kb b kc kd iu ke kf kg ix kh ki kj kk kl km kn ko kp kq kr ks kt ku hm dt translated">这三个模块负责不同的任务，简单地说</p><ul class=""><li id="a9fa" class="ls lt ht kb b kc kd kf kg ki lu km lv kq lw ku lx ly lz ma dt translated">log stash——将日志数据路由到Elasticsearach</li><li id="794c" class="ls lt ht kb b kc mb kf mc ki md km me kq mf ku lx ly lz ma dt translated">elastic search——一个强大的搜索引擎，在这里它被用来索引日志</li><li id="f137" class="ls lt ht kb b kc mb kf mc ki md km me kq mf ku lx ly lz ma dt translated">kibana——与Elasticsearch绑定的可视化工具</li></ul><p id="59d3" class="pw-post-body-paragraph jz ka ht kb b kc kd iu ke kf kg ix kh ki kj kk kl km kn ko kp kq kr ks kt ku hm dt translated">每个工具都有独特而强大的功能。这三个工具一起使用是很自然的。您可以在这个堆栈中添加更多的模块，例如</p><ul class=""><li id="55d2" class="ls lt ht kb b kc kd kf kg ki lu km lv kq lw ku lx ly lz ma dt translated"><a class="ae ji" href="https://www.elastic.co/products/beats" rel="noopener ugc nofollow" target="_blank">打败了</a>，一个数据运送器运送不同种类的数据</li><li id="30f0" class="ls lt ht kb b kc mb kf mc ki md km me kq mf ku lx ly lz ma dt translated"><a class="ae ji" href="https://www.elastic.co/products/stack/elasticsearch-sql" rel="noopener ugc nofollow" target="_blank"> Elastic SQL </a>，使用SQL访问Elasticsearch的特性</li></ul><p id="a973" class="pw-post-body-paragraph jz ka ht kb b kc kd iu ke kf kg ix kh ki kj kk kl km kn ko kp kq kr ks kt ku hm dt translated">如果你不喜欢kibana界面:<a class="ae ji" rel="noopener" href="/gradiant-talks/customizing-kibana-web-application-f74c1b48ec73"> <strong class="kb hu">这个</strong> </a>就是你可以自定义布局的方式(本教程可能在6.1.3版本之后对kibana不再有效)</p><p id="f7c3" class="pw-post-body-paragraph jz ka ht kb b kc kd iu ke kf kg ix kh ki kj kk kl km kn ko kp kq kr ks kt ku hm dt translated">或者您可以选择其他可视化工具，如<a class="ae ji" href="https://grafana.com/" rel="noopener ugc nofollow" target="_blank"> <strong class="kb hu"> Grafana </strong> </a> <strong class="kb hu">，</strong>或<a class="ae ji" href="http://graphiteapp.org/" rel="noopener ugc nofollow" target="_blank"><strong class="kb hu">Graphite</strong></a><br/>三个工具的比较:<a class="ae ji" href="https://stackshare.io/stackups/grafana-vs-graphite-vs-kibana" rel="noopener ugc nofollow" target="_blank">https://stack share . io/stack ups/Grafana-vs-Graphite-vs-ki Bana</a></p><h1 id="39a0" class="kv kw ht bd kx ky kz la lb lc ld le lf iz lg ja lh jc li jd lj jf lk jg ll lm dt translated">利用麋鹿</h1><p id="e3e6" class="pw-post-body-paragraph jz ka ht kb b kc ln iu ke kf lo ix kh ki lp kk kl km lq ko kp kq lr ks kt ku hm dt translated">使用ELK的一个常见做法是下载docker映像并使用<code class="eh mh mi mj mk b">docker-compose up</code>运行这三个实例。</p><p id="35f7" class="pw-post-body-paragraph jz ka ht kb b kc kd iu ke kf kg ix kh ki kj kk kl km kn ko kp kq kr ks kt ku hm dt translated"><a class="ae ji" href="https://github.com/deviantony/docker-elk" rel="noopener ugc nofollow" target="_blank">https://github.com/deviantony/docker-elk</a></p><p id="befc" class="pw-post-body-paragraph jz ka ht kb b kc kd iu ke kf kg ix kh ki kj kk kl km kn ko kp kq kr ks kt ku hm dt translated">堆栈暴露以下端口:</p><ul class=""><li id="3dad" class="ls lt ht kb b kc kd kf kg ki lu km lv kq lw ku lx ly lz ma dt translated">9200: Elasticsearch HTTP</li><li id="4d35" class="ls lt ht kb b kc mb kf mc ki md km me kq mf ku lx ly lz ma dt translated">9300:弹性搜索TCP传输</li><li id="174b" class="ls lt ht kb b kc mb kf mc ki md km me kq mf ku lx ly lz ma dt translated">5601:基巴纳</li></ul><p id="c545" class="pw-post-body-paragraph jz ka ht kb b kc kd iu ke kf kg ix kh ki kj kk kl km kn ko kp kq kr ks kt ku hm dt translated">你只需要去<a class="ae ji" href="http://localhost:5601/" rel="noopener ugc nofollow" target="_blank"> localhost:5601 </a>就可以访问基巴纳。</p><h1 id="9b01" class="kv kw ht bd kx ky kz la lb lc ld le lf iz lg ja lh jc li jd lj jf lk jg ll lm dt translated">把主管和麋鹿结合起来</h1><p id="121d" class="pw-post-body-paragraph jz ka ht kb b kc ln iu ke kf lo ix kh ki lp kk kl km lq ko kp kq lr ks kt ku hm dt translated">使用:<a class="ae ji" href="https://github.com/dohop/supervisor-logstash-notifier" rel="noopener ugc nofollow" target="_blank">https://github.com/dohop/supervisor-logstash-notifier</a>T5】将日志从supervisor路由到logstash，并将这段代码添加到<code class="eh mh mi mj mk b">supervisord.conf</code></p><pre class="jk jl jm jn fq ml mk mm mn aw mo dt"><span id="2f5b" class="mp kw ht mk b fv mq mr l ms mt">[eventlistener:logging] environment=LOGSTASH_SERVER="localhost",LOGSTASH_PORT="5000",LOGSTASH_PROTO="tcp" <br/>command=logstash_notifier --capture-output <br/>events = PROCESS_STATE,PROCESS_LOG</span></pre><p id="92ce" class="pw-post-body-paragraph jz ka ht kb b kc kd iu ke kf kg ix kh ki kj kk kl km kn ko kp kq kr ks kt ku hm dt translated">然后你可以在kibana中找到来自主管的日志。</p><figure class="jk jl jm jn fq jo fe ff paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="fe ff jj"><img src="../Images/9de872785b0123f74fc81041c98d34c1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*WdLGJ--DlfP9dmrx.png"/></div></div><figcaption class="jv jw fg fe ff jx jy bd b be z ek"><a class="ae ji" href="https://www.elastic.co/guide/en/kibana/current/discover.html" rel="noopener ugc nofollow" target="_blank">source</a></figcaption></figure><p id="1b6e" class="pw-post-body-paragraph jz ka ht kb b kc kd iu ke kf kg ix kh ki kj kk kl km kn ko kp kq kr ks kt ku hm dt translated">您甚至可以创建图表来总结日志</p><figure class="jk jl jm jn fq jo fe ff paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="fe ff jj"><img src="../Images/bf2e8dec1924ef877c8e72e1cce90077.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*a5pNQ7a1CDbiB1RD.jpg"/></div></div><figcaption class="jv jw fg fe ff jx jy bd b be z ek"><a class="ae ji" href="https://www.elastic.co/products/kibana" rel="noopener ugc nofollow" target="_blank">source</a></figcaption></figure></div><div class="ab cl mu mv hb mw" role="separator"><span class="mx bw bk my mz na"/><span class="mx bw bk my mz na"/><span class="mx bw bk my mz"/></div><div class="hm hn ho hp hq"><h2 id="ee5f" class="mp kw ht bd kx nb nc nd lb ne nf ng lf ki nh ni lh km nj nk lj kq nl nm ll nn dt translated"><a class="ae ji" rel="noopener" href="/coinmonks/when-you-throw-a-web-crawler-to-a-devops-supervisord-562765606f7b">第1部分—主管</a></h2><blockquote class="no"><p id="30e0" class="np nq ht bd nr ns nt nu nv nw nx ku ek translated"><a class="ae ji" href="https://coincodecap.com/?utm_source=coinmonks" rel="noopener ugc nofollow" target="_blank">直接在您的收件箱中获得最佳软件交易</a></p></blockquote><figure class="nz oa ob oc od jo fe ff paragraph-image"><a href="https://coincodecap.com/?utm_source=coinmonks"><div class="fe ff ny"><img src="../Images/7c0b3dfdcbfea594cc0ae7d4f9bf6fcb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1168/format:webp/0*OJ-qb5G6i863msBB.png"/></div></a></figure></div></div>    
</body>
</html>