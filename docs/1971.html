<html>
<head>
<title>Hyperledger Fabric By Example: Part 5</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">超分类帐结构示例:第5部分</h1>
<blockquote>原文：<a href="https://medium.com/coinmonks/hyperledger-fabric-by-example-part-5-67b8185078f2?source=collection_archive---------4-----------------------#2019-01-14">https://medium.com/coinmonks/hyperledger-fabric-by-example-part-5-67b8185078f2?source=collection_archive---------4-----------------------#2019-01-14</a></blockquote><div><div class="ef hh hi hj hk hl"/><div class="hm hn ho hp hq"><div class=""/><div class=""><h2 id="22a3" class="pw-subtitle-paragraph iq hs ht bd b ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ek translated">在网络中增加一个信道。</h2></div><figure class="jj jk jl jm fq jn fe ff paragraph-image"><div role="button" tabindex="0" class="jo jp di jq bf jr"><div class="fe ff ji"><img src="../Images/e5f8456c3190ae4aa6d3152a0b083d76.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cSR9yu7WhPnjhu1JX79zUg.jpeg"/></div></div></figure><p id="a0f2" class="pw-post-body-paragraph ju jv ht jw b jx jy iu jz ka kb ix kc kd ke kf kg kh ki kj kk kl km kn ko kp hm dt translated">本文是以<a class="ae kq" rel="noopener" href="/@johntucker_48673/hyperledger-fabric-by-example-part-1-758547e9fb04"><em class="kr">Hyperledger Fabric By Example:Part 1</em></a>开始的系列文章的一部分。</p><p id="4f56" class="pw-post-body-paragraph ju jv ht jw b jx jy iu jz ka kb ix kc kd ke kf kg kh ki kj kk kl km kn ko kp hm dt translated"><strong class="jw hu">命令行界面(CLI) </strong></p><p id="11a5" class="pw-post-body-paragraph ju jv ht jw b jx jy iu jz ka kb ix kc kd ke kf kg kh ki kj kk kl km kn ko kp hm dt translated">到目前为止，我们已经通过创建一个配置文件来配置示例网络，这个文件是<em class="kr"> genesis.block </em>文件；用于自举<em class="kr">orderer.example.com</em>节点。</p><p id="be57" class="pw-post-body-paragraph ju jv ht jw b jx jy iu jz ka kb ix kc kd ke kf kg kh ki kj kk kl km kn ko kp hm dt translated">今后，我们将希望能够在所有节点都已启动之后，即在所有<em class="kr"> Docker </em>容器都在运行之后，配置网络。</p><p id="7fa5" class="pw-post-body-paragraph ju jv ht jw b jx jy iu jz ka kb ix kc kd ke kf kg kh ki kj kk kl km kn ko kp hm dt translated">为此，我们创建了一个额外的容器，我们可以远程访问它并从中执行配置命令。我们用一个额外的容器向<em class="kr"> Docker Compose </em>文件添加一个部分:</p><p id="f44a" class="pw-post-body-paragraph ju jv ht jw b jx jy iu jz ka kb ix kc kd ke kf kg kh ki kj kk kl km kn ko kp hm dt translated"><em class="kr">。/first-network/docker-compose-CLI . YAML</em></p><figure class="jj jk jl jm fq jn"><div class="bz el l di"><div class="ks kt l"/></div></figure><p id="dd1e" class="pw-post-body-paragraph ju jv ht jw b jx jy iu jz ka kb ix kc kd ke kf kg kh ki kj kk kl km kn ko kp hm dt translated">观察结果:</p><ul class=""><li id="f285" class="ku kv ht jw b jx jy ka kb kd kw kh kx kl ky kp kz la lb lc dt translated">找不到关于<em class="kr"> Docker </em>容器、<em class="kr">hyperledger/fabric-tools</em>的文档</li><li id="0377" class="ku kv ht jw b jx ld ka le kd lf kh lg kl lh kp kz la lb lc dt translated">这种配置目前是硬编码的，只能与<em class="kr">peer0.org1.example.com</em>对等机通信；当我们与其他对等体通信时，我们将不得不覆盖几个环境变量</li></ul><p id="64d7" class="pw-post-body-paragraph ju jv ht jw b jx jy iu jz ka kb ix kc kd ke kf kg kh ki kj kk kl km kn ko kp hm dt translated">因为我们想要开始新的<em class="kr"> Docker </em>图像，所以我们停下来删除我们之前创建的图像:</p><pre class="jj jk jl jm fq li lj lk ll aw lm dt"><span id="dfc8" class="ln lo ht lj b fv lp lq l lr ls">docker stop $(docker ps -aq)<br/>docker rm $(docker ps -aq)</span></pre><p id="4a1d" class="pw-post-body-paragraph ju jv ht jw b jx jy iu jz ka kb ix kc kd ke kf kg kh ki kj kk kl km kn ko kp hm dt translated">如前所述，我们提出了网络:</p><pre class="jj jk jl jm fq li lj lk ll aw lm dt"><span id="ec80" class="ln lo ht lj b fv lp lq l lr ls">docker-compose -f docker-compose-cli.yaml up</span></pre><p id="e263" class="pw-post-body-paragraph ju jv ht jw b jx jy iu jz ka kb ix kc kd ke kf kg kh ki kj kk kl km kn ko kp hm dt translated">通过运行:</p><pre class="jj jk jl jm fq li lj lk ll aw lm dt"><span id="b897" class="ln lo ht lj b fv lp lq l lr ls">docker ps</span></pre><p id="1228" class="pw-post-body-paragraph ju jv ht jw b jx jy iu jz ka kb ix kc kd ke kf kg kh ki kj kk kl km kn ko kp hm dt translated">我们可以看到我们有六个容器。一个是新的CLI容器。</p><figure class="jj jk jl jm fq jn fe ff paragraph-image"><div role="button" tabindex="0" class="jo jp di jq bf jr"><div class="fe ff lt"><img src="../Images/480b82d25beee8e109a4624a0ec7d584.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3BAqQz3Cikukg3w3my4Z-Q.png"/></div></div></figure><p id="85c8" class="pw-post-body-paragraph ju jv ht jw b jx jy iu jz ka kb ix kc kd ke kf kg kh ki kj kk kl km kn ko kp hm dt translated"><strong class="jw hu">通道</strong></p><p id="51c5" class="pw-post-body-paragraph ju jv ht jw b jx jy iu jz ka kb ix kc kd ke kf kg kh ki kj kk kl km kn ko kp hm dt translated">此时，网络中的所有节点都已运行，我们开始使用CLI容器配置网络；接下来的步骤将在概念上的<em class="kr">Hyperledger Fabric block chain Network</em>关于<a class="ae kq" href="https://hyperledger-fabric.readthedocs.io/en/latest/network/network.html#creating-a-channel-for-a-consortium" rel="noopener ugc nofollow" target="_blank"> <em class="kr">为财团创建渠道的文档</em> </a> <em class="kr"> </em> ( <strong class="jw hu">请在继续</strong>之前阅读这些章节)。</p><p id="443c" class="pw-post-body-paragraph ju jv ht jw b jx jy iu jz ka kb ix kc kd ke kf kg kh ki kj kk kl km kn ko kp hm dt translated">一个<strong class="jw hu">通道</strong>是:</p><blockquote class="lu lv lw"><p id="5442" class="ju jv kr jw b jx jy iu jz ka kb ix kc lx ke kf kg ly ki kj kk lz km kn ko kp hm dt translated">通道是一个私有的区块链覆盖层，允许数据隔离和保密。特定于渠道的分类帐在渠道中的对等方之间共享，交易方必须通过渠道的正确身份验证才能与之交互。通道由配置块定义。</p></blockquote><p id="df39" class="pw-post-body-paragraph ju jv ht jw b jx jy iu jz ka kb ix kc kd ke kf kg kh ki kj kk kl km kn ko kp hm dt translated"><em class="kr"> —总账结构— </em> <a class="ae kq" href="https://hyperledger-fabric.readthedocs.io/en/latest/glossary.html" rel="noopener ugc nofollow" target="_blank"> <em class="kr">术语表</em> </a></p><p id="ff67" class="pw-post-body-paragraph ju jv ht jw b jx jy iu jz ka kb ix kc kd ke kf kg kh ki kj kk kl km kn ko kp hm dt translated">在我们的示例中，我们将使用<strong class="jw hu">通道配置(CC) </strong> <em class="kr">创建一个新通道<em class="kr"> mychannel、</em>。</em>该通道与<em class="kr">样品联合体</em>和两个组织(<em class="kr"> Org1MSP </em>和<em class="kr"> Org2MSP </em>)相关联。</p><figure class="jj jk jl jm fq jn fe ff paragraph-image"><div role="button" tabindex="0" class="jo jp di jq bf jr"><div class="fe ff ma"><img src="../Images/bbd0a40b7ec68ac03cdbc24914651d87.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jggX4y-j1v4f8Gj9CahY8g.png"/></div></div></figure><p id="7020" class="pw-post-body-paragraph ju jv ht jw b jx jy iu jz ka kb ix kc kd ke kf kg kh ki kj kk kl km kn ko kp hm dt translated">我们用新的配置文件更新<em class="kr"> Hyperledger Fabric </em>配置文件；在这次更新中，我们使用示例提供的<a class="ae kq" href="https://gist.github.com/larkintuckerllc/7ae7d7b47cdf731a2ccb2a386bb2d383" rel="noopener ugc nofollow" target="_blank">原始文件</a>(放回注释中)。</p><p id="78a7" class="pw-post-body-paragraph ju jv ht jw b jx jy iu jz ka kb ix kc kd ke kf kg kh ki kj kk kl km kn ko kp hm dt translated"><em class="kr">。/first-network/configtx . YAML</em></p><figure class="jj jk jl jm fq jn"><div class="bz el l di"><div class="ks kt l"/></div></figure><p id="d043" class="pw-post-body-paragraph ju jv ht jw b jx jy iu jz ka kb ix kc kd ke kf kg kh ki kj kk kl km kn ko kp hm dt translated">然后，我们生成另一个文件<em class="kr"> channel.tx </em>，我们将在CLI容器中使用它:</p><pre class="jj jk jl jm fq li lj lk ll aw lm dt"><span id="4e5c" class="ln lo ht lj b fv lp lq l lr ls">configtxgen -profile TwoOrgsChannel -outputCreateChannelTx ./channel-artifacts/channel.tx -channelID mychannel</span></pre><p id="e6a7" class="pw-post-body-paragraph ju jv ht jw b jx jy iu jz ka kb ix kc kd ke kf kg kh ki kj kk kl km kn ko kp hm dt translated">然后，我们远程进入CLI容器:</p><pre class="jj jk jl jm fq li lj lk ll aw lm dt"><span id="c34e" class="ln lo ht lj b fv lp lq l lr ls">docker exec -it cli bash</span></pre><p id="81c3" class="pw-post-body-paragraph ju jv ht jw b jx jy iu jz ka kb ix kc kd ke kf kg kh ki kj kk kl km kn ko kp hm dt translated">并执行以下命令:</p><pre class="jj jk jl jm fq li lj lk ll aw lm dt"><span id="9a42" class="ln lo ht lj b fv lp lq l lr ls">peer channel create -o orderer.example.com:7050 -c mychannel -f ./channel-artifacts/channel.tx --tls --cafile /opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/ordererOrganizations/example.com/orderers/orderer.example.com/msp/tlscacerts/tlsca.example.com-cert.pem</span></pre><p id="d813" class="pw-post-body-paragraph ju jv ht jw b jx jy iu jz ka kb ix kc kd ke kf kg kh ki kj kk kl km kn ko kp hm dt translated"><em class="kr">建立你的第一个网络</em>确实提供了一些关于幕后发生的事情的有用信息，在这个例子中:</p><blockquote class="lu lv lw"><p id="5a44" class="ju jv kr jw b jx jy iu jz ka kb ix kc lx ke kf kg ly ki kj kk lz km kn ko kp hm dt translated">该命令返回一个genesis块— <channel-id.block> —我们将使用它来加入通道。它包含channel.tx中指定的配置信息。如果您没有对默认通道名称进行任何修改，则该命令将返回一个标题为mychannel.block的原型。</channel-id.block></p></blockquote><p id="fe64" class="pw-post-body-paragraph ju jv ht jw b jx jy iu jz ka kb ix kc kd ke kf kg kh ki kj kk kl km kn ko kp hm dt translated"><em class="kr">—Hyperledger Fabric—</em><a class="ae kq" href="https://hyperledger-fabric.readthedocs.io/en/latest/build_network.html" rel="noopener ugc nofollow" target="_blank"><em class="kr">构建你的第一张网络</em> </a></p><p id="e48a" class="pw-post-body-paragraph ju jv ht jw b jx jy iu jz ka kb ix kc kd ke kf kg kh ki kj kk kl km kn ko kp hm dt translated">接下来，我们将使用<em class="kr"> mychannel.block </em>将对等体加入通道。</p><p id="60d4" class="pw-post-body-paragraph ju jv ht jw b jx jy iu jz ka kb ix kc kd ke kf kg kh ki kj kk kl km kn ko kp hm dt translated"><strong class="jw hu">将对等体加入通道</strong></p><p id="74d4" class="pw-post-body-paragraph ju jv ht jw b jx jy iu jz ka kb ix kc kd ke kf kg kh ki kj kk kl km kn ko kp hm dt translated">既然我们已经创建了渠道，我们需要加入同行。；接下来的步骤将在概念上的<em class="kr">Hyperledger Fabric block chain Network</em>文档中介绍<a class="ae kq" href="https://hyperledger-fabric.readthedocs.io/en/latest/network/network.html#peers-and-ledgers" rel="noopener ugc nofollow" target="_blank"> <em class="kr">对等体和分类帐</em> </a> ( <strong class="jw hu">请在继续</strong>之前阅读这些章节)。</p><p id="8dc8" class="pw-post-body-paragraph ju jv ht jw b jx jy iu jz ka kb ix kc kd ke kf kg kh ki kj kk kl km kn ko kp hm dt translated">在这里，我们将努力把<em class="kr">peer0.org1.example.com</em>和<em class="kr">peer0.org2.example.com</em>加入<em class="kr"> mynetwork </em>频道；这样就创建了一个<strong class="jw hu">分布式分类账(L) </strong>。</p><figure class="jj jk jl jm fq jn fe ff paragraph-image"><div role="button" tabindex="0" class="jo jp di jq bf jr"><div class="fe ff ma"><img src="../Images/4b0fb8f78387858c366495ad2425b47f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GikYZr7jb9Yhk8vObdniVg.png"/></div></div></figure><p id="93c2" class="pw-post-body-paragraph ju jv ht jw b jx jy iu jz ka kb ix kc kd ke kf kg kh ki kj kk kl km kn ko kp hm dt translated">使用CLI容器:</p><pre class="jj jk jl jm fq li lj lk ll aw lm dt"><span id="d7f3" class="ln lo ht lj b fv lp lq l lr ls">docker exec -it cli bash</span></pre><p id="2b68" class="pw-post-body-paragraph ju jv ht jw b jx jy iu jz ka kb ix kc kd ke kf kg kh ki kj kk kl km kn ko kp hm dt translated">我们执行以下命令将<em class="kr">peer0.org1.example.com</em>加入<em class="kr">我的通道</em>。</p><pre class="jj jk jl jm fq li lj lk ll aw lm dt"><span id="cdc6" class="ln lo ht lj b fv lp lq l lr ls">peer channel join -b mychannel.block</span></pre><p id="a2f2" class="pw-post-body-paragraph ju jv ht jw b jx jy iu jz ka kb ix kc kd ke kf kg kh ki kj kk kl km kn ko kp hm dt translated">正如我们前面指出的，创建的CLI容器是硬编码的，可以与<em class="kr">peer0.org1.example.com</em>一起工作；因此，我们需要忽略一些环境变量，将<em class="kr">peer0.org2.example.com</em>连接到<em class="kr">我的频道</em>。</p><pre class="jj jk jl jm fq li lj lk ll aw lm dt"><span id="bd07" class="ln lo ht lj b fv lp lq l lr ls">CORE_PEER_MSPCONFIGPATH=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org2.example.com/users/Admin@org2.example.com/msp CORE_PEER_ADDRESS=peer0.org2.example.com:7051 CORE_PEER_LOCALMSPID="Org2MSP" CORE_PEER_TLS_ROOTCERT_FILE=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org2.example.com/peers/peer0.org2.example.com/tls/ca.crt peer channel join -b mychannel.block</span></pre><p id="9bfa" class="pw-post-body-paragraph ju jv ht jw b jx jy iu jz ka kb ix kc kd ke kf kg kh ki kj kk kl km kn ko kp hm dt translated"><strong class="jw hu">主播同行</strong></p><p id="dca1" class="pw-post-body-paragraph ju jv ht jw b jx jy iu jz ka kb ix kc kd ke kf kg kh ki kj kk kl km kn ko kp hm dt translated">正如我们之前提到的，我们需要将<em class="kr">peer0.org1.example.com</em>和<em class="kr">peer0.org2.example.com</em>配置为每个组织的<em class="kr">我的频道</em>的主持人。</p><p id="51d6" class="pw-post-body-paragraph ju jv ht jw b jx jy iu jz ka kb ix kc kd ke kf kg kh ki kj kk kl km kn ko kp hm dt translated">与通道创建步骤一样，我们需要使用<em class="kr"> configtxgen </em>命令行界面工具生成一个文件:</p><pre class="jj jk jl jm fq li lj lk ll aw lm dt"><span id="ff45" class="ln lo ht lj b fv lp lq l lr ls">configtxgen -profile TwoOrgsChannel -outputAnchorPeersUpdate ./channel-artifacts/Org1MSPanchors.tx -channelID mychannel -asOrg Org1MSP</span></pre><p id="017e" class="pw-post-body-paragraph ju jv ht jw b jx jy iu jz ka kb ix kc kd ke kf kg kh ki kj kk kl km kn ko kp hm dt translated">并且再次为<em class="kr"> Org2MSP </em>:</p><pre class="jj jk jl jm fq li lj lk ll aw lm dt"><span id="8f08" class="ln lo ht lj b fv lp lq l lr ls">configtxgen -profile TwoOrgsChannel -outputAnchorPeersUpdate ./channel-artifacts/Org2MSPanchors.tx -channelID mychannel -asOrg Org2MSP</span></pre><p id="130b" class="pw-post-body-paragraph ju jv ht jw b jx jy iu jz ka kb ix kc kd ke kf kg kh ki kj kk kl km kn ko kp hm dt translated">然后，我们远程访问CLI容器并运行:</p><pre class="jj jk jl jm fq li lj lk ll aw lm dt"><span id="ccbc" class="ln lo ht lj b fv lp lq l lr ls">peer channel update -o orderer.example.com:7050 -c mychannel -f ./channel-artifacts/Org1MSPanchors.tx --tls --cafile /opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/ordererOrganizations/example.com/orderers/orderer.example.com/msp/tlscacerts/tlsca.example.com-cert.pem</span></pre><p id="e74a" class="pw-post-body-paragraph ju jv ht jw b jx jy iu jz ka kb ix kc kd ke kf kg kh ki kj kk kl km kn ko kp hm dt translated">而对于<em class="kr">org 2 MSP；</em>用环境变量设置:</p><pre class="jj jk jl jm fq li lj lk ll aw lm dt"><span id="acb7" class="ln lo ht lj b fv lp lq l lr ls">CORE_PEER_MSPCONFIGPATH=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org2.example.com/users/Admin@org2.example.com/msp CORE_PEER_ADDRESS=peer0.org2.example.com:7051 CORE_PEER_LOCALMSPID="Org2MSP" CORE_PEER_TLS_ROOTCERT_FILE=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org2.example.com/peers/peer0.org2.example.com/tls/ca.crt peer channel update -o orderer.example.com:7050 -c mychannel -f ./channel-artifacts/Org2MSPanchors.tx --tls --cafile /opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/ordererOrganizations/example.com/orderers/orderer.example.com/msp/tlscacerts/tlsca.example.com-cert.pem</span></pre><p id="0736" class="pw-post-body-paragraph ju jv ht jw b jx jy iu jz ka kb ix kc kd ke kf kg kh ki kj kk kl km kn ko kp hm dt translated"><strong class="jw hu">接下来的步骤</strong></p><p id="0dfc" class="pw-post-body-paragraph ju jv ht jw b jx jy iu jz ka kb ix kc kd ke kf kg kh ki kj kk kl km kn ko kp hm dt translated">在下一篇文章中，<a class="ae kq" rel="noopener" href="/@johntucker_48673/hyperledger-fabric-by-example-part-6-591d89158940"><em class="kr">Hyperledger Fabric By Example:Part 6</em></a>，我们在扩展网络的同时继续引入新概念。</p><figure class="jj jk jl jm fq jn fe ff paragraph-image"><a href="http://bit.ly/2G71Sp7"><div class="fe ff mb"><img src="../Images/449450761cd76f44f9ae574333f9e9af.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fKX2mtg7p1lOs7JmosPLsA.png"/></div></a></figure><blockquote class="mc"><p id="eb72" class="md me ht bd mf mg mh mi mj mk ml kp ek translated"><a class="ae kq" href="https://coincodecap.com/?utm_source=coinmonks" rel="noopener ugc nofollow" target="_blank">直接在您的收件箱中获得最佳软件交易</a></p></blockquote><figure class="mn mo mp mq mr jn fe ff paragraph-image"><a href="https://coincodecap.com/?utm_source=coinmonks"><div class="fe ff mm"><img src="../Images/7c0b3dfdcbfea594cc0ae7d4f9bf6fcb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1168/format:webp/0*OJ-qb5G6i863msBB.png"/></div></a></figure></div></div>    
</body>
</html>