<html>
<head>
<title/>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1/>
<blockquote>原文：<a href="https://medium.com/coinmonks/how-to-install-and-use-oyente-a-smart-contract-analyzer-5251731e4aab?source=collection_archive---------0-----------------------#2020-04-13">https://medium.com/coinmonks/how-to-install-and-use-oyente-a-smart-contract-analyzer-5251731e4aab?source=collection_archive---------0-----------------------#2020-04-13</a></blockquote><div><div class="ef hh hi hj hk hl"/><div class="hm hn ho hp hq"><figure class="hs ht fm fo hu hv fe ff paragraph-image"><div role="button" tabindex="0" class="hw hx di hy bf hz"><div class="fe ff hr"><img src="../Images/14f8ec2b902de5aeb2baf56d39d9ec5d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FFH9sjYB6z7ZI7OTEc2V-w.png"/></div></div></figure><h2 id="c41a" class="ic id ie bd if ig ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja dt translated">什么是Oyente，为什么是Oyente？</h2><p id="66d8" class="pw-post-body-paragraph jb jc ie jd b je jf jg jh ji jj jk jl io jm jn jo is jp jq jr iw js jt ju jv hm dt jw translated">加密货币在一种叫做区块链的分散数据结构中记录交易。两种最受欢迎的加密货币比特币和以太坊支持对处理交易的规则或脚本进行编码的功能。最近以太坊智能合约得到了稳定的采用。作为主要的智能合约语言，Solidity受到C++、Python和JavaScript的影响，旨在针对以太坊虚拟机(EVM)。但是这些智能合约容易受到某些攻击。</p><p id="17f2" class="pw-post-body-paragraph jb jc ie jd b je kf jg jh ji kg jk jl io kh jn jo is ki jq jr iw kj jt ju jv hm dt translated">Oyente是一个智能合同自动审计工具，它分析智能合同并返回可能的漏洞攻击，包括著名的DAO攻击。这是由新加坡国立大学的研究人员在2016年1月开发的。你可以参考在第23届ACM CCS会议上发表的论文<a class="ae kk" href="https://eprint.iacr.org/2016/633.pdf" rel="noopener ugc nofollow" target="_blank">这里</a>。</p><p id="3b79" class="pw-post-body-paragraph jb jc ie jd b je kf jg jh ji kg jk jl io kh jn jo is ki jq jr iw kj jt ju jv hm dt translated">在本文中，我们将演示如何在有和没有docker的情况下安装和使用Oyente。</p><p id="219d" class="pw-post-body-paragraph jb jc ie jd b je kf jg jh ji kg jk jl io kh jn jo is ki jq jr iw kj jt ju jv hm dt translated">安装oyente工具时最常见的错误是web3要求Python '≥3.5，此处&lt;4’ but the running python is 2.7.*</p><figure class="km kn ko kp fq hv fe ff paragraph-image"><div role="button" tabindex="0" class="hw hx di hy bf hz"><div class="fe ff kl"><img src="../Images/3b46f427443f64bed41ba87a9bcfdf4b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*r3X8YPnVtNTwnWvoX63t9w.png"/></div></div><figcaption class="kq kr fg fe ff ks kt bd b be z ek">Error while executing command “pip install oyente”</figcaption></figure><p id="d836" class="pw-post-body-paragraph jb jc ie jd b je kf jg jh ji kg jk jl io kh jn jo is ki jq jr iw kj jt ju jv hm dt translated">You may have tried changing pyhton versions, installing 3.7-dev but still you’ll encounter the above error.</p><p id="6e4a" class="pw-post-body-paragraph jb jc ie jd b je kf jg jh ji kg jk jl io kh jn jo is ki jq jr iw kj jt ju jv hm dt translated">But here we discuss, how to install without any errors. For development purposes, running oyente source code will be better option compared to dockerised oyente. Anyhow we will discuss both the ways.</p><h1 id="075e" class="ku id ie bd if kv kw kx ij ky kz la in lb lc ld ir le lf lg iv lh li lj iz lk dt translated">Installing with docker:</h1><p id="1bb0" class="pw-post-body-paragraph jb jc ie jd b je jf jg jh ji jj jk jl io jm jn jo is jp jq jr iw js jt ju jv hm dt translated">Installing with docker is easiest method since docker itself creates the environment required for running Oyente.</p><p id="eb1f" class="pw-post-body-paragraph jb jc ie jd b je kf jg jh ji kg jk jl io kh jn jo is ki jq jr iw kj jt ju jv hm dt translated">To open container, install docker and run</p><pre class="km kn ko kp fq ll lm ln lo aw lp dt"><span id="7923" class="ic id ie lm b fv lq lr l ls lt">sudo apt-get update</span><span id="6e3d" class="ic id ie lm b fv lu lr l ls lt">sudo apt install docker.io</span><span id="44b8" class="ic id ie lm b fv lu lr l ls lt">docker pull luongnguyen/oyente</span><span id="b125" class="ic id ie lm b fv lu lr l ls lt">docker run -i -t luongnguyen/oyente</span></pre><p id="4296" class="pw-post-body-paragraph jb jc ie jd b je kf jg jh ji kg jk jl io kh jn jo is ki jq jr iw kj jt ju jv hm dt translated">To evaluate the greeter contract inside the container, run</p><pre class="km kn ko kp fq ll lm ln lo aw lp dt"><span id="f473" class="ic id ie lm b fv lq lr l ls lt">cd /oyente/oyente</span><span id="2731" class="ic id ie lm b fv lu lr l ls lt">python oyente.py -s greeter.sol</span></pre><p id="f042" class="pw-post-body-paragraph jb jc ie jd b je kf jg jh ji kg jk jl io kh jn jo is ki jq jr iw kj jt ju jv hm dt translated">and you’re done.</p><figure class="km kn ko kp fq hv fe ff paragraph-image"><div role="button" tabindex="0" class="hw hx di hy bf hz"><div class="fe ff lv"><img src="../Images/d92fe2beafb9baba4dc1044628842409.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Zq-Qx8C_NcnAs6XIzrKU1g.png"/></div></div></figure><p id="4d05" class="pw-post-body-paragraph jb jc ie jd b je kf jg jh ji kg jk jl io kh jn jo is ki jq jr iw kj jt ju jv hm dt translated">But every time you evaluate a new smart contract you’ve to create a file in the container using unix commands and run the last command. You can install vim in the docker container, still it’s a hectic task to create and edit files.</p><h1 id="45dc" class="ku id ie bd if kv kw kx ij ky kz la in lb lc ld ir le lf lg iv lh li lj iz lk dt translated">Installing without docker:</h1><p id="3b6f" class="pw-post-body-paragraph jb jc ie jd b je jf jg jh ji jj jk jl io jm jn jo is jp jq jr iw js jt ju jv hm dt translated">Oyente tool requires the following dependencies:</p><ul class=""><li id="a353" class="lw lx ie jd b je kf ji kg io ly is lz iw ma jv mb mc md me dt translated">Solc</li><li id="ce3a" class="lw lx ie jd b je mf ji mg io mh is mi iw mj jv mb mc md me dt translated">Geth and evm</li><li id="037f" class="lw lx ie jd b je mf ji mg io mh is mi iw mj jv mb mc md me dt translated">Z3</li><li id="328f" class="lw lx ie jd b je mf ji mg io mh is mi iw mj jv mb mc md me dt translated">Python</li></ul><p id="53f4" class="pw-post-body-paragraph jb jc ie jd b je kf jg jh ji kg jk jl io kh jn jo is ki jq jr iw kj jt ju jv hm dt translated">There are two methods for this, both methods need the following commands to be run</p><p id="604d" class="pw-post-body-paragraph jb jc ie jd b je kf jg jh ji kg jk jl io kh jn jo is ki jq jr iw kj jt ju jv hm dt translated">If you haven’t installed python in your system, run the following commands</p><pre class="km kn ko kp fq ll lm ln lo aw lp dt"><span id="1648" class="ic id ie lm b fv lq lr l ls lt">sudo apt install software-properties-common</span><span id="0d15" class="ic id ie lm b fv lu lr l ls lt">sudo add-apt-repository ppa:deadsnakes/ppa</span><span id="b4b0" class="ic id ie lm b fv lu lr l ls lt">sudo apt update</span><span id="9f2f" class="ic id ie lm b fv lu lr l ls lt">sudo apt-get install python3</span></pre><p id="bdeb" class="pw-post-body-paragraph jb jc ie jd b je kf jg jh ji kg jk jl io kh jn jo is ki jq jr iw kj jt ju jv hm dt translated">Install z3. For this, download the file from this link <a class="ae kk" href="https://github.com/Z3Prover/z3/archive/z3-4.5.0.tar.gz" rel="noopener ugc nofollow" target="_blank">为</a>。</p><p id="0b71" class="pw-post-body-paragraph jb jc ie jd b je kf jg jh ji kg jk jl io kh jn jo is ki jq jr iw kj jt ju jv hm dt translated">提取文件，移动到目录中并运行以下命令(这将花费比您预期更多的时间):</p><pre class="km kn ko kp fq ll lm ln lo aw lp dt"><span id="59dd" class="ic id ie lm b fv lq lr l ls lt">python scripts/mk_make.py -python</span><span id="c120" class="ic id ie lm b fv lu lr l ls lt">cd build</span><span id="23cd" class="ic id ie lm b fv lu lr l ls lt">make</span><span id="9318" class="ic id ie lm b fv lu lr l ls lt">sudo make install</span></pre><blockquote class="mk ml mm"><p id="e42d" class="jb jc mn jd b je kf jg jh ji kg jk jl mo kh jn jo mp ki jq jr mq kj jt ju jv hm dt translated">注意:如果你在执行第一个命令后遇到任何MkException，那可能是由于ubuntu通常会附带的包丢失了。尝试执行这些命令，然后重新运行以上四个命令。</p><p id="6d38" class="jb jc mn jd b je kf jg jh ji kg jk jl mo kh jn jo mp ki jq jr mq kj jt ju jv hm dt translated">sudo apt安装binutils <br/> sudo apt-get安装构建-基本</p></blockquote><p id="b3e8" class="pw-post-body-paragraph jb jc ie jd b je kf jg jh ji kg jk jl io kh jn jo is ki jq jr iw kj jt ju jv hm dt translated">您需要安装这个库，</p><pre class="km kn ko kp fq ll lm ln lo aw lp dt"><span id="e5f2" class="ic id ie lm b fv lq lr l ls lt">sudo apt-get install libz3-dev</span></pre><h2 id="3219" class="ic id ie bd if ig ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja dt translated">安装Oyente工具:</h2><p id="33d1" class="pw-post-body-paragraph jb jc ie jd b je jf jg jh ji jj jk jl io jm jn jo is jp jq jr iw js jt ju jv hm dt translated">为此，您需要安装pip</p><pre class="km kn ko kp fq ll lm ln lo aw lp dt"><span id="9df8" class="ic id ie lm b fv lq lr l ls lt">sudo apt install python3-pip</span></pre><p id="56ac" class="pw-post-body-paragraph jb jc ie jd b je kf jg jh ji kg jk jl io kh jn jo is ki jq jr iw kj jt ju jv hm dt translated">执行以下命令:</p><pre class="km kn ko kp fq ll lm ln lo aw lp dt"><span id="ece7" class="ic id ie lm b fv lq lr l ls lt">sudo apt-get install solc</span><span id="533a" class="ic id ie lm b fv lu lr l ls lt">sudo apt-get install evm</span><span id="0640" class="ic id ie lm b fv lu lr l ls lt">pip install web3==3.7.0</span><span id="2f56" class="ic id ie lm b fv lu lr l ls lt">pip install oyente</span></pre><p id="291b" class="pw-post-body-paragraph jb jc ie jd b je kf jg jh ji kg jk jl io kh jn jo is ki jq jr iw kj jt ju jv hm dt translated">在大多数情况下，上述命令会失败并返回一个错误，如果有效，您可以通过运行以下命令来使用:</p><pre class="km kn ko kp fq ll lm ln lo aw lp dt"><span id="f655" class="ic id ie lm b fv lq lr l ls lt">oyente -s &lt;contract name&gt;</span></pre><p id="186c" class="pw-post-body-paragraph jb jc ie jd b je kf jg jh ji kg jk jl io kh jn jo is ki jq jr iw kj jt ju jv hm dt translated">如果编译失败，即使您的智能合约在其他工具中成功运行，那也是因为solc和evm的版本不匹配。按照下一个方法中的步骤安装solc和evm的正确版本。</p><h2 id="4599" class="ic id ie bd if ig ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja dt translated">运行源代码:</h2><p id="b75a" class="pw-post-body-paragraph jb jc ie jd b je jf jg jh ji jj jk jl io jm jn jo is jp jq jr iw js jt ju jv hm dt translated">在这种方法中，就像以前的方法一样，我们通过下载和安装依赖项来创建所需的环境。在本文撰写之时，oyente已经针对solc版本0.4.19和evm 1.7.3进行了正式测试，但是由于其他特性，最好使用solc版本0.4.24。</p><p id="6f98" class="pw-post-body-paragraph jb jc ie jd b je kf jg jh ji kg jk jl io kh jn jo is ki jq jr iw kj jt ju jv hm dt translated">Oyente工具是基于solc版本0.4.19和evm版本1.7.3构建的。将该工具与最新版本的依赖项一起使用将导致编译失败。</p><p id="25f7" class="pw-post-body-paragraph jb jc ie jd b je kf jg jh ji kg jk jl io kh jn jo is ki jq jr iw kj jt ju jv hm dt translated">由于将这些包降级到较低版本并不容易，建议下载所需版本的二进制文件，并将这些文件复制到<code class="eh mr ms mt lm b">/usr/bin</code>目录</p><blockquote class="mk ml mm"><p id="b24a" class="jb jc mn jd b je kf jg jh ji kg jk jl mo kh jn jo mp ki jq jr mq kj jt ju jv hm dt translated">下载solc二进制文件。链接<a class="ae kk" href="https://github.com/ethereum/solidity/releases/download/v0.4.24/solidity-ubuntu-trusty-clang.zip" rel="noopener ugc nofollow" target="_blank">这里</a>。</p></blockquote><p id="62ae" class="pw-post-body-paragraph jb jc ie jd b je kf jg jh ji kg jk jl io kh jn jo is ki jq jr iw kj jt ju jv hm dt translated">如果需要其他版本，请参考<a class="ae kk" href="https://github.com/ethereum/solidity/releases/" rel="noopener ugc nofollow" target="_blank">本</a>。</p><p id="3633" class="pw-post-body-paragraph jb jc ie jd b je kf jg jh ji kg jk jl io kh jn jo is ki jq jr iw kj jt ju jv hm dt translated">提取文件并执行以下命令</p><pre class="km kn ko kp fq ll lm ln lo aw lp dt"><span id="fde3" class="ic id ie lm b fv lq lr l ls lt">sudo cp solc /usr/bin/</span><span id="10f1" class="ic id ie lm b fv lu lr l ls lt">sudo cp lllc /usr/bin/</span></pre><p id="3976" class="pw-post-body-paragraph jb jc ie jd b je kf jg jh ji kg jk jl io kh jn jo is ki jq jr iw kj jt ju jv hm dt translated"><code class="eh mr ms mt lm b">solc--version</code>该命令返回solc的版本。</p><blockquote class="mk ml mm"><p id="428d" class="jb jc mn jd b je kf jg jh ji kg jk jl mo kh jn jo mp ki jq jr mq kj jt ju jv hm dt translated">点击下载geth工具<a class="ae kk" href="https://gethstore.blob.core.windows.net/builds/geth-alltools-linux-amd64-1.7.3-4bb3c89d.tar.gz" rel="noopener ugc nofollow" target="_blank">。</a></p></blockquote><p id="de50" class="pw-post-body-paragraph jb jc ie jd b je kf jg jh ji kg jk jl io kh jn jo is ki jq jr iw kj jt ju jv hm dt translated"><a class="ae kk" href="https://gethstore.blob.core.windows.net/builds/geth-alltools-linux-amd64-1.7.3-4bb3c89d.tar.gz" rel="noopener ugc nofollow" target="_blank"> F </a>或其他版本，参见<a class="ae kk" href="https://geth.ethereum.org/downloads/" rel="noopener ugc nofollow" target="_blank">本</a>。</p><p id="1d18" class="pw-post-body-paragraph jb jc ie jd b je kf jg jh ji kg jk jl io kh jn jo is ki jq jr iw kj jt ju jv hm dt translated">提取并执行以下命令</p><pre class="km kn ko kp fq ll lm ln lo aw lp dt"><span id="9e42" class="ic id ie lm b fv lq lr l ls lt">sudo cp geth /usr/bin/</span><span id="9c0c" class="ic id ie lm b fv lu lr l ls lt">sudo cp evm /usr/bin/</span></pre><p id="e851" class="pw-post-body-paragraph jb jc ie jd b je kf jg jh ji kg jk jl io kh jn jo is ki jq jr iw kj jt ju jv hm dt translated">从<a class="ae kk" href="https://github.com/melonproject/oyente" rel="noopener ugc nofollow" target="_blank">这里</a>下载oyente项目源代码，定位到oyente目录并运行以下命令:</p><pre class="km kn ko kp fq ll lm ln lo aw lp dt"><span id="0bd5" class="ic id ie lm b fv lq lr l ls lt">python oyente.py -s &lt;contract name&gt;</span></pre><p id="2afd" class="pw-post-body-paragraph jb jc ie jd b je kf jg jh ji kg jk jl io kh jn jo is ki jq jr iw kj jt ju jv hm dt translated">注:Oyente项目已从<a class="ae kk" href="https://github.com/ethereum/oyente" rel="noopener ugc nofollow" target="_blank">移至此</a>。不要从这里下载源代码。</p><p id="ea72" class="pw-post-body-paragraph jb jc ie jd b je kf jg jh ji kg jk jl io kh jn jo is ki jq jr iw kj jt ju jv hm dt translated">在合同名称后使用-ce标志将让您知道您面临的错误。</p><p id="0215" class="pw-post-body-paragraph jb jc ie jd b je kf jg jh ji kg jk jl io kh jn jo is ki jq jr iw kj jt ju jv hm dt translated">如果你遇到一个错误，说明未知模块z3或与z3相关的东西，那么这是由于z3库安装不正确。浏览前面讨论z3依赖项安装的部分。</p><figure class="km kn ko kp fq hv fe ff paragraph-image"><div role="button" tabindex="0" class="hw hx di hy bf hz"><div class="fe ff mu"><img src="../Images/af434155b81fd82eb0a429fce89d31c4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WckLr2BOoFtRMi9D_kXChw.png"/></div></div></figure><p id="0d77" class="pw-post-body-paragraph jb jc ie jd b je kf jg jh ji kg jk jl io kh jn jo is ki jq jr iw kj jt ju jv hm dt translated">检查输出是否如上所示。如果是，您已经成功安装了依赖项。你可以走了！！！</p><h1 id="92c4" class="ku id ie bd if kv kw kx ij ky kz la in lb lc ld ir le lf lg iv lh li lj iz lk dt translated">结论</h1><p id="9939" class="pw-post-body-paragraph jb jc ie jd b je jf jg jh ji jj jk jl io jm jn jo is jp jq jr iw js jt ju jv hm dt translated">虽然Oyente有助于发现可能的漏洞，但它是为0.4.24之前的solidity版本设计的。任何大于或等于0.5的实度代码都将返回错误。与其他审计工具相比，Oyente给出的错误警报更少。大多数用户建议只有在手动审查之后才使用自动审计，而不是相反。</p><blockquote class="mv"><p id="8dd1" class="mw mx ie bd my mz na nb nc nd ne jv ek translated"><a class="ae kk" href="https://coincodecap.com/?utm_source=coinmonks" rel="noopener ugc nofollow" target="_blank">在您的收件箱中直接获得最佳软件交易</a></p></blockquote><figure class="ng nh ni nj nk hv fe ff paragraph-image"><a href="https://coincodecap.com/?utm_source=coinmonks"><div class="fe ff nf"><img src="../Images/7c0b3dfdcbfea594cc0ae7d4f9bf6fcb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1168/format:webp/0*OJ-qb5G6i863msBB.png"/></div></a></figure></div></div>    
</body>
</html>