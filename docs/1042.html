<html>
<head>
<title>Deploy your First Deep Learning Neural Network Model using Flask, Keras, TensorFlow in Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在Python中使用Flask、Keras、TensorFlow部署您的第一个深度学习神经网络模型</h1>
<blockquote>原文：<a href="https://medium.com/coinmonks/deploy-your-first-deep-learning-neural-network-model-using-flask-keras-tensorflow-in-python-f4bb7309fc49?source=collection_archive---------0-----------------------#2018-07-15">https://medium.com/coinmonks/deploy-your-first-deep-learning-neural-network-model-using-flask-keras-tensorflow-in-python-f4bb7309fc49?source=collection_archive---------0-----------------------#2018-07-15</a></blockquote><div><div class="ef hh hi hj hk hl"/><div class="hm hn ho hp hq"><div class=""/><figure class="fi fk ir is it iu fe ff paragraph-image"><div class="fe ff iq"><img src="../Images/d36cd4f81ef67e3990c54960fb4f3892.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/0*7ejPnpJZZKT33bTU"/></div></figure><p id="2358" class="pw-post-body-paragraph ix iy ht iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju hm dt translated">最近，我为我的公司建立了一个深度学习模型，预测用户是否购买汽车，如果是，那么哪辆汽车具有良好的准确性。向首席执行官和业务团队演示，每个人都对此感到兴奋。我们也做了测试，结果很有希望。</p><p id="a8ad" class="pw-post-body-paragraph ix iy ht iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju hm dt translated">每个人都兴奋地要求我分享模型的API，这样我们就可以把公司的注意力放在潜在的买家身上，也可以计划提供更好的消费者体验。</p><p id="5797" class="pw-post-body-paragraph ix iy ht iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju hm dt translated">首先，我们使用Tornado框架来部署我们的深度学习模型。由于响应时间非常慢，它过去常常在每次获得API命中时加载模型。我们是新的python，所以我们做了一些谷歌搜索，但没有找到任何解决方案。然后我看到Flask framework易于使用，我们可以声明一个全局变量，只需加载一次，就可以随时重用。</p><p id="9c24" class="pw-post-body-paragraph ix iy ht iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju hm dt translated">让我告诉你们怎么做的步骤&amp;这是多么简单。</p><p id="77df" class="pw-post-body-paragraph ix iy ht iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju hm dt translated">我假设你已经建立了你的深度学习模型，如果没有，请参考我的<a class="ae jv" rel="noopener" href="/@ashok.tankala/build-your-first-deep-learning-neural-network-model-using-keras-tensorflow-in-python-a3e76a6b3ccb">以前的文章</a>来学习如何建立深度学习模型。</p><p id="04da" class="pw-post-body-paragraph ix iy ht iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju hm dt translated">使用以下命令安装用于部署深度学习模型的flask</p><pre class="jw jx jy jz fq ka kb kc kd aw ke dt"><span id="2b8d" class="kf kg ht kb b fv kh ki l kj kk">pip3 install flask</span></pre><p id="55e6" class="pw-post-body-paragraph ix iy ht iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju hm dt translated"><strong class="iz hu">注意</strong>:我在训练模型时没有对数据使用缩放技术，所以当我们在API上给出数据时，我们不需要转换任何东西。所以我跳过了我上一篇文章中<a class="ae jv" rel="noopener" href="/@ashok.tankala/build-your-first-deep-learning-neural-network-model-using-keras-tensorflow-in-python-a3e76a6b3ccb">的<strong class="iz hu">步骤3 </strong>。</a></p></div><div class="ab cl kl km hb kn" role="separator"><span class="ko bw bk kp kq kr"/><span class="ko bw bk kp kq kr"/><span class="ko bw bk kp kq"/></div><div class="hm hn ho hp hq"><p id="f910" class="pw-post-body-paragraph ix iy ht iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju hm dt translated">让我们进入美妙的部分——编码部分</p><pre class="jw jx jy jz fq ka kb kc kd aw ke dt"><span id="5843" class="kf kg ht kb b fv kh ki l kj kk">import flask<br/>import numpy as np<br/>import tensorflow as tf<br/>from keras.models import load_model</span></pre><blockquote class="ks kt ku"><p id="a684" class="ix iy kv iz b ja jb jc jd je jf jg jh kw jj jk jl kx jn jo jp ky jr js jt ju hm dt translated"><strong class="iz hu">第一步</strong>:常规进口。API服务器的烧瓶。用于输入参数数组整形的numpy。用于运行深度学习模型的tensorflow。用于加载keras模型的load_model from karas.models。</p></blockquote><pre class="jw jx jy jz fq ka kb kc kd aw ke dt"><span id="d42c" class="kf kg ht kb b fv kh ki l kj kk"># initialize our Flask application and the Keras model<br/>app = flask.Flask(__name__)<br/>def init():<br/>    global model,graph<br/>    # load the pre-trained Keras model<br/>    model = load_model('models/gotCharactersDeathPredictions.h5')<br/>    graph = tf.get_default_graph()</span></pre><blockquote class="ks kt ku"><p id="42dd" class="ix iy kv iz b ja jb jc jd je jf jg jh kw jj jk jl kx jn jo jp ky jr js jt ju hm dt translated"><strong class="iz hu">步骤2 </strong>:用于初始化我们的Flask应用程序并加载Keras模型。</p></blockquote><pre class="jw jx jy jz fq ka kb kc kd aw ke dt"><span id="d05c" class="kf kg ht kb b fv kh ki l kj kk"># Getting Parameters</span><span id="15a9" class="kf kg ht kb b fv kz ki l kj kk">def getParameters():<br/>    parameters = []<br/>    parameters.append(flask.request.args.get('male'))<br/>    parameters.append(flask.request.args.get('book1'))<br/>    parameters.append(flask.request.args.get('book2'))<br/>    parameters.append(flask.request.args.get('book3'))<br/>    parameters.append(flask.request.args.get('book4'))<br/>    parameters.append(flask.request.args.get('book5'))<br/>    parameters.append(flask.request.args.get('isMarried'))<br/>    parameters.append(flask.request.args.get('isNoble'))<br/>    parameters.append(flask.request.args.get('numDeadRelations'))<br/>    parameters.append(flask.request.args.get('boolDeadRelations'))<br/>    parameters.append(flask.request.args.get('isPopular'))<br/>    parameters.append(flask.request.args.get('popularity'))<br/>    return parameters</span></pre><blockquote class="ks kt ku"><p id="1940" class="ix iy kv iz b ja jb jc jd je jf jg jh kw jj jk jl kx jn jo jp ky jr js jt ju hm dt translated"><strong class="iz hu">第三步</strong>:提取预测一个字符所需的参数(male，book1，book2，book3，book4，book5，isMarried，isNoble，numDeadRelations，boolDeadRelations，isPopular，popularity)并追加到数组中。</p></blockquote><pre class="jw jx jy jz fq ka kb kc kd aw ke dt"><span id="7f25" class="kf kg ht kb b fv kh ki l kj kk"># Cross origin support<br/>def sendResponse(responseObj):<br/>    response = flask.jsonify(responseObj)<br/>    response.headers.add('Access-Control-Allow-Origin', '*')<br/>    response.headers.add('Access-Control-Allow-Methods', 'GET')<br/>    response.headers.add('Access-Control-Allow-Headers', 'accept,content-type,Origin,X-Requested-With,Content-Type,access_token,Accept,Authorization,source')<br/>    response.headers.add('Access-Control-Allow-Credentials', True)<br/>    return response</span></pre><blockquote class="ks kt ku"><p id="bee1" class="ix iy kv iz b ja jb jc jd je jf jg jh kw jj jk jl kx jn jo jp ky jr js jt ju hm dt translated"><strong class="iz hu">第四步</strong>:JSON化响应对象。然后添加用于支持跨原点的报头参数。通常，我们不会在需要使用API的同一个域中部署API，所以跨源支持必须在那个时候进行，这就是为什么需要这些头参数。</p></blockquote><pre class="jw jx jy jz fq ka kb kc kd aw ke dt"><span id="bdad" class="kf kg ht kb b fv kh ki l kj kk"># API for prediction<br/>@app.route("/predict", methods=["GET"])<br/>def predict():<br/>    nameOfTheCharacter = flask.request.args.get('name')<br/>    parameters = getParameters()<br/>    inputFeature = np.asarray(parameters).reshape(1, 12)<br/>    with graph.as_default():<br/>        raw_prediction = model.predict(inputFeature)[0][0]<br/>    if raw_prediction &gt; 0.5:<br/>        prediction = 'Alive'<br/>    else:<br/>        prediction = 'Dead'<br/>return sendResponse({nameOfTheCharacter: prediction})</span></pre><blockquote class="ks kt ku"><p id="c04d" class="ix iy kv iz b ja jb jc jd je jf jg jh kw jj jk jl kx jn jo jp ky jr js jt ju hm dt translated"><strong class="iz hu">步骤5 </strong>:预测API的路径。</p><p id="96d8" class="ix iy kv iz b ja jb jc jd je jf jg jh kw jj jk jl kx jn jo jp ky jr js jt ju hm dt translated">首先，我们获取角色的名字，然后通过getParameters方法获取其余的参数。</p><p id="b127" class="ix iy kv iz b ja jb jc jd je jf jg jh kw jj jk jl kx jn jo jp ky jr js jt ju hm dt translated">然后将它们整形为ndarray，我们可以将它用作模型的输入。</p><p id="d3cd" class="ix iy kv iz b ja jb jc jd je jf jg jh kw jj jk jl kx jn jo jp ky jr js jt ju hm dt translated">然后我们通过我们的模型找到预测。</p><p id="fa53" class="ix iy kv iz b ja jb jc jd je jf jg jh kw jj jk jl kx jn jo jp ky jr js jt ju hm dt translated">然后我们得出结论，这个角色是活着还是死了。</p><p id="d7a3" class="ix iy kv iz b ja jb jc jd je jf jg jh kw jj jk jl kx jn jo jp ky jr js jt ju hm dt translated">然后我们使用sendResponse函数准备response对象并返回它。</p></blockquote><pre class="jw jx jy jz fq ka kb kc kd aw ke dt"><span id="7c1a" class="kf kg ht kb b fv kh ki l kj kk"># if this is the main thread of execution first load the model and then start the server<br/>if __name__ == "__main__":<br/>    print(("* Loading Keras model and Flask starting server..."<br/>"please wait until server has fully started"))<br/>    init()<br/>    app.run(threaded=True)</span></pre><blockquote class="ks kt ku"><p id="095a" class="ix iy kv iz b ja jb jc jd je jf jg jh kw jj jk jl kx jn jo jp ky jr js jt ju hm dt translated"><strong class="iz hu"> Step6 </strong>:这段代码只是为了确认这是否是执行的主线程，首先加载模型，然后启动服务器</p></blockquote></div><div class="ab cl kl km hb kn" role="separator"><span class="ko bw bk kp kq kr"/><span class="ko bw bk kp kq kr"/><span class="ko bw bk kp kq"/></div><div class="hm hn ho hp hq"><p id="8d3e" class="pw-post-body-paragraph ix iy ht iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju hm dt translated">要运行这个应用程序，你只需要运行下面的命令就行了。</p><pre class="jw jx jy jz fq ka kb kc kd aw ke dt"><span id="da3d" class="kf kg ht kb b fv kh ki l kj kk">python3 gotCharactersDeathPredictionsAPI.py</span></pre><p id="e296" class="pw-post-body-paragraph ix iy ht iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju hm dt translated">一旦服务器启动，我在浏览器中点击下面的URL。</p><pre class="jw jx jy jz fq ka kb kc kd aw ke dt"><span id="383a" class="kf kg ht kb b fv kh ki l kj kk"><a class="ae jv" href="http://localhost:5000/predict?name=Viserys%20II%20Targaryen&amp;male=1&amp;book1=0&amp;book2=0&amp;book3=0&amp;book4=0&amp;book5=0&amp;isMarried=0&amp;isNoble=0&amp;numDeadRelations=11&amp;boolDeadRelations=1&amp;isPopular=1&amp;popularity=0.605351170568561" rel="noopener ugc nofollow" target="_blank">http://localhost:5000/predict?name=Viserys II Targaryen&amp;male=1&amp;book1=0&amp;book2=0&amp;book3=0&amp;book4=0&amp;book5=0&amp;isMarried=0&amp;isNoble=0&amp;numDeadRelations=11&amp;boolDeadRelations=1&amp;isPopular=1&amp;popularity=0.605351170568561</a></span></pre><figure class="jw jx jy jz fq iu fe ff paragraph-image"><div role="button" tabindex="0" class="lb lc di ld bf le"><div class="fe ff la"><img src="../Images/eae6a19f8612560e4492ed24f89fef31.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8bsav8X1p1dvq8fbMI4jtA.png"/></div></div></figure><p id="0035" class="pw-post-body-paragraph ix iy ht iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju hm dt translated">恭喜你！！！部署了您的第一个深度学习模型。你可以在<a class="ae jv" href="https://github.com/tankala/ai-examples" rel="noopener ugc nofollow" target="_blank">我的GitHub库</a>找到这个例子和其他几个例子。</p><p id="e7ec" class="pw-post-body-paragraph ix iy ht iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju hm dt translated">和平。快乐编码。<br/> <a class="ae jv" href="https://blog.tanka.la/2018/07/15/deploy-your-first-deep-learning-neural-network-model-using-flask-keras-tensorflow-in-python/" rel="noopener ugc nofollow" target="_blank">在这里看我的原创文章。</a></p><blockquote class="lf"><p id="18df" class="lg lh ht bd li lj lk ll lm ln lo ju ek translated">加入Coinmonks <a class="ae jv" href="https://t.me/coincodecap" rel="noopener ugc nofollow" target="_blank">电报频道</a>和<a class="ae jv" href="https://www.youtube.com/c/coinmonks/videos" rel="noopener ugc nofollow" target="_blank"> Youtube频道</a>获取每日<a class="ae jv" href="http://coincodecap.com/" rel="noopener ugc nofollow" target="_blank">加密新闻</a></p></blockquote><h2 id="15d6" class="kf kg ht bd lp lq lr ls lt lu lv lw lx ji ly lz ma jm mb mc md jq me mf mg mh dt translated">另外，阅读</h2><ul class=""><li id="20fb" class="mi mj ht iz b ja mk je ml ji mm jm mn jq mo ju mp mq mr ms dt translated"><a class="ae jv" rel="noopener" href="/coinmonks/top-10-crypto-copy-trading-platforms-for-beginners-d0c37c7d698c">复制交易</a> | <a class="ae jv" rel="noopener" href="/coinmonks/crypto-tax-software-ed4b4810e338">加密税务软件</a></li><li id="723e" class="mi mj ht iz b ja mt je mu ji mv jm mw jq mx ju mp mq mr ms dt translated"><a class="ae jv" href="https://coincodecap.com/grid-trading" rel="noopener ugc nofollow" target="_blank">网格交易</a> | <a class="ae jv" rel="noopener" href="/coinmonks/the-best-cryptocurrency-hardware-wallets-of-2020-e28b1c124069">加密硬件钱包</a></li><li id="874f" class="mi mj ht iz b ja mt je mu ji mv jm mw jq mx ju mp mq mr ms dt translated"><a class="ae jv" href="http://Top 4 Telegram Channels for Crypto Traders" rel="noopener ugc nofollow" target="_blank">密码电报信号</a> | <a class="ae jv" rel="noopener" href="/coinmonks/crypto-trading-bot-c2ffce8acb2a">密码交易机器人</a></li><li id="7cdf" class="mi mj ht iz b ja mt je mu ji mv jm mw jq mx ju mp mq mr ms dt translated"><a class="ae jv" href="https://coincodecap.com/koinly-review" rel="noopener ugc nofollow" target="_blank">ko only回顾</a> | <a class="ae jv" href="https://coincodecap.com/binaryx-review" rel="noopener ugc nofollow" target="_blank"> Binaryx回顾</a>|<a class="ae jv" href="https://coincodecap.com/hodlnaut-vs-cakedefi-vs-celsius" rel="noopener ugc nofollow" target="_blank">Hodlnaut vs CakeDefi</a></li><li id="15d9" class="mi mj ht iz b ja mt je mu ji mv jm mw jq mx ju mp mq mr ms dt translated"><a class="ae jv" href="https://coincodecap.com/bybit-binance-moonxbt" rel="noopener ugc nofollow" target="_blank"> MoonXBT vs Bybit vs币安</a> | <a class="ae jv" rel="noopener" href="/coinmonks/hardware-wallets-dfa1211730c6">硬件钱包</a></li><li id="5802" class="mi mj ht iz b ja mt je mu ji mv jm mw jq mx ju mp mq mr ms dt translated"><a class="ae jv" href="https://coincodecap.com/huobi-trading-bot" rel="noopener ugc nofollow" target="_blank">火币交易机器人</a> | <a class="ae jv" href="https://coincodecap.com/buy-ada-cardano" rel="noopener ugc nofollow" target="_blank">如何购买ADA </a> | <a class="ae jv" href="https://coincodecap.com/geco-one-review" rel="noopener ugc nofollow" target="_blank"> Geco。一次复习</a></li><li id="ecd3" class="mi mj ht iz b ja mt je mu ji mv jm mw jq mx ju mp mq mr ms dt translated"><a class="ae jv" href="https://coincodecap.com/binance-vs-bitstamp" rel="noopener ugc nofollow" target="_blank">币安vs比特邮票</a> | <a class="ae jv" href="https://coincodecap.com/bitpanda-coinbase-coinsbit" rel="noopener ugc nofollow" target="_blank">比特熊猫vs比特币基地vs Coinsbit </a></li><li id="5711" class="mi mj ht iz b ja mt je mu ji mv jm mw jq mx ju mp mq mr ms dt translated"><a class="ae jv" href="https://coincodecap.com/buy-ripple-india" rel="noopener ugc nofollow" target="_blank">如何购买Ripple (XRP) </a> | <a class="ae jv" href="https://coincodecap.com/crypto-exchange-africa" rel="noopener ugc nofollow" target="_blank">非洲最好的加密交易所</a></li><li id="f33b" class="mi mj ht iz b ja mt je mu ji mv jm mw jq mx ju mp mq mr ms dt translated"><a class="ae jv" rel="noopener" href="/coinmonks/crypto-exchange-dd2f9d6f3769">最佳加密交易所</a> | <a class="ae jv" rel="noopener" href="/coinmonks/bitcoin-exchange-in-india-7f1fe79715c9">印度最佳加密交易所</a></li><li id="47a8" class="mi mj ht iz b ja mt je mu ji mv jm mw jq mx ju mp mq mr ms dt translated"><a class="ae jv" rel="noopener" href="/coinmonks/best-crypto-apis-for-developers-5efe3a597a9f">开发人员的最佳加密API</a></li><li id="b359" class="mi mj ht iz b ja mt je mu ji mv jm mw jq mx ju mp mq mr ms dt translated">最佳<a class="ae jv" rel="noopener" href="/coinmonks/top-5-crypto-lending-platforms-in-2020-that-you-need-to-know-a1b675cec3fa">密码借贷平台</a></li><li id="9487" class="mi mj ht iz b ja mt je mu ji mv jm mw jq mx ju mp mq mr ms dt translated">杠杆代币的终极指南</li></ul></div></div>    
</body>
</html>