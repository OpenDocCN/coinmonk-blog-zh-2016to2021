<html>
<head>
<title>All you should know about libraries in solidity</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">关于solidity中的库，您应该知道的一切</h1>
<blockquote>原文：<a href="https://medium.com/coinmonks/all-you-should-know-about-libraries-in-solidity-dd8bc953eae7?source=collection_archive---------0-----------------------#2018-09-21">https://medium.com/coinmonks/all-you-should-know-about-libraries-in-solidity-dd8bc953eae7?source=collection_archive---------0-----------------------#2018-09-21</a></blockquote><div><div class="ef hh hi hj hk hl"/><div class="hm hn ho hp hq"><div class=""/><figure class="fi fk ir is it iu fe ff paragraph-image"><div role="button" tabindex="0" class="iv iw di ix bf iy"><div class="fe ff iq"><img src="../Images/5cc19108cfe8bcf9add8df30c08dfa3b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*Ugp4QQOB6XvJwi-L"/></div></div><figcaption class="jb jc fg fe ff jd je bd b be z ek">Photo by <a class="ae jf" href="https://unsplash.com/@inakihxz?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Iñaki del Olmo</a> on <a class="ae jf" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="379f" class="pw-post-body-paragraph jg jh ht ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated">在编写Dapps时，了解可靠的库是非常重要的。简而言之，库是一段可重用的代码，只需部署一次，就可以多次共享。</p><p id="8c83" class="pw-post-body-paragraph jg jh ht ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated">但是库不仅仅局限于可重用性，以太坊开发人员很少在其他领域使用库特性。这篇文章旨在从基础开始触及所有这些话题。</p><p id="df37" class="pw-post-body-paragraph jg jh ht ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated">先说一个简单的数学运算库。下面描述的SafeMath库包含基本的算术运算，它将2个无符号整数作为输入，并返回算术运算结果。</p><figure class="ke kf kg kh fq iu"><div class="bz el l di"><div class="ki kj l"/></div></figure></div><div class="ab cl kk kl hb km" role="separator"><span class="kn bw bk ko kp kq"/><span class="kn bw bk ko kp kq"/><span class="kn bw bk ko kp"/></div><div class="hm hn ho hp hq"><blockquote class="kr ks kt"><p id="d6bd" class="jg jh ku ji b jj jk jl jm jn jo jp jq kv js jt ju kw jw jx jy kx ka kb kc kd hm dt translated">理想情况下，库并不意味着改变契约状态，它应该只用于执行基于输入和返回结果的简单操作</p></blockquote><p id="4e57" class="pw-post-body-paragraph jg jh ht ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated">在深入研究之前，让我们先了解一些先决条件，以便更好地理解:</p><ol class=""><li id="ac2b" class="ky kz ht ji b jj jk jn jo jr la jv lb jz lc kd ld le lf lg dt translated">什么是可靠的合同？:从技术上讲，智能合约是Dapp的基本构件。在以太坊中，智能合约拥有类似外部用户帐户的地址，可用于与合约进行交互，如调用方法、发送以太等。每个合同都有以下四个属性:</li></ol><ul class=""><li id="bb96" class="ky kz ht ji b jj jk jn jo jr la jv lb jz lc kd lh le lf lg dt translated">Nonce:它是一个帐户触发的交易数量的计数。</li><li id="278a" class="ky kz ht ji b jj li jn lj jr lk jv ll jz lm kd lh le lf lg dt translated">Balance:这是一个数字，它告诉我们这个特定地址所能容纳的乙醚量</li><li id="fe9d" class="ky kz ht ji b jj li jn lj jr lk jv ll jz lm kd lh le lf lg dt translated">存储根:契约可以存储数据，它是存储来自该契约的数据的树根</li><li id="ae21" class="ky kz ht ji b jj li jn lj jr lk jv ll jz lm kd lh le lf lg dt translated">Codehash:它是合同代码的散列值。</li></ul><p id="fad6" class="pw-post-body-paragraph jg jh ht ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated">2.<strong class="ji hu"> </strong> <a class="ae jf" href="https://solidity.readthedocs.io/en/v0.4.24/types.html?highlight=pure%20view#function-types" rel="noopener ugc nofollow" target="_blank"> <strong class="ji hu">函数类型</strong> </a> <strong class="ji hu"> : </strong> Solidity有以下函数类型:</p><ul class=""><li id="ea31" class="ky kz ht ji b jj jk jn jo jr la jv lb jz lc kd lh le lf lg dt translated">内部:这种类型的函数只能从契约内部调用</li><li id="571c" class="ky kz ht ji b jj li jn lj jr lk jv ll jz lm kd lh le lf lg dt translated">外部:这种类型的函数只能从契约外部调用</li><li id="c34c" class="ky kz ht ji b jj li jn lj jr lk jv ll jz lm kd lh le lf lg dt translated">Public:这种类型的函数既可以在契约外部调用，也可以在契约内部调用。</li><li id="24c2" class="ky kz ht ji b jj li jn lj jr lk jv ll jz lm kd lh le lf lg dt translated">纯:这种函数既不读也不写合同的存储。</li><li id="d7a9" class="ky kz ht ji b jj li jn lj jr lk jv ll jz lm kd lh le lf lg dt translated">视图:这种函数只能从存储器中读取，不能从存储器中写入。</li><li id="ad64" class="ky kz ht ji b jj li jn lj jr lk jv ll jz lm kd lh le lf lg dt translated">Payable:一个契约函数只有在被标记为payable时才能接受ether。</li></ul><p id="b978" class="pw-post-body-paragraph jg jh ht ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated"><strong class="ji hu">图书馆如何运作？</strong></p><figure class="ke kf kg kh fq iu fe ff paragraph-image"><div role="button" tabindex="0" class="iv iw di ix bf iy"><div class="fe ff ln"><img src="../Images/44f5efef7e5a097456b638019d1c5af8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*b9pSrgh16kQgj6e8yWj0RA.png"/></div></div></figure><p id="1a74" class="pw-post-body-paragraph jg jh ht ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated">在区块链，交易可以改变智能合同的状态。合同中可能发生各种状态变化:</p><ul class=""><li id="9aaa" class="ky kz ht ji b jj jk jn jo jr la jv lb jz lc kd lh le lf lg dt translated">发送以太网:它将更新合同余额</li><li id="bb04" class="ky kz ht ji b jj li jn lj jr lk jv ll jz lm kd lh le lf lg dt translated">更改合同中的数据:这将更改存储根。</li></ul><blockquote class="kr ks kt"><p id="0367" class="jg jh ku ji b jj jk jl jm jn jo jp jq kv js jt ju kw jw jx jy kx ka kb kc kd hm dt translated">每当用户向内部使用库协定的智能协定发送事务时，状态更改将发生在智能协定上，而不是在库协定中。这可以通过EVM的委托呼叫功能来实现”</p></blockquote><p id="379b" class="pw-post-body-paragraph jg jh ht ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated"><a class="ae jf" href="http://solidity.readthedocs.io/en/develop/introduction-to-smart-contracts.html?highlight=delegatecall#delegatecall-callcode-and-libraries" rel="noopener ugc nofollow" target="_blank"> <strong class="ji hu">委托呼叫:</strong> </a></p><p id="35a6" class="pw-post-body-paragraph jg jh ht ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated">转述自<a class="ae jf" href="http://solidity.readthedocs.io/en/develop/introduction-to-smart-contracts.html?highlight=delegatecall#delegatecall-callcode-and-libraries" rel="noopener ugc nofollow" target="_blank">固化文件</a>:</p><p id="aef1" class="pw-post-body-paragraph jg jh ht ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated"><em class="ku">“delegate call”与消息调用相同，除了目标地址处的代码是在调用契约的上下文中执行的，并且</em> msg.sender <em class="ku">和</em> msg.value <em class="ku">不改变它们的值。</em></p><p id="1bf8" class="pw-post-body-paragraph jg jh ht ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated"><em class="ku">这意味着契约可以在运行时从不同的地址动态加载代码。存储、当前地址和余额仍然引用调用合同，只是代码取自被调用地址。”</em></p><p id="b28d" class="pw-post-body-paragraph jg jh ht ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated">这个底层函数非常有用，因为它是实现库的基础。</p><p id="23fa" class="pw-post-body-paragraph jg jh ht ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated"><strong class="ji hu">库的部署:</strong></p><p id="fcde" class="pw-post-body-paragraph jg jh ht ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated">库部署与常规智能合约部署略有不同。库部署有两种情况:</p><ol class=""><li id="284a" class="ky kz ht ji b jj jk jn jo jr la jv lb jz lc kd ld le lf lg dt translated"><strong class="ji hu">嵌入式库:</strong>如果一个智能合约正在使用一个只有<strong class="ji hu">内部函数</strong>的库，那么EVM只需将库嵌入到合约中。它不使用委托调用来调用函数，而是简单地使用跳转语句(普通的方法调用)。在这种情况下，不需要单独部署库。</li><li id="dfc3" class="ky kz ht ji b jj li jn lj jr lk jv ll jz lm kd ld le lf lg dt translated"><strong class="ji hu">链接库:</strong>另一方面，如果一个库包含<strong class="ji hu">公共或外部函数</strong>，那么这个库需要被部署。图书馆的部署将在区块链产生唯一的地址。此地址需要与呼叫合同关联。</li></ol><p id="d1e8" class="pw-post-body-paragraph jg jh ht ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated">让我们考虑一个简单的例子来理解链接库。</p><p id="501d" class="pw-post-body-paragraph jg jh ht ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated">下面的代码片段显示了一个带有传递函数的ERC20契约。SafeMath库中有两个方法“sub”和“add”用于传递函数，它们是<strong class="ji hu">外部</strong>。</p><figure class="ke kf kg kh fq iu"><div class="bz el l di"><div class="ki kj l"/></div></figure><p id="f097" class="pw-post-body-paragraph jg jh ht ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated">有两个有趣的观察。</p><ol class=""><li id="7577" class="ky kz ht ji b jj jk jn jo jr la jv lb jz lc kd ld le lf lg dt translated">SafeMath库具有外部函数。</li></ol><p id="3b72" class="pw-post-body-paragraph jg jh ht ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated">2.下面给出的字符串是编译ERC20契约后生成的字节码的一部分。此字节代码包含对安全数学__安全数学_____________________________的引用。这意味着在执行链接步骤之前，ERC20的字节不能被部署。链接本质上意味着用地址替换字节码中的库引用。</p><p id="48d8" class="pw-post-body-paragraph jg jh ht ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated">0x 608060405234801561001057600080 FD 5b 5061034380610020600396000 f 30060806040526004361004157600357 c 01000000000000000000000000000000000000000000000000000000000000000000000000000000000000</p><p id="17f2" class="pw-post-body-paragraph jg jh ht ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated"><strong class="ji hu">部署时如何链接库合同？</strong></p><ol class=""><li id="5232" class="ky kz ht ji b jj jk jn jo jr la jv lb jz lc kd ld le lf lg dt translated">部署库:我已经在ropsten上部署了SafeMath，它的地址是<a class="ae jf" href="https://ropsten.etherscan.io/address/0x40189fb71f54a3ad0370620dfb095382859eb095" rel="noopener ugc nofollow" target="_blank">0x 40189 FB 71 f 54 a3 ad 0370620 DFB 095382859 EB 095</a></li><li id="fd79" class="ky kz ht ji b jj li jn lj jr lk jv ll jz lm kd ld le lf lg dt translated">将部署的库与合同链接。以下命令可用于将SafeMath库与ERC20合同链接。</li></ol><p id="f0da" class="pw-post-body-paragraph jg jh ht ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated"><em class="ku">solc ERC 20 . sol-libraries " safe math:0x 40189 FB 71 f 54 a3 ad 0370620 DFB 095382859 EB 095 "-bin</em></p><p id="00ff" class="pw-post-body-paragraph jg jh ht ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated">成功链接后，SafeMath引用将从字节码中移除，契约准备好进行部署。</p></div><div class="ab cl kk kl hb km" role="separator"><span class="kn bw bk ko kp kq"/><span class="kn bw bk ko kp kq"/><span class="kn bw bk ko kp"/></div><div class="hm hn ho hp hq"><p id="a587" class="pw-post-body-paragraph jg jh ht ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated"><strong class="ji hu"><em class="ku">‘使用for’</em>库中:</strong></p><p id="d115" class="pw-post-body-paragraph jg jh ht ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated">在solidity <strong class="ji hu">中用X代替Y </strong>指令的方式，X的库函数附加了Y类型。</p><p id="3ae4" class="pw-post-body-paragraph jg jh ht ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated">例如，<strong class="ji hu">为uint256 </strong>使用安全数学。</p><p id="cdd0" class="pw-post-body-paragraph jg jh ht ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated">像add、sub、mul和div这样的SafeMath函数现在与类型uint256绑定在一起。</p><p id="dab5" class="pw-post-body-paragraph jg jh ht ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated">需要注意的一个条件是，库函数将接收被调用的对象作为其第一个参数</p><p id="0ac0" class="pw-post-body-paragraph jg jh ht ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated"><strong class="ji hu">例如:</strong>上面提到的ERC-20合同。使用for指令相当于为uint256类型使用for SafeMath。</p><pre class="ke kf kg kh fq lo lp lq lr aw ls dt"><span id="7e3a" class="lt lu ht lp b fv lv lw l lx ly"><strong class="lp hu">using </strong>SafeMath <strong class="lp hu">for uint256</strong>;<br/><br/><strong class="lp hu">uint256 </strong>a = 10;<br/><strong class="lp hu">uint256 </strong>b= 10;<br/><br/><strong class="lp hu">uint256 </strong>= a.add(b);</span></pre><p id="31a9" class="pw-post-body-paragraph jg jh ht ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated">此处<strong class="ji hu">添加</strong>功能可从SafeMath获得。SafeMath库函数与uint256绑定。</p><p id="0c9d" class="pw-post-body-paragraph jg jh ht ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated">太好了！！！🙌</p><p id="2570" class="pw-post-body-paragraph jg jh ht ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated">我希望，这篇文章能帮助你更好地理解图书馆。</p><p id="ca7d" class="pw-post-body-paragraph jg jh ht ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated">快乐编码😇</p><div class="lz ma fm fo mb mc"><a href="http://demystifyblockchain.com/" rel="noopener  ugc nofollow" target="_blank"><div class="md ab ej"><div class="me ab mf cl cj mg"><h2 class="bd hu fv z el mh eo ep mi er et hs dt translated">揭秘区块链|未来是去中心化的互联网</h2><div class="mj l"><p class="bd b gc z el mh eo ep mi er et ek translated">demystifyblockchain.com</p></div></div><div class="mk l"><div class="ml l mm mn mo mk mp iz mc"/></div></div></a></div><p id="a3c2" class="pw-post-body-paragraph jg jh ht ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated"><a class="ae jf" href="https://www.linkedin.com/in/jainsarvesh/" rel="noopener ugc nofollow" target="_blank">linkedin.com/in/jainsarvesh</a>T20】medium.com/@sarvesh.sgsits<a class="ae jf" rel="noopener" href="/@sarvesh.sgsits">T22】</a></p><blockquote class="mq"><p id="9ce4" class="mr ms ht bd mt mu mv mw mx my mz kd ek translated">加入Coinmonks <a class="ae jf" href="https://t.me/coincodecap" rel="noopener ugc nofollow" target="_blank">电报频道</a>和<a class="ae jf" href="https://www.youtube.com/c/coinmonks/videos" rel="noopener ugc nofollow" target="_blank"> Youtube频道</a>获取每日<a class="ae jf" href="http://coincodecap.com/" rel="noopener ugc nofollow" target="_blank">加密新闻</a></p></blockquote><h2 id="15d6" class="lt lu ht bd na nb nc nd ne nf ng nh ni jr nj nk nl jv nm nn no jz np nq nr ns dt translated">另外，阅读</h2><ul class=""><li id="20fb" class="ky kz ht ji b jj nt jn nu jr nv jv nw jz nx kd lh le lf lg dt translated"><a class="ae jf" rel="noopener" href="/coinmonks/top-10-crypto-copy-trading-platforms-for-beginners-d0c37c7d698c">复制交易</a> | <a class="ae jf" rel="noopener" href="/coinmonks/crypto-tax-software-ed4b4810e338">加密税务软件</a></li><li id="723e" class="ky kz ht ji b jj li jn lj jr lk jv ll jz lm kd lh le lf lg dt translated"><a class="ae jf" href="https://coincodecap.com/grid-trading" rel="noopener ugc nofollow" target="_blank">网格交易</a> | <a class="ae jf" rel="noopener" href="/coinmonks/the-best-cryptocurrency-hardware-wallets-of-2020-e28b1c124069">加密硬件钱包</a></li><li id="874f" class="ky kz ht ji b jj li jn lj jr lk jv ll jz lm kd lh le lf lg dt translated"><a class="ae jf" href="http://Top 4 Telegram Channels for Crypto Traders" rel="noopener ugc nofollow" target="_blank">密码电报信号</a> | <a class="ae jf" rel="noopener" href="/coinmonks/crypto-trading-bot-c2ffce8acb2a">密码交易机器人</a></li><li id="f33b" class="ky kz ht ji b jj li jn lj jr lk jv ll jz lm kd lh le lf lg dt translated"><a class="ae jf" rel="noopener" href="/coinmonks/crypto-exchange-dd2f9d6f3769">最佳加密交易所</a> | <a class="ae jf" rel="noopener" href="/coinmonks/bitcoin-exchange-in-india-7f1fe79715c9">印度最佳加密交易所</a></li><li id="6474" class="ky kz ht ji b jj li jn lj jr lk jv ll jz lm kd lh le lf lg dt translated"><a class="ae jf" href="https://coincodecap.com/bitget-review" rel="noopener ugc nofollow" target="_blank"> Bitget回顾</a> | <a class="ae jf" href="https://coincodecap.com/gemini-vs-blockfi" rel="noopener ugc nofollow" target="_blank">双子星vs BlockFi </a> | <a class="ae jf" href="https://coincodecap.com/okex-futures-trading" rel="noopener ugc nofollow" target="_blank"> OKEx期货交易</a></li><li id="c009" class="ky kz ht ji b jj li jn lj jr lk jv ll jz lm kd lh le lf lg dt translated"><a class="ae jf" href="https://coincodecap.com/crypto-trading-bots-in-the-us" rel="noopener ugc nofollow" target="_blank">美国最佳加密交易机器人</a> | <a class="ae jf" href="https://coincodecap.com/changelly-review" rel="noopener ugc nofollow" target="_blank">经常性回顾</a></li><li id="7716" class="ky kz ht ji b jj li jn lj jr lk jv ll jz lm kd lh le lf lg dt translated"><a class="ae jf" href="https://coincodecap.com/crypto-arbitrage-in-india" rel="noopener ugc nofollow" target="_blank">在印度利用加密套利赚取被动收入</a></li><li id="92d8" class="ky kz ht ji b jj li jn lj jr lk jv ll jz lm kd lh le lf lg dt translated"><a class="ae jf" href="https://coincodecap.com/huobi-review" rel="noopener ugc nofollow" target="_blank">霍比评论</a> | <a class="ae jf" href="https://coincodecap.com/okex-margin-trading" rel="noopener ugc nofollow" target="_blank"> OKEx保证金交易</a> | <a class="ae jf" href="https://coincodecap.com/futures-trading" rel="noopener ugc nofollow" target="_blank">期货交易</a></li><li id="47a8" class="ky kz ht ji b jj li jn lj jr lk jv ll jz lm kd lh le lf lg dt translated"><a class="ae jf" rel="noopener" href="/coinmonks/best-crypto-apis-for-developers-5efe3a597a9f">面向开发人员的最佳加密API</a></li><li id="b359" class="ky kz ht ji b jj li jn lj jr lk jv ll jz lm kd lh le lf lg dt translated">最佳<a class="ae jf" rel="noopener" href="/coinmonks/top-5-crypto-lending-platforms-in-2020-that-you-need-to-know-a1b675cec3fa">密码借贷平台</a></li><li id="9487" class="ky kz ht ji b jj li jn lj jr lk jv ll jz lm kd lh le lf lg dt translated"><a class="ae jf" rel="noopener" href="/coinmonks/leveraged-token-3f5257808b22">杠杆代币的终极指南</a></li></ul></div></div>    
</body>
</html>