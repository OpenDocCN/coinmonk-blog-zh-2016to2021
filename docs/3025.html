<html>
<head>
<title>Overview of the latest TzKT Indexer and API updates</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">最新TzKT索引器和API更新概述</h1>
<blockquote>原文：<a href="https://medium.com/coinmonks/overview-of-the-latest-tzkt-indexer-and-api-updates-243de9dc9cba?source=collection_archive---------3-----------------------#2020-05-27">https://medium.com/coinmonks/overview-of-the-latest-tzkt-indexer-and-api-updates-243de9dc9cba?source=collection_archive---------3-----------------------#2020-05-27</a></blockquote><div><div class="ef hh hi hj hk hl"/><div class="hm hn ho hp hq"><div class=""/><figure class="fi fk ir is it iu fe ff paragraph-image"><div class="fe ff iq"><img src="../Images/aaab0b63ef7c35992065d9fc23b87f47.png" data-original-src="https://miro.medium.com/v2/resize:fit:996/format:webp/1*iyWozjbVyyP_EQjEFWfR_g.png"/></div></figure><p id="fe04" class="pw-post-body-paragraph ix iy ht iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju hm dt translated"><strong class="iz hu"><em class="jv">TL；DR；</em></strong><em class="jv">TzKT索引器和API的新版本带来了非常详细和准确的Tezos烘焙数据，并且已经</em> <a class="ae jw" href="https://staging.api.tzkt.io/" rel="noopener ugc nofollow" target="_blank"> <em class="jv">可供在staging环境</em> </a> <em class="jv">中测试。新版本将于下周投入生产。如果您的服务或应用程序使用TzKT API，请注意重大变更部分。</em></p><p id="ea12" class="pw-post-body-paragraph ix iy ht iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju hm dt translated">几个月前，我们发布了带有自己的API的TzKT索引器的“v1-preview”版本，它展示了高稳定性和相当好的性能以及低资源消耗。今天，TzKT API每天成功处理来自世界各地的超过200，000个请求。</p><p id="9e29" class="pw-post-body-paragraph ix iy ht iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju hm dt translated">唯一让它不够完美的是缺乏烘焙相关的数据，如烘焙权和赌注奖励。现在，经过几个月的努力，我们很自豪地宣布一个重大更新，使所有的烘焙材料都可以通过我们的API获得。</p><p id="17cd" class="pw-post-body-paragraph ix iy ht iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju hm dt translated">在本帖中，我们将浏览这些变化，并重点关注关键特性。</p><h1 id="fdad" class="jx jy ht bd jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku dt translated">烘焙权</h1><p id="545d" class="pw-post-body-paragraph ix iy ht iz b ja kv jc jd je kw jg jh ji kx jk jl jm ky jo jp jq kz js jt ju hm dt translated">首先，我们添加了历史和未来烘焙和批准权限的索引，以便在每个周期开始时，TzKT索引器从节点获取可用权限，然后跟踪它们的状态，哪些权限已实现，哪些权限未实现，等等。注意:索引器存储未来烘焙权限的优先级最高为8，以优化存储使用，而不是像其他索引器那样为64。</p><blockquote class="la lb lc"><p id="9cf2" class="ix iy jv iz b ja jb jc jd je jf jg jh ld jj jk jl le jn jo jp lf jr js jt ju hm dt translated">有趣的事实:许多人错误地认为只有64个块优先级…实际上并不是这样。块优先级没有最大值，因此您可以将优先级<a class="ae jw" href="https://mainnet-tezos.giganode.io/chains/main/blocks/960000/helpers/baking_rights?level=970000&amp;max_priority=1000" rel="noopener ugc nofollow" target="_blank">设置为1000 </a>或<a class="ae jw" href="https://mainnet-tezos.giganode.io/chains/main/blocks/960000/helpers/baking_rights?level=970000&amp;max_priority=10000" rel="noopener ugc nofollow" target="_blank">设置为10，000 </a>或更多。</p></blockquote><p id="e484" class="pw-post-body-paragraph ix iy ht iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju hm dt translated">有默认索引:按级别，按周期，按周期和贝克，涵盖了最常见的用例。因此，通过指定这些参数，可以显著缩短响应时间:</p><ul class=""><li id="e25f" class="lg lh ht iz b ja jb je jf ji li jm lj jq lk ju ll lm ln lo dt translated"><a class="ae jw" href="https://staging.api.tzkt.io/v1/rights?level=960000" rel="noopener ugc nofollow" target="_blank">/v1/权利？level={level} </a></li><li id="0263" class="lg lh ht iz b ja lp je lq ji lr jm ls jq lt ju ll lm ln lo dt translated"><a class="ae jw" href="https://staging.api.tzkt.io/v1/rights?cycle=230" rel="noopener ugc nofollow" target="_blank">/v1/权利？周期={cycle} </a></li><li id="359d" class="lg lh ht iz b ja lp je lq ji lr jm ls jq lt ju ll lm ln lo dt translated"><a class="ae jw" href="https://staging.api.tzkt.io/v1/rights?cycle=230&amp;baker=tz1WnfXMPaNTBmH7DBPwqCWs9cPDJdkGBTZ8" rel="noopener ugc nofollow" target="_blank">/v1/权利？贝克= {贝克} </a></li></ul><h2 id="cc68" class="lu jy ht bd jz lv lw lx kd ly lz ma kh ji mb mc kl jm md me kp jq mf mg kt mh dt translated">未覆盖的权利</h2><p id="d695" class="pw-post-body-paragraph ix iy ht iz b ja kv jc jd je kw jg jh ji kx jk jl jm ky jo jp jq kz js jt ju hm dt translated">TzKT索引器的一个独特功能是烘焙权限状态处理，以及对错过特定烘焙或认可权限的原因的附加分析。</p><p id="45ac" class="pw-post-body-paragraph ix iy ht iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju hm dt translated">TzKT索引器将错过的权利分为两类:错过的和未覆盖的。如果一个面包师由于缺少债券(例如，当他过度授权时)而错过了阻止或背书，则那些权利被标记为未覆盖，否则，如果面包师没有明显的原因(例如，由于网络问题)而错过了阻止或背书，则那些权利被标记为实际错过。</p><h2 id="1ea7" class="lu jy ht bd jz lv lw lx kd ly lz ma kh ji mb mc kl jm md me kp jq mf mg kt mh dt translated">公平效率</h2><p id="7445" class="pw-post-body-paragraph ix iy ht iz b ja kv jc jd je kw jg jh ji kx jk jl jm ky jo jp jq kz js jt ju hm dt translated">将烘焙权利分为未覆盖的和错过的允许进行更准确的面包师分析，并建立更公平的基于效率的指标。</p><blockquote class="la lb lc"><p id="75ae" class="ix iy jv iz b ja jb jc jd je jf jg jh ld jj jk jl le jn jo jp lf jr js jt ju hm dt translated">所有现有效率指标的问题是，它们对过度授权的面包师完全不公平。例如，如果一个面包师有两倍于锁定能力的锁定余额，他将获得两倍的烘焙权利。但他的债券只能覆盖其中的一半，因此另一半将被跳过，尽管贝克节点一切正常，但贝克的效率将为50%。TzKT索引器解决了这个问题。</p></blockquote><h1 id="b11d" class="jx jy ht bd jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku dt translated">赌注奖励</h1><p id="bd65" class="pw-post-body-paragraph ix iy ht iz b ja kv jc jd je kw jg jh ji kx jk jl jm ky jo jp jq kz js jt ju hm dt translated">我们已经为所有活跃的面包师和授权者增加了循环统计的索引，包括烘焙权利、赌注奖励、债券使用等的摘要。都在一个地方。该统计数据也非常详细(<a class="ae jw" href="https://staging.api.tzkt.io/#operation/Rewards_GetBakerRewardsByCycle" rel="noopener ugc nofollow" target="_blank">参见API文档中的完整字段描述</a>)。越多的细节，越多的用例，越多的各种服务和应用可以建立在其上，越复杂的支付方案可以被Tezos bakers使用。</p><p id="2775" class="pw-post-body-paragraph ix iy ht iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju hm dt translated">值得注意的是TzKT索引器如何处理错过的奖励。它与现有的API(如tzstats)有很大不同。例如，如果Baker0跳过了一个优先级为0的块(预期奖励为40 tez)，而Baker1烘焙了这个优先级为1的块(由于优先级较低，奖励为~26 tez)，tzstats将显示Baker0错过了26 tez奖励，因为实际块奖励为26。老实说，我们不同意这种做法。</p><p id="fba0" class="pw-post-body-paragraph ix iy ht iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju hm dt translated">在处理错过的奖励时，TzKT确实回答了这样一个问题“如果没有错过区块或背书，一个面包师会赚多少钱？”。在上面的例子中，如果Baker0没有错过方块，他将得到40 tez，而不是26 tez，因此错过的奖励实际上是40 tez。我们认为，这是对一个面包师在一切顺利的情况下能挣多少钱的更准确的估计。</p><p id="adce" class="pw-post-body-paragraph ix iy ht iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju hm dt translated">此外，错过的区块可能导致较少的背书奖励，并且错过的背书可能导致较少的区块奖励。这一点也考虑在内。</p><p id="ba1d" class="pw-post-body-paragraph ix iy ht iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju hm dt translated">贝克奖励:</p><ul class=""><li id="3480" class="lg lh ht iz b ja jb je jf ji li jm lj jq lk ju ll lm ln lo dt translated"><a class="ae jw" href="https://staging.api.tzkt.io/v1/rewards/bakers/tz1WnfXMPaNTBmH7DBPwqCWs9cPDJdkGBTZ8" rel="noopener ugc nofollow" target="_blank">/v1/rewards/bakers/{地址} </a></li><li id="153c" class="lg lh ht iz b ja lp je lq ji lr jm ls jq lt ju ll lm ln lo dt translated"><a class="ae jw" href="https://staging.api.tzkt.io/v1/rewards/bakers/tz1WnfXMPaNTBmH7DBPwqCWs9cPDJdkGBTZ8/230" rel="noopener ugc nofollow" target="_blank">/v1/rewards/bakers/{ address }/{ cycle }</a></li></ul><p id="5802" class="pw-post-body-paragraph ix iy ht iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju hm dt translated">委托人奖励:</p><ul class=""><li id="6940" class="lg lh ht iz b ja jb je jf ji li jm lj jq lk ju ll lm ln lo dt translated"><a class="ae jw" href="https://staging.api.tzkt.io/v1/rewards/delegators/KT1WrmdxQaoQMoNTUmt2sfUyhJsPEGcDsVDZ" rel="noopener ugc nofollow" target="_blank">/v1/奖励/委托人/{地址} </a></li><li id="db8d" class="lg lh ht iz b ja lp je lq ji lr jm ls jq lt ju ll lm ln lo dt translated"><a class="ae jw" href="https://staging.api.tzkt.io/v1/rewards/delegators/KT1WrmdxQaoQMoNTUmt2sfUyhJsPEGcDsVDZ/230" rel="noopener ugc nofollow" target="_blank">/v1/奖励/委托人/{地址}/{周期} </a></li></ul><h2 id="4d9e" class="lu jy ht bd jz lv lw lx kd ly lz ma kh ji mb mc kl jm md me kp jq mf mg kt mh dt translated">奖励分成</h2><p id="89d1" class="pw-post-body-paragraph ix iy ht iz b ja kv jc jd je kw jg jh ji kx jk jl jm ky jo jp jq kz js jt ju hm dt translated">终于！我们实现了一个TzScan的奖励分割的工作模拟，它完全符合面包师和支付工具的需求。此外，我们还做得更好、更详细、更准确。</p><p id="8a46" class="pw-post-body-paragraph ix iy ht iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju hm dt translated">此外，我们为奖励分割中的所有委托人添加了“清空”标志，该标志指示委托人是否被清空(从节点上下文中删除)以及是否应该被重新分配。这有助于确定支付交易是否会消耗0.257 tez分配费，而无需提出额外的请求和单独检查每个委托人。</p><ul class=""><li id="8648" class="lg lh ht iz b ja jb je jf ji li jm lj jq lk ju ll lm ln lo dt translated"><a class="ae jw" href="https://staging.api.tzkt.io/v1/rewards/split/tz1WnfXMPaNTBmH7DBPwqCWs9cPDJdkGBTZ8/230" rel="noopener ugc nofollow" target="_blank">/v1/奖励/分成/{baker}/{cycle} </a></li></ul><h1 id="66c9" class="jx jy ht bd jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku dt translated">快照</h1><p id="0734" class="pw-post-body-paragraph ix iy ht iz b ja kv jc jd je kw jg jh ji kx jk jl jm ky jo jp jq kz js jt ju hm dt translated">显然，我们已经添加了帐户快照索引。但是，所有快照仅存储最后13个周期(在mainnet中)，对于较旧的周期，只有选定的快照可用。这使我们能够显著优化存储利用率。</p><p id="6e30" class="pw-post-body-paragraph ix iy ht iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju hm dt translated">实际上，我们可以存储更少的数据:只有PRESERVED_CYCLES + 2，因为我们知道“在任何时候，外壳都不会隐式地接受一个分支，该分支的分叉点在过去的循环中多于PRESERVED_CYCLES ”,并且在循环N的开始，从循环N - 2中获取快照。这实际上意味着最大mainnet回滚是5个周期，对于拍摄快照来说还要多2个周期，因此我们需要至少存储最后7个周期的快照。然而，在这个阶段，我们为了调试的目的存储了更多的数据。</p><p id="57b2" class="pw-post-body-paragraph ix iy ht iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju hm dt translated">TzKT API没有为访问选定的快照提供单独的端点，因为现有的端点已经可以做到这一点。例如，可以通过以下方式访问特定委托人的快照:</p><ul class=""><li id="77d9" class="lg lh ht iz b ja jb je jf ji li jm lj jq lk ju ll lm ln lo dt translated"><a class="ae jw" href="https://staging.api.tzkt.io/v1/rewards/delegators/KT1WrmdxQaoQMoNTUmt2sfUyhJsPEGcDsVDZ?select=cycle,balance,baker" rel="noopener ugc nofollow" target="_blank">/v1/rewards/delegates/{ address }？选择=循环、平衡、烘焙</a></li></ul><h1 id="12bf" class="jx jy ht bd jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku dt translated">周期</h1><p id="85ad" class="pw-post-body-paragraph ix iy ht iz b ja kv jc jd je kw jg jh ji kx jk jl jm ky jo jp jq kz js jt ju hm dt translated">我们还添加了周期数据，包括一个简短的总结，比如在特定的周期中有多少面包师在工作，有多少面包卷参与了烘焙权利的分配，有多少技术开发中心被授权，等等。</p><p id="019e" class="pw-post-body-paragraph ix iy ht iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju hm dt translated">在我们看来，最有趣的事情是总的面包卷数，因为与特定面包师的面包卷数一起，它允许估计诸如历史容量、运气比率等指标。</p><ul class=""><li id="259f" class="lg lh ht iz b ja jb je jf ji li jm lj jq lk ju ll lm ln lo dt translated"><a class="ae jw" href="https://staging.api.tzkt.io/v1/cycles" rel="noopener ugc nofollow" target="_blank">/v1/周期数</a></li></ul><h1 id="1b97" class="jx jy ht bd jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku dt translated">重大变化</h1><p id="6cf0" class="pw-post-body-paragraph ix iy ht iz b ja kv jc jd je kw jg jh ji kx jk jl jm ky jo jp jq kz js jt ju hm dt translated">幸运的是，只有一个突破性的变化，与“select”查询参数有关。</p><blockquote class="la lb lc"><p id="69ff" class="ix iy jv iz b ja jb jc jd je jf jg jh ld jj jk jl le jn jo jp lf jr js jt ju hm dt translated">通过指定该参数，用户可以只请求所需的数据。这大大减少了网络流量和响应时间，因为SQL查询可能包含更少的连接。</p></blockquote><p id="e6a9" class="pw-post-body-paragraph ix iy ht iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju hm dt translated">在当前版本中"选择"参数仅在"值"模式下有效:</p><p id="d073" class="pw-post-body-paragraph ix iy ht iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju hm dt translated"><strong class="iz hu">？选择=循环，平衡</strong> = &gt; [10，1234]</p><p id="a5e7" class="pw-post-body-paragraph ix iy ht iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju hm dt translated">在新版本中,“选择”参数已扩展为“字段”模式，这是一种默认模式:</p><p id="5fc5" class="pw-post-body-paragraph ix iy ht iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju hm dt translated">字段模式:<strong class="iz hu">？选择=循环，平衡</strong> = &gt; {“循环”:10，“平衡”:1234 }</p><p id="78aa" class="pw-post-body-paragraph ix iy ht iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju hm dt translated">价值观模式:<strong class="iz hu">？select.values=cycle，balance </strong> = &gt; [10，1234]</p><p id="2401" class="pw-post-body-paragraph ix iy ht iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju hm dt translated">所以，为了重现先前的行为”？select= "应替换为"？select.values= "。</p><p id="6c84" class="pw-post-body-paragraph ix iy ht iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju hm dt translated">此外，已经删除了不推荐使用的参数<strong class="iz hu"> "n" </strong>和<strong class="iz hu"> "p" </strong>，如文档中所述:“不推荐使用的参数。将在下一版本中删除。</p><h1 id="dbab" class="jx jy ht bd jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku dt translated">暂存环境</h1><p id="46d9" class="pw-post-body-paragraph ix iy ht iz b ja kv jc jd je kw jg jh ji kx jk jl jm ky jo jp jq kz js jt ju hm dt translated">我们决定在部署到生产环境之前运行一个试运行环境。这允许提前测试最新的特性和更新客户端应用程序，这样API中的突破性变化就不会影响生产环境。</p><p id="6ac9" class="pw-post-body-paragraph ix iy ht iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju hm dt translated">这里有staging API:<a class="ae jw" href="https://staging.api.tzkt.io/" rel="noopener ugc nofollow" target="_blank">https://staging.api.tzkt.io/</a>，可以随便玩玩。任何反馈都将不胜感激！</p><p id="808d" class="pw-post-body-paragraph ix iy ht iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju hm dt translated">下周，我们计划为所有支持的Tezos网络部署新版本。</p><p id="dde2" class="pw-post-body-paragraph ix iy ht iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju hm dt translated"><em class="jv">最初发表于2020年5月27日</em><a class="ae jw" href="https://baking-bad.org/blog/2020/05/27/overview-of-the-latest-tzkt-indexer-and-api-updates/" rel="noopener ugc nofollow" target="_blank"><em class="jv">https://baking-bad.org</em></a><em class="jv">，在那里你可以找到文章的完整版本。</em></p><blockquote class="mi"><p id="e390" class="mj mk ht bd ml mm mn mo mp mq mr ju ek translated"><a class="ae jw" href="https://coincodecap.com/?utm_source=coinmonks" rel="noopener ugc nofollow" target="_blank">直接在您的收件箱中获得最佳软件交易</a></p></blockquote><figure class="mt mu mv mw mx iu fe ff paragraph-image"><a href="https://coincodecap.com/?utm_source=coinmonks"><div class="fe ff ms"><img src="../Images/7c0b3dfdcbfea594cc0ae7d4f9bf6fcb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1168/format:webp/0*OJ-qb5G6i863msBB.png"/></div></a></figure><h1 id="1b56" class="jx jy ht bd jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku dt translated">联系我们</h1><p id="531d" class="pw-post-body-paragraph ix iy ht iz b ja kv jc jd je kw jg jh ji kx jk jl jm ky jo jp jq kz js jt ju hm dt translated">随意问任何问题。<a class="ae jw" href="https://baking-bad.org/docs" rel="noopener ugc nofollow" target="_blank">烘焙不好</a>团队随时乐意帮忙！</p><p id="9502" class="pw-post-body-paragraph ix iy ht iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju hm dt translated"><strong class="iz hu">邮件:</strong><a class="ae jw" href="mailto:hello@baking-bad.org" rel="noopener ugc nofollow" target="_blank"><em class="jv">hello@baking-bad.org</em></a></p><p id="229c" class="pw-post-body-paragraph ix iy ht iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju hm dt translated"><strong class="iz hu">碎碎念:</strong><a class="ae jw" href="https://twitter.com/TezosBakingBad" rel="noopener ugc nofollow" target="_blank"><em class="jv">【https://twitter.com/TezosBakingBad】</em>T5】</a></p><p id="a577" class="pw-post-body-paragraph ix iy ht iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju hm dt translated"><strong class="iz hu">电报:</strong><a class="ae jw" href="https://t.me/baking_bad_chat" rel="noopener ugc nofollow" target="_blank"><em class="jv"/></a></p><p id="45bf" class="pw-post-body-paragraph ix iy ht iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju hm dt translated"><strong class="iz hu">懈怠:</strong><a class="ae jw" href="https://tezos-dev.slack.com/archives/CV5NX7F2L" rel="noopener ugc nofollow" target="_blank"><em class="jv">https://tezos-dev.slack.com/archives/CV5NX7F2L</em></a></p></div></div>    
</body>
</html>