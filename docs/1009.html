<html>
<head>
<title>An Inspection on AMMBR(AMR) Bug</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">ambr(AMR)漏洞检查</h1>
<blockquote>原文：<a href="https://medium.com/coinmonks/an-inspection-on-ammbr-amr-bug-a53b4050d52?source=collection_archive---------9-----------------------#2018-07-11">https://medium.com/coinmonks/an-inspection-on-ammbr-amr-bug-a53b4050d52?source=collection_archive---------9-----------------------#2018-07-11</a></blockquote><div><div class="ef hh hi hj hk hl"/><div class="hm hn ho hp hq"><div class=""/><p id="6c03" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">2018年7月8日，疾速追杀安全实验室披露了<a class="ae jo" href="https://ammbr.com/" rel="noopener ugc nofollow" target="_blank"> AMMBR(AMR) </a>合约中的高风险交易。它包含一个整数溢出漏洞，黑客可以通过调用batchTransfer()来利用该漏洞，从而无限制地传输令牌。</p><p id="2b66" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">SECBIT团队审查源代码后发现，该问题与之前的<a class="ae jo" href="https://blog.csdn.net/Secbit/article/details/80045167" rel="noopener ugc nofollow" target="_blank"> BEC令牌问题</a><a class="ae jo" href="#f895" rel="noopener ugc nofollow">【1】</a>并行。<code class="eh jp jq jr js b">multiTransfer()</code>中一个名为<code class="eh jp jq jr js b">totalTokensToTransfer</code>的变量代表转出的代币总数，它是通过对所有<code class="eh jp jq jr js b">tokens[i]</code>求和计算出来的，契约检查余额是否超过<code class="eh jp jq jr js b">totalTokensToTransfer</code>。</p><figure class="ju jv jw jx fq jy fe ff paragraph-image"><div role="button" tabindex="0" class="jz ka di kb bf kc"><div class="fe ff jt"><img src="../Images/10baeb74a61391a08906fd87888a6418.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*K-iMpzxUJKAGmJElojje0w.png"/></div></div><figcaption class="kf kg fg fe ff kh ki bd b be z ek">multiTransfer function</figcaption></figure><p id="ee22" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">乍看起来，这个功能在检查<code class="eh jp jq jr js b">msg.sender</code>的余额时似乎没问题。然而，<code class="eh jp jq jr js b">tokens[i]</code>的总和可能太大而导致<code class="eh jp jq jr js b">totalTokensToTransfer</code>中的溢出。如果这个值溢出到一个比<code class="eh jp jq jr js b">balances[msg.sender]</code>小的值，黑客可以绕过检查，转移出比余额更多的令牌。</p><p id="cb14" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">AMR是几天前部署的，有近300笔在线交易。最近一次转移发生在7月8日。</p><figure class="ju jv jw jx fq jy fe ff paragraph-image"><div role="button" tabindex="0" class="jz ka di kb bf kc"><div class="fe ff kj"><img src="../Images/c547eac53d4c8de26296d3e257a0b7eb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FpTDAGkpyqbOjq1bA0Zt4A.png"/></div></div><figcaption class="kf kg fg fe ff kh ki bd b be z ek">Transactions</figcaption></figure><p id="6d43" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">这种象征性合约已经在一些交易所推出，并且仍然有效。</p><figure class="ju jv jw jx fq jy fe ff paragraph-image"><div role="button" tabindex="0" class="jz ka di kb bf kc"><div class="fe ff kk"><img src="../Images/df8361a811dc695c31f9863666b0441b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JKV7iziTsUiNNcxAh8apow.png"/></div></div><figcaption class="kf kg fg fe ff kh ki bd b be z ek">AMR on exchange</figcaption></figure><p id="1a40" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">该问题已在由<a class="ae jo" rel="noopener" href="/loopring-protocol/token-contract-risk-list-a-joint-open-source-project-by-loopring-secbit-85df8fff55e1"> SECBIT和合作伙伴</a><a class="ae jo" href="#7905" rel="noopener ugc nofollow">【3】</a>维护的<a class="ae jo" href="https://github.com/sec-bit/awesome-buggy-erc20-tokens" rel="noopener ugc nofollow" target="_blank">带有受影响令牌的ERC20智能合约中的漏洞集合中进行了索引。我们会不断更新有问题的代币合同信息。</a></p><p id="575d" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">SECBIT团队警告，开发团队和交易所应立即采取措施进行修补，令牌持有者也应保持警惕。部署令牌合约时，请在审查、测试和评估代码时格外小心。如果需要，寻求专业审计团队的帮助，以消除<a class="ae jo" href="#f895" rel="noopener ugc nofollow">推进</a>中的风险。</p><h1 id="0753" class="kl km ht bd kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li dt translated">参考</h1><p id="f895" class="pw-post-body-paragraph iq ir ht is b it lj iv iw ix lk iz ja jb ll jd je jf lm jh ji jj ln jl jm jn hm dt translated">[1]在BeautyChain(BEC)的智能合同中发现一个灾难性漏洞<a class="ae jo" rel="noopener" href="/secbit-media/a-disastrous-vulnerability-found-in-smart-contracts-of-beautychain-bec-dbf24ddbc30e">https://medium . com/sec bit-media/A-disastery-Vulnerability-Found-in-Smart-Contracts-of-beauty chain-bec-DBF 24 ddbc 30 e</a></p><p id="df13" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">[2]受影响令牌的ERC20智能合约中的一系列漏洞【https://github.com/sec-bit/awesome-buggy-erc20-tokens<a class="ae jo" href="https://github.com/sec-bit/awesome-buggy-erc20-tokens" rel="noopener ugc nofollow" target="_blank"/></p><p id="7905" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">[3] Token合约风险清单——loop ring &amp; sec bit<a class="ae jo" rel="noopener" href="/loopring-protocol/token-contract-risk-list-a-joint-open-source-project-by-loopring-secbit-85df8fff55e1">联合开源项目https://medium . com/loop ring-protocol/Token-Contract-Risk-List-A-Joint-Open-Source-Project-By loop ring-sec bit-85 df 8 fff 55 e 1</a></p><p id="3610" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">以上所有数据来自SECBIT，如有兴趣请发邮件至<a class="ae jo" href="mailto:info@secbit.io" rel="noopener ugc nofollow" target="_blank"> info@secbit.io </a>。</p></div><div class="ab cl lo lp hb lq" role="separator"><span class="lr bw bk ls lt lu"/><span class="lr bw bk ls lt lu"/><span class="lr bw bk ls lt"/></div><div class="hm hn ho hp hq"><p id="e28c" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated"><a class="ae jo" href="https://secbit.io" rel="noopener ugc nofollow" target="_blank"><strong class="is hu"><em class="lv">sec bit</em></strong></a><em class="lv">由一群加密货币爱好者创立。我们正在研究智能合同安全、智能合同形式验证、加密协议、编译、合同分析、博弈论和加密经济学。</em></p></div></div>    
</body>
</html>