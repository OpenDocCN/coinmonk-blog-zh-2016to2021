<html>
<head>
<title>Part 3 of 3: Model Usage — Transfer learning using tensorflow’s object detection model on Mac</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">第3部分，共3部分:模型使用—在Mac上使用tensorflow的对象检测模型进行迁移学习</h1>
<blockquote>原文：<a href="https://medium.com/coinmonks/part-3-of-3-model-usage-transfer-learning-using-tensorflows-object-detection-model-on-mac-c7a77aa5e0b2?source=collection_archive---------4-----------------------#2018-07-08">https://medium.com/coinmonks/part-3-of-3-model-usage-transfer-learning-using-tensorflows-object-detection-model-on-mac-c7a77aa5e0b2?source=collection_archive---------4-----------------------#2018-07-08</a></blockquote><div><div class="ef hh hi hj hk hl"/><div class="hm hn ho hp hq"><div class=""/><div class=""><h2 id="1eab" class="pw-subtitle-paragraph iq hs ht bd b ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ek translated">使用GCloud机器学习引擎</h2></div><figure class="jj jk jl jm fq jn fe ff paragraph-image"><div role="button" tabindex="0" class="jo jp di jq bf jr"><div class="fe ff ji"><img src="../Images/dd2ee62f68a1e950356e6ed5ff38ff9d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IazP69dxXVq-VZp40eG9tQ.png"/></div></div></figure><p id="7f76" class="pw-post-body-paragraph ju jv ht jw b jx jy iu jz ka kb ix kc kd ke kf kg kh ki kj kk kl km kn ko kp hm dt translated">本部分是<a class="ae kq" rel="noopener" href="/coinmonks/part-1-2-step-by-step-guide-to-data-preparation-for-transfer-learning-using-tensorflows-object-ac45a6035b7a">第1部分:数据准备</a>和<a class="ae kq" rel="noopener" href="/coinmonks/modelling-transfer-learning-using-tensorflows-object-detection-model-on-mac-692c8609be40">第2部分:建模</a>的延续。</p><h1 id="6849" class="kr ks ht bd kt ku kv kw kx ky kz la lb iz lc ja ld jc le jd lf jf lg jg lh li dt translated">第一步。从GCP Bucket下载评估输出和培训输出。</h1><pre class="jj jk jl jm fq lj lk ll lm aw ln dt"><span id="26da" class="lo ks ht lk b fv lp lq l lr ls"># From the directory where you want to copy the files</span><span id="6539" class="lo ks ht lk b fv lt lq l lr ls"># create local folder for evaluation output<br/>mkdir eval<br/># copy evaluation output to local folder<br/>gsutil cp gs://vivienne-artifacts/object_detection_rat/eval/* eval/</span><span id="7ab6" class="lo ks ht lk b fv lt lq l lr ls"># create local folder for training output<br/>mkdir train<br/># copy training output to local folder<br/>gsutil cp gs://vivienne-artifacts/object_detection_rat/train/* train/</span></pre><p id="0088" class="pw-post-body-paragraph ju jv ht jw b jx jy iu jz ka kb ix kc kd ke kf kg kh ki kj kk kl km kn ko kp hm dt translated">训练输出由每个检查点的<code class="eh lu lv lw lk b">.index</code>、<code class="eh lu lv lw lk b">.data</code>和<code class="eh lu lv lw lk b">.meta</code>文件组成。确保检查点三人组完整。</p><figure class="jj jk jl jm fq jn fe ff paragraph-image"><div class="fe ff lx"><img src="../Images/862c324aa8d5478803d7df268ea53e3d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1148/format:webp/1*Cg7EJAH1nkWQzCGLGX-t8w.png"/></div></figure><h1 id="818f" class="kr ks ht bd kt ku kv kw kx ky kz la lb iz lc ja ld jc le jd lf jf lg jg lh li dt translated">第二步。检查最新的检查点</h1><p id="dd8e" class="pw-post-body-paragraph ju jv ht jw b jx ly iu jz ka lz ix kc kd ma kf kg kh mb kj kk kl mc kn ko kp hm dt translated">下载并打开<code class="eh lu lv lw lk b">checkpoint</code>文件。第一行将显示最新的检查点。这意味着<code class="eh lu lv lw lk b">model.ckpt-20002</code>是最新的检查站</p><pre class="jj jk jl jm fq lj lk ll lm aw ln dt"><span id="628f" class="lo ks ht lk b fv lp lq l lr ls"># Checkpoint file contains:</span><span id="3e8b" class="lo ks ht lk b fv lt lq l lr ls">model_checkpoint_path: "model.ckpt-20002"<br/>all_model_checkpoint_paths: "model.ckpt-12316"<br/>all_model_checkpoint_paths: "model.ckpt-14794"<br/>all_model_checkpoint_paths: "model.ckpt-17271"<br/>all_model_checkpoint_paths: "model.ckpt-19740"<br/>all_model_checkpoint_paths: "model.ckpt-20002"</span></pre><h1 id="a089" class="kr ks ht bd kt ku kv kw kx ky kz la lb iz lc ja ld jc le jd lf jf lg jg lh li dt translated">第三步。将模型检查点转换为原型模型</h1><p id="314e" class="pw-post-body-paragraph ju jv ht jw b jx ly iu jz ka lz ix kc kd ma kf kg kh mb kj kk kl mc kn ko kp hm dt translated">将模型检查点转换为Protobuf，在我的例子中，我选择了最新的一个。</p><pre class="jj jk jl jm fq lj lk ll lm aw ln dt"><span id="f31f" class="lo ks ht lk b fv lp lq l lr ls"># from /PATH/TO/tensorflow/models/research</span><span id="4ac8" class="lo ks ht lk b fv lt lq l lr ls">python object_detection/export_inference_graph.py \<br/>    --input_type image_tensor \<br/>    --pipeline_config_path /PATH/TO/ssd_mobilenet_v1_coco.config \<br/>    --trained_checkpoint_prefix /PATH/TO/model.ckpt-20002 \<br/>    --output_directory /PATH/TO/rat_object_detection/vivi_model</span></pre><p id="6236" class="pw-post-body-paragraph ju jv ht jw b jx jy iu jz ka kb ix kc kd ke kf kg kh ki kj kk kl km kn ko kp hm dt translated">上面的代码生成了一个包含以下文件的<code class="eh lu lv lw lk b">vivi_model</code>目录:</p><pre class="jj jk jl jm fq lj lk ll lm aw ln dt"><span id="35ed" class="lo ks ht lk b fv lp lq l lr ls">checkpoint<br/>frozen_inference_graph.pb<br/>model.ckpt.data-00000-of-00001<br/>model.ckpt.index<br/>model.ckpt.meta<br/>pipeline.config<br/>saved_model/saved_model.pb<br/>variables/</span></pre><h1 id="5b1f" class="kr ks ht bd kt ku kv kw kx ky kz la lb iz lc ja ld jc le jd lf jf lg jg lh li dt translated">第四步。使用模型进行对象检测</h1><p id="dea8" class="pw-post-body-paragraph ju jv ht jw b jx ly iu jz ka lz ix kc kd ma kf kg kh mb kj kk kl mc kn ko kp hm dt translated">我用<a class="ae kq" href="https://github.com/tensorflow/models/blob/master/research/object_detection/object_detection_tutorial.ipynb" rel="noopener ugc nofollow" target="_blank">物体检测教程</a>来测试我的模型是否导出正确，是否能检测到老鼠。本教程假设你知道如何使用<code class="eh lu lv lw lk b">jupyter notebooks</code>。确保您的jupyter笔记本运行在您的对象检测项目的虚拟环境中。</p><pre class="jj jk jl jm fq lj lk ll lm aw ln dt"><span id="24d3" class="lo ks ht lk b fv lp lq l lr ls"># How to use your python virtual environment for your jupyter notebook</span><span id="b885" class="lo ks ht lk b fv lt lq l lr ls">workon virtualenv_name<br/>pip install ipykernel<br/>ipython kernel install --user --name=virtualenv_name</span></pre><p id="9c7f" class="pw-post-body-paragraph ju jv ht jw b jx jy iu jz ka kb ix kc kd ke kf kg kh ki kj kk kl km kn ko kp hm dt translated">替换<code class="eh lu lv lw lk b">/PATH/TO/tensorflow/models/research/object_detection/test_images</code>中的图像</p><figure class="jj jk jl jm fq jn fe ff paragraph-image"><div class="fe ff md"><img src="../Images/18ccf06c2410ee90271a7d156dd89ee1.png" data-original-src="https://miro.medium.com/v2/resize:fit:900/format:webp/1*dQ9cWdnkn4wj8O11yBg2gQ.jpeg"/></div><figcaption class="me mf fg fe ff mg mh bd b be z ek">Figure 1. Rat (Shutterstock) 2018</figcaption></figure><figure class="jj jk jl jm fq jn fe ff paragraph-image"><div class="fe ff md"><img src="../Images/d4803b08c4276aa5caea153c2cbc40c0.png" data-original-src="https://miro.medium.com/v2/resize:fit:900/format:webp/1*hDocNr38FElnG5_C1W-d_g.jpeg"/></div><figcaption class="me mf fg fe ff mg mh bd b be z ek">Figure 2. Rat (Shutterstock) 2018</figcaption></figure><p id="4a44" class="pw-post-body-paragraph ju jv ht jw b jx jy iu jz ka kb ix kc kd ke kf kg kh ki kj kk kl km kn ko kp hm dt translated">编辑模型的路径，并标注地图</p><figure class="jj jk jl jm fq jn fe ff paragraph-image"><div role="button" tabindex="0" class="jo jp di jq bf jr"><div class="fe ff mi"><img src="../Images/0cb8cd82891f4aad2fcde389dedf8cfe.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*K2H1zeiCA3Q53T06wwqa6w.png"/></div></div><figcaption class="me mf fg fe ff mg mh bd b be z ek">Figure 3. Model, and label map paths</figcaption></figure><p id="d705" class="pw-post-body-paragraph ju jv ht jw b jx jy iu jz ka kb ix kc kd ke kf kg kh ki kj kk kl km kn ko kp hm dt translated">运行所有程序，但跳过<strong class="jw hu">下载模型</strong>部分</p><figure class="jj jk jl jm fq jn fe ff paragraph-image"><div role="button" tabindex="0" class="jo jp di jq bf jr"><div class="fe ff mj"><img src="../Images/3d08513138fcf87d522c07c9f5d9e5e0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cRvnBv4Kedo14hCORUqp3Q.png"/></div></div><figcaption class="me mf fg fe ff mg mh bd b be z ek">Figure 4. Download Model part of object_detection_tutorial.ipynb</figcaption></figure><p id="19a0" class="pw-post-body-paragraph ju jv ht jw b jx jy iu jz ka kb ix kc kd ke kf kg kh ki kj kk kl km kn ko kp hm dt translated">以下是示例输入图像的输出</p><figure class="jj jk jl jm fq jn fe ff paragraph-image"><div class="fe ff mk"><img src="../Images/4c7ffe808aa03810068355ac4ea29cb0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1232/format:webp/1*NjqZSDIMTNK81Eqrw6u9NA.png"/></div><figcaption class="me mf fg fe ff mg mh bd b be z ek">Figure 5. Output image 1</figcaption></figure><figure class="jj jk jl jm fq jn fe ff paragraph-image"><div class="fe ff ml"><img src="../Images/537eff5344af174f6a9555d03fb479b2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1310/format:webp/1*TJT1seIpEGRgSnD57iq1sg.png"/></div><figcaption class="me mf fg fe ff mg mh bd b be z ek">Figure 6. Output image 2</figcaption></figure><p id="5a59" class="pw-post-body-paragraph ju jv ht jw b jx jy iu jz ka kb ix kc kd ke kf kg kh ki kj kk kl km kn ko kp hm dt translated">同样检查前面的部分:<a class="ae kq" rel="noopener" href="/coinmonks/part-1-2-step-by-step-guide-to-data-preparation-for-transfer-learning-using-tensorflows-object-ac45a6035b7a"> <strong class="jw hu">第一部分:数据准备</strong> </a>，<a class="ae kq" rel="noopener" href="/coinmonks/modelling-transfer-learning-using-tensorflows-object-detection-model-on-mac-692c8609be40"> <strong class="jw hu">第二部分:建模</strong> </a> <strong class="jw hu">。</strong></p><p id="6d83" class="pw-post-body-paragraph ju jv ht jw b jx jy iu jz ka kb ix kc kd ke kf kg kh ki kj kk kl km kn ko kp hm dt translated">谢谢！</p><h1 id="9855" class="kr ks ht bd kt ku kv kw kx ky kz la lb iz lc ja ld jc le jd lf jf lg jg lh li dt translated">来源</h1><ul class=""><li id="e5db" class="mm mn ht jw b jx ly ka lz kd mo kh mp kl mq kp mr ms mt mu dt translated"><a class="ae kq" href="https://towardsdatascience.com/build-a-taylor-swift-detector-with-the-tensorflow-object-detection-api-ml-engine-and-swift-82707f5b4a56" rel="noopener" target="_blank">https://towards data science . com/build-a-Taylor-swift-detector-with-the-tensor flow-object-detection-API-ml-engine-and-swift-82707 F5 b4a 56</a></li><li id="f822" class="mm mn ht jw b jx mv ka mw kd mx kh my kl mz kp mr ms mt mu dt translated"><a class="ae kq" rel="noopener" href="/coinmonks/part-1-2-step-by-step-guide-to-data-preparation-for-transfer-learning-using-tensorflows-object-ac45a6035b7a">https://medium . com/coin monks/part-1-2-step-by-step-guide-to-data-preparation-for-transfer-learning-using-tensor flows-object-ac45a 6035 b7a</a></li><li id="893e" class="mm mn ht jw b jx mv ka mw kd mx kh my kl mz kp mr ms mt mu dt translated"><a class="ae kq" rel="noopener" href="/coinmonks/modelling-transfer-learning-using-tensorflows-object-detection-model-on-mac-692c8609be40">https://medium . com/coin monks/modeling-transfer-learning-using-tensor flows-object-detection-model-on-MAC-692 c 8609 be 40</a></li><li id="77f4" class="mm mn ht jw b jx mv ka mw kd mx kh my kl mz kp mr ms mt mu dt translated"><a class="ae kq" href="https://github.com/tensorflow/models/blob/master/research/object_detection/object_detection_tutorial.ipynb" rel="noopener ugc nofollow" target="_blank">https://github . com/tensor flow/models/blob/master/research/object _ detection/object _ detection _ tutorial . ipynb</a></li><li id="8e10" class="mm mn ht jw b jx mv ka mw kd mx kh my kl mz kp mr ms mt mu dt translated"><a class="ae kq" href="https://github.com/tensorflow/models/blob/master/research/object_detection/g3doc/exporting_models.md" rel="noopener ugc nofollow" target="_blank">https://github . com/tensor flow/models/blob/master/research/object _ detection/g3doc/exporting _ models . MD</a></li><li id="b620" class="mm mn ht jw b jx mv ka mw kd mx kh my kl mz kp mr ms mt mu dt translated"><a class="ae kq" href="https://github.com/tensorflow/models/issues/2714" rel="noopener ugc nofollow" target="_blank">https://github.com/tensorflow/models/issues/2714</a></li><li id="4450" class="mm mn ht jw b jx mv ka mw kd mx kh my kl mz kp mr ms mt mu dt translated">致谢:<a class="ae kq" href="http://www.newcastleshow.com.au/wp-content/uploads/2015/01/mouse1.jpg" rel="noopener ugc nofollow" target="_blank">http://www . newcastleshow . com . au/WP-content/uploads/2015/01/mouse 1 . jpg</a>，访问日期:2018年7月8日</li><li id="d111" class="mm mn ht jw b jx mv ka mw kd mx kh my kl mz kp mr ms mt mu dt translated">shutterstock 2018年7月8日<br/>&lt;<a class="ae kq" href="https://www.shutterstock.com/image-photo/funny-white-rat-looking-out-cage-592100393?src=NgjpowHkxggr3KzCoYKH2w-1-26" rel="noopener ugc nofollow" target="_blank">https://www . shutterstock . com/image-photo/funny-white-rat-looking-out-cage-592100393？src = ngjpowhkxggr 3 kzcoykh 2w-1-26</a>&gt;</li><li id="a53f" class="mm mn ht jw b jx mv ka mw kd mx kh my kl mz kp mr ms mt mu dt translated">shutterstock 2018年7月8日<br/>&lt;<a class="ae kq" href="https://www.shutterstock.com/image-photo/two-black-white-rats-on-human-425507344?src=MT9S2CGbz5rFw1cCcTiu9Q-1-70" rel="noopener ugc nofollow" target="_blank">https://www . shutterstock . com/image-photo/two-black-white-rats-on-human-425507344？src = mt 9 S2 gbz 5 rfw 1c cctiu 9 q-1-70</a>&gt;</li></ul></div></div>    
</body>
</html>