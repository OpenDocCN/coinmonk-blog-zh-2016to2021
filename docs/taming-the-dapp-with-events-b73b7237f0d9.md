# 用事件驯服 DApp

> 原文：<https://medium.com/coinmonks/taming-the-dapp-with-events-b73b7237f0d9?source=collection_archive---------8----------------------->

![](img/93dec8e4c1abfa4c448fca724a276e1b.png)

管理状态是艰难的。管理 UI 的复杂性是困难的。在以太坊区块链上管理你的应用程序的状态和处理你的 UI 的复杂性是……更困难的。

在过去的几年中，有一些前端架构展示了模型-视图-更新架构的强大功能(Elm 和 om，仅举两个例子),使代码易于推理，并且它们适合事件驱动的模型。幸运的是，Solidity 有[事件](http://solidity.readthedocs.io/en/v0.4.21/contracts.html#events)来跟踪合同随时间变化的状态。我们能把这些东西连在一起吗？让我们来了解一下！

## 反应/还原

我使用 React with Redux，这是一个将 Elm 架构引入普通 javascript 的库。

## 项目结构

应用程序的流程分为

*   引导 web3
*   启动应用程序(获取默认帐户，找到合同)
*   启动用户界面

一旦我们开始运行，我们会的

*   指导用户事件更新合同
*   指导合同事件更新用户界面

我将在本文中展示最后两个部分；如果你想看所有的代码，你会想看这里的。

## U ser 事件

在这个表单中，您可以看到`onSubmit`调用`dispatch`，动作类型为`pay`，值在我们的表单中。

该应用程序有一些定制的中间件来捕捉这个动作，并将其定向到我们的合同。除非交易失败，否则这就是一劳永逸；我们会让合同告诉我们什么时候完成。

当我们启动用户界面时；我们观察来自契约的事件，这样我们可以将它们作为动作发送。

这显示了我们的[减速器](https://redux.js.org/basics/reducers)的一个片段。我们从合同中接收动作，并改变应用程序的状态以反映这一点。重要的状态变化是`status`。我们在下面看到这是如何影响 UI 的。

最后，显示哪些表单取决于该状态；只有当状态为`payable`时，我们才会显示`PayForm`。我们的应用程序越大越容易推理；并且很好地分开，这样我们可以编写一些测试来验证它对于每个状态变化的行为。