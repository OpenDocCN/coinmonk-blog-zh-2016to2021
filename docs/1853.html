<html>
<head>
<title>Proof-of-Payment (PoP) Login on Lightning Network Apps</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">闪电网络应用上的支付凭证(PoP)登录</h1>
<blockquote>原文：<a href="https://medium.com/coinmonks/proof-of-payment-pop-login-on-lightning-network-apps-d9966acc9889?source=collection_archive---------2-----------------------#2018-12-03">https://medium.com/coinmonks/proof-of-payment-pop-login-on-lightning-network-apps-d9966acc9889?source=collection_archive---------2-----------------------#2018-12-03</a></blockquote><div><div class="ef hh hi hj hk hl"/><div class="hm hn ho hp hq"><div class=""/><figure class="fi fk ir is it iu fe ff paragraph-image"><div role="button" tabindex="0" class="iv iw di ix bf iy"><div class="fe ff iq"><img src="../Images/6e9d6f9a135676dc85eb07c5c29dd702.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*STVRiTiuAVfozlAoY-WCVw.png"/></div></div><figcaption class="jb jc fg fe ff jd je bd b be z ek">MicroBet — Home screen</figcaption></figure><h1 id="e930" class="jf jg ht bd jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc dt translated">概观</h1><p id="9d7c" class="pw-post-body-paragraph kd ke ht kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la hm dt translated"><a class="ae lb" href="https://microbet.fun/" rel="noopener ugc nofollow" target="_blank"> MicroBet </a>是一款生活在闪电网络之上的比特币预测和博彩游戏。它开始只是一个概念验证，但随着时间的推移，人们开始经常使用它，并且工作得相当好和稳定。</p><p id="e508" class="pw-post-body-paragraph kd ke ht kf b kg lc ki kj kk ld km kn ko le kq kr ks lf ku kv kw lg ky kz la hm dt translated">由于MicroBet在几个月前推出，我希望它使用起来非常简单，但我也希望保持闪电网络为我们提供的用户隐私。这就是为什么它从不询问用户任何信息，甚至是用户名。</p><h1 id="3958" class="jf jg ht bd jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc dt translated">问题是</h1><p id="8f22" class="pw-post-body-paragraph kd ke ht kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la hm dt translated">为了给用户更好的体验，当用户第一次付款时，会创建一个cookie会话。通过该会话，如果用户想要参与其他预测，他/她可以在<em class="lh">我的赌注</em>部分看到它们，以跟踪用户活动。但问题是如果用户需要注销，系统怎么知道哪个人<em class="lh">拥有</em>哪个账号？</p><p id="dcf5" class="pw-post-body-paragraph kd ke ht kf b kg lc ki kj kk ld km kn ko le kq kr ks lf ku kv kw lg ky kz la hm dt translated">这个问题的简单答案是使用<strong class="kf hu">原像。</strong>我通过允许人们在几个月内仅使用付费前图像恢复他们的会话来进行试验，我想看看用户是否觉得这有用。在此期间，这个选项是允许的，该网站收到了少量的每周交易，其中大多数是100 satoshis，为了科学起见，我愿意支付给用户，如果有任何错误。</p><p id="a5b9" class="pw-post-body-paragraph kd ke ht kf b kg lc ki kj kk ld km kn ko le kq kr ks lf ku kv kw lg ky kz la hm dt translated">预像是收款人给付款人作为付款凭证的<em class="lh">秘密</em>号。问题是这个数字并不那么秘密；付款人节点创建一个节点路由，将钱发送给收款人，在此期间，路由中的每个节点将钱兑换成相同的原像，然后最终交付给付款人，我不打算详细解释支付过程，因为这不是本文的主题，有很多有用的资源可以解释这一点。谷歌是你的朋友😃</p><p id="d271" class="pw-post-body-paragraph kd ke ht kf b kg lc ki kj kk ld km kn ko le kq kr ks lf ku kv kw lg ky kz la hm dt translated">这就是问题所在；支付完成后，路由中的所有节点都知道相同的原像。转发钱的节点只知道钱从哪里来，到哪里去，仅此而已。这意味着攻击者很难知道如何处理前图像，但攻击者可以很容易地直接打开一个与最终节点(如微网络节点)的通道，并保存他转发的所有前图像，然后进行暴力攻击，并试图从其他用户那里获得一些资金。</p><h1 id="0c45" class="jf jg ht bd jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc dt translated">解决方案</h1><p id="712a" class="pw-post-body-paragraph kd ke ht kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la hm dt translated">我一直在思考如何在不危及用户资金的情况下保持这一功能，最后我决定使用一个非常简单的概念，一个解码后的bolt11付款请求如下所示:</p><pre class="li lj lk ll fq lm ln lo lp aw lq dt"><span id="61c0" class="lr jg ht ln b fv ls lt l lu lv">{<br/>    "destination": "03819ddbe246214d4c57b7ea4d28bfe5c09c03bb4308b40c26f1468532131e0cc0",<br/>    "payment_hash": "287a3a66c85caae2f50754a2e5fc80f9d1f8c2fe6df2de9617e29fd91ef83ab6",<br/>    "num_satoshis": "12121",<br/>    "timestamp": "1543522630",<br/>    "expiry": "1800",<br/>    "description": "Lay bet:  Liverpool FC - Everton FC → EVE 🏆 +1 [dKLwm]",<br/>    "description_hash": "",<br/>    "fallback_addr": "",<br/>    "cltv_expiry": "144",<br/>    "route_hints": []<br/>}</span></pre><p id="ca07" class="pw-post-body-paragraph kd ke ht kf b kg lc ki kj kk ld km kn ko le kq kr ks lf ku kv kw lg ky kz la hm dt translated">付款人不需要比这更多的信息来发送付款。我们可以看到有一个描述字段，<strong class="kf hu">这个描述字段位于付款方</strong>。这给了我们一个可以添加小id的地方，我称之为s <em class="lh"> id </em>，它是一个由字母(大写/小写)和数字组成的伪随机五字符字符串。目前这个字符串只有5个字符，但是如果攻击者试图强行破解它，他/她将需要对n或62⁵进行k次排列，这等于<strong class="kf hu">每个原图像916，132，832个组合</strong>，如果我们考虑到微网络站点每分钟只允许10个IP地址请求，攻击者将需要174年才能破解一个原图像。祝你好运。</p><h1 id="c2cd" class="jf jg ht bd jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc dt translated">结论</h1><p id="8f7b" class="pw-post-body-paragraph kd ke ht kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la hm dt translated">闪电网络正处于一个非常有趣的时刻，我们有责任去试验和应用想法，即使它们是愚蠢的想法也没关系，因为它们仍然会引导我们提出更多的问题，然后进行更多的思考和解决方案，如果你有什么想法，就在它的基础上构建，我们会看到会发生什么。</p></div><div class="ab cl lw lx hb ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="hm hn ho hp hq"><p id="1031" class="pw-post-body-paragraph kd ke ht kf b kg lc ki kj kk ld km kn ko le kq kr ks lf ku kv kw lg ky kz la hm dt translated">原来就是这样！如果你对这种会话恢复方式有什么建议，或者认为我没有考虑其他安全风险，请在评论中告诉我，我总是想知道更多关于安全性的信息，以及如何在我的系统上改进它。如果你想了解更多关于我的工作，你可以在推特上关注我。</p></div><div class="ab cl lw lx hb ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="hm hn ho hp hq"><p id="f303" class="pw-post-body-paragraph kd ke ht kf b kg lc ki kj kk ld km kn ko le kq kr ks lf ku kv kw lg ky kz la hm dt translated">微博客mainnet<a class="ae lb" href="https://microbet.fun/" rel="noopener ugc nofollow" target="_blank">https://MicroBet . fun</a></p><p id="939f" class="pw-post-body-paragraph kd ke ht kf b kg lc ki kj kk ld km kn ko le kq kr ks lf ku kv kw lg ky kz la hm dt translated">微网testnet<a class="ae lb" href="https://testnet.microbet.fun/" rel="noopener ugc nofollow" target="_blank">https://testnet . MicroBet . fun</a></p><figure class="li lj lk ll fq iu fe ff paragraph-image"><a href="http://bit.ly/2G71Sp7"><div class="fe ff md"><img src="../Images/449450761cd76f44f9ae574333f9e9af.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fKX2mtg7p1lOs7JmosPLsA.png"/></div></a><figcaption class="jb jc fg fe ff jd je bd b be z ek"><a class="ae lb" href="http://bit.ly/2G71Sp7" rel="noopener ugc nofollow" target="_blank"><strong class="bd me">Click to read today’s top story</strong></a></figcaption></figure></div></div>    
</body>
</html>