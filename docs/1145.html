<html>
<head>
<title>Atomic Swaps: Decentralized trade</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">原子互换:分散贸易</h1>
<blockquote>原文：<a href="https://medium.com/coinmonks/atomic-swaps-descentralized-trade-5d30b4980f3?source=collection_archive---------7-----------------------#2018-07-26">https://medium.com/coinmonks/atomic-swaps-descentralized-trade-5d30b4980f3?source=collection_archive---------7-----------------------#2018-07-26</a></blockquote><div><div class="ef hh hi hj hk hl"/><div class="hm hn ho hp hq"><div class=""/><p id="33d3" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">通常，当我们想要在不同的加密货币之间进行交易时，我们会使用交易所或p2p交易(有或没有托管)。在这两种选择中，我们都必须<strong class="is hu">信任中介(交换/托管)或另一方</strong>。</p><h1 id="41fe" class="jo jp ht bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl dt translated">不要相信，验证！</h1><p id="e881" class="pw-post-body-paragraph iq ir ht is b it km iv iw ix kn iz ja jb ko jd je jf kp jh ji jj kq jl jm jn hm dt translated">比特币引入的伟大创新是一个没有可信第三方的金融系统的生存能力，也就是一个不可信的系统。</p><p id="27f0" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">利用这一原理，原子互换(Atomic Swap)应运而生，这一解决方案使得在没有第三方的情况下交换不同的加密货币成为可能。在下面的部分中，我将解释它是如何工作的，并给出一些实现的例子:</p><h1 id="33a0" class="jo jp ht bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl dt translated">要求</h1><p id="48d9" class="pw-post-body-paragraph iq ir ht is b it km iv iw ix kn iz ja jb ko jd je jf kp jh ji jj kq jl jm jn hm dt translated">两种硬币都应支持智能合约，该合约允许以下方面:</p><ol class=""><li id="17f1" class="kr ks ht is b it iu ix iy jb kt jf ku jj kv jn kw kx ky kz dt translated">时间验证(TimeLock) —例如:资金只能在1周后使用；</li><li id="0606" class="kr ks ht is b it la ix lb jb lc jf ld jj le jn kw kx ky kz dt translated">哈希函数验证(HashLock) —示例:只有当发现质询问题(通过哈希“隐藏”)时，才能花费资金；</li><li id="9f27" class="kr ks ht is b it la ix lb jb lc jf ld jj le jn kw kx ky kz dt translated">可见哈希输入(公共前映像)—示例:可以通过查看事务数据来查看质询答案。</li></ol><p id="83d2" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">具有1个和2个验证的合同被称为HTLC(散列时间锁合同),也用于Lightning网络协议。</p><h1 id="974d" class="jo jp ht bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl dt translated">它是如何工作的</h1><p id="0d70" class="pw-post-body-paragraph iq ir ht is b it km iv iw ix kn iz ja jb ko jd je jf kp jh ji jj kq jl jm jn hm dt translated">让我们来看看爱丽丝和鲍勃之间成功的1 BTC对10埃特的交易。</p><ol class=""><li id="31aa" class="kr ks ht is b it iu ix iy jb kt jf ku jj kv jn kw kx ky kz dt translated">Alice生成一个随机值(secret)，执行一个哈希函数，获得hashedSecret</li><li id="7990" class="kr ks ht is b it la ix lb jb lc jf ld jj le jn kw kx ky kz dt translated">爱丽丝转移1 BTC到智能合同。为了赎回基金，以下条件需要为真:<br/> A)交易必须包含秘密值；<br/> B)收件人必须是鲍勃的BTC地址；<br/> C)交易必须在合同创建后48小时内完成。</li><li id="7a46" class="kr ks ht is b it la ix lb jb lc jf ld jj le jn kw kx ky kz dt translated">Bob将10个eth转移到智能合约。契约类似于Alice创建的:<br/> A)交易必须包含秘密值；<br/> B)收件人必须是爱丽丝的ETH地址；<br/> C)交易必须在合同创建的<strong class="is hu"> 24小时内</strong>完成。</li><li id="ae27" class="kr ks ht is b it la ix lb jb lc jf ld jj le jn kw kx ky kz dt translated">此时，Alice和Bob的资金受合同控制，只有在知道秘密值的情况下才能使用。<br/>Alice是如何产生这个价值的，她能够将Bob发送的10个eth兑换到她的钱包中。</li><li id="e282" class="kr ks ht is b it la ix lb jb lc jf ld jj le jn kw kx ky kz dt translated">通过分析Alice的最后一次交易，Bob能够知道秘密值(公开的前映像),并且能够访问1 BTC并完成交易。</li></ol><h1 id="0550" class="jo jp ht bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl dt translated">如果出了什么问题呢？</h1><p id="b04e" class="pw-post-body-paragraph iq ir ht is b it km iv iw ix kn iz ja jb ko jd je jf kp jh ji jj kq jl jm jn hm dt translated">前面的例子是基于一次成功的操作。可能会出现一些问题，解决方案就是为了处理这些问题而设计的。</p><ol class=""><li id="cd9f" class="kr ks ht is b it iu ix iy jb kt jf ku jj kv jn kw kx ky kz dt translated">如果Bob没有创建他的合同，Alice会冻结他的1 BTC吗？不可以，为了简化上面的解释，合同被省略的另一个条件是:合同创建48小时后，爱丽丝可以退款。Bob是48小时内资金的唯一接收人，在此之后，只有Alice可以接收资金。</li><li id="a188" class="kr ks ht is b it la ix lb jb lc jf ld jj le jn kw kx ky kz dt translated">鲍勃也一样，如果爱丽丝没有通过赎回10个eth来揭示秘密的价值，他可以在24小时后退款。</li><li id="b970" class="kr ks ht is b it la ix lb jb lc jf ld jj le jn kw kx ky kz dt translated">时间锁是不同的(48小时和24小时),因为否则爱丽丝有可能在截止日期结束时赎回eth，并且如果鲍勃没有迅速赎回，仍然有可能退还她的1 BTC。</li></ol><h1 id="7c15" class="jo jp ht bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl dt translated">履行</h1><p id="77e5" class="pw-post-body-paragraph iq ir ht is b it km iv iw ix kn iz ja jb ko jd je jf kp jh ji jj kq jl jm jn hm dt translated"><a class="ae lf" href="https://swapready.net/" rel="noopener ugc nofollow" target="_blank">在此链接</a>，可以检查某些脚本代码与原子交换要求的兼容性。</p><h2 id="b124" class="lg jp ht bd jq lh li lj ju lk ll lm jy jb ln lo kc jf lp lq kg jj lr ls kk lt dt translated">比特币</h2><p id="2762" class="pw-post-body-paragraph iq ir ht is b it km iv iw ix kn iz ja jb ko jd je jf kp jh ji jj kq jl jm jn hm dt translated">比特币的智能合约使用图灵不完整脚本语言，下面的代码基于Decred的资源库中的<a class="ae lf" href="https://github.com/decred/atomicswap" rel="noopener ugc nofollow" target="_blank">实现。</a></p><pre class="lu lv lw lx fq ly lz ma mb aw mc dt"><span id="38c9" class="lg jp ht lz b fv md me l mf mg">OP_IF OP_SHA256 <strong class="lz hu">&lt;HASHED_SECRET&gt;</strong> OP_EQUALVERIFY OP_DUP OP_HASH160 <strong class="lz hu">&lt;COUNTER_PARTY_PUBKEY&gt;</strong> OP_ELSE <strong class="lz hu">&lt;LOCK_TIME&gt;</strong> OP_CHECKLOCKTIMEVERIFY OP_DROP OP_DUP OP_HASH160 <strong class="lz hu">&lt;MY_PUBKEY&gt;</strong> OP_ENDIF OP_EQUALVERIFY OP_CHECKSIG</span></pre><h2 id="151d" class="lg jp ht bd jq lh li lj ju lk ll lm jy jb ln lo kc jf lp lq kg jj lr ls kk lt dt translated">以太坊</h2><p id="d197" class="pw-post-body-paragraph iq ir ht is b it km iv iw ix kn iz ja jb ko jd je jf kp jh ji jj kq jl jm jn hm dt translated">下面是使用Solidity语言的一个可能的契约实现(<a class="ae lf" href="https://github.com/AltCoinExchange/ethatomicswap" rel="noopener ugc nofollow" target="_blank">基于这个实现</a>)</p><h1 id="2b5a" class="jo jp ht bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl dt translated">骗局</h1><ol class=""><li id="2792" class="kr ks ht is b it km ix kn jb mh jf mi jj mj jn kw kx ky kz dt translated"><strong class="is hu"> Privacy </strong>:跟踪不同区块链之间交换的值并不困难，因为相同的hashedSecret在两个平台上都是可见的。</li><li id="3aa3" class="kr ks ht is b it la ix lb jb lc jf ld jj le jn kw kx ky kz dt translated">可用性:仍然有一些工具/钱包支持这项技术。</li><li id="a757" class="kr ks ht is b it la ix lb jb lc jf ld jj le jn kw kx ky kz dt translated"><strong class="is hu">速度</strong>:与集中式替代方案相比，运行速度较慢。</li><li id="7d3c" class="kr ks ht is b it la ix lb jb lc jf ld jj le jn kw kx ky kz dt translated"><strong class="is hu">兼容性</strong>:并非所有的加密币都兼容。</li></ol><h1 id="7354" class="jo jp ht bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl dt translated">结论</h1><p id="44e1" class="pw-post-body-paragraph iq ir ht is b it km iv iw ix kn iz ja jb ko jd je jf kp jh ji jj kq jl jm jn hm dt translated">已经有倡议使用第二层解决方案(如闪电网络)来执行链外交换，解决问题1和3。</p><p id="45c9" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">原子互换是走向贸易操作去中心化的重要一步。它目前是大额交易的一个很好的解决方案，但是仍然需要更多的工具和技术的开发来实现大规模的采用。</p><h1 id="3447" class="jo jp ht bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl dt translated">进一步阅读</h1><ul class=""><li id="003d" class="kr ks ht is b it km ix kn jb mh jf mi jj mj jn mk kx ky kz dt translated"><a class="ae lf" href="https://cointelegraph.com/news/decentralized-exchanges-off-chain-atomic-swaps-and-a-brief-look-into-the-future" rel="noopener ugc nofollow" target="_blank">https://coin telegraph . com/news/decentralized-exchange-off-chain-atomic-swaps-and-a-brief-look-to-the-future</a></li><li id="e71a" class="kr ks ht is b it la ix lb jb lc jf ld jj le jn mk kx ky kz dt translated"><a class="ae lf" href="https://segwit.org/my-vision-for-segwit-and-lightning-networks-on-litecoin-and-bitcoin-cf95a7ab656b" rel="noopener ugc nofollow" target="_blank">https://seg wit . org/my-vision-for-seg wit-and-lightning-networks-on-lite coin-bit coin-cf 95 a 7 ab 656 b</a></li></ul></div></div>    
</body>
</html>