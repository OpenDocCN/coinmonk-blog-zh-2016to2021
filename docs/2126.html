<html>
<head>
<title>How to build your own decentralized exchange based on Atomic Swaps using Oraclize</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何使用Oraclize基于原子交换构建自己的分散式交换</h1>
<blockquote>原文：<a href="https://medium.com/coinmonks/how-to-build-your-own-decentralized-exchange-based-on-atomic-swaps-using-oraclize-3ee4858f128d?source=collection_archive---------1-----------------------#2019-03-11">https://medium.com/coinmonks/how-to-build-your-own-decentralized-exchange-based-on-atomic-swaps-using-oraclize-3ee4858f128d?source=collection_archive---------1-----------------------#2019-03-11</a></blockquote><div><div class="ef hh hi hj hk hl"/><div class="hm hn ho hp hq"><div class=""/><figure class="fi fk ir is it iu fe ff paragraph-image"><div class="fe ff iq"><img src="../Images/db379ba6689b57c85f33370f8928ecb7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1146/format:webp/1*l7T3Dhhny53nP7p5OkncbA.png"/></div><figcaption class="ix iy fg fe ff iz ja bd b be z ek">A depiction of how currencies could be swapped directly with Etherswaps, created with this <a class="ae jb" href="https://observablehq.com/@mbostock/d3-hierarchical-edge-bundling-ii" rel="noopener ugc nofollow" target="_blank">Observable</a></figcaption></figure><p id="fc62" class="pw-post-body-paragraph jc jd ht je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hm dt translated">几个月前，我有了一个想法，如何在不同的区块链之间交换加密货币，将验证留给智能合约而不是第三方。我受到了宇宙网络和他们如何在不同的区块链之间进行原子交换的启发。(因此可视化)。</p><p id="8540" class="pw-post-body-paragraph jc jd ht je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hm dt translated">有多个可靠的区块链浏览器API可供查询，以检查交易的有效性。然而，像API请求或随机数生成这样的非确定性计算在区块链世界是不可能的。事实上，如果两个节点计算“现实”的不同版本，区块链就会分叉，所以我必须找到一个变通办法，我做到了…</p><p id="1fa0" class="pw-post-body-paragraph jc jd ht je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hm dt translated"><a class="ae jb" href="http://www.oraclize.it/" rel="noopener ugc nofollow" target="_blank"> Oraclize </a>使得在智能合约中执行API请求成为可能。我将在最后解释他们的服务到底是如何工作的，但是现在，你应该记住，他们提供了一种值得信赖的从外部世界获取数据的方法。有了这个伟大的技术在我的口袋里，我已经建立了一个功能性的概念验证Dapp，让你用比特币和恒星流明交换以太，你可以在Etherswaps.co的<a class="ae jb" href="http://etherswaps.co/" rel="noopener ugc nofollow" target="_blank">找到。我将积极地引导你完成以太兑换比特币的过程，但在此之前，让我给你一个它是如何工作的概述。</a></p><figure class="kb kc kd ke fq iu fe ff paragraph-image"><div role="button" tabindex="0" class="kf kg di kh bf ki"><div class="fe ff ka"><img src="../Images/5db2aca421caf03fbba10bbffd8f56a2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2S_-vncKPEEq6y33GQM6wQ.png"/></div></div><figcaption class="ix iy fg fe ff iz ja bd b be z ek">Overview</figcaption></figure><p id="c36b" class="pw-post-body-paragraph jc jd ht je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hm dt translated">如您所见，分散式交换机上的令牌交换通过三个简单的步骤完成。</p><ol class=""><li id="8462" class="kj kk ht je b jf jg jj jk jn kl jr km jv kn jz ko kp kq kr dt translated">鲍勃在一份智能合约中锁定了他的以太，该合约定义了他想要兑换多少比特币。</li><li id="0500" class="kj kk ht je b jf ks jj kt jn ku jr kv jv kw jz ko kp kq kr dt translated">Alice在市场上看到了该提议，并向Bob的比特币地址支付了等量的金额。然后，她使用<a class="ae jb" href="http://etherswaps.co" rel="noopener ugc nofollow" target="_blank">以太交换</a> Dapp将交易散列提交给智能合约。</li><li id="c1cf" class="kj kk ht je b jf ks jj kt jn ku jr kv jv kw jz ko kp kq kr dt translated">之后，她将交易散列提交给智能合约，智能合约执行一个<a class="ae jb" href="http://www.oraclize.it/" rel="noopener ugc nofollow" target="_blank"> Oraclize </a> API请求来检查交易是否有效。如果提交的金额是&gt; = Bob请求的金额(1 BTC)，智能合约会将资金发送到Alice的以太坊地址。</li></ol><p id="13d6" class="pw-post-body-paragraph jc jd ht je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hm dt translated">非常原则是<strong class="je hu">用户可以向智能合同</strong>证明他们已经进行了正确的支付形式，这使他们有权接收锁定的以太网。</p><p id="cc59" class="pw-post-body-paragraph jc jd ht je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hm dt translated">理论上，只要验证数据是公开的，人们甚至可以使用这个系统用以太或任何其他ERC20令牌交换法定货币。虽然它不能被认为是完全安全的，而且<strong class="je hu">不应该</strong>用于生产，而只能用于测试网络，但它确实有一些有趣的特性。因此，让我带你经历一下用以太交换比特币的过程，并向你展示如何建立你自己的去中心化的交易所，在此基础上支持不同的货币。</p><h1 id="3ede" class="kx ky ht bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu dt translated">如何使用它</h1><p id="eb1d" class="pw-post-body-paragraph jc jd ht je b jf lv jh ji jj lw jl jm jn lx jp jq jr ly jt ju jv lz jx jy jz hm dt translated">让我向您展示在<a class="ae jb" href="https://etherswaps.co" rel="noopener ugc nofollow" target="_blank">以太交换Dapp </a>中执行令牌交换的3个步骤。我们将在智能合约中创建一个报价，并用以太网换取比特币。</p><p id="1f21" class="pw-post-body-paragraph jc jd ht je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hm dt translated"><strong class="je hu">第一步</strong></p><p id="a16d" class="pw-post-body-paragraph jc jd ht je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hm dt translated">转到<a class="ae jb" href="http://etherswaps.co" rel="noopener ugc nofollow" target="_blank">http://etherswaps.co</a>并用<a class="ae jb" href="http://metamask.io" rel="noopener ugc nofollow" target="_blank">元掩码</a>连接到Dapp。然后在<a class="ae jb" href="http://bockchain.etherswaps.co" rel="noopener ugc nofollow" target="_blank">http:<strong class="je hu">//</strong>blockchain.etherswaps.co</a>添加我的本地区块链实例作为定制RPC。您也可以使用Ropsten Testnet，但是在这一点上进行验证要慢得多。</p><p id="c320" class="pw-post-body-paragraph jc jd ht je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hm dt translated">如果您使用我的区块链实例，请导入以下存储有100以太的私钥之一，但请节约；)</p><ul class=""><li id="8296" class="kj kk ht je b jf jg jj jk jn kl jr km jv kn jz ma kp kq kr dt translated"><em class="mb">0x 7a 7 ce 0 fa 57 cf 26 a6e 5064 a 61 B1 ba 9135680 e 776956 BF 19d 26 f 6964 f 185 fcb 9 c 7</em></li><li id="3947" class="kj kk ht je b jf ks jj kt jn ku jr kv jv kw jz ma kp kq kr dt translated"><em class="mb">0 x7 fa 4 f 9979 b 728 b 9 a 58 C2 DC 7 ab 70 f 42e 735 a3 cef 135 ea 572 f 83 E8 a2 d 908 b 7289d</em></li><li id="6083" class="kj kk ht je b jf ks jj kt jn ku jr kv jv kw jz ma kp kq kr dt translated"><em class="mb">0x1bc 2129 af 5929d 2772 c 5599d 3 a9 da 8329 E1 C1 a 020980 e 3028710 CD 6a D2 f 55327</em></li></ul><figure class="kb kc kd ke fq iu fe ff paragraph-image"><div role="button" tabindex="0" class="kf kg di kh bf ki"><div class="fe ff mc"><img src="../Images/c1579f29441071437ae348164af16091.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0It7d9uoOkUAsrgDs34HSA.png"/></div></div><figcaption class="ix iy fg fe ff iz ja bd b be z ek">Connect to the Dapp, import the Private Key and connect to the Custom RPC http://blockchain.etherswaps.co</figcaption></figure><p id="51b7" class="pw-post-body-paragraph jc jd ht je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hm dt translated"><strong class="je hu">第二步</strong></p><p id="97c4" class="pw-post-body-paragraph jc jd ht je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hm dt translated">继续<a class="ae jb" href="http://etherswaps.co/#/createOffer" rel="noopener ugc nofollow" target="_blank">创建报价</a>并输入所需的<strong class="je hu">比特币地址</strong>、<strong class="je hu">比特币金额(Satoshi中的</strong>)和<strong class="je hu">乙醚金额</strong>(Wei中的)该报价对您来说是值得的。标签会自动显示最新价格。使用这个比特币地址<em class="mb">1 mfjvqrgryfvngsqjvt 3 xcahdwmcwairyq</em>并定义你要锁定的<em class="mb"> 2以太</em>为<em class="mb"> 0.08876 BTC。</em></p><p id="187e" class="pw-post-body-paragraph jc jd ht je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hm dt translated">因此，您应该键入以下内容:</p><ul class=""><li id="8461" class="kj kk ht je b jf jg jj jk jn kl jr km jv kn jz ma kp kq kr dt translated"><strong class="je hu">比特币地址</strong>:<em class="mb">1 mfjvqrgryfvngsqjvt 3 xcahdwmcwairyq</em></li><li id="1a79" class="kj kk ht je b jf ks jj kt jn ku jr kv jv kw jz ma kp kq kr dt translated"><strong class="je hu">比特币金额(以Satoshi计)</strong> : <em class="mb"> 70万</em></li><li id="6c73" class="kj kk ht je b jf ks jj kt jn ku jr kv jv kw jz ma kp kq kr dt translated"><strong class="je hu">乙醚量(单位为微)</strong>:<em class="mb">20000000000000</em></li></ul><p id="75bf" class="pw-post-body-paragraph jc jd ht je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hm dt translated">将弹出一个元掩码页面，您可以确认交易的详细信息。</p><p id="b2ba" class="pw-post-body-paragraph jc jd ht je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hm dt translated"><strong class="je hu">重要的是</strong>要提到的是，你应该只使用没有任何先前交易的“新”比特币地址，因为否则恶意方可能会发送错误的交易哈希，并免费索取你的以太网！(稍后将详细介绍安全性)。幸运的是，网站会进行自动检查，如果该地址收到了任何以前的交易，就会抛出一个错误(不过目前已被停用进行测试)。</p><figure class="kb kc kd ke fq iu fe ff paragraph-image"><div role="button" tabindex="0" class="kf kg di kh bf ki"><div class="fe ff md"><img src="../Images/05dad2dee781641811a9c0bbf6a8ed66.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*oECTqrQkgLO0pvKrteBNXw.png"/></div></div><figcaption class="ix iy fg fe ff iz ja bd b be z ek">The Dapp will update the live prices of Ether, Bitcoin and Lumens accordingly</figcaption></figure><p id="ce6c" class="pw-post-body-paragraph jc jd ht je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hm dt translated"><strong class="je hu">第三步</strong></p><p id="7444" class="pw-post-body-paragraph jc jd ht je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hm dt translated">接下来，我们将0.007 BTC发送到该地址，并提交事务哈希来声明以太网。幸运的是，我已经这样做了，你可以看到交易<a class="ae jb" href="https://www.blockchain.com/de/btc/tx/014ed2e6f875da84648fb38f5b39077f8d54466aecef371a4fe5f9f754088c46" rel="noopener ugc nofollow" target="_blank">在这里</a>发送0.007 BTC到我们的地址。</p><p id="7bf8" class="pw-post-body-paragraph jc jd ht je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hm dt translated">转到<a class="ae jb" href="http://etherswaps.co/#/createOffer" rel="noopener ugc nofollow" target="_blank">市场页面</a>并选择您刚刚创建了一个报价。理想情况下，您应该已经被重定向，正确的报价应该突出显示。当你点击它时，会弹出一个更详细的模式，允许你输入比特币交易的交易哈希。</p><ul class=""><li id="2d1f" class="kj kk ht je b jf jg jj jk jn kl jr km jv kn jz ma kp kq kr dt translated"><strong class="je hu">比特币交易哈希</strong>:<em class="mb">014 ed 2 e 6 f 875 da 84648 FB 38 F5 b 39077 f8d 54466 aecef 371 a 4 Fe 5 f 9 f 754088 c 46</em></li></ul><p id="cb56" class="pw-post-body-paragraph jc jd ht je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hm dt translated">然后用元掩码确认交易。在后台，发送底层智能合约的事务。它使用<a class="ae jb" href="http://www.oraclize.it/" rel="noopener ugc nofollow" target="_blank"> Oraclize </a>执行一个API请求，以检查交易是否向相关联的比特币地址发送了正确的金额。如果是这种情况，智能合约会将存放的以太支付到您的以太坊地址，大约30秒后，您会收到一个通知，告知您金额已支付。</p><figure class="kb kc kd ke fq iu fe ff paragraph-image"><div role="button" tabindex="0" class="kf kg di kh bf ki"><div class="fe ff me"><img src="../Images/a38dd771926dcf05ca4e973091a53271.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-s37vYjzi-X9SIDqys0i7g.png"/></div></div><figcaption class="ix iy fg fe ff iz ja bd b be z ek">The Ether was payed out correctly!</figcaption></figure><h1 id="442f" class="kx ky ht bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu dt translated">技术堆栈</h1><p id="3906" class="pw-post-body-paragraph jc jd ht je b jf lv jh ji jj lw jl jm jn lx jp jq jr ly jt ju jv lz jx jy jz hm dt translated">为了构建Etherswaps分散式交换机；我使用了以下技术:</p><ul class=""><li id="57c8" class="kj kk ht je b jf jg jj jk jn kl jr km jv kn jz ma kp kq kr dt translated"><a class="ae jb" href="https://solidity.readthedocs.io/en/v0.5.3/" rel="noopener ugc nofollow" target="_blank"><strong class="je hu"/></a>撰写智能合同</li><li id="af0e" class="kj kk ht je b jf ks jj kt jn ku jr kv jv kw jz ma kp kq kr dt translated"><a class="ae jb" href="https://truffleframework.com/" rel="noopener ugc nofollow" target="_blank"> <strong class="je hu">松露</strong></a><a class="ae jb" href="https://truffleframework.com/ganache" rel="noopener ugc nofollow" target="_blank"><strong class="je hu">加纳切</strong></a><a class="ae jb" href="https://remix.ethereum.org/" rel="noopener ugc nofollow" target="_blank"><strong class="je hu">混合IDE </strong> </a>和<a class="ae jb" href="https://github.com/oraclize/ethereum-bridge" rel="noopener ugc nofollow" target="_blank"> <strong class="je hu"> Oraclize </strong> <strong class="je hu">以太坊-桥</strong> </a>用于本地测试和开发</li><li id="c18c" class="kj kk ht je b jf ks jj kt jn ku jr kv jv kw jz ma kp kq kr dt translated"><a class="ae jb" href="https://web3js.readthedocs.io/en/1.0/" rel="noopener ugc nofollow" target="_blank"> <strong class="je hu"> Web3Js </strong> </a>和<a class="ae jb" href="https://metamask.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="je hu"> MetaMask </strong> </a>用JavaScript与区块链交互</li><li id="b74d" class="kj kk ht je b jf ks jj kt jn ku jr kv jv kw jz ma kp kq kr dt translated"><a class="ae jb" href="https://reactjs.org/" rel="noopener ugc nofollow" target="_blank"> <strong class="je hu"> React </strong> </a>和<a class="ae jb" href="https://materializecss.com/" rel="noopener ugc nofollow" target="_blank"> <strong class="je hu">物化Css </strong> </a>为前端</li><li id="bd26" class="kj kk ht je b jf ks jj kt jn ku jr kv jv kw jz ma kp kq kr dt translated"><a class="ae jb" href="https://expressjs.com/" rel="noopener ugc nofollow" target="_blank"><strong class="je hu">Express</strong></a><a class="ae jb" href="https://www.nginx.com/" rel="noopener ugc nofollow" target="_blank"><strong class="je hu">Nginx</strong></a>和<a class="ae jb" href="https://www.mongodb.com" rel="noopener ugc nofollow" target="_blank"> <strong class="je hu"> MongoDB </strong> </a>用于服务网站和存储二级数据(不过我打算把<a class="ae jb" href="https://www.mongodb.com" rel="noopener ugc nofollow" target="_blank"> <strong class="je hu"> MongoDB </strong> </a>换成<a class="ae jb" href="https://ipfs.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="je hu"> IPFS </strong> </a></li></ul><p id="ca22" class="pw-post-body-paragraph jc jd ht je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hm dt translated">让我更深入地介绍智能合约是如何工作的，Dapp是如何与之交互的，以及存在哪些安全漏洞。</p><p id="a144" class="pw-post-body-paragraph jc jd ht je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hm dt translated"><strong class="je hu">智能合约深潜</strong></p><p id="a149" class="pw-post-body-paragraph jc jd ht je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hm dt translated">让我向您展示一个没有安全机制的<strong class="je hu">过于简化的</strong>版本的智能合约，让您对它的工作原理有一个很好的了解。你可以在这里找到完整的合同代码<a class="ae jb" href="https://github.com/markusait/ethereumSwap/blob/master/contracts/EthereumSwap.sol#L421" rel="noopener ugc nofollow" target="_blank"/>。正如我提到的，它还没有被完全审计，不应该以任何方式用于生产。</p><figure class="kb kc kd ke fq iu"><div class="bz el l di"><div class="mf mg l"/></div><figcaption class="ix iy fg fe ff iz ja bd b be z ek">Code example can not be compiled</figcaption></figure><p id="48ac" class="pw-post-body-paragraph jc jd ht je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hm dt translated">很简单，对吧？</p><p id="3547" class="pw-post-body-paragraph jc jd ht je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hm dt translated">1.Ether存储在契约中，表示要约的结构存储在Map中，以便以后可以引用(注意,<code class="eh mh mi mj mk b">_bitcoinAddress </code>变量s充当要约结构的标识符)</p><p id="f58d" class="pw-post-body-paragraph jc jd ht je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hm dt translated">2.当用户提交他的事务散列时，调用<code class="eh mh mi mj mk b">getTransaction</code>函数，事务散列又通过<code class="eh mh mi mj mk b">oraclize_query</code>函数执行Oraclize API请求。发送者地址和<code class="eh mh mi mj mk b">oraclizeID</code>与<code class="eh mh mi mj mk b">bitcoinAddress</code>值对都存储在地图中。</p><p id="c1b0" class="pw-post-body-paragraph jc jd ht je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hm dt translated">3.在幕后，Oraclize对该<a class="ae jb" href="https://blockchain.info/q/txresult/014ed2e6f875da84648fb38f5b39077f8d54466aecef371a4fe5f9f754088c46/1MfJVqRgryFvnGSQjVt3xCAhdwmcwairYQ" rel="noopener ugc nofollow" target="_blank"> Blockchain.info API端点</a>执行API请求，该端点的形式为<code class="eh mh mi mj mk b">https://blockchain.info/q/txresult/&lt;txHash&gt;/&lt;address&gt;</code>返回带有转账金额的单个字符串。Oraclize确实允许您事先执行某种形式的JSON解析，因为在Solidity中解析JSON非常昂贵。事实上，在Solidity中进行任何管柱作业都会消耗大量气体，正如您在此处<a class="ae jb" href="https://github.com/djrtwo/evm-opcode-gas-costs/blob/master/opcode-gas-costs_EIP-150_revision-1e18248_2017-04-12.csv" rel="noopener ugc nofollow" target="_blank"/>所见。Oraclize收到数据后，将其发送至<code class="eh mh mi mj mk b">__callback</code>功能。如果金额高于或等于预定义的<code class="eh mh mi mj mk b">bitcoinWithdrawAmount</code>金额，被锁定的Ether会被支付到提交交易哈希的Ethereum地址。请注意它是如何从地图中将报价结构键<code class="eh mh mi mj mk b">exists</code>设置为false来获得正确的<code class="eh mh mi mj mk b">recipientAddress </code>的，这样它就不能再次付款了。有点棘手，但完全管用！🙂</p><p id="08c6" class="pw-post-body-paragraph jc jd ht je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hm dt translated">有了这个概念，人们可以集成<strong class="je hu">任何其他货币</strong>只要有一个值得信赖的公共API来查找交易。要完全理解最后一部分以及如何整合其他货币，我们需要了解Oraclize在后台是如何工作的。</p><figure class="kb kc kd ke fq iu fe ff paragraph-image"><div class="fe ff ml"><img src="../Images/d2da16e74637034030ed1b28ca16c570.png" data-original-src="https://miro.medium.com/v2/resize:fit:728/format:webp/1*S9xL4-SLEtXfpZjUoHK0eA.png"/></div><figcaption class="ix iy fg fe ff iz ja bd b be z ek">Oraclize (<a class="ae jb" href="https://blog.oraclize.it/new-blockchain-integrations-and-beyond-e1a6d92bda85" rel="noopener ugc nofollow" target="_blank">Source</a>)</figcaption></figure><p id="8d44" class="pw-post-body-paragraph jc jd ht je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hm dt translated">从他们的网站上:</p><blockquote class="mm mn mo"><p id="447e" class="jc jd mb je b jf jg jh ji jj jk jl jm mp jo jp jq mq js jt ju mr jw jx jy jz hm dt translated">Oraclize开发的解决方案是证明从原始数据源获取的数据是真实的，没有篡改。这是通过将返回的数据与一个称为真实性证明的文档一起提供来实现的。真实性证明可以基于不同的技术，例如可审计虚拟机和可信执行环境。</p></blockquote><p id="454c" class="pw-post-body-paragraph jc jd ht je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hm dt translated">本质上，Oraclize运行一个监控特殊智能契约的节点，该契约接收对API请求的查询。当另一个智能契约使用API查询调用特定函数时，Oraclize节点会注意到它并执行API请求。创建一个真实性证明，然后他们调用您的智能合同中的<code class="eh mh mi mj mk b">__callback</code>函数，将API请求的返回结果作为输入传递给它。您可以在这个<a class="ae jb" href="http://app.oraclize.it/home/test_query" rel="noopener ugc nofollow" target="_blank">站点</a>预先测试您的Oraclize查询。</p><p id="7a7f" class="pw-post-body-paragraph jc jd ht je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hm dt translated">总而言之，Oraclize提供了一种值得信赖和可靠的方法来从外部世界获取数据。我的Github库的<a class="ae jb" href="https://github.com/markusait/ethereumSwap" rel="noopener ugc nofollow" target="_blank"> README深入介绍了如何测试它，以及如何在您的本地机器上使用Oraclize，我强烈建议您亲自尝试一下。</a></p><figure class="kb kc kd ke fq iu fe ff paragraph-image"><div class="fe ff ms"><img src="../Images/76e8623a39550011b94b809292a74dd4.png" data-original-src="https://miro.medium.com/v2/resize:fit:778/format:webp/1*Yd6TajbfF0me6U2FZoN6vw.png"/></div></figure><p id="0c35" class="pw-post-body-paragraph jc jd ht je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hm dt translated"><strong class="je hu">React和Web3上的一些文字</strong></p><p id="c6b3" class="pw-post-body-paragraph jc jd ht je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hm dt translated">我曾经用React构建客户端前端，用Express构建后端。使用JavaScript Web3库，前端能够与合同交互，允许用户使用元掩码并在交易完成后获得通知。对于测试，我推荐使用Ganache的web3提供者。我还<strong class="je hu">高度</strong>推荐经常检查你是否使用了正确版本的Web3。1.0版本中有一些突破性的变化，使用错误的版本会导致一些非常奇怪的错误。</p><p id="8336" class="pw-post-body-paragraph jc jd ht je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hm dt translated">总的来说，Web3是一个相当新的库，完全依赖它来显示智能合同数据在这一点上仍然不是很直观和粗糙。因此，我结合使用MongoDB和express API来本地存储报价数据。</p><p id="eeaf" class="pw-post-body-paragraph jc jd ht je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hm dt translated">虽然这使得它更加集中，并留下了安全漏洞，但它仍然可以很容易地被分散的<a class="ae jb" href="https://ipfs.io/" rel="noopener ugc nofollow" target="_blank"> IPFS </a>文件存储系统所取代。你可以在这里找到更多关于行星间文件系统和它如何以分散的方式存储数据<a class="ae jb" href="https://ipfs.io/" rel="noopener ugc nofollow" target="_blank">以及如何实现它</a><a class="ae jb" rel="noopener" href="https://medium.com/coinmonks/ipfs/home">这里</a>。</p><p id="aa6c" class="pw-post-body-paragraph jc jd ht je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hm dt translated"><strong class="je hu">安全注意事项</strong></p><p id="f418" class="pw-post-body-paragraph jc jd ht je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hm dt translated">当然，集中式数据存储并不是唯一的安全漏洞。除了双重支出攻击的常见问题之外，由于合同没有被完全审计，智能合同错误也可能发生。不过，我想指出三个安全方面。</p><ol class=""><li id="cf55" class="kj kk ht je b jf jg jj jk jn kl jr km jv kn jz ko kp kq kr dt translated">我留了一个后门，如果出价的原主人决定不再交换他的乙醚，我就付给他。因为这留下了一个额外的安全漏洞(如果数据更新得太晚，用户可能会试图兑换不存在的报价),所以我没有在UI中实现它，只是在智能合约代码中实现了它。</li><li id="1a67" class="kj kk ht je b jf ks jj kt jn ku jr kv jv kw jz ko kp kq kr dt translated">你们中的一些人可能已经发现了另一个安全漏洞，它基于首先创建比特币交易，然后将其提交给智能合约的异步特性。恶意方可能会等待比特币地址的交易，并通过首先提交交易哈希来在您之前申请以太网。为了解决这个问题，用户必须在交易元数据中写下他的以太坊地址(l<a class="ae jb" href="https://chain.so/tx/BTC/6dfb16dd580698242bcfd8e433d557ed8c642272a368894de27292a8844a4e75" rel="noopener ugc nofollow" target="_blank">ike that</a>)，这样智能合约就可以验证正确的地址是否试图要求以太。这也在智能契约中实现了，但是为了保持简单，还没有在UI中实现。</li><li id="b93c" class="kj kk ht je b jf ks jj kt jn ku jr kv jv kw jz ko kp kq kr dt translated">出于测试目的，我留下的另一个安全漏洞是注释掉下面一行:</li></ol><figure class="kb kc kd ke fq iu fe ff paragraph-image"><div role="button" tabindex="0" class="kf kg di kh bf ki"><div class="fe ff mt"><img src="../Images/ef8a625d6fa9742faa6c97fdcc053632.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Qdcm3Fz9JyQLhY0re50J4w.png"/></div></div><figcaption class="ix iy fg fe ff iz ja bd b be z ek">All offers are stored in the deposit map</figcaption></figure><p id="b9eb" class="pw-post-body-paragraph jc jd ht je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hm dt translated">这允许所有用户使用相同的地址创建多个报价。</p><p id="31f9" class="pw-post-body-paragraph jc jd ht je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hm dt translated">最后，要提到的另一个重要方面是，块浏览器数据可能不准确，或者服务器可能停机。虽然不可用的服务器不是问题，因为事务哈希可以稍后提交，但是块浏览器服务仍然需要很大的信任，这就引出了我的最后一个主题:</p><p id="4b7b" class="pw-post-body-paragraph jc jd ht je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hm dt translated"><strong class="je hu">你需要信任的人</strong></p><p id="131b" class="pw-post-body-paragraph jc jd ht je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hm dt translated">与任何金融服务一样，在与它交互时，仍然需要信任。事实上，任何使用以太网交换的人都必须信任4方:</p><p id="f89a" class="pw-post-body-paragraph jc jd ht je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hm dt translated">1.请更改服务以正确显示数据。然而，他们在公开验证方面做得很好。你可以在这里找到更多关于它的<a class="ae jb" href="http://(https://ethereum.stackexchange.com/questions/2/how-can-an-ethereum-contract-get-data-from-a-website/2336#2336" rel="noopener ugc nofollow" target="_blank"/></p><p id="d02f" class="pw-post-body-paragraph jc jd ht je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hm dt translated">2.Block Explorer API，合同目前使用的是<a class="ae jb" href="https://blockchain.info/" rel="noopener ugc nofollow" target="_blank"> Blockchain.info </a>和官方的<a class="ae jb" href="https://horizon.stellar.org/" rel="noopener ugc nofollow" target="_blank"> Horizon Stellar API </a>，其他大型交易所也依赖这些API</p><p id="f578" class="pw-post-body-paragraph jc jd ht je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hm dt translated">3.智能合约本身。请注意，它没有经过安全审核，不应用于生产</p><p id="bf6c" class="pw-post-body-paragraph jc jd ht je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hm dt translated">4.运行网站的服务器，以正确显示数据。然而，任何人都可以自己主持。</p><h1 id="7c94" class="kx ky ht bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu dt translated"><strong class="ak">结论</strong></h1><p id="d821" class="pw-post-body-paragraph jc jd ht je b jf lv jh ji jj lw jl jm jn lx jp jq jr ly jt ju jv lz jx jy jz hm dt translated">正如你所看到的，这种分散的交换并不是没有信任的。人们仍然必须相信不同的党派。然而，它有效地降低了中间人和交易成本，同时提供了一种简单而廉价的方式来交换区块链上的代币。通过智能合约异步进行验证，它比任何主要的交易所都更加分散，甚至比其他分散的交易所更加分散。交换硬币不需要注册或监管，任何人都可以提供这项服务，这不是很棒吗？</p><p id="f5f2" class="pw-post-body-paragraph jc jd ht je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hm dt translated">最后，我想提一下，这个项目对我来说是一次很好的学习经历，我想对Oraclize大呼一声，他们在他们的<a class="ae jb" href="https://gitter.im/oraclize/" rel="noopener ugc nofollow" target="_blank"> Gitter </a>频道回答了各种问题，真的很有帮助。请注意，我是<strong class="je hu">而不是</strong>与Oraclize有任何形式的关联，以上观点仅代表我个人。</p><blockquote class="mu"><p id="6ec5" class="mv mw ht bd mx my mz na nb nc nd jz ek translated">加入Coinmonks <a class="ae jb" href="https://t.me/coincodecap" rel="noopener ugc nofollow" target="_blank">电报频道</a>和<a class="ae jb" href="https://www.youtube.com/c/coinmonks/videos" rel="noopener ugc nofollow" target="_blank"> Youtube频道</a>获取每日<a class="ae jb" href="http://coincodecap.com/" rel="noopener ugc nofollow" target="_blank">加密新闻</a></p></blockquote><h2 id="15d6" class="ne ky ht bd kz nf ng nh ld ni nj nk lh jn nl nm ll jr nn no lp jv np nq lt nr dt translated">另外，阅读</h2><ul class=""><li id="20fb" class="kj kk ht je b jf lv jj lw jn ns jr nt jv nu jz ma kp kq kr dt translated"><a class="ae jb" rel="noopener" href="/coinmonks/top-10-crypto-copy-trading-platforms-for-beginners-d0c37c7d698c">复制交易</a> | <a class="ae jb" rel="noopener" href="/coinmonks/crypto-tax-software-ed4b4810e338">加密税务软件</a></li><li id="723e" class="kj kk ht je b jf ks jj kt jn ku jr kv jv kw jz ma kp kq kr dt translated"><a class="ae jb" href="https://coincodecap.com/grid-trading" rel="noopener ugc nofollow" target="_blank">网格交易</a> | <a class="ae jb" rel="noopener" href="/coinmonks/the-best-cryptocurrency-hardware-wallets-of-2020-e28b1c124069">加密硬件钱包</a></li><li id="874f" class="kj kk ht je b jf ks jj kt jn ku jr kv jv kw jz ma kp kq kr dt translated"><a class="ae jb" href="http://Top 4 Telegram Channels for Crypto Traders" rel="noopener ugc nofollow" target="_blank">密码电报信号</a> | <a class="ae jb" rel="noopener" href="/coinmonks/crypto-trading-bot-c2ffce8acb2a">密码交易机器人</a></li><li id="f33b" class="kj kk ht je b jf ks jj kt jn ku jr kv jv kw jz ma kp kq kr dt translated"><a class="ae jb" rel="noopener" href="/coinmonks/crypto-exchange-dd2f9d6f3769">最佳加密交易所</a> | <a class="ae jb" rel="noopener" href="/coinmonks/bitcoin-exchange-in-india-7f1fe79715c9">印度最佳加密交易所</a></li><li id="6065" class="kj kk ht je b jf ks jj kt jn ku jr kv jv kw jz ma kp kq kr dt translated"><a class="ae jb" href="https://coincodecap.com/binance-vs-bitstamp" rel="noopener ugc nofollow" target="_blank">币安vs比特邮票</a> | <a class="ae jb" href="https://coincodecap.com/bitpanda-coinbase-coinsbit" rel="noopener ugc nofollow" target="_blank">比特熊猫vs比特币基地vs Coinsbit </a></li><li id="5711" class="kj kk ht je b jf ks jj kt jn ku jr kv jv kw jz ma kp kq kr dt translated"><a class="ae jb" href="https://coincodecap.com/buy-ripple-india" rel="noopener ugc nofollow" target="_blank">如何购买Ripple (XRP) </a> | <a class="ae jb" href="https://coincodecap.com/crypto-exchange-africa" rel="noopener ugc nofollow" target="_blank">非洲最好的加密交易所</a></li><li id="861b" class="kj kk ht je b jf ks jj kt jn ku jr kv jv kw jz ma kp kq kr dt translated"><a class="ae jb" href="https://coincodecap.com/crypto-exchange-africa" rel="noopener ugc nofollow" target="_blank">非洲最佳密码交易所</a> | <a class="ae jb" href="https://coincodecap.com/hoo-exchange-review" rel="noopener ugc nofollow" target="_blank">胡交易所评论</a></li><li id="452c" class="kj kk ht je b jf ks jj kt jn ku jr kv jv kw jz ma kp kq kr dt translated"><a class="ae jb" href="https://coincodecap.com/etoro-robinhood" rel="noopener ugc nofollow" target="_blank">eToro vs robin hood</a>|<a class="ae jb" href="https://coincodecap.com/bybit-bityard-moonxbt" rel="noopener ugc nofollow" target="_blank">MoonXBT vs Bybit vs Bityard</a></li><li id="47a8" class="kj kk ht je b jf ks jj kt jn ku jr kv jv kw jz ma kp kq kr dt translated"><a class="ae jb" rel="noopener" href="/coinmonks/best-crypto-apis-for-developers-5efe3a597a9f">面向开发人员的最佳加密API</a></li><li id="b359" class="kj kk ht je b jf ks jj kt jn ku jr kv jv kw jz ma kp kq kr dt translated">最佳<a class="ae jb" rel="noopener" href="/coinmonks/top-5-crypto-lending-platforms-in-2020-that-you-need-to-know-a1b675cec3fa">密码借贷平台</a></li><li id="3c98" class="kj kk ht je b jf ks jj kt jn ku jr kv jv kw jz ma kp kq kr dt translated"><a class="ae jb" rel="noopener" href="/coinmonks/free-crypto-signals-48b25e61a8da">免费加密信号</a> | <a class="ae jb" rel="noopener" href="/coinmonks/crypto-trading-bot-c2ffce8acb2a">加密交易机器人</a></li><li id="9487" class="kj kk ht je b jf ks jj kt jn ku jr kv jv kw jz ma kp kq kr dt translated">杠杆代币的终极指南</li></ul></div></div>    
</body>
</html>