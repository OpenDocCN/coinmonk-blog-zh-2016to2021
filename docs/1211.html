<html>
<head>
<title>Downloading historical data from Coinmarketcap</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">从Coinmarketcap下载历史数据</h1>
<blockquote>原文：<a href="https://medium.com/coinmonks/downloading-historical-data-from-coinmarketcap-41a2b0111baf?source=collection_archive---------1-----------------------#2018-08-02">https://medium.com/coinmonks/downloading-historical-data-from-coinmarketcap-41a2b0111baf?source=collection_archive---------1-----------------------#2018-08-02</a></blockquote><div><div class="ef hh hi hj hk hl"/><div class="hm hn ho hp hq"><div class=""/><figure class="fi fk ir is it iu fe ff paragraph-image"><div class="fe ff iq"><img src="../Images/c082fbe46a7f94b07f89ddd1472e50c8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1392/format:webp/1*hEdB5U1keV8rxPSDnn38Zw.jpeg"/></div></figure><p id="c836" class="pw-post-body-paragraph ix iy ht iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju hm dt translated">Coinmarketcap 是价格和数据加密的绝佳资源。尽管<a class="ae jv" href="https://www.reddit.com/r/Bitcoin/comments/691za4/serious_flaws_with_coinmarketcapcom_more_reasons/" rel="noopener ugc nofollow" target="_blank">有缺陷</a>，但它仍然是一个非常受欢迎的查询cryto价格的网站，我发现自己出于习惯每天都会回到那里，尽管有其他令人信服的、可以说是更好的选择，如<a class="ae jv" href="https://onchainfx.com" rel="noopener ugc nofollow" target="_blank"> onchainfx </a>。习惯需要努力去改变，coinmarketcap是包括我在内的许多人的习惯，只要这个网站保持“足够好”，这个习惯就很难打破。</p><p id="8517" class="pw-post-body-paragraph ix iy ht iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju hm dt translated">我最近发现自己想要下载cryto的历史数据，以便进行一些数据分析。尽管他们有一个公共API，但似乎没有下载任何历史数据的功能。还有一个通知，这个API将于2018年12月下线，由一个<a class="ae jv" href="https://pro.coinmarketcap.com" rel="noopener ugc nofollow" target="_blank">专业API </a>替代。专业API将允许下载历史数据，但访问12个月的历史数据需要每月699美元的高昂价格，并且访问长达5年的历史数据需要“询价”。</p><p id="6bc7" class="pw-post-body-paragraph ix iy ht iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju hm dt translated">这似乎有点陡峭，我发现自己有点震惊，因为加密是所有关于消除或减少中间人和寻租活动。像价格数据这样基本的东西当然应该是免费的。传统金融系统经常对价格数据收取疯狂的费用，加密生态系统肯定可以做得更好。</p><p id="f594" class="pw-post-body-paragraph ix iy ht iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju hm dt translated">我决定构建一个脚本来自己下载数据，但幸运的是，我决定先看看管理网站的使用条款。实话实说，谁会这么做。就在那里。你不允许从网站上抓取或复制任何数据。对我来说，这似乎又是非常反加密的。想象一下一个公开的区块链有这样的条款。</p><pre class="jw jx jy jz fq ka kb kc kd aw ke dt"><span id="88cb" class="kf kg ht kb b fv kh ki l kj kk">(extract from the <a class="ae jv" href="https://coinmarketcap.com/terms/" rel="noopener ugc nofollow" target="_blank">Terms of Use</a>)</span><span id="d256" class="kf kg ht kb b fv kl ki l kj kk"><strong class="kb hu">Prohibited Activities</strong></span><span id="e989" class="kf kg ht kb b fv kl ki l kj kk">You agree that you will not:</span><span id="c074" class="kf kg ht kb b fv kl ki l kj kk">Use or introduce to the Service any data mining, crawling, “scraping”, robot or similar automated or data gathering or extraction method, or manually access, acquire, monitor or copy any portion of the Service, or download or store Content (unless expressly authorized by CMC). Certain data and other information within the Service is available by subscription, or for a fee, at <a class="ae jv" href="https://pro.coinmarketcap.com/" rel="noopener ugc nofollow" target="_blank">https://pro.coinmarketcap.com</a>;</span></pre><p id="00b1" class="pw-post-body-paragraph ix iy ht iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju hm dt translated">鉴于上述情况，这篇文章现在纯粹是假设性的。如果允许，我将如何从coinmarket cap下载数据。严格地说，这是我在Python中的做法。</p><p id="b348" class="pw-post-body-paragraph ix iy ht iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju hm dt translated">首先，我会导入BeautifulSoup和其他一些方便的包。</p><pre class="jw jx jy jz fq ka kb kc kd aw ke dt"><span id="b2a4" class="kf kg ht kb b fv kh ki l kj kk">from bs4 import BeautifulSoup<br/>import requests<br/>import pandas as pd</span></pre><p id="ca28" class="pw-post-body-paragraph ix iy ht iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju hm dt translated">然后我会获取相关的页面并找到包含所有数据的表</p><pre class="jw jx jy jz fq ka kb kc kd aw ke dt"><span id="cd2a" class="kf kg ht kb b fv kh ki l kj kk">url = "<a class="ae jv" href="https://coinmarketcap.com/currencies/ripple/historical-data/?start=20130428&amp;end=20180802" rel="noopener ugc nofollow" target="_blank">https://coinmarketcap.com/currencies/ripple/historical-data/?start=20130428&amp;end=20180802</a>"<br/>content = requests.get(url).content<br/>soup = BeautifulSoup(content,'html.parser')<br/>table = soup.find('table', {'class': 'table'})</span></pre><p id="bfca" class="pw-post-body-paragraph ix iy ht iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju hm dt translated">然后使用嵌套列表理解来遍历表格行和单元格，用数据建立一个列表列表。</p><pre class="jw jx jy jz fq ka kb kc kd aw ke dt"><span id="7113" class="kf kg ht kb b fv kh ki l kj kk">data = [[td.text.strip() for td in tr.findChildren('td')] <br/>        for tr in table.findChildren('tr')]</span></pre><p id="aa6d" class="pw-post-body-paragraph ix iy ht iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju hm dt translated">最后，将列表转换为数据帧，并做一些清理工作，比如将文本日期转换为真实日期、删除空行、命名列、设置索引和排序。</p><pre class="jw jx jy jz fq ka kb kc kd aw ke dt"><span id="cc0a" class="kf kg ht kb b fv kh ki l kj kk">df = pd.DataFrame(data)<br/>df.drop(df.index[0], inplace=True) # first row is empty<br/>df[0] =  pd.to_datetime(df[0]) # date<br/>for i in range(1,7):<br/>    df[i] = pd.to_numeric(df[i].str.replace(",","").str.replace("-","")) # some vol is missing and has -<br/>df.columns = ['Date','Open','High','Low','Close','Volume','Market Cap']<br/>df.set_index('Date',inplace=True)<br/>df.sort_index(inplace=True)</span></pre><p id="33c5" class="pw-post-body-paragraph ix iy ht iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju hm dt translated">仅此而已。Python确实让生活充满乐趣。现在如果我们被允许这样做就好了。如果你知道一个很好的替代获取历史数据的方法，请在回复中发表一些东西。Quandl有一些数据，但没有很多硬币的数据，他们的一些数据有错误(例如，BCH分叉后的coinbase数据变得一塌糊涂)。</p><p id="5f0d" class="pw-post-body-paragraph ix iy ht iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju hm dt translated">如果你喜欢这篇文章或者得到了什么好处，请在下面鼓掌，这样其他人也能发现它。</p><blockquote class="km"><p id="0b27" class="kn ko ht bd kp kq kr ks kt ku kv ju ek translated">加入Coinmonks <a class="ae jv" href="https://t.me/coincodecap" rel="noopener ugc nofollow" target="_blank">电报频道</a>和<a class="ae jv" href="https://www.youtube.com/c/coinmonks/videos" rel="noopener ugc nofollow" target="_blank"> Youtube频道</a>获取每日<a class="ae jv" href="http://coincodecap.com/" rel="noopener ugc nofollow" target="_blank">加密新闻</a></p></blockquote><h2 id="15d6" class="kf kg ht bd kw kx ky kz la lb lc ld le ji lf lg lh jm li lj lk jq ll lm ln lo dt translated">另外，阅读</h2><ul class=""><li id="20fb" class="lp lq ht iz b ja lr je ls ji lt jm lu jq lv ju lw lx ly lz dt translated"><a class="ae jv" rel="noopener" href="/coinmonks/top-10-crypto-copy-trading-platforms-for-beginners-d0c37c7d698c">复制交易</a> | <a class="ae jv" rel="noopener" href="/coinmonks/crypto-tax-software-ed4b4810e338">加密税务软件</a></li><li id="723e" class="lp lq ht iz b ja ma je mb ji mc jm md jq me ju lw lx ly lz dt translated"><a class="ae jv" href="https://coincodecap.com/grid-trading" rel="noopener ugc nofollow" target="_blank">网格交易</a> | <a class="ae jv" rel="noopener" href="/coinmonks/the-best-cryptocurrency-hardware-wallets-of-2020-e28b1c124069">加密硬件钱包</a></li><li id="874f" class="lp lq ht iz b ja ma je mb ji mc jm md jq me ju lw lx ly lz dt translated"><a class="ae jv" href="http://Top 4 Telegram Channels for Crypto Traders" rel="noopener ugc nofollow" target="_blank">密码电报信号</a> | <a class="ae jv" rel="noopener" href="/coinmonks/crypto-trading-bot-c2ffce8acb2a">密码交易机器人</a></li><li id="f33b" class="lp lq ht iz b ja ma je mb ji mc jm md jq me ju lw lx ly lz dt translated"><a class="ae jv" rel="noopener" href="/coinmonks/crypto-exchange-dd2f9d6f3769">最佳加密交易所</a> | <a class="ae jv" rel="noopener" href="/coinmonks/bitcoin-exchange-in-india-7f1fe79715c9">最佳加密交易所</a></li><li id="47a8" class="lp lq ht iz b ja ma je mb ji mc jm md jq me ju lw lx ly lz dt translated">开发人员的最佳加密API</li><li id="b359" class="lp lq ht iz b ja ma je mb ji mc jm md jq me ju lw lx ly lz dt translated">最佳<a class="ae jv" rel="noopener" href="/coinmonks/top-5-crypto-lending-platforms-in-2020-that-you-need-to-know-a1b675cec3fa">密码借贷平台</a></li><li id="9487" class="lp lq ht iz b ja ma je mb ji mc jm md jq me ju lw lx ly lz dt translated">杠杆代币的终极指南</li><li id="3310" class="lp lq ht iz b ja ma je mb ji mc jm md jq me ju lw lx ly lz dt translated"><a class="ae jv" href="https://coincodecap.com/ascendex-staking" rel="noopener ugc nofollow" target="_blank">AscendEx Staking</a>|<a class="ae jv" href="https://coincodecap.com/bot-ocean-review" rel="noopener ugc nofollow" target="_blank">Bot Ocean Review</a>|<a class="ae jv" href="https://coincodecap.com/bitcoin-wallets-india" rel="noopener ugc nofollow" target="_blank">最佳比特币钱包</a></li><li id="15e5" class="lp lq ht iz b ja ma je mb ji mc jm md jq me ju lw lx ly lz dt translated"><a class="ae jv" href="https://coincodecap.com/bitget-review" rel="noopener ugc nofollow" target="_blank"> Bitget回顾</a> | <a class="ae jv" href="https://coincodecap.com/gemini-vs-blockfi" rel="noopener ugc nofollow" target="_blank">双子vs区块链</a> | <a class="ae jv" href="https://coincodecap.com/okex-futures-trading" rel="noopener ugc nofollow" target="_blank"> OKEx期货交易</a></li><li id="c009" class="lp lq ht iz b ja ma je mb ji mc jm md jq me ju lw lx ly lz dt translated"><a class="ae jv" href="https://coincodecap.com/crypto-trading-bots-in-the-us" rel="noopener ugc nofollow" target="_blank">美国最佳加密交易机器人</a> | <a class="ae jv" href="https://coincodecap.com/changelly-review" rel="noopener ugc nofollow" target="_blank">经常性回顾</a></li><li id="7716" class="lp lq ht iz b ja ma je mb ji mc jm md jq me ju lw lx ly lz dt translated"><a class="ae jv" href="https://coincodecap.com/crypto-arbitrage-in-india" rel="noopener ugc nofollow" target="_blank">在印度利用加密套利赚取被动收入</a></li><li id="92d8" class="lp lq ht iz b ja ma je mb ji mc jm md jq me ju lw lx ly lz dt translated"><a class="ae jv" href="https://coincodecap.com/huobi-review" rel="noopener ugc nofollow" target="_blank">霍比审核</a> | <a class="ae jv" href="https://coincodecap.com/okex-margin-trading" rel="noopener ugc nofollow" target="_blank"> OKEx保证金交易</a> | <a class="ae jv" href="https://coincodecap.com/futures-trading" rel="noopener ugc nofollow" target="_blank">期货交易</a></li><li id="d179" class="lp lq ht iz b ja ma je mb ji mc jm md jq me ju lw lx ly lz dt translated"><a class="ae jv" href="https://coincodecap.com/sparrow-exchange-review" rel="noopener ugc nofollow" target="_blank">麻雀交换评论</a> | <a class="ae jv" href="https://coincodecap.com/nash-exchange-review" rel="noopener ugc nofollow" target="_blank">纳什交换评论</a></li></ul></div></div>    
</body>
</html>