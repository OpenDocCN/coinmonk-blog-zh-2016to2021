<html>
<head>
<title>How to create an Ichimoku trading bot using Python (Part 2: Building The Bot)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何使用Python创建Ichimoku交易机器人(第2部分:构建机器人)</h1>
<blockquote>原文：<a href="https://medium.com/coinmonks/how-to-create-an-ichimoku-trading-bot-using-python-part-2-building-the-bot-9662db31c5ff?source=collection_archive---------2-----------------------#2021-07-29">https://medium.com/coinmonks/how-to-create-an-ichimoku-trading-bot-using-python-part-2-building-the-bot-9662db31c5ff?source=collection_archive---------2-----------------------#2021-07-29</a></blockquote><div><div class="ef hh hi hj hk hl"/><div class="hm hn ho hp hq"><div class=""/><figure class="fi fk ir is it iu fe ff paragraph-image"><div role="button" tabindex="0" class="iv iw di ix bf iy"><div class="fe ff iq"><img src="../Images/07eba7a13a2e0bdb3ceee1e01e0e21f9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*7jls6a7PjMwCRc8h"/></div></div><figcaption class="jb jc fg fe ff jd je bd b be z ek">Photo by <a class="ae jf" href="https://unsplash.com/@clemhlrdt?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Clément Hélardot</a> on <a class="ae jf" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="c17e" class="pw-post-body-paragraph jg jh ht ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated">你可以在这里阅读<a class="ae jf" rel="noopener" href="/coinmonks/how-to-create-an-ichimoku-trading-bot-on-python-part-1-the-strategy-b144f79960f8"><strong class="ji hu"><em class="ke">Part 1</em></strong></a>。</p><p id="a31d" class="pw-post-body-paragraph jg jh ht ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated">现在让我们开始使用python构建Ichimoku交易机器人。</p><p id="90d4" class="pw-post-body-paragraph jg jh ht ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated">首先，我想将必要的信息存储到字典中。此外，我需要从yahoo finance获取大约80天的股票数据，只需将股票代码输入该函数即可(我使用的是yahoo finance API btw)。因此，下面是定义的函数:</p><pre class="kf kg kh ki fq kj kk kl km aw kn dt"><span id="1cb0" class="ko kp ht kk b fv kq kr l ks kt">def stock(a,b,c,d,e,f):<br/>    x = {"exchange":a,"ticker":b,"price":c,"atr":d,"sma_vol30":e,"current_vol":f}<br/>    return x</span><span id="c5a1" class="ko kp ht kk b fv ku kr l ks kt">def getinfo(x):<br/>    symbol=x<br/>    state=yf.Ticker(symbol).history(period="max")<br/>    state = state[len(state)-80:len(state)]<br/>    Data=state.loc[:,['Open','High','Low','Close']]<br/>    Data=Data.iloc[::-1]<br/>    return Data</span></pre><p id="6d0f" class="pw-post-body-paragraph jg jh ht ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated">接下来，我必须计算所有必要的值，我编写了一个函数，它接受来自交易所的所有报价机列表的输入(在这种情况下，报价机列表定义为s)。然后我创建一个空的购买列表来存储所有满足条件的tickers字典。接下来，我将每个股票代码传递到循环 的<strong class="ji hu"> <em class="ke">中，然后循环</em></strong>计算必要的指标(转换、基数、span A、span B)，然后检查股票是否满足给定的要求(这是使用<strong class="ji hu"> <em class="ke"> if-else语句</em> </strong>完成的)。如果股票符合Ichimoku策略中提出的所有指定条件，股票信息将作为字典存储到买入列表中。</p><figure class="kf kg kh ki fq iu"><div class="bz el l di"><div class="kv kw l"/></div></figure><p id="9708" class="pw-post-body-paragraph jg jh ht ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated">随后我写了一个函数来决定我应该为前面的ichimoku_analyser函数挑选的股票购买多少股票。计算方法很简单，就是用分配给每只股票的金额除以股价。</p><pre class="kf kg kh ki fq kj kk kl km aw kn dt"><span id="89cb" class="ko kp ht kk b fv kq kr l ks kt">def weightage(price,max_per_stock):<br/>     weight=[math.floor(num)for num in list(max_per_stock/price)]<br/>     return weight</span></pre><p id="3d82" class="pw-post-body-paragraph jg jh ht ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated">现在我们已经完成了所有的功能，我们只需读取tickers列表并执行所有的功能。然后，我将所有相关信息整理成一个数据框架(包括买入日期和20%止损)。数据框架是根据股票的相对交易量排列的，因此我可以很容易地对交易更活跃的股票进行优先排序。我还过滤了最近一天内涨幅较大的股票，因为这可能会产生错误信号。这是因为云是由大量一次性增加而不是上升趋势造成的。</p><figure class="kf kg kh ki fq iu"><div class="bz el l di"><div class="kv kw l"/></div></figure><p id="67c4" class="pw-post-body-paragraph jg jh ht ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated">然后，我将生成的数据帧附加到一个名为portfolio.csv的csv文件中</p><pre class="kf kg kh ki fq kj kk kl km aw kn dt"><span id="7f07" class="ko kp ht kk b fv kq kr l ks kt">df.to_csv(‘portfolio.csv’,mode=’a’, index=False)</span></pre><p id="2862" class="pw-post-body-paragraph jg jh ht ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated">最后，我设计了一个函数来读取portfolio.csv文件，并识别那些有卖出信号或止损的股票。然后，我将所有这些待出售股票的相关信息放入另一个数据框中。</p><figure class="kf kg kh ki fq iu"><div class="bz el l di"><div class="kv kw l"/></div></figure><p id="f2de" class="pw-post-body-paragraph jg jh ht ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated">当更新portfolio.csv文件以删除要出售的股票时，具有要出售的股票的所有信息的数据帧(sell_df)被附加到sell_list.csv。</p><pre class="kf kg kh ki fq kj kk kl km aw kn dt"><span id="5d3e" class="ko kp ht kk b fv kq kr l ks kt">df_port.to_csv(‘portfolio.csv’,mode=’w’, index=True)<br/>sell_df.to_csv(‘sell_list.csv’,mode=’a’, index=False)</span></pre><p id="8540" class="pw-post-body-paragraph jg jh ht ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated">我们完了。现在，您已经创建了一个ichimoku云交易机器人，它根据我们之前的ichimoku策略中设定的条件来分析股票。</p><blockquote class="kx"><p id="31b8" class="ky kz ht bd la lb lc ld le lf lg kd ek translated">加入<a class="ae jf" href="https://t.me/coincodecap" rel="noopener ugc nofollow" target="_blank"> Coinmonks电报频道</a>，了解加密交易和投资</p></blockquote><h2 id="f35c" class="ko kp ht bd lh li lj lk ll lm ln lo lp jr lq lr ls jv lt lu lv jz lw lx ly lz dt translated">另外，阅读</h2><div class="ma mb fm fo mc md"><a href="https://blog.coincodecap.com/crypto-exchange" rel="noopener  ugc nofollow" target="_blank"><div class="me ab ej"><div class="mf ab mg cl cj mh"><h2 class="bd hu fv z el mi eo ep mj er et hs dt translated">最佳加密交易所| 2021年十大加密货币交易所</h2><div class="mk l"><h3 class="bd b fv z el mi eo ep mj er et ek translated">加密货币交易所的加密交易需要了解市场，这可以帮助你获得利润…</h3></div><div class="ml l"><p class="bd b gc z el mi eo ep mj er et ek translated">blog.coincodecap.com</p></div></div><div class="mm l"><div class="mn l mo mp mq mm mr iz md"/></div></div></a></div></div></div>    
</body>
</html>