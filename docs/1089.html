<html>
<head>
<title>Integrating physical devices with IOTA — Adding a user interface</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">将物理设备与IOTA集成—添加用户界面</h1>
<blockquote>原文：<a href="https://medium.com/coinmonks/integrating-physical-devices-with-iota-adding-a-user-interface-2fb028a8fee1?source=collection_archive---------7-----------------------#2018-07-19">https://medium.com/coinmonks/integrating-physical-devices-with-iota-adding-a-user-interface-2fb028a8fee1?source=collection_archive---------7-----------------------#2018-07-19</a></blockquote><div><div class="ef hh hi hj hk hl"/><div class="hm hn ho hp hq"><div class=""/><div class=""><h2 id="b7de" class="pw-subtitle-paragraph iq hs ht bd b ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ek translated">关于将物理设备与IOTA协议集成的初学者教程系列的第三部分。</h2></div><figure class="jj jk jl jm fq jn fe ff paragraph-image"><div role="button" tabindex="0" class="jo jp di jq bf jr"><div class="fe ff ji"><img src="../Images/5324d65d4b1b2f7f9d4ed58f5504372f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xucMv3pEzQuQRWsCjJ3X-Q.jpeg"/></div></div><figcaption class="ju jv fg fe ff jw jx bd b be z ek">IOTA user interface</figcaption></figure><h1 id="cde2" class="jy jz ht bd ka kb kc kd ke kf kg kh ki iz kj ja kk jc kl jd km jf kn jg ko kp dt translated">介绍</h1><p id="266b" class="pw-post-body-paragraph kq kr ht ks b kt ku iu kv kw kx ix ky kz la lb lc ld le lf lg lh li lj lk ll hm dt translated">这是关于将物理设备与IOTA协议集成的初学者教程系列的第三部分。在本教程中，我们将使用液晶显示器(LCD)为我们的IOTA支付系统提供一个简单的图形用户界面(GUI)。</p><p id="a3cf" class="pw-post-body-paragraph kq kr ht ks b kt lm iu kv kw ln ix ky kz lo lb lc ld lp lf lg lh lq lj lk ll hm dt translated">如果您还没有阅读本系列的第一篇教程,您应该在继续之前阅读它，因为它构成了我们在本教程中构建的项目的基础。</p></div><div class="ab cl ls lt hb lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="hm hn ho hp hq"><h1 id="a188" class="jy jz ht bd ka kb lz kd ke kf ma kh ki iz mb ja kk jc mc jd km jf md jg ko kp dt translated">使用案例</h1><p id="7acd" class="pw-post-body-paragraph kq kr ht ks b kt ku iu kv kw kx ix ky kz la lb lc ld le lf lg lh li lj lk ll hm dt translated">现在，我们已经按照<a class="ae lr" rel="noopener" href="/@hugogregersen/integrating-physical-devices-with-iota-83f4e00cc5bb">第一篇教程</a>中的描述启动并运行了新的IOTA驱动的冰箱支付系统，我们应该后退一步，看看可以对我们的系统进行哪些改进。如果我们从用户(旅馆客人)的角度来看，一个突出的问题是没有指示器告诉他冰箱服务的当前状态，因此没有指示他是否或何时需要增加额外的资金以防他想要延长服务。我们也有一些关于印刷二维码的问题。在酒店所有者想要改变一个或多个冰箱的IOTA支付地址的情况下，他将不得不物理地替换其酒店中每个冰箱的印刷QR码。与印刷二维码相关的另一个问题是，理论上一个坏演员可以用假二维码替换官方印刷的二维码，将任何未来的冰箱付款发送到错误的地址。我们还有一个关于管理冰箱服务价格的问题。酒店所有者如何能够相对于易变的市场价格显示他的冰箱服务的最新价格？这些问题的合理解决方案是为游客提供某种类型的动态用户界面，在该界面上，游客可以与系统进行交互并从系统获取实时信息。在本教程中，我们将在我们的项目中添加一个简单的LCD显示器来提供这样一个界面。</p><p id="c54d" class="pw-post-body-paragraph kq kr ht ks b kt lm iu kv kw ln ix ky kz lo lb lc ld lp lf lg lh lq lj lk ll hm dt translated"><em class="me">注意！<br/>使用LCD动态显示我们的QR码可以解决另一个与重复使用IOTA地址相关的问题，也称为Winternitz一次性签名</em>方案<em class="me">。这是一种赋予IOTA量子电阻特性的保护机制。只要旅馆老板不从他的冰箱地址花费任何资金，它们就是完全安全的，然而，一旦他从其中一个地址花费任何资金，该地址就不再安全，并且必须被新的IOTA支付地址替换。一个更好的选择可能是为每笔付款自动生成一个新的地址(和QR码),这样我们就可以一起忽略这个问题。这就是我们的液晶显示器派上用场的地方。我将把自动生成IOTA地址的主题留到以后的教程中。现在，让我们只关注在LCD上显示我们的静态QR码。</em></p></div><div class="ab cl ls lt hb lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="hm hn ho hp hq"><h1 id="7654" class="jy jz ht bd ka kb lz kd ke kf ma kh ki iz mb ja kk jc mc jd km jf md jg ko kp dt translated">成分</h1><p id="c995" class="pw-post-body-paragraph kq kr ht ks b kt ku iu kv kw kx ix ky kz la lb lc ld le lf lg lh li lj lk ll hm dt translated">我不会在本教程中讨论项目的基本组件(除了LCD)和布线，因为它可以被视为本系列第一篇教程的附加内容。</p><p id="25f3" class="pw-post-body-paragraph kq kr ht ks b kt lm iu kv kw ln ix ky kz lo lb lc ld lp lf lg lh lq lj lk ll hm dt translated"><strong class="ks hu">LCD</strong><br/>市场上有大量不同的兼容Raspberry PI的LCD。根据型号和大小，你通常可以从易趣或亚马逊上以15美元或更高的价格买到它们。在我的例子中，我使用的是这个3.5英寸的TFT LCD触摸屏，它可以直接连接到我的Raspberry PI的GIO引脚上。如果您希望将LCD与PI分开放置，或者需要方便地使用PI的附加GIO引脚，您可能需要额外的电缆来连接LCD。我不会详细介绍如何连接和安装LCD的驱动程序，因为这取决于类型和型号。对于这些信息，我建议您查阅您的特定模型的文档。</p><figure class="jj jk jl jm fq jn fe ff paragraph-image"><div class="fe ff mf"><img src="../Images/7175c1a190e97478005eaea2fab6f336.png" data-original-src="https://miro.medium.com/v2/resize:fit:476/format:webp/1*a_LgdwxyUeqkuL47F8-tig.png"/></div><figcaption class="ju jv fg fe ff jw jx bd b be z ek">3.5" TFT LCD touch display</figcaption></figure><h1 id="ca70" class="jy jz ht bd ka kb kc kd ke kf kg kh ki iz kj ja kk jc kl jd km jf kn jg ko kp dt translated">图形用户界面</h1><p id="2dde" class="pw-post-body-paragraph kq kr ht ks b kt ku iu kv kw kx ix ky kz la lb lc ld le lf lg lh li lj lk ll hm dt translated">接下来，让我们看看GUI本身以及它是如何构建的。在我的例子中，我使用流行的<a class="ae lr" href="https://wiki.python.org/moin/TkInter" rel="noopener ugc nofollow" target="_blank"> TkInter </a>工具包创建GUI。还有其他的工具包可以用来用Python创建GUI，但是TkInter是最常用的。TkInter的另一个优点是它已经包含在Python中了。有很多关于使用TkInter的例子和教程，所以我建议你在构建自己的GUI版本时查看这些资源。您想在GUI中包含什么信息和功能当然取决于您，在我的示例中，我选择了包含以下元素:</p><figure class="jj jk jl jm fq jn fe ff paragraph-image"><div class="fe ff mg"><img src="../Images/04114dcf5cdc6f22dcc4e42cc88aea2d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1184/format:webp/1*bDYQH61gNW0ff2H8QHniXg.png"/></div><figcaption class="ju jv fg fe ff jw jx bd b be z ek">My IOTA payment GUI</figcaption></figure><ol class=""><li id="465d" class="mh mi ht ks b kt lm kw ln kz mj ld mk lh ml ll mm mn mo mp dt translated">使用服务时要扫描的IOTA支付地址的QR码。</li><li id="4f3f" class="mh mi ht ks b kt mq kw mr kz ms ld mt lh mu ll mm mn mo mp dt translated">“用IOTA支付”标志，清楚地表明这是IOTA支付服务。</li><li id="8394" class="mh mi ht ks b kt mq kw mr kz ms ld mt lh mu ll mm mn mo mp dt translated">任何活动服务的剩余时间。</li><li id="310e" class="mh mi ht ks b kt mq kw mr kz ms ld mt lh mu ll mm mn mo mp dt translated">所选IOTA支付地址的当前余额。(这通常与项目的实际实现无关，但在调试系统时可能有用)</li><li id="2f05" class="mh mi ht ks b kt mq kw mr kz ms ld mt lh mu ll mm mn mo mp dt translated">进度条指示检查新资金的IOTA纠结之间的间隔。</li><li id="be95" class="mh mi ht ks b kt mq kw mr kz ms ld mt lh mu ll mm mn mo mp dt translated">指示灯是开着还是关着的状态标签。<br/>(在编写本教程时，我没有连接物理继电器和LED，所以我使用这个标签来识别LED何时打开或关闭)</li><li id="dd95" class="mh mi ht ks b kt mq kw mr kz ms ld mt lh mu ll mm mn mo mp dt translated">退出按钮退出Python程序。<br/>(在项目的实际实现中包含这个按钮可能没有意义，因为我们不希望用户自己退出系统。但是，我的示例中包含了它，以提供一种在测试和调试时关闭Python程序的便捷方式)</li></ol><p id="0813" class="pw-post-body-paragraph kq kr ht ks b kt lm iu kv kw ln ix ky kz lo lb lc ld lp lf lg lh lq lj lk ll hm dt translated"><em class="me">注意！<br/>我已经决定在我的GUI中排除任何与服务价格相关的信息，因为我计划在未来的教程中更深入地研究这个主题。</em></p></div><div class="ab cl ls lt hb lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="hm hn ho hp hq"><h1 id="6383" class="jy jz ht bd ka kb lz kd ke kf ma kh ki iz mb ja kk jc mc jd km jf md jg ko kp dt translated">所需的软件和库</h1><p id="a8a6" class="pw-post-body-paragraph kq kr ht ks b kt ku iu kv kw kx ix ky kz la lb lc ld le lf lg lh li lj lk ll hm dt translated">在我们开始为这个项目编写Python代码之前，我们需要确保在我们的Raspberry PI上安装了所有需要的软件和库。</p><p id="f4f8" class="pw-post-body-paragraph kq kr ht ks b kt lm iu kv kw ln ix ky kz lo lb lc ld lp lf lg lh lq lj lk ll hm dt translated">首先，我们需要在我们的Raspberry PI上安装一个操作系统。任何支持Raspberry PI的Linux发行版都应该可以工作。在我的例子中，我使用的是Raspbian发行版，因为它已经包含了Python和几个Python编辑器(IDE)。带有安装说明的Raspbian发行版可以在这里找到:<a class="ae lr" href="https://www.raspberrypi.org/downloads/raspbian/" rel="noopener ugc nofollow" target="_blank">https://www.raspberrypi.org/downloads/raspbian/</a></p><p id="a96f" class="pw-post-body-paragraph kq kr ht ks b kt lm iu kv kw ln ix ky kz lo lb lc ld lp lf lg lh lq lj lk ll hm dt translated">如果你需要单独安装Python，你可以在这里找到:<a class="ae lr" href="https://www.python.org/downloads/" rel="noopener ugc nofollow" target="_blank">https://www.python.org/downloads/</a></p><p id="6ac7" class="pw-post-body-paragraph kq kr ht ks b kt lm iu kv kw ln ix ky kz lo lb lc ld lp lf lg lh lq lj lk ll hm dt translated">我们还需要安装几个GUI使用的库</p><ol class=""><li id="657f" class="mh mi ht ks b kt lm kw ln kz mj ld mk lh ml ll mm mn mo mp dt translated">py QR code<br/>py QR code库用于在LCD上生成和呈现我们的QR码。带有安装说明的PyQRCode库可以在<a class="ae lr" href="https://pypi.org/project/PyQRCode/" rel="noopener ugc nofollow" target="_blank">这里</a>找到。</li><li id="5997" class="mh mi ht ks b kt mq kw mr kz ms ld mt lh mu ll mm mn mo mp dt translated">Pillow<br/>Pillow库用于在LCD上呈现我们的IOTA徽标。带安装说明的枕头库可在<a class="ae lr" href="https://pypi.org/project/Pillow/2.2.1/" rel="noopener ugc nofollow" target="_blank">这里</a>找到。</li></ol><p id="d195" class="pw-post-body-paragraph kq kr ht ks b kt lm iu kv kw ln ix ky kz lo lb lc ld lp lf lg lh lq lj lk ll hm dt translated">最后，我们需要安装PyOTA API库，它将允许我们使用Python编程语言访问IOTA tangle。包含安装说明的PyIOTA API库可以在这里找到:<a class="ae lr" href="https://github.com/iotaledger/iota.lib.py" rel="noopener ugc nofollow" target="_blank">https://github.com/iotaledger/iota.lib.py</a></p></div><div class="ab cl ls lt hb lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="hm hn ho hp hq"><h1 id="26f3" class="jy jz ht bd ka kb lz kd ke kf ma kh ki iz mb ja kk jc mc jd km jf md jg ko kp dt translated">Python代码</h1><p id="6d54" class="pw-post-body-paragraph kq kr ht ks b kt ku iu kv kw kx ix ky kz la lb lc ld le lf lg lh li lj lk ll hm dt translated">现在，让我们来看看Python代码是如何变魔术的。与本系列第一篇教程的主要区别在于，我们现在使用基于TkInter的图形用户界面，而不是向控制台写入一些文本。注意我们是如何通过为根对象设置一些属性来强制GUI全屏显示的。另一个重要的方面当然是缩放GUI中的各个元素，以便它们能够正确地显示。在我的例子中，我使用的是3.5英寸的LCD，并相应地调整了缩放比例。还请注意，我已经删除了所有对GPIO库的引用以及与GIO引脚相关的任何函数，因为在写本教程时我没有连接我的继电器。这也允许我在将GUI移动到PI之前，在任何计算机上创建和测试我的GUI。</p><p id="3eaf" class="pw-post-body-paragraph kq kr ht ks b kt lm iu kv kw ln ix ky kz lo lb lc ld lp lf lg lh lq lj lk ll hm dt translated"><em class="me">提示！<br/>当我将液晶显示器连接到树莓派时，我面临的一个问题是:当LCD处于活动状态时，PI不再向HDMI端口发送任何信号。当测试和调试我的GUI时，这很快成为一个问题，因为我当时只能使用一个显示器，LCD或我的HDMI显示器。为了解决这个问题，我最终在PI和我的家用电脑上都安装了</em> <a class="ae lr" href="https://www.realvnc.com/en/" rel="noopener ugc nofollow" target="_blank"> <em class="me">真正的VNC </em> </a> <em class="me">。现在，我可以让PI处于LCD模式，并在我的PC上进行编码。因此，每当我想在LCD上测试我的GUI时，我只需使用</em> <a class="ae lr" href="https://www.realvnc.com/en/" rel="noopener ugc nofollow" target="_blank"> <em class="me">真实VNC </em> </a> <em class="me">中的文件传输函数，并在PI上执行代码。</em></p><figure class="jj jk jl jm fq jn"><div class="bz el l di"><div class="mv mw l"/></div></figure><p id="c442" class="pw-post-body-paragraph kq kr ht ks b kt lm iu kv kw ln ix ky kz lo lb lc ld lp lf lg lh lq lj lk ll hm dt translated">你可以从<a class="ae lr" href="https://gist.github.com/huggre/67efefd75a5fa2571446d3b7c9d58e0b" rel="noopener ugc nofollow" target="_blank">这里</a>下载Python源代码。</p></div><div class="ab cl ls lt hb lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="hm hn ho hp hq"><h1 id="0a92" class="jy jz ht bd ka kb lz kd ke kf ma kh ki iz mb ja kk jc mc jd km jf md jg ko kp dt translated">运行项目</h1><p id="f980" class="pw-post-body-paragraph kq kr ht ks b kt ku iu kv kw kx ix ky kz la lb lc ld le lf lg lh li lj lk ll hm dt translated">要运行这个项目，首先需要将上一节中的代码保存为Raspberry PI上的文本文件。</p><p id="eea6" class="pw-post-body-paragraph kq kr ht ks b kt lm iu kv kw ln ix ky kz lo lb lc ld lp lf lg lh lq lj lk ll hm dt translated">注意Python程序文件使用。py扩展名，所以我们先把文件保存为<strong class="ks hu"><em class="me">let _ there _ light _ GUI . py</em></strong>在树莓派上。</p><p id="56df" class="pw-post-body-paragraph kq kr ht ks b kt lm iu kv kw ln ix ky kz lo lb lc ld lp lf lg lh lq lj lk ll hm dt translated">要执行该程序，只需启动一个新的终端窗口，导航到保存<em class="me">let _ there _ be _ light _ GUI . py</em>的文件夹，然后键入:</p><p id="1af1" class="pw-post-body-paragraph kq kr ht ks b kt lm iu kv kw ln ix ky kz lo lb lc ld lp lf lg lh lq lj lk ll hm dt translated"><strong class="ks hu">python let _ there _ be _ light _ GUI . py</strong></p><p id="c7f1" class="pw-post-body-paragraph kq kr ht ks b kt lm iu kv kw ln ix ky kz lo lb lc ld lp lf lg lh lq lj lk ll hm dt translated">现在，您应该会看到GUI出现在您的LCD/显示器上，显示您的IOTA支付地址的QR码以及前面描述的其他元素。要退出Python程序，只需按退出按钮。</p><p id="9f3b" class="pw-post-body-paragraph kq kr ht ks b kt lm iu kv kw ln ix ky kz lo lb lc ld lp lf lg lh lq lj lk ll hm dt translated"><em class="me">注意！<br/>在执行程序之前，请确保下载“iota_logo75.jpg”文件并将其放在与python文件相同的文件夹中，否则会出现错误。logo文件可以从</em> <a class="ae lr" href="https://github.com/huggre/pay_the_light_gui/blob/master/iota_logo75.jpg" rel="noopener ugc nofollow" target="_blank"> <em class="me">这里下载</em> </a> <em class="me">。</em></p></div><div class="ab cl ls lt hb lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="hm hn ho hp hq"><h1 id="1962" class="jy jz ht bd ka kb lz kd ke kf ma kh ki iz mb ja kk jc mc jd km jf md jg ko kp dt translated">支付光</h1><p id="867a" class="pw-post-body-paragraph kq kr ht ks b kt ku iu kv kw kx ix ky kz la lb lc ld le lf lg lh li lj lk ll hm dt translated">要打开LED(或者在我的情况下，将<strong class="ks hu">灯设置为打开</strong>状态)，您只需使用您最喜欢的IOTA钱包，并将一些IOTA转移到您选择的IOTA地址。一旦IOTA tangle确认了交易，LED应该亮起(或者在我的情况下，将<strong class="ks hu">灯设置为打开</strong>状态)，并根据您传输的IOTA的数量保持亮起，直到灯余额为空。在我的例子中，我将1秒钟的光的IOTA/光比率设置为1 IOTA。</p></div><div class="ab cl ls lt hb lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="hm hn ho hp hq"><h1 id="d732" class="jy jz ht bd ka kb lz kd ke kf ma kh ki iz mb ja kk jc mc jd km jf md jg ko kp dt translated">下一步是什么？</h1><p id="a7f3" class="pw-post-body-paragraph kq kr ht ks b kt ku iu kv kw kx ix ky kz la lb lc ld le lf lg lh li lj lk ll hm dt translated">你可以在这里找到本系列下一个教程的链接<a class="ae lr" rel="noopener" href="/coinmonks/integrating-physical-devices-with-iota-price-and-addresses-4f352e321cbb"/></p></div><div class="ab cl ls lt hb lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="hm hn ho hp hq"><h1 id="054f" class="jy jz ht bd ka kb lz kd ke kf ma kh ki iz mb ja kk jc mc jd km jf md jg ko kp dt translated">贡献</h1><p id="fc3d" class="pw-post-body-paragraph kq kr ht ks b kt ku iu kv kw kx ix ky kz la lb lc ld le lf lg lh li lj lk ll hm dt translated">如果你想对本教程有所贡献，你可以在这里找到一个Github库<a class="ae lr" href="https://github.com/huggre/pay_the_light_gui" rel="noopener ugc nofollow" target="_blank"/></p></div><div class="ab cl ls lt hb lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="hm hn ho hp hq"><h1 id="7564" class="jy jz ht bd ka kb lz kd ke kf ma kh ki iz mb ja kk jc mc jd km jf md jg ko kp dt translated">捐款</h1><p id="70bd" class="pw-post-body-paragraph kq kr ht ks b kt ku iu kv kw kx ix ky kz la lb lc ld le lf lg lh li lj lk ll hm dt translated">如果您喜欢本教程，并希望我继续制作其他教程，请随意向Python代码中使用的IOTA地址捐款。此外，在构建和测试您的项目版本时，请随意使用相同的IOTA地址，这样，每当我(和您)的LED灯亮起时，它都会很好地提醒我(我们)有人正在使用本教程。</p><figure class="jj jk jl jm fq jn fe ff paragraph-image"><div class="fe ff mx"><img src="../Images/f898855aa9f02c497078a9bdbee25534.png" data-original-src="https://miro.medium.com/v2/resize:fit:764/format:webp/1*j2ENIzmDzXcGSgAdY4w-Jw.png"/></div></figure><p id="7878" class="pw-post-body-paragraph kq kr ht ks b kt lm iu kv kw ln ix ky kz lo lb lc ld lp lf lg lh lq lj lk ll hm dt translated">nyzbhovsmdwabxsacajttwjoqrvvawlbsfqvsjswwbjjlsqknzfc 9 xcrpqsvfqzpbjcjrannpvmmezqjrqsvvgz</p></div></div>    
</body>
</html>