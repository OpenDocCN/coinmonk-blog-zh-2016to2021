<html>
<head>
<title>How to survive the gas curse in Quorum?</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在定额组中躲过毒气诅咒？</h1>
<blockquote>原文：<a href="https://medium.com/coinmonks/how-to-survive-the-gas-curse-in-quorum-7b2c8fea2540?source=collection_archive---------0-----------------------#2018-02-14">https://medium.com/coinmonks/how-to-survive-the-gas-curse-in-quorum-7b2c8fea2540?source=collection_archive---------0-----------------------#2018-02-14</a></blockquote><div><div class="ef hh hi hj hk hl"/><div class="hm hn ho hp hq"><div class=""/><figure class="fi fk ir is it iu fe ff paragraph-image"><div role="button" tabindex="0" class="iv iw di ix bf iy"><div class="fe ff iq"><img src="../Images/4df8d264bf64be5325ebe648b0205ae5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*f0r34OSECnm0V_vv-VDggQ.jpeg"/></div></div></figure><p id="61fd" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">你们可能都知道，我们最近在阿拉斯特里亚的测试网上遇到了一些问题，追踪这些问题并不容易。起初，网络停止开采新的区块，完全拖延了区块链。正如我们在之前的帖子、<strong class="jd hu">中简要分析的<a class="ae jz" rel="noopener" href="/@adlrocha/who-to-blame-in-a-distributed-world-c9a00fe8773c">，这是由于太多的验证器离线或失败</a></strong>，使得IBFT共识无法验证新的区块。这是问题之一，而且令人惊讶的是，这个问题很容易追踪。一旦我们恢复了足够多的验证器节点，网络就开始验证新的块，但是<strong class="jd hu">这些块是空的</strong>，即使队列中有事务。为什么会发生这种情况？</p><p id="e9a5" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">在<strong class="jd hu"><em class="ka">Marcos Serradilla</em></strong>(来自核心技术团队)和我<strong class="jd hu">进行了几次调查后，我们发现问题与所有这些排队的事务以及Quorum对gas的管理</strong>有关。当我们在Quorum中执行事务时，我们必须确保为该事务定义的gas限制高于执行该事务所需的限制(即使<em class="ka">【理论上】</em> Quorum根本不使用gas)。如果我们不这样做，<strong class="jd hu">这个事务将无限期地排队，阻塞每个到达系统的新事务</strong>。发生这种情况后，系统中不再验证新的交易。</p><p id="133e" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">我们是如何重现这个bug的？我们部署了一个简单的合同，但只有少量的汽油，令人惊讶的是，我们得到了一个<em class="ka">“汽油用完”</em>错误。然后，这个事务被阻塞在队列中，阻塞每个新到达的事务。</p><p id="5055" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated"><em class="ka">所以，我们发现了空积木的问题！但是，我们该如何解决呢？在我们的例子中，为了解决这个问题，<strong class="jd hu">我们决定完全重启测试网，以便区块链有一个干净的开始。然而，我们不能在每次有人阻塞队列时都这样做，我们需要避免这些问题有意或无意地再次发生。因此，我们开始考虑实施以下对策:</strong></em></p><ul class=""><li id="a1c2" class="kb kc ht jd b je jf ji jj jm kd jq ke ju kf jy kg kh ki kj dt translated">避免区块链阻塞的<em class="ka">纠正措施</em>:如果有人未能在其事务中强制执行正确的gas限制，并且这被检测到，<strong class="jd hu">网络中的每个节点都应该被停止，并且事务队列(存储在名为<em class="ka">“transaction . rpl”</em>的文件中)应该被删除</strong>，因此当网络中的每个节点重新启动时，区块链状态保持不变，但是事务队列被清空。</li><li id="1592" class="kb kc ht jd b je kk ji kl jm km jq kn ju ko jy kg kh ki kj dt translated"><strong class="jd hu">强制网络中的每个节点在其交易中使用相同的燃气限额</strong>。该值应该很高，但低于成因区块中定义的气体极限。这样，我们可以确保每次交易都会有足够的汽油(只要你不在你的智能合同中引入无限循环，以及这种编程错误)。</li><li id="1159" class="kb kc ht jd b je kk ji kl jm km jq kn ju ko jy kg kh ki kj dt translated"><strong class="jd hu">在每个节点中实现一个轻量级的进程，定期清空其事务队列以移除潜在的阻塞事务，</strong>最小化它们的影响。此解决方案的唯一问题是，事务队列的删除应该尽可能同步，以避免队列为空的节点与队列中有阻塞事务的节点同步。这将使被阻止的交易再次扩散到网络中的每个节点。</li><li id="a45e" class="kb kc ht jd b je kk ji kl jm km jq kn ju ko jy kg kh ki kj dt translated">应用层中的每个应用程序开发人员都应该确保有足够的气体用于他们的事务(这不仅仅是一个对策，对于Alastria的智能合同开发人员来说，这是一个建议的良好实践)。</li></ul><p id="4313" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">无论哪种方式，从阿拉斯特里亚核心技术团队，我们将<strong class="jd hu">联系摩根大通，沟通这个气体臭虫，并要求他们在未来版本</strong>中修复它。然而，如果这不会很快发生，我们需要这些对策。</p><figure class="kp kq kr ks fq iu fe ff paragraph-image"><div role="button" tabindex="0" class="iv iw di ix bf iy"><div class="fe ff iq"><img src="../Images/efa9c899ed910dfdbaff7ce1cf47edac.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*yMaDxLYR19wbYrB-nji2rg.png"/></div></div><figcaption class="kt ku fg fe ff kv kw bd b be z ek">Source: <a class="ae jz" href="https://steemit.com/cryptocurrency/@truantlife/blockchain-101" rel="noopener ugc nofollow" target="_blank">https://steemit.com/cryptocurrency/@truantlife/blockchain-101</a></figcaption></figure><p id="a727" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">正如您可能从我之前的讨论中看到的，很难跟踪区块链的问题，尤其是当基础设施管理是分布式的时候。正因为如此，我们正在为每个验证器节点构建<strong class="jd hu">轻量级监控系统，因此我们可以获得一些关于网络的非指导性信息，并跟踪可能导致我们过去几周所面临问题的异常情况，并快速从中恢复。该监控工具的第一个alpha版本已经在其存储库中发布<a class="ae jz" href="https://github.com/alastria/monitor" rel="noopener ugc nofollow" target="_blank">。</a></strong></p><blockquote class="kx"><p id="f9e9" class="ky kz ht bd la lb lc ld le lf lg jy ek translated"><a class="ae jz" href="https://coincodecap.com/?utm_source=coinmonks" rel="noopener ugc nofollow" target="_blank">直接在您的收件箱中获取最佳软件交易</a></p></blockquote><figure class="li lj lk ll lm iu fe ff paragraph-image"><a href="https://coincodecap.com/?utm_source=coinmonks"><div class="fe ff lh"><img src="../Images/7c0b3dfdcbfea594cc0ae7d4f9bf6fcb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1168/format:webp/0*OJ-qb5G6i863msBB.png"/></div></a></figure><p id="599b" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">此外，为了分析来自验证器监视器的所有信息，我们正在设计一个系统，以便轻松处理、分析和可视化这些数据，监视整个网络的状态，并检测系统中的潜在异常，尽可能减少其影响。我们称该系统为<strong class="jd hu"> Alastria DNA(分散网络管理)。</strong></p><p id="821f" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated"><strong class="jd hu">一如既往，我们需要尽可能多的帮助来构建所有这些工具，并让Alastria的main-net做好行动准备，因此我们非常高兴您加入我们的团队</strong>。如果您想在上述任何系统中提供帮助，或者与Alastria平台相关的任何事情，请前往<a class="ae jz" href="https://github.com/alastria" rel="noopener ugc nofollow" target="_blank"> Alastria的github </a>、<a class="ae jz" href="https://alastriaplatform.invisionzone.com" rel="noopener ugc nofollow" target="_blank">论坛</a>、<a class="ae jz" href="https://tree.taiga.io/project/marcossanlab-alastria-platform/kanban?q=" rel="noopener ugc nofollow" target="_blank">看板</a>或<a class="ae jz" href="https://www.linkedin.com/in/adlrocha/" rel="noopener ugc nofollow" target="_blank">联系我</a>(或团队的任何成员)，如果您需要更多信息。我们期待您的贡献；).</p><figure class="kp kq kr ks fq iu fe ff paragraph-image"><a href="http://bit.ly/2G71Sp7"><div class="fe ff ln"><img src="../Images/449450761cd76f44f9ae574333f9e9af.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fKX2mtg7p1lOs7JmosPLsA.png"/></div></a></figure></div></div>    
</body>
</html>