<html>
<head>
<title>Algorithmic Trading with MACD and Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">MACD和Python的算法交易</h1>
<blockquote>原文：<a href="https://medium.com/coinmonks/algorithmic-trading-with-macd-and-python-b709b8a46d84?source=collection_archive---------2-----------------------#2020-09-20">https://medium.com/coinmonks/algorithmic-trading-with-macd-and-python-b709b8a46d84?source=collection_archive---------2-----------------------#2020-09-20</a></blockquote><div><div class="ef hh hi hj hk hl"/><div class="hm hn ho hp hq"><div class=""/><p id="a490" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">机器学习交易对于每天进行数千笔交易的大型对冲基金来说效果很好。然而，私人交易者只是没有实时运行具有数百万参数的机器学习模型的设施。这就是为什么私人算法交易者使用技术指标进行自动交易。</p><h1 id="c3d3" class="jo jp ht bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl dt translated">什么是MACD？</h1><p id="3b17" class="pw-post-body-paragraph iq ir ht is b it km iv iw ix kn iz ja jb ko jd je jf kp jh ji jj kq jl jm jn hm dt translated">我今天要用的技术指标是MACD，移动平均线收敛发散，这是一个动量指标，显示了两条移动平均线之间的关系。MACD的计算方法是从12期均线中减去26期均线。</p><p id="5759" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">这条MACD线画在信号线上(9周期均线)。这两条线的交点就是MACD指标的信号。如果MACD指标从下方与信号线交叉，这将是上升趋势。如果MACD指标从信号线上方交叉，这将是一个下降趋势。</p><h1 id="0beb" class="jo jp ht bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl dt translated">概念:</h1><p id="deda" class="pw-post-body-paragraph iq ir ht is b it km iv iw ix kn iz ja jb ko jd je jf kp jh ji jj kq jl jm jn hm dt translated">为了在编程时有效率，为了心中有一个明确的目标，有必要创建一个关于程序应该如何工作的总体想法。这个程序应该能够绘制MACD信号和MACD线，并根据MACD指标的信号进行交易。一个好的程序还应该能够评估交易策略的盈利能力，从而对其进行优化。</p><h1 id="725b" class="jo jp ht bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl dt translated">代码:</h1><pre class="kr ks kt ku fq kv kw kx ky aw kz dt"><span id="233e" class="la jp ht kw b fv lb lc l ld le">import yfinance<br/>import talib<br/>from matplotlib import pyplot as plt</span></pre><p id="f6de" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">这些是我将在程序中使用的库。yfinance用于下载股票的财务数据，talib用于计算MACD指标的值。Matplotlib用于绘制数据，以更好地理解技术指标。</p><pre class="kr ks kt ku fq kv kw kx ky aw kz dt"><span id="e3d1" class="la jp ht kw b fv lb lc l ld le">data = yfinance.download('NFLX','2016-1-1','2020-1-1')<br/>data["macd"], data["macd_signal"], data["macd_hist"] = talib.MACD(data['Close'])<br/>fig = plt.figure()</span></pre><p id="57ce" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">这个脚本下载数据，然后计算macd值，比如信号和定义趋势的直方图。</p><figure class="kr ks kt ku fq lf fe ff paragraph-image"><div class="ab fr cl lg"><img src="../Images/6c6167302dc824c62a73632ee31fa010.png" data-original-src="https://miro.medium.com/v2/format:webp/0*Qeycs2aPbtV3ZtdL.png"/></div></figure><p id="e514" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">作者图片</p><p id="2cce" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">这是MACD指示器和信号线两条线的图形。这只是对程序进行故障排除，以确保指示器正常工作。正如我们所看到的，该指标显然是有效的，因为两条线经常相交。</p><pre class="kr ks kt ku fq kv kw kx ky aw kz dt"><span id="d48a" class="la jp ht kw b fv lb lc l ld le">def intersection(lst_1,lst_2):<br/>    intersections = []<br/>    insights = []<br/>    if len(lst_1) &gt; len(lst_2):<br/>        settle = len(lst_2)<br/>    else:<br/>        settle = len(lst_1)<br/>    for i in range(settle-1):<br/>        if (lst_1[i+1] &lt; lst_2[i+1]) != (lst_1[i] &lt; lst_2[i]):<br/>            if ((lst_1[i+1] &lt; lst_2[i+1]),(lst_1[i] &lt; lst_2[i])) == (True,False):<br/>                insights.append('buy')<br/>            else:<br/>                insights.append('sell')<br/>            intersections.append(i)<br/>    return intersections,insightsintersections,insights = intersection(data["macd_signal"],data["macd"])</span></pre><p id="7fa9" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">交集函数使用一种非常规的方式来寻找交集:</p><ol class=""><li id="6614" class="lj lk ht is b it iu ix iy jb ll jf lm jj ln jn lo lp lq lr dt translated">如果列表1中的值大于列表2中相同索引的值，则存储True。否则，存储False。</li><li id="d06c" class="lj lk ht is b it ls ix lt jb lu jf lv jj lw jn lo lp lq lr dt translated">将此函数应用于大于1的索引。如果存储的值不同，则一定发生了交集。</li></ol><p id="4b31" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">这是计算相交的唯一方法，因为相交可能发生在真实点之间，使得不可能在两个列表中找到相似的点。</p><p id="6646" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">我们使用这个函数来寻找交叉点，并记下程序是卖还是买股票。</p><p id="1a30" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">要做好一个股票交易程序，我们必须评估程序的盈利能力。</p><pre class="kr ks kt ku fq kv kw kx ky aw kz dt"><span id="324d" class="la jp ht kw b fv lb lc l ld le">profit = 0<br/>pat = 1<br/>for i in range(len(intersections)-pat):<br/>    index = intersections[i]<br/>    true_trade= None<br/>    if data['Close'][index] &lt; data['Close'][index+pat]:<br/>        true_trade = 'buy'<br/>    elif data['Close'][index] &gt; data['Close'][index+pat]:<br/>        true_trade = 'sell'<br/>    if true_trade != None:<br/>        if insights[i] == true_trade:<br/>            profit += abs(data['Close'][index]-data['Close'][index+1]) <br/>        if insights[i] != true_trade:<br/>            profit += -abs(data['Close'][index]-data['Close'][index+1])</span></pre><p id="85b5" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">这个程序通过计算true_trade来计算盈利能力，true _ trade存储值是上升还是下降。如果交易符合真实交易变量，交易就是盈利的。如果交易不匹配，交易就会失败。</p><p id="cc87" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">运行程序时，利润为-288.26。什么？</p><h1 id="dafa" class="jo jp ht bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl dt translated">发生了什么事？</h1><p id="8ca4" class="pw-post-body-paragraph iq ir ht is b it km iv iw ix kn iz ja jb ko jd je jf kp jh ji jj kq jl jm jn hm dt translated">我发现了这个错误，并一直试图扰乱耐心值，也就是交叉点形成后多久，交易就完成了。所有的值都是负数。当面对这样的问题时，其中值的极性都是错误的，人们可以很容易地改变极性。</p><p id="0984" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">在这种情况下，这是因为交集顺序不正确！当我们做交叉点时，我们做了与我们描述的策略相反的洞察！例如，如果MACD线从上方相交，程序会将其标记为价格上涨！这将使所有被认为是有利可图的交易变成亏损！</p><p id="a8e4" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">通过将交叉点代码更改为:</p><pre class="kr ks kt ku fq kv kw kx ky aw kz dt"><span id="24c7" class="la jp ht kw b fv lb lc l ld le">def intersection(lst_1,lst_2):<br/>    intersections = []<br/>    insights = []<br/>    if len(lst_1) &gt; len(lst_2):<br/>        settle = len(lst_2)<br/>    else:<br/>        settle = len(lst_1)<br/>    for i in range(settle-1):<br/>        if (lst_1[i+1] &lt; lst_2[i+1]) != (lst_1[i] &lt; lst_2[i]):<br/>            if ((lst_1[i+1] &lt; lst_2[i+1]),(lst_1[i] &lt; lst_2[i])) == (True,False):<br/>                insights.append('buy')<br/>            else:<br/>                insights.append('sell')<br/>            intersections.append(i)<br/>    return intersections,insightsintersections,insights = intersection(data["macd_signal"],data["macd"])</span></pre><p id="eca7" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">我们获得298美元的利润！</p><h1 id="d004" class="jo jp ht bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl dt translated">结论:</h1><p id="adef" class="pw-post-body-paragraph iq ir ht is b it km iv iw ix kn iz ja jb ko jd je jf kp jh ji jj kq jl jm jn hm dt translated">我写了另一篇关于RSI的文章，那个程序用同样的数据只赚了58美元。这个项目赚了298美元，每笔交易买一股。这里有一些方法可以改进我的程序:</p><ol class=""><li id="b445" class="lj lk ht is b it iu ix iy jb ll jf lm jj ln jn lo lp lq lr dt translated">调整耐心变量</li></ol><p id="836f" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">这个变量是相交后多长时间，将进行交易。用这个值做玩具，找到一个模式，并优化它以获得更好的结果。</p><p id="100c" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">2.找到最好的份额</p><p id="98ad" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">这个算法对哪只股票最有效？在不同的公司上测试这个程序以进行评估。</p><p id="4754" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">谢谢你看我的文章！</p><h2 id="550b" class="la jp ht bd jq lx ly lz ju ma mb mc jy jb md me kc jf mf mg kg jj mh mi kk mj dt translated">另外，阅读</h2><ul class=""><li id="02dc" class="lj lk ht is b it km ix kn jb mk jf ml jj mm jn mn lp lq lr dt translated">最好的<a class="ae mo" rel="noopener" href="/coinmonks/crypto-trading-bot-c2ffce8acb2a">密码交易机器人</a></li><li id="b851" class="lj lk ht is b it ls ix lt jb lu jf lv jj lw jn mn lp lq lr dt translated"><a class="ae mo" rel="noopener" href="/coinmonks/top-10-crypto-copy-trading-platforms-for-beginners-d0c37c7d698c">密码本交易平台</a></li><li id="ae2d" class="lj lk ht is b it ls ix lt jb lu jf lv jj lw jn mn lp lq lr dt translated">最好的<a class="ae mo" rel="noopener" href="/coinmonks/best-crypto-tax-tool-for-my-money-72d4b430816b">加密税务软件</a></li><li id="92e4" class="lj lk ht is b it ls ix lt jb lu jf lv jj lw jn mn lp lq lr dt translated"><a class="ae mo" rel="noopener" href="/coinmonks/the-best-crypto-trading-platforms-in-2020-the-definitive-guide-updated-c72f8b874555">最佳加密交易平台</a></li><li id="d8fc" class="lj lk ht is b it ls ix lt jb lu jf lv jj lw jn mn lp lq lr dt translated">最佳<a class="ae mo" rel="noopener" href="/coinmonks/top-5-crypto-lending-platforms-in-2020-that-you-need-to-know-a1b675cec3fa">加密贷款平台</a></li><li id="4f10" class="lj lk ht is b it ls ix lt jb lu jf lv jj lw jn mn lp lq lr dt translated"><a class="ae mo" href="https://bitquery.io/blog/best-blockchain-analysis-tools-and-software" rel="noopener ugc nofollow" target="_blank">最佳区块链分析工具</a></li><li id="d432" class="lj lk ht is b it ls ix lt jb lu jf lv jj lw jn mn lp lq lr dt translated"><a class="ae mo" rel="noopener" href="/coinmonks/crypto-arbitrage-guide-how-to-make-money-as-a-beginner-62bfe5c868f6">加密套利</a>指南:新手如何赚钱</li><li id="aa54" class="lj lk ht is b it ls ix lt jb lu jf lv jj lw jn mn lp lq lr dt translated">最佳<a class="ae mo" rel="noopener" href="/coinmonks/what-are-the-best-charting-platforms-for-cryptocurrency-trading-85aade584d80">加密制图工具</a></li><li id="15e1" class="lj lk ht is b it ls ix lt jb lu jf lv jj lw jn mn lp lq lr dt translated"><a class="ae mo" rel="noopener" href="/coinmonks/ledger-vs-trezor-best-hardware-wallet-to-secure-cryptocurrency-22c7a3fd391e">莱杰vs特雷佐</a></li><li id="56fd" class="lj lk ht is b it ls ix lt jb lu jf lv jj lw jn mn lp lq lr dt translated">了解比特币最好的<a class="ae mo" rel="noopener" href="/coinmonks/what-are-the-best-books-to-learn-bitcoin-409aeb9aff4b">书籍有哪些？</a></li><li id="170f" class="lj lk ht is b it ls ix lt jb lu jf lv jj lw jn mn lp lq lr dt translated"><a class="ae mo" rel="noopener" href="/coinmonks/3commas-review-an-excellent-crypto-trading-bot-2020-1313a58bec92">3商业评论</a></li><li id="d145" class="lj lk ht is b it ls ix lt jb lu jf lv jj lw jn mn lp lq lr dt translated"><a class="ae mo" rel="noopener" href="/coinmonks/aax-exchange-review-2021-67c5ea09330c"> AAX交易所评论</a> |推荐代码、交易费用、利弊</li><li id="54f9" class="lj lk ht is b it ls ix lt jb lu jf lv jj lw jn mn lp lq lr dt translated"><a class="ae mo" rel="noopener" href="/coinmonks/deribit-review-options-fees-apis-and-testnet-2ca16c4bbdb2">德里比特评论</a> |选项、费用、API和Testnet</li><li id="e34b" class="lj lk ht is b it ls ix lt jb lu jf lv jj lw jn mn lp lq lr dt translated"><a class="ae mo" rel="noopener" href="/coinmonks/ftx-crypto-exchange-review-53664ac1198f"> FTX密码交易所评论</a></li><li id="d0c3" class="lj lk ht is b it ls ix lt jb lu jf lv jj lw jn mn lp lq lr dt translated"><a class="ae mo" rel="noopener" href="/coinmonks/ngrave-zero-review-c465cf8307fc">n零审核</a></li><li id="1310" class="lj lk ht is b it ls ix lt jb lu jf lv jj lw jn mn lp lq lr dt translated"><a class="ae mo" rel="noopener" href="/coinmonks/bybit-exchange-review-dbd570019b71"> Bybit交换审查</a></li><li id="8b1e" class="lj lk ht is b it ls ix lt jb lu jf lv jj lw jn mn lp lq lr dt translated"><a class="ae mo" rel="noopener" href="/coinmonks/cryptohopper-vs-3commas-vs-shrimpy-a2c16095b8fe"> 3Commas vs Cryptohopper </a></li><li id="b18b" class="lj lk ht is b it ls ix lt jb lu jf lv jj lw jn mn lp lq lr dt translated">最好的比特币<a class="ae mo" rel="noopener" href="/coinmonks/the-best-cryptocurrency-hardware-wallets-of-2020-e28b1c124069?source=friends_link&amp;sk=324dd9ff8556ab578d71e7ad7658ad7c">硬件钱包</a></li><li id="e7b1" class="lj lk ht is b it ls ix lt jb lu jf lv jj lw jn mn lp lq lr dt translated">最佳<a class="ae mo" href="https://blog.coincodecap.com/best-monero-wallets" rel="noopener ugc nofollow" target="_blank"> monero钱包</a></li><li id="747f" class="lj lk ht is b it ls ix lt jb lu jf lv jj lw jn mn lp lq lr dt translated"><a class="ae mo" href="https://blog.coincodecap.com/ledger-nano-s-vs-x" rel="noopener ugc nofollow" target="_blank">莱杰nano s vs x </a></li><li id="ace6" class="lj lk ht is b it ls ix lt jb lu jf lv jj lw jn mn lp lq lr dt translated"><a class="ae mo" href="https://blog.coincodecap.com/bitsgap-3commas-quadency" rel="noopener ugc nofollow" target="_blank">bits gap vs 3 commas vs quad ency</a></li><li id="a274" class="lj lk ht is b it ls ix lt jb lu jf lv jj lw jn mn lp lq lr dt translated"><a class="ae mo" href="https://blog.coincodecap.com/ledger-nano-s-vs-trezor-one-ledger-nano-x-trezor-t" rel="noopener ugc nofollow" target="_blank">莱杰纳米S vs特雷佐one vs特雷佐T vs莱杰纳米X </a></li><li id="44f0" class="lj lk ht is b it ls ix lt jb lu jf lv jj lw jn mn lp lq lr dt translated"><a class="ae mo" rel="noopener" href="/coinmonks/blockfi-vs-celsius-vs-hodlnaut-8a1cc8c26630">block fi vs Celsius</a>vs Hodlnaut</li><li id="52d0" class="lj lk ht is b it ls ix lt jb lu jf lv jj lw jn mn lp lq lr dt translated">Bitsgap评论——一个轻松赚钱的加密交易机器人</li><li id="92c0" class="lj lk ht is b it ls ix lt jb lu jf lv jj lw jn mn lp lq lr dt translated">为专业人士设计的加密交易机器人</li><li id="22eb" class="lj lk ht is b it ls ix lt jb lu jf lv jj lw jn mn lp lq lr dt translated"><a class="ae mo" rel="noopener" href="/coinmonks/primexbt-review-88e0815be858"> PrimeXBT审查</a> |杠杆交易、费用和交易</li><li id="62d2" class="lj lk ht is b it ls ix lt jb lu jf lv jj lw jn mn lp lq lr dt translated"><a class="ae mo" rel="noopener" href="/coinmonks/ellipal-titan-review-85e9071dd029">埃利帕尔泰坦评论</a></li><li id="1a26" class="lj lk ht is b it ls ix lt jb lu jf lv jj lw jn mn lp lq lr dt translated"><a class="ae mo" href="https://blog.coincodecap.com/secux-stone-hardware-wallet-review" rel="noopener ugc nofollow" target="_blank"> SecuX Stone评论</a></li><li id="31ff" class="lj lk ht is b it ls ix lt jb lu jf lv jj lw jn mn lp lq lr dt translated"><a class="ae mo" rel="noopener" href="/coinmonks/blockfi-review-53096053c097"> BlockFi评论</a> |从您的密码中赚取高达8.6%的利息</li></ul></div></div>    
</body>
</html>