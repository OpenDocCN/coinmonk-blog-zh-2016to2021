<html>
<head>
<title>Crypto Composables ERC-998 Update #2</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">加密组件ERC-998更新#2</h1>
<blockquote>原文：<a href="https://medium.com/coinmonks/crypto-composables-erc-998-update-2-4b160df79836?source=collection_archive---------5-----------------------#2018-05-15">https://medium.com/coinmonks/crypto-composables-erc-998-update-2-4b160df79836?source=collection_archive---------5-----------------------#2018-05-15</a></blockquote><div><div class="ef hh hi hj hk hl"/><div class="hm hn ho hp hq"><div class=""/><figure class="fi fk ir is it iu fe ff paragraph-image"><div role="button" tabindex="0" class="iv iw di ix bf iy"><div class="fe ff iq"><img src="../Images/a3255345013a305eea46befa4ab4e95e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ncPWXtV0zWbquLxy-M2y8g.jpeg"/></div></div><figcaption class="jb jc fg fe ff jd je bd b be z ek">Blockchain Week NYC</figcaption></figure><p id="6958" class="pw-post-body-paragraph jf jg ht jh b ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc hm dt translated">哇！我在纽约！共识2018正在进行，我不在😂。</p><p id="14e7" class="pw-post-body-paragraph jf jg ht jh b ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc hm dt translated">现在让我们来讨论一些更实际的东西……为可组合不可替换令牌(CNFTs)构建一个标准接口。感谢<a class="kd ke gr" href="https://medium.com/u/db924dbde4c3?source=post_page-----4b160df79836--------------------------------" rel="noopener" target="_blank">理查德·伯顿</a>在<a class="ae kf" href="https://balance.io/" rel="noopener ugc nofollow" target="_blank">平衡工作室</a>招待我们进行<em class="kg">其实</em>T7】搭建的事情。#BUIDLWEEK</p><figure class="kh ki kj kk fq iu fe ff paragraph-image"><div role="button" tabindex="0" class="iv iw di ix bf iy"><div class="fe ff iq"><img src="../Images/21db2ea6ac8372e3e7954362f3e23cf8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*sU6mhzhuCVMbDIJO-a-e2g.jpeg"/></div></div><figcaption class="jb jc fg fe ff jd je bd b be z ek"><a class="kd ke gr" href="https://medium.com/u/db924dbde4c3?source=post_page-----4b160df79836--------------------------------" rel="noopener" target="_blank">Richard Burton</a> and Balance Wallet crew at the Brooklyn HQ</figcaption></figure><p id="6858" class="pw-post-body-paragraph jf jg ht jh b ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc hm dt translated">自从我发布了“<a class="ae kf" rel="noopener" href="/coinmonks/introducing-crypto-composables-ee5701fde217">介绍加密可组合组件T10”和“T11加密可组合组件—构建模块和应用T12”之后，我已经被NFT领域的许多项目、以太坊社区的兴趣和整体支持所淹没🤗。延伸到以太坊社区，这种支持将使其成为ERC-721的标准接口和扩展，允许CNFTs拥有NFTs (ERC-721)和FTs (ERC-20)。一份<strong class="jh hu">实施工作草案</strong>在此:</a></p><div class="kl km fm fo kn ko"><a href="https://github.com/mattlockyer/composables-998" rel="noopener  ugc nofollow" target="_blank"><div class="kp ab ej"><div class="kq ab kr cl cj ks"><h2 class="bd hu fv z el kt eo ep ku er et hs dt translated">mattlockyer/composables-998</h2><div class="kv l"><h3 class="bd b fv z el kt eo ep ku er et ek translated">composables-998 -一个为以太坊开发ERC-998标准的实现和文档报告。</h3></div><div class="kw l"><p class="bd b gc z el kt eo ep ku er et ek translated">github.com</p></div></div><div class="kx l"><div class="ky l kz la lb kx lc iz ko"/></div></div></a></div><p id="8727" class="pw-post-body-paragraph jf jg ht jh b ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc hm dt translated">本次更新涵盖了ERC-998到2个选择界面的重构。拥有FTs的大部分代码是在周日晚上飞往纽约的飞机上写的。这个代码已经在上面的工作报告中进行了松散的测试。虽然在这成为标准之前还有很多工作要做，但是有一个草案实现将允许其他开发者和我自己<strong class="jh hu">开发一些</strong><strong class="jh hu">dapp</strong>。一旦上了testnet，这些dapps将展示一个开放的、可互操作的可组合令牌标准的威力。提示:请在接下来的几周内注意😂。</p><h1 id="5d11" class="ld le ht bd lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma dt translated">重构ERC-998接口</h1><figure class="kh ki kj kk fq iu fe ff paragraph-image"><div role="button" tabindex="0" class="iv iw di ix bf iy"><div class="fe ff mb"><img src="../Images/a0c4800d71c9aca794e4eeff0d789cc4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zqAWN-KKF1FrYj0w7BT2Sg.jpeg"/></div></div><figcaption class="jb jc fg fe ff jd je bd b be z ek">Curation Markets meetup with <a class="kd ke gr" href="https://medium.com/u/f1cb98e196bc?source=post_page-----4b160df79836--------------------------------" rel="noopener" target="_blank">Trent McConaghy</a> hosted by <a class="kd ke gr" href="https://medium.com/u/959e75125558?source=post_page-----4b160df79836--------------------------------" rel="noopener" target="_blank">FOAM</a></figcaption></figure><p id="874a" class="pw-post-body-paragraph jf jg ht jh b ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc hm dt translated">最近我完成了ERC-998的第一部分，也是我认为最难的部分:让一个CNFT拥有其他CNFT和标准NFT。这在很大程度上是因为非功能性测试比功能性测试更复杂。对于NFT，你必须跟踪每个令牌的唯一性<code class="eh mc md me mf b">tokenId</code>,而对于FTs，你不必在意，因为它们不是唯一的。任何可替换令牌都与任何其他可替换令牌相同，余额表示为单个整数余额。那么这个重构怎么样呢？</p><p id="a21a" class="pw-post-body-paragraph jf jg ht jh b ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc hm dt translated">我选择将ERC-998接口重构为两部分，跟随几个OpenZeppelin标准实现的脚步，保持代码模块化。在下面的代码和讨论中，不可替换的令牌拥有(NFTP)和可替换的令牌拥有(FTP)代表由可组合的。下面是重构的样子:</p><figure class="kh ki kj kk fq iu fe ff paragraph-image"><div role="button" tabindex="0" class="iv iw di ix bf iy"><div class="fe ff mg"><img src="../Images/1c09e2f6d4fb44698de75022f871de05.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zpPPCZKt-EzVJ4gH39r2XA.png"/></div></div><figcaption class="jb jc fg fe ff jd je bd b be z ek">Composing Composables with Inheritance</figcaption></figure><p id="910b" class="pw-post-body-paragraph jf jg ht jh b ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc hm dt translated">有了这个新的架构，就有可能创建只拥有和管理<strong class="jh hu">NFT(721)或者只拥有和管理<strong class="jh hu">FTs(20s)的组件，或者同时拥有和管理<strong class="jh hu">和</strong>的组件。例如:代表<strong class="jh hu">指数基金</strong>的可组合合约对于每只基金都有唯一的NFT，但只需要从<code class="eh mc md me mf b">ERC998PossessERC20.sol</code>合约继承。这也将减少部署到区块链的合同规模。最近的重构支持这一逻辑，同时仍然为CNFTs拥有NFT和ft敞开大门。</strong></strong></p><h1 id="459b" class="ld le ht bd lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma dt translated">拥有FTs的CNFTs</h1><p id="1311" class="pw-post-body-paragraph jf jg ht jh b ji mh jk jl jm mi jo jp jq mj js jt ju mk jw jx jy ml ka kb kc hm dt translated">我知道，在解决CNFT拥有NFT案例(即拥有其他唯一令牌ID阵列的唯一令牌ID)的管理难题后，这将变得很容易。虽然cnft拥有NFTs仍然是一个草案，需要一些额外的功能和健壮性，但我想探索cnft拥有FTs的概念。这变得容易多了，因为“拥有NFT”案例中的大部分代码可以在这里使用并简化为表示余额，而不是唯一令牌id的数组。下面来看一下<em class="kg">公共</em>接口:</p><pre class="kh ki kj kk fq mm mf mn mo aw mp dt"><span id="32af" class="mq le ht mf b fv mr ms l mt mu">// mapping from nft to all ftp contracts<br/>mapping(uint256 =&gt; address[]) ftpContracts;</span><span id="1121" class="mq le ht mf b fv mv ms l mt mu">// mapping for the ftp contract index<br/>mapping(uint256 =&gt; mapping(address =&gt; uint256)) ftpContractIndex;</span><span id="028b" class="mq le ht mf b fv mv ms l mt mu">// mapping from contract pseudo-address owner ftp to the tokenIds<br/>mapping(address =&gt; uint256) ftpBalances;</span><span id="fb83" class="mq le ht mf b fv mv ms l mt mu">/**************************************<br/>* Public View Functions (wallet integration)<br/>**************************************/</span><span id="be7e" class="mq le ht mf b fv mv ms l mt mu">// returns the ftp contracts owned by a composable<br/>function ftpContractsOwnedBy(uint256 _tokenId) public view returns(address[]) {<br/>  return ftpContracts[_tokenId];<br/>}</span><span id="df99" class="mq le ht mf b fv mv ms l mt mu">// returns the ftps owned by the composable for a specific ftp contract<br/>function ftpBalanceOf(uint256 _tokenId, address _ftpContract) public view returns(uint256) {<br/>  return ftpBalances[_ftpAddress(_tokenId, _ftpContract)];<br/>}</span><span id="f989" class="mq le ht mf b fv mv ms l mt mu">/**************************************<br/>* Public Transfer and Receive Methods<br/>**************************************/</span><span id="cad0" class="mq le ht mf b fv mv ms l mt mu">function safeTransferFTP(<br/>  address _to, uint256 _tokenId, address _ftpContract, uint256 _value, bytes _data<br/>) public {<br/>  transferFTP(_to, _tokenId, _ftpContract, _value);<br/>  ftpReceived(_ftpContract, _value, _data);<br/>}</span><span id="a4a0" class="mq le ht mf b fv mv ms l mt mu">function onERC20Received(address _from, uint256 _value, bytes _data) public returns(bytes4) {<br/>  ftpReceived(msg.sender, _value, _data);<br/>  return ERC20_RECEIVED;<br/>}</span></pre><p id="1914" class="pw-post-body-paragraph jf jg ht jh b ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc hm dt translated">如果你不编码，不用担心。外行人的解释来了。</p><h2 id="7d52" class="mq le ht bd lf mw mx my lj mz na nb ln jq nc nd lr ju ne nf lv jy ng nh lz ni dt translated">簿记</h2><p id="2eb4" class="pw-post-body-paragraph jf jg ht jh b ji mh jk jl jm mi jo jp jq mj js jt ju mk jw jx jy ml ka kb kc hm dt translated">从顶层的映射开始。您需要跟踪并能够添加和删除ERC-20合同地址。这有助于钱包、交易所和应用程序枚举可能包含几个可替换令牌的特定CNFT的所有合约和余额。</p><p id="ae2a" class="pw-post-body-paragraph jf jg ht jh b ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc hm dt translated">那么为什么<code class="eh mc md me mf b">ftpBalances</code>映射只有1级深(即平坦)？那是因为我使用了一个技巧，在我的<a class="ae kf" rel="noopener" href="/coinmonks/crypto-composables-erc-998-update-1cc437c13664">之前的代码更新</a>中解释过，我称之为“伪地址”。基本上，对于每个在ERC-20合同<code class="eh mc md me mf b">address</code>中有余额的CNFT <code class="eh mc md me mf b">tokenId</code>，我们将创建这些项目的新散列，并将其截断/转换为Solidity中的地址类型。这允许我们以适度的额外计算为代价来避免深度映射和存储浪费。</p><h2 id="7329" class="mq le ht bd lf mw mx my lj mz na nb ln jq nc nd lr ju ne nf lv jy ng nh lz ni dt translated">列举</h2><p id="013b" class="pw-post-body-paragraph jf jg ht jh b ji mh jk jl jm mi jo jp jq mj js jt ju mk jw jx jy ml ka kb kc hm dt translated">钱包、交易所和应用程序都需要了解每个NFT拥有哪些令牌合约和余额。这由public view函数解决，该函数返回所有可替换令牌拥有(FTP)合同的列表，如果提供了所有者<code class="eh mc md me mf b">tokenId</code>和FTP合同<code class="eh mc md me mf b">address</code>，就可以找到平衡。</p><h2 id="5996" class="mq le ht bd lf mw mx my lj mz na nb ln jq nc nd lr ju ne nf lv jy ng nh lz ni dt translated">转移和接收</h2><p id="4a10" class="pw-post-body-paragraph jf jg ht jh b ji mh jk jl jm mi jo jp jq mj js jt ju mk jw jx jy ml ka kb kc hm dt translated">这很重要。目前，将ERC-20移入和移出可组合对象是模仿ERC-721标准的，其中有一个<code class="eh mc md me mf b">ERC20Receiver.sol</code>很像从<code class="eh mc md me mf b">ERC721Receiver.sol</code>中继承的，ERC-20必须触发回调。为了实现这一目标，旧的ERC-20合同需要升级。由于这要么是不可能的，要么是不可取的，仍然可以选择批准，然后从ERC-998内部使用ERC-20的<code class="eh mc md me mf b">transferFrom</code>功能。正如<a class="kd ke gr" href="https://medium.com/u/5ed829dc7d02?source=post_page-----4b160df79836--------------------------------" rel="noopener" target="_blank">米哈伊尔拉里奥诺夫</a> <a class="ae kf" href="https://github.com/ethereum/EIPs/issues/998#issuecomment-383451402" rel="noopener ugc nofollow" target="_blank">在github </a>上指出的，有人试图用ERC-20s来制定回调行为标准。我希望他们能……*咳*😉</p><p id="8085" class="pw-post-body-paragraph jf jg ht jh b ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc hm dt translated">传送只是检查伪地址(<code class="eh mc md me mf b">tokenId</code> x ftp <code class="eh mc md me mf b">address</code>)的<code class="eh mc md me mf b">ftpBalances</code>是否有足够的令牌余额，然后调用该ftp令牌的传送函数。然后我们需要从契约数组中移除ftp契约，并整理好<code class="eh mc md me mf b">ftpBalances</code>。</p><h1 id="f51b" class="ld le ht bd lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma dt translated">是时候标准化了！</h1><figure class="kh ki kj kk fq iu fe ff paragraph-image"><div role="button" tabindex="0" class="iv iw di ix bf iy"><div class="fe ff nj"><img src="../Images/cd07786e25a84179fae82ae0d64c95c0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*r1DsQXRi6UVZENr2ll1GSQ.png"/></div></div><figcaption class="jb jc fg fe ff jd je bd b be z ek">The Future of Decentralized Gaming</figcaption></figure><p id="9148" class="pw-post-body-paragraph jf jg ht jh b ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc hm dt translated">令人惊讶的是，我还没有遇到来自社区的任何负面反应。我通常从人们那里得到两种回答中的一种。周日晚上由<a class="kd ke gr" href="https://medium.com/u/959e75125558?source=post_page-----4b160df79836--------------------------------" rel="noopener" target="_blank"> FOAM </a>主办的纽约策展市场会议也不例外:</p><ol class=""><li id="f00c" class="nk nl ht jh b ji jj jm jn jq nm ju nn jy no kc np nq nr ns dt translated">我不明白。真的吗？太酷了！我想你可以用它来做X Y Z？</li><li id="f5d1" class="nk nl ht jh b ji nt jm nu jq nv ju nw jy nx kc np nq nr ns dt translated">几个月前我就想到了这个，我写了一些代码来做这个，我想用这个！</li></ol><p id="79a6" class="pw-post-body-paragraph jf jg ht jh b ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc hm dt translated"><strong class="jh hu">太好了！</strong>无论哪种方式。让我们作为一个社区一起努力<strong class="jh hu">来建造它！</strong></p><p id="7899" class="pw-post-body-paragraph jf jg ht jh b ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc hm dt translated">正如我在“<a class="ae kf" rel="noopener" href="/coinmonks/blockchain-standards-are-eating-the-world-6bc4b59e297f">区块链标准正在吞噬世界</a>”中解释的那样，如果我们继续在孤岛中构建协议，我们将面临分散的、点对点的价值创造和交换被现任者吸收的风险。这种<strong class="jh hu">不可能</strong>发生！我们必须努力，“<a class="ae kf" href="https://blog.oceanprotocol.com/towards-a-hierarchy-of-token-building-blocks-6c8dd7b42341" rel="noopener ugc nofollow" target="_blank">走向一个代币积木的层级</a>”，否则以太坊社区和其他连锁店将失去其相关性，如果不被大众接受的话。简而言之，标准很重要，原因如下:</p><p id="85e3" class="pw-post-body-paragraph jf jg ht jh b ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc hm dt translated">我发送给你一个由“非标准”协议<strong class="jh hu"> X </strong>构建的CNFT，你在只实现CNFT接口<strong class="jh hu"> Z </strong>的Wallet中打开它，Wallet <strong class="jh hu"> Y </strong>无法枚举，因此你<strong class="jh hu">无法</strong>看到我发送给你的Composable的任何内容。这是很糟糕的用户体验。这也将使dapps和cryptoassets的采用陷入停滞。尤其是不可替代的令牌，它非常有希望形成更复杂的资产和第二层的构建块。参见<a class="ae kf" href="https://userfeeds.io/" rel="noopener ugc nofollow" target="_blank"> userfeeds.io </a>和<a class="ae kf" href="https://www.cryptogoods.net/" rel="noopener ugc nofollow" target="_blank">cryptogoods.net</a>。</p><h1 id="7507" class="ld le ht bd lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma dt translated">包扎</h1><figure class="kh ki kj kk fq iu fe ff paragraph-image"><div role="button" tabindex="0" class="iv iw di ix bf iy"><div class="fe ff ny"><img src="../Images/b2da0fd1d4a388765cf31c753dfd9152.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rq6MHTCBFOEv39XuHQyaDg.jpeg"/></div></div><figcaption class="jb jc fg fe ff jd je bd b be z ek">Curation Markets meetup with <a class="kd ke gr" href="https://medium.com/u/372146c430f5?source=post_page-----4b160df79836--------------------------------" rel="noopener" target="_blank">Jess Sloss</a> hosted by <a class="kd ke gr" href="https://medium.com/u/959e75125558?source=post_page-----4b160df79836--------------------------------" rel="noopener" target="_blank">FOAM</a></figcaption></figure><p id="6413" class="pw-post-body-paragraph jf jg ht jh b ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc hm dt translated">ERC-998 的全功能实施草图被装载，列车即将离开车站。现在是时候参与进来了！我是100%可接触的，公开透明的。我知道每个人都有项目要做，但是标准很重要，从长远来看会影响你的项目。我已经<a class="ae kf" href="https://twitter.com/mattdlockyer/status/994220700129935360?s=20" rel="noopener ugc nofollow" target="_blank">申请了以太坊基金会的资助</a>来资助我的好友<a class="kd ke gr" href="https://medium.com/u/194c20cf90b6?source=post_page-----4b160df79836--------------------------------" rel="noopener" target="_blank">凯文·奥沃基</a>和<a class="kd ke gr" href="https://medium.com/u/6263e72bcb5d?source=post_page-----4b160df79836--------------------------------" rel="noopener" target="_blank">马克·贝林</a>在他们的网络上解决以下问题:</p><ul class=""><li id="4a09" class="nk nl ht jh b ji jj jm jn jq nm ju nn jy no kc nz nq nr ns dt translated">就接口达成一致</li><li id="695b" class="nk nl ht jh b ji nt jm nu jq nv ju nw jy nx kc nz nq nr ns dt translated">最大限度降低天然气成本</li><li id="e768" class="nk nl ht jh b ji nt jm nu jq nv ju nw jy nx kc nz nq nr ns dt translated">强化实施安全性</li><li id="d6dc" class="nk nl ht jh b ji nt jm nu jq nv ju nw jy nx kc nz nq nr ns dt translated">扩展性回调</li><li id="6453" class="nk nl ht jh b ji nt jm nu jq nv ju nw jy nx kc nz nq nr ns dt translated">还有更多…</li></ul><p id="e11c" class="pw-post-body-paragraph jf jg ht jh b ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc hm dt translated">如果你有兴趣帮忙，请告诉我！</p><p id="17b6" class="pw-post-body-paragraph jf jg ht jh b ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc hm dt translated"><a class="ae kf" rel="noopener" href="/@mattdlockyer">medium.com/@mattdlockyer</a>T24<a class="ae kf" href="https://twitter.com/mattdlockyer" rel="noopener ugc nofollow" target="_blank">twitter.com/mattdlockyer</a>T27】T28】linkedin.com/in/mattlockyer</p><div class="kl km fm fo kn ko"><a href="https://github.com/ethereum/EIPs/issues/998" rel="noopener  ugc nofollow" target="_blank"><div class="kp ab ej"><div class="kq ab kr cl cj ks"><h2 class="bd hu fv z el kt eo ep ku er et hs dt translated">ERC-998可组合不可替换令牌标准发行#998以太坊/EIPs</h2><div class="kv l"><h3 class="bd b fv z el kt eo ep ku er et ek translated">标题:ERC-998可组合不可替换令牌标准作者:马特·洛克耶(github: mattlockyer)状态:草案类型…</h3></div><div class="kw l"><p class="bd b gc z el kt eo ep ku er et ek translated">github.com</p></div></div><div class="kx l"><div class="oa l kz la lb kx lc iz ko"/></div></div></a></div></div></div>    
</body>
</html>