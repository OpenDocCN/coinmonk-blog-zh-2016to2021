<html>
<head>
<title>Ethereum Dapp with Vuejs app</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">以太坊Dapp和Vuejs应用</h1>
<blockquote>原文：<a href="https://medium.com/coinmonks/ethereum-dapp-with-vuejs-app-ec56ac8c5951?source=collection_archive---------0-----------------------#2019-08-09">https://medium.com/coinmonks/ethereum-dapp-with-vuejs-app-ec56ac8c5951?source=collection_archive---------0-----------------------#2019-08-09</a></blockquote><div><div class="ef hh hi hj hk hl"/><div class="hm hn ho hp hq"><div class=""/><p id="df71" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">在本文中，我将展示一个简单的<em class="jo"> Dapp </em>和<em class="jo"> Vuejs </em>应用程序来管理以太网中的支付。</p><figure class="jq jr js jt fq ju fe ff paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="fe ff jp"><img src="../Images/81c6516c346d96f36dda6e4856806442.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3M2BCeasNrTNaiT5-Y9z2A.jpeg"/></div></div></figure><p id="2445" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">该应用程序包括一个管理支付的<em class="jo"> Dapp </em>和一个实现使用<em class="jo"> Dapp </em>进行支付的<em class="jo">购物车</em>的<a class="ae kb" href="https://vuejs.org/" rel="noopener ugc nofollow" target="_blank">vue jsT9】应用程序。</a></p><p id="5840" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">您将在该应用中发现的有用问题:</p><ul class=""><li id="ec1b" class="kc kd ht is b it iu ix iy jb ke jf kf jj kg jn kh ki kj kk dt translated">Solidity开发的<em class="jo">以太坊</em>智能合约示例</li><li id="29fe" class="kc kd ht is b it kl ix km jb kn jf ko jj kp jn kh ki kj kk dt translated"><a class="ae kb" href="https://vuejs.org/" rel="noopener ugc nofollow" target="_blank"> <em class="jo"> Vuejs </em> </a> app使用<a class="ae kb" href="https://vuex.vuejs.org/" rel="noopener ugc nofollow" target="_blank"> <em class="jo"> Vuex </em> </a>和<a class="ae kb" href="https://router.vuejs.org/" rel="noopener ugc nofollow" target="_blank"> <em class="jo"> Vue路由器</em> </a>的例子</li><li id="9991" class="kc kd ht is b it kl ix km jb kn jf ko jj kp jn kh ki kj kk dt translated"><a class="ae kb" href="https://vuejs.org/" rel="noopener ugc nofollow" target="_blank"> <em class="jo"> Vuejs </em> </a> app与<em class="jo">以太坊</em>网络的集成</li><li id="af8a" class="kc kd ht is b it kl ix km jb kn jf ko jj kp jn kh ki kj kk dt translated">将<a class="ae kb" href="https://metamask.io/" rel="noopener ugc nofollow" target="_blank">元掩码</a>用作以太坊钱包</li></ul><p id="953e" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">该项目发布在github<a class="ae kb" href="https://github.com/joaquin-alfaro/ethereum-payment-vuejs" rel="noopener ugc nofollow" target="_blank">https://github.com/joaquin-alfaro/ethereum-payment-vuejs</a>上</p><h1 id="c32b" class="kq kr ht bd ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln dt translated">Dapp管理支付</h1><p id="162d" class="pw-post-body-paragraph iq ir ht is b it lo iv iw ix lp iz ja jb lq jd je jf lr jh ji jj ls jl jm jn hm dt translated">Dapp的目标是管理在线商店中的以太网支付。dapp的要求是:</p><ul class=""><li id="f953" class="kc kd ht is b it iu ix iy jb ke jf kf jj kg jn kh ki kj kk dt translated">提供以以太网支付的方法。</li><li id="a006" class="kc kd ht is b it kl ix km jb kn jf ko jj kp jn kh ki kj kk dt translated">用以下信息存储付款:买方帐户、购买参考、付款日期和金额</li><li id="52b2" class="kc kd ht is b it kl ix km jb kn jf ko jj kp jn kh ki kj kk dt translated">收取一系列款项。</li><li id="8b80" class="kc kd ht is b it kl ix km jb kn jf ko jj kp jn kh ki kj kk dt translated">管理资金。</li></ul><h2 id="23ea" class="lt kr ht bd ks lu lv lw kw lx ly lz la jb ma mb le jf mc md li jj me mf lm mg dt translated">智能合同</h2><p id="5375" class="pw-post-body-paragraph iq ir ht is b it lo iv iw ix lp iz ja jb lq jd je jf lr jh ji jj ls jl jm jn hm dt translated">上述要求在以下智能合同中实施:</p><figure class="jq jr js jt fq ju"><div class="bz el l di"><div class="mh mi l"/></div></figure><h2 id="a4f2" class="lt kr ht bd ks lu lv lw kw lx ly lz la jb ma mb le jf mc md li jj me mf lm mg dt translated"><strong class="ak">智能合同的主要问题:</strong></h2><p id="1a02" class="pw-post-body-paragraph iq ir ht is b it lo iv iw ix lp iz ja jb lq jd je jf lr jh ji jj ls jl jm jn hm dt translated"><strong class="is hu"> <em class="jo">回退功能</em> </strong></p><p id="8830" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">当事务中调用的方法不存在时，回退函数用作默认函数。回退的主要目的是允许合同接收以太网。</p><pre class="jq jr js jt fq mj mk ml mm aw mn dt"><span id="8ff5" class="lt kr ht mk b fv mo mp l mq mr">function() external payable {</span><span id="164e" class="lt kr ht mk b fv ms mp l mq mr">  require (msg.data.length == 0, 'The called function does not   exist');</span><span id="8bd8" class="lt kr ht mk b fv ms mp l mq mr">}</span></pre><p id="1212" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated"><strong class="is hu">事件<em class="jo">事件</em>事件</strong></p><p id="df79" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">智能合约使用事件来记录操作。外部应用程序订阅这些日志以获得通知。</p><p id="5b50" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">在这种情况下，协定为每次付款发出一个事件</p><pre class="jq jr js jt fq mj mk ml mm aw mn dt"><span id="89a0" class="lt kr ht mk b fv mo mp l mq mr">// Event to notify payments<br/>event Pay(address, string, uint);</span><span id="27d8" class="lt kr ht mk b fv ms mp l mq mr">// Payment function<br/>function pay(string memory id, uint value) public payable {<br/>    require(msg.value == value, 'The payment does not match the value of the transaction');</span><span id="bcb4" class="lt kr ht mk b fv ms mp l mq mr">    payments[msg.sender].push(Payment(id, msg.value, block.timestamp));</span><span id="24ad" class="lt kr ht mk b fv ms mp l mq mr">    // Emits event "Pay" to notify the payment<br/>    emit Pay(msg.sender, id, msg.value);</span><span id="def7" class="lt kr ht mk b fv ms mp l mq mr">}</span></pre><p id="c41c" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated"><strong class="is hu"> <em class="jo">两个功能列出付款</em> </strong></p><p id="b43b" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">目前，不可能从函数中返回结构列表，一种变通方法是使用两个函数，第一个函数获取元素的数量，第二个函数通过索引获取元素。</p><p id="a1c6" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">在这种情况下，的<em class="jo">payments返回账户的支付次数，而<em class="jo"> paymentsOfAt </em>返回支付列表中某个位置的账户的支付次数。</em></p><pre class="jq jr js jt fq mj mk ml mm aw mn dt"><span id="174c" class="lt kr ht mk b fv mo mp l mq mr">function paymentsOf(address buyer) public view returns (uint) {<br/>    return payments[buyer].length;<br/>}</span><span id="c5fc" class="lt kr ht mk b fv ms mp l mq mr">function paymentOfAt(address buyer, uint256 index) public view returns (string memory, uint256 amount, uint256 date) {<br/>    Payment[] memory pays = payments[buyer];<br/>    require(pays.length &gt; index, "Payment does not exist");<br/>    Payment memory payment = pays[index];<br/>    <br/>    return (payment.id, payment.amount, payment.date);<br/>}</span></pre><h2 id="f05c" class="lt kr ht bd ks lu lv lw kw lx ly lz la jb ma mb le jf mc md li jj me mf lm mg dt translated"><strong class="ak">戴普大厦</strong></h2><p id="2ca3" class="pw-post-body-paragraph iq ir ht is b it lo iv iw ix lp iz ja jb lq jd je jf lr jh ji jj ls jl jm jn hm dt translated">构建智能合约可以使用<a class="ae kb" href="https://github.com/ethereum/solidity" rel="noopener ugc nofollow" target="_blank"> <em class="jo"> solc </em> </a>或<a class="ae kb" href="https://github.com/ethereum/solc-js" rel="noopener ugc nofollow" target="_blank"> <em class="jo"> solcjs </em> </a> <em class="jo">。</em>为了简单起见，我决定使用<em class="jo"> solcjs </em>，因为它是作为<em class="jo"> npm </em>模块提供的，并且不需要下载或构建<em class="jo"> solc </em>编译器。</p><pre class="jq jr js jt fq mj mk ml mm aw mn dt"><span id="4dfa" class="lt kr ht mk b fv mo mp l mq mr">const solc = require('solc')</span><span id="3976" class="lt kr ht mk b fv ms mp l mq mr">solc.compile(JSON.stringify(sources))</span></pre><h2 id="3cb7" class="lt kr ht bd ks lu lv lw kw lx ly lz la jb ma mb le jf mc md li jj me mf lm mg dt translated"><strong class="ak"> Dapp测试</strong></h2><p id="f2d2" class="pw-post-body-paragraph iq ir ht is b it lo iv iw ix lp iz ja jb lq jd je jf lr jh ji jj ls jl jm jn hm dt translated">对于Dapp测试，我将使用<a class="ae kb" href="https://mochajs.org/" rel="noopener ugc nofollow" target="_blank"> <em class="jo"> mocha </em> </a>作为测试框架，使用<a class="ae kb" href="https://github.com/trufflesuite/ganache-cli" rel="noopener ugc nofollow" target="_blank"> Ganache CLI </a>作为以太坊客户端模拟器。</p><figure class="jq jr js jt fq ju"><div class="bz el l di"><div class="mh mi l"/></div></figure><h2 id="323a" class="lt kr ht bd ks lu lv lw kw lx ly lz la jb ma mb le jf mc md li jj me mf lm mg dt translated">使用Vuejs的购物车</h2><p id="08b5" class="pw-post-body-paragraph iq ir ht is b it lo iv iw ix lp iz ja jb lq jd je jf lr jh ji jj ls jl jm jn hm dt translated"><a class="ae kb" href="https://vuejs.org/" rel="noopener ugc nofollow" target="_blank"> Vuejs </a>是一个类似于<a class="ae kb" href="https://angular.io/" rel="noopener ugc nofollow" target="_blank"> Angular </a>和<a class="ae kb" href="https://reactjs.org/" rel="noopener ugc nofollow" target="_blank"> React </a>的UI框架，其主要特点是可以覆盖两者的需求。</p><p id="b7f7" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">该项目已使用<a class="ae kb" href="https://cli.vuejs.org/" rel="noopener ugc nofollow" target="_blank"> vue-cli </a>创建，并使用<a class="ae kb" href="https://vuex.vuejs.org/" rel="noopener ugc nofollow" target="_blank"> vuex </a>进行状态管理(vue的flux版本)和<a class="ae kb" href="https://router.vuejs.org/" rel="noopener ugc nofollow" target="_blank"> vue-router </a>进行组件路由。</p><p id="0f4d" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">项目的结构:</p><pre class="jq jr js jt fq mj mk ml mm aw mn dt"><span id="61f4" class="lt kr ht mk b fv mo mp l mq mr">public<br/> └── assets     # Public images<br/>src<br/> ├── assets     # Images, css and js<br/> ├── components # Vue components<br/> ├── domain     # Business logic. Interaction with smart contracts<br/> └── views      # Vue components as page purposing</span></pre><h2 id="57ae" class="lt kr ht bd ks lu lv lw kw lx ly lz la jb ma mb le jf mc md li jj me mf lm mg dt translated">畴层</h2><p id="4983" class="pw-post-body-paragraph iq ir ht is b it lo iv iw ix lp iz ja jb lq jd je jf lr jh ji jj ls jl jm jn hm dt translated"><em class="jo">域</em>文件夹将作为Dapp中<em class="jo">视图</em>和业务逻辑之间的链接</p><blockquote class="mt mu mv"><p id="dd33" class="iq ir jo is b it iu iv iw ix iy iz ja mw jc jd je mx jg jh ji my jk jl jm jn hm dt translated">尽管区块链充当模型层，但它也在智能合约中提供业务逻辑</p></blockquote><p id="a3cc" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">域文件夹包含一个javascript类。这些类将智能合约的方法与视图层要使用的函数进行映射。它就像一个对象关系映射，但是除了数据之外，还有智能契约和映射<em class="jo">业务逻辑</em>。</p><figure class="jq jr js jt fq ju"><div class="bz el l di"><div class="mh mi l"/></div><figcaption class="mz na fg fe ff nb nc bd b be z ek">Javascript class mapping Payments.sol smart contract</figcaption></figure><h1 id="9a8f" class="kq kr ht bd ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln dt translated">使用</h1><ol class=""><li id="e110" class="kc kd ht is b it lo ix lp jb nd jf ne jj nf jn ng ki kj kk dt translated">在节点中设置并启动应用程序</li></ol><pre class="jq jr js jt fq mj mk ml mm aw mn dt"><span id="d5ae" class="lt kr ht mk b fv mo mp l mq mr">$ npm install</span><span id="a9da" class="lt kr ht mk b fv ms mp l mq mr">$ npm run serve</span></pre><p id="c837" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">2.在浏览器中安装Metamask插件。【https://metamask.io/ T42】</p><figure class="jq jr js jt fq ju fe ff paragraph-image"><div class="fe ff nh"><img src="../Images/ae7f152a321fc42b8e0b67034f380316.png" data-original-src="https://miro.medium.com/v2/resize:fit:540/format:webp/1*28Qt_NhdBZup-RKLuI8q_g.png"/></div><figcaption class="mz na fg fe ff nb nc bd b be z ek">Metamask plugin</figcaption></figure><p id="4d2e" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">3.从<a class="ae kb" href="http://localhost:8080/#/payments" rel="noopener ugc nofollow" target="_blank">http://localhost:8080/#/Payments</a>创建支付合同</p><figure class="jq jr js jt fq ju fe ff paragraph-image"><div class="fe ff ni"><img src="../Images/77883b815da43efaa3d7a9b9343ed217.png" data-original-src="https://miro.medium.com/v2/resize:fit:864/format:webp/1*OKIrALTWvItBIKJkRO-VAw.png"/></div><figcaption class="mz na fg fe ff nb nc bd b be z ek">Component to create or load existing contract in Ethereum network</figcaption></figure><p id="a01e" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">一旦在区块链网络中创建了合同，就会显示详细信息</p><figure class="jq jr js jt fq ju fe ff paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="fe ff nj"><img src="../Images/4b1b67e166f901dac99f8a29ed721261.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SUgyufX7Q2LdBz4jPp_E3Q.png"/></div></div><figcaption class="mz na fg fe ff nb nc bd b be z ek">Detail of payment contract</figcaption></figure><p id="cffc" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">4.转到购物车。<a class="ae kb" href="http://localhost:8080/#/shopping" rel="noopener ugc nofollow" target="_blank">http://localhost:8080/#/shopping</a></p><figure class="jq jr js jt fq ju fe ff paragraph-image"><div class="fe ff nk"><img src="../Images/a13f05d7f3fac28534a90daf17f56c8b.png" data-original-src="https://miro.medium.com/v2/resize:fit:872/format:webp/1*rxmDWp8rLk0BIuApbb4cYA.png"/></div><figcaption class="mz na fg fe ff nb nc bd b be z ek">Shopping cart</figcaption></figure><p id="143c" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">5.往篮子里放一些水果，然后付款。</p><figure class="jq jr js jt fq ju fe ff paragraph-image"><div class="fe ff nl"><img src="../Images/ef9556e1626da183baf67e21e1e5729b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1088/format:webp/1*pXT0CWmgybrUNhn9uuuGNg.png"/></div></figure><p id="afef" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">一旦支付交易在区块链提交，将被重定向至支付合同的详细信息。详细信息将显示您的购买情况。</p><figure class="jq jr js jt fq ju fe ff paragraph-image"><div class="fe ff nm"><img src="../Images/4ecd6cf0fa150a20c24dee3da0811f6c.png" data-original-src="https://miro.medium.com/v2/resize:fit:996/format:webp/1*v5WNR5EMiu_sSUjWdeTb3A.png"/></div><figcaption class="mz na fg fe ff nb nc bd b be z ek">Detail of contract showing payments</figcaption></figure><p id="9a84" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">6.从付款合同中提取资金到业主账户。<a class="ae kb" href="http://localhost:8080/#/payments" rel="noopener ugc nofollow" target="_blank">http://localhost:8080/#/payments</a></p><figure class="jq jr js jt fq ju fe ff paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="fe ff nn"><img src="../Images/6ebd7652c0e554a484d7345238ff1c12.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LgItF4mc6ptRQYUvgckIWw.png"/></div></div><figcaption class="mz na fg fe ff nb nc bd b be z ek">Withdraw of funds from Payments contract</figcaption></figure><h1 id="0577" class="kq kr ht bd ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln dt translated">GitHub上的知识库</h1><div class="no np fm fo nq nr"><a href="https://github.com/joaquin-alfaro/ethereum-payment-vuejs" rel="noopener  ugc nofollow" target="_blank"><div class="ns ab ej"><div class="nt ab nu cl cj nv"><h2 class="bd hu fv z el nw eo ep nx er et hs dt translated">华金-阿尔法罗/以太坊-付款-vuejs</h2><div class="ny l"><h3 class="bd b fv z el nw eo ep nx er et ek translated">管理以太网支付的简单应用程序。</h3></div><div class="nz l"><p class="bd b gc z el nw eo ep nx er et ek translated">github.com</p></div></div><div class="oa l"><div class="ob l oc od oe oa of jz nr"/></div></div></a></div><blockquote class="og"><p id="c905" class="oh oi ht bd oj ok ol om on oo op jn ek translated"><a class="ae kb" href="https://coincodecap.com/?utm_source=coinmonks" rel="noopener ugc nofollow" target="_blank">在您的收件箱中直接获得最佳软件交易</a></p></blockquote><figure class="or os ot ou ov ju fe ff paragraph-image"><a href="https://coincodecap.com/?utm_source=coinmonks"><div class="fe ff oq"><img src="../Images/7c0b3dfdcbfea594cc0ae7d4f9bf6fcb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1168/format:webp/0*OJ-qb5G6i863msBB.png"/></div></a></figure></div></div>    
</body>
</html>