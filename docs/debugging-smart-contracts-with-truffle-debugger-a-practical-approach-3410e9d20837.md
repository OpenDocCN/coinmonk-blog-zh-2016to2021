# ç”¨ Truffle è°ƒè¯•å™¨è°ƒè¯•æ™ºèƒ½åˆçº¦:ä¸€ç§å®žç”¨çš„æ–¹æ³•

> åŽŸæ–‡ï¼š<https://medium.com/coinmonks/debugging-smart-contracts-with-truffle-debugger-a-practical-approach-3410e9d20837?source=collection_archive---------0----------------------->

![](img/b96ab0cb5501a2934a7b1d242b691ad5.png)

> *ç»™è¶³äº†çœ¼çƒï¼Œæ‰€æœ‰çš„ bug éƒ½æ˜¯æµ…çš„ã€‚~* [*èŽ±çº³æ–¯å®šå¾‹*](https://en.wikiquote.org/wiki/Linus_Torvalds)

è™«å­ï¼bug æ˜¯å¤–æ˜Ÿäººï¼Œä»–ä»¬åœ¨æ™šä¸Šæ²¡äººæ³¨æ„çš„æ—¶å€™æ½œå…¥ç¨‹åºå‘˜çš„ä»£ç ï¼Œæ”¹å˜ä»£ç çš„çŠ¶æ€ã€‚è¿™äº›å¤–æ˜Ÿäººåªæœ‰ä¸€ä¸ªä½¿å‘½â€”â€”æŒ«è´¥ä¸€ä¸ªç¨‹åºå‘˜çš„ç”Ÿæ´»ã€‚ç¨‹åºå‘˜å¦‚ä½•åœ¨æ²®ä¸§è€Œæ­»ä¹‹å‰æ€æ­»ä¸€ä¸ª bugï¼Ÿæ˜¯çš„ï¼Œä½ çŒœå¯¹äº†ï¼é€šè¿‡è°ƒè¯•å’Œåˆ é™¤æœ‰é—®é¢˜çš„ä»£ç ã€‚ä½†æ˜¯ä¸ºä»€ä¹ˆä¸€ä¸ªç¨‹åºå‘˜ä¼šåœ¨æ²¡æœ‰åˆé€‚å·¥å…·çš„æƒ…å†µä¸‹æŠ•å…¥è°ƒè¯•æˆ˜äº‰å‘¢ï¼Ÿå¦‚æžœç¨‹åºå‘˜è¦è°ƒè¯•ï¼Œä»–æœ€å¥½ç”¨æ­£ç¡®çš„æ–¹æ³•ï¼Œä½¿ç”¨æ­£ç¡®çš„å·¥å…·ã€‚

> *å¦‚æžœè¯´è°ƒè¯•æ˜¯åŽ»é™¤è½¯ä»¶ bug çš„è¿‡ç¨‹ï¼Œé‚£ä¹ˆç¼–ç¨‹ä¸€å®šæ˜¯æŠŠ bug æ”¾è¿›åŽ»çš„è¿‡ç¨‹ã€‚~* [*åŸƒå¾·æ ¼Â·è¿ªæ°æ–¯ç‰¹æ‹‰*](https://en.wikiquote.org/wiki/Edsger_W._Dijkstra)

åœ¨æ™ºèƒ½åˆçº¦å¼€å‘ä¸­ï¼Œåƒä¼ ç»Ÿçš„é›†ä¸­å¼è½¯ä»¶å¼€å‘ä¸€æ ·ï¼Œåœ¨æ™ºèƒ½åˆçº¦çš„å¼€å‘ç”Ÿå‘½å‘¨æœŸä¸­ï¼Œbug ä¼šæ½œå…¥æ™ºèƒ½åˆçº¦å¼€å‘äººå‘˜çš„ä»£ç ä¸­ã€‚è™½ç„¶æ™ºèƒ½åˆçº¦å¯èƒ½å­˜åœ¨æ¼æ´žæœ‰â€œå¤ªå¤šâ€çš„åŽŸå› ï¼Œä½†æœ‰ä¸€ç‚¹ä»ç„¶å¾ˆé‡è¦ï¼Œåœ¨æ™ºèƒ½åˆçº¦éƒ¨ç½²åˆ° mainnet ä¹‹å‰ï¼Œå¿…é¡»æ¶ˆé™¤æ‰€æœ‰çš„æ¼æ´žï¼Œå¦åˆ™ï¼Œæˆ‘ä»¬å°†é¢ä¸´èµ„é‡‘æŸå¤±çš„é£Žé™©ï¼Œå¹¶æœ€ç»ˆå¤±åŽ»æ™ºèƒ½åˆçº¦çš„å¯ä¿¡åº¦ã€‚

åœ¨ solidity ä¸­æœ‰å‡ ä¸ªå¼€å‘æ™ºèƒ½åˆåŒçš„æ¡†æž¶ã€‚åœ¨æœ¬æ–‡ä¸­ï¼Œé‡ç‚¹æ˜¯ Truffle æ¡†æž¶ã€‚ [Truffle æ—¨åœ¨é€šè¿‡ä¸ºæ™ºèƒ½åˆçº¦å¼€å‘æä¾›å¼€å‘çŽ¯å¢ƒã€æµ‹è¯•æ¡†æž¶å’Œè°ƒè¯•å·¥å…·ï¼Œä½¿å¼€å‘äººå‘˜çš„ç”Ÿæ´»æ›´åŠ è½»æ¾](https://truffleframework.com/truffle)ã€‚æ™ºèƒ½åˆçº¦é”™è¯¯å¯èƒ½å¾ˆéš¾å‘çŽ°ï¼Œé”™è¯¯æ¶ˆæ¯å¯èƒ½å¾ˆéš¾ç†è§£ã€‚å½“ä½¿ç”¨ Truffle æž„å»ºæ™ºèƒ½å¥‘çº¦æ—¶ï¼ŒTruffle è°ƒè¯•å™¨åœ¨è°ƒè¯•å¥‘çº¦æ—¶éžå¸¸æ–¹ä¾¿ã€‚ ***è¿™æ˜¯å› ä¸ºåœ¨è°ƒè¯•æ™ºèƒ½åˆçº¦æ—¶ï¼Œä½ ä¸æ˜¯åœ¨å®žæ—¶è¿è¡Œä»£ç ï¼›ç›¸åï¼Œæ‚¨å°†æ­¥å…¥è¯¥äº‹åŠ¡åœ¨åŒºå—é“¾ä¸Šçš„åŽ†å²æ‰§è¡Œï¼Œå¹¶å°†è¯¥æ‰§è¡Œæ˜ å°„åˆ°å…¶å…³è”çš„ä»£ç ä¸Šã€‚ä¼ ç»Ÿä¸Šæ¥è¯´ï¼Œè¿™ç§è°ƒè¯•è¿‡ç¨‹å¯èƒ½æ˜¯ä¹å‘³çš„ï¼Œè€Œè¿™æ­£æ˜¯ Truffle è°ƒè¯•å™¨çœŸæ­£æœ‰ç”¨çš„åœ°æ–¹â€”â€”åªè¦æˆ‘ä»¬æœ‰ä»£ç å’Œäº‹åŠ¡çš„å·¥ä»¶ï¼Œæˆ‘ä»¬å°±å¯ä»¥è°ƒè¯•ä»»ä½•äº‹åŠ¡ã€‚è®©æˆ‘ä»¬ç®€å•è°ˆè°ˆ Truffle è°ƒè¯•å™¨ï¼Œç„¶åŽä¸¾ä¸€ä¸ªä¾‹å­æ¥è¯´æ˜Žå¦‚ä½•ä½¿ç”¨è¿™ä¸ªå·¥å…·ã€‚***

> *è°ƒè¯•æ˜¯ä¸€ä¸ªæ¶‰åŠæ‰§è¡Œæµ‹è¯•å’Œä»£ç ä¿®æ­£çš„å¾ªçŽ¯æ´»åŠ¨ã€‚*

# Truffle è°ƒè¯•å™¨

Truffle Debugger æ˜¯ä¸€ä¸ªé›†æˆåˆ° Truffle æ¡†æž¶ä¸­çš„å‘½ä»¤è¡Œå·¥å…·ï¼Œå®ƒå…è®¸ä½¿ç”¨æ™ºèƒ½åˆçº¦ä»£ç å’Œäº¤æ˜“å·¥ä»¶æ¥è°ƒè¯•æ™ºèƒ½åˆçº¦äº¤æ˜“ã€‚å½“è°ƒè¯•å™¨å¯åŠ¨æ—¶ï¼Œå‘½ä»¤è¡Œç•Œé¢æä¾›åœ¨äº‹åŠ¡è¿‡ç¨‹ä¸­å¤„ç†æˆ–åˆ›å»ºçš„åœ°å€åˆ—è¡¨ã€äº‹åŠ¡çš„åˆå§‹å…¥å£ç‚¹ä»¥åŠä½¿ç”¨è°ƒè¯•å™¨çš„å¯ç”¨å‘½ä»¤åˆ—è¡¨ã€‚ä¸‹é¢çªå‡ºæ˜¾ç¤ºäº†ä¸€äº›è°ƒè¯•å™¨å‘½ä»¤:

![](img/5c7dba7663a5cc3e3b97ff00b258ad29.png)

`[o] step over`:

è¯¥å‘½ä»¤è¯„ä¼°ç”±è™šæ‹Ÿæœºç›¸å¯¹äºŽåå®šè¯„ä¼°çš„æŒ‡ä»¤ï¼Œç›´åˆ°å½“å‰æ™ºèƒ½åå®šæ–‡ä»¶ä¸­çš„ä¸‹ä¸€è¡Œï¼Œè·³è¿‡åœ¨å½“å‰æ‰§è¡Œç‚¹å¼•ç”¨çš„å‡½æ•°(å¦‚æžœæœ‰)ã€‚

`[i] step into`:

è¯¥å‘½ä»¤è¿›å…¥åœ¨å½“å‰æ‰§è¡Œç‚¹è°ƒç”¨çš„å‡½æ•°ã€‚

`[u] step out`:

è¯¥å‘½ä»¤å°†ä½¿è°ƒè¯•å™¨è·³å‡ºå½“å‰å‡½æ•°ï¼Œç›´æŽ¥æ‰§è¡Œä¸‹ä¸€è¡Œã€‚

`[n] step next`:

æ­¤å‘½ä»¤ä¼šå•æ­¥æ‰§è¡Œå½“å‰è°ƒç”¨çš„å‡½æ•°ä¸­çš„ä¸‹ä¸€ä¸ªé€»è¾‘è¯­å¥æˆ–è¡¨è¾¾å¼ã€‚

`[;] step instruction`:

è¯¥å‘½ä»¤å•æ­¥æ‰§è¡Œç”±è™šæ‹Ÿæœºè¯„ä¼°çš„æ¯ä¸ªå•ç‹¬çš„æŒ‡ä»¤ã€‚

ä½ å¯ä»¥åœ¨è¿™é‡ŒæŸ¥çœ‹å…¶ä»–å‘½ä»¤

åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬å·²ç»è®¨è®ºäº†è°ƒè¯•å’Œ Truffle è°ƒè¯•å™¨ï¼Œè®©æˆ‘ä»¬ç”¨ä¸€ä¸ªä¾‹å­æ¥çœŸæ­£ç†è§£å®ƒã€‚

# è°ƒè¯• FoodCart æ™ºèƒ½åˆçº¦

ä¸‹é¢çš„æ™ºèƒ½åˆåŒæ¨¡æ‹Ÿäº†ä¸€ä¸ªç®€å•çš„é£Ÿå“æŽ¨è½¦ï¼Œå®ƒå…è®¸ä»»ä½•äººå°†é£Ÿå“æ·»åŠ åˆ°æŽ¨è½¦ä¸Šè¿›è¡Œé”€å”®ï¼Œä¹Ÿå…è®¸ä»»ä½•æœ‰è¶³å¤Ÿä¹™é†šçš„äººä»ŽæŽ¨è½¦ä¸Šè´­ä¹°é£Ÿå“ã€‚æ­¤å¥‘çº¦ä»…ç”¨äºŽè¯´æ˜Žç›®çš„ï¼Œä¸åº”åœ¨ç”Ÿäº§çŽ¯å¢ƒä¸­ä½¿ç”¨ã€‚åœ¨æˆ‘ä»¬å¼€å§‹æœ¬ç¤ºä¾‹ä¹‹å‰ï¼Œéœ€è¦éµå¾ªä»¥ä¸‹è¦æ±‚æ‰èƒ½é¡ºåˆ©å®Œæˆæœ¬ç¤ºä¾‹:

1.  æ¾éœ² 4.0 æˆ–ä»¥ä¸Š
2.  Solidity ç¼–è¯‘å™¨ç‰ˆæœ¬ 0.4.24 æˆ–ä»¥ä¸Š
3.  ç§æœ‰åŒºå—é“¾(Ganache CLI v6.1.6 æˆ–æ›´é«˜ç‰ˆæœ¬)

æœ¬æ–‡çš„å­˜å‚¨åº“å¯ä»¥åœ¨[è¿™é‡Œ](https://github.com/mayorcoded/FoodCartTutorial)æ‰¾åˆ°ï¼Œä»¥é˜²æ‚¨æƒ³åœ¨ä¸ç¼–å†™æ™ºèƒ½å¥‘çº¦çš„æƒ…å†µä¸‹å®Œæˆè°ƒè¯•è¿‡ç¨‹ã€‚

## `Step 1: Building the smart contract`

*   è®©æˆ‘ä»¬é¦–å…ˆä¸ºè¿™ä¸ªé¡¹ç›®åˆ›å»ºä¸€ä¸ªç›®å½•ï¼Œå¹¶æž„å»ºæ™ºèƒ½å¥‘çº¦ã€‚åœ¨ç»ˆç«¯è¾“å…¥ä»¥ä¸‹å‘½ä»¤:

```
mkdir FoodCart
```

*   è¿›å…¥æ–‡ä»¶å¤¹ï¼Œåˆ›å»ºä¸€ä¸ªè£¸éœ²çš„å—èŒé¡¹ç›®ã€‚

```
cd FoodCart
truffle init
```

*   å¯¼èˆªåˆ°åˆåŒæ–‡ä»¶å¤¹å¹¶åˆ›å»ºä¸€ä¸ª`FoodCart.sol`æ™ºèƒ½åˆåŒæ–‡ä»¶

```
cd contracts
touch FoodCart.sol
```

*   åœ¨æ‚¨é€‰æ‹©çš„ä»»ä½• IDE ä¸­æ‰“å¼€æ‚¨çš„ FoodCart é¡¹ç›®ã€‚æˆ‘å°†ä½¿ç”¨ Visual Studio ä»£ç ã€‚ä¸ºä»€ä¹ˆï¼Ÿæˆ‘çœŸçš„ä¸çŸ¥é“â€¦lolã€‚ðŸ˜‚ã€‚æ‰“å¼€`FoodCart.sol`åˆåŒï¼Œåœ¨ä¸‹é¢è¾“å…¥æ™ºèƒ½åˆåŒ:

åœ¨æˆ‘ä»¬ç»§ç»­ä¹‹å‰ï¼Œè®©æˆ‘è§£é‡Šä¸€ä¸‹ä¸Šé¢çš„æ™ºèƒ½åˆåŒã€‚FoodCart æ™ºèƒ½åˆåŒå¯ä»¥åˆ†ä¸º 6 ä¸ªéƒ¨åˆ†:

*   çŠ¶æ€å˜é‡:çŠ¶æ€å˜é‡`owner`å’Œ`skuCount`åˆ†åˆ«å­˜å‚¨æ‰€æœ‰è€…çš„åœ°å€å’Œæ·»åŠ åˆ°è´­ç‰©è½¦ä¸­çš„é£Ÿå“æ•°é‡ã€‚æ˜ å°„`foodItems`å°† SKU æ˜ å°„åˆ°é£Ÿå“é¡¹ç›®ã€‚
*   æžšä¸¾:`State`æžšä¸¾æ˜¯ä¸€ä¸ªç”¨æˆ·å®šä¹‰çš„æ•°æ®ç±»åž‹ï¼Œä¿å­˜è´­ç‰©è½¦ä¸­é£Ÿå“çš„çŠ¶æ€ã€‚æžšä¸¾ä¸­åˆ—å‡ºçš„ç±»åž‹å¯ä»¥æ˜¾å¼åœ°ä¸Žæ•´æ•°ç›¸äº’è½¬æ¢ï¼Œå³(`ForSale = 0`ã€`Sold = 1`)ã€‚
*   äº‹ä»¶:äº‹ä»¶`ForSale`å’Œ`Sold`è®°å½•äº†å¾…å”®æˆ–å”®å‡ºçš„é£Ÿå“çš„è¯¦ç»†ä¿¡æ¯ã€‚è¿™äº›äº‹ä»¶å¯ä»¥ç”± javascript ä¸­çš„å›žè°ƒå‡½æ•°è°ƒç”¨ï¼Œå®ƒä»¬çš„å†…å®¹å¯ä»¥ç”¨æ¥ä½¿ dApps çš„ä½¿ç”¨æ›´å…·äº¤äº’æ€§ã€‚
*   struct:struct`FoodItem`æ˜¯ä¸€ä¸ªç”¨æˆ·å®šä¹‰çš„ç±»åž‹ï¼Œç”¨äºŽä¿å­˜é£Ÿå“çš„å±žæ€§ã€‚å¯ä»¥ä½¿ç”¨ç»“æž„ä¸Šçš„ç‚¹æ ‡è®°æ¥è®¿é—®è¿™äº›å±žæ€§ã€‚
*   å‡½æ•°ä¿®é¥°ç¬¦:ä¿®é¥°ç¬¦`doesFoodItemExist`ã€`isFoodItemForSale`å’Œ`hasBuyerPaidEnough`æ˜¯åœ¨æ‰§è¡Œåº”ç”¨å®ƒä»¬çš„å‡½æ•°ä¹‹å‰è‡ªåŠ¨æ£€æŸ¥æ¡ä»¶çš„å‡½æ•°ã€‚è¿™ä¸ªæ™ºèƒ½å¥‘çº¦ä¸­ä½¿ç”¨çš„å‡½æ•°ä¿®é¥°ç¬¦çš„ä½œç”¨ä»Žå®ƒä»¬çš„åå­—å°±å¾ˆæ˜Žæ˜¾ã€‚
*   åŠŸèƒ½:`addFoodItem`ã€`buyFoodItem`å’Œ`fetchFoodItem`åŠŸèƒ½åˆ†åˆ«ä¸ºåˆåŒæ·»åŠ é£Ÿå“ã€å…è®¸è´­ä¹°é£Ÿå“å’ŒæŸ¥çœ‹é£Ÿå“çš„è¯¦ç»†ä¿¡æ¯ã€‚æž„é€ å‡½æ•°ç”¨éƒ¨ç½²å¥‘çº¦çš„åœ°å€åˆå§‹åŒ–`owner`çŠ¶æ€å˜é‡ã€‚åŒ¿å`payable`å‡½æ•°å…è®¸ä»¥å¤ªå‘é€åˆ°è¿™ä¸ªå¥‘çº¦ã€‚

## `Step 2: Deploying the smart contract`

è®©æˆ‘ä»¬åœ¨ä¸“ç”¨ç½‘ç»œä¸Šéƒ¨ç½²æ™ºèƒ½åˆåŒã€‚

*   åœ¨æ‚¨çš„ IDE ä¸­ï¼Œåœ¨`migrations`æ–‡ä»¶å¤¹ä¸­åˆ›å»ºä¸€ä¸ªåä¸º`2_foodcart_migration.js`çš„æ–°æ–‡ä»¶ã€‚åˆ›å»ºæ–‡ä»¶åŽæ‰“å¼€å®ƒï¼Œå¹¶æ·»åŠ ä»¥ä¸‹ä»£ç :

è¿™æ®µä»£ç å°†ä½¿æ¡†æž¶èƒ½å¤Ÿå°†æˆ‘ä»¬çš„`FoodCart.sol`åˆåŒéƒ¨ç½²åˆ°ç§æœ‰çš„åŒºå—é“¾ã€‚

*   æ‰“å¼€æ‚¨çš„ç»ˆç«¯ï¼Œå¯¼èˆªåˆ°è¯¥é¡¹ç›®çš„æ–‡ä»¶å¤¹ï¼Œå¹¶é”®å…¥ä»¥ä¸‹å‘½ä»¤:

```
truffle develop
```

è¿™ä¸ªå‘½ä»¤å¯åŠ¨äº†ä¸€ä¸ªå¼€å‘åŒºå—é“¾ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨å®ƒå¼€å§‹æµ‹è¯•æˆ‘ä»¬çš„å¥‘çº¦ã€‚è¿è¡Œè¯¥å‘½ä»¤åº”è¯¥ä¼šäº§ç”Ÿä»¥ä¸‹ç»“æžœ:

![](img/2642f2e70aee0d127257071a9f1e1310.png)

ä¸Šå›¾æ˜¾ç¤ºï¼Œåœ¨ç«¯å£ 9545 ä¸Šå·²ç»å¯åŠ¨äº†ä¸€ä¸ªå¼€å‘åŒºå—é“¾ï¼Œæµ‹è¯•è´¦æˆ·ä¹Ÿå·²ç»åˆ›å»ºä½¿ç”¨ï¼Œç»ˆç«¯å¯¼èˆªåˆ°ä¸€ä¸ªæ–°çš„æç¤º`truffle(develop)>`ã€‚

*   åœ¨`truffle(develop)>`æç¤ºç¬¦ä¸‹ï¼Œé”®å…¥`compile`å‘½ä»¤æ¥ç¼–è¯‘åˆåŒã€‚ç¼–è¯‘çš„ç»“æžœå­˜å‚¨åœ¨é¡¹ç›®ç›®å½•çš„ build æ–‡ä»¶å¤¹ä¸­ã€‚

```
truffle(develop)> compile
```

è¿è¡Œ`compile`å‘½ä»¤åº”è¯¥ä¼šäº§ç”Ÿè¿™æ ·çš„ç»“æžœ:

![](img/75b22673075a5bdeacc5dfa52389349f.png)

*   æœ€åŽï¼Œè®©æˆ‘ä»¬å°†ç¼–è¯‘å¥½çš„å¥‘çº¦è¿ç§»åˆ°åŒºå—é“¾è¿›è¡Œéƒ¨ç½²ã€‚åœ¨ç»ˆç«¯ï¼Œé”®å…¥`migrate`å‘½ä»¤ï¼Œå°†åˆåŒè¿ç§»åˆ°å·²ç»ä¸ºæˆ‘ä»¬å¯åŠ¨çš„å¼€å‘åŒºå—é“¾ã€‚

```
truffle(develop)> migrate
```

è¿è¡Œ`migrate`å‘½ä»¤åº”è¯¥ä¼šäº§ç”Ÿä»¥ä¸‹ç»“æžœ:

![](img/4bd312f7ea1d7dc6a8357a84048fb04c.png)

## `Step 3: Interacting with the smart contract`

è®©æˆ‘ä»¬ä¸Žæˆ‘ä»¬çš„æ™ºèƒ½åˆåŒäº’åŠ¨ï¼Œæ„Ÿå—ä¸€ä¸‹å®ƒæ˜¯å¦‚ä½•å·¥ä½œçš„ã€‚æˆ‘ä»¬å°†æ·»åŠ é£Ÿç‰©åˆ°è´­ç‰©è½¦ï¼Œæ£€æŸ¥æ·»åŠ åˆ°è´­ç‰©è½¦çš„é£Ÿç‰©çš„è¯¦ç»†ä¿¡æ¯ï¼Œå¹¶ä»Žæˆ‘ä»¬å¼€å§‹å¼€å‘åŒºå—é“¾æ—¶ä¸ºæˆ‘ä»¬åˆ›å»ºçš„ä¸€ä¸ªå¸æˆ·ä¸­è´­ä¹°å«æœ‰ä¹™é†šçš„è´­ç‰©è½¦ä¸­çš„é£Ÿç‰©ã€‚

*   ä»ç„¶åœ¨`truffle(develop)>`æç¤ºç¬¦ä¸‹ï¼Œåˆ›å»ºä¸€ä¸ª`foodCart`å˜é‡ï¼Œå¹¶å°†å·²éƒ¨ç½²å¥‘çº¦çš„å®žä¾‹å­˜å‚¨åœ¨å…¶ä¸­ã€‚

```
truffle(develop)> let foodCart; truffle(develop)> FoodCart.deployed().**then**((instance) => { foodCart = instance; });
```

åœ¨ä¸Šé¢çš„ç®€çŸ­ä»£ç ç‰‡æ®µä¸­ï¼Œæˆ‘ä»¬é€šè¿‡ web3 `.deployed`æ–¹æ³•è®¿é—®å·²éƒ¨ç½²çš„`FoodCart`å¥‘çº¦ï¼Œè¯¥æ–¹æ³•è¿”å›žä¸€ä¸ª promise æŽ¥å£ï¼Œæˆ‘ä»¬ä¼ é€’ä¸€ä¸ªå‡½æ•°ï¼Œè¯¥å‡½æ•°å°†å·²éƒ¨ç½²å¥‘çº¦çš„å®žä¾‹å­˜å‚¨åœ¨`foodCart`å˜é‡ä¸­ã€‚æœ‰äº†å­˜å‚¨åœ¨`foodCart`å˜é‡ä¸­çš„å¥‘çº¦å®žä¾‹ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡`foodCart`å˜é‡è®¿é—®å¥‘çº¦çš„åŠŸèƒ½ã€‚

*   è®©æˆ‘ä»¬åœ¨`truffle(develop)>`æç¤ºç¬¦ä¸‹è¿è¡Œä¸‹é¢çš„ä»£ç ç‰‡æ®µï¼Œå°†ä¸€äº›é£Ÿå“æ·»åŠ åˆ°è´­ç‰©è½¦ä¸­ã€‚é¦–å…ˆï¼Œè®©æˆ‘ä»¬æ·»åŠ ä¸€ä¸ªå‡½æ•°ï¼Œå®ƒå°†å¸®åŠ©æˆ‘ä»¬æ·»åŠ é£Ÿç‰©é¡¹ç›®ï¼Œå¹¶åœ¨æŽ§åˆ¶å°ä¸Šè½»æ¾åœ°æ‰“å°äº¤æ˜“ç»“æžœã€‚

`addFoodItemToCart`å‡½æ•°å…è®¸æˆ‘ä»¬åœ¨è°ƒç”¨æ—¶å°†é£Ÿå“çš„åç§°å’Œä»·æ ¼ä½œä¸ºå‚æ•°ä¼ é€’ç»™å‡½æ•°ï¼Œä»Žè€Œè½»æ¾åœ°å°†é£Ÿå“æ·»åŠ åˆ°è´­ç‰©è½¦ä¸­ã€‚è¯¥å‡½æ•°å……å½“æ™ºèƒ½å¥‘çº¦ä¸­`addFoodItem`çš„åŒ…è£…å™¨ï¼Œä¸ºæˆ‘ä»¬è¿›è¡Œæ™ºèƒ½å¥‘çº¦è°ƒç”¨ï¼Œå¹¶æ ¼å¼åŒ–ä»Žå‡½æ•°è°ƒç”¨è¿”å›žçš„æ—¥å¿—è¾“å‡ºã€‚é€šè¿‡è¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨`addFoodItemToCart`åŠŸèƒ½æ·»åŠ ä¸€äº›é£Ÿç‰©:

*   çŽ°åœ¨æˆ‘ä»¬åœ¨é£Ÿå“æŽ¨è½¦ä¸Šæœ‰å¤§çº¦ 3 ç§é£Ÿå“ï¼Œè®©æˆ‘ä»¬ä»ŽæŽ¨è½¦ä¸Šä¹°ä¸€äº›é£Ÿå“ã€‚åœ¨æˆ‘ä»¬è´­ä¹°é£Ÿå“ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦æŒ‡å®šæˆ‘ä»¬å°†ä½¿ç”¨ä»€ä¹ˆåœ°å€æ¥è´­ä¹°ï¼Œå› ä¸ºæˆ‘ä»¬å¯ä»¥ä»Žè¿™ä¸ªåœ°å€èŽ·å¾—èµ„é‡‘`in ether`æ¥è´­ä¹°é£Ÿå“ã€‚å›žæƒ³ä¸€ä¸‹ï¼Œå½“æˆ‘ä»¬å¼€å§‹æˆ‘ä»¬çš„ç§äººåŒºå—é“¾æ—¶ï¼Œä¸ºæˆ‘ä»¬åˆ›å»ºäº† 10 ä¸ªæµ‹è¯•è´¦æˆ·ï¼Œæ¯ä¸ªè´¦æˆ·éƒ½æœ‰ 100 ä»¥å¤ªå¸ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨å®ƒæ¥è´­ä¹°æˆ‘ä»¬æƒ³è¦çš„ä»»ä½•ä¸œè¥¿ï¼Œæˆ‘ä»¬å‘è´¢äº†ðŸ¤‘ðŸ¤‘ã€‚è®©æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªå˜é‡æ¥å­˜å‚¨è¿™äº›åœ°å€æˆ–å¸æˆ·ä¸­çš„ä¸€ä¸ªï¼Œä»¥ä¾¿æˆ‘ä»¬å¯ä»¥éšæ—¶è½»æ¾åœ°è°ƒç”¨å®ƒã€‚

```
truffle(develop)> **const** buyerAddress = web3.eth.accounts[1]; truffle(develop)> buyerAddress '0xf17f52151ebef6c7334fad080c5704d77216b732'
```

ç”±äºŽæˆ‘ä»¬æœ‰ä¸€ä¸ªè´¦æˆ·`0xf17f52151ebef6c7334fad080c5704d77216b732`(ä½ çš„ä¼šä¸åŒ)ï¼Œæˆ‘ä»¬å¯ä»¥æ·»åŠ ä¸€ä¸ªåŠŸèƒ½ï¼Œåœ¨æˆ‘ä»¬çš„`truffle(develop)>`æç¤ºä¸‹è´­ä¹°é£Ÿå“è´­ç‰©è½¦ä¸­çš„é£Ÿå“ã€‚

é€šè¿‡ä½¿ç”¨å•†å“çš„`itemSku`å’Œ`amount`è°ƒç”¨å‡½æ•°ï¼Œ`buyFoodItemFromCart`å…è®¸æˆ‘ä»¬ä»Žè´­ç‰©è½¦ä¸­è´­ä¹°é£Ÿå“ã€‚ä¸ºè¯¥å•†å“æ”¯ä»˜çš„é‡‘é¢æ¥è‡ªå­˜å‚¨åœ¨æˆ‘ä»¬çš„`buyerAddress`å˜é‡ä¸­çš„è´¦æˆ·ã€‚æˆ‘ä»¬åŽ»é£Ÿå“è½¦ä¸Šä¹°ç‚’é¥­å§ã€‚ä»Žæˆ‘ä»¬ä»¥å‰çš„äº¤æ˜“ä¸­ï¼Œæˆ‘ä»¬è®°å¾—ç‚’é¥­çš„ sku æ˜¯`0`ï¼Œå®ƒçš„ä»·æ ¼æ˜¯`10 wei`ã€‚æ‰€ä»¥åœ¨`truffle(develop)>`æç¤ºç¬¦ä¸‹ï¼Œæˆ‘ä»¬ç”¨è¿™äº›å€¼è°ƒç”¨`buyFoodItemFromCart`å‡½æ•°:

ä»Žè¾“å‡ºä¸­ï¼Œæˆ‘ä»¬çœ‹åˆ°è¯¥å•†å“çš„çŠ¶æ€æ˜¯`Sold`ï¼Œè€Œ`foodItemExist`çŽ°åœ¨æ˜¯`false`ï¼Œè¡¨æ˜Žè¯¥å•†å“ä¸å†å‡ºå”®ã€‚

## `Step 4: Debugging errors in the smart contract`

å¦‚æžœä½ å·²ç»åšåˆ°äº†è¿™ä¸€æ­¥ï¼Œä½ åº”è¯¥å› ä¸ºåšéŸ§è€ŒèŽ·å¾—è¯ºè´å°”å¥–ï¼ŒðŸŽ–ï¼Œäº«å—å®ƒå¸¦æ¥çš„åå£°å§ã€‚åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬å·²ç»çœ‹åˆ°äº†å¥‘çº¦åº”è¯¥å¦‚ä½•è¡¨çŽ°ã€‚ä¸ºäº†èƒ½å¤Ÿä½¿ç”¨ Truffle è°ƒè¯•å™¨ç‰¹æ€§ï¼Œæˆ‘ä»¬å°†åœ¨ä¸Žå¥‘çº¦äº¤äº’æ—¶å¼•å…¥ä¸€äº›é”™è¯¯ï¼Œç„¶åŽä½¿ç”¨è°ƒè¯•å™¨æ¥è°ƒè¯•é”™è¯¯å¹¶ä¿®å¤å®ƒã€‚ä¸ºäº†è°ƒè¯•ä¸€ä¸ªäº‹åŠ¡ï¼Œæˆ‘ä»¬éœ€è¦æœ‰äº‹åŠ¡çš„æ•£åˆ—ï¼Œç„¶åŽåœ¨`truffle(develop)>`æç¤ºç¬¦ä¸‹è¿è¡Œå‘½ä»¤`debug [transaction hash]`ï¼ŒåŽé¢è·Ÿç€ä»»ä½•è°ƒè¯•å™¨å‘½ä»¤ï¼Œç›´åˆ°æˆ‘ä»¬æ‰¾åˆ°äº‹åŠ¡å¤±è´¥çš„åœ°æ–¹ã€‚

æˆ‘ä»¬å°†å°è¯•ä»¥ä¸‹æ— æ•ˆäº¤æ˜“:

*   å°è¯•è´­ä¹°ä¸å­˜åœ¨çš„é£Ÿç‰©
*   å°è¯•æ”¯ä»˜å°‘äºŽé£Ÿç‰©ä»·æ ¼çš„é‡‘é¢

åœ¨æˆ‘ä»¬å¼€å§‹è¿™äº›äº‹åŠ¡ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦åœ¨å¦ä¸€ä¸ªç»ˆç«¯ä¸­å¯åŠ¨`truffle develop logger`ï¼Œä½†æ˜¯ä»ç„¶åœ¨ç¤ºä¾‹é¡¹ç›®ä¸­ã€‚æ‰“å¼€ä¸€ä¸ªæ–°çš„ç»ˆç«¯ï¼Œå¯¼èˆªåˆ° FoodCart é¡¹ç›®å¹¶è¿è¡Œè¿™ä¸ªå‘½ä»¤`truffle develop --log`ã€‚

```
FoodCart $ truffle develop --log
```

æ‚¨åº”è¯¥å¾—åˆ°ä»¥ä¸‹è¾“å‡º:

```
Connected to existing Truffle Develop session at [http://127.0.0.1:9545/](http://127.0.0.1:9545/)
```

è®°å½•å™¨è¿žæŽ¥åˆ°æŒ‡å®šç«¯å£çš„çŽ°æœ‰ä¼šè¯ï¼Œç›‘å¬äº‹åŠ¡äº‹ä»¶ï¼Œå¹¶è®°å½•äº‹åŠ¡çš„è¾“å‡ºï¼Œå…¶ä¸­åº”åŒ…æ‹¬äº‹åŠ¡å“ˆå¸Œã€å—å·ç­‰é¡¹ç›®ã€‚è®©æˆ‘ä»¬ç»§ç»­ä¸‹åŽ»ï¼Œè®©æˆ‘ä»¬çš„åˆåŒç”Ÿæ´»æˆä¸ºäººé—´åœ°ç‹±ðŸ‘¹ã€‚

## æ— æ•ˆäº¤æ˜“#1:è¯•å›¾è´­ä¹°ä¸å­˜åœ¨çš„é£Ÿå“

åœ¨ä¹‹å‰çš„äº¤æ˜“ä¸­ï¼Œæˆ‘ä»¬å°†é£Ÿå“æ·»åŠ åˆ°è´­ç‰©è½¦ä¸­ï¼Œæˆ‘ä»¬åˆ†åˆ«ä¸º 3 ç§é£Ÿå“æ·»åŠ äº† SKU`0, 1, 2`ã€‚æˆ‘ä»¬å°†å°è¯•ä½¿ç”¨ sku `6`è´­ä¹°ä¸€ä¸ªä¸å­˜åœ¨çš„é£Ÿå“ã€‚

å°è¯•è´­ä¹°ä¸Šé¢å‘½ä»¤ä¸­æ˜¾ç¤ºçš„å•†å“ä¼šäº§ç”Ÿé”™è¯¯`UnhandledPromiseRejectionWarning: Error: VM Exception while processing transaction: revert ...`,å®ƒå¹¶æ²¡æœ‰çœŸæ­£å‘Šè¯‰æˆ‘ä»¬é—®é¢˜æ¥è‡ªå“ªé‡Œã€‚çŽ°åœ¨ï¼Œå½“æ²¡æœ‰è°ƒè¯•å™¨æ—¶ï¼Œè¿™å¯èƒ½æ˜¯ä¸€ä¸ªçœŸæ­£ä»¤äººå¤´ç—›çš„é—®é¢˜ã€‚æˆ‘èŠ±äº†å¾ˆå¤šæ—¶é—´è¯•å›¾åœ¨ä¸ä½¿ç”¨è°ƒè¯•å™¨çš„æƒ…å†µä¸‹è°ƒè¯•ä¸€ä¸ªæ™ºèƒ½åˆåŒï¼Œå®ƒå¯ä»¥æ¦¨å¹²ä¸€ä¸ªæ™ºèƒ½åˆåŒçš„æœ€åŽä¸€æ»´è¡€ã€‚è®©æˆ‘ä»¬çœ‹çœ‹æ—¥å¿—è¾“å‡ºï¼Œçœ‹çœ‹æˆ‘ä»¬æœ‰ä»€ä¹ˆã€‚

![](img/f66a5fc7b8d0cc8becf4671301d29b93.png)

å¯¹æˆ‘ä»¬æ¥è¯´ï¼Œæ—¥å¿—ä¸­æœ€é‡è¦çš„å†…å®¹æ˜¯äº‹åŠ¡å“ˆå¸Œ`0x90a2ef83e54426848523a4edcf0c9628045e03c69d95f989c5b3b557367c848c`ï¼Œè¿™å°†ä¸Žæ‚¨æœºå™¨ä¸Šçš„ä¸åŒã€‚æœ‰äº†äº‹åŠ¡æ•£åˆ—ï¼Œæˆ‘ä»¬å¯ä»¥è°ƒè¯•äº‹åŠ¡å¹¶æ‰¾å‡ºé—®é¢˜æ‰€åœ¨ã€‚è®©æˆ‘ä»¬è°ƒè¯•è¿™ä¸ªäº‹åŠ¡ã€‚ä»Žè°ƒè¯•å™¨ç»ˆç«¯å¤åˆ¶äº‹åŠ¡çš„æ•£åˆ—ï¼Œå¹¶åœ¨`truffle(develop)>`æç¤ºç¬¦ä¸‹è¿è¡Œè¿™ä¸ªå‘½ä»¤:`debug your-trasanction-hash`ã€‚æ‚¨çš„è¾“å‡ºåº”è¯¥å¦‚ä¸‹æ‰€ç¤º:

![](img/088422680b490fb70f86f7a23bd619eb.png)

ä»Žå›¾ä¸­æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œå½“ debug å‘½ä»¤è¿è¡Œæ—¶ï¼Œè°ƒè¯•å™¨ä¼šç¼–è¯‘åå®šï¼Œæ”¶é›†äº‹åŠ¡æ•°æ®ï¼ŒèŽ·å–å—å½±å“çš„åœ°å€å’Œåœ¨è¯¥åœ°å€éƒ¨ç½²çš„åå®šï¼Œå¹¶æ˜¾ç¤ºæˆ‘ä»¬å¯ä»¥ç”¨æ¥ä¸Žè°ƒè¯•å™¨äº¤äº’çš„è°ƒè¯•å™¨å‘½ä»¤åˆ—è¡¨ã€‚åœ¨è°ƒè¯•å™¨ä¸­ä½¿ç”¨çš„æœ€å…·äº¤äº’æ€§çš„å‘½ä»¤æ˜¯`step next`å‘½ä»¤ï¼Œå®ƒä¸€æ¬¡ä¸€ä¸ªåœ°å•æ­¥æ‰§è¡Œä¸€ä¸ªäº‹åŠ¡ä¸­æ‰§è¡Œçš„æ‰€æœ‰æŒ‡ä»¤ã€‚é€šè¿‡æŒ‰ä¸‹`enter`æˆ–`n`æ¥æ‰§è¡Œ`step next`å‘½ä»¤ï¼Œå½“ç„¶æ˜¯åœ¨é”®ç›˜ä¸Šã€‚

åœ¨`debug(develop:0x90a2ef83...)>`æç¤ºç¬¦ä¸‹ï¼Œè¿žç»­æŒ‰ enter é”®ï¼Œè·Ÿéšæ¯ä¸ªæŒ‡ä»¤æ­¥éª¤ï¼Œç›´åˆ°åˆ°è¾¾äº¤æ˜“å¤±è´¥çš„æŒ‡ä»¤ã€‚åœ¨æˆ‘ä»¬åˆ°è¾¾åœæ­¢äº¤æ˜“çš„æœ€åŽä¸€æ¡æŒ‡ä»¤ä¹‹å‰è¿˜æœ‰`8`ä¸ªæ­¥éª¤â€”â€”æ‚¨å¿…é¡»æŒ‰ 9 æ¬¡ enter é”®æ‰èƒ½åˆ°è¾¾åœæ­¢æŒ‡ä»¤ã€‚è®©æˆ‘ä»¬çœ‹çœ‹ä¸‹å›¾ä¸­çš„å‰ 4 ä¸ªæ­¥éª¤:

![](img/9203d7f36f568afd4883ba44afcecfd2.png)

ä»Žå›¾ä¸­ï¼Œæˆ‘ä»¬çœ‹åˆ°åœ¨ç¬¬`61`è¡Œè°ƒç”¨äº†`buyFoodItem`å‡½æ•°ï¼Œä½†æ˜¯åœ¨æ‰§è¡Œè¯¥å‡½æ•°ä¹‹å‰ï¼Œç¬¬`64`è¡Œçš„ä¿®é¥°ç¬¦`doesFoodItemExist`è¢«è°ƒç”¨æ¥æ£€æŸ¥è´­ç‰©è½¦ä¸­æ˜¯å¦å­˜åœ¨è¦è´­ä¹°çš„é£Ÿå“ã€‚åœ¨è¿›ä¸€æ­¥çš„æ£€æŸ¥ä¸­ï¼Œåœ¨ç¬¬`33`è¡Œï¼Œæˆ‘ä»¬çœ‹åˆ°ä¿®æ”¹è€…ä½¿ç”¨äº†`require`å‡½æ•°æ¥ç¡®ä¿å¸¦æœ‰ç»™å®š sku çš„é£Ÿå“é¡¹ç›®çš„`foodItemExist`å±žæ€§æ˜¯`true`ã€‚è®©æˆ‘ä»¬çœ‹çœ‹ä¸‹å›¾ä¸­çš„å…¶ä½™æ­¥éª¤å‘ç”Ÿäº†ä»€ä¹ˆ:

![](img/58b4757d39f62a241c4e3bda0ca12b99.png)

åœ¨ä¸Šå›¾ç¬¬ 33 è¡Œçš„æœ€åŽä¸€æ­¥ï¼Œæˆ‘ä»¬çœ‹åˆ°äº¤æ˜“åœæ­¢äº†ï¼Œå› ä¸ºäº¤æ˜“æ²¡æœ‰æ»¡è¶³ä»Žè´­ç‰©è½¦ä¸­è´­ä¹°é£Ÿå“çš„æ¡ä»¶ã€‚æˆ‘ä»¬æƒ³è´­ä¹°çš„å•†å“ä¸å­˜åœ¨ã€‚`require`å‡½æ•°åœ¨å…¶åº”ç”¨çš„æ¡ä»¶å¤±è´¥æ—¶æŠ›å‡º**çŠ¶æ€æ¢å¤**å¼‚å¸¸ã€‚**çŠ¶æ€æ¢å¤**å¼‚å¸¸æ¢å¤æˆ–æ’¤é”€å½“å‰è°ƒç”¨(åŠå…¶æ‰€æœ‰å­è°ƒç”¨)ä¸­å¯¹çŠ¶æ€æ‰€åšçš„æ‰€æœ‰æ›´æ”¹ï¼Œå¹¶å‘è°ƒç”¨è€…æ ‡è®°é”™è¯¯ã€‚æˆ‘ä»¬å·²ç»èƒ½å¤Ÿä½¿ç”¨ Truffle è°ƒè¯•å™¨æˆåŠŸåœ°è°ƒè¯•è¿™æ®µä»£ç ï¼Œè¿™çœŸæ˜¯å¤ªæ£’äº†ã€‚

## æ— æ•ˆäº¤æ˜“#2:å°è¯•æ”¯ä»˜ä½ŽäºŽé£Ÿå“ä»·æ ¼çš„é‡‘é¢

åœ¨æ­¤äº¤æ˜“ä¸­ï¼Œæˆ‘ä»¬å°†å°è¯•ä»¥ä½ŽäºŽé£Ÿå“ä»·æ ¼çš„é‡‘é¢è´­ä¹°é£Ÿå“ã€‚åœ¨â€œæ­¥éª¤ 3:ä¸Žæ™ºèƒ½åˆçº¦äº¤äº’â€ä¸­ï¼Œæˆ‘ä»¬æ·»åŠ äº† 3 ç§é£Ÿå“ã€‚æˆ‘ä»¬è¯•è¯•ä¹° sku `1`ä»·æ ¼`10 wei`çš„â€˜é¸¡æ¤’æ±¤â€™ã€‚åœ¨`truffle(develop)>`çš„æç¤ºä¸‹ï¼Œè°ƒç”¨`buyFoodItem`åŠŸèƒ½è´­ä¹°ä¸€ä¸ªé‡‘é¢å°‘äºŽä»·æ ¼çš„é£Ÿå“ã€‚

```
truffle(develop)> buyFoodItemFromCart(1, 5); 
truffle(develop)> (node:40269) UnhandledPromiseRejectionWarning: Error: VM Exception while processing transaction: revert
```

ä¸å‡ºæ‰€æ–™ï¼Œè¿™ä¸ªäº‹åŠ¡å¤±è´¥äº†ï¼Œåƒå¾€å¸¸ä¸€æ ·ç»™å‡ºä¸€ä¸ªå«ç³Šçš„é”™è¯¯æ¶ˆæ¯ã€‚ä¸ºäº†è°ƒè¯•è¿™ä¸ªäº‹åŠ¡ï¼Œæˆ‘ä»¬è½¬åˆ°æˆ‘ä»¬çš„æ—¥å¿—ç»ˆç«¯ï¼Œå¤åˆ¶äº‹åŠ¡çš„æ•£åˆ—ã€‚åœ¨æˆ‘çš„æœºå™¨ä¸Šï¼Œäº‹åŠ¡å“ˆå¸Œæ˜¯`0x5dc12d3ac524cfd1e3c0ea9265a155149ff16fcb18f904016a87e83cca5f9a30`ã€‚æœ‰äº†è¿™ä¸ªäº‹åŠ¡æ•£åˆ—ï¼Œæˆ‘ä»¬å°†è°ƒè¯•äº‹åŠ¡å¹¶æ‰¾å‡ºäº‹åŠ¡åœ¨å“ªé‡Œåœæ­¢ã€‚

```
truffle(develop)> debug 0x2ad4c056a678f221d761d0bc11f641f6b4e63b3016587acd8b16ccf5295bd4d3
```

å°±åƒæˆ‘ä»¬åœ¨ç¬¬ä¸€æ¬¡è°ƒè¯•è¿‡ç¨‹ä¸­æ‰€åšçš„é‚£æ ·ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨`step next`è°ƒè¯•å™¨å‘½ä»¤æ¥å•æ­¥æ‰§è¡Œäº‹åŠ¡ï¼Œå› ä¸ºå®ƒéžå¸¸å…·æœ‰äº¤äº’æ€§ï¼Œå¹¶ä¸”æ˜¾ç¤ºæ‰€æœ‰å·²ç»æ‰§è¡Œçš„æŒ‡ä»¤ï¼Œç›´åˆ°æˆ‘ä»¬åˆ°è¾¾æš‚åœäº‹åŠ¡çš„æŒ‡ä»¤ã€‚ä½¿ç”¨`enter`æµè§ˆäº¤æ˜“åŽ†å²ï¼Œç›´åˆ°åˆ°è¾¾æš‚åœäº¤æ˜“çš„æŒ‡ä»¤ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤º:

![](img/131c183d084d2c979774b39b07b960b6.png)

åœ¨ä¸Šå›¾ä¸­ï¼Œæˆ‘ä»¬çœ‹åˆ°åœ¨ç¬¬ 44 è¡Œï¼Œä¿®é¥°ç¬¦`hasBuyerPaidEnough`åœ¨`buyFoodItemFromCart`å‡½æ•°æ‰§è¡Œä¹‹å‰è¢«è°ƒç”¨ï¼Œåœ¨ç¬¬ 45 è¡Œï¼Œä¿®é¥°ç¬¦è¦æ±‚ä¹°æ–¹å‘é€çš„å€¼å¤§äºŽæˆ–ç­‰äºŽå•†å“çš„ä»·æ ¼ã€‚ç„¶è€Œï¼Œæˆ‘ä»¬çŸ¥é“æˆ‘ä»¬æ— è§†è¿™ä¸€æ¡ä»¶ï¼Œå› æ­¤ï¼Œå®ƒåœæ­¢äº†æˆ‘ä»¬çš„äº¤æ˜“ã€‚å› æ­¤ï¼Œå¦‚æžœæˆ‘ä»¬å‘é€æ­£ç¡®çš„æ•°é‡ï¼Œæˆ‘ä»¬è‚¯å®šä¼šè´­ä¹°æˆ‘ä»¬éœ€è¦çš„é£Ÿå“ã€‚

# ç»“è®º

æ€»ä¹‹ï¼Œåœ¨æž„å»ºæ™ºèƒ½å¥‘çº¦æ—¶ä½¿ç”¨è°ƒè¯•å™¨çš„é‡è¦æ€§æ€Žä¹ˆå¼ºè°ƒéƒ½ä¸ä¸ºè¿‡ã€‚æœ‰äº†è°ƒè¯•å™¨ï¼Œæˆ‘ä»¬å¯ä»¥æµ‹è¯•æˆ‘ä»¬çš„ä¿®é¥°ç¬¦ä»¥ç¡®ä¿æˆ‘ä»¬çš„å¥‘çº¦è¡Œä¸ºæ­£ç¡®ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡å‘æˆ‘ä»¬çš„å¥‘çº¦å‘é€æ¶æ„äº‹åŠ¡ä»¥æŸ¥çœ‹å®ƒå°†å¦‚ä½•è¡Œä¸ºæ¥ç¡®ä¿æˆ‘ä»¬çš„å¥‘çº¦æ˜¯å®‰å…¨çš„ï¼Œå¹¶ä¸”æ­£ç¡®åœ°è°ƒè¯•äº‹åŠ¡ä»¥æŸ¥çœ‹åœ¨äº‹åŠ¡åœæ­¢ä¹‹å‰å·²ç»æ‰§è¡Œçš„æŒ‡ä»¤ï¼Œå¦‚æžœå®ƒåœæ­¢çš„è¯ã€‚æœ€é‡è¦çš„æ˜¯ï¼Œæ¯å½“æˆ‘ä»¬é¢ä¸´æ™ºèƒ½åˆçº¦çš„é—®é¢˜æ—¶ï¼Œé€šè¿‡ä½¿ç”¨è°ƒè¯•å™¨ï¼Œè€Œä¸æ˜¯æ‘¸ç´¢æˆ‘ä»¬çš„ä»£ç ï¼Œæˆ‘ä»¬å¯ä»¥èŠ‚çœæˆ‘ä»¬æœ€æœ‰ä»·å€¼çš„èµ„äº§ï¼Œå³**æ—¶é—´**ã€‚

# å‚è€ƒèµ„æ–™:

*   [æ¾éœ²è°ƒè¯•å™¨](https://truffleframework.com/docs/truffle/getting-started/debugging-your-contracts)
*   [è°ƒè¯•å’Œæµ‹è¯•](https://www.d.umn.edu/~gshute/softeng/testing.html)
*   [IntelliJ IDEA è°ƒè¯•å·¥å…·](https://www.jetbrains.com/help/idea/debug-tool-window.html)

*æœ€åˆå‘è¡¨äºŽ*[T5ã€www.mayowatudonu.comã€‘](https://www.mayowatudonu.com/blockchain/debugging-smartcontracts-with-truffle-debugger)*ã€‚*

> [ç›´æŽ¥åœ¨æ‚¨çš„æ”¶ä»¶ç®±ä¸­èŽ·å¾—æœ€ä½³è½¯ä»¶äº¤æ˜“](https://coincodecap.com/?utm_source=coinmonks)

[![](img/7c0b3dfdcbfea594cc0ae7d4f9bf6fcb.png)](https://coincodecap.com/?utm_source=coinmonks)