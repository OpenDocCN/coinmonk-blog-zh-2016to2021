<html>
<head>
<title>Fuzzing the BLS-Precompiles</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">模糊BLS-预编译</h1>
<blockquote>原文：<a href="https://medium.com/coinmonks/fuzzing-the-bls-precompiles-ba3728dec622?source=collection_archive---------4-----------------------#2020-09-21">https://medium.com/coinmonks/fuzzing-the-bls-precompiles-ba3728dec622?source=collection_archive---------4-----------------------#2020-09-21</a></blockquote><div><div class="ef hh hi hj hk hl"/><div class="hm hn ho hp hq"><div class=""/><p id="b8bf" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">以太坊即将推出的hardfork Berlin应该会引入很多新的原语。其中一个是BLS的签名。BLS签名很有趣，因为它们允许签名聚合。它们是ETH2的存款合同所需要的。本文简要介绍了我们测试这些共识关键组件的工作。</p><p id="b478" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated"><a class="ae jo" href="https://eips.ethereum.org/EIPS/eip-2537" rel="noopener ugc nofollow" target="_blank"> EIP-2537 </a>将9个新的预编译引入以太坊。它们实现bls 12–381曲线的基本曲线操作。<a class="ae jo" href="https://hackmd.io/@benjaminion/bls12-381" rel="noopener ugc nofollow" target="_blank">这里有一个关于bls 12–381的简短解释。下表给出了预编译的快速概述。</a></p><figure class="jq jr js jt fq ju fe ff paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="fe ff jp"><img src="../Images/67d93deca117bb09905b3df1d32ffddf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Oypny-qvlbQ16CSJZ7rBpw.png"/></div></div><figcaption class="kb kc fg fe ff kd ke bd b be z ek">Overview of the 9 BLS-Precompiles</figcaption></figure><p id="b054" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">在assembly和golang中实现曲线函数的<a class="ae jo" href="https://github.com/ethereum/go-ethereum/pull/21018" rel="noopener ugc nofollow" target="_blank"> PR附带了许多测试用例。然而，这些测试主要是测试加密功能，而不是集成到go-ethereum代码中(比如气体计算)。我创建了一个</a><a class="ae jo" href="https://github.com/MariusVanDerWijden/go-ethereum/tree/bls_fuzzer/tests/fuzzers/bls12381" rel="noopener ugc nofollow" target="_blank">差分fuzzer </a>来测试汇编和golang版本之间的对比，以及与另一个<a class="ae jo" href="https://github.com/matter-labs/eip1962" rel="noopener ugc nofollow" target="_blank"> BLS库</a>的对比。</p><p id="a013" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">这个基本fuzzer发现了一个问题，在adx关闭的情况下，gas计算因指数越界错误和乘法代码中的进位错误而崩溃。他们很快被公关作者修复。我们决定合并PR来设置YOLOv1，但是禁用汇编代码。</p><p id="1a27" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">我们推出了一个名为<a class="ae jo" rel="noopener" href="/ethereum-cat-herders/yolo-an-ephemeral-test-network-for-ethereum-356d43179b1a"> yolov1 </a>的短期测试网，以允许客户端之间更好的测试，而不仅仅是BLS图书馆之间。yolov1出现了一些小问题，在一些初始测试之后，签名器用完了磁盘，然后被重置为没有启用BLS预编译的签名器，所以当我向它发送下一个正确的BLS调用时，签名器崩溃了。以太坊猫牧人在这里发布了一个很好的时间表<a class="ae jo" rel="noopener" href="/ethereum-cat-herders/yolo-an-ephemeral-test-network-for-ethereum-356d43179b1a">。</a></p><p id="0e9c" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">第一个fuzzer只创建了预编译的纯随机输入。然而，大多数操作需要非常特殊的结构，这些结构几乎不会被随机引信击中。我开始开发一个新的fuzzer t,它可以生成预编译的有效输入，并将事务发送到测试网。因为所有主要的客户端，go-ethereum、OpenEthereum、Besu和Nethermind都已经实现了testnet规范，所以我可以在我的本地机器上运行它们，看看它们是否会崩溃。</p><p id="3668" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">我在模糊化过程中发现了几次崩溃。OpenEthereum以不同的方式计算了一个块(很可能是因为配置问题)，并在一个输入上完全崩溃，这在devp2p中被证明是一个开关问题。Besu在gas计算过程中遇到了另一个<a class="ae jo" href="https://github.com/hyperledger/besu/issues/1122" rel="noopener ugc nofollow" target="_blank">指数越界问题</a>，与我们之前在go-ethereum中发现的一样。</p><p id="dee5" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">但是在测试网上模糊是不可行的。我可以每15秒发送大约100笔交易，这确实限制了我们可以做的模糊处理的数量。所以我们创建了<a class="ae jo" href="https://github.com/holiman/goevmlab/tree/master/cmd/blsfuzz" rel="noopener ugc nofollow" target="_blank">另一个fuzzer </a>，它使用<a class="ae jo" href="https://github.com/holiman/goevmlab" rel="noopener ugc nofollow" target="_blank"> goevmlab </a>创建状态测试(可以被所有客户端执行的测试)。</p><p id="b020" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">第三个fuzzer也可以生成以前的fuzzer不能生成的有效配对。它在尼瑟minds状态测试执行代码中发现了几个崩溃程序。第一个是尼瑟明实现G1多幂运算中的<a class="ae jo" href="https://github.com/NethermindEth/nethermind/issues/2208#issuecomment-672881255" rel="noopener ugc nofollow" target="_blank">气体计算问题</a>。第二个是地图1中的不速之客。Nethermind没有在大于预期的输入上抛出错误。我们还在用于运行生成状态测试的工具中发现了两个不严重的错误。</p><p id="85f4" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">另一个让我们花了很长时间调试的问题是geth和OE之间的气体差异。原来，OE已经在他们的柏林配置中包含了另一个EIP(我们用于yolov1)，<a class="ae jo" href="https://eips.ethereum.org/EIPS/eip-2046" rel="noopener ugc nofollow" target="_blank"> EIP-2046 </a>，这降低了STATICCALL操作码的成本，从而产生了不同的gas结果。</p></div><div class="ab cl kf kg hb kh" role="separator"><span class="ki bw bk kj kk kl"/><span class="ki bw bk kj kk kl"/><span class="ki bw bk kj kk"/></div><div class="hm hn ho hp hq"><h1 id="5a07" class="km kn ht bd ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj dt translated">所有未发现的错误列表:</h1><ul class=""><li id="f3a9" class="lk ll ht is b it lm ix ln jb lo jf lp jj lq jn lr ls lt lu dt translated"><a class="ae jo" href="https://github.com/ethereum/go-ethereum/pull/21018" rel="noopener ugc nofollow" target="_blank">geth气体计算中的指数越界</a></li><li id="6122" class="lk ll ht is b it lv ix lw jb lx jf ly jj lz jn lr ls lt lu dt translated"><a class="ae jo" href="https://github.com/ethereum/go-ethereum/pull/21018" rel="noopener ugc nofollow" target="_blank">geth中ADX关闭时乘法运算中的进位错误</a></li><li id="496a" class="lk ll ht is b it lv ix lw jb lx jf ly jj lz jn lr ls lt lu dt translated"><a class="ae jo" href="https://gist.github.com/MariusVanDerWijden/30110e3363c24e83cde934952099e59b" rel="noopener ugc nofollow" target="_blank"> OpenEthereum以不同方式计算区块</a></li><li id="8e98" class="lk ll ht is b it lv ix lw jb lx jf ly jj lz jn lr ls lt lu dt translated"><a class="ae jo" href="https://gist.github.com/MariusVanDerWijden/6bea984c7ab71a3f12c62480df147cd4" rel="noopener ugc nofollow" target="_blank">OpenEthereum使用的devp2p崩溃</a>(非关键)</li><li id="7826" class="lk ll ht is b it lv ix lw jb lx jf ly jj lz jn lr ls lt lu dt translated"><a class="ae jo" href="https://github.com/hyperledger/besu/issues/1122" rel="noopener ugc nofollow" target="_blank">Besu气体计算中的指标越界</a></li><li id="44e7" class="lk ll ht is b it lv ix lw jb lx jf ly jj lz jn lr ls lt lu dt translated"><a class="ae jo" href="https://github.com/NethermindEth/nethermind/issues/2239" rel="noopener ugc nofollow" target="_blank">气体报告器未在尼瑟迈德的状态测试工具</a>中实现(非关键)</li><li id="e722" class="lk ll ht is b it lv ix lw jb lx jf ly jj lz jn lr ls lt lu dt translated"><a class="ae jo" href="https://github.com/NethermindEth/nethermind/issues/2199" rel="noopener ugc nofollow" target="_blank">虚空思维状态测试工具</a>气体报告器中的Bug(非关键)</li><li id="874c" class="lk ll ht is b it lv ix lw jb lx jf ly jj lz jn lr ls lt lu dt translated"><a class="ae jo" href="https://github.com/NethermindEth/nethermind/issues/2231" rel="noopener ugc nofollow" target="_blank"> Nethermind没有正确处理MapToG1中的错误</a></li><li id="3d8c" class="lk ll ht is b it lv ix lw jb lx jf ly jj lz jn lr ls lt lu dt translated"><a class="ae jo" href="https://github.com/NethermindEth/nethermind/issues/2208" rel="noopener ugc nofollow" target="_blank">尼瑟明的G1多幂运算代码中的气体计算错误</a></li></ul><h1 id="f46e" class="km kn ht bd ko kp ma kr ks kt mb kv kw kx mc kz la lb md ld le lf me lh li lj dt translated">我们的fuzzers列表:</h1><ul class=""><li id="2d0d" class="lk ll ht is b it lm ix ln jb lo jf lp jj lq jn lr ls lt lu dt translated">基本的BLS模糊器:直接对以太坊中使用的BLS库创建随机测试。对这个图书馆和另一个BLS图书馆进行不同的模糊处理。</li><li id="bcdd" class="lk ll ht is b it lv ix lw jb lx jf ly jj lz jn lr ls lt lu dt translated"><a class="ae jo" href="https://github.com/MariusVanDerWijden/go-snippets/tree/master/bls" rel="noopener ugc nofollow" target="_blank">交易模糊器:</a>创建可发送至网络的交易。实现更好的生成器以达到实现中更深的状态。</li><li id="bfe4" class="lk ll ht is b it lv ix lw jb lx jf ly jj lz jn lr ls lt lu dt translated"><a class="ae jo" href="https://github.com/holiman/goevmlab/tree/master/cmd/blsfuzz" rel="noopener ugc nofollow" target="_blank">状态测试模糊器:</a>创建可以在大多数客户端上执行的状态测试。它执行状态测试，收集执行跟踪并进行比较。</li></ul></div><div class="ab cl kf kg hb kh" role="separator"><span class="ki bw bk kj kk kl"/><span class="ki bw bk kj kk kl"/><span class="ki bw bk kj kk"/></div><div class="hm hn ho hp hq"><p id="9228" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">非常感谢Martin Holst Swende对goevmlab的持续工作，以及他为保存以太坊而捐赠的所有CPU周期！非常感谢Alexander Vlasov实现了这些库，并且一路帮助我们。非常感谢所有客户团队对Martin和我的bug报告做出的快速反应。</p><p id="76f6" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">如果您对我们的模糊化工作有任何疑问，请联系我！Twitter上的@ vdWijden或Linkedin上的Marius van der Wijden<a class="ae jo" href="https://www.linkedin.com/in/marius-van-der-wijden-5bba26173/" rel="noopener ugc nofollow" target="_blank"/>。</p><figure class="jq jr js jt fq ju fe ff paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="fe ff mf"><img src="../Images/7921c968d09eb4f0f4af5b39f74d7b3b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hglZ1fcMKTjNaYl8xf_81A.png"/></div></div></figure><h2 id="b751" class="mg kn ht bd ko mh mi mj ks mk ml mm kw jb mn mo la jf mp mq le jj mr ms li mt dt translated">另外，阅读</h2><ul class=""><li id="02dc" class="lk ll ht is b it lm ix ln jb lo jf lp jj lq jn lr ls lt lu dt translated">最好的<a class="ae jo" rel="noopener" href="/coinmonks/crypto-trading-bot-c2ffce8acb2a">密码交易机器人</a></li><li id="b851" class="lk ll ht is b it lv ix lw jb lx jf ly jj lz jn lr ls lt lu dt translated"><a class="ae jo" rel="noopener" href="/coinmonks/top-10-crypto-copy-trading-platforms-for-beginners-d0c37c7d698c">密码本交易平台</a></li><li id="ae2d" class="lk ll ht is b it lv ix lw jb lx jf ly jj lz jn lr ls lt lu dt translated">最好的<a class="ae jo" rel="noopener" href="/coinmonks/best-crypto-tax-tool-for-my-money-72d4b430816b">加密税务软件</a></li><li id="92e4" class="lk ll ht is b it lv ix lw jb lx jf ly jj lz jn lr ls lt lu dt translated"><a class="ae jo" rel="noopener" href="/coinmonks/the-best-crypto-trading-platforms-in-2020-the-definitive-guide-updated-c72f8b874555">最佳加密交易平台</a></li><li id="d8fc" class="lk ll ht is b it lv ix lw jb lx jf ly jj lz jn lr ls lt lu dt translated">最佳<a class="ae jo" rel="noopener" href="/coinmonks/top-5-crypto-lending-platforms-in-2020-that-you-need-to-know-a1b675cec3fa">加密贷款平台</a></li><li id="4f10" class="lk ll ht is b it lv ix lw jb lx jf ly jj lz jn lr ls lt lu dt translated"><a class="ae jo" href="https://bitquery.io/blog/best-blockchain-analysis-tools-and-software" rel="noopener ugc nofollow" target="_blank">最佳区块链分析工具</a></li><li id="d432" class="lk ll ht is b it lv ix lw jb lx jf ly jj lz jn lr ls lt lu dt translated"><a class="ae jo" rel="noopener" href="/coinmonks/crypto-arbitrage-guide-how-to-make-money-as-a-beginner-62bfe5c868f6">加密套利</a>指南:新手如何赚钱</li><li id="aa54" class="lk ll ht is b it lv ix lw jb lx jf ly jj lz jn lr ls lt lu dt translated">最佳<a class="ae jo" rel="noopener" href="/coinmonks/what-are-the-best-charting-platforms-for-cryptocurrency-trading-85aade584d80">加密制图工具</a></li><li id="15e1" class="lk ll ht is b it lv ix lw jb lx jf ly jj lz jn lr ls lt lu dt translated"><a class="ae jo" rel="noopener" href="/coinmonks/ledger-vs-trezor-best-hardware-wallet-to-secure-cryptocurrency-22c7a3fd391e">莱杰vs特雷佐</a></li><li id="56fd" class="lk ll ht is b it lv ix lw jb lx jf ly jj lz jn lr ls lt lu dt translated">了解比特币最好的<a class="ae jo" rel="noopener" href="/coinmonks/what-are-the-best-books-to-learn-bitcoin-409aeb9aff4b">书籍有哪些？</a></li><li id="170f" class="lk ll ht is b it lv ix lw jb lx jf ly jj lz jn lr ls lt lu dt translated"><a class="ae jo" rel="noopener" href="/coinmonks/3commas-review-an-excellent-crypto-trading-bot-2020-1313a58bec92">3商业评论</a></li><li id="d145" class="lk ll ht is b it lv ix lw jb lx jf ly jj lz jn lr ls lt lu dt translated"><a class="ae jo" rel="noopener" href="/coinmonks/aax-exchange-review-2021-67c5ea09330c"> AAX交易所评论</a> |推荐代码、交易费用、利弊</li><li id="54f9" class="lk ll ht is b it lv ix lw jb lx jf ly jj lz jn lr ls lt lu dt translated"><a class="ae jo" rel="noopener" href="/coinmonks/deribit-review-options-fees-apis-and-testnet-2ca16c4bbdb2"> Deribit审查</a> |选项、费用、API和Testnet</li><li id="e34b" class="lk ll ht is b it lv ix lw jb lx jf ly jj lz jn lr ls lt lu dt translated"><a class="ae jo" rel="noopener" href="/coinmonks/ftx-crypto-exchange-review-53664ac1198f"> FTX密码交易所评论</a></li><li id="d0c3" class="lk ll ht is b it lv ix lw jb lx jf ly jj lz jn lr ls lt lu dt translated"><a class="ae jo" rel="noopener" href="/coinmonks/ngrave-zero-review-c465cf8307fc">n零审核</a></li><li id="1310" class="lk ll ht is b it lv ix lw jb lx jf ly jj lz jn lr ls lt lu dt translated"><a class="ae jo" rel="noopener" href="/coinmonks/bybit-exchange-review-dbd570019b71"> Bybit交换审查</a></li><li id="8b1e" class="lk ll ht is b it lv ix lw jb lx jf ly jj lz jn lr ls lt lu dt translated"><a class="ae jo" rel="noopener" href="/coinmonks/cryptohopper-vs-3commas-vs-shrimpy-a2c16095b8fe"> 3Commas vs Cryptohopper </a></li><li id="b18b" class="lk ll ht is b it lv ix lw jb lx jf ly jj lz jn lr ls lt lu dt translated">最好的比特币<a class="ae jo" rel="noopener" href="/coinmonks/the-best-cryptocurrency-hardware-wallets-of-2020-e28b1c124069?source=friends_link&amp;sk=324dd9ff8556ab578d71e7ad7658ad7c">硬件钱包</a></li><li id="e7b1" class="lk ll ht is b it lv ix lw jb lx jf ly jj lz jn lr ls lt lu dt translated">最佳<a class="ae jo" href="https://blog.coincodecap.com/best-monero-wallets" rel="noopener ugc nofollow" target="_blank"> monero钱包</a></li><li id="747f" class="lk ll ht is b it lv ix lw jb lx jf ly jj lz jn lr ls lt lu dt translated"><a class="ae jo" href="https://blog.coincodecap.com/ledger-nano-s-vs-x" rel="noopener ugc nofollow" target="_blank">莱杰nano s vs x </a></li><li id="ace6" class="lk ll ht is b it lv ix lw jb lx jf ly jj lz jn lr ls lt lu dt translated"><a class="ae jo" href="https://blog.coincodecap.com/bitsgap-3commas-quadency" rel="noopener ugc nofollow" target="_blank">bits gap vs 3 commas vs quad ency</a></li><li id="a274" class="lk ll ht is b it lv ix lw jb lx jf ly jj lz jn lr ls lt lu dt translated"><a class="ae jo" href="https://blog.coincodecap.com/ledger-nano-s-vs-trezor-one-ledger-nano-x-trezor-t" rel="noopener ugc nofollow" target="_blank">莱杰纳米S vs特雷佐1 vs特雷佐T vs莱杰纳米X </a></li><li id="44f0" class="lk ll ht is b it lv ix lw jb lx jf ly jj lz jn lr ls lt lu dt translated"><a class="ae jo" rel="noopener" href="/coinmonks/blockfi-vs-celsius-vs-hodlnaut-8a1cc8c26630">block fi vs Celsius</a>vs Hodlnaut</li><li id="52d0" class="lk ll ht is b it lv ix lw jb lx jf ly jj lz jn lr ls lt lu dt translated">Bitsgap评论——一个轻松赚钱的加密交易机器人</li><li id="92c0" class="lk ll ht is b it lv ix lw jb lx jf ly jj lz jn lr ls lt lu dt translated">为专业人士设计的加密交易机器人</li><li id="22eb" class="lk ll ht is b it lv ix lw jb lx jf ly jj lz jn lr ls lt lu dt translated"><a class="ae jo" rel="noopener" href="/coinmonks/primexbt-review-88e0815be858"> PrimeXBT审查</a> |杠杆交易、费用和交易</li><li id="62d2" class="lk ll ht is b it lv ix lw jb lx jf ly jj lz jn lr ls lt lu dt translated"><a class="ae jo" rel="noopener" href="/coinmonks/ellipal-titan-review-85e9071dd029">埃利帕尔泰坦评论</a></li><li id="1a26" class="lk ll ht is b it lv ix lw jb lx jf ly jj lz jn lr ls lt lu dt translated"><a class="ae jo" href="https://blog.coincodecap.com/secux-stone-hardware-wallet-review" rel="noopener ugc nofollow" target="_blank"> SecuX Stone评论</a></li><li id="31ff" class="lk ll ht is b it lv ix lw jb lx jf ly jj lz jn lr ls lt lu dt translated"><a class="ae jo" rel="noopener" href="/coinmonks/blockfi-review-53096053c097"> BlockFi评论</a> |从您的密码中赚取高达8.6%的利息</li></ul></div></div>    
</body>
</html>