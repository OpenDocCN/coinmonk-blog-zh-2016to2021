<html>
<head>
<title>Signing and making transactions on Ethereum using web3.js</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用web3.js在以太坊上签名和进行交易</h1>
<blockquote>原文：<a href="https://medium.com/coinmonks/signing-and-making-transactions-on-ethereum-using-web3-js-1b5663207d63?source=collection_archive---------0-----------------------#2018-04-15">https://medium.com/coinmonks/signing-and-making-transactions-on-ethereum-using-web3-js-1b5663207d63?source=collection_archive---------0-----------------------#2018-04-15</a></blockquote><div><div class="ef hh hi hj hk hl"/><div class="hm hn ho hp hq"><div class=""/><blockquote class="iq ir is"><p id="6253" class="it iu iv iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hm dt translated">我已经和各种区块链平台合作了一段时间了。如果你想联系我，请给我发邮件到aaroncolaco.com的亚伦</p></blockquote><figure class="jt ju jv jw fq jx fe ff paragraph-image"><div role="button" tabindex="0" class="jy jz di ka bf kb"><div class="fe ff js"><img src="../Images/4336c968f21a75bf82b62f07d2dba87c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*Fg_U2FGCCUHPszWH."/></div></div><figcaption class="ke kf fg fe ff kg kh bd b be z ek">“Palm tree on the hill overlooking ocean bay surrounded by cliffs” by <a class="ae ki" href="https://unsplash.com/@chorhung?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Chor Hung Tsang</a> on <a class="ae ki" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="3a2b" class="pw-post-body-paragraph it iu ht iw b ix iy iz ja jb jc jd je kj jg jh ji kk jk jl jm kl jo jp jq jr hm dt translated">最近的一个用例迫使我在以太坊区块链上进行交易，没有运行我自己的对等体，也没有使用任何<a class="ae ki" href="https://coincodecap.com/category/wallets" rel="noopener ugc nofollow" target="_blank">钱包</a>或扩展，如<a class="ae ki" href="https://github.com/ethereum/mist" rel="noopener ugc nofollow" target="_blank">薄雾</a>或<a class="ae ki" href="https://metamask.io" rel="noopener ugc nofollow" target="_blank"> Metamask </a>。</p><div class="km kn fm fo ko kp"><a href="https://github.com/ethereum/mist" rel="noopener  ugc nofollow" target="_blank"><div class="kq ab ej"><div class="kr ab ks cl cj kt"><h2 class="bd hu fv z el ku eo ep kv er et hs dt translated">以太坊/薄雾</h2><div class="kw l"><h3 class="bd b fv z el ku eo ep kv er et ek translated">薄雾薄雾。浏览和使用以太坊网络上的应用程序。</h3></div><div class="kx l"><p class="bd b gc z el ku eo ep kv er et ek translated">github.com</p></div></div><div class="ky l"><div class="kz l la lb lc ky ld kc kp"/></div></div></a></div><div class="km kn fm fo ko kp"><a href="https://metamask.io/" rel="noopener  ugc nofollow" target="_blank"><div class="kq ab ej"><div class="kr ab ks cl cj kt"><h2 class="bd hu fv z el ku eo ep kv er et hs dt translated">元掩码</h2><div class="kw l"><h3 class="bd b fv z el ku eo ep kv er et ek translated">将以太坊带到你的浏览器中。</h3></div><div class="kx l"><p class="bd b gc z el ku eo ep kv er et ek translated">metamask.io</p></div></div><div class="ky l"><div class="le l la lb lc ky ld kc kp"/></div></div></a></div><p id="308a" class="pw-post-body-paragraph it iu ht iw b ix iy iz ja jb jc jd je kj jg jh ji kk jk jl jm kl jo jp jq jr hm dt translated">我将概述我是如何使用一个密钥库文件和<a class="ae ki" href="https://github.com/ethereum/web3.js" rel="noopener ugc nofollow" target="_blank"> web3.js </a>来做这件事的。</p><p id="4048" class="pw-post-body-paragraph it iu ht iw b ix iy iz ja jb jc jd je kj jg jh ji kk jk jl jm kl jo jp jq jr hm dt translated">我联系了Infura的同行来测试这一点。这是免费的，如果你不想运行自己的同行，你应该尝试一下。</p><div class="km kn fm fo ko kp"><a href="https://infura.io/" rel="noopener  ugc nofollow" target="_blank"><div class="kq ab ej"><div class="kr ab ks cl cj kt"><h2 class="bd hu fv z el ku eo ep kv er et hs dt translated">Infura -可扩展的区块链基础设施</h2><div class="kw l"><h3 class="bd b fv z el ku eo ep kv er et ek translated">对以太坊API和IPFS网关的安全、可靠和可伸缩的访问。</h3></div><div class="kx l"><p class="bd b gc z el ku eo ep kv er et ek translated">infura.io</p></div></div><div class="ky l"><div class="lf l la lb lc ky ld kc kp"/></div></div></a></div><p id="a42f" class="pw-post-body-paragraph it iu ht iw b ix iy iz ja jb jc jd je kj jg jh ji kk jk jl jm kl jo jp jq jr hm dt translated">我假设您已经知道如何创建密钥库文件。如果没有，看一下<a class="ae ki" href="https://github.com/ethereum/go-ethereum/wiki/Managing-your-accounts" rel="noopener ugc nofollow" target="_blank">文档</a>(使用geth)。</p><p id="2579" class="pw-post-body-paragraph it iu ht iw b ix iy iz ja jb jc jd je kj jg jh ji kk jk jl jm kl jo jp jq jr hm dt translated">我用的是<em class="iv"> node v8.9.3 </em>和<em class="iv">web 3v 1 . 0 . 0-beta 34</em></p><ol class=""><li id="b079" class="lg lh ht iw b ix iy jb jc kj li kk lj kl lk jr ll lm ln lo dt translated">导入web3(咄！)</li></ol><pre class="jt ju jv jw fq lp lq lr ls aw lt dt"><span id="dd6f" class="lu lv ht lq b fv lw lx l ly lz">const Web3 = require('web3');</span></pre><p id="f458" class="pw-post-body-paragraph it iu ht iw b ix iy iz ja jb jc jd je kj jg jh ji kk jk jl jm kl jo jp jq jr hm dt translated">2.连接到Infura的同行</p><p id="0de4" class="pw-post-body-paragraph it iu ht iw b ix iy iz ja jb jc jd je kj jg jh ji kk jk jl jm kl jo jp jq jr hm dt translated">(或者您可以连接到您自己的同事)</p><pre class="jt ju jv jw fq lp lq lr ls aw lt dt"><span id="7ee0" class="lu lv ht lq b fv lw lx l ly lz">const web3 = new Web3(new Web3.providers.HttpProvider("https://ropsten.infura.io/&lt;TOKEN&gt;"));</span></pre><p id="399b" class="pw-post-body-paragraph it iu ht iw b ix iy iz ja jb jc jd je kj jg jh ji kk jk jl jm kl jo jp jq jr hm dt translated">3.读取密钥库文件的内容</p><p id="5581" class="pw-post-body-paragraph it iu ht iw b ix iy iz ja jb jc jd je kj jg jh ji kk jk jl jm kl jo jp jq jr hm dt translated">(为了简单起见，我将复制内容)</p><pre class="jt ju jv jw fq lp lq lr ls aw lt dt"><span id="6e5a" class="lu lv ht lq b fv lw lx l ly lz">const keystore = "Contents of keystore file";</span></pre><p id="08f8" class="pw-post-body-paragraph it iu ht iw b ix iy iz ja jb jc jd je kj jg jh ji kk jk jl jm kl jo jp jq jr hm dt translated">4.解密密钥库文件</p><pre class="jt ju jv jw fq lp lq lr ls aw lt dt"><span id="2967" class="lu lv ht lq b fv lw lx l ly lz">const decryptedAccount = web3.eth.accounts.decrypt(keystore, 'PASSWORD');</span></pre><p id="a5d2" class="pw-post-body-paragraph it iu ht iw b ix iy iz ja jb jc jd je kj jg jh ji kk jk jl jm kl jo jp jq jr hm dt translated">5.创建事务对象</p><pre class="jt ju jv jw fq lp lq lr ls aw lt dt"><span id="1c7c" class="lu lv ht lq b fv lw lx l ly lz">var rawTransaction = {</span><span id="e93c" class="lu lv ht lq b fv ma lx l ly lz">  "from": "Keystore account id",</span><span id="25de" class="lu lv ht lq b fv ma lx l ly lz">  "to": "Account you want to transfer to",</span><span id="f341" class="lu lv ht lq b fv ma lx l ly lz">  "value": web3.utils.toHex(web3.utils.toWei("0.001", "ether")),</span><span id="b2d8" class="lu lv ht lq b fv ma lx l ly lz">  "gas": 200000,</span><span id="d9ce" class="lu lv ht lq b fv ma lx l ly lz">  "chainId": 3</span><span id="1f6a" class="lu lv ht lq b fv ma lx l ly lz">};</span></pre><p id="e735" class="pw-post-body-paragraph it iu ht iw b ix iy iz ja jb jc jd je kj jg jh ji kk jk jl jm kl jo jp jq jr hm dt translated">6.签署并发送交易</p><pre class="jt ju jv jw fq lp lq lr ls aw lt dt"><span id="9b30" class="lu lv ht lq b fv lw lx l ly lz">decryptedAccount.signTransaction(rawTransaction)</span><span id="1b55" class="lu lv ht lq b fv ma lx l ly lz">  .then(signedTx =&gt; web3.eth.sendSignedTransaction(signedTx.rawTransaction))</span><span id="6518" class="lu lv ht lq b fv ma lx l ly lz">  .then(receipt =&gt; console.log("Transaction receipt: ", receipt))</span><span id="6002" class="lu lv ht lq b fv ma lx l ly lz">  .catch(err =&gt; console.error(err));</span></pre><p id="0ed1" class="pw-post-body-paragraph it iu ht iw b ix iy iz ja jb jc jd je kj jg jh ji kk jk jl jm kl jo jp jq jr hm dt translated">您还可以使用解密的密钥库文件中的私钥对事务进行签名:</p><pre class="jt ju jv jw fq lp lq lr ls aw lt dt"><span id="3b3e" class="lu lv ht lq b fv lw lx l ly lz">web3.eth.accounts.signTransaction(rawTransaction, decryptedAccount.privateKey)</span><span id="88f1" class="lu lv ht lq b fv ma lx l ly lz">  .then(console.log);</span></pre><p id="5411" class="pw-post-body-paragraph it iu ht iw b ix iy iz ja jb jc jd je kj jg jh ji kk jk jl jm kl jo jp jq jr hm dt translated">完整代码:</p><pre class="jt ju jv jw fq lp lq lr ls aw lt dt"><span id="af8c" class="lu lv ht lq b fv lw lx l ly lz">const Web3 = require('web3');<br/></span><span id="c05c" class="lu lv ht lq b fv ma lx l ly lz">// connect to any peer; using infura here</span><span id="aea2" class="lu lv ht lq b fv ma lx l ly lz">const web3 = new Web3(new Web3.providers.HttpProvider("https://ropsten.infura.io/&lt;TOKEN&gt;"));<br/></span><span id="1402" class="lu lv ht lq b fv ma lx l ly lz">// contents of keystore file, can do a fs read</span><span id="0561" class="lu lv ht lq b fv ma lx l ly lz">const keystore = "Contents of keystore file";</span><span id="c1b8" class="lu lv ht lq b fv ma lx l ly lz">const decryptedAccount = web3.eth.accounts.decrypt(keystore, 'PASSWORD');<br/></span><span id="727d" class="lu lv ht lq b fv ma lx l ly lz">const rawTransaction = {</span><span id="e204" class="lu lv ht lq b fv ma lx l ly lz">  "from": "Keystore account id",</span><span id="e1d4" class="lu lv ht lq b fv ma lx l ly lz">  "to": "Account you want to transfer to",</span><span id="73cc" class="lu lv ht lq b fv ma lx l ly lz">  "value": web3.utils.toHex(web3.utils.toWei("0.001", "ether")),</span><span id="bcc4" class="lu lv ht lq b fv ma lx l ly lz">  "gas": 2000,</span><span id="3aa9" class="lu lv ht lq b fv ma lx l ly lz">  "chainId": 3</span><span id="bea0" class="lu lv ht lq b fv ma lx l ly lz">};</span><span id="f160" class="lu lv ht lq b fv ma lx l ly lz">decryptedAccount.signTransaction(rawTransaction)</span><span id="32cb" class="lu lv ht lq b fv ma lx l ly lz">  .then(signedTx =&gt; web3.eth.sendSignedTransaction(signedTx.rawTransaction))</span><span id="f75d" class="lu lv ht lq b fv ma lx l ly lz">  .then(receipt =&gt; console.log("Transaction receipt: ", receipt))</span><span id="6d4f" class="lu lv ht lq b fv ma lx l ly lz">  .catch(err =&gt; console.error(err));</span><span id="8e5b" class="lu lv ht lq b fv ma lx l ly lz">// Or sign using private key from decrypted keystore file</span><span id="edc6" class="lu lv ht lq b fv ma lx l ly lz">/*</span><span id="3db8" class="lu lv ht lq b fv ma lx l ly lz">web3.eth.accounts.signTransaction(rawTransaction, decryptedAccount.privateKey)</span><span id="090a" class="lu lv ht lq b fv ma lx l ly lz">  .then(console.log);</span><span id="9330" class="lu lv ht lq b fv ma lx l ly lz">*/</span></pre><p id="8253" class="pw-post-body-paragraph it iu ht iw b ix iy iz ja jb jc jd je kj jg jh ji kk jk jl jm kl jo jp jq jr hm dt translated">这种方法也适用于移动应用程序，而且比你必须运行自己的同行并在上面签署所有交易要好。</p><blockquote class="mb"><p id="03b5" class="mc md ht bd me mf mg mh mi mj mk jr ek translated">加入Coinmonks <a class="ae ki" href="https://t.me/coincodecap" rel="noopener ugc nofollow" target="_blank">电报频道</a>和<a class="ae ki" href="https://www.youtube.com/c/coinmonks/videos" rel="noopener ugc nofollow" target="_blank"> Youtube频道</a>获取每日<a class="ae ki" href="http://coincodecap.com/" rel="noopener ugc nofollow" target="_blank">加密新闻</a></p></blockquote><h2 id="15d6" class="lu lv ht bd ml mm mn mo mp mq mr ms mt kj mu mv mw kk mx my mz kl na nb nc nd dt translated">另外，阅读</h2><ul class=""><li id="20fb" class="lg lh ht iw b ix ne jb nf kj ng kk nh kl ni jr nj lm ln lo dt translated"><a class="ae ki" rel="noopener" href="/coinmonks/top-10-crypto-copy-trading-platforms-for-beginners-d0c37c7d698c">复制交易</a> | <a class="ae ki" rel="noopener" href="/coinmonks/crypto-tax-software-ed4b4810e338">加密税务软件</a></li><li id="723e" class="lg lh ht iw b ix nk jb nl kj nm kk nn kl no jr nj lm ln lo dt translated"><a class="ae ki" href="https://coincodecap.com/grid-trading" rel="noopener ugc nofollow" target="_blank">网格交易</a> | <a class="ae ki" rel="noopener" href="/coinmonks/the-best-cryptocurrency-hardware-wallets-of-2020-e28b1c124069">加密硬件钱包</a></li><li id="874f" class="lg lh ht iw b ix nk jb nl kj nm kk nn kl no jr nj lm ln lo dt translated"><a class="ae ki" href="http://Top 4 Telegram Channels for Crypto Traders" rel="noopener ugc nofollow" target="_blank">密码电报信号</a> | <a class="ae ki" rel="noopener" href="/coinmonks/crypto-trading-bot-c2ffce8acb2a">密码交易机器人</a></li><li id="f33b" class="lg lh ht iw b ix nk jb nl kj nm kk nn kl no jr nj lm ln lo dt translated"><a class="ae ki" rel="noopener" href="/coinmonks/crypto-exchange-dd2f9d6f3769">最佳加密交易所</a> | <a class="ae ki" rel="noopener" href="/coinmonks/bitcoin-exchange-in-india-7f1fe79715c9">印度最佳加密交易所</a></li><li id="47a8" class="lg lh ht iw b ix nk jb nl kj nm kk nn kl no jr nj lm ln lo dt translated"><a class="ae ki" rel="noopener" href="/coinmonks/best-crypto-apis-for-developers-5efe3a597a9f">面向开发人员的最佳加密API</a></li><li id="b359" class="lg lh ht iw b ix nk jb nl kj nm kk nn kl no jr nj lm ln lo dt translated">最佳<a class="ae ki" rel="noopener" href="/coinmonks/top-5-crypto-lending-platforms-in-2020-that-you-need-to-know-a1b675cec3fa">密码借贷平台</a></li><li id="9487" class="lg lh ht iw b ix nk jb nl kj nm kk nn kl no jr nj lm ln lo dt translated">杠杆代币的终极指南</li><li id="3310" class="lg lh ht iw b ix nk jb nl kj nm kk nn kl no jr nj lm ln lo dt translated"><a class="ae ki" href="https://coincodecap.com/ascendex-staking" rel="noopener ugc nofollow" target="_blank">AscendEx Staking</a>|<a class="ae ki" href="https://coincodecap.com/bot-ocean-review" rel="noopener ugc nofollow" target="_blank">Bot Ocean Review</a>|<a class="ae ki" href="https://coincodecap.com/bitcoin-wallets-india" rel="noopener ugc nofollow" target="_blank">最佳比特币钱包</a></li><li id="15e5" class="lg lh ht iw b ix nk jb nl kj nm kk nn kl no jr nj lm ln lo dt translated"><a class="ae ki" href="https://coincodecap.com/bitget-review" rel="noopener ugc nofollow" target="_blank"> Bitget评论</a> | <a class="ae ki" href="https://coincodecap.com/gemini-vs-blockfi" rel="noopener ugc nofollow" target="_blank">双子星vs BlockFi </a> | <a class="ae ki" href="https://coincodecap.com/okex-futures-trading" rel="noopener ugc nofollow" target="_blank"> OKEx期货交易</a></li><li id="c009" class="lg lh ht iw b ix nk jb nl kj nm kk nn kl no jr nj lm ln lo dt translated"><a class="ae ki" href="https://coincodecap.com/crypto-trading-bots-in-the-us" rel="noopener ugc nofollow" target="_blank">美国最佳加密交易机器人</a> | <a class="ae ki" href="https://coincodecap.com/changelly-review" rel="noopener ugc nofollow" target="_blank">经常性回顾</a></li><li id="7716" class="lg lh ht iw b ix nk jb nl kj nm kk nn kl no jr nj lm ln lo dt translated"><a class="ae ki" href="https://coincodecap.com/crypto-arbitrage-in-india" rel="noopener ugc nofollow" target="_blank">在印度利用加密套利赚取被动收入</a></li><li id="92d8" class="lg lh ht iw b ix nk jb nl kj nm kk nn kl no jr nj lm ln lo dt translated"><a class="ae ki" href="https://coincodecap.com/huobi-review" rel="noopener ugc nofollow" target="_blank">霍比审核</a> | <a class="ae ki" href="https://coincodecap.com/okex-margin-trading" rel="noopener ugc nofollow" target="_blank"> OKEx保证金交易</a> | <a class="ae ki" href="https://coincodecap.com/futures-trading" rel="noopener ugc nofollow" target="_blank">期货交易</a></li><li id="d179" class="lg lh ht iw b ix nk jb nl kj nm kk nn kl no jr nj lm ln lo dt translated"><a class="ae ki" href="https://coincodecap.com/sparrow-exchange-review" rel="noopener ugc nofollow" target="_blank">麻雀交换评论</a> | <a class="ae ki" href="https://coincodecap.com/nash-exchange-review" rel="noopener ugc nofollow" target="_blank">纳什交换评论</a></li></ul></div></div>    
</body>
</html>