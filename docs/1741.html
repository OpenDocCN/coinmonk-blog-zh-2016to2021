<html>
<head>
<title>Part 9: Implementing Blockchain and Cryptocurrency with PoW consensus algorithm</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">第9部分:用PoW共识算法实现区块链和加密货币</h1>
<blockquote>原文：<a href="https://medium.com/coinmonks/part-9-implementing-blockchain-and-cryptocurrency-with-pow-consensus-algorithm-e23ded159099?source=collection_archive---------3-----------------------#2018-11-01">https://medium.com/coinmonks/part-9-implementing-blockchain-and-cryptocurrency-with-pow-consensus-algorithm-e23ded159099?source=collection_archive---------3-----------------------#2018-11-01</a></blockquote><div><div class="ef hh hi hj hk hl"/><div class="hm hn ho hp hq"><div class=""/><p id="3086" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">在node.js中使用工作共识算法证明，小规模、易于理解、全面、逐步实施区块链和加密货币</p><figure class="jp jq jr js fq jt fe ff paragraph-image"><div class="fe ff jo"><img src="../Images/ca1a2e2c4224dbbeb2b00eaca6e45a01.png" data-original-src="https://miro.medium.com/v2/resize:fit:800/format:webp/1*4tiX8RcB0DnrDZZ0l8yxGw.jpeg"/></div><figcaption class="jw jx fg fe ff jy jz bd b be z ek">Source: <a class="ae ka" href="https://en.bitcoinwiki.org/wiki/Proof-of-work" rel="noopener ugc nofollow" target="_blank">Bitcoin Wiki</a></figcaption></figure><p id="02d7" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">这将是这个系列的最后一部分。到目前为止，我们已经创建了我们的区块链和加密货币。剩下的就是算余额了。</p><p id="f879" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">基于区块链中的交易，用户可以计算余额。我们可以通过将发送给用户的事务中的所有输出相加来做到这一点。</p><p id="cf4a" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">但是这里有一个问题，如果我们把从一开始就创建的所有输出加起来，我们可能会重复计算输出。</p><p id="b540" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">因此，为了解决这个问题，我们将只添加自最近交易以来的输出，因为用户可能以前已经使用过这些输出。</p><p id="dfaf" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">让我们编写代码来计算wallet类中的余额。</p><figure class="jp jq jr js fq jt"><div class="bz el l di"><div class="kb kc l"/></div></figure><p id="f065" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">每当我们创建一个新的交易时，我们都要更新余额，所以让我们将它添加到<code class="eh kd ke kf kg b">createTransaction </code>函数中。为了访问事务，我们需要一个区块链实例，所以我们将它作为参数传递。</p><pre class="jp jq jr js fq kh kg ki kj aw kk dt"><span id="398d" class="kl km ht kg b fv kn ko l kp kq">createTransaction(recipient, amount,blockchain, transactionPool){</span><span id="9b42" class="kl km ht kg b fv kr ko l kp kq">   this.balance = this.calculateBalance(blockchain);</span><span id="80fa" class="kl km ht kg b fv kr ko l kp kq">   if(amount &gt; this.balance){<br/>             console.log(`Amount: ${amount} exceeds the current<br/>             balance: ${this.balance}`);</span><span id="b266" class="kl km ht kg b fv kr ko l kp kq">   return;</span><span id="bded" class="kl km ht kg b fv kr ko l kp kq">  }</span><span id="ff4c" class="kl km ht kg b fv kr ko l kp kq">  .<br/>  .<br/>  .</span><span id="89a7" class="kl km ht kg b fv kr ko l kp kq">}</span></pre><p id="b2d7" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">我们还必须在使用<code class="eh kd ke kf kg b">createTransaction </code>时更新它。在VS代码中搜索<code class="eh kd ke kf kg b">createTransaction</code>并更新功能。</p><p id="8659" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">我们将在app/index.js文件中传递区块链实例。</p><p id="3758" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">在测试文件中，我们没有区块链实例，但是我们可以创建一个，然后在需要的地方传递它。我们在wallet/index.test.js和transaction-pool.test.js中这样做</p><p id="3ee1" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">您可以重新运行测试，我们将像以前一样通过所有测试。</p><p id="be63" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">接下来，我们将测试<code class="eh kd ke kf kg b">calculateBalance</code>函数。</p><p id="57fa" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">将以下测试用例添加到wallet/index.test.js文件中。</p><figure class="jp jq jr js fq jt"><div class="bz el l di"><div class="kb kc l"/></div></figure><p id="af64" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">运行测试，您将有31个测试通过。</p><p id="d773" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">我们的加密货币终于准备好了。</p><p id="edd4" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">继续重新启动应用程序，从头开始探索它的所有功能。在不同的端口上运行几个实例，互相发送加密货币。</p><p id="522d" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">这就完成了项目。！！</p><figure class="jp jq jr js fq jt"><div class="bz el l di"><div class="ks kc l"/></div><figcaption class="jw jx fg fe ff jy jz bd b be z ek">Source: <a class="ae ka" href="https://media.giphy.com/media/5GoVLqeAOo6PK/giphy.gif" rel="noopener ugc nofollow" target="_blank">giphy</a></figcaption></figure></div><div class="ab cl kt ku hb kv" role="separator"><span class="kw bw bk kx ky kz"/><span class="kw bw bk kx ky kz"/><span class="kw bw bk kx ky"/></div><div class="hm hn ho hp hq"><h1 id="f039" class="la km ht bd lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw dt translated">延长</h1><p id="534a" class="pw-post-body-paragraph iq ir ht is b it lx iv iw ix ly iz ja jb lz jd je jf ma jh ji jj mb jl jm jn hm dt translated">如果我们想创建一个更健壮的应用程序，您可以尝试以下方法:</p><ol class=""><li id="6e52" class="mc md ht is b it iu ix iy jb me jf mf jj mg jn mh mi mj mk dt translated">创建余额获取请求</li><li id="5c0f" class="mc md ht is b it ml ix mm jb mn jf mo jj mp jn mh mi mj mk dt translated">广播块而不是链</li><li id="2324" class="mc md ht is b it ml ix mm jb mn jf mo jj mp jn mh mi mj mk dt translated">添加事务池阈值</li><li id="4048" class="mc md ht is b it ml ix mm jb mn jf mo jj mp jn mh mi mj mk dt translated">有选择地从池中删除事务</li><li id="f776" class="mc md ht is b it ml ix mm jb mn jf mo jj mp jn mh mi mj mk dt translated">创建一个不需要被调用的自治矿工</li><li id="f230" class="mc md ht is b it ml ix mm jb mn jf mo jj mp jn mh mi mj mk dt translated">添加交易费，最快的矿工将获得交易费</li></ol></div><div class="ab cl kt ku hb kv" role="separator"><span class="kw bw bk kx ky kz"/><span class="kw bw bk kx ky kz"/><span class="kw bw bk kx ky"/></div><div class="hm hn ho hp hq"><p id="17f1" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">如果你愿意，那么，你可以在这里阅读中本聪发表的原创论文:<a class="ae ka" href="https://bitcoin.org/bitcoin.pdf" rel="noopener ugc nofollow" target="_blank">原创比特币研究论文</a></p><p id="867a" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated"><em class="mq">你可以在这里</em>  <em class="mq">找到这个项目</em> <a class="ae ka" href="https://github.com/kashishkhullar/blockchain-nodejs" rel="noopener ugc nofollow" target="_blank"> <em class="mq">的全部工作代码。</em></a></p><p id="5996" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">感谢您的阅读。请随意提出与本文、区块链或整个世界相关的任何问题。</p><p id="0e76" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">如果你喜欢或发现这很有帮助，请鼓掌。 <strong class="is hu"> <em class="mq">👏</em> </strong></p><p id="50b1" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">快乐编码:)</p><blockquote class="mr"><p id="5b95" class="ms mt ht bd mu mv mw mx my mz na jn ek translated"><a class="ae ka" href="https://coincodecap.com/?utm_source=coinmonks" rel="noopener ugc nofollow" target="_blank">直接在您的收件箱中获得最佳软件交易</a></p></blockquote><figure class="nc nd ne nf ng jt fe ff paragraph-image"><a href="https://coincodecap.com/?utm_source=coinmonks"><div class="fe ff nb"><img src="../Images/7c0b3dfdcbfea594cc0ae7d4f9bf6fcb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1168/format:webp/0*OJ-qb5G6i863msBB.png"/></div></a></figure></div></div>    
</body>
</html>