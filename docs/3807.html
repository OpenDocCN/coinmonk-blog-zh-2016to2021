<html>
<head>
<title>Ethereum Meta-Transactions 101</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">以太坊元交易101</h1>
<blockquote>原文：<a href="https://medium.com/coinmonks/ethereum-meta-transactions-101-de7f91884a06?source=collection_archive---------1-----------------------#2020-12-29">https://medium.com/coinmonks/ethereum-meta-transactions-101-de7f91884a06?source=collection_archive---------1-----------------------#2020-12-29</a></blockquote><div><div class="ef hh hi hj hk hl"/><div class="hm hn ho hp hq"><figure class="hs ht fm fo hu hv fe ff paragraph-image"><div role="button" tabindex="0" class="hw hx di hy bf hz"><div class="fe ff hr"><img src="../Images/15e0560af51e9f52b1784b679d8fa633.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*A6pvhAE_8DRy1vLFQSYW5Q.png"/></div></div></figure><div class=""/><p id="4819" class="pw-post-body-paragraph jb jc ie jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">在以太世界中，事情的发生要归功于交易。这些交易，就像生活中的一切，都不是免费的。为了创建和执行一项交易，你需要以“汽油”的形式支付一笔费用，这需要花费<a class="ae jz" href="https://coinmarketcap.com/currencies/ethereum/" rel="noopener ugc nofollow" target="_blank"> ETH </a>。</p><p id="0734" class="pw-post-body-paragraph jb jc ie jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">但是，如果您想创建一个交易，但又没有钱支付汽油费用，该怎么办呢？这就是元交易的用武之地！</p><blockquote class="ka kb kc"><p id="67e8" class="jb jc kd jd b je jf jg jh ji jj jk jl ke jn jo jp kf jr js jt kg jv jw jx jy hm dt translated">元事务是由一个人创建和签署离线数据，并由另一个支付天然气费用的人执行的事务。</p></blockquote><p id="eb8d" class="pw-post-body-paragraph jb jc ie jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">由于元交易不是系统自带的，您需要使用第三方设置(例如<a class="ae jz" href="https://opengsn.org/" rel="noopener ugc nofollow" target="_blank"> GSN </a>，或者创建自己的设置。</p><h1 id="155a" class="kh ki ie bd kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le dt translated">设置</h1><p id="a966" class="pw-post-body-paragraph jb jc ie jd b je lf jg jh ji lg jk jl jm lh jo jp jq li js jt ju lj jw jx jy hm dt translated">一个非常基本的设置包括3个实体:</p><ul class=""><li id="9076" class="lk ll ie jd b je jf ji jj jm lm jq ln ju lo jy lp lq lr ls dt translated"><strong class="jd if">签名者— </strong>拥有0以太的地址，并且是事务的创建者。该地址是签署交易数据的地址。</li><li id="0b1a" class="lk ll ie jd b je lt ji lu jm lv jq lw ju lx jy lp lq lr ls dt translated"><strong class="jd if">发送方— </strong>有以太网的地址，愿意代表你发送交易，从而支付油费。</li><li id="4e0a" class="lk ll ie jd b je lt ji lu jm lv jq lw ju lx jy lp lq lr ls dt translated"><strong class="jd if">中继/代理— </strong>智能契约，它将读取已签名的数据，根据提供的签名对其进行验证，并将调用转发给实际契约。</li></ul><figure class="lz ma mb mc fq hv fe ff paragraph-image"><div class="fe ff ly"><img src="../Images/47e37b465ad9fc9ba8ccc79c921cee23.png" data-original-src="https://miro.medium.com/v2/resize:fit:724/format:webp/1*NMR9bzm5A9qKfLzZ8i_44g.png"/></div></figure><p id="e65e" class="pw-post-body-paragraph jb jc ie jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated"><em class="kd">注意，在这种情况下，交易发送方将是代理契约(例如msg.sender)。在ERC-20转移的情况下，签名者需要批准代理契约以代表其转移令牌(除非ERC-20契约已经支持元事务)。参见</em><a class="ae jz" href="https://github.com/ethereum/EIPs/issues/1776" rel="noopener ugc nofollow" target="_blank"><em class="kd">EIP-1776</em></a></p><p id="0d07" class="pw-post-body-paragraph jb jc ie jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">让我们看一个简单的使用案例…</p><h1 id="b8e4" class="kh ki ie bd kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le dt translated">用例:发送令牌</h1><p id="5419" class="pw-post-body-paragraph jb jc ie jd b je lf jg jh ji lg jk jl jm lh jo jp jq li js jt ju lj jw jx jy hm dt translated"><em class="kd">(为了简化示例，假设ERC-20令牌转移的任何批准都已提前完成)</em></p><p id="caa4" class="pw-post-body-paragraph jb jc ie jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">想象一下，你有一个以太坊地址，里面有0个以太，一个友好的区块链朋友给你发了1000戴。您无法使用它们，因为您没有足够的资金来执行任何交易。</p><p id="a552" class="pw-post-body-paragraph jb jc ie jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">相反，您可以做的是利用元事务。</p><h2 id="f1db" class="md ki ie bd kj me mf mg kn mh mi mj kr jm mk ml kv jq mm mn kz ju mo mp ld mq dt translated">步骤#1:生成元事务</h2><p id="2b10" class="pw-post-body-paragraph jb jc ie jd b je lf jg jh ji lg jk jl jm lh jo jp jq li js jt ju lj jw jx jy hm dt translated">元事务基本上是一条带有一些数据的消息，这些数据已经由任何想要执行事务的人进行了签名。然后，签名的数据由另一方(支付燃气费的一方)验证并在正常的以太坊交易中发送。</p><p id="8d11" class="pw-post-body-paragraph jb jc ie jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">假设我们要将这些代币转移到另一个账户，这意味着我们需要用以下数据创建一个交易:</p><ul class=""><li id="6e6d" class="lk ll ie jd b je jf ji jj jm lm jq ln ju lo jy lp lq lr ls dt translated"><strong class="jd if">接收方</strong>:0x 00007 e 87416d 7328 fc 74663 f 37 E0 df 53777188 FB</li><li id="8330" class="lk ll ie jd b je lt ji lu jm lv jq lw ju lx jy lp lq lr ls dt translated"><strong class="jd if">金额</strong>:10000000000000000000(1000，18位小数)</li></ul><p id="1ea1" class="pw-post-body-paragraph jb jc ie jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">使用web3js，我们可以轻松地为这样的函数调用构建calldata:</p><p id="3311" class="pw-post-body-paragraph jb jc ie jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated"><code class="eh mr ms mt mu b">transferFrom(senderAddress, receiverAddress, 1000);</code></p><figure class="lz ma mb mc fq hv"><div class="bz el l di"><div class="mv mw l"/></div></figure><p id="97b1" class="pw-post-body-paragraph jb jc ie jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">它被翻译成下面的字节码:</p><pre class="lz ma mb mc fq mx mu my mz aw na dt"><span id="09fa" class="md ki ie mu b fv nb nc l nd ne">0xa9059cbb<br/>0000000000000000000000000000ef76331b59b1cc5e82ba1d2f840dbac1c73e<br/>00000000000000000000000000007e87416d7328fc74663f37e0df53777188fb<br/>00000000000000000000000000000000000000000000003635c9adc5dea00000</span></pre><h2 id="a37f" class="md ki ie bd kj me mf mg kn mh mi mj kr jm mk ml kv jq mm mn kz ju mo mp ld mq dt translated">第二步:签署数据</h2><p id="1279" class="pw-post-body-paragraph jb jc ie jd b je lf jg jh ji lg jk jl jm lh jo jp jq li js jt ju lj jw jx jy hm dt translated">既然您已经创建了想要执行的操作的calldata，那么是时候对它进行签名了，这样代理契约就可以验证这个calldata在整个过程中没有被篡改。</p><p id="e8d6" class="pw-post-body-paragraph jb jc ie jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">除了这些数据之外，我们还希望确保调用正确的合同，因此让我们将目标合同地址添加到我们希望签署的数据中。最简单的方法是为所有要签名的数据创建一个散列，并对散列而不是原始数据进行签名。</p><pre class="lz ma mb mc fq mx mu my mz aw na dt"><span id="be3f" class="md ki ie mu b fv nb nc l nd ne">// pack the DAI Token address and our "transferFrom()" calldata together and sign them.</span><span id="6266" class="md ki ie mu b fv nf nc l nd ne">let rawData = web3.eth.abi.encodeParameters(<br/>  ['address','bytes'],<br/>  [DaiTokenAddress,data]<br/>);</span><span id="42db" class="md ki ie mu b fv nf nc l nd ne">// hash the data.<br/>let hash = web3.utils.soliditySha3(rawData);</span><span id="67a2" class="md ki ie mu b fv nf nc l nd ne">// sign the hash.<br/>let signature = web3.eth.sign(hash, signer);</span></pre><h2 id="5e08" class="md ki ie bd kj me mf mg kn mh mi mj kr jm mk ml kv jq mm mn kz ju mo mp ld mq dt translated">第三步:把数据交给天然气支付者</h2><p id="81d1" class="pw-post-body-paragraph jb jc ie jd b je lf jg jh ji lg jk jl jm lh jo jp jq li js jt ju lj jw jx jy hm dt translated">一旦创建并签署了数据，就将它交给将在链上执行事务的服务/地址。</p><p id="7424" class="pw-post-body-paragraph jb jc ie jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">根据代理合同的结构，天然气付款人可能需要不同结构的数据(您签署的数据也可能需要不同)。但是为了简单起见，让我们考虑我们有下面的基本代理契约功能(注意！不安全生产):</p><figure class="lz ma mb mc fq hv"><div class="bz el l di"><div class="mv mw l"/></div></figure><p id="59db" class="pw-post-body-paragraph jb jc ie jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">为了成功地执行交易，天然气支付者需要用由<strong class="jd if">签名者</strong>提供的值调用我们的代理契约的<code class="eh mr ms mt mu b">forward()</code>函数。</p><ul class=""><li id="2153" class="lk ll ie jd b je jf ji jj jm lm jq ln ju lo jy lp lq lr ls dt translated"><strong class="jd if"> _to: </strong>戴令牌合同地址(这是我们的目标合同)。</li><li id="3dc4" class="lk ll ie jd b je lt ji lu jm lv jq lw ju lx jy lp lq lr ls dt translated"><strong class="jd if"> _data: </strong>签名人生成的calldata。(我们做的带有<code class="eh mr ms mt mu b">transferFrom(...)</code>的那个)。</li><li id="3e9e" class="lk ll ie jd b je lt ji lu jm lv jq lw ju lx jy lp lq lr ls dt translated"><strong class="jd if"> _signature: </strong>对数据进行签名得到的签名。</li></ul><p id="5a05" class="pw-post-body-paragraph jb jc ie jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">这将使我们的代理契约调用DAI令牌地址，并执行转移1000 DAI的<code class="eh mr ms mt mu b">transferFrom()</code>函数。</p><h2 id="a999" class="md ki ie bd kj me mf mg kn mh mi mj kr jm mk ml kv jq mm mn kz ju mo mp ld mq dt translated">需要考虑的事项</h2><p id="83c2" class="pw-post-body-paragraph jb jc ie jd b je lf jg jh ji lg jk jl jm lh jo jp jq li js jt ju lj jw jx jy hm dt translated">有许多可以/应该添加的安全改进(例如在签名消息中添加一个nonce，以防止重放攻击)。</p><p id="552e" class="pw-post-body-paragraph jb jc ie jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">但是这个例子的目的是向你展示<strong class="jd if">人A </strong>如何在不支付汽油的情况下签署一条消息，然后由<strong class="jd if">人B </strong>执行。从现在开始，有无限的改进和改变可以满足你的需求。</p><blockquote class="ng"><p id="8c61" class="nh ni ie bd nj nk nl nm nn no np jy ek translated">加入coin monks<a class="ae jz" href="https://t.me/joinchat/EPmjKpNYwRMsBI4p" rel="noopener ugc nofollow" target="_blank">Telegram group</a>学习加密交易和投资</p></blockquote><h2 id="bd97" class="md ki ie bd kj me nq mg kn mh nr mj kr jm ns ml kv jq nt mn kz ju nu mp ld mq dt translated">另外，阅读</h2><ul class=""><li id="6ed0" class="lk ll ie jd b je lf ji lg jm nv jq nw ju nx jy lp lq lr ls dt translated"><a class="ae jz" href="http://blog.coincodecap.com/go/learn" rel="noopener ugc nofollow" target="_blank">学习以太坊和Web3开发</a></li><li id="259b" class="lk ll ie jd b je lt ji lu jm lv jq lw ju lx jy lp lq lr ls dt translated">最好的<a class="ae jz" rel="noopener" href="/coinmonks/crypto-trading-bot-c2ffce8acb2a">密码交易机器人</a></li><li id="5241" class="lk ll ie jd b je lt ji lu jm lv jq lw ju lx jy lp lq lr ls dt translated"><a class="ae jz" rel="noopener" href="/coinmonks/3commas-review-an-excellent-crypto-trading-bot-2020-1313a58bec92">3商业评论</a></li><li id="2850" class="lk ll ie jd b je lt ji lu jm lv jq lw ju lx jy lp lq lr ls dt translated"><a class="ae jz" rel="noopener" href="/coinmonks/pionex-review-exchange-with-crypto-trading-bot-1e459d0191ea"> Pionex评论</a></li><li id="25b2" class="lk ll ie jd b je lt ji lu jm lv jq lw ju lx jy lp lq lr ls dt translated"><a class="ae jz" rel="noopener" href="/coinmonks/aax-exchange-review-2021-67c5ea09330c"> AAX交易所评论</a> |推荐代码、交易费用、利弊</li><li id="ab2a" class="lk ll ie jd b je lt ji lu jm lv jq lw ju lx jy lp lq lr ls dt translated"><a class="ae jz" rel="noopener" href="/coinmonks/deribit-review-options-fees-apis-and-testnet-2ca16c4bbdb2"> Deribit审查</a> |选项、费用、API和Testnet</li><li id="6778" class="lk ll ie jd b je lt ji lu jm lv jq lw ju lx jy lp lq lr ls dt translated"><a class="ae jz" rel="noopener" href="/coinmonks/ftx-crypto-exchange-review-53664ac1198f"> FTX密码交易所评论</a></li><li id="1a62" class="lk ll ie jd b je lt ji lu jm lv jq lw ju lx jy lp lq lr ls dt translated"><a class="ae jz" rel="noopener" href="/coinmonks/ngrave-zero-review-c465cf8307fc">n零审核</a></li><li id="a108" class="lk ll ie jd b je lt ji lu jm lv jq lw ju lx jy lp lq lr ls dt translated"><a class="ae jz" rel="noopener" href="/coinmonks/bybit-exchange-review-dbd570019b71"> Bybit交换审查</a></li><li id="cfc6" class="lk ll ie jd b je lt ji lu jm lv jq lw ju lx jy lp lq lr ls dt translated"><a class="ae jz" rel="noopener" href="/coinmonks/3commas-vs-pionex-vs-cryptohopper-best-crypto-bot-6a98d2baa203"> 3Commas vs Cryptohopper </a></li><li id="51e2" class="lk ll ie jd b je lt ji lu jm lv jq lw ju lx jy lp lq lr ls dt translated">最好的比特币<a class="ae jz" rel="noopener" href="/coinmonks/the-best-cryptocurrency-hardware-wallets-of-2020-e28b1c124069?source=friends_link&amp;sk=324dd9ff8556ab578d71e7ad7658ad7c">硬件钱包</a></li><li id="4268" class="lk ll ie jd b je lt ji lu jm lv jq lw ju lx jy lp lq lr ls dt translated"><a class="ae jz" rel="noopener" href="/coinmonks/top-10-crypto-copy-trading-platforms-for-beginners-d0c37c7d698c">密码本交易平台</a></li><li id="8fd1" class="lk ll ie jd b je lt ji lu jm lv jq lw ju lx jy lp lq lr ls dt translated">最佳<a class="ae jz" href="https://blog.coincodecap.com/best-monero-wallets" rel="noopener ugc nofollow" target="_blank"> monero钱包</a></li><li id="5d5d" class="lk ll ie jd b je lt ji lu jm lv jq lw ju lx jy lp lq lr ls dt translated"><a class="ae jz" href="https://blog.coincodecap.com/ledger-nano-s-vs-x" rel="noopener ugc nofollow" target="_blank">莱杰纳米s vs x </a></li><li id="5243" class="lk ll ie jd b je lt ji lu jm lv jq lw ju lx jy lp lq lr ls dt translated"><a class="ae jz" href="https://blog.coincodecap.com/bitsgap-3commas-quadency" rel="noopener ugc nofollow" target="_blank">bits gap vs 3 commas vs quad ency</a></li><li id="69bb" class="lk ll ie jd b je lt ji lu jm lv jq lw ju lx jy lp lq lr ls dt translated">最好的<a class="ae jz" rel="noopener" href="/coinmonks/best-crypto-tax-tool-for-my-money-72d4b430816b">加密税务软件</a></li><li id="7c4f" class="lk ll ie jd b je lt ji lu jm lv jq lw ju lx jy lp lq lr ls dt translated"><a class="ae jz" rel="noopener" href="/coinmonks/the-best-crypto-trading-platforms-in-2020-the-definitive-guide-updated-c72f8b874555">最佳加密交易平台</a></li><li id="85de" class="lk ll ie jd b je lt ji lu jm lv jq lw ju lx jy lp lq lr ls dt translated">最佳<a class="ae jz" rel="noopener" href="/coinmonks/top-5-crypto-lending-platforms-in-2020-that-you-need-to-know-a1b675cec3fa">加密贷款平台</a></li><li id="ab33" class="lk ll ie jd b je lt ji lu jm lv jq lw ju lx jy lp lq lr ls dt translated"><a class="ae jz" href="https://blog.coincodecap.com/ledger-nano-s-vs-trezor-one-ledger-nano-x-trezor-t" rel="noopener ugc nofollow" target="_blank">莱杰纳米S vs特雷佐one vs特雷佐T vs莱杰纳米X </a></li><li id="9efe" class="lk ll ie jd b je lt ji lu jm lv jq lw ju lx jy lp lq lr ls dt translated"><a class="ae jz" rel="noopener" href="/coinmonks/blockfi-vs-celsius-vs-hodlnaut-8a1cc8c26630">block fi vs Celsius</a>vs Hodlnaut</li><li id="1dc3" class="lk ll ie jd b je lt ji lu jm lv jq lw ju lx jy lp lq lr ls dt translated">Bitsgap评论——一个轻松赚钱的加密交易机器人</li><li id="2401" class="lk ll ie jd b je lt ji lu jm lv jq lw ju lx jy lp lq lr ls dt translated">为专业人士设计的加密交易机器人</li><li id="d689" class="lk ll ie jd b je lt ji lu jm lv jq lw ju lx jy lp lq lr ls dt translated"><a class="ae jz" rel="noopener" href="/coinmonks/cointracking-review-a-reliable-cryptocurrency-tax-software-5114e3eb5737">硬币追踪审查</a></li><li id="eb27" class="lk ll ie jd b je lt ji lu jm lv jq lw ju lx jy lp lq lr ls dt translated"><a class="ae jz" rel="noopener" href="/coinmonks/youhodler-4-easy-ways-to-make-money-98969b9689f2">尤霍德勒评论</a></li><li id="7bcc" class="lk ll ie jd b je lt ji lu jm lv jq lw ju lx jy lp lq lr ls dt translated"><a class="ae jz" rel="noopener" href="/coinmonks/ellipal-titan-review-85e9071dd029">埃利帕尔泰坦评论</a></li><li id="dc32" class="lk ll ie jd b je lt ji lu jm lv jq lw ju lx jy lp lq lr ls dt translated"><a class="ae jz" href="https://blog.coincodecap.com/secux-stone-hardware-wallet-review" rel="noopener ugc nofollow" target="_blank"> SecuX Stone点评</a></li><li id="5279" class="lk ll ie jd b je lt ji lu jm lv jq lw ju lx jy lp lq lr ls dt translated"><a class="ae jz" rel="noopener" href="/coinmonks/blockfi-review-53096053c097"> BlockFi评论</a> |从您的密码中赚取高达8.6%的利息</li><li id="6e2e" class="lk ll ie jd b je lt ji lu jm lv jq lw ju lx jy lp lq lr ls dt translated"><a class="ae jz" href="https://blog.coincodecap.com/coinrule-review-a-perfect-trading-bot" rel="noopener ugc nofollow" target="_blank">共同规则审查</a></li><li id="6a8a" class="lk ll ie jd b je lt ji lu jm lv jq lw ju lx jy lp lq lr ls dt translated"><a class="ae jz" href="https://bitquery.io/blog/best-blockchain-analysis-tools-and-software" rel="noopener ugc nofollow" target="_blank">最佳区块链分析工具</a></li><li id="b037" class="lk ll ie jd b je lt ji lu jm lv jq lw ju lx jy lp lq lr ls dt translated"><a class="ae jz" rel="noopener" href="/coinmonks/crypto-arbitrage-guide-how-to-make-money-as-a-beginner-62bfe5c868f6">加密套利</a>指南:新手如何赚钱</li><li id="b46f" class="lk ll ie jd b je lt ji lu jm lv jq lw ju lx jy lp lq lr ls dt translated">最佳<a class="ae jz" rel="noopener" href="/coinmonks/what-are-the-best-charting-platforms-for-cryptocurrency-trading-85aade584d80">加密制图工具</a></li><li id="ef45" class="lk ll ie jd b je lt ji lu jm lv jq lw ju lx jy lp lq lr ls dt translated">了解比特币最好的<a class="ae jz" rel="noopener" href="/coinmonks/what-are-the-best-books-to-learn-bitcoin-409aeb9aff4b">书籍有哪些？</a></li></ul><blockquote class="ng"><p id="b751" class="nh ni ie bd nj nk ny nz oa ob oc jy ek translated"><a class="ae jz" rel="noopener" href="/coinmonks/newsletters/coinmonks">直接在您的收件箱中获得最佳软件交易</a></p></blockquote><figure class="oe of og oh oi hv fe ff paragraph-image"><a href="https://medium.com/coinmonks/newsletters/coinmonks"><div class="fe ff od"><img src="../Images/160ce73bd06d46c2250251e7d5969f9d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1168/format:webp/1*BoDnKUyK8p4hitHAJZ5Pdw.png"/></div></a></figure></div></div>    
</body>
</html>