<html>
<head>
<title>Playing with IOTA: Parsing Data For Supply chain project</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用IOTA:解析供应链项目的数据</h1>
<blockquote>原文：<a href="https://medium.com/coinmonks/playing-with-iota-parsing-data-for-supply-chain-project-b46806170c6?source=collection_archive---------3-----------------------#2019-10-01">https://medium.com/coinmonks/playing-with-iota-parsing-data-for-supply-chain-project-b46806170c6?source=collection_archive---------3-----------------------#2019-10-01</a></blockquote><div><div class="ef hh hi hj hk hl"/><div class="hm hn ho hp hq"><div class=""/><p id="8429" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">大家好，我是IOTA development的新人，我决定使用IOTA开发一个供应链系统。该项目将通过为每个组织提供消耗环保材料的比率，迫使组织使用环保材料，并持续跟踪产品，直到我们将其回收利用。如果你不熟悉IOTA，我推荐你阅读<a class="ae jo" href="https://docs.iota.org/docs/getting-started/0.1/tutorials/get-started" rel="noopener ugc nofollow" target="_blank">文档</a>，你应该知道Nodejs的基础知识。</p><p id="6162" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">在设计我的项目想法时，我制作了一个简单的原型，用于建立一个安全的连接来跟踪所有产品。</p><p id="03a4" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated"><strong class="is hu">我会做什么？</strong></p><p id="d189" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">1-创建一个定制的ID，表示环保材料生产商、买方和产品订单(例如:第一个创建的产品、第二个创建的产品..等等)</p><p id="bf95" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">2-这个ID就像每个产品上的条形码。</p><p id="6c3f" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">3-每次条形码阅读器检测到一件产品。它将发送一个带有产品ID、当前条形码阅读器ID和当前时间的JSON对象。所以我可以跟踪大量的产品。</p><p id="6ddf" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated"><strong class="is hu">我的原型如何建立通信？</strong></p><p id="14b0" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">1-发送内容为“初始化根”的受限MAM消息，并返回根地址。</p><p id="4a44" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">2-使用受限的MAM将所有产品作为JSON对象发送。</p><p id="df1e" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">3-将根地址作为公共事务发送。</p><p id="132e" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">4-从公共事务中获取根地址。</p><p id="8d34" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">5-使用侧键将它解析到所有设备，以获取所有产品JSON对象。</p><p id="deb8" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated"><strong class="is hu">代码实现:</strong></p><p id="5efd" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">首先，我们需要安装iota包</p><pre class="jp jq jr js fq jt ju jv jw aw jx dt"><span id="5fa7" class="jy jz ht ju b fv ka kb l kc kd">npm install @iota/core</span><span id="82c1" class="jy jz ht ju b fv ke kb l kc kd">npm install @iota/converter</span></pre><p id="eecb" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">运筹学</p><p id="f4f0" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">你可以使用<code class="eh kf kg kh ju b">yarn add</code></p><p id="709f" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">现在，创建您的JavaScript文件<code class="eh kf kg kh ju b">touch SendPublicTransaction</code></p><p id="c8fb" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">导入包并将其连接到区块链。</p><pre class="jp jq jr js fq jt ju jv jw aw jx dt"><span id="8c69" class="jy jz ht ju b fv ka kb l kc kd">const iotaLibrary = require(‘@iota/core’)</span><span id="7699" class="jy jz ht ju b fv ke kb l kc kd">const Converter = require(‘@iota/converter’)</span><span id="d35a" class="jy jz ht ju b fv ke kb l kc kd">const iota = iotaLibrary.composeAPI({</span><span id="792f" class="jy jz ht ju b fv ke kb l kc kd">provider: ‘https://nodes.devnet.thetangle.org:443'</span><span id="40fb" class="jy jz ht ju b fv ke kb l kc kd">})</span></pre><p id="5428" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">要发送公共数据，我假设你熟悉种子和地址，如果注意检查这个<a class="ae jo" href="https://docs.iota.org/docs/getting-started/0.1/tutorials/get-started#step-1-create-a-seed" rel="noopener ugc nofollow" target="_blank">链接</a>。我们需要创建一个带有地址目的地和消息内容的传输对象，并确保我们案例中的传输值为零。</p><pre class="jp jq jr js fq jt ju jv jw aw jx dt"><span id="b091" class="jy jz ht ju b fv ka kb l kc kd">const message = Converter.asciiToTrytes(_message)</span><span id="739e" class="jy jz ht ju b fv ke kb l kc kd">const transfers = [</span><span id="d1bd" class="jy jz ht ju b fv ke kb l kc kd">{</span><span id="09c6" class="jy jz ht ju b fv ke kb l kc kd">value: 0,</span><span id="0852" class="jy jz ht ju b fv ke kb l kc kd">address: _address, // Where the data is being sent</span><span id="9854" class="jy jz ht ju b fv ke kb l kc kd">message: message // The message converted into trytes</span><span id="d20d" class="jy jz ht ju b fv ke kb l kc kd">}</span><span id="3651" class="jy jz ht ju b fv ke kb l kc kd">]</span><span id="ee6c" class="jy jz ht ju b fv ke kb l kc kd">iota</span><span id="90a5" class="jy jz ht ju b fv ke kb l kc kd">.prepareTransfers(_seed, transfers)</span><span id="fed0" class="jy jz ht ju b fv ke kb l kc kd">.then(trytes =&gt; iota.sendTrytes(trytes, 3, 14))</span><span id="9baa" class="jy jz ht ju b fv ke kb l kc kd">.then(bundle =&gt; {</span><span id="0df0" class="jy jz ht ju b fv ke kb l kc kd">console.log(‘Transfer successfully sent’)</span><span id="356f" class="jy jz ht ju b fv ke kb l kc kd">bundle.map(tx =&gt; console.log(tx))</span><span id="28c3" class="jy jz ht ju b fv ke kb l kc kd">})</span><span id="7b5f" class="jy jz ht ju b fv ke kb l kc kd">.catch(err =&gt; {</span><span id="b10e" class="jy jz ht ju b fv ke kb l kc kd">console.log(err)</span><span id="3688" class="jy jz ht ju b fv ke kb l kc kd">})</span><span id="14a8" class="jy jz ht ju b fv ke kb l kc kd">}</span></pre><p id="0ebf" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated"><strong class="is hu">获取此消息:</strong></p><pre class="jp jq jr js fq jt ju jv jw aw jx dt"><span id="aaa2" class="jy jz ht ju b fv ka kb l kc kd">const FetchPublicTransaction = async (_address) =&gt;{</span><span id="b2b5" class="jy jz ht ju b fv ke kb l kc kd">return new Promise(function(resolve, reject) {</span><span id="f080" class="jy jz ht ju b fv ke kb l kc kd">iota</span><span id="3496" class="jy jz ht ju b fv ke kb l kc kd">.findTransactionObjects({ addresses: [_address] },function(error, response) {</span><span id="de4f" class="jy jz ht ju b fv ke kb l kc kd">if (error) {</span><span id="46f8" class="jy jz ht ju b fv ke kb l kc kd">reject(error);</span><span id="253f" class="jy jz ht ju b fv ke kb l kc kd">} else {</span><span id="1ccb" class="jy jz ht ju b fv ke kb l kc kd">console.log(‘Encoded message:’)</span><span id="cb6a" class="jy jz ht ju b fv ke kb l kc kd">console.log(response[0].signatureMessageFragment)</span><span id="478e" class="jy jz ht ju b fv ke kb l kc kd">// Modify trytes into a consumable length</span><span id="c723" class="jy jz ht ju b fv ke kb l kc kd">const trytes = response[0].signatureMessageFragment.slice(0, -1)</span><span id="f9f0" class="jy jz ht ju b fv ke kb l kc kd">//Convert trytes to plan text</span><span id="7133" class="jy jz ht ju b fv ke kb l kc kd">//Convert trytes to plan text</span><span id="1750" class="jy jz ht ju b fv ke kb l kc kd">const data = Converter.trytesToAscii(trytes)</span><span id="1991" class="jy jz ht ju b fv ke kb l kc kd">console.log(‘Decoded message:’)</span><span id="f17a" class="jy jz ht ju b fv ke kb l kc kd">console.log(data)</span><span id="5340" class="jy jz ht ju b fv ke kb l kc kd">resolve(data)</span><span id="2c7b" class="jy jz ht ju b fv ke kb l kc kd">}</span><span id="771a" class="jy jz ht ju b fv ke kb l kc kd">})</span><span id="a7e7" class="jy jz ht ju b fv ke kb l kc kd">})</span><span id="6f13" class="jy jz ht ju b fv ke kb l kc kd">}</span></pre><p id="a458" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">如果你在理解这段代码时遇到困难，请查看IOTA基金会制作的视频<a class="ae jo" href="https://www.youtube.com/watch?v=Z-NN0rRcwY0&amp;feature=youtu.be&amp;t=179" rel="noopener ugc nofollow" target="_blank">来详细解释它。我补充了一些承诺如果你不知道是什么检查这个</a><a class="ae jo" href="https://codeburst.io/javascript-promises-explained-with-simple-real-life-analogies-dd6908092138" rel="noopener" target="_blank">链接</a>。</p><p id="8b43" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">然后我们有受限的MAM代码</p><p id="959d" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated"><strong class="is hu">初始化MAM </strong></p><pre class="jp jq jr js fq jt ju jv jw aw jx dt"><span id="12f5" class="jy jz ht ju b fv ka kb l kc kd">const mamType = ‘restricted’</span><span id="48f6" class="jy jz ht ju b fv ke kb l kc kd">const mamSecret = ‘DONTSHARETHISPASSWORD’</span><span id="7031" class="jy jz ht ju b fv ke kb l kc kd">mamState = Mam.changeMode(mamState, mamType, mamSecret</span></pre><p id="cec1" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">发送一条短信</p><pre class="jp jq jr js fq jt ju jv jw aw jx dt"><span id="c7c8" class="jy jz ht ju b fv ka kb l kc kd">const Publish = async data =&gt; {</span><span id="f299" class="jy jz ht ju b fv ke kb l kc kd">// Convert the JSON to trytes and create a MAM message</span><span id="d82c" class="jy jz ht ju b fv ke kb l kc kd">const trytes = asciiToTrytes(data)</span><span id="46f1" class="jy jz ht ju b fv ke kb l kc kd">const message = Mam.create(mamState, trytes)</span><span id="cf17" class="jy jz ht ju b fv ke kb l kc kd">// Update the MAM state to the state of this latest message</span><span id="3fbe" class="jy jz ht ju b fv ke kb l kc kd">mamState = message.state</span><span id="286b" class="jy jz ht ju b fv ke kb l kc kd">// Attach the message</span><span id="890c" class="jy jz ht ju b fv ke kb l kc kd">await Mam.attach(message.payload, message.address, 3, 9)</span><span id="a65e" class="jy jz ht ju b fv ke kb l kc kd">return message.root</span><span id="f0f1" class="jy jz ht ju b fv ke kb l kc kd">}</span></pre><p id="07bb" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">使用<code class="eh kf kg kh ju b"> foreach</code>发送多条信息</p><pre class="jp jq jr js fq jt ju jv jw aw jx dt"><span id="381b" class="jy jz ht ju b fv ka kb l kc kd">const PublishAll = (noOfMessages)=&gt;{</span><span id="3aef" class="jy jz ht ju b fv ke kb l kc kd">const products = []</span><span id="6935" class="jy jz ht ju b fv ke kb l kc kd">for (let index = 0; index &lt; noOfMessages; index++) {</span><span id="e0b7" class="jy jz ht ju b fv ke kb l kc kd">products.push({</span><span id="0c35" class="jy jz ht ju b fv ke kb l kc kd">id: index,</span><span id="4103" class="jy jz ht ju b fv ke kb l kc kd">time: (new Date()).toLocaleString()</span><span id="7859" class="jy jz ht ju b fv ke kb l kc kd">})</span><span id="4207" class="jy jz ht ju b fv ke kb l kc kd">}</span><span id="1703" class="jy jz ht ju b fv ke kb l kc kd">Array.prototype.forEach.call(products,product =&gt;{</span><span id="126e" class="jy jz ht ju b fv ke kb l kc kd">SendMamRestricted.execute(JSON.stringify(product))</span><span id="8894" class="jy jz ht ju b fv ke kb l kc kd">})</span><span id="3715" class="jy jz ht ju b fv ke kb l kc kd">}</span></pre><p id="106b" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated"><strong class="is hu">获取所有受限的MAM消息:</strong></p><pre class="jp jq jr js fq jt ju jv jw aw jx dt"><span id="7c32" class="jy jz ht ju b fv ka kb l kc kd">const FetchMam = async (_root) =&gt; {</span><span id="49a1" class="jy jz ht ju b fv ke kb l kc kd">// Callback used to pass data + returns next_root</span><span id="bd49" class="jy jz ht ju b fv ke kb l kc kd">console.log(“inside FetchMamRestricted function root is”,_root) // outptu ‘somthing’</span><span id="d30b" class="jy jz ht ju b fv ke kb l kc kd">const resp = await Mam.fetch(_root, mamType, mamSecret, logData)</span><span id="3eb8" class="jy jz ht ju b fv ke kb l kc kd">console.log(resp)</span><span id="76c0" class="jy jz ht ju b fv ke kb l kc kd">}</span></pre><p id="4d2a" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">现在你需要做的就是连接所有的代码。</p><p id="d737" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">sendID.js文件:</p><pre class="jp jq jr js fq jt ju jv jw aw jx dt"><span id="0e26" class="jy jz ht ju b fv ka kb l kc kd">const SendMamRestricted = require(“./SendMamRestricted.js”)</span><span id="cac5" class="jy jz ht ju b fv ke kb l kc kd">const SendPublicTransaction= require(“./SendPublicTransaction.js”)</span><span id="905c" class="jy jz ht ju b fv ke kb l kc kd">const PublishAll = require(‘./PublishAll.js’)</span><span id="440a" class="jy jz ht ju b fv ke kb l kc kd">const seed = ‘any 81 capital char and 9’</span><span id="859c" class="jy jz ht ju b fv ke kb l kc kd">const address = ‘any 81 capital char and 9’</span><span id="7670" class="jy jz ht ju b fv ke kb l kc kd">SendMamRestricted.execute(“initialize root”).then(function(result) {</span><span id="6903" class="jy jz ht ju b fv ke kb l kc kd">SendPublicTransaction.execute(seed,address,result)</span><span id="73c4" class="jy jz ht ju b fv ke kb l kc kd">PublishAll.execute(10)</span><span id="1c5d" class="jy jz ht ju b fv ke kb l kc kd">})</span></pre><p id="ff7a" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">fetchID.js文件:</p><pre class="jp jq jr js fq jt ju jv jw aw jx dt"><span id="cae4" class="jy jz ht ju b fv ka kb l kc kd">const FetchPublicTransaction = require(‘./FetchPublicTransaction.js’)</span><span id="5faf" class="jy jz ht ju b fv ke kb l kc kd">const FetchMamRestricted = require(‘./FetchMamRestricted.js’)</span><span id="6665" class="jy jz ht ju b fv ke kb l kc kd">const address = ‘any random 81 capital char and 9’</span><span id="86e6" class="jy jz ht ju b fv ke kb l kc kd">const main = async()=&gt;{</span><span id="2611" class="jy jz ht ju b fv ke kb l kc kd">const root = await FetchPublicTransaction.execute(address)// retrun root</span><span id="4839" class="jy jz ht ju b fv ke kb l kc kd">await FetchMamRestricted.execute(root.substring(0,root.length-1012))</span><span id="03f5" class="jy jz ht ju b fv ke kb l kc kd">}</span><span id="d3c5" class="jy jz ht ju b fv ke kb l kc kd">main()</span></pre><p id="82f1" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">在我的Github链接上找到所有代码:<a class="ae jo" href="https://github.com/yehia67/Products-Tracker-Prototype/" rel="noopener ugc nofollow" target="_blank">https://github.com/yehia67/Products-Tracker-Prototype/</a></p><p id="02e7" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">如果你有任何问题，请问我。谢谢大家！</p><blockquote class="ki"><p id="458f" class="kj kk ht bd kl km kn ko kp kq kr jn ek translated"><a class="ae jo" href="https://coincodecap.com/?utm_source=coinmonks" rel="noopener ugc nofollow" target="_blank">直接在您的收件箱中获得最佳软件交易</a></p></blockquote><figure class="kt ku kv kw kx ky fe ff paragraph-image"><a href="https://coincodecap.com/?utm_source=coinmonks"><div class="fe ff ks"><img src="../Images/7c0b3dfdcbfea594cc0ae7d4f9bf6fcb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1168/format:webp/0*OJ-qb5G6i863msBB.png"/></div></a></figure></div></div>    
</body>
</html>