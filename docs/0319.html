<html>
<head>
<title>Hyperledger Fabric implementation — Part 1</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Hyperledger结构实施—第1部分</h1>
<blockquote>原文：<a href="https://medium.com/coinmonks/hyperledger-fabric-implementation-v1-1-part-1-chaincode-for-node-7b72aec2430d?source=collection_archive---------0-----------------------#2018-04-18">https://medium.com/coinmonks/hyperledger-fabric-implementation-v1-1-part-1-chaincode-for-node-7b72aec2430d?source=collection_archive---------0-----------------------#2018-04-18</a></blockquote><div><div class="ef hh hi hj hk hl"/><div class="hm hn ho hp hq"><div class=""/><div class=""><h2 id="a6e3" class="pw-subtitle-paragraph iq hs ht bd b ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ek translated">Hyperledger结构实施1.3版:使用Node.js和Golang的链码</h2></div><p id="e4ad" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated">为了在Fabric V1.3上构建区块链应用，需要实现三层</p><ol class=""><li id="a8ef" class="ke kf ht jk b jl jm jo jp jr kg jv kh jz ki kd kj kk kl km dt translated">链码层(与分类帐交互)</li><li id="061b" class="ke kf ht jk b jl kn jo ko jr kp jv kq jz kr kd kj kk kl km dt translated">SDK层(应用程序和链代码之间的交互)</li><li id="f45b" class="ke kf ht jk b jl kn jo ko jr kp jv kq jz kr kd kj kk kl km dt translated">应用层(SDK和应用程序之间的交互)</li></ol><figure class="kt ku kv kw fq kx fe ff paragraph-image"><div role="button" tabindex="0" class="ky kz di la bf lb"><div class="fe ff ks"><img src="../Images/627e4c27e1aa676728aa9d661743bcb9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hkWGskerwet80Dj9GY833w.png"/></div></div></figure><p id="92e8" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated">在V1.3中，可以使用GoLang或Node oe Java语言编写链代码</p><p id="5016" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated">要编写智能契约，开发人员应该知道三个主要的类Shim、ChaincodeInterface和ChaincodeStub。</p><p id="41a9" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated">本文提供了这些类的概述，以及所有Smartcontract或Chaincode实现的node.js代码的通用模板。</p><h1 id="ac6e" class="le lf ht bd lg lh li lj lk ll lm ln lo iz lp ja lq jc lr jd ls jf lt jg lu lv dt translated">fabric-shim npm包:智能合同实施的核心</h1><p id="b7de" class="pw-post-body-paragraph ji jj ht jk b jl lw iu jn jo lx ix jq jr ly jt ju jv lz jx jy jz ma kb kc kd hm dt translated">Package包含一个<strong class="jk hu"> Shim </strong>类，用于向目标对等体注册链码，监听传入的请求，处理事务提议或执行查询。</p><p id="b341" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated">Shim类中的所有方法都是静态的。</p><ul class=""><li id="98c1" class="ke kf ht jk b jl jm jo jp jr kg jv kh jz ki kd mb kk kl km dt translated"><strong class="jk hu"> start(chaincode-class) </strong>:启动chaincode进程，向目标对等体注册chaincode(将目标对等体的地址作为程序参数传递:— peer.address)。</li><li id="d0b0" class="ke kf ht jk b jl kn jo ko jr kp jv kq jz kr kd mb kk kl km dt translated"><strong class="jk hu"> success(return-value) </strong>:返回成功响应对象状态码200和可选的Buffer类型的成功返回值内容。</li><li id="da95" class="ke kf ht jk b jl kn jo ko jr kp jv kq jz kr kd mb kk kl km dt translated"><strong class="jk hu"> error(return-value) </strong>:返回成功响应对象状态码200和可选的Buffer类型的错误返回值内容。</li></ul><p id="9fad" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated">链码程序必须实现<strong class="jk hu">链码</strong>接口。在node.js中，它被定义为ChaincodeInterface类</p><h1 id="e44c" class="le lf ht bd lg lh li lj lk ll lm ln lo iz lp ja lq jc lr jd ls jf lt jg lu lv dt translated">Chaincode接口有两种方法</h1><pre class="kt ku kv kw fq mc md me mf aw mg dt"><span id="656a" class="mh lf ht md b fv mi mj l mk ml">init() : Called to instantiate or upgrade the chaincode</span><span id="9273" class="mh lf ht md b fv mm mj l mk ml">invoke() : Called to interact with Ledger (query/update/create/delete the asset)</span></pre><p id="061c" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated">这两种方法都接受ChaincodeStub类作为方法参数。</p><h1 id="ccc1" class="le lf ht bd lg lh li lj lk ll lm ln lo iz lp ja lq jc lr jd ls jf lt jg lu lv dt translated">链码存根</h1><p id="0121" class="pw-post-body-paragraph ji jj ht jk b jl lw iu jn jo lx ix jq jr ly jt ju jv lz jx jy jz ma kb kc kd hm dt translated">ChaincodeStub类包含获取传入请求信息的方法，如函数名、作为传递函数的数组的参数、通道id、CRUD(创建/读取/更新/删除)状态变量</p><h2 id="dd4d" class="mh lf ht bd lg mn mo mp lk mq mr ms lo jr mt mu lq jv mv mw ls jz mx my lu mz dt translated">ChaincodeStub类中常用的方法</h2><ul class=""><li id="8e20" class="ke kf ht jk b jl lw jo lx jr na jv nb jz nc kd mb kk kl km dt translated"><strong class="jk hu">getFunctionAndParameters():</strong>返回一个全局类型定义<strong class="jk hu"> FunctionAndParameters </strong>包含两个属性:</li></ul><blockquote class="nd ne nf"><p id="f71f" class="ji jj ng jk b jl jm iu jn jo jp ix jq nh js jt ju ni jw jx jy nj ka kb kc kd hm dt translated">* fcn:要调用的函数名</p><p id="c31d" class="ji jj ng jk b jl jm iu jn jo jp ix jq nh js jt ju ni jw jx jy nj ka kb kc kd hm dt translated">* params:已定义函数的参数数组</p></blockquote><ul class=""><li id="4fef" class="ke kf ht jk b jl jm jo jp jr kg jv kh jz ki kd mb kk kl km dt translated"><strong class="jk hu"> getState(key) : </strong>返回键值</li><li id="d3f1" class="ke kf ht jk b jl kn jo ko jr kp jv kq jz kr kd mb kk kl km dt translated"><strong class="jk hu"> putState(key，value) : </strong>将状态变量key &amp;的值写入/更新到状态存储中</li><li id="187a" class="ke kf ht jk b jl kn jo ko jr kp jv kq jz kr kd mb kk kl km dt translated"><strong class="jk hu"> getTxID() </strong>:返回当前请求的事务ID</li></ul></div><div class="ab cl nk nl hb nm" role="separator"><span class="nn bw bk no np nq"/><span class="nn bw bk no np nq"/><span class="nn bw bk no np"/></div><div class="hm hn ho hp hq"><h1 id="bd81" class="le lf ht bd lg lh nr lj lk ll ns ln lo iz nt ja lq jc nu jd ls jf nv jg lu lv dt translated">节点的智能合同模板</h1><pre class="kt ku kv kw fq mc md me mf aw mg dt"><span id="b52c" class="mh lf ht md b fv mi mj l mk ml">const shim = require(‘fabric-shim’);</span><span id="4cd0" class="mh lf ht md b fv mm mj l mk ml">const PradeepChaincode = class {<br/>async Init(stub) {<br/> return …;<br/> }</span><span id="e870" class="mh lf ht md b fv mm mj l mk ml">async Invoke(stub) {<br/> return …;<br/> }</span><span id="74cd" class="mh lf ht md b fv mm mj l mk ml">};</span><span id="0dd2" class="mh lf ht md b fv mm mj l mk ml">shim.start(new PradeepChaincode())</span></pre><p id="73f9" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated"><strong class="jk hu"> <em class="ng">详细介绍上面的</em> </strong></p><ul class=""><li id="a4d8" class="ke kf ht jk b jl jm jo jp jr kg jv kh jz ki kd mb kk kl km dt translated">步骤1 : <br/>织物垫片包被导入。</li><li id="2b86" class="ke kf ht jk b jl kn jo ko jr kp jv kq jz kr kd mb kk kl km dt translated">步骤2 : <br/>定义链码类和方法(初始化以实例化/升级，调用以处理分类帐)</li><li id="e7ee" class="ke kf ht jk b jl kn jo ko jr kp jv kq jz kr kd mb kk kl km dt translated">步骤3 : <br/>启动chaincode进程并监听传入的请求</li></ul><h1 id="d1e4" class="le lf ht bd lg lh li lj lk ll lm ln lo iz lp ja lq jc lr jd ls jf lt jg lu lv dt translated">Golang的智能合同模板</h1><pre class="kt ku kv kw fq mc md me mf aw mg dt"><span id="d5f6" class="mh lf ht md b fv mi mj l mk ml">package main</span><span id="41e9" class="mh lf ht md b fv mm mj l mk ml">import (</span><span id="8373" class="mh lf ht md b fv mm mj l mk ml">“fmt”</span><span id="ef86" class="mh lf ht md b fv mm mj l mk ml">“github.com/hyperledger/fabric/core/chaincode/shim”</span><span id="d6d8" class="mh lf ht md b fv mm mj l mk ml">“github.com/hyperledger/fabric/protos/peer”</span><span id="03c8" class="mh lf ht md b fv mm mj l mk ml">)</span><span id="cfcd" class="mh lf ht md b fv mm mj l mk ml">//SmartContract : name of the smart contract</span><span id="41b2" class="mh lf ht md b fv mm mj l mk ml">type SmartContract struct{}</span><span id="fefe" class="mh lf ht md b fv mm mj l mk ml">// Init : Method to initialize or update the chaincode</span><span id="a4ff" class="mh lf ht md b fv mm mj l mk ml">func (s *SmartContract) Init(APIstub shim.ChaincodeStubInterface) peer.Response {</span><span id="078c" class="mh lf ht md b fv mm mj l mk ml">return shim.Success(nil)</span><span id="c1eb" class="mh lf ht md b fv mm mj l mk ml">}</span><span id="e9c5" class="mh lf ht md b fv mm mj l mk ml">// Invoke : Method to transaction between the ledger</span><span id="8d6f" class="mh lf ht md b fv mm mj l mk ml">func (s *SmartContract) Invoke(APIstub shim.ChaincodeStubInterface) peer.Response {</span><span id="acb7" class="mh lf ht md b fv mm mj l mk ml">return shim.Error(“Invalid Smart Contract function name.”)</span><span id="b823" class="mh lf ht md b fv mm mj l mk ml">}</span><span id="3656" class="mh lf ht md b fv mm mj l mk ml">func main() {</span><span id="15cc" class="mh lf ht md b fv mm mj l mk ml">err := shim.Start(new(SmartContract))</span><span id="cd47" class="mh lf ht md b fv mm mj l mk ml">if err != nil {fmt.Printf(“Error Creating the new smart contract SmartContract : %s”, err)</span><span id="91f9" class="mh lf ht md b fv mm mj l mk ml">}}</span></pre><p id="3338" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated">资源</p><ul class=""><li id="6d20" class="ke kf ht jk b jl jm jo jp jr kg jv kh jz ki kd mb kk kl km dt translated"><a class="ae nw" href="https://fabric-shim.github.io/index.html" rel="noopener ugc nofollow" target="_blank">https://fabric-shim.github.io/index.html</a></li><li id="cfae" class="ke kf ht jk b jl kn jo ko jr kp jv kq jz kr kd mb kk kl km dt translated"><a class="ae nw" href="http://hyperledger-fabric.readthedocs.io/en/release-1.1/chaincode4ade.html" rel="noopener ugc nofollow" target="_blank">http://hyperledger-fabric . readthedocs . io/en/release-1.1/chain code 4a de . html</a></li></ul></div></div>    
</body>
</html>