<html>
<head>
<title>How to create a DApp using Truffle, Oraclize, ethereum-bridge and Webpack</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何使用Truffle、Oraclize、ethereum-bridge和Webpack创建DApp</h1>
<blockquote>原文：<a href="https://medium.com/coinmonks/how-to-create-a-dapp-using-truffle-oraclize-ethereum-bridge-and-webpack-9cb84b8f6bcb?source=collection_archive---------2-----------------------#2018-05-11">https://medium.com/coinmonks/how-to-create-a-dapp-using-truffle-oraclize-ethereum-bridge-and-webpack-9cb84b8f6bcb?source=collection_archive---------2-----------------------#2018-05-11</a></blockquote><div><div class="ef hh hi hj hk hl"/><div class="hm hn ho hp hq"><div class=""/><p id="5252" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">关于在智能合约前端使用外部API数据的简单指南</p><h2 id="f789" class="jo jp ht bd jq jr js jt ju jv jw jx jy jb jz ka kb jf kc kd ke jj kf kg kh ki dt translated">关于本教程</h2><p id="8999" class="pw-post-body-paragraph iq ir ht is b it kj iv iw ix kk iz ja jb kl jd je jf km jh ji jj kn jl jm jn hm dt translated">完成本教程后，您将拥有一个可工作的DApp(分散式应用程序),对通过<a class="ae ko" href="https://github.com/ethereum/solidity" rel="noopener ugc nofollow" target="_blank"> <strong class="is hu">可靠性</strong> </a> <strong class="is hu">智能契约</strong>发出的<strong class="is hu">事件</strong>做出反应，使用<strong class="is hu"> Oraclize </strong>从<strong class="is hu"> </strong> <a class="ae ko" href="https://api.coinbase.com/v2/prices/ETH-USD/spot" rel="noopener ugc nofollow" target="_blank"> <strong class="is hu">比特币基地</strong> </a>获取<strong class="is hu">外部</strong> <strong class="is hu"> API数据</strong>。为了科学！</p><blockquote class="kp"><p id="4698" class="kq kr ht bd ks kt ku kv kw kx ky jn ek translated"><a class="ae ko" href="https://coincodecap.com" rel="noopener ugc nofollow" target="_blank">发现并回顾最佳区块链软件</a></p></blockquote><p id="b657" class="pw-post-body-paragraph iq ir ht is b it kz iv iw ix la iz ja jb lb jd je jf lc jh ji jj ld jl jm jn hm dt translated">我们将:</p><ul class=""><li id="a91e" class="le lf ht is b it iu ix iy jb lg jf lh jj li jn lj lk ll lm dt translated">编写和部署简单的<strong class="is hu">智能合同</strong></li><li id="ffb7" class="le lf ht is b it ln ix lo jb lp jf lq jj lr jn lj lk ll lm dt translated">为<strong class="is hu"> Oracle通信</strong>设置本地<code class="eh ls lt lu lv b">ethereum-bridge</code></li><li id="cea0" class="le lf ht is b it ln ix lo jb lp jf lq jj lr jn lj lk ll lm dt translated">使用Oracle从<strong class="is hu">比特币基地API </strong>获取外部数据</li><li id="0445" class="le lf ht is b it ln ix lo jb lp jf lq jj lr jn lj lk ll lm dt translated">创建一个定制的<strong class="is hu">前端</strong>来显示API数据</li><li id="e862" class="le lf ht is b it ln ix lo jb lp jf lq jj lr jn lj lk ll lm dt translated">在本地开发环境中做这件事</li></ul><figure class="lw lx ly lz fq ma"><div class="bz el l di"><div class="mb mc l"/></div></figure><blockquote class="md me mf"><p id="966c" class="iq ir mg is b it iu iv iw ix iy iz ja mh jc jd je mi jg jh ji mj jk jl jm jn hm dt translated">注意:在文章的底部有一张我们将要做的东西的截图</p></blockquote><h2 id="798d" class="jo jp ht bd jq jr js jt ju jv jw jx jy jb jz ka kb jf kc kd ke jj kf kg kh ki dt translated">关于我</h2><p id="8923" class="pw-post-body-paragraph iq ir ht is b it kj iv iw ix kk iz ja jb kl jd je jf km jh ji jj kn jl jm jn hm dt translated">嗨，我叫<a class="ae ko" href="https://twitter.com/wwwillems" rel="noopener ugc nofollow" target="_blank">着陆器</a>。我是来自比利时的数字顾问和产品设计师。当我不涉足Solidity时，我会开发一个SaaS，帮助自由职业者和数字团队组织分享他们的数字内容。</p></div><div class="ab cl mk ml hb mm" role="separator"><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp"/></div><div class="hm hn ho hp hq"><h1 id="757a" class="mr jp ht bd jq ms mt mu ju mv mw mx jy my mz na kb nb nc nd ke ne nf ng kh nh dt translated">开始</h1><h2 id="d5b7" class="jo jp ht bd jq jr js jt ju jv jw jx jy jb jz ka kb jf kc kd ke jj kf kg kh ki dt translated">先决条件</h2><ol class=""><li id="0177" class="le lf ht is b it kj ix kk jb ni jf nj jj nk jn nl lk ll lm dt translated">你可以克隆一个<code class="eh ls lt lu lv b">git</code>库&amp;通过<code class="eh ls lt lu lv b">npm</code>安装它的依赖项</li><li id="7460" class="le lf ht is b it ln ix lo jb lp jf lq jj lr jn nl lk ll lm dt translated">你对HTML、JavaScript、<a class="ae ko" href="https://webpack.js.org/" rel="noopener ugc nofollow" target="_blank"> Webpack </a>、终端、…</li><li id="1d1d" class="le lf ht is b it ln ix lo jb lp jf lq jj lr jn nl lk ll lm dt translated">您希望了解更多关于使用<strong class="is hu">或</strong> &amp; <strong class="is hu">实体事件</strong>的信息</li></ol><h2 id="5c5d" class="jo jp ht bd jq jr js jt ju jv jw jx jy jb jz ka kb jf kc kd ke jj kf kg kh ki dt translated">我们会做什么？</h2><p id="b071" class="pw-post-body-paragraph iq ir ht is b it kj iv iw ix kk iz ja jb kl jd je jf km jh ji jj kn jl jm jn hm dt translated">我们将编写一个智能契约，使用本地运行的Oracle获取外部API数据。我们将通过使用<code class="eh ls lt lu lv b">ethereum-bridge</code>模拟甲骨文来实现这一点。合约从<a class="ae ko" href="https://api.coinbase.com/v2/prices/ETH-USD/spot" rel="noopener ugc nofollow" target="_blank"> <strong class="is hu">比特币基地ETH-USD现货价格API </strong> </a> <strong class="is hu">中取当前<strong class="is hu">以太币</strong> <strong class="is hu"> USD </strong>价格。</strong></p><p id="0a82" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">我们将创建一个简单的<strong class="is hu"> HTML </strong>页面，以<strong class="is hu"> ETH </strong>和<strong class="is hu"> USD显示我们合同的总ETH余额。</strong>您的合同的美元总值是使用比特币基地API计算的。这些值会自动更新，直到合同资金用完。</p><h2 id="c255" class="jo jp ht bd jq jr js jt ju jv jw jx jy jb jz ka kb jf kc kd ke jj kf kg kh ki dt translated">使用的工具</h2><ul class=""><li id="7135" class="le lf ht is b it kj ix kk jb ni jf nj jj nk jn lj lk ll lm dt translated">Git，npm</li><li id="0f5e" class="le lf ht is b it ln ix lo jb lp jf lq jj lr jn lj lk ll lm dt translated"><a class="ae ko" href="http://truffleframework.com/" rel="noopener ugc nofollow" target="_blank">松露</a>，<a class="ae ko" href="http://truffleframework.com/boxes/webpack" rel="noopener ugc nofollow" target="_blank">松露网络包装盒</a>，oraclize-api</li><li id="84cb" class="le lf ht is b it ln ix lo jb lp jf lq jj lr jn lj lk ll lm dt translated"><a class="ae ko" href="https://github.com/oraclize/ethereum-bridge" rel="noopener ugc nofollow" target="_blank">以太坊桥</a></li><li id="1ec8" class="le lf ht is b it ln ix lo jb lp jf lq jj lr jn lj lk ll lm dt translated">Javascript，<a class="ae ko" href="https://webpack.js.org/" rel="noopener ugc nofollow" target="_blank"> Webpack </a></li></ul><h2 id="1bf4" class="jo jp ht bd jq jr js jt ju jv jw jx jy jb jz ka kb jf kc kd ke jj kf kg kh ki dt translated">神谕是什么？</h2><p id="8a03" class="pw-post-body-paragraph iq ir ht is b it kj iv iw ix kk iz ja jb kl jd je jf km jh ji jj kn jl jm jn hm dt translated">智能合约，就其本质而言，能够运行计算，存储和检索数据。因为每个节点运行每个计算，所以从以太坊契约发出任意网络请求是不实际的(目前也是不可能的)。Oracles通过观察事件的区块链来填补这一空白，并通过将查询结果发布回契约来响应事件。通过这种方式，契约可以与外链世界进行交互。</p><blockquote class="kp"><p id="8cd5" class="kq kr ht bd ks kt ku kv kw kx ky jn ek translated">" Oracles允许将外部数据(如非区块链数据)发送给合同."</p></blockquote><p id="37b0" class="pw-post-body-paragraph iq ir ht is b it kz iv iw ix la iz ja jb lb jd je jf lc jh ji jj ld jl jm jn hm dt translated">Oracles是将信息发送到Smart Contract的可信数据源，消除了Smart Contract直接访问其网络外部信息的需要，从而减轻了其工作负载。Oracles通常由第三方提供，并由使用它们的公司授权。</p><p id="2170" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">oracle/oracle网络负责将您连接到数据源。如果你想了解更多关于神谕的内容，请看这里。</p></div><div class="ab cl mk ml hb mm" role="separator"><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp"/></div><div class="hm hn ho hp hq"><h1 id="4ede" class="mr jp ht bd jq ms mt mu ju mv mw mx jy my mz na kb nb nc nd ke ne nf ng kh nh dt translated">我们走吧</h1><h2 id="cc58" class="jo jp ht bd jq jr js jt ju jv jw jx jy jb jz ka kb jf kc kd ke jj kf kg kh ki dt translated">安装松露</h2><p id="6ca8" class="pw-post-body-paragraph iq ir ht is b it kj iv iw ix kk iz ja jb kl jd je jf km jh ji jj kn jl jm jn hm dt translated">首先，让我们启动我们的终端，在全球安装<a class="ae ko" href="http://truffleframework.com/" rel="noopener ugc nofollow" target="_blank">松露</a>:</p><pre class="lw lx ly lz fq nm lv nn no aw np dt"><span id="7fb8" class="jo jp ht lv b fv nq nr l ns nt">$ npm install -g truffle</span></pre><p id="e91a" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">我们将使用<a class="ae ko" href="http://truffleframework.com/" rel="noopener ugc nofollow" target="_blank"> Truffle </a>来迁移我们的合同，运行我们的开发测试网并安装<a class="ae ko" href="https://oraclize.it" rel="noopener ugc nofollow" target="_blank"> Oraclize </a>。如果你认真对待可靠性开发，这是一个必不可少的工具。</p><h2 id="bfb3" class="jo jp ht bd jq jr js jt ju jv jw jx jy jb jz ka kb jf kc kd ke jj kf kg kh ki dt translated">创建一个新的松露项目</h2><p id="9e4f" class="pw-post-body-paragraph iq ir ht is b it kj iv iw ix kk iz ja jb kl jd je jf km jh ji jj kn jl jm jn hm dt translated">为我们的项目创建一个新文件夹，名为<code class="eh ls lt lu lv b">oraclize-test</code> <em class="mg"> : </em></p><pre class="lw lx ly lz fq nm lv nn no aw np dt"><span id="3af9" class="jo jp ht lv b fv nq nr l ns nt">$ mkdir oraclize-test</span></pre><p id="755d" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">导航到该文件夹并创建一个新的Truffle项目。<br/>我们从<a class="ae ko" href="http://truffleframework.com/boxes/webpack" rel="noopener ugc nofollow" target="_blank">松露网络包装盒</a>开始，这将使我们更容易创建我们的DApp前端。</p><pre class="lw lx ly lz fq nm lv nn no aw np dt"><span id="1280" class="jo jp ht lv b fv nq nr l ns nt">$ cd oraclize-test<br/>$ truffle unbox webpack</span></pre><p id="2ed3" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">之后，启动Truffle testnet (testrpc):</p><pre class="lw lx ly lz fq nm lv nn no aw np dt"><span id="c3d3" class="jo jp ht lv b fv nq nr l ns nt">$ truffle develop</span></pre><p id="7d15" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">您应该会看到类似这样的内容:</p><figure class="lw lx ly lz fq ma fe ff paragraph-image"><div role="button" tabindex="0" class="nv nw di nx bf ny"><div class="fe ff nu"><img src="../Images/10e868402b062fe109c20b6f07e33299.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*70EHqq9Gh-Gakr83hPnufQ.png"/></div></div></figure><h2 id="972f" class="jo jp ht bd jq jr js jt ju jv jw jx jy jb jz ka kb jf kc kd ke jj kf kg kh ki dt translated">注意:</h2><ol class=""><li id="7eb6" class="le lf ht is b it kj ix kk jb ni jf nj jj nk jn nl lk ll lm dt translated">第二行如何打印<br/> <code class="eh ls lt lu lv b">Truffle Develop started at <a class="ae ko" href="http://127.0.0.1:9545" rel="noopener ugc nofollow" target="_blank">http://127.0.0.1:9545</a><br/></code>写下这个<strong class="is hu"> <em class="mg">主机:端口</em> </strong>组合，你需要这个来启动<code class="eh ls lt lu lv b">ethereum-bridge</code>。</li><li id="2c0e" class="le lf ht is b it ln ix lo jb lp jf lq jj lr jn nl lk ll lm dt translated">创建的账户数量(=10)</li></ol><p id="7fd3" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">很好，您已经创建了一个引导块菌项目，并启动了块菌开发测试网。通过按(ctrl+c)关闭测试网，并通过将Oraclize添加到Truffle继续。</p><h2 id="c3c2" class="jo jp ht bd jq jr js jt ju jv jw jx jy jb jz ka kb jf kc kd ke jj kf kg kh ki dt translated">向松露中加入糖</h2><p id="943d" class="pw-post-body-paragraph iq ir ht is b it kj iv iw ix kk iz ja jb kl jd je jf km jh ji jj kn jl jm jn hm dt translated">添加Oraclize到Truffle并重启Truffle开发测试网</p><pre class="lw lx ly lz fq nm lv nn no aw np dt"><span id="c47f" class="jo jp ht lv b fv nq nr l ns nt">$ truffle install oraclize-api<br/>$ truffle develop</span></pre><p id="a302" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">注意，在安装了<code class="eh ls lt lu lv b">oraclize-api</code>之后，一个新的文件夹被创建在我们的<code class="eh ls lt lu lv b">oraclize-test</code>文件夹中:<code class="eh ls lt lu lv b">installed_contracts</code>。在里面，你会发现名为<code class="eh ls lt lu lv b">usingOraclize.sol</code>的Oraclize契约，我们的Solidity契约将继承它。</p><p id="fe61" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">我们的<code class="eh ls lt lu lv b">oraclize-test</code>文件夹现在看起来像这样</p><figure class="lw lx ly lz fq ma fe ff paragraph-image"><div class="fe ff ob"><img src="../Images/4aa0828ae3e8ee41e0afc227d29b5e50.png" data-original-src="https://miro.medium.com/v2/resize:fit:604/format:webp/1*9tPVIVYmz0MFb7KxJcBs-Q.png"/></div><figcaption class="oc od fg fe ff oe of bd b be z ek">oraclize-test folder contents</figcaption></figure><p id="2cc4" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">保持testnet活动，打开一个新的终端窗口安装<code class="eh ls lt lu lv b">ethereum-bridge</code>。</p><h2 id="0dbb" class="jo jp ht bd jq jr js jt ju jv jw jx jy jb jz ka kb jf kc kd ke jj kf kg kh ki dt translated">安装以太坊桥</h2><p id="19b9" class="pw-post-body-paragraph iq ir ht is b it kj iv iw ix kk iz ja jb kl jd je jf km jh ji jj kn jl jm jn hm dt translated">创建一个名为<code class="eh ls lt lu lv b">ethereum-bridge</code> <br/>的新文件夹(在<code class="eh ls lt lu lv b">oraclize-test</code>旁边)，克隆<a class="ae ko" href="https://github.com/oraclize/ethereum-bridge" rel="noopener ugc nofollow" target="_blank">以太坊桥库</a>，并安装其依赖项:</p><pre class="lw lx ly lz fq nm lv nn no aw np dt"><span id="b5e2" class="jo jp ht lv b fv nq nr l ns nt">$ mkdir ethereum-bridge<br/>$ git clone <a class="ae ko" href="https://github.com/oraclize/ethereum-bridge" rel="noopener ugc nofollow" target="_blank">https://github.com/oraclize/ethereum-bridge</a> ethereum-bridge<br/>$ cd ethereum-bridge<br/>$ npm install</span></pre><blockquote class="md me mf"><p id="2909" class="iq ir mg is b it iu iv iw ix iy iz ja mh jc jd je mi jg jh ji mj jk jl jm jn hm dt translated"><strong class="is hu">注意<br/> </strong>我们正在<code class="eh ls lt lu lv b">oraclize-test</code>旁边创建<code class="eh ls lt lu lv b">ethereum-bridge</code>文件夹，因为我们可以在以后的项目中重用它。</p></blockquote><p id="309a" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">可以运行<code class="eh ls lt lu lv b">node bridge -a 9</code>启动<code class="eh ls lt lu lv b">ethereum-bridge</code>。<code class="eh ls lt lu lv b">-a 9</code>参数指示<code class="eh ls lt lu lv b">ethereum-bridge</code>使用本地Truffle Testnet节点创建的最后一个帐户来部署Oraclize契约。该地址只能用于Oraclize，其他合同不得使用。</p><p id="6505" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">Truffle Testnet节点创建了10个帐户供您使用，因为它们的索引是从0开始的，我们使用的索引是9。</p><p id="14c4" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">来吧，试试看:</p><pre class="lw lx ly lz fq nm lv nn no aw np dt"><span id="9e1e" class="jo jp ht lv b fv nq nr l ns nt">$ node bridge -a 9</span></pre><p id="7ea1" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">呜呜:</p><figure class="lw lx ly lz fq ma fe ff paragraph-image"><div role="button" tabindex="0" class="nv nw di nx bf ny"><div class="fe ff og"><img src="../Images/d9a53cf839323aed1ed40475454fb079.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NsMjMlRw4B1WqiAKD7D_TA.png"/></div></div></figure><p id="24b1" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">如你所见，我们遇到了一个错误。<br/>如果仔细阅读<code class="eh ls lt lu lv b">ERROR</code>行，可以看到<code class="eh ls lt lu lv b">ethereum-bridge</code>正在试图连接错误的<strong class="is hu"> <em class="mg">主机:端口</em> </strong>组合(http://<strong class="is hu"><em class="mg">localhost:8545</em></strong>)。</p><p id="c913" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">这个组合应该反映您在上一步中记下的组合。我的情况是<code class="eh ls lt lu lv b">http://localhost:9545</code>。请务必仔细检查这一点，因为旧版本的Truffle曾使用端口8545。</p><p id="776f" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">要解决这个问题，启动<code class="eh ls lt lu lv b">ethereum-bridge</code>告诉它使用正确的主机(<strong class="is hu"> -H </strong> ) &amp;端口(<strong class="is hu"> -p </strong>参数)。注意这些标志，它们区分大小写！</p><pre class="lw lx ly lz fq nm lv nn no aw np dt"><span id="e7bf" class="jo jp ht lv b fv nq nr l ns nt">$ node bridge -a 9 <strong class="lv hu">-H <em class="mg">127.0.0.1</em> -p <em class="mg">9545 </em></strong>--dev</span></pre><p id="eb2a" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">结果应该是这样的:</p><figure class="lw lx ly lz fq ma fe ff paragraph-image"><div role="button" tabindex="0" class="nv nw di nx bf ny"><div class="fe ff oh"><img src="../Images/10e8c5e7b993cce4cfb85ee88482c794.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*je1DITAAQ7lmdHO2YhyV0Q.png"/></div></div></figure><p id="155d" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">查找类似于以下内容的行:</p><p id="b833" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated"><code class="eh ls lt lu lv b">OAR = OraclizeAddrResolverI(0x6f485C8BF6fc43eA212E93BBF8ce046C7f1cb475)</code></p><blockquote class="md me mf"><p id="9ea2" class="iq ir mg is b it iu iv iw ix iy iz ja mh jc jd je mi jg jh ji mj jk jl jm jn hm dt translated"><strong class="is hu">注意</strong> <br/>如果你使用的助记符不同于标准的Truffle助记符，圆括号中显示的ETH地址将会不同。</p></blockquote><p id="a1f2" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">确保您写下(复制粘贴)完整的<code class="eh ls lt lu lv b">OAR</code>行，这样我们以后可以在我们的合同的构造函数中使用它。再次，让你的终端运行。</p><p id="3098" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">此时，您应该有两个活跃的终端窗口:</p><ul class=""><li id="b896" class="le lf ht is b it iu ix iy jb lg jf lh jj li jn lj lk ll lm dt translated">你的块菌发展测试网</li><li id="4dfb" class="le lf ht is b it ln ix lo jb lp jf lq jj lr jn lj lk ll lm dt translated">你的<code class="eh ls lt lu lv b">ethereum-bridge</code></li></ul><h2 id="4386" class="jo jp ht bd jq jr js jt ju jv jw jx jy jb jz ka kb jf kc kd ke jj kf kg kh ki dt translated">撰写可靠性智能合同</h2><p id="a50c" class="pw-post-body-paragraph iq ir ht is b it kj iv iw ix kk iz ja jb kl jd je jf km jh ji jj kn jl jm jn hm dt translated">让我们从一个示例智能合同开始。在<code class="eh ls lt lu lv b">oraclize-test</code>文件夹中找到<code class="eh ls lt lu lv b">contracts</code>文件夹，添加一个新文件<code class="eh ls lt lu lv b">OraclizeTest.sol</code>。这将成为智能契约，它向Oracle发送事务以获取<strong class="is hu"> API数据</strong>。将以下要点复制粘贴到文件中:</p><blockquote class="md me mf"><p id="ab9d" class="iq ir mg is b it iu iv iw ix iy iz ja mh jc jd je mi jg jh ji mj jk jl jm jn hm dt translated"><strong class="is hu">注意</strong> <br/>确保将<code class="eh ls lt lu lv b">OAR = OraclizeAddrResolverI(<strong class="is hu">0x...</strong>);</code>行替换为您在上一步中记下的行。</p></blockquote><p id="ae07" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">不要忘记在生产之前从你的构造函数中移除这个<code class="eh ls lt lu lv b">OAR</code>变量，<strong class="is hu">这只是为了测试</strong>，在生产中它会根据你运行的链自动获取OAR，目前支持Mainnet、Ropsten和browser-solidity VM环境。</p><figure class="lw lx ly lz fq ma"><div class="bz el l di"><div class="oi mc l"/></div><figcaption class="oc od fg fe ff oe of bd b be z ek">OraclizeTest.sol</figcaption></figure><p id="9ac2" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">在创建合同时，<code class="eh ls lt lu lv b">OraclizeTest()</code>构造函数正在运行，它将所有者设置为部署合同的地址，并初始化Oracle。之后，它调用一次<code class="eh ls lt lu lv b">update()</code>函数，从比特币基地API获取当前的ETH价格。</p><p id="ca7a" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated"><code class="eh ls lt lu lv b">update()</code>函数检查合同是否有足够的资金来创建一个URL请求，如果有，就继续向Oraclize发出请求。</p><p id="e782" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">请求一完成，Oraclize就调用<code class="eh ls lt lu lv b">__callback()</code>函数，您可以使用<code class="eh ls lt lu lv b">JSONPATH</code>来切分响应。这里见文献<a class="ae ko" href="https://docs.oraclize.it/#general-concepts-parsing-helpers" rel="noopener ugc nofollow" target="_blank">。</a></p><blockquote class="md me mf"><p id="3643" class="iq ir mg is b it iu iv iw ix iy iz ja mh jc jd je mi jg jh ji mj jk jl jm jn hm dt translated">我们可以使用<code class="eh ls lt lu lv b">__callback()</code>函数中的第一个参数<code class="eh ls lt lu lv b">id</code>来处理不同的请求。我们将跳过这一步，因为这只是一个基本的例子。</p></blockquote><h2 id="d967" class="jo jp ht bd jq jr js jt ju jv jw jx jy jb jz ka kb jf kc kd ke jj kf kg kh ki dt translated">编译代码</h2><p id="34c9" class="pw-post-body-paragraph iq ir ht is b it kj iv iw ix kk iz ja jb kl jd je jf km jh ji jj kn jl jm jn hm dt translated">在<code class="eh ls lt lu lv b">oraclize-test</code>中找到<code class="eh ls lt lu lv b">contracts</code>文件夹，删除<code class="eh ls lt lu lv b">ConvertLib.sol</code>和<code class="eh ls lt lu lv b">MetaCoin.sol</code>。这些是示例文件，我们不需要它们。</p><p id="68db" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">将上述合同代码复制粘贴到<code class="eh ls lt lu lv b">OraclizeTest.sol</code>中，并使用</p><pre class="lw lx ly lz fq nm lv nn no aw np dt"><span id="85bf" class="jo jp ht lv b fv nq nr l ns nt">$ truffle compile</span></pre><p id="4c8d" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">如果编译成功，您应该会在<code class="eh ls lt lu lv b">oraclize-test</code>中看到一个名为<code class="eh ls lt lu lv b">build</code>的新文件夹。此文件夹包含智能合同的编译版本。在其中，您会发现一些* JSON文件，这些文件包含将由<strong class="is hu"> Truffle </strong>部署的字节码。</p><p id="dd33" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">现在，让我们准备Truffle将我们的代码部署到我们的开发测试网。</p></div><div class="ab cl mk ml hb mm" role="separator"><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp"/></div><div class="hm hn ho hp hq"><h2 id="8feb" class="jo jp ht bd jq jr js jt ju jv jw jx jy jb jz ka kb jf kc kd ke jj kf kg kh ki dt translated">更新Truffle配置</h2><p id="e42e" class="pw-post-body-paragraph iq ir ht is b it kj iv iw ix kk iz ja jb kl jd je jf km jh ji jj kn jl jm jn hm dt translated">打开<code class="eh ls lt lu lv b">oraclize-test</code>文件夹中的<code class="eh ls lt lu lv b">truffle.js</code>并添加您的开发环境:</p><figure class="lw lx ly lz fq ma"><div class="bz el l di"><div class="oi mc l"/></div><figcaption class="oc od fg fe ff oe of bd b be z ek"><code class="eh ls lt lu lv b">truffle.js</code></figcaption></figure><p id="3d62" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">这里，我们定义了开发网络(=环境)，并设置了端口号。</p><h2 id="4bae" class="jo jp ht bd jq jr js jt ju jv jw jx jy jb jz ka kb jf kc kd ke jj kf kg kh ki dt translated">更新块菌迁移</h2><p id="4f58" class="pw-post-body-paragraph iq ir ht is b it kj iv iw ix kk iz ja jb kl jd je jf km jh ji jj kn jl jm jn hm dt translated">打开<code class="eh ls lt lu lv b">oraclize-test/migrations/2_deploy_contracts.js</code>并编辑它，使其类似于以下代码片段:</p><figure class="lw lx ly lz fq ma"><div class="bz el l di"><div class="oi mc l"/></div><figcaption class="oc od fg fe ff oe of bd b be z ek"><code class="eh ls lt lu lv b">oraclize-test/migrations/2_deploy_contracts.js</code></figcaption></figure><p id="6616" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">在这个要点中，我们导入了<code class="eh ls lt lu lv b">OraclizeTest.sol</code>契约的编译版本，并指导Truffle迁移如何迁移契约。</p><p id="04ab" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">如果我们不这样做，Truffle就不知道要部署哪些文件。这是非常标准的东西，如果你感兴趣，可以看看<a class="ae ko" href="http://truffleframework.com/docs/getting_started/migrations" rel="noopener ugc nofollow" target="_blank">块菌迁移</a>。</p><p id="f66d" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">我们正在为与<strong class="is hu">0.5 ETH</strong>(<em class="mg">500000000000000魏</em>)的Smart合同提供资金，以便我们能够与<strong class="is hu"> Oraclize </strong>对话。我们需要ETH能够在发送交易时支付汽油费用。</p><p id="b2be" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">运行<code class="eh ls lt lu lv b">truffle migrate --develop --reset</code>将您的合同部署到testnet。您应该会看到类似这样的内容:</p><figure class="lw lx ly lz fq ma fe ff paragraph-image"><div role="button" tabindex="0" class="nv nw di nx bf ny"><div class="fe ff oj"><img src="../Images/9de3785552d2e634ffb02bfa9cc15dee.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0OFSeNNuGG9MEEdo4pUFEQ.png"/></div></div><figcaption class="oc od fg fe ff oe of bd b be z ek">Successful Truffle development testnet migration</figcaption></figure><p id="b36c" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">这将运行位于项目的<code class="eh ls lt lu lv b">migrations</code>目录中的所有迁移。简单来说，迁移就是一组托管部署脚本。如果您的迁移先前已成功运行，<code class="eh ls lt lu lv b">truffle migrate</code>将从上次运行的迁移开始执行，仅运行新创建的迁移。如果不存在新的迁移，<code class="eh ls lt lu lv b">truffle migrate</code>将不会执行任何操作。您可以使用<code class="eh ls lt lu lv b">--reset</code>选项从头开始运行所有的迁移。</p><p id="b01e" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">截图中可以看到，Truffle将合同部署到了这个地址:</p><pre class="lw lx ly lz fq nm lv nn no aw np dt"><span id="f77d" class="jo jp ht lv b fv nq nr l ns nt">0x572309f98e9085f9122fbec9de20a00e19a0476a7cde7e7f84b5a7d168a7520e</span></pre><blockquote class="md me mf"><p id="7e28" class="iq ir mg is b it iu iv iw ix iy iz ja mh jc jd je mi jg jh ji mj jk jl jm jn hm dt translated"><strong class="is hu">注意</strong> <br/>如果像我一样，在尝试运行块菌迁移时，您看到了与气体相关的错误，请尝试编辑迁移中提到的气体量。</p><p id="6930" class="iq ir mg is b it iu iv iw ix iy iz ja mh jc jd je mi jg jh ji mj jk jl jm jn hm dt translated">如果你想有一个更好的估计，到你的块菌开发测试网络终端，输入<code class="eh ls lt lu lv b">eth.getBlock("pending").gasLimit</code>。<br/>使用返回的号码解决问题。</p></blockquote><figure class="lw lx ly lz fq ma fe ff paragraph-image"><div role="button" tabindex="0" class="nv nw di nx bf ny"><div class="fe ff ok"><img src="../Images/8c613d1d91254e9e595c345d98fa3aea.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UP3_tfIJifjYGnajcDWUFw.png"/></div></div><figcaption class="oc od fg fe ff oe of bd b be z ek">Truffle development testnet Terminal estimating gasLimit</figcaption></figure></div><div class="ab cl mk ml hb mm" role="separator"><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp"/></div><div class="hm hn ho hp hq"><h2 id="a44a" class="jo jp ht bd jq jr js jt ju jv jw jx jy jb jz ka kb jf kc kd ke jj kf kg kh ki dt translated">创建前端</h2><p id="7149" class="pw-post-body-paragraph iq ir ht is b it kj iv iw ix kk iz ja jb kl jd je jf km jh ji jj kn jl jm jn hm dt translated">打开<code class="eh ls lt lu lv b">app</code>文件夹，编辑<code class="eh ls lt lu lv b">index.html</code>，使其类似于下面的代码片段:</p><figure class="lw lx ly lz fq ma"><div class="bz el l di"><div class="oi mc l"/></div><figcaption class="oc od fg fe ff oe of bd b be z ek">index.html</figcaption></figure><p id="047e" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">没有什么令人震惊的，我假设关于HTML文件的一切都很清楚。</p><p id="36a8" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">将<code class="eh ls lt lu lv b">javascripts/app.js</code>编辑成这样:</p><figure class="lw lx ly lz fq ma"><div class="bz el l di"><div class="oi mc l"/></div><figcaption class="oc od fg fe ff oe of bd b be z ek"><code class="eh ls lt lu lv b">javascripts/app.js</code></figcaption></figure><p id="13dd" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">我有意让JavaScript保持简单。这些评论应该足以让你对正在发生的事情有一个基本的了解。</p><p id="46c5" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">并将<code class="eh ls lt lu lv b">stylesheets/app.css</code>编辑成这样:</p><figure class="lw lx ly lz fq ma"><div class="bz el l di"><div class="oi mc l"/></div><figcaption class="oc od fg fe ff oe of bd b be z ek"><code class="eh ls lt lu lv b">stylesheets/app.css</code></figcaption></figure><p id="0c5b" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">再说一遍，基本的东西。我想这已经很清楚了。</p><h2 id="1e0c" class="jo jp ht bd jq jr js jt ju jv jw jx jy jb jz ka kb jf kc kd ke jj kf kg kh ki dt translated">快到了…</h2><p id="5060" class="pw-post-body-paragraph iq ir ht is b it kj iv iw ix kk iz ja jb kl jd je jf km jh ji jj kn jl jm jn hm dt translated">如果你想看看你的DApp，继续旋转前端:</p><pre class="lw lx ly lz fq nm lv nn no aw np dt"><span id="fbc5" class="jo jp ht lv b fv nq nr l ns nt">$ truffle compile<br/>$ truffle migrate --development --reset <br/>$ npm run dev</span></pre><p id="dd60" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">您的契约需要编译并部署到您的本地开发测试网。当您更改合同时，请确保重新编译并重新迁移。当检测到合同变更时，Truffle-webpack将自动重新加载您的前端。整洁！</p><p id="c586" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">打开<code class="eh ls lt lu lv b"><a class="ae ko" href="http://localhost:8080," rel="noopener ugc nofollow" target="_blank">http://localhost:8080</a></code>,您应该会看到显示智能合约余额的HTML文件，几秒钟后，它的值以美元表示。这些值将自动更新，直到智能合约耗尽资金。不要忘记，我们需要为我们的组织交流付费；).</p><p id="b8fc" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">如果一切顺利，您应该看到您的前端使用Oraclize和Solidity事件显示了以ETH和USD表示的Smart合约余额:</p><figure class="lw lx ly lz fq ma fe ff paragraph-image"><div role="button" tabindex="0" class="nv nw di nx bf ny"><div class="fe ff ol"><img src="../Images/feefde8e491722688b0fdd1ccf5588e3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8NUJr5uoqB24lIR7uF7wFw.png"/></div></div></figure><p id="c753" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">打开<code class="eh ls lt lu lv b"><a class="ae ko" href="http://localhost:8080," rel="noopener ugc nofollow" target="_blank">http://localhost:8080</a></code>,您应该会看到显示Oraclize智能合约余额及其美元值的HTML文件。Oraclize使用<a class="ae ko" href="https://api.coinbase.com/v2/prices/ETH-USD/spot" rel="noopener ugc nofollow" target="_blank">比特币基地API </a>获取当前的ETH/USD现货价格，并将其返回给合约。前端值会一直更新，直到智能合约资金用完。</p><h2 id="f281" class="jo jp ht bd jq jr js jt ju jv jw jx jy jb jz ka kb jf kc kd ke jj kf kg kh ki dt translated">参考项目</h2><p id="f017" class="pw-post-body-paragraph iq ir ht is b it kj iv iw ix kk iz ja jb kl jd je jf km jh ji jj kn jl jm jn hm dt translated">我已经上传了一个参考项目到GitHub，以防你遇到麻烦</p><div class="om on fm fo oo op"><a href="https://github.com/WWWillems/medium-02-truffle-oraclize-api" rel="noopener  ugc nofollow" target="_blank"><div class="oq ab ej"><div class="or ab os cl cj ot"><h2 class="bd hu fv z el ou eo ep ov er et hs dt translated">WWWillems/medium-02-truffle-oraclize-API</h2><div class="ow l"><h3 class="bd b fv z el ou eo ep ov er et ek translated">这是我在medium上写的一篇关于使用truffle、Oraclize &amp; the…</h3></div><div class="ox l"><p class="bd b gc z el ou eo ep ov er et ek translated">github.com</p></div></div></div></a></div><h2 id="eec5" class="jo jp ht bd jq jr js jt ju jv jw jx jy jb jz ka kb jf kc kd ke jj kf kg kh ki dt translated">有趣的链接</h2><ul class=""><li id="379a" class="le lf ht is b it kj ix kk jb ni jf nj jj nk jn lj lk ll lm dt translated"><a class="ae ko" href="https://blog.oraclize.it/understanding-oracles-99055c9c9f7b" rel="noopener ugc nofollow" target="_blank">理解神谕</a> ( <em class="mg">通过神谕</em>)</li><li id="877c" class="le lf ht is b it ln ix lo jb lp jf lq jj lr jn lj lk ll lm dt translated"><a class="ae ko" href="https://bitcointalk.org/index.php?topic=301538.0" rel="noopener ugc nofollow" target="_blank">在亚马逊的AWS上安装Oracle机器</a></li><li id="9c2a" class="le lf ht is b it ln ix lo jb lp jf lq jj lr jn lj lk ll lm dt translated"><a class="ae ko" href="https://ethereum.stackexchange.com/questions/201/how-does-oraclize-handle-the-tlsnotary-secret" rel="noopener ugc nofollow" target="_blank">Oraclize如何处理TSLNotary secret？</a></li></ul><h2 id="8370" class="jo jp ht bd jq jr js jt ju jv jw jx jy jb jz ka kb jf kc kd ke jj kf kg kh ki dt translated">工具</h2><ul class=""><li id="706b" class="le lf ht is b it kj ix kk jb ni jf nj jj nk jn lj lk ll lm dt translated"><a class="ae ko" href="https://github.com/oraclize/ethereum-bridge" rel="noopener ugc nofollow" target="_blank">以太坊-桥接库</a></li><li id="75e6" class="le lf ht is b it ln ix lo jb lp jf lq jj lr jn lj lk ll lm dt translated"><a class="ae ko" href="http://truffleframework.com/docs" rel="noopener ugc nofollow" target="_blank">块菌文件</a></li><li id="f1d1" class="le lf ht is b it ln ix lo jb lp jf lq jj lr jn lj lk ll lm dt translated"><a class="ae ko" href="https://docs.oraclize.it/" rel="noopener ugc nofollow" target="_blank">组织文档</a></li><li id="867c" class="le lf ht is b it ln ix lo jb lp jf lq jj lr jn lj lk ll lm dt translated"><a class="ae ko" href="https://solidity.readthedocs.io/en/v0.4.23/" rel="noopener ugc nofollow" target="_blank">坚固性文件</a></li><li id="55e1" class="le lf ht is b it ln ix lo jb lp jf lq jj lr jn lj lk ll lm dt translated"><a class="ae ko" href="https://github.com/dawnlabs/carbon" rel="noopener ugc nofollow" target="_blank">碳代码片段</a></li><li id="a984" class="le lf ht is b it ln ix lo jb lp jf lq jj lr jn lj lk ll lm dt translated"><a class="ae ko" href="http://truffleframework.com/ganache/" rel="noopener ugc nofollow" target="_blank">加纳切</a></li><li id="db11" class="le lf ht is b it ln ix lo jb lp jf lq jj lr jn lj lk ll lm dt translated"><a class="ae ko" href="https://dapps.oraclize.it/browser-solidity/" rel="noopener ugc nofollow" target="_blank"> Oraclize Remix IDE </a></li></ul></div><div class="ab cl mk ml hb mm" role="separator"><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp"/></div><div class="hm hn ho hp hq"><h1 id="107c" class="mr jp ht bd jq ms mt mu ju mv mw mx jy my mz na kb nb nc nd ke ne nf ng kh nh dt translated">感谢阅读！</h1><p id="d74e" class="pw-post-body-paragraph iq ir ht is b it kj iv iw ix kk iz ja jb kl jd je jf km jh ji jj kn jl jm jn hm dt translated">我很想收到你的来信，了解你对我的文章的看法。如果你觉得丢了什么东西，请告诉我。</p><p id="691d" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">如果你想保持联系，请回复下面的帖子，<a class="ae ko" href="https://twitter.com/WWWillems" rel="noopener ugc nofollow" target="_blank"> <strong class="is hu">在Twitter上关注我</strong> </a>或者使用下面的表格注册我的时事通讯。</p><figure class="lw lx ly lz fq ma"><div class="bz el l di"><div class="oy mc l"/></div></figure></div></div>    
</body>
</html>