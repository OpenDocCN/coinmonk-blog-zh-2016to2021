<html>
<head>
<title>Open-Zeppelin Escrow smart contract</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">开放式齐柏林托管智能合同</h1>
<blockquote>原文：<a href="https://medium.com/coinmonks/open-zeppelin-escrow-smart-contract-2a54ad027482?source=collection_archive---------3-----------------------#2018-10-30">https://medium.com/coinmonks/open-zeppelin-escrow-smart-contract-2a54ad027482?source=collection_archive---------3-----------------------#2018-10-30</a></blockquote><div><div class="ef hh hi hj hk hl"/><div class="hm hn ho hp hq"><div class=""/><div class=""><h2 id="2934" class="pw-subtitle-paragraph iq hs ht bd b ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ek translated">托管智能合同开放-齐柏林2.0</h2></div><figure class="jj jk jl jm fq jn fe ff paragraph-image"><div role="button" tabindex="0" class="jo jp di jq bf jr"><div class="fe ff ji"><img src="../Images/974533390b3921ad7b0014aad397eecc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*gQiQrCtsBQr2VA8a.jpg"/></div></div><figcaption class="ju jv fg fe ff jw jx bd b be z ek"><a class="ae jy" href="https://www.google.co.in/url?sa=i&amp;source=images&amp;cd=&amp;cad=rja&amp;uact=8&amp;ved=2ahUKEwin69zZma7eAhVL57wKHf-aCnIQjxx6BAgBEAI&amp;url=https%3A%2F%2Fwww.youtube.com%2Fwatch%3Fv%3DfZlHcazNMrc&amp;psig=AOvVaw15UREEGFN2fIM7CpMCbQ8B&amp;ust=1540990101846540" rel="noopener ugc nofollow" target="_blank">Source</a></figcaption></figure><p id="be5d" class="pw-post-body-paragraph jz ka ht kb b kc kd iu ke kf kg ix kh ki kj kk kl km kn ko kp kq kr ks kt ku hm dt translated">今天，我们将看看智能契约托管，并了解open-zeppelin托管智能契约。</p><h2 id="d5ae" class="kv kw ht bd kx ky kz la lb lc ld le lf ki lg lh li km lj lk ll kq lm ln lo lp dt translated">什么是托管？</h2><p id="6ca8" class="pw-post-body-paragraph jz ka ht kb b kc lq iu ke kf lr ix kh ki ls kk kl km lt ko kp kq lu ks kt ku hm dt translated"><a class="ae jy" href="https://www.escrow.com/what-is-escrow" rel="noopener ugc nofollow" target="_blank">托管是一种金融安排，由第三方持有并监管特定交易中双方所需的资金支付。</a>托管被企业用作金融协议的受托方。有许多在线托管服务，我们也可以使用智能合同建立一个托管服务。</p><h2 id="8244" class="kv kw ht bd kx ky kz la lb lc ld le lf ki lg lh li km lj lk ll kq lm ln lo lp dt translated">开放式齐柏林托管合同-</h2><figure class="jj jk jl jm fq jn"><div class="bz el l di"><div class="lv lw l"/></div></figure><h2 id="fdde" class="kv kw ht bd kx ky kz la lb lc ld le lf ki lg lh li km lj lk ll kq lm ln lo lp dt translated">权限管理器智能合同(Secondary.sol)</h2><p id="696a" class="pw-post-body-paragraph jz ka ht kb b kc lq iu ke kf lr ix kh ki ls kk kl km lt ko kp kq lu ks kt ku hm dt translated">在进入open-zeppelin托管智能合同之前，我们将首先看一下<code class="eh lx ly lz ma b">Secondary.sol</code>，它也是由open-zeppelin提供的。它本质上是在<code class="eh lx ly lz ma b">Escrow.sol</code>中使用的许可管理器包装器。</p><p id="acd0" class="pw-post-body-paragraph jz ka ht kb b kc kd iu ke kf kg ix kh ki kj kk kl km kn ko kp kq kr ks kt ku hm dt translated"><strong class="kb hu">为什么是Secondary.sol？</strong></p><p id="736c" class="pw-post-body-paragraph jz ka ht kb b kc kd iu ke kf kg ix kh ki kj kk kl km kn ko kp kq kr ks kt ku hm dt translated">Secondary.sol将有助于为我们的合同建立一个主要当事人。这个主要方是我们(托管服务)。这定义了在与我们的托管系统交互时将用于强制所有权的修饰符。当然，我们可以在托管智能合同本身中构建这一功能，但是创建<code class="eh lx ly lz ma b">Secondary.sol</code>有助于我们实现可重用性、模块化和关注点分离。</p><p id="03a7" class="pw-post-body-paragraph jz ka ht kb b kc kd iu ke kf kg ix kh ki kj kk kl km kn ko kp kq kr ks kt ku hm dt translated"><strong class="kb hu">这里是</strong>T3的代码。</p><figure class="jj jk jl jm fq jn"><div class="bz el l di"><div class="lv lw l"/></div></figure><p id="afd8" class="pw-post-body-paragraph jz ka ht kb b kc kd iu ke kf kg ix kh ki kj kk kl km kn ko kp kq kr ks kt ku hm dt translated">现在，让我们看看这份合同。</p><p id="7094" class="pw-post-body-paragraph jz ka ht kb b kc kd iu ke kf kg ix kh ki kj kk kl km kn ko kp kq kr ks kt ku hm dt translated"><strong class="kb hu">建造方</strong> -在区块链部署本合同的账户将是本智能合同的<code class="eh lx ly lz ma b">_primary</code>(主要方)，并将控制本合同。</p><p id="51d7" class="pw-post-body-paragraph jz ka ht kb b kc kd iu ke kf kg ix kh ki kj kk kl km kn ko kp kq kr ks kt ku hm dt translated"><strong class="kb hu">修饰符- </strong>如果在任何函数中使用修饰符，将检查函数是否被主要方调用。</p><p id="8ebd" class="pw-post-body-paragraph jz ka ht kb b kc kd iu ke kf kg ix kh ki kj kk kl km kn ko kp kq kr ks kt ku hm dt translated"><strong class="kb hu">转移所有权</strong>——当然有改变主方的功能。</p><h2 id="9062" class="kv kw ht bd kx ky kz la lb lc ld le lf ki lg lh li km lj lk ll kq lm ln lo lp dt translated">托管智能合同</h2><p id="15a3" class="pw-post-body-paragraph jz ka ht kb b kc lq iu ke kf lr ix kh ki ls kk kl km lt ko kp kq lu ks kt ku hm dt translated">因为我们提供托管服务。我们将控制我们的托管资金(我们将是第一方<code class="eh lx ly lz ma b">Secondary.sol</code>)，我们将为一方存款和取款，并跟踪存款。任何人都可以查看给定地址的相应地址存入了多少金额。</p><p id="dca1" class="pw-post-body-paragraph jz ka ht kb b kc kd iu ke kf kg ix kh ki kj kk kl km kn ko kp kq kr ks kt ku hm dt translated">好了，现在我们可以开始我们的托管智能合同了。那么现在我们来了解一下<code class="eh lx ly lz ma b">Escrow.sol</code>。</p><p id="2726" class="pw-post-body-paragraph jz ka ht kb b kc kd iu ke kf kg ix kh ki kj kk kl km kn ko kp kq kr ks kt ku hm dt translated">我们正在定义一个映射来跟踪存款。它将地址与托管合同中的存款值进行映射。</p><pre class="jj jk jl jm fq mb ma mc md aw me dt"><span id="bcce" class="kv kw ht ma b fv mf mg l mh mi">mapping(address =&gt; uint256) private _deposits;</span></pre><p id="8c3b" class="pw-post-body-paragraph jz ka ht kb b kc kd iu ke kf kg ix kh ki kj kk kl km kn ko kp kq kr ks kt ku hm dt translated"><strong class="kb hu">事件</strong>——智能合约还定义了两个事件，一个用于存款，一个用于取款。</p><pre class="jj jk jl jm fq mb ma mc md aw me dt"><span id="8fda" class="kv kw ht ma b fv mf mg l mh mi">event Deposited(address indexed payee, uint256 weiAmount);<br/>event Withdrawn(address indexed payee, uint256 weiAmount);</span></pre><p id="75d0" class="pw-post-body-paragraph jz ka ht kb b kc kd iu ke kf kg ix kh ki kj kk kl km kn ko kp kq kr ks kt ku hm dt translated"><strong class="kb hu">方法</strong> -现在让我们看看我们在托管智能合同中的方法。</p><p id="cb5d" class="pw-post-body-paragraph jz ka ht kb b kc kd iu ke kf kg ix kh ki kj kk kl km kn ko kp kq kr ks kt ku hm dt translated"><strong class="kb hu">押金</strong> —这是一个简单的方法，只允许合同所有者(主要方)为任何一方提交押金。看，我们使用了来自<code class="eh lx ly lz ma b">Secondary.sol</code>的<code class="eh lx ly lz ma b">onlyPrimary</code>修饰符来进行权限管理。我们也存储我们存放乙醚的一方的地址。我们也在最后发射沉积。</p><pre class="jj jk jl jm fq mb ma mc md aw me dt"><span id="26de" class="kv kw ht ma b fv mf mg l mh mi">function deposit(address payee) public onlyPrimary payable {<br/>    uint256 amount = msg.value;<br/>    _deposits[payee] = _deposits[payee].add(amount);<br/>     <br/>     emit Deposited(payee, amount);<br/>  }</span></pre><p id="78c6" class="pw-post-body-paragraph jz ka ht kb b kc kd iu ke kf kg ix kh ki kj kk kl km kn ko kp kq kr ks kt ku hm dt translated"><strong class="kb hu">撤回</strong> —我们将使用此方法将乙醚转移回我们存放乙醚的一方。如果交易成功，我们将更新映射并发出一个事件。这里我们也使用<code class="eh lx ly lz ma b">onlyPrimary</code>来确保只有我们可以执行撤销。</p><pre class="jj jk jl jm fq mb ma mc md aw me dt"><span id="3282" class="kv kw ht ma b fv mf mg l mh mi">function withdraw(address payee) public onlyPrimary {<br/>    uint256 payment = _deposits[payee];</span><span id="b6d8" class="kv kw ht ma b fv mj mg l mh mi">    _deposits[payee] = 0;</span><span id="0448" class="kv kw ht ma b fv mj mg l mh mi">    payee.transfer(payment);</span><span id="ba69" class="kv kw ht ma b fv mj mg l mh mi">    emit Withdrawn(payee, payment);<br/>  }</span></pre><p id="87c5" class="pw-post-body-paragraph jz ka ht kb b kc kd iu ke kf kg ix kh ki kj kk kl km kn ko kp kq kr ks kt ku hm dt translated">这是一个返回给定地址的存款值的函数，它是公共的，所以任何人都可以检查给定账户的托管余额。</p><pre class="jj jk jl jm fq mb ma mc md aw me dt"><span id="15d6" class="kv kw ht ma b fv mf mg l mh mi">function depositsOf(address payee) public view returns (uint256) {<br/>    return _deposits[payee];<br/>}</span></pre><p id="bad5" class="pw-post-body-paragraph jz ka ht kb b kc kd iu ke kf kg ix kh ki kj kk kl km kn ko kp kq kr ks kt ku hm dt translated">就这样，我们的智能合约完成了。我们可以在它的基础上添加额外的功能，它也经过了很好的测试，但是你可以测试它，只是为了了解它是如何工作的。我们将在接下来的教程中查看由open-zeppelin library提供的其他2个托管合同(有条件托管和退款),它们是基于这个托管智能合同构建的。</p><p id="993e" class="pw-post-body-paragraph jz ka ht kb b kc kd iu ke kf kg ix kh ki kj kk kl km kn ko kp kq kr ks kt ku hm dt translated">如果你对智能合约有什么不了解或者不了解，可以在下面评论。如果你觉得这有用，你可以👏在灵媒上跟着我。</p><blockquote class="mk"><p id="49d4" class="ml mm ht bd mn mo mp mq mr ms mt ku ek translated"><a class="ae jy" href="https://coincodecap.com/?utm_source=coinmonks" rel="noopener ugc nofollow" target="_blank">直接在您的收件箱中获得最佳软件交易</a></p></blockquote><figure class="mv mw mx my mz jn fe ff paragraph-image"><a href="https://coincodecap.com/?utm_source=coinmonks"><div class="fe ff mu"><img src="../Images/7c0b3dfdcbfea594cc0ae7d4f9bf6fcb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1168/format:webp/0*OJ-qb5G6i863msBB.png"/></div></a></figure></div></div>    
</body>
</html>