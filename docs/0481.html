<html>
<head>
<title>How To: Compile a Solidity Smart Contract Using Node.js</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何:使用Node.js编译Solidity智能协定</h1>
<blockquote>原文：<a href="https://medium.com/coinmonks/how-to-compile-a-solidity-smart-contract-using-node-js-51ea7c6bf440?source=collection_archive---------1-----------------------#2018-05-11">https://medium.com/coinmonks/how-to-compile-a-solidity-smart-contract-using-node-js-51ea7c6bf440?source=collection_archive---------1-----------------------#2018-05-11</a></blockquote><div><div class="ef hh hi hj hk hl"/><div class="hm hn ho hp hq"><div class=""/><p id="82e8" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">在<a class="ae jo" rel="noopener" href="/coinmonks/how-to-write-a-simple-smart-contract-25f6d3c1d6db">之前的博文</a>中，我们使用<a class="ae jo" href="https://solidity.readthedocs.io/en/v0.4.23/" rel="noopener ugc nofollow" target="_blank"> Solidity </a>编程语言编写了一份智能合同。</p><p id="299a" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">接下来，我们需要编译<code class="eh jp jq jr js b">hello.sol</code>文件，以便测试和部署我们的智能契约。</p><p id="5665" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">我们需要在编译后的文件上使用的属性是应用程序二进制接口(ABI)或<code class="eh jp jq jr js b">interface</code>和<code class="eh jp jq jr js b">bytecode</code>。<code class="eh jp jq jr js b">bytecode</code>实际上是将进入区块链以使智能合约工作的东西，<code class="eh jp jq jr js b">interface</code>将是Javascript层，其作用就像是<code class="eh jp jq jr js b">bytecode</code>的人性化地图。</p><p id="79f7" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">我们开始吧！</p><p id="a832" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">在项目根目录下的终端中，键入:</p><p id="f5eb" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated"><code class="eh jp jq jr js b">npm install --save solc</code></p><p id="54b7" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated"><code class="eh jp jq jr js b">solc</code>是一个Solidity编译器。</p><p id="e28c" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">接下来，在项目的根目录下创建一个名为<code class="eh jp jq jr js b">compile.js</code>的文件。它应该和你的<code class="eh jp jq jr js b">contracts</code>文件夹是兄弟姐妹。写<code class="eh jp jq jr js b">compile.js</code>文件，如下图。</p><figure class="ju jv jw jx fq jy fe ff paragraph-image"><div role="button" tabindex="0" class="jz ka di kb bf kc"><div class="fe ff jt"><img src="../Images/8dd618305b13d5bee8f062fd93b1be25.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Wt6QxI_-oVnRRO7JhyQv2w.png"/></div></div><figcaption class="kf kg fg fe ff kh ki bd b be z ek">compile.js</figcaption></figure><p id="9e46" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">我们需要两个节点模块(<code class="eh jp jq jr js b">path</code>和<code class="eh jp jq jr js b">fs</code>)和我们的Solidity编译器(<code class="eh jp jq jr js b">solc</code>)。我们不能简单地要求我们的<code class="eh jp jq jr js b">hello.sol</code>文件的原因是因为Node将试图以Javascript的形式执行文件，并且会抛出一个带有<code class="eh jp jq jr js b">.sol</code>文件的错误。</p><p id="0fef" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated"><code class="eh jp jq jr js b">helloPath</code>变量找到当前工作目录(<code class="eh jp jq jr js b">__dirname</code>)并导航到其中的<code class="eh jp jq jr js b">hello.sol</code>文件。<code class="eh jp jq jr js b">source</code>变量由位于<code class="eh jp jq jr js b">helloPath</code>中的<code class="eh jp jq jr js b">hello.sol</code>的原始源代码填充。<code class="eh jp jq jr js b">UTF-8</code>字符串代表文件的编码。</p><p id="b0af" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">在第8行，我们在源代码上调用<code class="eh jp jq jr js b">compile()</code>,并指定我们将编译多少个契约。在我们的例子中，是一个。</p><p id="8513" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">这可能有助于我们了解幕后发生了什么，所以让我们稍微修改一下第8行，并将我们的<code class="eh jp jq jr js b">contracts</code>对象记录到我们的控制台。</p><figure class="ju jv jw jx fq jy fe ff paragraph-image"><div role="button" tabindex="0" class="jz ka di kb bf kc"><div class="fe ff kj"><img src="../Images/e3bc93fb54ae4e0612b19a239bbe61c9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZAFthnYZJ5bQfHD_2nJ9sA.png"/></div></div><figcaption class="kf kg fg fe ff kh ki bd b be z ek">altered line 8</figcaption></figure><p id="f0cf" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">在项目根目录下的命令行中键入<code class="eh jp jq jr js b">node compile.js</code>,您应该会得到类似这样的结果:</p><figure class="ju jv jw jx fq jy fe ff paragraph-image"><div role="button" tabindex="0" class="jz ka di kb bf kc"><div class="fe ff kk"><img src="../Images/b9e9ac4e070bf5ecaed779ba559202c9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kOapDgA2tASyY6lWr9aEXg.png"/></div></div><figcaption class="kf kg fg fe ff kh ki bd b be z ek">weeeeeeeeeeee!!!!!!!</figcaption></figure><p id="93a6" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated"><code class="eh jp jq jr js b">compile()</code>的结果永远是一个对象。<code class="eh jp jq jr js b">contracts</code>是顶层对象，包含我们已经编译的所有合同。同样，在我们的情况下，它只是一个合同。让我们仔细看看我们真正关心的两个属性:<code class="eh jp jq jr js b">interface</code>和<code class="eh jp jq jr js b">bytecode</code>。</p><p id="e95e" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">第一，<code class="eh jp jq jr js b">bytecode</code>。</p><figure class="ju jv jw jx fq jy fe ff paragraph-image"><div role="button" tabindex="0" class="jz ka di kb bf kc"><div class="fe ff kl"><img src="../Images/637056bd21998aeeabb928912b6fa3ae.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LSk0Wl3rrS5TbmQHHPENtA.png"/></div></div><figcaption class="kf kg fg fe ff kh ki bd b be z ek">bytecode</figcaption></figure><p id="0aca" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">这是将被部署到区块链上并在以太坊虚拟机(EVM)上执行的代码。如你所见，它不是人类可读的。这就引出了我们的第二个重要属性<code class="eh jp jq jr js b">interface</code>。这是ABI。</p><figure class="ju jv jw jx fq jy fe ff paragraph-image"><div role="button" tabindex="0" class="jz ka di kb bf kc"><div class="fe ff km"><img src="../Images/6377ee461a1cfccbec5a9a5017a1c5c6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8hYEmsmQrHdmRt1VwYykBw.png"/></div></div><figcaption class="kf kg fg fe ff kh ki bd b be z ek">Application Binary Interface (ABI)</figcaption></figure><p id="2430" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">看起来有点眼熟吧？这些是我们在测试和部署合同时能够使用的Javascript方法。</p><p id="cbf0" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">一旦你彻底调查了<code class="eh jp jq jr js b">contracts</code>对象，继续按几次撤销键，使第8行回到就绪状态。</p><figure class="ju jv jw jx fq jy fe ff paragraph-image"><div role="button" tabindex="0" class="jz ka di kb bf kc"><div class="fe ff jt"><img src="../Images/8dd618305b13d5bee8f062fd93b1be25.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Wt6QxI_-oVnRRO7JhyQv2w.png"/></div></div><figcaption class="kf kg fg fe ff kh ki bd b be z ek">Ready!</figcaption></figure><p id="22e1" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">编译文件写好了！</p><p id="2eae" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">下次我们将使用<a class="ae jo" href="https://mochajs.org/" rel="noopener ugc nofollow" target="_blank"> Mocha </a>测试框架测试合同代码时，请继续收听。</p><p id="9cc8" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">可复制/粘贴的<code class="eh jp jq jr js b">compile.js</code>文件:</p><pre class="ju jv jw jx fq kn js ko kp aw kq dt"><span id="f302" class="kr ks ht js b fv kt ku l kv kw">const path = require('path');<br/>const fs = require('fs');<br/>const solc = require('solc');</span><span id="a818" class="kr ks ht js b fv kx ku l kv kw">const helloPath = path.resolve(__dirname, 'contracts', 'hello.sol');<br/>const source = fs.readFileSync(helloPath, 'UTF-8');</span><span id="ae3c" class="kr ks ht js b fv kx ku l kv kw">module.exports = solc.compile(source, 1).contracts[':Hello'];</span></pre><blockquote class="ky"><p id="f5f8" class="kz la ht bd lb lc ld le lf lg lh jn ek translated">加入Coinmonks <a class="ae jo" href="https://t.me/coincodecap" rel="noopener ugc nofollow" target="_blank">电报频道</a>和<a class="ae jo" href="https://www.youtube.com/c/coinmonks/videos" rel="noopener ugc nofollow" target="_blank"> Youtube频道</a>获取每日<a class="ae jo" href="http://coincodecap.com/" rel="noopener ugc nofollow" target="_blank">加密新闻</a></p></blockquote><h2 id="15d6" class="kr ks ht bd li lj lk ll lm ln lo lp lq jb lr ls lt jf lu lv lw jj lx ly lz ma dt translated">另外，阅读</h2><ul class=""><li id="20fb" class="mb mc ht is b it md ix me jb mf jf mg jj mh jn mi mj mk ml dt translated"><a class="ae jo" rel="noopener" href="/coinmonks/top-10-crypto-copy-trading-platforms-for-beginners-d0c37c7d698c">复制交易</a> | <a class="ae jo" rel="noopener" href="/coinmonks/crypto-tax-software-ed4b4810e338">加密税务软件</a></li><li id="723e" class="mb mc ht is b it mm ix mn jb mo jf mp jj mq jn mi mj mk ml dt translated"><a class="ae jo" href="https://coincodecap.com/grid-trading" rel="noopener ugc nofollow" target="_blank">电网交易</a> | <a class="ae jo" rel="noopener" href="/coinmonks/the-best-cryptocurrency-hardware-wallets-of-2020-e28b1c124069">加密硬件钱包</a></li><li id="874f" class="mb mc ht is b it mm ix mn jb mo jf mp jj mq jn mi mj mk ml dt translated"><a class="ae jo" href="http://Top 4 Telegram Channels for Crypto Traders" rel="noopener ugc nofollow" target="_blank">密码电报信号</a> | <a class="ae jo" rel="noopener" href="/coinmonks/crypto-trading-bot-c2ffce8acb2a">密码交易机器人</a></li><li id="12b7" class="mb mc ht is b it mm ix mn jb mo jf mp jj mq jn mi mj mk ml dt translated"><a class="ae jo" href="https://coincodecap.com/best-online-casinos" rel="noopener ugc nofollow" target="_blank">最佳网上赌场</a> | <a class="ae jo" rel="noopener" href="/coinmonks/futures-trading-bots-5a282ccee3f5">期货交易机器人</a></li><li id="3d0e" class="mb mc ht is b it mm ix mn jb mo jf mp jj mq jn mi mj mk ml dt translated"><a class="ae jo" href="https://coincodecap.com/what-are-decentralized-exchanges" rel="noopener ugc nofollow" target="_blank">分散交易所</a> | <a class="ae jo" href="https://coincodecap.com/bitbns-fip" rel="noopener ugc nofollow" target="_blank">比特FIP </a></li><li id="5cf9" class="mb mc ht is b it mm ix mn jb mo jf mp jj mq jn mi mj mk ml dt translated"><a class="ae jo" href="https://coincodecap.com/buy-crypto-with-credit-card" rel="noopener ugc nofollow" target="_blank">用信用卡购买密码的10个最佳地点</a></li><li id="3d13" class="mb mc ht is b it mm ix mn jb mo jf mp jj mq jn mi mj mk ml dt translated"><a class="ae jo" href="https://coincodecap.com/5-best-crypto-trading-bots-in-canada" rel="noopener ugc nofollow" target="_blank">加拿大最好的加密交易机器人</a> | <a class="ae jo" href="https://coincodecap.com/bybit-binance-moonxbt" rel="noopener ugc nofollow" target="_blank">比特vs币安</a></li><li id="70af" class="mb mc ht is b it mm ix mn jb mo jf mp jj mq jn mi mj mk ml dt translated"><a class="ae jo" href="https://coincodecap.com/best-crypto-exchanges-in-uae" rel="noopener ugc nofollow" target="_blank">阿联酋5大最佳加密交易所</a> | <a class="ae jo" href="https://coincodecap.com/simpleswap-review" rel="noopener ugc nofollow" target="_blank"> SimpleSwap评论</a></li><li id="f33b" class="mb mc ht is b it mm ix mn jb mo jf mp jj mq jn mi mj mk ml dt translated"><a class="ae jo" rel="noopener" href="/coinmonks/crypto-exchange-dd2f9d6f3769">最佳加密交易所</a> | <a class="ae jo" rel="noopener" href="/coinmonks/bitcoin-exchange-in-india-7f1fe79715c9">印度最佳加密交易所</a></li><li id="47a8" class="mb mc ht is b it mm ix mn jb mo jf mp jj mq jn mi mj mk ml dt translated"><a class="ae jo" rel="noopener" href="/coinmonks/best-crypto-apis-for-developers-5efe3a597a9f">开发人员的最佳加密API</a></li><li id="b359" class="mb mc ht is b it mm ix mn jb mo jf mp jj mq jn mi mj mk ml dt translated">最佳<a class="ae jo" rel="noopener" href="/coinmonks/top-5-crypto-lending-platforms-in-2020-that-you-need-to-know-a1b675cec3fa">密码借贷平台</a></li><li id="9487" class="mb mc ht is b it mm ix mn jb mo jf mp jj mq jn mi mj mk ml dt translated">杠杆代币的终极指南</li></ul></div></div>    
</body>
</html>