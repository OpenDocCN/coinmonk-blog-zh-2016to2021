<html>
<head>
<title>Three Top SQL Server Backup Types</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">三种最常见的SQL Server备份类型</h1>
<blockquote>原文：<a href="https://medium.com/coinmonks/three-top-sql-server-backup-types-fbd253fc09f3?source=collection_archive---------2-----------------------#2018-04-24">https://medium.com/coinmonks/three-top-sql-server-backup-types-fbd253fc09f3?source=collection_archive---------2-----------------------#2018-04-24</a></blockquote><div><div class="ef hh hi hj hk hl"/><div class="hm hn ho hp hq"><div class=""/><div class=""><h2 id="e1ed" class="pw-subtitle-paragraph iq hs ht bd b ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ek translated"><em class="ji">在数据技术时代，保护数据安全比以往任何时候都更加重要</em></h2></div><figure class="jk jl jm jn fq jo fe ff paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="fe ff jj"><img src="../Images/456189a25be63bfe1f2803290c195e68.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Pa7t8lZexnCHTgNjfb6mKg.png"/></div></div></figure><p id="7b90" class="pw-post-body-paragraph jv jw ht jx b jy jz iu ka kb kc ix kd ke kf kg kh ki kj kk kl km kn ko kp kq hm dt translated">对于公司以及从事数据存储和管理的个人来说，没有什么比数据安全更重要的了。</p><p id="1ef3" class="pw-post-body-paragraph jv jw ht jx b jy jz iu ka kb kc ix kd ke kf kg kh ki kj kk kl km kn ko kp kq hm dt translated">许多公司将其核心数据存储在数据库中，这些数据很容易受到威胁，包括硬件故障、恶意攻击、错误的用户操作、数据库损坏以及自然灾害导致的数据丢失。</p><p id="88cb" class="pw-post-body-paragraph jv jw ht jx b jy jz iu ka kb kc ix kd ke kf kg kh ki kj kk kl km kn ko kp kq hm dt translated">在新的数据技术(DT)时代，采取措施应对这些数据安全威胁至关重要。对于SQL servers等关系数据库，数据库备份为灾难恢复(DR)能力提供了强有力的保证。本文中概述的数据备份类型是保持数据安全的有效工具。</p><p id="6e42" class="pw-post-body-paragraph jv jw ht jx b jy jz iu ka kb kc ix kd ke kf kg kh ki kj kk kl km kn ko kp kq hm dt translated">本文介绍了以下备份类型的工作原理和应用流程:</p><p id="bab2" class="pw-post-body-paragraph jv jw ht jx b jy jz iu ka kb kc ix kd ke kf kg kh ki kj kk kl km kn ko kp kq hm dt translated">1.<strong class="jx hu">完整备份</strong> —数据库在给定时间点的完整副本</p><p id="90c4" class="pw-post-body-paragraph jv jw ht jx b jy jz iu ka kb kc ix kd ke kf kg kh ki kj kk kl km kn ko kp kq hm dt translated">2.<strong class="jx hu">事务日志备份</strong> —记录从上次日志备份或事务日志备份开始的完整备份到当前时间点提交的所有事务日志更改</p><p id="5673" class="pw-post-body-paragraph jv jw ht jx b jy jz iu ka kb kc ix kd ke kf kg kh ki kj kk kl km kn ko kp kq hm dt translated">3.<strong class="jx hu">差异备份</strong> —从上次完全备份到当前时间点的所有数据更改的副本</p><h1 id="2073" class="kr ks ht bd kt ku kv kw kx ky kz la lb iz lc ja ld jc le jd lf jf lg jg lh li dt translated"><strong class="ak">完整备份</strong></h1><p id="f257" class="pw-post-body-paragraph jv jw ht jx b jy lj iu ka kb lk ix kd ke ll kg kh ki lm kk kl km ln ko kp kq hm dt translated">完整备份是所有SQL Server备份中最简单和最基本的数据库备份。完整备份存储特定数据库在备份完成时的完整副本。</p><p id="92a7" class="pw-post-body-paragraph jv jw ht jx b jy jz iu ka kb kc ix kd ke kf kg kh ki kj kk kl km kn ko kp kq hm dt translated">完整备份的缺点是，它只能将数据库恢复到备份成功完成的时间点。这意味着系统只能恢复到完整备份完成时的时间点，而不能恢复到数据库历史记录中的任何时间点。</p><h2 id="9544" class="lo ks ht bd kt lp lq lr kx ls lt lu lb ke lv lw ld ki lx ly lf km lz ma lh mb dt translated"><strong class="ak">完整备份的工作原理</strong></h2><p id="769e" class="pw-post-body-paragraph jv jw ht jx b jy lj iu ka kb lk ix kd ke ll kg kh ki lm kk kl km ln ko kp kq hm dt translated">以下时间线简要说明了完整备份的工作原理:</p><figure class="jk jl jm jn fq jo fe ff paragraph-image"><div class="fe ff mc"><img src="../Images/a88a3c0e23ad9f3dcbeea211741f7d6e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1296/format:webp/1*vCCrShSZATXCA0jFrTA14Q.png"/></div><figcaption class="md me fg fe ff mf mg bd b be z ek"><em class="ji">Figure source: </em><a class="ae mh" href="https://sqlbak.com/academy/full-backup/" rel="noopener ugc nofollow" target="_blank"><em class="ji">SQL Server Backup Academy</em></a></figcaption></figure><p id="445a" class="pw-post-body-paragraph jv jw ht jx b jy jz iu ka kb kc ix kd ke kf kg kh ki kj kk kl km kn ko kp kq hm dt translated">时间线中显示的事件如下:</p><p id="ac2d" class="pw-post-body-paragraph jv jw ht jx b jy jz iu ka kb kc ix kd ke kf kg kh ki kj kk kl km kn ko kp kq hm dt translated"><strong class="jx hu">下午7点</strong>:生成数据#1。</p><p id="d788" class="pw-post-body-paragraph jv jw ht jx b jy jz iu ka kb kc ix kd ke kf kg kh ki kj kk kl km kn ko kp kq hm dt translated"><strong class="jx hu">晚上10点</strong>:数据库完全备份，备份文件包含数据#1。</p><p id="d1fb" class="pw-post-body-paragraph jv jw ht jx b jy jz iu ka kb kc ix kd ke kf kg kh ki kj kk kl km kn ko kp kq hm dt translated"><strong class="jx hu">凌晨2点</strong>:生成数据#2，数据库包含数据#1和#2。</p><p id="39cf" class="pw-post-body-paragraph jv jw ht jx b jy jz iu ka kb kc ix kd ke kf kg kh ki kj kk kl km kn ko kp kq hm dt translated"><strong class="jx hu">上午6点</strong>:生成数据#3，数据库包含数据#1、#2和#3。</p><p id="b661" class="pw-post-body-paragraph jv jw ht jx b jy jz iu ka kb kc ix kd ke kf kg kh ki kj kk kl km kn ko kp kq hm dt translated"><strong class="jx hu">上午10点</strong>:数据库完全备份，备份文件包含数据#1、#2和#3。</p><p id="6cd3" class="pw-post-body-paragraph jv jw ht jx b jy jz iu ka kb kc ix kd ke kf kg kh ki kj kk kl km kn ko kp kq hm dt translated"><strong class="jx hu">下午1点</strong>:生成数据#4，数据库包含数据#1、#2、#3和#4。</p><p id="dc92" class="pw-post-body-paragraph jv jw ht jx b jy jz iu ka kb kc ix kd ke kf kg kh ki kj kk kl km kn ko kp kq hm dt translated"><strong class="jx hu">下午5点</strong>:生成数据#5，数据库包含数据#1、#2、#3、#4和#5。</p><p id="0dfd" class="pw-post-body-paragraph jv jw ht jx b jy jz iu ka kb kc ix kd ke kf kg kh ki kj kk kl km kn ko kp kq hm dt translated"><strong class="jx hu">晚上8点</strong>:生成数据#6，数据库包含数据#1、#2、#3、#4、#5和#6。</p><p id="12a8" class="pw-post-body-paragraph jv jw ht jx b jy jz iu ka kb kc ix kd ke kf kg kh ki kj kk kl km kn ko kp kq hm dt translated"><strong class="jx hu">晚上10点</strong>:数据库完全备份，备份文件包含数据#1、#2、#3、#4、#5和#6。</p><p id="fc43" class="pw-post-body-paragraph jv jw ht jx b jy jz iu ka kb kc ix kd ke kf kg kh ki kj kk kl km kn ko kp kq hm dt translated">在真实的生产环境中，实际操作可能比时间表显示的要复杂得多。完整备份过程的两个重要问题是:</p><p id="cd8a" class="pw-post-body-paragraph jv jw ht jx b jy jz iu ka kb kc ix kd ke kf kg kh ki kj kk kl km kn ko kp kq hm dt translated"><strong class="jx hu">备份操作会降低I/O(输入/输出)速度</strong></p><p id="8035" class="pw-post-body-paragraph jv jw ht jx b jy jz iu ka kb kc ix kd ke kf kg kh ki kj kk kl km kn ko kp kq hm dt translated">数据库备份需要大量的I/O资源。由于对I/O资源的需求增加，数据库备份操作可能会降低数据库查询的速度。</p><p id="d775" class="pw-post-body-paragraph jv jw ht jx b jy jz iu ka kb kc ix kd ke kf kg kh ki kj kk kl km kn ko kp kq hm dt translated"><strong class="jx hu">在完整备份过程中，数据库事务日志不能被截断</strong></p><p id="4a41" class="pw-post-body-paragraph jv jw ht jx b jy jz iu ka kb kc ix kd ke kf kg kh ki kj kk kl km kn ko kp kq hm dt translated">这可能会导致事务日志不断增长，直到耗尽磁盘中的所有可用空间。对于面向SQL Server产品用户的阿里云RDS来说，这是一个常见的场景。事务日志备份是一种潜在的解决方案，本文对此也有详细介绍。</p><h2 id="4dff" class="lo ks ht bd kt lp lq lr kx ls lt lu lb ke lv lw ld ki lx ly lf km lz ma lh mb dt translated">使用T-SQL创建完整备份</h2><p id="190d" class="pw-post-body-paragraph jv jw ht jx b jy lj iu ka kb lk ix kd ke ll kg kh ki lm kk kl km ln ko kp kq hm dt translated">通过使用BACKUP DATABASE语句，可以使用T-SQL语句完成完整数据库备份。以下示例显示了如何创建AdventureWorks2008R2数据库的完整备份:</p><figure class="jk jl jm jn fq jo fe ff paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="fe ff mi"><img src="../Images/198cbbe6055fc7b72fc3bdf32100aa6d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*eCLsQwY_WSpdCyFrUtLyBw.png"/></div></div></figure><h2 id="0475" class="lo ks ht bd kt lp lq lr kx ls lt lu lb ke lv lw ld ki lx ly lf km lz ma lh mb dt translated"><strong class="ak">使用SSMS IDE创建完整备份</strong></h2><p id="0e1a" class="pw-post-body-paragraph jv jw ht jx b jy lj iu ka kb lk ix kd ke ll kg kh ki lm kk kl km ln ko kp kq hm dt translated">SSMS集成开发环境(IDE)界面操作也可用于创建完整的数据库备份。</p><p id="2c1a" class="pw-post-body-paragraph jv jw ht jx b jy jz iu ka kb kc ix kd ke kf kg kh ki kj kk kl km kn ko kp kq hm dt translated">该过程如下:</p><p id="358e" class="pw-post-body-paragraph jv jw ht jx b jy jz iu ka kb kc ix kd ke kf kg kh ki kj kk kl km kn ko kp kq hm dt translated">1.右键单击要备份的数据库。</p><p id="a190" class="pw-post-body-paragraph jv jw ht jx b jy jz iu ka kb kc ix kd ke kf kg kh ki kj kk kl km kn ko kp kq hm dt translated">2.选择<strong class="jx hu">任务</strong> &gt; <strong class="jx hu">备份</strong>。</p><p id="c417" class="pw-post-body-paragraph jv jw ht jx b jy jz iu ka kb kc ix kd ke kf kg kh ki kj kk kl km kn ko kp kq hm dt translated">3.选择<strong class="jx hu">全</strong>为<strong class="jx hu">备份类型</strong>。</p><p id="e7bc" class="pw-post-body-paragraph jv jw ht jx b jy jz iu ka kb kc ix kd ke kf kg kh ki kj kk kl km kn ko kp kq hm dt translated">4.选择<strong class="jx hu">磁盘</strong>作为备份文件存储。</p><p id="a67d" class="pw-post-body-paragraph jv jw ht jx b jy jz iu ka kb kc ix kd ke kf kg kh ki kj kk kl km kn ko kp kq hm dt translated">5.点击<strong class="jx hu">添加</strong>添加备份文件。</p><p id="8557" class="pw-post-body-paragraph jv jw ht jx b jy jz iu ka kb kc ix kd ke kf kg kh ki kj kk kl km kn ko kp kq hm dt translated">6.选择存储备份文件的目录。</p><p id="69a9" class="pw-post-body-paragraph jv jw ht jx b jy jz iu ka kb kc ix kd ke kf kg kh ki kj kk kl km kn ko kp kq hm dt translated">7.输入备份文件名。</p><p id="486b" class="pw-post-body-paragraph jv jw ht jx b jy jz iu ka kb kc ix kd ke kf kg kh ki kj kk kl km kn ko kp kq hm dt translated">以下截图供参考:</p><figure class="jk jl jm jn fq jo fe ff paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="fe ff mj"><img src="../Images/c4b20b3545a0605fb0da1bb6c7b5e678.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DyzA5ixWXAbkFCsfANFacA.png"/></div></div><figcaption class="md me fg fe ff mf mg bd b be z ek"><em class="ji">Select Back Up from the drop-down menu</em></figcaption></figure><figure class="jk jl jm jn fq jo fe ff paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="fe ff mk"><img src="../Images/cd4e2b2819ddc23b230fb519ec1bc1fa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ulT6sBioA8iHuzIdc7dcSQ.png"/></div></div><figcaption class="md me fg fe ff mf mg bd b be z ek"><em class="ji">Back Up Database window</em></figcaption></figure><h1 id="d430" class="kr ks ht bd kt ku kv kw kx ky kz la lb iz lc ja ld jc le jd lf jf lg jg lh li dt translated"><strong class="ak">事务日志备份</strong></h1><p id="0896" class="pw-post-body-paragraph jv jw ht jx b jy lj iu ka kb lk ix kd ke ll kg kh ki lm kk kl km ln ko kp kq hm dt translated">在完整备份过程中，事务日志可能会显著增长。事务日志备份为这个问题提供了一个解决方案:事务日志备份创建一个记录，记录从上次日志备份或事务日志启动的完整备份到当前时间点提交的所有事务日志更改。</p><p id="776e" class="pw-post-body-paragraph jv jw ht jx b jy jz iu ka kb kc ix kd ke kf kg kh ki kj kk kl km kn ko kp kq hm dt translated">事务日志备份可以与完全备份和差异备份一起使用，将数据库还原到特定的时间点。</p><h2 id="6933" class="lo ks ht bd kt lp lq lr kx ls lt lu lb ke lv lw ld ki lx ly lf km lz ma lh mb dt translated"><strong class="ak">事务日志备份的工作原理</strong></h2><p id="9860" class="pw-post-body-paragraph jv jw ht jx b jy lj iu ka kb lk ix kd ke ll kg kh ki lm kk kl km ln ko kp kq hm dt translated">以下时间线显示了事务日志备份的工作原理:</p><figure class="jk jl jm jn fq jo fe ff paragraph-image"><div class="fe ff mc"><img src="../Images/26f8028447be22e4b05c3945874b8c3e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1296/format:webp/1*q9HBc_3G5-m3TEaeY0wiqA.png"/></div><figcaption class="md me fg fe ff mf mg bd b be z ek"><em class="ji">Figure source: </em><a class="ae mh" href="https://sqlbak.com/academy/transaction-log-backup/" rel="noopener ugc nofollow" target="_blank"><em class="ji">SQL Server Backup Academy</em></a></figcaption></figure><p id="1307" class="pw-post-body-paragraph jv jw ht jx b jy jz iu ka kb kc ix kd ke kf kg kh ki kj kk kl km kn ko kp kq hm dt translated">时间线中显示的事件如下:</p><p id="ef8f" class="pw-post-body-paragraph jv jw ht jx b jy jz iu ka kb kc ix kd ke kf kg kh ki kj kk kl km kn ko kp kq hm dt translated"><strong class="jx hu"> 00:01 </strong>:包含LSN #1、#2和#3的交易#1开始并提交。</p><p id="617f" class="pw-post-body-paragraph jv jw ht jx b jy jz iu ka kb kc ix kd ke kf kg kh ki kj kk kl km kn ko kp kq hm dt translated">包含LSN #4、#5和#6的交易#2已经开始，但尚未提交。事务日志备份文件仅包含LSN #1、#2和#3。</p><p id="1ca8" class="pw-post-body-paragraph jv jw ht jx b jy jz iu ka kb kc ix kd ke kf kg kh ki kj kk kl km kn ko kp kq hm dt translated">包含LSN #4、#5和#6的事务#2仍在运行，尚未提交。</p><p id="0b72" class="pw-post-body-paragraph jv jw ht jx b jy jz iu ka kb kc ix kd ke kf kg kh ki kj kk kl km kn ko kp kq hm dt translated"><strong class="jx hu"> 00:05 </strong>:交易#2启动LSN #7。现在包含LSN #4、#5、# 6和#7的事务#2被成功提交。包含LSN #8、#9和#10的交易#3开始，但尚未提交。事务日志备份文件包含LSN #4、#5、#6和#7。</p><p id="c8e3" class="pw-post-body-paragraph jv jw ht jx b jy jz iu ka kb kc ix kd ke kf kg kh ki kj kk kl km kn ko kp kq hm dt translated"><strong class="jx hu"> 00:07 </strong>:包含LSN #8、#9和#10的事务#3仍在运行，尚未提交。</p><h2 id="7ad0" class="lo ks ht bd kt lp lq lr kx ls lt lu lb ke lv lw ld ki lx ly lf km lz ma lh mb dt translated"><strong class="ak">事务日志备份如何节省空间</strong></h2><p id="1d3e" class="pw-post-body-paragraph jv jw ht jx b jy lj iu ka kb lk ix kd ke ll kg kh ki lm kk kl km ln ko kp kq hm dt translated">事务日志备份完成后，可以截断事务日志文件，并且可以重用事务日志空间。这解决了事务日志在完整备份期间不断增长的问题。</p><p id="8622" class="pw-post-body-paragraph jv jw ht jx b jy jz iu ka kb kc ix kd ke kf kg kh ki kj kk kl km kn ko kp kq hm dt translated">常规数据库事务日志备份有助于控制事务日志文件的大小。建议定期执行数据库事务日志备份。在执行事务日志备份之前，数据库必须处于完整恢复模式。</p><p id="0f1d" class="pw-post-body-paragraph jv jw ht jx b jy jz iu ka kb kc ix kd ke kf kg kh ki kj kk kl km kn ko kp kq hm dt translated">下面显示了如何将数据库设置为完整恢复模式。AdventureWorks2008R2数据库用于此示例:</p><figure class="jk jl jm jn fq jo fe ff paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="fe ff ml"><img src="../Images/858b3bf89780b7779a53367713c1163f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*B4Fjv3OySNs5aXBwP1sHRA.png"/></div></div></figure><h2 id="f425" class="lo ks ht bd kt lp lq lr kx ls lt lu lb ke lv lw ld ki lx ly lf km lz ma lh mb dt translated"><strong class="ak">使用T-SQL创建事务日志备份</strong></h2><p id="695d" class="pw-post-body-paragraph jv jw ht jx b jy lj iu ka kb lk ix kd ke ll kg kh ki lm kk kl km ln ko kp kq hm dt translated">使用T-SQL语句创建事务日志备份的过程如下:</p><figure class="jk jl jm jn fq jo fe ff paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="fe ff mm"><img src="../Images/d5d2d9305c9258fa12ef1b2c6063a179.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*M0wjZMjzaOIbhHRnbOsmkg.png"/></div></div></figure><h2 id="e093" class="lo ks ht bd kt lp lq lr kx ls lt lu lb ke lv lw ld ki lx ly lf km lz ma lh mb dt translated"><strong class="ak">使用SSMS IDE创建事务日志备份</strong></h2><p id="eaba" class="pw-post-body-paragraph jv jw ht jx b jy lj iu ka kb lk ix kd ke ll kg kh ki lm kk kl km ln ko kp kq hm dt translated">使用SSMS IDE创建事务日志备份的过程如下:</p><p id="3815" class="pw-post-body-paragraph jv jw ht jx b jy jz iu ka kb kc ix kd ke kf kg kh ki kj kk kl km kn ko kp kq hm dt translated">1.右键单击将在其中创建事务日志备份的数据库。</p><p id="db52" class="pw-post-body-paragraph jv jw ht jx b jy jz iu ka kb kc ix kd ke kf kg kh ki kj kk kl km kn ko kp kq hm dt translated">2.选择<strong class="jx hu">任务</strong> &gt; <strong class="jx hu">备份</strong>。</p><p id="f2b7" class="pw-post-body-paragraph jv jw ht jx b jy jz iu ka kb kc ix kd ke kf kg kh ki kj kk kl km kn ko kp kq hm dt translated">3.为<strong class="jx hu">备份类型</strong>选择<strong class="jx hu">事务日志</strong>。</p><p id="b81a" class="pw-post-body-paragraph jv jw ht jx b jy jz iu ka kb kc ix kd ke kf kg kh ki kj kk kl km kn ko kp kq hm dt translated">4.选择<strong class="jx hu">磁盘</strong>作为备份文件存储。</p><p id="3e1e" class="pw-post-body-paragraph jv jw ht jx b jy jz iu ka kb kc ix kd ke kf kg kh ki kj kk kl km kn ko kp kq hm dt translated">5.点击<strong class="jx hu">添加</strong>添加备份文件。</p><p id="fd82" class="pw-post-body-paragraph jv jw ht jx b jy jz iu ka kb kc ix kd ke kf kg kh ki kj kk kl km kn ko kp kq hm dt translated">6.选择存储备份文件的目录。</p><p id="20a4" class="pw-post-body-paragraph jv jw ht jx b jy jz iu ka kb kc ix kd ke kf kg kh ki kj kk kl km kn ko kp kq hm dt translated">7.输入备份文件名。</p><p id="738b" class="pw-post-body-paragraph jv jw ht jx b jy jz iu ka kb kc ix kd ke kf kg kh ki kj kk kl km kn ko kp kq hm dt translated">以下截图供参考:</p><figure class="jk jl jm jn fq jo fe ff paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="fe ff mn"><img src="../Images/7507f6a9b2ffe55639d6b764ee669c2b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xodyxwr0033ny3W8uKoScw.png"/></div></div><figcaption class="md me fg fe ff mf mg bd b be z ek"><em class="ji">Back Up Database window</em></figcaption></figure><h2 id="1a34" class="lo ks ht bd kt lp lq lr kx ls lt lu lb ke lv lw ld ki lx ly lf km lz ma lh mb dt translated"><strong class="ak">事务日志备份链</strong></h2><p id="1a8e" class="pw-post-body-paragraph jv jw ht jx b jy lj iu ka kb lk ix kd ke ll kg kh ki lm kk kl km ln ko kp kq hm dt translated">事务日志备份通过事务日志链连接。事务日志链总是从完整数据库备份开始。</p><p id="1c6f" class="pw-post-body-paragraph jv jw ht jx b jy jz iu ka kb kc ix kd ke kf kg kh ki kj kk kl km kn ko kp kq hm dt translated">每个事务日志备份文件都有自己的FirstLSN和LastLSN。</p><p id="3450" class="pw-post-body-paragraph jv jw ht jx b jy jz iu ka kb kc ix kd ke kf kg kh ki kj kk kl km kn ko kp kq hm dt translated">FirstLSN等于前一个事务日志备份文件的LastLSN。</p><p id="f121" class="pw-post-body-paragraph jv jw ht jx b jy jz iu ka kb kc ix kd ke kf kg kh ki kj kk kl km kn ko kp kq hm dt translated">LastLSN等于下一个事务日志备份文件的第一个LSN。</p><p id="e032" class="pw-post-body-paragraph jv jw ht jx b jy jz iu ka kb kc ix kd ke kf kg kh ki kj kk kl km kn ko kp kq hm dt translated">这就是事务日志备份文件之间建立连接的方式。</p><p id="4f56" class="pw-post-body-paragraph jv jw ht jx b jy jz iu ka kb kc ix kd ke kf kg kh ki kj kk kl km kn ko kp kq hm dt translated">这种结构意味着，如果任何事务日志备份文件丢失或损坏，整个事务日志可能无法恢复。下图显示了事务日志备份链中不同文件之间的交互关系:</p><figure class="jk jl jm jn fq jo fe ff paragraph-image"><div class="fe ff mc"><img src="../Images/0a72d7b943c504a6ec4233399fc71690.png" data-original-src="https://miro.medium.com/v2/resize:fit:1296/format:webp/1*HqnKzbLdtK-1ZmjcANV2pg.png"/></div><figcaption class="md me fg fe ff mf mg bd b be z ek"><em class="ji">Figure source: </em><a class="ae mh" href="https://sqlbak.com/academy/transaction-log-backup/" rel="noopener ugc nofollow" target="_blank"><em class="ji">SQL Server Backup Academy</em></a></figcaption></figure><p id="a9ed" class="pw-post-body-paragraph jv jw ht jx b jy jz iu ka kb kc ix kd ke kf kg kh ki kj kk kl km kn ko kp kq hm dt translated">以下示例显示了事务日志链文件之间的关系，如RESTORE HEADERONLY方法的搜索结果所示:</p><figure class="jk jl jm jn fq jo fe ff paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="fe ff mo"><img src="../Images/6e49e22ce2c99c4bacb26e7f3b1b3373.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*E7BN5x1uvuX-NxSd82DeLw.png"/></div></div></figure><p id="bdef" class="pw-post-body-paragraph jv jw ht jx b jy jz iu ka kb kc ix kd ke kf kg kh ki kj kk kl km kn ko kp kq hm dt translated">如图所示:</p><p id="b8c6" class="pw-post-body-paragraph jv jw ht jx b jy jz iu ka kb kc ix kd ke kf kg kh ki kj kk kl km kn ko kp kq hm dt translated">adventureworks 2008 R2 _ log _ 201711122201的LastLSN等于adventureworks 2008 R2 _ log _ 201711122202的FirstLSN。</p><p id="09b9" class="pw-post-body-paragraph jv jw ht jx b jy jz iu ka kb kc ix kd ke kf kg kh ki kj kk kl km kn ko kp kq hm dt translated">adventureworks 2008 R2 _ log _ 201711122202的LastLSN等于adventureworks 2008 R2 _ log _ 201711122203的FirstLSN。</p><p id="b695" class="pw-post-body-paragraph jv jw ht jx b jy jz iu ka kb kc ix kd ke kf kg kh ki kj kk kl km kn ko kp kq hm dt translated">通过这种方式，可以沿着事务日志备份链建立链接。</p><p id="5e6d" class="pw-post-body-paragraph jv jw ht jx b jy jz iu ka kb kc ix kd ke kf kg kh ki kj kk kl km kn ko kp kq hm dt translated">如果adventureworks 2008 R2 _ log _ 201711122202发生任何丢失或损坏，数据库只能还原adventureworks 2008 R2 _ log _ 201711122201中包含的事务行为。</p><p id="1e7f" class="pw-post-body-paragraph jv jw ht jx b jy jz iu ka kb kc ix kd ke kf kg kh ki kj kk kl km kn ko kp kq hm dt translated">另一个问题是事务日志备份必须至少每五分钟执行一次。这可以防范丢失数据的风险，防止数据库事务日志不断增长，并消除不断执行完整备份的需要。</p><p id="e51d" class="pw-post-body-paragraph jv jw ht jx b jy jz iu ka kb kc ix kd ke kf kg kh ki kj kk kl km kn ko kp kq hm dt translated">如果每五分钟执行一次事务日志备份，这意味着每小时12次备份，或每天288次备份。这可能会导致事务日志恢复链变得太长，进而延长恢复时间，使恢复时间目标(r to)更难实现。差异备份技术有助于解决这一问题。</p><h1 id="7e95" class="kr ks ht bd kt ku kv kw kx ky kz la lb iz lc ja ld jc le jd lf jf lg jg lh li dt translated"><strong class="ak">差异备份</strong></h1><p id="4049" class="pw-post-body-paragraph jv jw ht jx b jy lj iu ka kb lk ix kd ke ll kg kh ki lm kk kl km ln ko kp kq hm dt translated">差异备份会备份从上次完全备份到当前时间点的所有数据更改。它通常比完整备份占用更少的数据空间。它确保了更高的备份效率、更快的恢复速度和更好的灾难恢复能力。</p><h2 id="f940" class="lo ks ht bd kt lp lq lr kx ls lt lu lb ke lv lw ld ki lx ly lf km lz ma lh mb dt translated"><strong class="ak">差异备份的工作原理</strong></h2><p id="ab3d" class="pw-post-body-paragraph jv jw ht jx b jy lj iu ka kb lk ix kd ke ll kg kh ki lm kk kl km ln ko kp kq hm dt translated">以下时间线显示了差异备份的工作原理:</p><figure class="jk jl jm jn fq jo fe ff paragraph-image"><div class="fe ff mc"><img src="../Images/24ed9bbf33a3ff57f41683bb9e39388a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1296/format:webp/1*PXhdgWnt0xN9IFSCA-ZTCQ.png"/></div><figcaption class="md me fg fe ff mf mg bd b be z ek"><em class="ji">Figure source: </em><a class="ae mh" href="https://sqlbak.com/academy/differential-backup/" rel="noopener ugc nofollow" target="_blank"><em class="ji">SQL Server Backup Academy</em></a></figcaption></figure><p id="e021" class="pw-post-body-paragraph jv jw ht jx b jy jz iu ka kb kc ix kd ke kf kg kh ki kj kk kl km kn ko kp kq hm dt translated"><strong class="jx hu">上午7点</strong>:数据库包含数据#1。</p><p id="c4ae" class="pw-post-body-paragraph jv jw ht jx b jy jz iu ka kb kc ix kd ke kf kg kh ki kj kk kl km kn ko kp kq hm dt translated"><strong class="jx hu">上午10点</strong>:数据库完全备份，完全备份文件包含数据#1。</p><p id="228a" class="pw-post-body-paragraph jv jw ht jx b jy jz iu ka kb kc ix kd ke kf kg kh ki kj kk kl km kn ko kp kq hm dt translated"><strong class="jx hu">下午1点</strong>:数据库包含数据#1、#2、#3和#4。</p><p id="115a" class="pw-post-body-paragraph jv jw ht jx b jy jz iu ka kb kc ix kd ke kf kg kh ki kj kk kl km kn ko kp kq hm dt translated"><strong class="jx hu">下午2点</strong>:对数据库进行差异备份，差异备份文件包含数据#2、#3和#4。这表示在下午2点的最后一次完全备份和差异备份之间所有更改的数据</p><p id="468d" class="pw-post-body-paragraph jv jw ht jx b jy jz iu ka kb kc ix kd ke kf kg kh ki kj kk kl km kn ko kp kq hm dt translated"><strong class="jx hu">下午4点</strong>:数据库包含数据#1、#2、#3、#4、#5、#6。</p><p id="e0e2" class="pw-post-body-paragraph jv jw ht jx b jy jz iu ka kb kc ix kd ke kf kg kh ki kj kk kl km kn ko kp kq hm dt translated"><strong class="jx hu">下午6点</strong>:对数据库进行差异备份，差异备份文件包含数据#2、#3、#4、#5和#6。</p><p id="5d35" class="pw-post-body-paragraph jv jw ht jx b jy jz iu ka kb kc ix kd ke kf kg kh ki kj kk kl km kn ko kp kq hm dt translated"><strong class="jx hu">晚上8点</strong>:数据库包含数据#1、#2、#3、#4、#5、#6、#7和#8。</p><p id="24b9" class="pw-post-body-paragraph jv jw ht jx b jy jz iu ka kb kc ix kd ke kf kg kh ki kj kk kl km kn ko kp kq hm dt translated"><strong class="jx hu">晚上10点</strong>:数据库完全备份，完全备份文件包含数据#1、#2、#3、#4、#5、#6、#7和#8。</p><p id="040f" class="pw-post-body-paragraph jv jw ht jx b jy jz iu ka kb kc ix kd ke kf kg kh ki kj kk kl km kn ko kp kq hm dt translated"><strong class="jx hu">晚上11点</strong>:生成新数据#9和#10，数据库包含数据#1、#2、#3、#4、#5、#6、#7、#8、#9和#10。</p><p id="c406" class="pw-post-body-paragraph jv jw ht jx b jy jz iu ka kb kc ix kd ke kf kg kh ki kj kk kl km kn ko kp kq hm dt translated"><strong class="jx hu">凌晨2点</strong>:数据库进行差异备份，差异备份文件包含数据#9和#10。</p><h2 id="0a19" class="lo ks ht bd kt lp lq lr kx ls lt lu lb ke lv lw ld ki lx ly lf km lz ma lh mb dt translated"><strong class="ak">使用T-SQL创建差异备份</strong></h2><p id="0613" class="pw-post-body-paragraph jv jw ht jx b jy lj iu ka kb lk ix kd ke ll kg kh ki lm kk kl km ln ko kp kq hm dt translated">以下示例显示了使用T-SQL语句创建差异备份的过程:</p><figure class="jk jl jm jn fq jo fe ff paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="fe ff mp"><img src="../Images/9592401e976eb8fe38fe55f212aabc67.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*o_1KRMUGS7-D5Kc_Ja3L1g.png"/></div></div></figure><h2 id="b9f0" class="lo ks ht bd kt lp lq lr kx ls lt lu lb ke lv lw ld ki lx ly lf km lz ma lh mb dt translated"><strong class="ak">使用SSMS创建差异备份</strong></h2><p id="b201" class="pw-post-body-paragraph jv jw ht jx b jy lj iu ka kb lk ix kd ke ll kg kh ki lm kk kl km ln ko kp kq hm dt translated">使用SSMS IDE创建差异备份的过程如下:</p><p id="f338" class="pw-post-body-paragraph jv jw ht jx b jy jz iu ka kb kc ix kd ke kf kg kh ki kj kk kl km kn ko kp kq hm dt translated">1.右键单击将在其中创建事务日志备份的数据库。</p><p id="3f86" class="pw-post-body-paragraph jv jw ht jx b jy jz iu ka kb kc ix kd ke kf kg kh ki kj kk kl km kn ko kp kq hm dt translated">2.选择<strong class="jx hu">任务</strong> &gt; <strong class="jx hu">备份</strong>。</p><p id="edfe" class="pw-post-body-paragraph jv jw ht jx b jy jz iu ka kb kc ix kd ke kf kg kh ki kj kk kl km kn ko kp kq hm dt translated">3.选择<strong class="jx hu">差速器</strong>为<strong class="jx hu">后备类型</strong>。</p><p id="d9fc" class="pw-post-body-paragraph jv jw ht jx b jy jz iu ka kb kc ix kd ke kf kg kh ki kj kk kl km kn ko kp kq hm dt translated">4.选择<strong class="jx hu">磁盘</strong>作为备份文件存储。</p><p id="9547" class="pw-post-body-paragraph jv jw ht jx b jy jz iu ka kb kc ix kd ke kf kg kh ki kj kk kl km kn ko kp kq hm dt translated">5.点击<strong class="jx hu">添加</strong>添加备份文件。</p><p id="b2d5" class="pw-post-body-paragraph jv jw ht jx b jy jz iu ka kb kc ix kd ke kf kg kh ki kj kk kl km kn ko kp kq hm dt translated">6.选择存储备份文件的目录。</p><p id="e9c1" class="pw-post-body-paragraph jv jw ht jx b jy jz iu ka kb kc ix kd ke kf kg kh ki kj kk kl km kn ko kp kq hm dt translated">7.输入备份文件名。</p><p id="8f3d" class="pw-post-body-paragraph jv jw ht jx b jy jz iu ka kb kc ix kd ke kf kg kh ki kj kk kl km kn ko kp kq hm dt translated">以下截图供参考:</p><figure class="jk jl jm jn fq jo fe ff paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="fe ff mk"><img src="../Images/2b0309ce02f85b5a463cf05bcf53eb23.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NvBcaCnJR0scFzxT2dQtUw.png"/></div></div><figcaption class="md me fg fe ff mf mg bd b be z ek"><em class="ji">Back Up Database window</em></figcaption></figure><h1 id="d908" class="kr ks ht bd kt ku kv kw kx ky kz la lb iz lc ja ld jc le jd lf jf lg jg lh li dt translated"><strong class="ak">展望更安全的未来</strong></h1><p id="aa95" class="pw-post-body-paragraph jv jw ht jx b jy lj iu ka kb lk ix kd ke ll kg kh ki lm kk kl km ln ko kp kq hm dt translated">本文中介绍的每种备份类型都使用不同的方法，并且各有优缺点。下表总结了这些问题:</p><figure class="jk jl jm jn fq jo fe ff paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="fe ff mq"><img src="../Images/1e64b6c86fa49a2151c5067d2fe7cc5d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Ui2F1uTAASx48rSLeAvXPQ.png"/></div></div></figure><p id="b08e" class="pw-post-body-paragraph jv jw ht jx b jy jz iu ka kb kc ix kd ke kf kg kh ki kj kk kl km kn ko kp kq hm dt translated">考虑到选择一种备份方法与另一种备份方法之间的权衡，有时很难知道使用哪种备份类型以及何时使用。加深对不同备份类型的理解有助于确定哪种备份解决方案最适合哪种数据存储情况。</p><p id="ce3f" class="pw-post-body-paragraph jv jw ht jx b jy jz iu ka kb kc ix kd ke kf kg kh ki kj kk kl km kn ko kp kq hm dt">(Original article by Wang Jianming汪建明)</p></div><div class="ab cl mr ms hb mt" role="separator"><span class="mu bw bk mv mw mx"/><span class="mu bw bk mv mw mx"/><span class="mu bw bk mv mw"/></div><div class="hm hn ho hp hq"><h1 id="3ee1" class="kr ks ht bd kt ku my kw kx ky mz la lb iz na ja ld jc nb jd lf jf nc jg lh li dt translated">阿里巴巴科技</h1><p id="01dc" class="pw-post-body-paragraph jv jw ht jx b jy lj iu ka kb lk ix kd ke ll kg kh ki lm kk kl km ln ko kp kq hm dt translated">关于阿里巴巴最新技术的第一手深度资讯→在<strong class="jx hu">脸书</strong>上搜索<a class="ae mh" href="http://www.facebook.com/AlibabaTechnology" rel="noopener ugc nofollow" target="_blank"> <strong class="jx hu">【阿里巴巴科技】</strong> </a></p></div></div>    
</body>
</html>