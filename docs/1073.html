<html>
<head>
<title>The Lightning Network: How to install and (hopefully) make money</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">闪电网络:如何安装和(希望)赚钱</h1>
<blockquote>原文：<a href="https://medium.com/coinmonks/the-lightning-network-how-to-install-and-hopefully-make-money-6e3058e3fa7c?source=collection_archive---------0-----------------------#2018-07-18">https://medium.com/coinmonks/the-lightning-network-how-to-install-and-hopefully-make-money-6e3058e3fa7c?source=collection_archive---------0-----------------------#2018-07-18</a></blockquote><div><div class="ef hh hi hj hk hl"/><div class="hm hn ho hp hq"><div class=""/><p id="bb16" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated"><em class="jo">注:本文档写于2018年7月。闪电是一种新技术，进步很快。如果您发现任何过时的信息或遗漏，请留下评论。</em></p><figure class="jq jr js jt fq ju fe ff paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="fe ff jp"><img src="../Images/944ecf57764581d5d30833a742e2b85b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QHJ5kR9jrQBjO_FHwL59ww.jpeg"/></div></div></figure><p id="3e87" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">闪电是一种有趣的新技术，它承诺以比特币闻所未闻的规模(闪电般)快速交易。现在闪电在比特币主网上直播，它也是一个潜在的赚钱者<a class="ae kb" href="https://www.marc.cn/2018/06/the-lightning-network-a-huge-opportunity-to-learn-and-earn-money.html" rel="noopener ugc nofollow" target="_blank"/>。</p><p id="16b1" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">不幸的是，我还发现Lightning极难安装，我已经浪费了很多时间来设置一个节点。我正在分享我的经历，所以希望其他人也能有更顺利的经历。</p><blockquote class="kc kd ke"><p id="704c" class="iq ir jo is b it iu iv iw ix iy iz ja kf jc jd je kg jg jh ji kh jk jl jm jn hm dt translated">这篇博客文章只描述了安装过程，并假设读者精通设置服务器。要了解更多关于闪电本身的信息，请查阅<a class="ae kb" href="https://lightning.network/lightning-network-paper.pdf" rel="noopener ugc nofollow" target="_blank">优秀白皮书</a>。要了解更多关于闪电背后的经济学，请看<a class="ae kb" rel="noopener" href="/social-evolution/the-economics-of-lightning-network-fees-76f0926da82">闪电网络费用的经济学</a>。LnRoute 列出了许多有用的资源。</p><p id="4a0e" class="iq ir jo is b it iu iv iw ix iy iz ja kf jc jd je kg jg jh ji kh jk jl jm jn hm dt translated">警告:闪电不适合胆小的人。有已知和未知的问题。钱包的私钥将存储在Lightning节点上，该节点必须全天候在线才能路由交易。和往常一样，不要尝试比你准备好的更多的btc。(或者在Testnet上实验。但是这有什么意思呢？).</p></blockquote><figure class="jq jr js jt fq ju"><div class="bz el l di"><div class="ki kj l"/></div></figure><h1 id="e5bf" class="kk kl ht bd km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh dt translated">先决条件</h1><p id="6931" class="pw-post-body-paragraph iq ir ht is b it li iv iw ix lj iz ja jb lk jd je jf ll jh ji jj lm jl jm jn hm dt translated">在虚拟专用服务器(VPS)上的云中，或者在您自己的硬件上。本教程展示了如何在数字海洋VPS上安装Lightning。我正在考虑在一个<a class="ae kb" href="https://www.amazon.com/gp/product/B074VF54LN" rel="noopener ugc nofollow" target="_blank"> ODROID-HC1 </a>上安装并记录Lightning(如果你感兴趣，请留下评论)。</p><blockquote class="kc kd ke"><p id="85dc" class="iq ir jo is b it iu iv iw ix iy iz ja kf jc jd je kg jg jh ji kh jk jl jm jn hm dt translated">本教程假设您正在使用Mac连接到VPS。使用Linux或Windows应该不会有太大的不同。</p><p id="2289" class="iq ir jo is b it iu iv iw ix iy iz ja kf jc jd je kg jg jh ji kh jk jl jm jn hm dt translated">您的Lightning节点必须始终在线才能转发付款。</p></blockquote><blockquote class="ln"><p id="757d" class="lo lp ht bd lq lr ls lt lu lv lw jn ek translated">如果你想轻松运行闪电网络节点，请查看这些<a class="ae kb" href="https://blog.coincodecap.com/bitcoin-node-solutions/" rel="noopener ugc nofollow" target="_blank">闪电网络和比特币节点提供商</a>。</p></blockquote><h1 id="6611" class="kk kl ht bd km kn ko kp kq kr ks kt ku kv lx kx ky kz ly lb lc ld lz lf lg lh dt translated">建立数字海洋</h1><p id="998a" class="pw-post-body-paragraph iq ir ht is b it li iv iw ix lj iz ja jb lk jd je jf ll jh ji jj lm jl jm jn hm dt translated">在数字海洋上设置VPS大约需要30分钟。</p><ol class=""><li id="04ed" class="ma mb ht is b it iu ix iy jb mc jf md jj me jn mf mg mh mi dt translated">创建一个帐户</li><li id="a41b" class="ma mb ht is b it mj ix mk jb ml jf mm jj mn jn mf mg mh mi dt translated">创建新的droplet</li><li id="802b" class="ma mb ht is b it mj ix mk jb ml jf mm jj mn jn mf mg mh mi dt translated">创建SSH密钥对</li><li id="61d7" class="ma mb ht is b it mj ix mk jb ml jf mm jj mn jn mf mg mh mi dt translated">登录</li></ol><p id="42c3" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">使用以下推荐链接<a class="ae kb" href="https://m.do.co/c/b33858702e30" rel="noopener ugc nofollow" target="_blank">在数字海洋上创建一个帐户，并获得10美元</a>(我将获得25美元)。</p><p id="11cb" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">创建新的droplet</p><figure class="jq jr js jt fq ju fe ff paragraph-image"><div class="fe ff mo"><img src="../Images/37048af2ec87c230761c39c60a6ad24c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1256/format:webp/1*7PamlD_21AxsPjkpmMdlsA.png"/></div></figure><p id="5b75" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">在<code class="eh mp mq mr ms b">Create Droplet</code>页面，选择一键应用选项卡和<code class="eh mp mq mr ms b">Docker</code>选项，在同一页面选择320GB选项。</p><figure class="jq jr js jt fq ju fe ff paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="fe ff mt"><img src="../Images/a02240dc1b48546a25ec5eda9e224668.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4hHhSlDjz59Ln82a0HBE_A.png"/></div></div></figure><figure class="jq jr js jt fq ju fe ff paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="fe ff mu"><img src="../Images/18a550ab4591d929ccfe7fb6119d14e6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3oLzYKP_lRScJ_0erfwGbQ.png"/></div></div></figure><p id="60e7" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">接下来，我们将通过在终端中输入以下命令来创建一个新的SSH密钥对:</p><pre class="jq jr js jt fq mv ms mw mx aw my dt"><span id="a03e" class="mz kl ht ms b fv na nb l nc nd"># 1. Create SSH key pair. "lightning" will be the filename<br/>#    Enter a passphrase to secure the file<br/>$ <strong class="ms hu">ssh-keygen -f ~/.ssh/lightning -t rsa -b 4096<br/></strong></span><span id="6cbe" class="mz kl ht ms b fv ne nb l nc nd"># 2. Backup lightning and lightning.pub files<strong class="ms hu"><br/></strong>$<strong class="ms hu"> cd ~/.ssh<br/></strong>$ (Make a safe backup)<strong class="ms hu"> </strong></span><span id="97ba" class="mz kl ht ms b fv ne nb l nc nd"># 3. Copy the public key to the clipboard<br/>$ <strong class="ms hu">pbcopy &lt; ~/.ssh/lightning.pub</strong></span></pre><p id="90a1" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">回到浏览器，点击<code class="eh mp mq mr ms b">New SSH Key</code>按钮，将公钥(在上面的步骤3中复制到剪贴板)粘贴到文本框中，然后点击<code class="eh mp mq mr ms b">Create</code>按钮创建小程序。</p><figure class="jq jr js jt fq ju fe ff paragraph-image"><div class="fe ff nf"><img src="../Images/a7d2b6a101237a573aa1f08b6b9f8b8c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1012/format:webp/1*HDCkDBWk7mJ64qLvd2TWhQ.png"/></div></figure><p id="3f1a" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">一旦创建了水滴，复制水滴的<code class="eh mp mq mr ms b">ip-address</code>。</p><pre class="jq jr js jt fq mv ms mw mx aw my dt"><span id="af86" class="mz kl ht ms b fv na nb l nc nd"># Log in.<br/>$ <strong class="ms hu">ssh root@</strong>&lt;droplet's ip-address&gt;<strong class="ms hu"> -i ~/.ssh/lightning</strong></span></pre><h1 id="2c6d" class="kk kl ht bd km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh dt translated">安装bitcoind</h1><p id="799f" class="pw-post-body-paragraph iq ir ht is b it li iv iw ix lj iz ja jb lk jd je jf ll jh ji jj lm jl jm jn hm dt translated">Lightning需要一个本地运行的完整比特币节点(这将在未来随着<a class="ae kb" href="https://github.com/lightninglabs/neutrino" rel="noopener ugc nofollow" target="_blank">中微子光客户端</a>的出现而改变)。这一步将下载完整的比特币区块链，大约需要12到24小时才能完成。</p><p id="c30b" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">我按照道格·冯·科霍恩的<a class="ae kb" rel="noopener" href="/@dougvk/run-your-own-mainnet-lightning-node-2d2eab628a8b">闪电帖</a>中的步骤。</p><ol class=""><li id="22ac" class="ma mb ht is b it iu ix iy jb mc jf md jj me jn mf mg mh mi dt translated">确保登录到您的服务器。</li><li id="ecd3" class="ma mb ht is b it mj ix mk jb ml jf mm jj mn jn mf mg mh mi dt translated">安装Bitcoind Docker映像。</li><li id="2399" class="ma mb ht is b it mj ix mk jb ml jf mm jj mn jn mf mg mh mi dt translated">下载比特币区块链。</li><li id="c1de" class="ma mb ht is b it mj ix mk jb ml jf mm jj mn jn mf mg mh mi dt translated">创建一个方便的脚本，以便轻松访问bitcoind容器</li><li id="0991" class="ma mb ht is b it mj ix mk jb ml jf mm jj mn jn mf mg mh mi dt translated">正在下载区块链，请稍候。</li></ol><p id="1059" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">如果您尚未登录，请登录。</p><pre class="jq jr js jt fq mv ms mw mx aw my dt"><span id="8dd6" class="mz kl ht ms b fv na nb l nc nd"># Log in.<br/>$ <strong class="ms hu">ssh root@</strong>&lt;droplet's ip-address&gt;<strong class="ms hu"> -i ~/.ssh/lightning</strong></span></pre><p id="9b0a" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">使用dockerfile创建一个bitcoind Docker容器，Docker file(容易混淆)位于一个名为lightning-node的repo中。</p><p id="15f1" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">Bitcoind会将区块链和所有设置保存在磁盘上，而不是保存在容器本身中。这样，即使我们用更新的版本替换bitcoind容器，所有数据都将持久化。</p><pre class="jq jr js jt fq mv ms mw mx aw my dt"><span id="e87c" class="mz kl ht ms b fv na nb l nc nd"># 1. Clone the bitcoind repo. (don't let the lightning <br/>#    node project name fool you, this will install bitcoind)<br/>$ <strong class="ms hu">git clone https://github.com/dougvk/lightning-node.git</strong></span><span id="9f2a" class="mz kl ht ms b fv ne nb l nc nd"># 2. Build the bitcoind Docker container.<br/>$ <strong class="ms hu">cd lightning-node</strong><br/>$ <strong class="ms hu">docker build . -t dougvk/bitcoind</strong></span><span id="3702" class="mz kl ht ms b fv ne nb l nc nd"># 3. Create a working directory outside of the Docker image,<br/>#    so the working directory won't be overwritten when you <br/>#    update the Docker image with a new bitcoind version.<br/>$ <strong class="ms hu">mkdir -p /scratch/bitcoin/mainnet/bitcoind</strong></span><span id="3945" class="mz kl ht ms b fv ne nb l nc nd"># 4. Run bitcoind and start downloading the blockchain.<br/>$ <strong class="ms hu">docker run --name bitcoind -d -v /scratch/bitcoin/mainnet/bitcoind:/data -p 8333:8333 -p 9735:9735 dougvk/bitcoind:latest</strong></span></pre><p id="2b08" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">添加一个方便的脚本来访问bitcoind容器:</p><pre class="jq jr js jt fq mv ms mw mx aw my dt"><span id="fe0e" class="mz kl ht ms b fv na nb l nc nd"># 1. Create script.<br/>$ <strong class="ms hu">touch /bin/bitcoin-cli</strong></span><span id="3cfb" class="mz kl ht ms b fv ne nb l nc nd"># 2. Make script executable.<br/>$ <strong class="ms hu">chmod +x /bin/bitcoin-cli</strong></span><span id="5baf" class="mz kl ht ms b fv ne nb l nc nd"># 3. Edit script (See below).<br/>$ <strong class="ms hu">nano /bin/bitcoin-cli</strong></span><span id="80b5" class="mz kl ht ms b fv ne nb l nc nd"># 4. Confirm script is working. This command shows the wallet info.<br/>$ <strong class="ms hu">bitcoin-cli getwalletinfo</strong></span></pre><p id="1a85" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">在Nano(上面的步骤3)中，编辑比特币cli脚本，如下所示:</p><pre class="jq jr js jt fq mv ms mw mx aw my dt"><span id="8846" class="mz kl ht ms b fv na nb l nc nd"><strong class="ms hu">#!/usr/bin/env bash<br/>docker run --rm --network container:bitcoind -v /scratch/bitcoin/mainnet/bitcoind:/data dougvk/bitcoind:latest bitcoin-cli "$@"</strong></span></pre><p id="8c52" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">在撰写本文时，比特币区块链的大小为175GB。区块链下载应该已经在进行中，最多需要24小时才能完成。在区块链下载过程中休息一下，打个盹或度个短假。</p><p id="0a79" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">通过输入以下命令检查下载的状态。下载完成后，最新下载的块应该是今天的日期。</p><pre class="jq jr js jt fq mv ms mw mx aw my dt"><span id="2e92" class="mz kl ht ms b fv na nb l nc nd"># Check the blockchain download progress.<br/>$ <strong class="ms hu">docker logs bitcoind --tail "10"</strong></span></pre><h1 id="1bad" class="kk kl ht bd km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh dt translated">安装C型闪电</h1><p id="395f" class="pw-post-body-paragraph iq ir ht is b it li iv iw ix lj iz ja jb lk jd je jf ll jh ji jj lm jl jm jn hm dt translated">接下来，安装Lightning客户端。Lightning实现有多种，比如<a class="ae kb" href="https://github.com/ElementsProject/lightning" rel="noopener ugc nofollow" target="_blank"> C-Lightning </a>和<a class="ae kb" href="https://github.com/lightningnetwork/lnd" rel="noopener ugc nofollow" target="_blank"> lnd </a>。您使用哪种实现并不重要，因为所有实现都应该是可互操作的。</p><p id="0f8d" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">我发现这一步比我想象的要复杂，并且浪费时间尝试使用lnd实现。最后我放弃了lnd，转投C-Lightning。(由于软件和文档几乎每天都在更新，所以当你读到这篇文章时，lnd完全有可能更容易安装。)安装C-Lightning大约需要30分钟。</p><ol class=""><li id="8f50" class="ma mb ht is b it iu ix iy jb mc jf md jj me jn mf mg mh mi dt translated">确保登录到您的服务器。</li><li id="d0ee" class="ma mb ht is b it mj ix mk jb ml jf mm jj mn jn mf mg mh mi dt translated">创建C-Lightning docker映像并同步Lightning网络。</li><li id="5b01" class="ma mb ht is b it mj ix mk jb ml jf mm jj mn jn mf mg mh mi dt translated">创建一个方便的脚本，以便轻松访问bitcoind容器。</li><li id="8f78" class="ma mb ht is b it mj ix mk jb ml jf mm jj mn jn mf mg mh mi dt translated">设置名称和其他选项</li></ol><p id="6f9a" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">如果您尚未登录，请登录。</p><pre class="jq jr js jt fq mv ms mw mx aw my dt"><span id="032d" class="mz kl ht ms b fv na nb l nc nd"># Log in.<br/>$ <strong class="ms hu">ssh root@</strong>&lt;droplet's ip-address&gt;<strong class="ms hu"> -i ~/.ssh/lightning</strong></span></pre><p id="b822" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">在磁盘上创建lightning docker映像和一个暂存目录，这样即使我们替换了lightning docker容器，数据也会持续存在。</p><pre class="jq jr js jt fq mv ms mw mx aw my dt"><span id="483b" class="mz kl ht ms b fv na nb l nc nd"># 1. Create a working directory outside of the Docker image,<br/>#    so the working directory won't be overwritten when you <br/>#    update the Docker image with a newer C Lightning version.<br/>$ <strong class="ms hu">mkdir -p /scratch/bitcoin/mainnet/clightning</strong></span><span id="2a28" class="mz kl ht ms b fv ne nb l nc nd"># 2. Create the Lighting docker image.<br/>$ <strong class="ms hu">docker run --rm --name lightning --network container:bitcoind -v /scratch/bitcoin/mainnet/bitcoind:/root/.bitcoin -v /scratch/bitcoin/mainnet/clightning:/root/.lightning --entrypoint /usr/bin/lightningd elementsproject/lightningd --network=bitcoin --log-level=debug</strong></span></pre><p id="f2a6" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">Lightning节点现在应该正在下载Lightning网络，这大概需要10分钟。</p><p id="a051" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">由于最后一个命令没有返回到命令提示符，请打开一个新的终端窗口或标签，然后再次登录。</p><pre class="jq jr js jt fq mv ms mw mx aw my dt"><span id="356d" class="mz kl ht ms b fv na nb l nc nd"># Log in.<br/>$ <strong class="ms hu">ssh root@</strong>&lt;droplet's ip-address&gt;<strong class="ms hu"> -i ~/.ssh/&lt;filename&gt;</strong></span></pre><p id="e97b" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">接下来，我们将创建一个方便的脚本来访问Lightning客户端。</p><pre class="jq jr js jt fq mv ms mw mx aw my dt"><span id="3c3a" class="mz kl ht ms b fv na nb l nc nd"># 1. Create script.<br/>$ <strong class="ms hu">touch /bin/lightning-cli</strong></span><span id="5bfd" class="mz kl ht ms b fv ne nb l nc nd"># 2. Make script executable.<br/>$ <strong class="ms hu">chmod +x /bin/lightning-cli</strong></span><span id="a3f0" class="mz kl ht ms b fv ne nb l nc nd"># 3. Edit script (See below).<br/>$ <strong class="ms hu">nano /bin/lightning-cli</strong></span><span id="8ed5" class="mz kl ht ms b fv ne nb l nc nd"># 4. Confirm script is working. <br/>$ <strong class="ms hu">lightning-cli getinfo</strong></span></pre><p id="6c32" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">在Nano中(上面的步骤3)，按如下方式编辑lightning-cli脚本:</p><pre class="jq jr js jt fq mv ms mw mx aw my dt"><span id="d58e" class="mz kl ht ms b fv na nb l nc nd"><strong class="ms hu">#!/usr/bin/env bash<br/>docker run --rm -v /scratch/bitcoin/mainnet/clightning:/root/.lightning --entrypoint /usr/bin/lightning-cli </strong><strong class="ms hu">elementsproject/lightningd</strong><strong class="ms hu"> "$@"</strong></span></pre><p id="176e" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">我还没有找到所有配置文件选项的完整文档。如果你找到了，请留下评论。一个基本的配置文件设置Lightning节点的名称和该名称在Lightning explorers中显示的颜色，例如<a class="ae kb" href="https://lnmainnet.gaben.win" rel="noopener ugc nofollow" target="_blank">recks proler</a>。</p><pre class="jq jr js jt fq mv ms mw mx aw my dt"><span id="c170" class="mz kl ht ms b fv na nb l nc nd"># 1. Create config file<br/>$ <strong class="ms hu">touch /scratch/bitcoin/mainnet/clightning/config</strong></span><span id="c668" class="mz kl ht ms b fv ne nb l nc nd"># 2. Edit and save config file (see below)<br/>$ <strong class="ms hu">nano /scratch/bitcoin/mainnet/clightning/config</strong></span></pre><p id="759c" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">我的配置文件如下。我将我的节点命名为<a class="ae kb" href="https://1ml.com/node/02060d0c8577cfc2a1962220a1cde4f623ca55ef80bd25e4be5a8b15fed78b11a3" rel="noopener ugc nofollow" target="_blank"> Punchbeef </a> ✅(是的，<a class="ae kb" href="http://mst3k.wikia.com/wiki/The_Nine_Billion_Names_of_David_Ryder" rel="noopener ugc nofollow" target="_blank">一个神秘科学剧场3000 </a>参考)，并将其颜色设置为橙色。这种颜色被各种<a class="ae kb" href="https://lnmainnet.gaben.win" rel="noopener ugc nofollow" target="_blank">闪电探索者</a>使用，并提供了一种脱颖而出的方式。你显然想改变别名和颜色(除非你喜欢橙色)。为了保证更稳定的通道，FirstBlock的李畅建议在配置文件中添加<code class="eh mp mq mr ms b">bind-addr</code>和<code class="eh mp mq mr ms b">announce-addr</code>。然而，<code class="eh mp mq mr ms b">bind-addr</code>似乎并没有起到预期的作用。</p><pre class="jq jr js jt fq mv ms mw mx aw my dt"><span id="d51a" class="mz kl ht ms b fv na nb l nc nd"><strong class="ms hu">alias=Punchbeef✅           </strong># Change the alias, obviously<strong class="ms hu"><br/>rgb=FF4500       <br/></strong>#bind-addr=0.0.0.0:9735<strong class="ms hu">     </strong>This doesn't seem to work yet<br/><strong class="ms hu">announce-addr=</strong>&lt;droplet's ip-address&gt;<strong class="ms hu">:9735</strong></span></pre><p id="eb7a" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">重启Lightning节点以更新更改。</p><pre class="jq jr js jt fq mv ms mw mx aw my dt"><span id="cda7" class="mz kl ht ms b fv na nb l nc nd"># 1. Stop the Lightning node<br/>$ <strong class="ms hu">lightning-cli stop</strong></span><span id="7f80" class="mz kl ht ms b fv ne nb l nc nd"># 2. Start the Lightning node<br/>#    Note: this creates a new container. How do we restart <br/>#    the existing one? Any Docker experts here?<br/>$ <strong class="ms hu">docker run --rm --name lightning --network container:bitcoind_mainnet -v /scratch/bitcoin/mainnet/bitcoind:/root/.bitcoin -v /scratch/bitcoin/mainnet/clightning:/root/.lightning --entrypoint /usr/bin/lightningd elementsproject/lightningd --network=bitcoin --log-level=debug</strong></span></pre><p id="ca2d" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">我们现在有了一个运行在mainnet上的全功能闪电节点。</p><blockquote class="kc kd ke"><p id="37ce" class="iq ir jo is b it iu iv iw ix iy iz ja kf jc jd je kg jg jh ji kh jk jl jm jn hm dt translated">注意:如果您更喜欢使用lnd而不是C-Lightning，在mainnet上安装lnd的未记录命令如下。为了获得支撑，检查它们的活动松弛度。</p></blockquote><pre class="jq jr js jt fq mv ms mw mx aw my dt"><span id="d12c" class="mz kl ht ms b fv na nb l nc nd"># Don't use unless you want to install LND, instead of C-Lightning!</span><span id="1cc2" class="mz kl ht ms b fv ne nb l nc nd">$ docker create --name=lnd lightninglabs/lnd --bitcoin.active --bitcoin.mainnet</span></pre><h1 id="135a" class="kk kl ht bd km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh dt translated">设定费用</h1><p id="e0c4" class="pw-post-body-paragraph iq ir ht is b it li iv iw ix lj iz ja jb lk jd je jf ll jh ji jj lm jl jm jn hm dt translated">在闪电网上赚钱的方法就是通过你的节点转发其他节点的交易。发送节点将根据节点设置的费用选择最佳路径。因此，我们希望将费用定在一个足够低的价格，这样流量就会通过我们的节点，但又足够高，可以盈利。至少理论上是这样。</p><p id="bce5" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">我期待能够设置费用，以优化更多的流量。不幸的是，我还没有找到这样做的方法，目前我使用默认设置。如果有人知道解决办法或者有建议，请留言评论。</p><h1 id="0f95" class="kk kl ht bd km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh dt translated">连接到节点并创建通道</h1><p id="e182" class="pw-post-body-paragraph iq ir ht is b it li iv iw ix lj iz ja jb lk jd je jf ll jh ji jj lm jl jm jn hm dt translated"><em class="jo">注:如果你不熟悉闪电通道的概念，请参见《闪电白皮书》原文</em><a class="ae kb" href="https://lightning.network/lightning-network-paper.pdf" rel="noopener ugc nofollow" target="_blank"><em class="jo"/></a><em class="jo">或</em><a class="ae kb" href="https://bitcoinmagazine.com/articles/understanding-the-lightning-network-part-building-a-bidirectional-payment-channel-1464710791/" rel="noopener ugc nofollow" target="_blank"><em class="jo"/></a><em class="jo">。</em></p><p id="c34f" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">资助渠道是一个两步流程:首先将btc从当前钱包发送到节点的钱包，然后从节点的钱包向渠道提供btc。创建和资助渠道大约需要两个小时，包括以下步骤:</p><ol class=""><li id="b994" class="ma mb ht is b it iu ix iy jb mc jf md jj me jn mf mg mh mi dt translated">为节点的钱包创建一个比特币地址。</li><li id="03ae" class="ma mb ht is b it mj ix mk jb ml jf mm jj mn jn mf mg mh mi dt translated">将btc发送到步骤1中创建的地址，并等待六次确认。</li><li id="08b1" class="ma mb ht is b it mj ix mk jb ml jf mm jj mn jn mf mg mh mi dt translated">连接到你选择的任何闪电节点来创建一个通道。</li><li id="b750" class="ma mb ht is b it mj ix mk jb ml jf mm jj mn jn mf mg mh mi dt translated">从第2步开始用btc为渠道注资，并等待六次确认。</li></ol><p id="0415" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">与任何其他比特币钱包一样，你可以为一个钱包创建多个地址。给闪电钱包发少量btc，像这样:</p><pre class="jq jr js jt fq mv ms mw mx aw my dt"><span id="61bb" class="mz kl ht ms b fv na nb l nc nd"># 1. Create new address. <br/>$ <strong class="ms hu">lightning-cli newaddr</strong></span><span id="021e" class="mz kl ht ms b fv ne nb l nc nd"># 2. Send btc to the address generated above and wait for six <br/>#    confirmations. Check status at: <br/>#    <a class="ae kb" href="https://www.blockchain.com/btc/tx/" rel="noopener ugc nofollow" target="_blank">https://www.blockchain.com/btc/tx/</a></span><span id="dddc" class="mz kl ht ms b fv ne nb l nc nd"># 3. Confirm the funds have been received.<br/>$ <strong class="ms hu">lightning-cli listfunds</strong></span></pre><p id="f639" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">需要时，使用dev-listaddrs命令列出您的Lightning wallet的所有地址:</p><pre class="jq jr js jt fq mv ms mw mx aw my dt"><span id="b1ef" class="mz kl ht ms b fv na nb l nc nd"># List all addresses of your Lightning wallet.<br/>$ <strong class="ms hu">lightning-cli dev-listaddrs</strong></span></pre><p id="0f1d" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">接下来，连接到一个或多个其他Lightning节点。</p><pre class="jq jr js jt fq mv ms mw mx aw my dt"><span id="9a4c" class="mz kl ht ms b fv na nb l nc nd"># 1. Connect to another Lightning node. The parameters are <br/>#    the Lightning id, and optional ip-address and port.<br/>#    The command below connects to the author's Punchbeef✅ node.<br/>$ <strong class="ms hu">lightning-cli connect </strong><strong class="ms hu">02060d0c8577cfc2a1962220a1cde4f623ca55ef80bd25e4be5a8b15fed78b11a3@178.62.237.239</strong></span><span id="ef0f" class="mz kl ht ms b fv ne nb l nc nd"># 2. Confirm your node is connected to the node in step 4, and <br/>#    the state is "GOSSIPING".<br/>$ <strong class="ms hu">lightning-cli listpeers</strong></span></pre><blockquote class="kc kd ke"><p id="ba81" class="iq ir jo is b it iu iv iw ix iy iz ja kf jc jd je kg jg jh ji kh jk jl jm jn hm dt translated">寻找要连接的节点？<a class="ae kb" href="https://lnmainnet.gaben.win" rel="noopener ugc nofollow" target="_blank"> Recksplorer </a>是一个实时的闪电网络地图，可以用来找到你可能想要连接的其他节点。其他伟大的资源是<a class="ae kb" href="http://lightningnetworkstores.com" rel="noopener ugc nofollow" target="_blank">闪电网络商店</a>列表，和<a class="ae kb" href="https://mainnet.yalls.org/nodes/" rel="noopener ugc nofollow" target="_blank">Y’alls列表</a>。1ml根据btc 和具有最多通道的<a class="ae kb" href="https://1ml.com/node?order=mostchannels" rel="noopener ugc nofollow" target="_blank">节点维护一个</a><a class="ae kb" href="https://1ml.com/node?order=capacity&amp;onlypublic=true" rel="noopener ugc nofollow" target="_blank">最大节点的列表。</a></p></blockquote><p id="0f96" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">我用318 kSatoshi(大约。20美元)。一些主机要求更高的最低限额，我也遵从了。我还检查了商家出售的商品的价格，并确保该频道有足够的satoshi来购买商店中至少较便宜的商品。</p><blockquote class="kc kd ke"><p id="a197" class="iq ir jo is b it iu iv iw ix iy iz ja kf jc jd je kg jg jh ji kh jk jl jm jn hm dt translated">为渠道提供资金是一个链上事件，需要得到确认。</p></blockquote><pre class="jq jr js jt fq mv ms mw mx aw my dt"><span id="a31b" class="mz kl ht ms b fv na nb l nc nd"># 1. If needed, list connections. Unfunded channels will have <br/>#    state set to 'GOSSIPING'<br/>$ <strong class="ms hu">lightning-cli listpeers</strong></span><span id="6ef8" class="mz kl ht ms b fv ne nb l nc nd"># 2. Fund the channel to peer ID 02060... belonging to Punchbeef✅<br/>#    with 400 kSat<!-- -->.<br/>$ <strong class="ms hu">lightning-cli fundchannel </strong><strong class="ms hu">02060d0c8577cfc2a1962220a1cde4f623ca55ef80bd25e4be5a8b15fed78b11a3</strong> <strong class="ms hu">400000</strong></span></pre><p id="b75b" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">然后嘣。我们在直播。</p><figure class="jq jr js jt fq ju"><div class="bz el l di"><div class="ni kj l"/></div></figure><h2 id="f5f7" class="mz kl ht bd km nj nk nl kq nm nn no ku jb np nq ky jf nr ns lc jj nt nu lg nv dt translated">支付</h2><p id="e0b9" class="pw-post-body-paragraph iq ir ht is b it li iv iw ix lj iz ja jb lk jd je jf ll jh ji jj lm jl jm jn hm dt translated">为了测试闪电支付，你可以在不同的商家购买贴纸或t恤，但你也可以从Y'alls node购买一个约4.62美元的入站频道。为什么不呢？浏览至Y’alls网站的<a class="ae kb" href="https://mainnet.yalls.org/about/" rel="noopener ugc nofollow" target="_blank">关于页面，并遵循以下步骤。</a></p><figure class="jq jr js jt fq ju fe ff paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="fe ff nw"><img src="../Images/0787e29df391a283da5b3f0ac4948839.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZlEAALXScCyuJbTDR6lIMg.png"/></div></div></figure></div><div class="ab cl nx ny hb nz" role="separator"><span class="oa bw bk ob oc od"/><span class="oa bw bk ob oc od"/><span class="oa bw bk ob oc"/></div><div class="hm hn ho hp hq"><pre class="jq jr js jt fq mv ms mw mx aw my dt"><span id="7a34" class="mz kl ht ms b fv na nb l nc nd"># 1. Connect to the Y'alls node<br/>$ <strong class="ms hu">lightning-cli connect 03e50492eab4107a773141bb419e107bda3de3d55652e6e1a41225f06a0bbf2d56@mainnet-lnd.yalls.org</strong></span><span id="c48d" class="mz kl ht ms b fv ne nb l nc nd"># 2. Fund outbound channel with 1 mSat and wait for confirmation<br/>$ <strong class="ms hu">lightning-cli fundchannel 03e50492eab4107a773141bb419e107bda3de3d55652e6e1a41225f06a0bbf2d56 1000000</strong></span><span id="493c" class="mz kl ht ms b fv ne nb l nc nd"># 3. Confirm the channel state is CHANNELD_NORMAL<br/>$ <strong class="ms hu">lightning-cli listpeers 03e50492eab4107a773141bb419e107bda3de3d55652e6e1a41225f06a0bbf2d56</strong></span><span id="25bd" class="mz kl ht ms b fv ne nb l nc nd"># 4. Browse to <a class="ae kb" href="https://mainnet.yalls.org/about/" rel="noopener ugc nofollow" target="_blank">https://mainnet.yalls.org/about/</a>, locate the 'Join<br/>#    the Y'alls Community' box and select your node from the <br/>#    dropdown list and click 'Attempt Channel Open'.</span><span id="ce63" class="mz kl ht ms b fv ne nb l nc nd"># 5. Copy the invoice starting with "lnbc" from the bottom box</span><span id="33c4" class="mz kl ht ms b fv ne nb l nc nd"># 6. Pay Y'alls node to create inbound channel using the invoice <br/>#    copied in step 5.<br/>$ <strong class="ms hu">lightning-cli pay </strong>&lt;lnbc...&gt;</span></pre><h1 id="b043" class="kk kl ht bd km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh dt translated">关闭渠道，回笼资金</h1><p id="f709" class="pw-post-body-paragraph iq ir ht is b it li iv iw ix lj iz ja jb lk jd je jf ll jh ji jj lm jl jm jn hm dt translated">要将btc从一个通道撤回到节点的钱包中，您需要关闭该通道。这一步大约需要一个小时。</p><ol class=""><li id="6466" class="ma mb ht is b it iu ix iy jb mc jf md jj me jn mf mg mh mi dt translated">找到您想要关闭的频道的id</li><li id="bd28" class="ma mb ht is b it mj ix mk jb ml jf mm jj mn jn mf mg mh mi dt translated">关闭频道</li><li id="1e5c" class="ma mb ht is b it mj ix mk jb ml jf mm jj mn jn mf mg mh mi dt translated">利润！</li></ol><blockquote class="kc kd ke"><p id="1ce3" class="iq ir jo is b it iu iv iw ix iy iz ja kf jc jd je kg jg jh ji kh jk jl jm jn hm dt translated">就像资助一个渠道一样，关闭一个渠道也是一个连锁事件，需要得到确认。</p></blockquote><pre class="jq jr js jt fq mv ms mw mx aw my dt"><span id="7039" class="mz kl ht ms b fv na nb l nc nd"># 1. Show funded channels to look up channel id.<br/>$ <strong class="ms hu">lightning-cli listfunds</strong></span><span id="458b" class="mz kl ht ms b fv ne nb l nc nd"># 2. Close channel. Command should return a txid, which is<br/>#    verifiable on <a class="ae kb" href="https://www.blockchain.com/btc/tx/" rel="noopener ugc nofollow" target="_blank">https://www.blockchain.com/btc/tx/</a><br/>$ <strong class="ms hu">lightning-cli close xxxxx:xxx:x</strong></span><span id="8eff" class="mz kl ht ms b fv ne nb l nc nd"># 3. After about one hour, the channel should be removed <br/>#    from the list, and a utxo should be added to the utxo list.<br/>#    You may need to rescan the outputs to see the latest updates.<br/>$ <strong class="ms hu">lightning-cli dev-rescan-outputs</strong><br/>$ <strong class="ms hu">lightning-cli listfunds</strong></span></pre><h1 id="183d" class="kk kl ht bd km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh dt translated">备份</h1><p id="5193" class="pw-post-body-paragraph iq ir ht is b it li iv iw ix lj iz ja jb lk jd je jf ll jh ji jj lm jl jm jn hm dt translated">由于真实btc存储在您的节点上，您肯定希望有一个备份，以防万一。然而，备份Lightning并不简单。</p><p id="af00" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">我的第一反应是备份通道本身的状态。但事实证明这是一个坏主意，据Github杂志报道，这可能是关于闪电备份的最佳资源。</p><p id="2d6f" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">要理解为什么你应该<em class="jo">永远不要</em>备份通道状态，你必须理解闪电协议是如何惩罚不诚实的节点的。一种攻击媒介是传播通道的旧状态，这正是备份通道状态时可能发生的情况。对传播旧状态的惩罚是由对等体没收通道中的所有资金。换句话说:如果你试图备份和恢复一个渠道状态，你就有失去所有渠道资金的风险。</p><blockquote class="kc kd ke"><p id="c4b9" class="iq ir jo is b it iu iv iw ix iy iz ja kf jc jd je kg jg jh ji kh jk jl jm jn hm dt translated">通道状态保存在<code class="eh mp mq mr ms b">/scratch/bitcoin/mainnet/clightning/</code>目录下的<code class="eh mp mq mr ms b">lightning.sqlite3</code>文件中。千万不要备份<code class="eh mp mq mr ms b">lightning.sqlite3</code>文件。</p></blockquote><p id="3cd5" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">相反，在<code class="eh mp mq mr ms b">/scratch/bitcoin/mainnet/clightning/</code>目录中备份<code class="eh mp mq mr ms b">hsm_secret</code>文件。以下命令将<code class="eh mp mq mr ms b">hsm_secret</code>文件复制到您的本地主目录。</p><pre class="jq jr js jt fq mv ms mw mx aw my dt"><span id="9dde" class="mz kl ht ms b fv na nb l nc nd"># Run from your local computer. &lt;filename&gt; is the ssh file on <br/># your local drive, &lt;ip-address&gt; is your lightning<br/># server's IP address.</span><span id="6f17" class="mz kl ht ms b fv ne nb l nc nd">$ <strong class="ms hu">scp -i &lt;filename&gt; root@</strong>&lt;droplet's ip-address&gt;<strong class="ms hu">:/scratch/bitcoin/mainnet/clightning/hsm_secret ~</strong></span></pre><p id="0df6" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">收回资金的步骤是从上面提到的GitHub问题中复制的:在全新安装时复制<code class="eh mp mq mr ms b">hsm_secret</code>,用<code class="eh mp mq mr ms b">--port=0</code>选项启动lightningd。<em class="jo">不要连接或资助任何渠道</em>。运行lightning-cli newaddr几次，然后用<code class="eh mp mq mr ms b">lightningd stop</code>关闭lightning。使用<code class="eh mp mq mr ms b">--port=0</code>选项再次运行<code class="eh mp mq mr ms b">sqlite3 /scratch/bitcoin/mainnet/clightning/lightningd.sqlite3 "UPDATE vars SET val= 500000 WHERE name='last_processed_block';"</code>Run lightning。通过运行<code class="eh mp mq mr ms b">lightning-cli withdraw all</code>将链上资金恢复到您的个人钱包中。然后等待几个月，让同行关闭你的旧渠道。一旦所有通道关闭，用<code class="eh mp mq mr ms b">lightning-cli withdraw all</code>收回之前卡在通道中的资金。</p><p id="c913" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">由于您无法在不中断恢复过程的情况下创建或资助新的渠道，因此您需要设置第二台服务器来继续运行lightning node。</p><h1 id="b546" class="kk kl ht bd km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh dt translated">错误和解决方案</h1><p id="5997" class="pw-post-body-paragraph iq ir ht is b it li iv iw ix lj iz ja jb lk jd je jf ll jh ji jj lm jl jm jn hm dt translated">和任何技术一样，尤其是新技术，你会遇到错误。</p><h2 id="4dd7" class="mz kl ht bd km nj nk nl kq nm nn no ku jb np nq ky jf nr ns lc jj nt nu lg nv dt translated">不知道地址，放弃</h2><p id="9c57" class="pw-post-body-paragraph iq ir ht is b it li iv iw ix lj iz ja jb lk jd je jf ll jh ji jj lm jl jm jn hm dt translated">当lightning节点尚未完成同步时，尝试连接到节点会发生这种情况。请等待您的节点完全同步，然后重试。</p><h2 id="8f48" class="mz kl ht bd km nj nk nl kq nm nn no ku jb np nq ky jf nr ns lc jj nt nu lg nv dt translated">没有足够的资金打开渠道</h2><p id="0ecd" class="pw-post-body-paragraph iq ir ht is b it li iv iw ix lj iz ja jb lk jd je jf ll jh ji jj lm jl jm jn hm dt translated">在资助了几个渠道后，Lighting可能会抱怨没有足够的资金。我第一次遇到这个错误时，我以为我的钱丢了。原来资金还在，你要做的就是让C-Lightning重新扫描utxos:</p><pre class="jq jr js jt fq mv ms mw mx aw my dt"><span id="9f0d" class="mz kl ht ms b fv na nb l nc nd"># 1. Rescan outputs if funds are 'missing'<br/>$ <strong class="ms hu">lightning-cli dev-rescan-outputs</strong></span><span id="f014" class="mz kl ht ms b fv ne nb l nc nd"># 2. Confirm all bitcoins are still there.<br/>$ <strong class="ms hu">lightning-cli listfunds</strong></span></pre><h2 id="83d2" class="mz kl ht bd km nj nk nl kq nm nn no ku jb np nq ky jf nr ns lc jj nt nu lg nv dt translated">连接被拒绝</h2><p id="4eb0" class="pw-post-body-paragraph iq ir ht is b it li iv iw ix lj iz ja jb lk jd je jf ll jh ji jj lm jl jm jn hm dt translated">在尝试连接一些有很多通道的热门节点时，有时会遇到<code class="eh mp mq mr ms b">-1, Connection establishment: Connection refused</code>错误。我假设一个节点可以维护的通道数量是有限的，除了定期重试之外没有其他解决方案。</p><h2 id="969a" class="mz kl ht bd km nj nk nl kq nm nn no ku jb np nq ky jf nr ns lc jj nt nu lg nv dt translated">无法资助渠道</h2><p id="0b49" class="pw-post-body-paragraph iq ir ht is b it li iv iw ix lj iz ja jb lk jd je jf ll jh ji jj lm jl jm jn hm dt translated">有时，您能够连接到一个节点，但由于各种原因，无法为到该节点的通道提供资金。这些对等体将永远处于<code class="eh mp mq mr ms b">GOSSIPING</code>状态。要检查对等机是否处于<code class="eh mp mq mr ms b">GOSSIPING</code>状态，运行:</p><pre class="jq jr js jt fq mv ms mw mx aw my dt"><span id="e90c" class="mz kl ht ms b fv na nb l nc nd"># Outputs the nodes in Gossiping state<br/>$ <strong class="ms hu">lightning-cli listpeers | jq '.peers[] | select(.state == "GOSSIPING</strong><strong class="ms hu">") | .'</strong></span></pre><p id="913d" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">基金每个节点返回:</p><pre class="jq jr js jt fq mv ms mw mx aw my dt"><span id="84d4" class="mz kl ht ms b fv na nb l nc nd"># Fund channel<br/>$ <strong class="ms hu">lightning-cli fundchannel &lt;peer-id&gt; &lt;amount&gt;</strong></span></pre><h2 id="fde8" class="mz kl ht bd km nj nk nl kq nm nn no ku jb np nq ky jf nr ns lc jj nt nu lg nv dt translated">通道等待锁定和通道关闭</h2><p id="45b4" class="pw-post-body-paragraph iq ir ht is b it li iv iw ix lj iz ja jb lk jd je jf ll jh ji jj lm jl jm jn hm dt translated">我遇到了多个更严重的问题，渠道在融资几天后陷入停滞状态。所以资金被套牢了，渠道却没有活跃起来。频道要么等待锁定(<code class="eh mp mq mr ms b">Peer already CHANNELD_AWAITING_LOCKIN</code>)，要么处于永久关闭状态(<code class="eh mp mq mr ms b">Peer already CHANNELD_SHUTTING_DOWN</code>)，而不是预期的<code class="eh mp mq mr ms b">CHANNELD_NORMAL</code>。C-Lightning似乎还不能自动解决这些停滞状态，尽管<code class="eh mp mq mr ms b">listpeers</code>信息表明资金将在144次确认(相当于24小时)后自动返还。</p><pre class="jq jr js jt fq mv ms mw mx aw my dt"><span id="918c" class="mz kl ht ms b fv na nb l nc nd"># List all channels that were not opened correctly<br/>$ <strong class="ms hu">lightning-cli listpeers | jq '.peers[].channels[] | select(.state != "</strong><strong class="ms hu">CHANNELD_NORMAL") | .'</strong></span></pre><p id="76be" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">忽略状态为<code class="eh mp mq mr ms b">CHANNELD_AWAITING_LOCKIN:Funding needs more confirmations</code>的频道。</p><p id="7264" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">这个问题在<a class="ae kb" href="https://github.com/ElementsProject/lightning/issues/1246" rel="noopener ugc nofollow" target="_blank">GitHub问题</a>中讨论过，我目前仍在等待看它是否会最终解决，尽管这些频道已经在这些状态中停留了大约一周。</p><h1 id="87d1" class="kk kl ht bd km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh dt translated">谢谢</h1><p id="3519" class="pw-post-body-paragraph iq ir ht is b it li iv iw ix lj iz ja jb lk jd je jf ll jh ji jj lm jl jm jn hm dt translated">Firstblock Capital的李畅负责设置建议和配置文件提示，<a class="ng nh gr" href="https://medium.com/u/cb01d8f3cd55?source=post_page-----6e3058e3fa7c--------------------------------" rel="noopener" target="_blank">谢恩·维塔拉纳</a>负责校对。Doug von Kohorn 的<a class="ae kb" rel="noopener" href="/@dougvk/run-your-own-mainnet-lightning-node-2d2eab628a8b">Run Your Own Mainnet Lightning Node</a>blog post非常有用，还有许多堆栈溢出答案、GitHub问题和lnd Slack社区。</p><h2 id="6b11" class="mz kl ht bd km nj nk nl kq nm nn no ku jb np nq ky jf nr ns lc jj nt nu lg nv dt translated">这篇文章有帮助吗？</h2><p id="4c3a" class="pw-post-body-paragraph iq ir ht is b it li iv iw ix lj iz ja jb lk jd je jf ll jh ji jj lm jl jm jn hm dt translated">考虑建立一条通往punchbeef✅的通道</p><pre class="jq jr js jt fq mv ms mw mx aw my dt"><span id="fd3c" class="mz kl ht ms b fv na nb l nc nd"># 1. Connect to punchbeef✅<br/>$ <strong class="ms hu">lightning-cli connect </strong><strong class="ms hu">02060d0c8577cfc2a1962220a1cde4f623ca55ef80bd25e4be5a8b15fed78b11a3@178.62.237.239</strong></span><span id="bbf5" class="mz kl ht ms b fv ne nb l nc nd"># 2. Fund channel<br/>$ <strong class="ms hu">lightning-cli fundchannel </strong><strong class="ms hu">02060d0c8577cfc2a1962220a1cde4f623ca55ef80bd25e4be5a8b15fed78b11a3</strong> <strong class="ms hu">400000</strong></span></pre><blockquote class="ln"><p id="d654" class="lo lp ht bd lq lr ls lt lu lv lw jn ek translated">加入Coinmonks <a class="ae kb" href="https://t.me/coincodecap" rel="noopener ugc nofollow" target="_blank">电报频道</a>和<a class="ae kb" href="https://www.youtube.com/c/coinmonks/videos" rel="noopener ugc nofollow" target="_blank"> Youtube频道</a>获取每日<a class="ae kb" href="http://coincodecap.com/" rel="noopener ugc nofollow" target="_blank">加密新闻</a></p></blockquote><h2 id="15d6" class="mz kl ht bd km nj oe nl kq nm of no ku jb og nq ky jf oh ns lc jj oi nu lg nv dt translated">另外，阅读</h2><ul class=""><li id="20fb" class="ma mb ht is b it li ix lj jb oj jf ok jj ol jn om mg mh mi dt translated"><a class="ae kb" href="http://Top 4 Telegram Channels for Crypto Traders" rel="noopener ugc nofollow" target="_blank">密码电报信号</a> | <a class="ae kb" rel="noopener" href="/coinmonks/crypto-trading-bot-c2ffce8acb2a">密码交易机器人</a></li><li id="14e6" class="ma mb ht is b it mj ix mk jb ml jf mm jj mn jn om mg mh mi dt translated"><a class="ae kb" rel="noopener" href="/coinmonks/top-10-crypto-copy-trading-platforms-for-beginners-d0c37c7d698c">复制交易</a> | <a class="ae kb" rel="noopener" href="/coinmonks/crypto-tax-software-ed4b4810e338">加密税务软件</a></li><li id="723e" class="ma mb ht is b it mj ix mk jb ml jf mm jj mn jn om mg mh mi dt translated"><a class="ae kb" href="https://coincodecap.com/grid-trading" rel="noopener ugc nofollow" target="_blank">电网交易</a> | <a class="ae kb" rel="noopener" href="/coinmonks/the-best-cryptocurrency-hardware-wallets-of-2020-e28b1c124069">加密硬件钱包</a></li><li id="f33b" class="ma mb ht is b it mj ix mk jb ml jf mm jj mn jn om mg mh mi dt translated"><a class="ae kb" rel="noopener" href="/coinmonks/crypto-exchange-dd2f9d6f3769">加密交易所</a> | <a class="ae kb" rel="noopener" href="/coinmonks/buy-bitcoin-in-india-feb50ddfef94">印度的加密应用</a></li><li id="47a8" class="ma mb ht is b it mj ix mk jb ml jf mm jj mn jn om mg mh mi dt translated"><a class="ae kb" rel="noopener" href="/coinmonks/best-crypto-apis-for-developers-5efe3a597a9f">面向开发人员的最佳加密API</a></li><li id="c9bf" class="ma mb ht is b it mj ix mk jb ml jf mm jj mn jn om mg mh mi dt translated">最佳<a class="ae kb" rel="noopener" href="/coinmonks/top-5-crypto-lending-platforms-in-2020-that-you-need-to-know-a1b675cec3fa">加密借贷平台</a></li><li id="9487" class="ma mb ht is b it mj ix mk jb ml jf mm jj mn jn om mg mh mi dt translated">杠杆代币的终极指南</li><li id="4a2a" class="ma mb ht is b it mj ix mk jb ml jf mm jj mn jn om mg mh mi dt translated"><a class="ae kb" href="https://coincodecap.com/crypto-affiliate-programs" rel="noopener ugc nofollow" target="_blank">8大加密附属计划</a> | <a class="ae kb" href="https://coincodecap.com/etoro-vs-coinbase" rel="noopener ugc nofollow" target="_blank"> eToro vs比特币基地</a></li><li id="e0bf" class="ma mb ht is b it mj ix mk jb ml jf mm jj mn jn om mg mh mi dt translated"><a class="ae kb" href="https://coincodecap.com/binance-futures-trading" rel="noopener ugc nofollow" target="_blank">币安期货交易</a>|<a class="ae kb" href="https://coincodecap.com/mudrex-3commas-etoro" rel="noopener ugc nofollow" target="_blank">3 comas vs Mudrex vs eToro</a></li><li id="a5fa" class="ma mb ht is b it mj ix mk jb ml jf mm jj mn jn om mg mh mi dt translated"><a class="ae kb" href="https://coincodecap.com/buy-monero" rel="noopener ugc nofollow" target="_blank">如何购买Monero </a> | <a class="ae kb" href="https://coincodecap.com/idex-review" rel="noopener ugc nofollow" target="_blank"> IDEX评论</a> | <a class="ae kb" href="https://coincodecap.com/bitkan-trading-bot" rel="noopener ugc nofollow" target="_blank"> BitKan交易机器人</a></li><li id="990c" class="ma mb ht is b it mj ix mk jb ml jf mm jj mn jn om mg mh mi dt translated"><a class="ae kb" rel="noopener" href="/coinmonks/youhodler-vs-coinloan-vs-hodlnaut-b1050acde55a">尤霍德勒vs科恩洛vs霍德诺特</a> | <a class="ae kb" href="https://coincodecap.com/cryptohopper-vs-haasbot" rel="noopener ugc nofollow" target="_blank"> Cryptohopper vs哈斯博特</a></li></ul></div></div>    
</body>
</html>