<html>
<head>
<title>Solidity tutorial: returning structs from public functions</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Solidity教程:从公共函数返回结构</h1>
<blockquote>原文：<a href="https://medium.com/coinmonks/solidity-tutorial-returning-structs-from-public-functions-e78e48efb378?source=collection_archive---------0-----------------------#2017-07-11">https://medium.com/coinmonks/solidity-tutorial-returning-structs-from-public-functions-e78e48efb378?source=collection_archive---------0-----------------------#2017-07-11</a></blockquote><div><div class="ef hh hi hj hk hl"/><div class="hm hn ho hp hq"><div class=""/><p id="8cb6" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">在Solidity的当前版本中(在撰写本文时是0.4.13)，不可能从公共函数返回struct。例如，如果您尝试编译以下代码，将会得到两个错误，每个尝试这样做的函数一个错误:</p><figure class="jo jp jq jr fq js"><div class="bz el l di"><div class="jt ju l"/></div></figure><p id="d460" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">你可以在<a class="ae jv" href="http://ethereum.github.io/browser-solidity" rel="noopener ugc nofollow" target="_blank">浏览器-坚固度</a>中打开这个要点，链接如下:<a class="ae jv" href="http://ethereum.github.io/browser-solidity/#gist=03f9e536d033f81fe2a2df7a74a17ddf&amp;version=soljson-v0.4.13+commit.fb4cb1a.js" rel="noopener ugc nofollow" target="_blank">http://ether eum . github . io/browser-坚固度/# Gist = 03 F9 e 536d 033 f 81 Fe 2 a 2d f 7 a 74 a 17 ddf&amp;version = sol JSON-v 0 . 4 . 13+commit . fb4c B1 a . js</a></p><p id="629e" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">正如您将看到的，编译器抱怨两个函数，<code class="eh jw jx jy jz b">getBryn</code>和<code class="eh jw jx jy jz b">getPerson</code>:</p><pre class="jo jp jq jr fq ka jz kb kc aw kd dt"><span id="6908" class="ke kf ht jz b fv kg kh l ki kj">TypeError: Internal type is not allowed for public or external functions.</span></pre><p id="69e1" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">已确认，不可能返回结构。</p><p id="f9ec" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">然而，如果你已经在Solidity中编码一段时间了，你可能会注意到下面的工作非常好:</p><figure class="jo jp jq jr fq js"><div class="bz el l di"><div class="jt ju l"/></div></figure><p id="a779" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">因为<code class="eh jw jx jy jz b">mapping</code>是公共的，所以Solidity自动为这个函数生成一个getter。这很奇怪，因为getter必须返回一个<code class="eh jw jx jy jz b">Person</code>结构，对吗？让我们再深入一点。</p><p id="fc83" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">让我们部署上面的契约并运行下面的Javascript代码:</p><figure class="jo jp jq jr fq js"><div class="bz el l di"><div class="jt ju l"/></div></figure><p id="0e9d" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">好吧，这是怎么回事？</p><p id="36bf" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">当我们要求编译器为返回一个<code class="eh jw jx jy jz b">Person</code>结构的<code class="eh jw jx jy jz b">mapping</code>生成一个getter时，编译器不应该抱怨吗？</p><p id="5c40" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">事实证明，solc足够聪明，可以为我们处理这个案子。注意调用<code class="eh jw jx jy jz b">project.people('0xdeadbeef')</code>的返回值。它是一个数组，这就是如何将Solidity元组返回到Javascript land。好了，我们知道getter返回的不是一个结构体，而是一个元组。<strong class="is hu">这是个大线索！</strong></p><p id="a08a" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">当编译器为元素是结构的<code class="eh jw jx jy jz b">mapping</code>或数组生成一个getter时，它会做如下事情:</p><figure class="jo jp jq jr fq js"><div class="bz el l di"><div class="jt ju l"/></div></figure><p id="0847" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">如您所见，getter只是将结构分解成一个元组。没有内部类型(如结构)被公开。结果，我们得到了我们想要的功能，没有编译错误。我们只需小心结构字段的顺序——如果顺序改变，我们必须改变与这个getter交互的任何代码，因为元组值的顺序也会改变。</p><p id="7b54" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">了解了这一点，我们可以在编写自己的返回结构的函数时，从Solidity对这个<code class="eh jw jx jy jz b">mapping</code> getter的实现中得到启示。</p><h1 id="f989" class="kk kf ht bd kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg dt translated">返回结构数组</h1><p id="a434" class="pw-post-body-paragraph iq ir ht is b it lh iv iw ix li iz ja jb lj jd je jf lk jh ji jj ll jl jm jn hm dt translated">有时我们可能需要向调用者返回一个结构数组。然而，如果我们采取天真的方法，我们将再次遇到同样的限制——我们不能公开内部类型。</p><p id="1114" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">我们在上面了解到，我们可以“析构”一个结构，并将其作为一个元组返回。为了返回结构数组，我们将做同样的事情。返回的元组中的每个值将表示结构中的一个字段。但是因为我们试图返回许多结构(因此，每个字段都有许多值)，所以元组中的每个字段都是一个数组。</p><p id="3bd2" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">请查看以下代码，以更好地了解这可能是什么样子:</p><figure class="jo jp jq jr fq js"><div class="bz el l di"><div class="jt ju l"/></div></figure><p id="6098" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">无可否认，在前端以这种格式获取数据是一件痛苦的事情。根据您的前端数据模型，您很可能需要编写函数来从接收到的数据中“重建”这些结构。我提供了一个简单的例子来告诉你如何去做:</p><figure class="jo jp jq jr fq js"><div class="bz el l di"><div class="jt ju l"/></div></figure></div><div class="ab cl lm ln hb lo" role="separator"><span class="lp bw bk lq lr ls"/><span class="lp bw bk lq lr ls"/><span class="lp bw bk lq lr"/></div><div class="hm hn ho hp hq"><p id="e76e" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">注意，结构“析构”是(希望是)一种临时的解决方法。Solidity的行为预计会在未来的某个时候发生变化，使这变得更加无缝。</p></div><div class="ab cl lm ln hb lo" role="separator"><span class="lp bw bk lq lr ls"/><span class="lp bw bk lq lr ls"/><span class="lp bw bk lq lr"/></div><div class="hm hn ho hp hq"><p id="cff3" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">在网络上找到我:</p><ul class=""><li id="8713" class="lt lu ht is b it iu ix iy jb lv jf lw jj lx jn ly lz ma mb dt translated">推特:<a class="ae jv" href="https://twitter.com/brynbellomy" rel="noopener ugc nofollow" target="_blank">https://twitter.com/brynbellomy</a></li><li id="0bb1" class="lt lu ht is b it mc ix md jb me jf mf jj mg jn ly lz ma mb dt translated">github:【https://github.com/brynbellomy T2】</li><li id="68cc" class="lt lu ht is b it mc ix md jb me jf mf jj mg jn ly lz ma mb dt translated">领英:【https://www.linkedin.com/in/bryn-bellomy T4】</li></ul><blockquote class="mh"><p id="228d" class="mi mj ht bd mk ml mm mn mo mp mq jn ek translated">加入Coinmonks <a class="ae jv" href="https://t.me/coincodecap" rel="noopener ugc nofollow" target="_blank">电报频道</a>和<a class="ae jv" href="https://www.youtube.com/c/coinmonks/videos" rel="noopener ugc nofollow" target="_blank"> Youtube频道</a>获取每日<a class="ae jv" href="http://coincodecap.com/" rel="noopener ugc nofollow" target="_blank">加密新闻</a></p></blockquote><h2 id="15d6" class="ke kf ht bd kl mr ms mt kp mu mv mw kt jb mx my kx jf mz na lb jj nb nc lf nd dt translated">另外，阅读</h2><ul class=""><li id="20fb" class="lt lu ht is b it lh ix li jb ne jf nf jj ng jn ly lz ma mb dt translated"><a class="ae jv" href="http://Top 4 Telegram Channels for Crypto Traders" rel="noopener ugc nofollow" target="_blank">密码电报信号</a> | <a class="ae jv" rel="noopener" href="/coinmonks/crypto-trading-bot-c2ffce8acb2a">密码交易机器人</a></li><li id="14e6" class="lt lu ht is b it mc ix md jb me jf mf jj mg jn ly lz ma mb dt translated"><a class="ae jv" rel="noopener" href="/coinmonks/top-10-crypto-copy-trading-platforms-for-beginners-d0c37c7d698c">复制交易</a> | <a class="ae jv" rel="noopener" href="/coinmonks/crypto-tax-software-ed4b4810e338">加密税务软件</a></li><li id="723e" class="lt lu ht is b it mc ix md jb me jf mf jj mg jn ly lz ma mb dt translated"><a class="ae jv" href="https://coincodecap.com/grid-trading" rel="noopener ugc nofollow" target="_blank">电网交易</a> | <a class="ae jv" rel="noopener" href="/coinmonks/the-best-cryptocurrency-hardware-wallets-of-2020-e28b1c124069">加密硬件钱包</a></li><li id="f33b" class="lt lu ht is b it mc ix md jb me jf mf jj mg jn ly lz ma mb dt translated"><a class="ae jv" rel="noopener" href="/coinmonks/crypto-exchange-dd2f9d6f3769">最佳加密交易所</a> | <a class="ae jv" rel="noopener" href="/coinmonks/bitcoin-exchange-in-india-7f1fe79715c9">印度最佳加密交易所</a></li><li id="47a8" class="lt lu ht is b it mc ix md jb me jf mf jj mg jn ly lz ma mb dt translated">面向开发者的最佳加密API</li><li id="b359" class="lt lu ht is b it mc ix md jb me jf mf jj mg jn ly lz ma mb dt translated">最佳<a class="ae jv" rel="noopener" href="/coinmonks/top-5-crypto-lending-platforms-in-2020-that-you-need-to-know-a1b675cec3fa">密码借贷平台</a></li><li id="9487" class="lt lu ht is b it mc ix md jb me jf mf jj mg jn ly lz ma mb dt translated"><a class="ae jv" rel="noopener" href="/coinmonks/leveraged-token-3f5257808b22">杠杆代币的终极指南</a></li><li id="95d1" class="lt lu ht is b it mc ix md jb me jf mf jj mg jn ly lz ma mb dt translated"><a class="ae jv" href="https://coincodecap.com/best-vpns-for-crypto-trading" rel="noopener ugc nofollow" target="_blank">加密交易的最佳VPNs】</a></li><li id="918f" class="lt lu ht is b it mc ix md jb me jf mf jj mg jn ly lz ma mb dt translated"><a class="ae jv" href="https://coincodecap.com/blockchain-analytics" rel="noopener ugc nofollow" target="_blank">最佳加密分析或链上数据</a> | <a class="ae jv" href="https://coincodecap.com/bexplus-review" rel="noopener ugc nofollow" target="_blank"> Bexplus评论</a></li><li id="51af" class="lt lu ht is b it mc ix md jb me jf mf jj mg jn ly lz ma mb dt translated"><a class="ae jv" href="https://coincodecap.com/nft-marketplaces" rel="noopener ugc nofollow" target="_blank">NFT十大市场造币集锦</a></li><li id="f72f" class="lt lu ht is b it mc ix md jb me jf mf jj mg jn ly lz ma mb dt translated"><a class="ae jv" href="https://coincodecap.com/ascendex-staking" rel="noopener ugc nofollow" target="_blank">AscendEx Staking</a>|<a class="ae jv" href="https://coincodecap.com/bot-ocean-review" rel="noopener ugc nofollow" target="_blank">Bot Ocean Review</a>|<a class="ae jv" href="https://coincodecap.com/bitcoin-wallets-india" rel="noopener ugc nofollow" target="_blank">最佳比特币钱包</a></li><li id="4ec1" class="lt lu ht is b it mc ix md jb me jf mf jj mg jn ly lz ma mb dt translated"><a class="ae jv" href="https://coincodecap.com/bitget-review" rel="noopener ugc nofollow" target="_blank"> Bitget评论</a> | <a class="ae jv" href="https://coincodecap.com/gemini-vs-blockfi" rel="noopener ugc nofollow" target="_blank">双子星vs BlockFi </a> | <a class="ae jv" href="https://coincodecap.com/okex-futures-trading" rel="noopener ugc nofollow" target="_blank"> OKEx期货交易</a></li></ul></div></div>    
</body>
</html>