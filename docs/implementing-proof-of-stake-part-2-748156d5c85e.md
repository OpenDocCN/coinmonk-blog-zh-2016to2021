# å®æ–½åˆ©å®³å…³ç³»è¯æ˜ç¬¬ 2 éƒ¨åˆ†

> åŸæ–‡ï¼š<https://medium.com/coinmonks/implementing-proof-of-stake-part-2-748156d5c85e?source=collection_archive---------0----------------------->

æœ¬æ–‡ç»™å‡ºäº†ä¸€ä¸ªåœ¨ node.js ä¸­å®ç°åˆ©ç›Šä¸€è‡´æ€§ç®—æ³•çš„ç®€å•æ–¹æ³•

![](img/67a3c3a562cf394e00d1dc1fd2774c83.png)

Source [bitcoin wiki](https://en.bitcoinwiki.org/upload/en/images/thumb/e/e5/Proof%E2%80%93of%E2%80%93Stake_%28PoS%29.jpg/500px-Proof%E2%80%93of%E2%80%93Stake_%28PoS%29.jpg)

åœ¨[ä¸Šä¸€ç¯‡](/coinmonks/implementing-proof-of-stake-e26fa5fb8716)æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬ä»‹ç»äº† stake çš„è¯æ˜ï¼Œå®ƒæ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Œè¿˜è®¨è®ºäº†æˆ‘ä»¬å°†è¦å®ç°çš„ä»£ç çš„è®¾è®¡å’Œæ¶æ„ã€‚

åœ¨è¿™ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬å°†å¼€å§‹ç¼–ç ã€‚

# å…ˆå†³æ¡ä»¶:

1.  [Node.js](https://nodejs.org/en/download/) å’Œ [NPM](https://www.npmjs.com/)
2.  [æ–‡æœ¬ç¼–è¾‘å™¨](https://code.visualstudio.com/download)(å¸¦æœ‰æ·±è‰²ä¸»é¢˜ğŸ˜›)
3.  [Postman](https://www.getpostman.com/) æˆ–ä»»ä½•å…¶ä»– app ä¸ HTTP APIs äº¤äº’ã€‚

***å°±æ˜¯è¿™æ ·ã€‚***

# è®©æˆ‘ä»¬ç¼–ç :

æˆ‘ä»¬å°†ä»åˆ›å»ºé¡¹ç›®çš„æ ¹ç›®å½•å¼€å§‹ã€‚ä¸ºæ‚¨çš„é¡¹ç›®å‘½åã€‚å°±è¯´ POSchain å§ã€‚

```
mkdir poschain
cd poschain
```

åˆ›å»ºæ–°çš„èŠ‚ç‚¹é¡¹ç›®

```
npm init -y
```

æˆ‘ä»¬éœ€è¦ä¸€ä¸ªåä¸º nodemon çš„åŒ…æ¥è¿è¡Œæˆ‘ä»¬çš„å¼€å‘æœåŠ¡å™¨ï¼Œå¹¶åœ¨æ¯æ¬¡ä¿å­˜æ—¶é‡æ–°åŠ è½½æœåŠ¡å™¨ã€‚è¿™ä¸ªå·¥å…·è®©æˆ‘ä»¬å…å»äº†å¾ˆå¤šéº»çƒ¦ã€‚

```
npm install nodemon --save-dev
```

å¥½å§ã€‚ç»§ç»­å‰è¿›ã€‚

# è¡—åŒº

åŒºå—é“¾æ˜¯ç”±å—ç»„æˆçš„ï¼Œæ‰€ä»¥è®©æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªå—ç±»ã€‚å—å…·æœ‰ä»¥ä¸‹ä¸»è¦å±æ€§:

æ—¶é—´æˆ³â€”å—çš„åˆ›å»ºæ—¶é—´ï¼Œä»¥æ¯«ç§’ä¸ºå•ä½

lastHash â€”é“¾ä¸Šæœ€åä¸€ä¸ªå—çš„å“ˆå¸Œ

å“ˆå¸Œ-å½“å‰å—çš„å“ˆå¸Œ

æ•°æ®â€”å—æˆ–äº‹åŠ¡ä¸­çš„æ•°æ®

éªŒè¯è€…â€”â€”åˆ¶ä½œè¿™ä¸ªç¨‹åºå—çš„äººçš„åœ°å€

ç­¾åâ€”ç”±éªŒè¯ç¨‹åºç­¾åçš„å—çš„åŠ å¯†å“ˆå¸Œ

å› æ­¤ï¼Œåœ¨æ ¹ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ªæ–°æ–‡ä»¶`block.js`,å¹¶åˆ›å»ºä¸€ä¸ªå…·æœ‰è¿™äº›å±æ€§çš„ç±»ã€‚

the block

å¦å¤–ï¼Œæ·»åŠ ä¸€ä¸ª`toString()`å‡½æ•°ï¼Œè¯¥å‡½æ•°å°†ä»¥å¯è¯»æ ¼å¼æ‰“å°å—çš„ç»†èŠ‚ã€‚

ç”±äºåœ¨é“¾çš„å¼€å§‹æ²¡æœ‰ç§¯æœ¨ï¼ŒåŒºå—é“¾æœ‰äº†åˆ›ä¸–çºªç§¯æœ¨çš„æ¦‚å¿µã€‚åˆ›ä¸–è¡—åŒºæœåŠ¡äºæˆä¸ºåŒºå—é“¾èµ·æºçš„ç›®çš„ã€‚è¿™æ˜¯ä¸€ä¸ªç¡¬ç¼–ç çš„å—ï¼ŒåŒ…å«æ—¶é—´æˆ³ã€lastHashã€Hash å’Œæ•°æ®å€¼çš„è™šæ‹Ÿå€¼ã€‚

è®©æˆ‘ä»¬ç”¨ä¸€äº›ç¡¬ç¼–ç å€¼ç»™æˆ‘ä»¬çš„å—ç±»æ·»åŠ ä¸€ä¸ªé™æ€çš„`genesis()`å‡½æ•°ã€‚è¯¥å‡½æ•°å°†åˆ›å»ºä¸€ä¸ªå¸¦æœ‰è™šæ‹Ÿå€¼çš„æ–°å—ã€‚è¿™æ˜¯é™æ€çš„ï¼Œå› ä¸ºæˆ‘ä»¬ä¸æƒ³åˆ›å»ºä¸€ä¸ªå®ä¾‹æ¥è°ƒç”¨è¿™ä¸ªå‡½æ•°ã€‚

æ¥ä¸‹æ¥æˆ‘ä»¬è¦æ·»åŠ åˆ° block ç±»ä¸­çš„æ˜¯åŸºäºæ•°æ®å’Œæœ€åä¸€ä¸ªæ•£åˆ—åˆ›å»ºæ–°å—çš„èƒ½åŠ›ã€‚å§‘ä¸”ç§°ä¹‹ä¸º`createBlock()`

è¿™ä¸ªé™æ€çš„`createBlock()`å‡½æ•°ç›®å‰æœ‰ä¸¤ä¸ªå‚æ•°ï¼Œæœ€åä¸€ä¸ªå—å’Œæ•°æ®ï¼ŒåŸºäºè¿™ä¸¤ä¸ªå‚æ•°å®ƒç”Ÿæˆä¸€ä¸ªæ–°çš„å—ã€‚æˆ‘ä»¬åœ¨æ•´ä¸ªé¡¹ç›®ä¸­çš„è®¸å¤šåŠŸèƒ½å°†æ˜¯é™æ€çš„ã€‚

ä¸ºäº†ç”Ÿæˆå“ˆå¸Œå€¼ï¼Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ªåä¸º`crypto-js`çš„èŠ‚ç‚¹åŒ…ï¼Œè®©æˆ‘ä»¬å®‰è£…å®ƒã€‚

```
npm i crypto-js --save
```

ä»æ­¤æ¨¡å—å¯¼å…¥ sha-256 å‡½æ•°ã€‚

```
const SHA256 = require('crypto-js/sha256');
```

æˆ‘ä»¬ä¸ä¼šç›´æ¥ä½¿ç”¨æ•£åˆ—å‡½æ•°ï¼Œç›¸åï¼Œæˆ‘ä»¬å°†åˆ›å»ºä¸€ä¸ªå•ç‹¬çš„å‡½æ•°ï¼Œå› ä¸ºæˆ‘ä»¬å°†æ¥ä¼šå†æ¬¡ä½¿ç”¨å®ƒã€‚

The backticks and dollar syntax, thatâ€™s ES6.

è®©æˆ‘ä»¬ç”¨ä¸Šé¢çš„ä¸œè¥¿åˆ›å»ºä¸€ä¸ª`createBlock()`å‡½æ•°ã€‚

åœ¨æ¥ä¸‹æ¥çš„æ•™ç¨‹ä¸­ï¼Œæˆ‘ä»¬å°†åœ¨å®ç°é’±åŒ…æ—¶æ·»åŠ éªŒè¯å™¨å’Œç­¾åã€‚

# åŒºå—é“¾

åœ¨æ ¹ç›®å½•ä¸‹åˆ›å»º `blockchain.js`æ–‡ä»¶ã€‚è¦åˆ›å»ºåŒºå—é“¾ç±»ï¼Œæˆ‘ä»¬éœ€è¦å¯¼å…¥å—ç±»ã€‚

åœ¨æ„é€ å‡½æ•°ä¸­ï¼Œæˆ‘ä»¬å°†ä¸ºé“¾æä¾›ä¸€ä¸ªåˆå§‹å—ã€‚åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬å°†åˆ©ç”¨æˆ‘ä»¬åˆ›å»ºçš„é™æ€æˆå› å‡½æ•°æ¥å¯åŠ¨æˆ‘ä»¬çš„é“¾ã€‚

The blockchain class

æ¥ä¸‹æ¥ï¼Œè®©æˆ‘ä»¬ç»™æˆ‘ä»¬çš„åŒºå—é“¾ç±»é€šè¿‡åˆ›å»ºä¸€ä¸ª`addBlock(data)`å‡½æ•°å‘é“¾ä¸­æ·»åŠ æ›´å¤šå—çš„èƒ½åŠ›ã€‚

åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬å°†ä½¿ç”¨æˆ‘ä»¬çš„`createBlock()`åŠŸèƒ½æ¥åˆ›å»ºä¸€ä¸ªæ–°çš„å—ï¼Œç„¶åå°†å…¶æ¨é€åˆ°é“¾ä¸­ã€‚æˆ‘ä»¬å°†è®¿é—®é“¾ä¸Šçš„æœ€åä¸€ä¸ªå—ï¼Œç„¶åä½¿ç”¨ä¼ é€’ç»™`addBLock()`çš„æ•°æ®è°ƒç”¨`createBlock()`å‡½æ•°

åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬çš„ blockchain.js æ–‡ä»¶æ˜¯è¿™æ ·çš„ã€‚

é…·ã€‚

æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°†å‘åŒºå—é“¾æ·»åŠ æ›´å¤šåŠŸèƒ½ï¼Œä»¥æ”¯æŒå¤šä¸ªè´¡çŒ®è€…ã€‚

*æ„Ÿè°¢æ‚¨çš„é˜…è¯»ã€‚* ***åœ¨ä¸‹ä¸€éƒ¨åˆ†ï¼Œæˆ‘ä»¬å°†ç¼–å†™ä»£ç æ¥éªŒè¯åŒºå—é“¾ï¼Œå¹¶å¢åŠ å¯¹å¤šä¸ªèŠ‚ç‚¹çš„æ”¯æŒã€‚*** *å¸Œæœ›æ‚¨å–œæ¬¢ç¼–ç ã€‚* ***å¦‚æœä½ å‘ç°è¿™æœ‰å¸®åŠ©ï¼Œå°±é¼“æŒæ¬¢å‘¼ã€‚***

*å¦‚æœä½ å¯¹åŒºå—é“¾ã€ä»¥å¤ªæˆ–æ•´ä¸ªä¸–ç•Œæœ‰ä»»ä½•ç–‘é—®ï¼Œè¯·ç•™è¨€ã€‚:)*

> [ç›´æ¥åœ¨æ‚¨çš„æ”¶ä»¶ç®±ä¸­è·å–æœ€ä½³è½¯ä»¶äº¤æ˜“](https://coincodecap.com/?utm_source=coinmonks)

[![](img/7c0b3dfdcbfea594cc0ae7d4f9bf6fcb.png)](https://coincodecap.com/?utm_source=coinmonks)