<html>
<head>
<title>Creating and Deploying a Custom Chain Code for Hyper ledger Fabric</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">为Hyper ledger结构创建和部署自定义链代码</h1>
<blockquote>原文：<a href="https://medium.com/coinmonks/creating-and-deploying-a-custom-chain-code-for-hyper-ledger-fabric-51e7ed2f466b?source=collection_archive---------0-----------------------#2020-01-22">https://medium.com/coinmonks/creating-and-deploying-a-custom-chain-code-for-hyper-ledger-fabric-51e7ed2f466b?source=collection_archive---------0-----------------------#2020-01-22</a></blockquote><div><div class="ef hh hi hj hk hl"/><div class="hm hn ho hp hq"><div class=""/><p id="88ea" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">在本教程中，我们将学习创建一个自定义链代码(智能合同)。链码基于hyper ledger官方教程中的fabcar链码。我对它进行了逆向工程，使之成为原始的食品监管链代码。</p><figure class="jp jq jr js fq jt fe ff paragraph-image"><div class="fe ff jo"><img src="../Images/25b0b280f2146acc280c89d346a2b879.png" data-original-src="https://miro.medium.com/v2/resize:fit:586/format:webp/1*IxPsw-XsuNLR2Iezaagk9w.png"/></div></figure><p id="81d2" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">首先，我们将看看链代码。我们将一部分一部分地做这件事。</p><pre class="jp jq jr js fq jw jx jy jz aw ka dt"><span id="d12f" class="kb kc ht jx b fv kd ke l kf kg">import (</span><span id="e409" class="kb kc ht jx b fv kh ke l kf kg">"bytes"</span><span id="0ce9" class="kb kc ht jx b fv kh ke l kf kg">"encoding/json"</span><span id="2441" class="kb kc ht jx b fv kh ke l kf kg">"fmt"</span><span id="ff41" class="kb kc ht jx b fv kh ke l kf kg">"strconv"</span><span id="28be" class="kb kc ht jx b fv kh ke l kf kg">"github.com/hyperledger/fabric/core/chaincode/shim"</span><span id="64cb" class="kb kc ht jx b fv kh ke l kf kg">sc "github.com/hyperledger/fabric/protos/peer"</span><span id="f238" class="kb kc ht jx b fv kh ke l kf kg">)</span></pre><p id="1b5e" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">这部分包括go链代码的必要导入。</p><p id="681b" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">然后我们为链码做一个结构。</p><pre class="jp jq jr js fq jw jx jy jz aw ka dt"><span id="7c7d" class="kb kc ht jx b fv kd ke l kf kg">type SmartContract struct {</span><span id="e0d6" class="kb kc ht jx b fv kh ke l kf kg">}</span><span id="049f" class="kb kc ht jx b fv kh ke l kf kg">// Define the stock structure, with 4 properties.  Structure tags are used by encoding/json library</span><span id="a57b" class="kb kc ht jx b fv kh ke l kf kg">type Stock struct {</span><span id="f454" class="kb kc ht jx b fv kh ke l kf kg">Type   string `json:"type"`</span><span id="07e8" class="kb kc ht jx b fv kh ke l kf kg">Quantity  string `json:"quantity"`</span><span id="71c7" class="kb kc ht jx b fv kh ke l kf kg">Importer string `json:"importer"`</span><span id="548e" class="kb kc ht jx b fv kh ke l kf kg">Retailer  string `json:"retailer"`</span><span id="00ea" class="kb kc ht jx b fv kh ke l kf kg">}</span></pre><p id="5dfa" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">我们创建了一个名为stock的结构，其中包含智能合约所需的必要数据集。</p><p id="4499" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">现在我们来看看实例化和调用部分。链代码需要被实例化以在对等体中工作。</p><pre class="jp jq jr js fq jw jx jy jz aw ka dt"><span id="4355" class="kb kc ht jx b fv kd ke l kf kg">func (s *SmartContract) Init(APIstub shim.ChaincodeStubInterface) sc.Response {</span><span id="93d8" class="kb kc ht jx b fv kh ke l kf kg">return shim.Success(nil)</span><span id="d257" class="kb kc ht jx b fv kh ke l kf kg">}</span><span id="0d87" class="kb kc ht jx b fv kh ke l kf kg">func (s *SmartContract) Invoke(APIstub shim.ChaincodeStubInterface) sc.Response {</span><span id="627e" class="kb kc ht jx b fv kh ke l kf kg">// Retrieve the requested Smart Contract function and arguments</span><span id="55ee" class="kb kc ht jx b fv kh ke l kf kg">function, args := APIstub.GetFunctionAndParameters()</span><span id="a121" class="kb kc ht jx b fv kh ke l kf kg">// Route to the appropriate handler function to interact with the ledger appropriately</span><span id="a814" class="kb kc ht jx b fv kh ke l kf kg">if function == "queryStock" {</span><span id="7d39" class="kb kc ht jx b fv kh ke l kf kg">return s.queryStock(APIstub, args)</span><span id="d83b" class="kb kc ht jx b fv kh ke l kf kg">} else if function == "initLedger" {</span><span id="bd08" class="kb kc ht jx b fv kh ke l kf kg">return s.initLedger(APIstub)</span><span id="62fd" class="kb kc ht jx b fv kh ke l kf kg">} else if function == "createStock" {</span><span id="72fb" class="kb kc ht jx b fv kh ke l kf kg">return s.createStock(APIstub, args)</span><span id="6f94" class="kb kc ht jx b fv kh ke l kf kg">} else if function == "queryAllStocks" {</span><span id="22bf" class="kb kc ht jx b fv kh ke l kf kg">return s.queryAllStocks(APIstub)</span><span id="f985" class="kb kc ht jx b fv kh ke l kf kg">} else if function == "assignStock" {</span><span id="6a3a" class="kb kc ht jx b fv kh ke l kf kg">return s.assignStock(APIstub, args)</span><span id="117e" class="kb kc ht jx b fv kh ke l kf kg">}</span><span id="b43a" class="kb kc ht jx b fv kh ke l kf kg">return shim.Error("Invalid Smart Contract function name.")</span><span id="d85f" class="kb kc ht jx b fv kh ke l kf kg">}</span></pre><p id="80bb" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">在调用部分，我们调用链代码的各种函数来工作。</p><p id="4612" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">现在是链代码的剩余部分。</p><pre class="jp jq jr js fq jw jx jy jz aw ka dt"><span id="d66b" class="kb kc ht jx b fv kd ke l kf kg">func (s *SmartContract) queryStock(APIstub shim.ChaincodeStubInterface, args []string) sc.Response {</span><span id="175e" class="kb kc ht jx b fv kh ke l kf kg">if len(args) != 1 {</span><span id="838b" class="kb kc ht jx b fv kh ke l kf kg">return shim.Error("Incorrect number of arguments. Expecting 1")</span><span id="95c4" class="kb kc ht jx b fv kh ke l kf kg">}</span><span id="a085" class="kb kc ht jx b fv kh ke l kf kg">carAsBytes, _ := APIstub.GetState(args[0])</span><span id="47ba" class="kb kc ht jx b fv kh ke l kf kg">return shim.Success(carAsBytes)</span><span id="f486" class="kb kc ht jx b fv kh ke l kf kg">}</span><span id="4dd4" class="kb kc ht jx b fv kh ke l kf kg">func (s *SmartContract) initLedger(APIstub shim.ChaincodeStubInterface) sc.Response {</span><span id="38ed" class="kb kc ht jx b fv kh ke l kf kg">stocks := []Stock{</span><span id="6cff" class="kb kc ht jx b fv kh ke l kf kg">Stock{Type: "CowMeat", Quantity: "205kg", Importer: "BengolMeat", Retailer: "BengolMeat"},</span><span id="ed13" class="kb kc ht jx b fv kh ke l kf kg">Stock{Type: "GoatMeat", Quantity: "100kg", Importer: "RoyalMeat", Retailer: "MenaBajar"},</span><span id="a81e" class="kb kc ht jx b fv kh ke l kf kg">Stock{Type: "ChickenMeat", Quantity: "25kg", Importer: "GovtMeat", Retailer: "Shopno"},</span><span id="2530" class="kb kc ht jx b fv kh ke l kf kg">Stock{Type: "KhasirMeat", Quantity: "655kg", Importer: "AiubMeat", Retailer: "AgoraMeat"},</span><span id="1400" class="kb kc ht jx b fv kh ke l kf kg">Stock{Type: "GoruMeat", Quantity: "2264kg", Importer: "BeyondlMeat", Retailer: "MeatMarket"},</span><span id="847b" class="kb kc ht jx b fv kh ke l kf kg">}</span><span id="014e" class="kb kc ht jx b fv kh ke l kf kg">i := 0</span><span id="3c65" class="kb kc ht jx b fv kh ke l kf kg">for i &lt; len(stocks) {</span><span id="018d" class="kb kc ht jx b fv kh ke l kf kg">fmt.Println("i is ", i)</span><span id="d01f" class="kb kc ht jx b fv kh ke l kf kg">stockAsBytes, _ := json.Marshal(stocks[i])</span><span id="f5cf" class="kb kc ht jx b fv kh ke l kf kg">APIstub.PutState("STOCK"+strconv.Itoa(i), stockAsBytes)</span><span id="94f1" class="kb kc ht jx b fv kh ke l kf kg">fmt.Println("Added", stocks[i])</span><span id="fc43" class="kb kc ht jx b fv kh ke l kf kg">i = i + 1</span><span id="6292" class="kb kc ht jx b fv kh ke l kf kg">}</span><span id="6478" class="kb kc ht jx b fv kh ke l kf kg">return shim.Success(nil)</span><span id="746c" class="kb kc ht jx b fv kh ke l kf kg">}</span><span id="24c9" class="kb kc ht jx b fv kh ke l kf kg">func (s *SmartContract) createStock(APIstub shim.ChaincodeStubInterface, args []string) sc.Response {</span><span id="fc9b" class="kb kc ht jx b fv kh ke l kf kg">if len(args) != 5 {</span><span id="58bf" class="kb kc ht jx b fv kh ke l kf kg">return shim.Error("Incorrect number of arguments. Expecting 5")</span><span id="b42f" class="kb kc ht jx b fv kh ke l kf kg">}</span><span id="56ef" class="kb kc ht jx b fv kh ke l kf kg">var stock = Stock{Type: args[1], Quantity: args[2], Importer: args[3], Retailer: args[4]}</span><span id="adac" class="kb kc ht jx b fv kh ke l kf kg">stockAsBytes, _ := json.Marshal(stock)</span><span id="b82c" class="kb kc ht jx b fv kh ke l kf kg">APIstub.PutState(args[0], stockAsBytes)</span><span id="0740" class="kb kc ht jx b fv kh ke l kf kg">return shim.Success(nil)</span><span id="1387" class="kb kc ht jx b fv kh ke l kf kg">}</span><span id="2a06" class="kb kc ht jx b fv kh ke l kf kg">func (s *SmartContract) queryAllStocks(APIstub shim.ChaincodeStubInterface) sc.Response {</span><span id="c2af" class="kb kc ht jx b fv kh ke l kf kg">startKey := "STOCK0"</span><span id="d0fe" class="kb kc ht jx b fv kh ke l kf kg">endKey := "STOCK999"</span><span id="58a2" class="kb kc ht jx b fv kh ke l kf kg">resultsIterator, err := APIstub.GetStateByRange(startKey, endKey)</span><span id="a7f0" class="kb kc ht jx b fv kh ke l kf kg">if err != nil {</span><span id="093e" class="kb kc ht jx b fv kh ke l kf kg">return shim.Error(err.Error())</span><span id="b02b" class="kb kc ht jx b fv kh ke l kf kg">}</span><span id="759a" class="kb kc ht jx b fv kh ke l kf kg">defer resultsIterator.Close()</span><span id="c8cb" class="kb kc ht jx b fv kh ke l kf kg">// buffer is a JSON array containing QueryResults</span><span id="31ff" class="kb kc ht jx b fv kh ke l kf kg">var buffer bytes.Buffer</span><span id="4d37" class="kb kc ht jx b fv kh ke l kf kg">buffer.WriteString("[")</span><span id="3124" class="kb kc ht jx b fv kh ke l kf kg">bArrayMemberAlreadyWritten := false</span><span id="aa91" class="kb kc ht jx b fv kh ke l kf kg">for resultsIterator.HasNext() {</span><span id="a9a6" class="kb kc ht jx b fv kh ke l kf kg">queryResponse, err := resultsIterator.Next()</span><span id="ab61" class="kb kc ht jx b fv kh ke l kf kg">if err != nil {</span><span id="4a51" class="kb kc ht jx b fv kh ke l kf kg">return shim.Error(err.Error())</span><span id="8e4f" class="kb kc ht jx b fv kh ke l kf kg">}</span><span id="ffc6" class="kb kc ht jx b fv kh ke l kf kg">// Add a comma before array members, suppress it for the first array member</span><span id="557c" class="kb kc ht jx b fv kh ke l kf kg">if bArrayMemberAlreadyWritten == true {</span><span id="ded5" class="kb kc ht jx b fv kh ke l kf kg">buffer.WriteString(",")</span><span id="ed8a" class="kb kc ht jx b fv kh ke l kf kg">}</span><span id="8200" class="kb kc ht jx b fv kh ke l kf kg">buffer.WriteString("{\"Key\":")</span><span id="70b8" class="kb kc ht jx b fv kh ke l kf kg">buffer.WriteString("\"")</span><span id="8f07" class="kb kc ht jx b fv kh ke l kf kg">buffer.WriteString(queryResponse.Key)</span><span id="bd7f" class="kb kc ht jx b fv kh ke l kf kg">buffer.WriteString("\"")</span><span id="ce41" class="kb kc ht jx b fv kh ke l kf kg">buffer.WriteString(", \"Record\":")</span><span id="e1db" class="kb kc ht jx b fv kh ke l kf kg">// Record is a JSON object, so we write as-is</span><span id="d9dc" class="kb kc ht jx b fv kh ke l kf kg">buffer.WriteString(string(queryResponse.Value))</span><span id="42d1" class="kb kc ht jx b fv kh ke l kf kg">buffer.WriteString("}")</span><span id="29a5" class="kb kc ht jx b fv kh ke l kf kg">bArrayMemberAlreadyWritten = true</span><span id="dcd9" class="kb kc ht jx b fv kh ke l kf kg">}</span><span id="bdab" class="kb kc ht jx b fv kh ke l kf kg">buffer.WriteString("]")</span><span id="2855" class="kb kc ht jx b fv kh ke l kf kg">fmt.Printf("- queryAllStocks:\n%s\n", buffer.String())</span><span id="f987" class="kb kc ht jx b fv kh ke l kf kg">return shim.Success(buffer.Bytes())</span><span id="a772" class="kb kc ht jx b fv kh ke l kf kg">}</span><span id="bbfb" class="kb kc ht jx b fv kh ke l kf kg">func (s *SmartContract) assignStock(APIstub shim.ChaincodeStubInterface, args []string) sc.Response {</span><span id="9c48" class="kb kc ht jx b fv kh ke l kf kg">if len(args) != 2 {</span><span id="972b" class="kb kc ht jx b fv kh ke l kf kg">return shim.Error("Incorrect number of arguments. Expecting 2")</span><span id="b36a" class="kb kc ht jx b fv kh ke l kf kg">}</span><span id="1f6e" class="kb kc ht jx b fv kh ke l kf kg">stockAsBytes, _ := APIstub.GetState(args[0])</span><span id="4de4" class="kb kc ht jx b fv kh ke l kf kg">stock := Stock{}</span><span id="a984" class="kb kc ht jx b fv kh ke l kf kg">json.Unmarshal(stockAsBytes, &amp;stock)</span><span id="47ca" class="kb kc ht jx b fv kh ke l kf kg">stock.Retailer = args[1]</span><span id="9cfd" class="kb kc ht jx b fv kh ke l kf kg">stockAsBytes, _ = json.Marshal(stock)</span><span id="2066" class="kb kc ht jx b fv kh ke l kf kg">APIstub.PutState(args[0], stockAsBytes)</span><span id="be00" class="kb kc ht jx b fv kh ke l kf kg">return shim.Success(nil)</span><span id="3198" class="kb kc ht jx b fv kh ke l kf kg">}</span><span id="7058" class="kb kc ht jx b fv kh ke l kf kg">func main() {</span><span id="e018" class="kb kc ht jx b fv kh ke l kf kg">// Create a new Smart Contract</span><span id="8120" class="kb kc ht jx b fv kh ke l kf kg">err := shim.Start(new(SmartContract))</span><span id="034f" class="kb kc ht jx b fv kh ke l kf kg">if err != nil {</span><span id="001d" class="kb kc ht jx b fv kh ke l kf kg">fmt.Printf("Error creating new Smart Contract: %s", err)</span><span id="c337" class="kb kc ht jx b fv kh ke l kf kg">}</span><span id="417e" class="kb kc ht jx b fv kh ke l kf kg">}</span></pre><p id="ce60" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">这部分代码处理链代码中的函数。第一个函数是queryStock，它接受股票的一个参数键，并提供详细信息。下一个函数是initLedger，它用一些数据填充分类帐以进行查询和其他操作。QueryAllStocks名称已经足够定义了。assignStock用于将库存分配给不同的零售商。主要功能仅用于单元测试。</p><p id="36f2" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">现在是最后的代码:</p><figure class="jp jq jr js fq jt"><div class="bz el l di"><div class="ki kj l"/></div></figure><p id="722f" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">现在我们必须先编译它。用于编译go链代码。我们必须将文件保存在go路径中。Go路径设置可以通过此链接了解:</p><div class="kk kl fm fo km kn"><a href="https://github.com/golang/go/wiki/SettingGOPATH" rel="noopener  ugc nofollow" target="_blank"><div class="ko ab ej"><div class="kp ab kq cl cj kr"><h2 class="bd hu fv z el ks eo ep kt er et hs dt translated">golang/go</h2><div class="ku l"><h3 class="bd b fv z el ks eo ep kt er et ek translated">Go编程语言。在GitHub上创建帐户，为golang/go开发做出贡献。</h3></div><div class="kv l"><p class="bd b gc z el ks eo ep kt er et ek translated">github.com</p></div></div><div class="kw l"><div class="kx l ky kz la kw lb ju kn"/></div></div></a></div><p id="276d" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">我们将使用命令构建代码。</p><pre class="jp jq jr js fq jw jx jy jz aw ka dt"><span id="6f49" class="kb kc ht jx b fv kd ke l kf kg">go build </span></pre><p id="918c" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">我们现在将有一个编译好的go文件。</p><figure class="jp jq jr js fq jt fe ff paragraph-image"><div role="button" tabindex="0" class="ld le di lf bf lg"><div class="fe ff lc"><img src="../Images/188507b147b0d9d1b640d7b5168f481d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bYPCBrqOO4XUUwbKVuMIHw.png"/></div></div></figure><p id="e149" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">然后将编译后的go文件和go文件放在compose-cli文件中指定的路径中。</p><figure class="jp jq jr js fq jt fe ff paragraph-image"><div role="button" tabindex="0" class="ld le di lf bf lg"><div class="fe ff lh"><img src="../Images/5cc75a2df8e52faefd518a18726e07f7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_3sqdCdN3E8hLwjIVmBA8g.png"/></div></div></figure><p id="bf36" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">为了更好地理解，这里也给出了该文件。如果你想知道什么是docker-compose-cli，它有什么必要，可以在这里找到。</p><div class="kk kl fm fo km kn"><a rel="noopener follow" target="_blank" href="/@golammohammadshovon/creating-custom-network-and-deploy-chain-code-with-hyperledger-fabric-f710177047d3"><div class="ko ab ej"><div class="kp ab kq cl cj kr"><h2 class="bd hu fv z el ks eo ep kt er et hs dt translated">使用Hyperledger结构创建自定义网络和部署链代码</h2><div class="ku l"><h3 class="bd b fv z el ks eo ep kt er et ek translated">首先，我们必须在系统中设置hyperledger结构的先决条件。我们使用最新版本的…</h3></div><div class="kv l"><p class="bd b gc z el ks eo ep kt er et ek translated">medium.com</p></div></div><div class="kw l"><div class="li l ky kz la kw lb ju kn"/></div></div></a></div><p id="3415" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">我在本教程中使用了另一个网络，但概念是相同的。</p><figure class="jp jq jr js fq jt"><div class="bz el l di"><div class="ki kj l"/></div></figure><p id="eec2" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">在这个网络中，我们有3个组织，每个组织有一个对等点。我们为链代码指定的体积部分不是绝对的。这是一个相对路径，相对于gopath。</p><p id="bd89" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">我们将按照这个过程在对等体中安装链代码。在启动网络并将对等体加入信道之后。更多相关数据可在此处找到:</p><div class="kk kl fm fo km kn"><a rel="noopener follow" target="_blank" href="/@golammohammadshovon/creating-custom-network-and-deploy-chain-code-with-hyperledger-fabric-f710177047d3"><div class="ko ab ej"><div class="kp ab kq cl cj kr"><h2 class="bd hu fv z el ks eo ep kt er et hs dt translated">使用Hyperledger结构创建自定义网络和部署链代码</h2><div class="ku l"><h3 class="bd b fv z el ks eo ep kt er et ek translated">首先，我们必须在系统中设置hyperledger结构的先决条件。我们使用最新版本的…</h3></div><div class="kv l"><p class="bd b gc z el ks eo ep kt er et ek translated">medium.com</p></div></div><div class="kw l"><div class="li l ky kz la kw lb ju kn"/></div></div></a></div><p id="0ba7" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">同样，网络是不同的，但概念是相同的。请记住，所有命令都必须在网络文件夹中发出。</p><p id="58d5" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">我们将按照以下程序输入每一项:</p><p id="3b66" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">这方面的一般指挥结构是:</p><p id="94e1" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">对于客户组织对等0，命令为:</p><pre class="jp jq jr js fq jw jx jy jz aw ka dt"><span id="97a9" class="kb kc ht jx b fv kd ke l kf kg">docker exec -e "CORE_PEER_LOCALMSPID=CustomerMSP" -e "CORE_PEER_TLS_ROOTCERT_FILE=/opt/gopath/fabric-samples/food-network/crypto-config/peerOrganizations/customer.food-network.com/peers/peer0.customer.food-network.com/tls/ca.crt" -e "<a class="ae lj" href="mailto:CORE_PEER_MSPCONFIGPATH=/opt/gopath/fabric-samples/food-network/crypto-config/peerOrganizations/customer.food-network.com/users/Admin@customer.food-network.com" rel="noopener ugc nofollow" target="_blank">CORE_PEER_MSPCONFIGPATH=/opt/gopath/fabric-samples/food-network/crypto-config/peerOrganizations/customer.food-network.com/users/Admin@customer.food-network.com</a>/msp" -e "CORE_PEER_ADDRESS=peer0.customer.food-network.com:7051" -it cli bash</span></pre><figure class="jp jq jr js fq jt fe ff paragraph-image"><div role="button" tabindex="0" class="ld le di lf bf lg"><div class="fe ff lk"><img src="../Images/ff87830ac9be5139fc5626297c4baaa6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YdCEdmZKPsDnF60Etbi25Q.png"/></div></div></figure><p id="a714" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">进入对等体后，我们将首先导入证书文件。</p><pre class="jp jq jr js fq jw jx jy jz aw ka dt"><span id="dc1d" class="kb kc ht jx b fv kd ke l kf kg">export ORDERER_CA=/opt/gopath/fabric-samples/food-network/crypto-config/ordererOrganizations/food-network.com/orderers/orderer.food-network.com/msp/tlscacerts/tlsca.food-network.com-cert.pem</span></pre><p id="ecfa" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">这里的频道名称是:channelshovon</p><p id="8ee9" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">现在，我们将在客户组织的对等0中安装链。连锁码在连锁文件夹的食品码文件夹里面。</p><pre class="jp jq jr js fq jw jx jy jz aw ka dt"><span id="bffb" class="kb kc ht jx b fv kd ke l kf kg">CORE_PEER_ADDRESS=peer0.customer.food-network.com:7051 peer chaincode install -n foodcode -p chain/foodcode -v 1.0</span></pre><p id="83f7" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">这方面的通用命令是:</p><pre class="jp jq jr js fq jw jx jy jz aw ka dt"><span id="f2f7" class="kb kc ht jx b fv kd ke l kf kg">CORE_PEER_ADDRESS=****peer address****peer chaincode install -n **chaincodename**-p chain/**location of the chaincode folder** -v **version for the chaincode**</span></pre><figure class="jp jq jr js fq jt fe ff paragraph-image"><div role="button" tabindex="0" class="ld le di lf bf lg"><div class="fe ff ll"><img src="../Images/d9f20c8e090d748d478af84c5bd664f7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1NY1Mbf-J2tDXs8bECY3vg.png"/></div></div></figure><p id="bf67" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">现在我们可以使用这个命令检查已安装的链代码列表。</p><pre class="jp jq jr js fq jw jx jy jz aw ka dt"><span id="258a" class="kb kc ht jx b fv kd ke l kf kg">peer chaincode list --installed</span></pre><p id="dd46" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">输出:</p><figure class="jp jq jr js fq jt fe ff paragraph-image"><div role="button" tabindex="0" class="ld le di lf bf lg"><div class="fe ff lm"><img src="../Images/ae4ee1c9816f7398587117ea43fcb6ed.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7FFDRc2idQ8SKJtWeo-kGg.png"/></div></div></figure><p id="c57c" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">我们现在可以看到链代码已安装。现在我们必须实例化它以供进一步使用。</p><p id="e087" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">命令:</p><pre class="jp jq jr js fq jw jx jy jz aw ka dt"><span id="c5d9" class="kb kc ht jx b fv kd ke l kf kg">peer chaincode instantiate -o orderer.food-network.com:7050 -C channelshovon -n foodcode -v 1.0 -l golang   -c  '{"Args":["init"]}' -P "OR('CustomerMSP.peer', 'ImporterMSP.peer','DistributorMSP.peer')" --tls true --cafile $ORDERER_CA</span></pre><p id="ca9d" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">输出将是这样的:</p><figure class="jp jq jr js fq jt fe ff paragraph-image"><div role="button" tabindex="0" class="ld le di lf bf lg"><div class="fe ff ln"><img src="../Images/ce1e303ca7f3079b74c8eeb9a1400871.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*iEt6RKgpYgY6f1E-ESaDHg.png"/></div></div></figure><p id="fd47" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">现在我们可以在链代码中使用函数。首先，我们将初始化一个分类帐以备将来使用。然后我们将使用queryAllStocks、createStock、queryStock、assignStock并查看它们的用法和输出。</p><pre class="jp jq jr js fq jw jx jy jz aw ka dt"><span id="d1ea" class="kb kc ht jx b fv kd ke l kf kg">peer chaincode invoke -o orderer.food-network.com:7050 --tls --cafile $ORDERER_CA  -C channelshovon -n foodcode -c '{"Args":["initLedger"]}</span><span id="6113" class="kb kc ht jx b fv kh ke l kf kg">peer chaincode invoke -o orderer.food-network.com:7050 --tls --cafile $ORDERER_CA  -C channelshovon -n foodcode -c '{"Args":["queryAllStocks"]}'</span><span id="2674" class="kb kc ht jx b fv kh ke l kf kg">peer chaincode invoke -o orderer.food-network.com:7050 --tls --cafile $ORDERER_CA  -C channelshovon -n foodcode -c '{"Args":["createStock", "STOCK7","DuckMeat", "290ton", "BeMt", "Ao"]}'</span><span id="5732" class="kb kc ht jx b fv kh ke l kf kg">peer chaincode invoke -o orderer.food-network.com:7050 --tls --cafile $ORDERER_CA  -C channelshovon -n foodcode -c '{"Args":["queryStock","STOCK5"]}</span><span id="3abb" class="kb kc ht jx b fv kh ke l kf kg">peer chaincode invoke -o orderer.food-network.com:7050 --tls --cafile $ORDERER_CA  -C channelshovon -n foodcode -c '{"Args":["assignStock","STOCK5","ACI"]}'</span></pre><figure class="jp jq jr js fq jt fe ff paragraph-image"><div role="button" tabindex="0" class="ld le di lf bf lg"><div class="fe ff lk"><img src="../Images/a3b3bc6a1d9d5fe826afb9b547e5def0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*yPH6wOkqzzU9kC6W4Y4qmA.png"/></div></div></figure><p id="60ea" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">输出可以在图像中看到。</p><figure class="jp jq jr js fq jt fe ff paragraph-image"><div role="button" tabindex="0" class="ld le di lf bf lg"><div class="fe ff lm"><img src="../Images/4d978eab52e57429a77230150c2dcc0c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZspqWGCd4XzhMJ9Q53jvkg.png"/></div></div></figure><p id="e5ee" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">该链在连接的对等体之间创建共享的分类帐。</p><p id="0f04" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">这是可以在超级分类帐结构网络中部署链码的方式。</p><blockquote class="lo"><p id="259e" class="lp lq ht bd lr ls lt lu lv lw lx jn ek translated"><a class="ae lj" href="https://coincodecap.com/?utm_source=coinmonks" rel="noopener ugc nofollow" target="_blank">在您的收件箱中直接获得最佳软件交易</a></p></blockquote><figure class="lz ma mb mc md jt fe ff paragraph-image"><a href="https://coincodecap.com/?utm_source=coinmonks"><div class="fe ff ly"><img src="../Images/7c0b3dfdcbfea594cc0ae7d4f9bf6fcb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1168/format:webp/0*OJ-qb5G6i863msBB.png"/></div></a></figure><figure class="jp jq jr js fq jt fe ff paragraph-image"><a href="https://coincodecap.com"><div class="fe ff me"><img src="../Images/e9dbce386c4f90837b5db529a4c87766.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5fZu_SfnNF6m_BGbXlsl-A@2x.png"/></div></a></figure></div></div>    
</body>
</html>