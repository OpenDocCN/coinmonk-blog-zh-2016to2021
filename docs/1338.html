<html>
<head>
<title>8 Things To Do Differently in Tensorflow’s Eager Execution Mode</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在Tensorflow的热切执行模式下，需要做的8件不同的事情</h1>
<blockquote>原文：<a href="https://medium.com/coinmonks/8-things-to-do-differently-in-tensorflows-eager-execution-mode-47cf429aa3ad?source=collection_archive---------3-----------------------#2018-08-17">https://medium.com/coinmonks/8-things-to-do-differently-in-tensorflows-eager-execution-mode-47cf429aa3ad?source=collection_archive---------3-----------------------#2018-08-17</a></blockquote><div><div class="ef hh hi hj hk hl"/><div class="hm hn ho hp hq"><div class=""/><p id="d8ff" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">更新:<a class="ae jo" href="https://www.tensorflow.org/beta" rel="noopener ugc nofollow" target="_blank"> Tensorflow 2.0 beta </a>出来了，默认使用急切执行。本文中的许多建议仅适用于Tensorflow的1.x版本。我推荐迁移到2.0！:)</p><p id="31e0" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">Tensorflow 2018开发峰会中我最喜欢的视频<a class="ae jo" href="https://www.youtube.com/watch?v=T8AW0fKP0Hs&amp;t=805s" rel="noopener ugc nofollow" target="_blank">之一是Alex Passos介绍Tensorflow新的热切执行模式的视频。它为不灵活的图形系统提供了一种替代方案，在这种系统中，我们可以简单地用<code class="eh jp jq jr js b">tf.enable_eager_execution()</code>开始我们的文件，然后实际上<em class="jt">在我们创建张量</em>时打印出它们的值，而不必创建一个会话。</a></p><p id="56c6" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">我尝试了我的最后一个项目，一个有趣的小RNN来产生新的口袋妖怪名字。在构建它的时候，我发现使用Eager比使用<code class="eh jp jq jr js b">tf.enable_eager_execution()</code>有更多的好处，尤其是对于我们这些已经习惯了传统Tensorflow做事方式的人来说。一般来说，“远距离操作”的方法对Eager不起作用——如果你想改变一个值，你需要显式地设置它。还有几个重要的Tensorflow库尚未与Eager兼容，而且可能永远也不会兼容，这时您将需要使用一个对Eager友好的替代库。</p><p id="cce5" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">最终，我发现渴望执行更加直观。学习使用它主要是一个<em class="jt">放弃</em>使用会话的过程。</p><figure class="jv jw jx jy fq jz fe ff paragraph-image"><div role="button" tabindex="0" class="ka kb di kc bf kd"><div class="fe ff ju"><img src="../Images/ea8512d94b1d6b0efbadc8ed00b53c2a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mpCwIl9N9e6vIKtDBETIwA.jpeg"/></div></div></figure><h2 id="7df8" class="kg kh ht bd ki kj kk kl km kn ko kp kq jb kr ks kt jf ku kv kw jj kx ky kz la dt translated"><strong class="ak"> #1。导入和设置</strong></h2><p id="7889" class="pw-post-body-paragraph iq ir ht is b it lb iv iw ix lc iz ja jb ld jd je jf le jh ji jj lf jl jm jn hm dt translated">在开始之前，一定要导入渴望的<code class="eh jp jq jr js b">contrib</code>库并启用渴望执行。重要的是使能发生在任何其他张量流代码之前。</p><pre class="jv jw jx jy fq lg js lh li aw lj dt"><span id="5467" class="kg kh ht js b fv lk ll l lm ln">import tensorflow as tf<br/>import tensorflow.contrib.eager as tfe</span><span id="d3c1" class="kg kh ht js b fv lo ll l lm ln">tf.enable_eager_execution()</span></pre><h2 id="e68f" class="kg kh ht bd ki kj kk kl km kn ko kp kq jb kr ks kt jf ku kv kw jj kx ky kz la dt translated">#2.打印张量</h2><p id="4331" class="pw-post-body-paragraph iq ir ht is b it lb iv iw ix lc iz ja jb ld jd je jf le jh ji jj lf jl jm jn hm dt translated">关于Eager模式的最美妙的事情之一是，您可以在每一行看到张量值，而无需在会话中运行它。这使得理解代码中发生的事情和调试变得更加容易。</p><pre class="jv jw jx jy fq lg js lh li aw lj dt"><span id="81d8" class="kg kh ht js b fv lk ll l lm ln">x = tf.constant([[1.,2.,3.],[4.,5.,6.]])<br/>print(x.numpy())<br/>    =&gt; [[1. 2. 3.]<br/>        [4. 5. 6.]]<br/>print(x.shape)<br/>    =&gt; (2,3)<br/>print(x.dtype)<br/>    =&gt; &lt;dtype: ‘float32’&gt;</span></pre><h2 id="de0f" class="kg kh ht bd ki kj kk kl km kn ko kp kq jb kr ks kt jf ku kv kw jj kx ky kz la dt translated">#3.占位符</h2><p id="9265" class="pw-post-body-paragraph iq ir ht is b it lb iv iw ix lc iz ja jb ld jd je jf le jh ji jj lf jl jm jn hm dt translated">在急切模式下不支持占位符。如果你试图创建一个<code class="eh jp jq jr js b">tf.placeholder</code>的实例，你会得到一个错误。这是有意义的，因为占位符是会话工作流的核心部分，而整个Eager的目的就是摆脱会话。相反，只需将数据作为参数传递给函数。反正这个直观多了。</p><h2 id="b603" class="kg kh ht bd ki kj kk kl km kn ko kp kq jb kr ks kt jf ku kv kw jj kx ky kz la dt translated">#4.变量</h2><p id="b1a2" class="pw-post-body-paragraph iq ir ht is b it lb iv iw ix lc iz ja jb ld jd je jf le jh ji jj lf jl jm jn hm dt translated"><code class="eh jp jq jr js b">tf.Variable</code>在急切模式下不受支持，如果您尝试使用它，将会出现错误。相反，使用<code class="eh jp jq jr js b">tfe.Variable</code>，并为该变量传递您想要的初始值。那你就完了！不需要额外初始化变量。你仍然可以从一个<code class="eh jp jq jr js b">Optimizer</code>中更新你的变量。</p><pre class="jv jw jx jy fq lg js lh li aw lj dt"><span id="53eb" class="kg kh ht js b fv lk ll l lm ln">initial_value = tf.random_normal([2,3], stddev=0.2)<br/>w = tfe.Variable(initial_value, name=‘weights’)</span></pre><h2 id="5a8f" class="kg kh ht bd ki kj kk kl km kn ko kp kq jb kr ks kt jf ku kv kw jj kx ky kz la dt translated">#5.迭代数据</h2><p id="10a2" class="pw-post-body-paragraph iq ir ht is b it lb iv iw ix lc iz ja jb ld jd je jf le jh ji jj lf jl jm jn hm dt translated">Eager中仍然使用数据集，但是对它们进行迭代要简单一些。不必创建迭代器并调用<code class="eh jp jq jr js b">iterator.get_next()</code>，您可以简单地迭代数据集本身。</p><pre class="jv jw jx jy fq lg js lh li aw lj dt"><span id="1842" class="kg kh ht js b fv lk ll l lm ln">words = tf.constant([‘cat’, ‘dog’, ‘house’, ‘car’])<br/>dataset = tf.data.Dataset.from_tensor_slices(words)<br/>for x in dataset:<br/>    print x</span></pre><h2 id="ae41" class="kg kh ht bd ki kj kk kl km kn ko kp kq jb kr ks kt jf ku kv kw jj kx ky kz la dt translated">#6.计算梯度</h2><p id="6069" class="pw-post-body-paragraph iq ir ht is b it lb iv iw ix lc iz ja jb ld jd je jf le jh ji jj lf jl jm jn hm dt translated">幸运的是，和Tensorflow的其他部分一样，急切执行支持自动微分。由于<code class="eh jp jq jr js b">tf.gradients</code>不会在eager模式下工作，所以最好使用<em class="jt">梯度带</em>，它可以灵活地跟踪其块内的操作，并根据这些操作构建计算图。下面是一个在培训中如何使用梯度胶带的例子:</p><pre class="jv jw jx jy fq lg js lh li aw lj dt"><span id="0514" class="kg kh ht js b fv lk ll l lm ln">variables = [w1, b1, w2, b2]<br/>optimizer = tf.train.AdamOptimizer()</span><span id="94b7" class="kg kh ht js b fv lo ll l lm ln"><strong class="js hu">with tf.GradientTape() as tape:</strong><br/> y_pred = model.predict(x, variables)<br/> loss = model.compute_loss(y_pred, y)<br/> <strong class="js hu">grads = tape.gradient(loss, variables)</strong><br/> optimizer.apply_gradients(zip(grads, variables))</span></pre><h2 id="3894" class="kg kh ht bd ki kj kk kl km kn ko kp kq jb kr ks kt jf ku kv kw jj kx ky kz la dt translated"><strong class="ak"> #7。记录日志</strong></h2><p id="336b" class="pw-post-body-paragraph iq ir ht is b it lb iv iw ix lc iz ja jb ld jd je jf le jh ji jj lf jl jm jn hm dt translated">要记录训练详情以便在Tensorboard中查看，首先需要将其保存到事件文件中。不幸的是，通常处理这个的<code class="eh jp jq jr js b">tf.summary</code>模块在Eager中不被支持。可以用<code class="eh jp jq jr js b">tf.contrib.summary</code>代替。这里有一个例子:</p><pre class="jv jw jx jy fq lg js lh li aw lj dt"><span id="d57e" class="kg kh ht js b fv lk ll l lm ln">summary_writer = tf.contrib.summary.create_file_writer(‘logs’, flush_millis=10000)<br/>summary_writer.set_as_default()<br/>global_step = tf.train.get_or_create_global_step()</span><span id="4831" class="kg kh ht js b fv lo ll l lm ln">def log_loss(loss):<br/>    with tf.contrib.summary.always_record_summaries:<br/>        tf.contrib.summary.scalar(‘loss’, loss)</span><span id="d9a6" class="kg kh ht js b fv lo ll l lm ln"># In your training loop<br/>global_step.assign_add(1)<br/>loss = some value….<br/>log_loss(loss)</span></pre><h2 id="08b5" class="kg kh ht bd ki kj kk kl km kn ko kp kq jb kr ks kt jf ku kv kw jj kx ky kz la dt translated"><strong class="ak"> #8。保存</strong></h2><p id="52fa" class="pw-post-body-paragraph iq ir ht is b it lb iv iw ix lc iz ja jb ld jd je jf le jh ji jj lf jl jm jn hm dt translated">要在训练中保存检查点，必须使用<code class="eh jp jq jr js b">tfe.Saver </code>而不是<code class="eh jp jq jr js b">tf.train.Saver</code>。急切保存程序不是保存整个会话，而是简单地检查变量的当前值，您可以在以后加载这些值。</p><pre class="jv jw jx jy fq lg js lh li aw lj dt"><span id="0be2" class="kg kh ht js b fv lk ll l lm ln">variables = [w1, b1, w2, b2]<br/>saver = tfe.Saver(variables)<br/># do some training…<br/>saver.save(‘checkpoints/checkpoint.ckpt’, global_step=step)</span></pre><p id="d986" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">要从检查点恢复，可以从检查点文件加载变量列表，如下所示:</p><pre class="jv jw jx jy fq lg js lh li aw lj dt"><span id="d402" class="kg kh ht js b fv lk ll l lm ln">checkpoint_path = tf.train.latest_checkpoint(‘checkpoints’)<br/>saver.restore(checkpoint_path)</span></pre><p id="e77a" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">变量现在将有它们保存的值。</p><blockquote class="lp"><p id="5b8f" class="lq lr ht bd ls lt lu lv lw lx ly jn ek translated">加入Coinmonks <a class="ae jo" href="https://t.me/coincodecap" rel="noopener ugc nofollow" target="_blank">电报频道</a>和<a class="ae jo" href="https://www.youtube.com/c/coinmonks/videos" rel="noopener ugc nofollow" target="_blank"> Youtube频道</a>获取每日<a class="ae jo" href="http://coincodecap.com/" rel="noopener ugc nofollow" target="_blank">加密新闻</a></p></blockquote><h2 id="15d6" class="kg kh ht bd ki kj lz kl km kn ma kp kq jb mb ks kt jf mc kv kw jj md ky kz la dt translated">另外，阅读</h2><ul class=""><li id="20fb" class="me mf ht is b it lb ix lc jb mg jf mh jj mi jn mj mk ml mm dt translated"><a class="ae jo" rel="noopener" href="/coinmonks/top-10-crypto-copy-trading-platforms-for-beginners-d0c37c7d698c">复制交易</a> | <a class="ae jo" rel="noopener" href="/coinmonks/crypto-tax-software-ed4b4810e338">加密税务软件</a></li><li id="723e" class="me mf ht is b it mn ix mo jb mp jf mq jj mr jn mj mk ml mm dt translated"><a class="ae jo" href="https://coincodecap.com/grid-trading" rel="noopener ugc nofollow" target="_blank">网格交易</a> | <a class="ae jo" rel="noopener" href="/coinmonks/the-best-cryptocurrency-hardware-wallets-of-2020-e28b1c124069">加密硬件钱包</a></li><li id="874f" class="me mf ht is b it mn ix mo jb mp jf mq jj mr jn mj mk ml mm dt translated"><a class="ae jo" href="http://Top 4 Telegram Channels for Crypto Traders" rel="noopener ugc nofollow" target="_blank">密码电报信号</a> | <a class="ae jo" rel="noopener" href="/coinmonks/crypto-trading-bot-c2ffce8acb2a">密码交易机器人</a></li><li id="f33b" class="me mf ht is b it mn ix mo jb mp jf mq jj mr jn mj mk ml mm dt translated"><a class="ae jo" rel="noopener" href="/coinmonks/crypto-exchange-dd2f9d6f3769">最佳加密交易所</a> | <a class="ae jo" rel="noopener" href="/coinmonks/bitcoin-exchange-in-india-7f1fe79715c9">印度最佳加密交易所</a></li><li id="47a8" class="me mf ht is b it mn ix mo jb mp jf mq jj mr jn mj mk ml mm dt translated"><a class="ae jo" rel="noopener" href="/coinmonks/best-crypto-apis-for-developers-5efe3a597a9f">面向开发人员的最佳加密API</a></li><li id="b359" class="me mf ht is b it mn ix mo jb mp jf mq jj mr jn mj mk ml mm dt translated">最佳<a class="ae jo" rel="noopener" href="/coinmonks/top-5-crypto-lending-platforms-in-2020-that-you-need-to-know-a1b675cec3fa">密码借贷平台</a></li><li id="9487" class="me mf ht is b it mn ix mo jb mp jf mq jj mr jn mj mk ml mm dt translated">杠杆代币的终极指南</li><li id="3310" class="me mf ht is b it mn ix mo jb mp jf mq jj mr jn mj mk ml mm dt translated"><a class="ae jo" href="https://coincodecap.com/ascendex-staking" rel="noopener ugc nofollow" target="_blank">AscendEx Staking</a>|<a class="ae jo" href="https://coincodecap.com/bot-ocean-review" rel="noopener ugc nofollow" target="_blank">Bot Ocean Review</a>|<a class="ae jo" href="https://coincodecap.com/bitcoin-wallets-india" rel="noopener ugc nofollow" target="_blank">最佳比特币钱包</a></li><li id="15e5" class="me mf ht is b it mn ix mo jb mp jf mq jj mr jn mj mk ml mm dt translated"><a class="ae jo" href="https://coincodecap.com/bitget-review" rel="noopener ugc nofollow" target="_blank"> Bitget评论</a> | <a class="ae jo" href="https://coincodecap.com/gemini-vs-blockfi" rel="noopener ugc nofollow" target="_blank">双子星vs BlockFi </a> | <a class="ae jo" href="https://coincodecap.com/okex-futures-trading" rel="noopener ugc nofollow" target="_blank"> OKEx期货交易</a></li><li id="c009" class="me mf ht is b it mn ix mo jb mp jf mq jj mr jn mj mk ml mm dt translated"><a class="ae jo" href="https://coincodecap.com/crypto-trading-bots-in-the-us" rel="noopener ugc nofollow" target="_blank">美国最佳加密交易机器人</a> | <a class="ae jo" href="https://coincodecap.com/changelly-review" rel="noopener ugc nofollow" target="_blank">经常性回顾</a></li><li id="7716" class="me mf ht is b it mn ix mo jb mp jf mq jj mr jn mj mk ml mm dt translated"><a class="ae jo" href="https://coincodecap.com/crypto-arbitrage-in-india" rel="noopener ugc nofollow" target="_blank">在印度利用加密套利赚取被动收入</a></li><li id="92d8" class="me mf ht is b it mn ix mo jb mp jf mq jj mr jn mj mk ml mm dt translated"><a class="ae jo" href="https://coincodecap.com/huobi-review" rel="noopener ugc nofollow" target="_blank">霍比审核</a> | <a class="ae jo" href="https://coincodecap.com/okex-margin-trading" rel="noopener ugc nofollow" target="_blank"> OKEx保证金交易</a> | <a class="ae jo" href="https://coincodecap.com/futures-trading" rel="noopener ugc nofollow" target="_blank">期货交易</a></li><li id="d179" class="me mf ht is b it mn ix mo jb mp jf mq jj mr jn mj mk ml mm dt translated"><a class="ae jo" href="https://coincodecap.com/sparrow-exchange-review" rel="noopener ugc nofollow" target="_blank">麻雀交换评论</a> | <a class="ae jo" href="https://coincodecap.com/nash-exchange-review" rel="noopener ugc nofollow" target="_blank">纳什交换评论</a></li></ul></div></div>    
</body>
</html>