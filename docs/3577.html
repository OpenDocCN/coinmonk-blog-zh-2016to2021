<html>
<head>
<title>How to set up a Filecoin Lotus node and connect remotely to it</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何设置Filecoin Lotus node并远程连接到它</h1>
<blockquote>原文：<a href="https://medium.com/coinmonks/how-to-set-up-a-filecoin-lotus-node-and-connect-remotely-to-it-208c2f810060?source=collection_archive---------1-----------------------#2020-11-09">https://medium.com/coinmonks/how-to-set-up-a-filecoin-lotus-node-and-connect-remotely-to-it-208c2f810060?source=collection_archive---------1-----------------------#2020-11-09</a></blockquote><div><div class="ef hh hi hj hk hl"/><div class="hm hn ho hp hq"><div class=""/><figure class="fi fk ir is it iu fe ff paragraph-image"><div role="button" tabindex="0" class="iv iw di ix bf iy"><div class="fe ff iq"><img src="../Images/1ea2b1724a6af42313457df1c17de583.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*EdeLaxve4VTYs4YrTweRLw.jpeg"/></div></div></figure><p id="9e7d" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">在包装的Filecoin (WFIL)，我们正在以太坊上开发第一个Filecoin包装的令牌。为了实现我们的目标，我们需要能够详细探索和分析Filecoin的区块链。</p><p id="3950" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">习惯于使用以太坊，我们可以很快想到几个工具来做到这一点，但目前，Fielecoin还处于非常早期的阶段，这些工具还不可用。</p><p id="c4f3" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">所以我们决定建立我们自己的Lotus node，并配置它允许我们从后端API调用它的JSON RPC方法。我们遵循的主要说明位于这里:<a class="ae jz" href="https://docs.filecoin.io/get-started/lotus/installation/" rel="noopener ugc nofollow" target="_blank"> Filecoin Lotus安装文档</a>但是由于我们需要修改一些步骤，我们认为值得分享它，并帮助任何有相同问题的人。</p></div><div class="ab cl ka kb hb kc" role="separator"><span class="kd bw bk ke kf kg"/><span class="kd bw bk ke kf kg"/><span class="kd bw bk ke kf"/></div><div class="hm hn ho hp hq"><h2 id="c532" class="kh ki ht bd kj kk kl km kn ko kp kq kr jm ks kt ku jq kv kw kx ju ky kz la lb dt translated">1.启动虚拟服务器并通过SSH连接</h2><p id="389a" class="pw-post-body-paragraph jb jc ht jd b je lc jg jh ji ld jk jl jm le jo jp jq lf js jt ju lg jw jx jy hm dt translated">在我们的例子中，我们使用AWS作为云提供商，所以我们设置了一个m5ad.2xlarge类型的EC2。这里对<strong class="jd hu">选择Ubuntu Server 20.04 LTS </strong>很重要，因为安装Lotus和Go所需的所有工具和库在亚马逊Linux系统上都不可用。</p><p id="7466" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">要通过SSH连接到AWS实例，请确保已经将安全组配置为允许通过端口22进行远程访问。之后，您应该使用在启动实例时生成的PEM证书，但是首先，让我们设置能够使用它的适当权限:</p><pre class="lh li lj lk fq ll lm ln lo aw lp dt"><span id="09c5" class="kh ki ht lm b fv lq lr l ls lt">chmod 400 &lt;path-to-pem-file&gt;</span></pre><p id="1d49" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">现在我们可以连接到EC2实例:</p><pre class="lh li lj lk fq ll lm ln lo aw lp dt"><span id="0762" class="kh ki ht lm b fv lq lr l ls lt">ssh -i &lt;path-to-pem-file&gt; ubuntu@&lt;ip-of-your-instance&gt;</span></pre><h2 id="643b" class="kh ki ht bd kj kk kl km kn ko kp kq kr jm ks kt ku jq kv kw kx ju ky kz la lb dt translated">2.安装依赖项，运行并生锈</h2><p id="f596" class="pw-post-body-paragraph jb jc ht jd b je lc jg jh ji ld jk jl jm le jo jp jq lf js jt ju lg jw jx jy hm dt translated">这里没什么可做的，我们只需遵循Filecoin网站上的指南即可:</p><p id="17d9" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">依赖关系:</p><pre class="lh li lj lk fq ll lm ln lo aw lp dt"><span id="fe7e" class="kh ki ht lm b fv lq lr l ls lt">sudo apt install mesa-opencl-icd ocl-icd-opencl-dev gcc git bzr jq pkg-config curl clang build-essential libhwloc-dev -y &amp;&amp; sudo apt upgrade -y</span></pre><p id="93b1" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">Rustp:</p><pre class="lh li lj lk fq ll lm ln lo aw lp dt"><span id="85dc" class="kh ki ht lm b fv lq lr l ls lt">curl --proto '=https' --tlsv1.2 -sSf <a class="ae jz" href="https://sh.rustup.rs" rel="noopener ugc nofollow" target="_blank">https://sh.rustup.rs</a> | sh</span></pre><p id="67bd" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">去吧:</p><pre class="lh li lj lk fq ll lm ln lo aw lp dt"><span id="0b8d" class="kh ki ht lm b fv lq lr l ls lt">wget -c <a class="ae jz" href="https://dl.google.com/go/go1.14.7.linux-amd64.tar.gz" rel="noopener ugc nofollow" target="_blank">https://dl.google.com/go/go1.14.7.linux-amd64.tar.gz</a> -O - | sudo tar -xz -C /usr/local</span></pre><h2 id="490e" class="kh ki ht bd kj kk kl km kn ko kp kq kr jm ks kt ku jq kv kw kx ju ky kz la lb dt translated">3.配置环境变量</h2><p id="a085" class="pw-post-body-paragraph jb jc ht jd b je lc jg jh ji ld jk jl jm le jo jp jq lf js jt ju lg jw jx jy hm dt translated">文档中没有很好地解释这一步，如果你不熟悉处理这类软件，这可能是一个棘手的部分。</p><p id="2380" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">首先，我们应该向环境配置中添加变量。让我们打开bash概要文件:</p><pre class="lh li lj lk fq ll lm ln lo aw lp dt"><span id="45d1" class="kh ki ht lm b fv lq lr l ls lt">nano ~/.bashrc</span></pre><p id="e090" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">通过在文件末尾添加以下行，为go和rust添加变量:</p><pre class="lh li lj lk fq ll lm ln lo aw lp dt"><span id="0c8a" class="kh ki ht lm b fv lq lr l ls lt">export PATH=$PATH:/usr/local/go/bin<br/>export PATH=$PATH:/home/ubuntu/.cargo/bin</span></pre><p id="565d" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">获取文件或重启终端:</p><pre class="lh li lj lk fq ll lm ln lo aw lp dt"><span id="ee96" class="kh ki ht lm b fv lq lr l ls lt">source ~/.bashrc</span></pre><h2 id="392b" class="kh ki ht bd kj kk kl km kn ko kp kq kr jm ks kt ku jq kv kw kx ju ky kz la lb dt translated">4.安装并启动Lotus守护程序</h2><p id="e686" class="pw-post-body-paragraph jb jc ht jd b je lc jg jh ji ld jk jl jm le jo jp jq lf js jt ju lg jw jx jy hm dt translated">和以前一样，我们只是执行给定的命令。</p><p id="84cb" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">克隆存储库:</p><pre class="lh li lj lk fq ll lm ln lo aw lp dt"><span id="f15b" class="kh ki ht lm b fv lq lr l ls lt">git clone <a class="ae jz" href="https://github.com/filecoin-project/lotus.git" rel="noopener ugc nofollow" target="_blank">https://github.com/filecoin-project/lotus.git</a></span></pre><p id="e5c3" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">检查你选择的分支(mainnet或任何testnet)。我们选择校准，因为它是最能模拟mainnet的测试网络:</p><pre class="lh li lj lk fq ll lm ln lo aw lp dt"><span id="4caf" class="kh ki ht lm b fv lq lr l ls lt">git checkout ntwk-calibration</span></pre><p id="bc9d" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">构建和安装</p><pre class="lh li lj lk fq ll lm ln lo aw lp dt"><span id="fb9f" class="kh ki ht lm b fv lq lr l ls lt">make clean all<br/>sudo make install</span></pre><p id="cd3c" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">检查版本:</p><pre class="lh li lj lk fq ll lm ln lo aw lp dt"><span id="32ec" class="kh ki ht lm b fv lq lr l ls lt">lotus --version #should output something like lotus version 1.1.0+git.b039f44a</span></pre><h2 id="4763" class="kh ki ht bd kj kk kl km kn ko kp kq kr jm ks kt ku jq kv kw kx ju ky kz la lb dt translated">5.允许远程连接</h2><p id="4c44" class="pw-post-body-paragraph jb jc ht jd b je lc jg jh ji ld jk jl jm le jo jp jq lf js jt ju lg jw jx jy hm dt translated">打开lotus配置<code class="eh lu lv lw lm b">~/.lotus/config.toml</code>。您将看到要配置的不同部分，以及您可以设置的值的示例。我们对ListenAddress和RemoteListenAddress值的API部分感兴趣。删除他们的注释，并为每个注释设置以下值:</p><pre class="lh li lj lk fq ll lm ln lo aw lp dt"><span id="07d3" class="kh ki ht lm b fv lq lr l ls lt">ListenAddress = "/ip4/0.0.0.0/tcp/4001/http"<br/>RemoteListenAddress = "/ip4/xxx.xxx.xxx.xxx/tcp/4001/http"</span></pre><p id="4b81" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">确保用您的实例<strong class="jd hu">公共IP </strong>替换<code class="eh lu lv lw lm b">xxx.xxx.xxx.xxx</code>，并设置最适合您的端口(还要注意，这个端口也应该在您的EC2实例的安全组上打开)。</p><p id="227b" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">启动守护程序:</p><pre class="lh li lj lk fq ll lm ln lo aw lp dt"><span id="c619" class="kh ki ht lm b fv lq lr l ls lt">lotus daemon</span></pre><p id="5b43" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">创建一个令牌来远程访问它(例如作为管理员)</p><pre class="lh li lj lk fq ll lm ln lo aw lp dt"><span id="1a3b" class="kh ki ht lm b fv lq lr l ls lt">lotus auth create-token --perm admin</span></pre><p id="1746" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">使用令牌从不同的计算机调用您的实例，并测试我们所做的一切:</p><pre class="lh li lj lk fq ll lm ln lo aw lp dt"><span id="30bc" class="kh ki ht lm b fv lq lr l ls lt">curl -X POST      -H "Content-Type: application/json"      -H "Authorization: Bearer &lt;the-token-you-just-generated&gt;"      --data '{ "jsonrpc": "2.0", "method": "Filecoin.Version", "params": [], "id": 1 }'      '<a class="ae jz" href="http://54.216.161.54:5000/rpc/v0'" rel="noopener ugc nofollow" target="_blank">http://xxx.xxx.xxx.xxx:4001/rpc/v0'</a></span></pre><p id="c762" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">输出应该是如下所示的JSON响应:</p><pre class="lh li lj lk fq ll lm ln lo aw lp dt"><span id="2971" class="kh ki ht lm b fv lq lr l ls lt">{"jsonrpc":"2.0","result":{"Version":"1.1.0+git.b039f44a","APIVersion":4352,"BlockDelay":30},"id":1}</span></pre><h2 id="ee03" class="kh ki ht bd kj kk kl km kn ko kp kq kr jm ks kt ku jq kv kw kx ju ky kz la lb dt translated">6.[奖励]设置pm2总是启动守护进程</h2><p id="0c1f" class="pw-post-body-paragraph jb jc ht jd b je lc jg jh ji ld jk jl jm le jo jp jq lf js jt ju lg jw jx jy hm dt translated">如果实例重新启动或守护进程停止，我们应该意识到这一点，连接到实例，并重新启动守护进程。在这些情况下，拥有一个像pm2这样的库可以省去很多麻烦，并在需要时重启守护进程。</p><p id="7d1f" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">要配置它，您应该安装NodeJS、NPM和pm2:</p><pre class="lh li lj lk fq ll lm ln lo aw lp dt"><span id="2730" class="kh ki ht lm b fv lq lr l ls lt">sudo apt install nodejs<br/>sudo apt install npm<br/>npm install pm2@latest -g</span></pre><p id="117d" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">然后，我们应该创建一行shell脚本来启动守护程序，配置pm2，并使它能够启动它:</p><pre class="lh li lj lk fq ll lm ln lo aw lp dt"><span id="3ae3" class="kh ki ht lm b fv lq lr l ls lt">echo lotus daemon &gt;&gt; start-lotus-daemon.sh<br/>sudo env PATH=$PATH:/usr/bin /usr/local/lib/node_modules/pm2/bin/pm2 startup systemd -u ubuntu --hp /home/ubuntu/start-lotus-daemon.sh</span></pre><p id="5d7d" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">从pm2启动守护程序</p><pre class="lh li lj lk fq ll lm ln lo aw lp dt"><span id="27b9" class="kh ki ht lm b fv lq lr l ls lt">pm2 start start-lotus-daemon.sh</span></pre><p id="5f0e" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">并随时监控它:</p><pre class="lh li lj lk fq ll lm ln lo aw lp dt"><span id="40d7" class="kh ki ht lm b fv lq lr l ls lt">pm2 monit</span></pre><h2 id="d9e0" class="kh ki ht bd kj kk kl km kn ko kp kq kr jm ks kt ku jq kv kw kx ju ky kz la lb dt translated">结论</h2><p id="2eaa" class="pw-post-body-paragraph jb jc ht jd b je lc jg jh ji ld jk jl jm le jo jp jq lf js jt ju lg jw jx jy hm dt translated">建立自己的Lotus node似乎是一项艰巨的工作，但是完全控制从Filecoin的区块链获得的数据是非常值得的。</p><p id="ac2a" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">请随时查看<a class="ae jz" href="https://www.wfil.network/#/" rel="noopener ugc nofollow" target="_blank"> WFIL dapp </a>并让我们知道您的任何想法。我们真的希望与社区携手在以太坊上构建第一个Filecoin包装的令牌。</p><p id="cdeb" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">特别感谢<a class="ae jz" href="https://twitter.com/swarooph" rel="noopener ugc nofollow" target="_blank">斯瓦鲁普</a>和<a class="ae jz" href="https://www.linkedin.com/in/mostafa-farghaly" rel="noopener ugc nofollow" target="_blank">穆斯塔法</a>在这个过程中给予的所有帮助。</p><h2 id="4972" class="kh ki ht bd kj kk kl km kn ko kp kq kr jm ks kt ku jq kv kw kx ju ky kz la lb dt translated">另外，阅读</h2><ul class=""><li id="51e2" class="lx ly ht jd b je lc ji ld jm lz jq ma ju mb jy mc md me mf dt translated">最好的<a class="ae jz" rel="noopener" href="/coinmonks/the-best-cryptocurrency-hardware-wallets-of-2020-e28b1c124069?source=friends_link&amp;sk=324dd9ff8556ab578d71e7ad7658ad7c">硬件钱包</a></li></ul></div></div>    
</body>
</html>