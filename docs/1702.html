<html>
<head>
<title>How to interact with Smart contract using JAVA</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何使用JAVA与智能合同交互</h1>
<blockquote>原文：<a href="https://medium.com/coinmonks/how-to-interact-with-smart-contract-using-java-f5b1ce7324e7?source=collection_archive---------1-----------------------#2018-10-25">https://medium.com/coinmonks/how-to-interact-with-smart-contract-using-java-f5b1ce7324e7?source=collection_archive---------1-----------------------#2018-10-25</a></blockquote><div><div class="ef hh hi hj hk hl"/><div class="hm hn ho hp hq"><div class=""/><p id="b4a0" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">本文重点介绍如何通过Web3j与智能合约交互，调用函数，部署新的智能合约到以太网</p><figure class="jo jp jq jr fq js fe ff paragraph-image"><div class="ab fr cl jt"><img src="../Images/08fd4bbb47714b8054a20697e1f1480d.png" data-original-src="https://miro.medium.com/v2/format:webp/0*3cZCP9IOizr6ePbK.png"/></div><figcaption class="jw jx fg fe ff jy jz bd b be z ek"><a class="ae ka" href="https://web3j.readthedocs.io/en/latest/index.html" rel="noopener ugc nofollow" target="_blank">https://web3j.readthedocs.io/en/latest/index.html</a></figcaption></figure><h1 id="7569" class="kb kc ht bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky dt translated">WEB3J</h1><p id="962c" class="pw-post-body-paragraph iq ir ht is b it kz iv iw ix la iz ja jb lb jd je jf lc jh ji jj ld jl jm jn hm dt translated">该SDK是开发与以太坊区块链网络连接的软件的强大框架</p><p id="bdbd" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">准备一个<strong class="is hu">以太坊完全节点</strong>来连接以太坊区块链网络或者你可以使用<a class="ae ka" href="https://infura.io/" rel="noopener ugc nofollow" target="_blank"> Infura </a>来代替建造你自己的节点。</p><p id="5567" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">将<em class="le"> Web3j依赖</em>添加到pom文件中:</p><pre class="jo jp jq jr fq lf lg lh li aw lj dt"><span id="8f07" class="lk kc ht lg b fv ll lm l ln lo">&lt;!-- https://mvnrepository.com/artifact/org.web3j/core --&gt;<br/>&lt;dependency&gt;<br/>    &lt;groupId&gt;org.web3j&lt;/groupId&gt;<br/>    &lt;artifactId&gt;core&lt;/artifactId&gt;<br/>    &lt;version&gt;3.5.0&lt;/version&gt;<br/>&lt;/dependency&gt;<br/><br/>&lt;!-- https://mvnrepository.com/artifact/org.web3j/parity --&gt;<br/>&lt;dependency&gt;<br/>    &lt;groupId&gt;org.web3j&lt;/groupId&gt;<br/>    &lt;artifactId&gt;parity&lt;/artifactId&gt;<br/>    &lt;version&gt;3.5.0&lt;/version&gt;<br/>&lt;/dependency&gt;<br/><br/>&lt;!-- https://mvnrepository.com/artifact/org.web3j/parity --&gt;<br/>&lt;dependency&gt;<br/>    &lt;groupId&gt;org.web3j&lt;/groupId&gt;<br/>    &lt;artifactId&gt;crypto&lt;/artifactId&gt;<br/>    &lt;version&gt;3.5.0&lt;/version&gt;<br/>&lt;/dependency&gt;<br/><br/>&lt;!-- https://mvnrepository.com/artifact/org.web3j/parity --&gt;<br/>&lt;dependency&gt;<br/>    &lt;groupId&gt;org.web3j&lt;/groupId&gt;<br/>    &lt;artifactId&gt;abi&lt;/artifactId&gt;<br/>    &lt;version&gt;3.5.0&lt;/version&gt;<br/>&lt;/dependency&gt;<br/><br/>&lt;!-- https://mvnrepository.com/artifact/org.web3j/parity --&gt;<br/>&lt;dependency&gt;<br/>    &lt;groupId&gt;org.web3j&lt;/groupId&gt;<br/>    &lt;artifactId&gt;codegen&lt;/artifactId&gt;<br/>    &lt;version&gt;3.5.0&lt;/version&gt;<br/>&lt;/dependency&gt;</span></pre><p id="2cc0" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">这是一个启动web3j客户端与网络交互的示例:</p><pre class="jo jp jq jr fq lf lg lh li aw lj dt"><span id="5f09" class="lk kc ht lg b fv ll lm l ln lo">package org.blockchain.services.ethereum;<br/><br/>import org.blockchain.config.AppContext;<br/>import org.web3j.crypto.WalletFile;<br/>import org.web3j.protocol.Web3j;<br/>import org.web3j.protocol.Web3jService;<br/>import org.web3j.protocol.core.DefaultBlockParameterNumber;<br/>import org.web3j.protocol.core.Request;<br/>import org.web3j.protocol.http.HttpService;<br/>import org.web3j.protocol.parity.Parity;<br/>import org.web3j.protocol.parity.methods.response.ParityExportAccount;<br/>import org.web3j.protocol.parity.methods.response.ParityTracesResponse;<br/>import org.web3j.protocol.parity.methods.response.Trace;<br/><br/>import java.util.List;<br/><br/>public class <strong class="lg hu">Web3JClient</strong> {<br/>    private static Web3jService <strong class="lg hu"><em class="le">service</em></strong><em class="le"> </em>= new HttpService("http://localhost:8545"); // put fullnode url here<br/>    private static Web3j <strong class="lg hu"><em class="le">web3j</em></strong><em class="le"> </em>= Web3j.<em class="le">build</em>(<em class="le">service</em>);<br/>    private static Parity <strong class="lg hu"><em class="le">parity</em></strong><em class="le"> </em>= Parity.<em class="le">build</em>(<em class="le">service</em>);<br/><br/>    public static List&lt;Trace&gt; getCallActionsInBlock(long blockNum) throws Exception {<br/>        DefaultBlockParameterNumber number = new DefaultBlockParameterNumber(blockNum);<br/>        Request&lt;?, ParityTracesResponse&gt; request = <strong class="lg hu"><em class="le">parity</em></strong>.traceBlock(number);<br/>        ParityTracesResponse response = request.send();<br/>        return response.getTraces();<br/>    }<br/><br/>    public static List&lt;Trace&gt; getCallAction(String hash) throws Exception {<br/>        Request&lt;?, ParityTracesResponse&gt; request = <strong class="lg hu"><em class="le">parity</em></strong>.traceTransaction(hash);<br/>        ParityTracesResponse response = request.send();<br/>        return response.getTraces();<br/>    }<br/><br/>    public static WalletFile exportAccount(String address, String password) throws Exception {<br/>        Request&lt;?, ParityExportAccount&gt; request = <strong class="lg hu"><em class="le">parity</em></strong>.parityExportAccount(address, password);<br/>        ParityExportAccount response = request.send();<br/>        return response.getWallet();<br/>    }<br/><br/>    public static void main(String[] args) throws Exception {<br/>// test function here</span><span id="6891" class="lk kc ht lg b fv lp lm l ln lo">    }<br/>}</span></pre><h1 id="1838" class="kb kc ht bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky dt translated">与智能合同交互</h1><ol class=""><li id="572c" class="lq lr ht is b it kz ix la jb ls jf lt jj lu jn lv lw lx ly dt translated"><strong class="is hu">准备</strong>:</li></ol><ul class=""><li id="b141" class="lq lr ht is b it iu ix iy jb lz jf ma jj mb jn mc lw lx ly dt translated">准备合同。例如，我将使用<strong class="is hu"> ERC20.sol </strong>与ERC20令牌智能合约进行交互。这里可以找到<a class="ae ka" href="https://github.com/OpenZeppelin/openzeppelin-solidity/blob/master/contracts/token/ERC20/ERC20.sol" rel="noopener ugc nofollow" target="_blank"/></li><li id="6659" class="lq lr ht is b it md ix me jb mf jf mg jj mh jn mc lw lx ly dt translated">下载<a class="ae ka" href="https://github.com/ethereum/solidity/releases" rel="noopener ugc nofollow" target="_blank"> <strong class="is hu"> solidity编译器</strong> </a>，提取并添加导出环境变量<strong class="is hu">。</strong>编译器用于将ERC20.sol编译成二进制格式。</li><li id="ce01" class="lq lr ht is b it md ix me jb mf jf mg jj mh jn mc lw lx ly dt translated">为<a class="ae ka" href="https://github.com/web3j/web3j/releases/tag/v3.6.0" rel="noopener ugc nofollow" target="_blank"> <strong class="is hu"> web3j脚本</strong> </a>下载、提取并添加环境变量。这个脚本可以从solidity二进制文件生成java类。它包括linux和windows的版本脚本。</li></ul><p id="f875" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated"><strong class="is hu"> 2。将Solidity契约翻译成Java类:</strong></p><p id="12f8" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">首先，我们需要编译一个solidity代码为<em class="le">二进制</em>和<em class="le"> abi </em>格式。</p><ul class=""><li id="df7e" class="lq lr ht is b it iu ix iy jb lz jf ma jj mb jn mc lw lx ly dt translated">首先使用solidity编译器包中的<strong class="is hu"> solc </strong>编译合同:</li></ul><pre class="jo jp jq jr fq lf lg lh li aw lj dt"><span id="b711" class="lk kc ht lg b fv ll lm l ln lo">solc &lt;contract&gt;.sol --bin --abi --optimize -o &lt;output-dir&gt;/</span></pre><figure class="jo jp jq jr fq js fe ff paragraph-image"><div role="button" tabindex="0" class="mj mk di ml bf mm"><div class="fe ff mi"><img src="../Images/a0683e20c2c4c2208c3efbd377c0e647.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lGZHvlfMVWeRjGTOnyIu7g.png"/></div></div><figcaption class="jw jx fg fe ff jy jz bd b be z ek">compile contract into folder ../compiled</figcaption></figure><figure class="jo jp jq jr fq js fe ff paragraph-image"><div class="fe ff mn"><img src="../Images/47b1abe7858931ca49a4c9d0f9df77f5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1272/format:webp/1*-gDxuFN5H1DX6m_2VQofWw.png"/></div><figcaption class="jw jx fg fe ff jy jz bd b be z ek">After compile</figcaption></figure><p id="2f59" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">编译后我们会有两个文件:<em class="le"> ERC20.abi </em>和<em class="le"> ERC20.bin </em></p><ul class=""><li id="a0ba" class="lq lr ht is b it iu ix iy jb lz jf ma jj mb jn mc lw lx ly dt translated">使用web3j.bat (windows)将编译后的契约导入到您的项目中。通用命令:</li></ul><pre class="jo jp jq jr fq lf lg lh li aw lj dt"><span id="27b7" class="lk kc ht lg b fv ll lm l ln lo">web3j solidity generate [--javaTypes|--solidityTypes] /path/to/&lt;smart-contract&gt;.bin /path/to/&lt;smart-contract&gt;.abi -o /path/to/src/main/java -p com.your.organisation.name</span></pre><figure class="jo jp jq jr fq js fe ff paragraph-image"><div role="button" tabindex="0" class="mj mk di ml bf mm"><div class="fe ff mo"><img src="../Images/921f6870a656edf26100c2c0ec2bae60.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*j0zNJGEmikm4GyssvjSutQ.png"/></div></div><figcaption class="jw jx fg fe ff jy jz bd b be z ek">generate java class from compiled contract</figcaption></figure><figure class="jo jp jq jr fq js fe ff paragraph-image"><div role="button" tabindex="0" class="mj mk di ml bf mm"><div class="fe ff mp"><img src="../Images/6563ca77d33fe152983a2c2c0f0153e4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*p5-G_sjItNAk_gn1R46jDw.png"/></div></div><figcaption class="jw jx fg fe ff jy jz bd b be z ek">this is java contract class</figcaption></figure><p id="cc08" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated"><strong class="is hu">部署并调用合同中的函数:</strong></p><p id="61e5" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated"><strong class="is hu"> * <em class="le">注意</em> : </strong> <em class="le"> Erc20我这里用的是接口，所以deploy步骤是例子，不起作用。试试你自己的合同，看看有什么不同。</em></p><pre class="jo jp jq jr fq lf lg lh li aw lj dt"><span id="d3c1" class="lk kc ht lg b fv ll lm l ln lo">package org.blockchain.services.ethereum;<br/><br/>import org.blockchain.model.ethereum.ERC20;<br/>import org.web3j.crypto.Credentials;<br/>import org.web3j.crypto.ECKeyPair;<br/>import org.web3j.crypto.WalletFile;<br/>import org.web3j.protocol.Web3j;<br/>import org.web3j.protocol.Web3jService;<br/>import org.web3j.protocol.core.DefaultBlockParameterNumber;<br/>import org.web3j.protocol.core.Request;<br/>import org.web3j.protocol.core.methods.response.TransactionReceipt;<br/>import org.web3j.protocol.http.HttpService;<br/>import org.web3j.protocol.parity.Parity;<br/>import org.web3j.protocol.parity.methods.response.ParityExportAccount;<br/>import org.web3j.protocol.parity.methods.response.ParityTracesResponse;<br/>import org.web3j.protocol.parity.methods.response.Trace;<br/>import org.web3j.tx.FastRawTransactionManager;<br/>import org.web3j.tx.TransactionManager;<br/>import org.web3j.tx.gas.DefaultGasProvider;<br/>import org.web3j.tx.response.NoOpProcessor;<br/><br/>import java.math.BigInteger;<br/>import java.util.List;<br/><br/>public class Web3JClient {</span><span id="3b2d" class="lk kc ht lg b fv lp lm l ln lo">    private static Web3jService <em class="le">service </em>= new HttpService("http://localhost:8545");<br/>    private static Web3j <em class="le">web3j </em>= Web3j.<em class="le">build</em>(<em class="le">service</em>);<br/>    private static Parity <em class="le">parity </em>= Parity.<em class="le">build</em>(<em class="le">service</em>);</span><span id="8d76" class="lk kc ht lg b fv lp lm l ln lo">    public static void main(String[] args) throws Exception {<br/>        <em class="le">/**<br/>         *  </em><strong class="lg hu"><em class="le">TEST DEPLOY AND CALL CONTRACT FUNCTION</em></strong><em class="le"><br/>        */<br/>        </em>// load private key into eckey to sign<br/>        <strong class="lg hu">String</strong> <em class="le">privatekey</em> = "***********************************";<br/>        <strong class="lg hu">BigInteger</strong> <em class="le">privkey</em> = new <strong class="lg hu">BigInteger</strong>(privatekey, 16);<br/>        <strong class="lg hu">ECKeyPair</strong> <em class="le">ecKeyPair</em> = <strong class="lg hu">ECKeyPair</strong>.<em class="le">create</em>(privkey);<br/>        <strong class="lg hu">Credentials</strong> <em class="le">credentials</em> = <strong class="lg hu">Credentials</strong>.<em class="le">create</em>(ecKeyPair);<br/>        <strong class="lg hu">NoOpProcessor</strong> <em class="le">processor</em> = new <strong class="lg hu">NoOpProcessor</strong>(<em class="le">web3j</em>);<br/><br/>        //deploy new contract<br/>        <strong class="lg hu">TransactionManager</strong> <em class="le">txManager</em> = new <strong class="lg hu">FastRawTransactionManager</strong>(<em class="le">web3j</em>, credentials, processor);<br/><br/>        <strong class="lg hu">RemoteCall</strong>&lt;ERC20&gt; <em class="le">request</em> = <strong class="lg hu">ERC20</strong>.<em class="le">deploy</em>(<em class="le">web3j</em>, txManager, <strong class="lg hu">DefaultGasProvider</strong>.<em class="le">GAS_PRICE</em>, <strong class="lg hu">DefaultGasProvider</strong>.<em class="le">GAS_LIMIT</em>);<br/>        <strong class="lg hu">ERC20</strong> token = request.send();<br/>        <strong class="lg hu">String</strong> contractAddress = token.getDeployedAddress("3"); // 3 is ropsten testnet<br/><br/>        // load existing contract by address<br/>        // ERC20 token = ERC20.load(contractAddress, web3j, txManager, DefaultGasProvider.GAS_PRICE, DefaultGasProvider.GAS_LIMIT);<br/><br/><br/>        // create transaction transfer token to receiver<br/>        <strong class="lg hu">String</strong> <em class="le">receiver</em> = "0xa107483c8a16a58871182a48d4ba1fbbb6a*****";<br/>        <strong class="lg hu">BigInteger</strong> <em class="le">value</em> = new <strong class="lg hu">BigInteger</strong>("10000000000000");<br/>        <strong class="lg hu">TransactionReceipt</strong> <em class="le">receipt</em> = <em class="le">token</em>.transfer(receiver, value).send();<br/>        // get transaction result<br/>        System.<em class="le">out</em>.println(<em class="le">receipt</em>.getTransactionHash());<br/>    }<br/>}</span></pre><h1 id="40c4" class="kb kc ht bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky dt translated">结论</h1><p id="150f" class="pw-post-body-paragraph iq ir ht is b it kz iv iw ix la iz ja jb lb jd je jf lc jh ji jj ld jl jm jn hm dt translated">上面的例子是一个通过Java与以太坊智能合约交互的简单演示。希望对此有所帮助。</p><p id="da16" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">Web3j中有很多特性支持我们连接以太坊区块链网络。你可以在这里找到:【https://web3j.readthedocs.io/en/latest/index.html】T42</p><p id="bd22" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">请在下面留下您的评论:)。</p><p id="bf8e" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">谢谢你们的掌声！:)</p><blockquote class="mq"><p id="06b6" class="mr ms ht bd mt mu mv mw mx my mz jn ek translated">加入Coinmonks <a class="ae ka" href="https://t.me/coincodecap" rel="noopener ugc nofollow" target="_blank">电报频道</a>和<a class="ae ka" href="https://www.youtube.com/c/coinmonks/videos" rel="noopener ugc nofollow" target="_blank"> Youtube频道</a>获取每日<a class="ae ka" href="http://coincodecap.com/" rel="noopener ugc nofollow" target="_blank">加密新闻</a></p></blockquote><h2 id="15d6" class="lk kc ht bd kd na nb nc kh nd ne nf kl jb ng nh kp jf ni nj kt jj nk nl kx nm dt translated">另外，阅读</h2><ul class=""><li id="20fb" class="lq lr ht is b it kz ix la jb ls jf lt jj lu jn mc lw lx ly dt translated"><a class="ae ka" rel="noopener" href="/coinmonks/top-10-crypto-copy-trading-platforms-for-beginners-d0c37c7d698c">复制交易</a> | <a class="ae ka" rel="noopener" href="/coinmonks/crypto-tax-software-ed4b4810e338">加密税务软件</a></li><li id="723e" class="lq lr ht is b it md ix me jb mf jf mg jj mh jn mc lw lx ly dt translated"><a class="ae ka" href="https://coincodecap.com/grid-trading" rel="noopener ugc nofollow" target="_blank">网格交易</a> | <a class="ae ka" rel="noopener" href="/coinmonks/the-best-cryptocurrency-hardware-wallets-of-2020-e28b1c124069">加密硬件钱包</a></li><li id="874f" class="lq lr ht is b it md ix me jb mf jf mg jj mh jn mc lw lx ly dt translated"><a class="ae ka" href="http://Top 4 Telegram Channels for Crypto Traders" rel="noopener ugc nofollow" target="_blank">密码电报信号</a> | <a class="ae ka" rel="noopener" href="/coinmonks/crypto-trading-bot-c2ffce8acb2a">密码交易机器人</a></li><li id="f33b" class="lq lr ht is b it md ix me jb mf jf mg jj mh jn mc lw lx ly dt translated"><a class="ae ka" rel="noopener" href="/coinmonks/crypto-exchange-dd2f9d6f3769">最佳加密交易所</a> | <a class="ae ka" rel="noopener" href="/coinmonks/bitcoin-exchange-in-india-7f1fe79715c9">印度最佳加密交易所</a></li><li id="47a8" class="lq lr ht is b it md ix me jb mf jf mg jj mh jn mc lw lx ly dt translated">开发人员的最佳加密API</li><li id="b359" class="lq lr ht is b it md ix me jb mf jf mg jj mh jn mc lw lx ly dt translated">最佳<a class="ae ka" rel="noopener" href="/coinmonks/top-5-crypto-lending-platforms-in-2020-that-you-need-to-know-a1b675cec3fa">密码借贷平台</a></li><li id="3c98" class="lq lr ht is b it md ix me jb mf jf mg jj mh jn mc lw lx ly dt translated"><a class="ae ka" rel="noopener" href="/coinmonks/free-crypto-signals-48b25e61a8da">免费加密信号</a> | <a class="ae ka" rel="noopener" href="/coinmonks/crypto-trading-bot-c2ffce8acb2a">加密交易机器人</a></li><li id="9487" class="lq lr ht is b it md ix me jb mf jf mg jj mh jn mc lw lx ly dt translated"><a class="ae ka" rel="noopener" href="/coinmonks/leveraged-token-3f5257808b22">杠杆代币</a>终极指南</li></ul></div></div>    
</body>
</html>