# 如何在定额组中躲过毒气诅咒？

> 原文：<https://medium.com/coinmonks/how-to-survive-the-gas-curse-in-quorum-7b2c8fea2540?source=collection_archive---------0----------------------->

![](img/4df8d264bf64be5325ebe648b0205ae5.png)

你们可能都知道，我们最近在阿拉斯特里亚的测试网上遇到了一些问题，追踪这些问题并不容易。起初，网络停止开采新的区块，完全拖延了区块链。正如我们在之前的帖子、**中简要分析的[，这是由于太多的验证器离线或失败](/@adlrocha/who-to-blame-in-a-distributed-world-c9a00fe8773c)**，使得 IBFT 共识无法验证新的区块。这是问题之一，而且令人惊讶的是，这个问题很容易追踪。一旦我们恢复了足够多的验证器节点，网络就开始验证新的块，但是**这些块是空的**，即使队列中有事务。为什么会发生这种情况？

在***Marcos Serradilla***(来自核心技术团队)和我**进行了几次调查后，我们发现问题与所有这些排队的事务以及 Quorum 对 gas 的管理**有关。当我们在 Quorum 中执行事务时，我们必须确保为该事务定义的 gas 限制高于执行该事务所需的限制(即使*【理论上】* Quorum 根本不使用 gas)。如果我们不这样做，**这个事务将无限期地排队，阻塞每个到达系统的新事务**。发生这种情况后，系统中不再验证新的交易。

我们是如何重现这个 bug 的？我们部署了一个简单的合同，但只有少量的汽油，令人惊讶的是，我们得到了一个*“汽油用完”*错误。然后，这个事务被阻塞在队列中，阻塞每个新到达的事务。

*所以，我们发现了空积木的问题！但是，我们该如何解决呢？在我们的例子中，为了解决这个问题，**我们决定完全重启测试网，以便区块链有一个干净的开始。然而，我们不能在每次有人阻塞队列时都这样做，我们需要避免这些问题有意或无意地再次发生。因此，我们开始考虑实施以下对策:***

*   避免区块链阻塞的*纠正措施*:如果有人未能在其事务中强制执行正确的 gas 限制，并且这被检测到，**网络中的每个节点都应该被停止，并且事务队列(存储在名为*“transaction . rpl”*的文件中)应该被删除**，因此当网络中的每个节点重新启动时，区块链状态保持不变，但是事务队列被清空。
*   **强制网络中的每个节点在其交易中使用相同的燃气限额**。该值应该很高，但低于成因区块中定义的气体极限。这样，我们可以确保每次交易都会有足够的汽油(只要你不在你的智能合同中引入无限循环，以及这种编程错误)。
*   **在每个节点中实现一个轻量级的进程，定期清空其事务队列以移除潜在的阻塞事务，**最小化它们的影响。此解决方案的唯一问题是，事务队列的删除应该尽可能同步，以避免队列为空的节点与队列中有阻塞事务的节点同步。这将使被阻止的交易再次扩散到网络中的每个节点。
*   应用层中的每个应用程序开发人员都应该确保有足够的气体用于他们的事务(这不仅仅是一个对策，对于 Alastria 的智能合同开发人员来说，这是一个建议的良好实践)。

无论哪种方式，从阿拉斯特里亚核心技术团队，我们将**联系摩根大通，沟通这个气体臭虫，并要求他们在未来版本**中修复它。然而，如果这不会很快发生，我们需要这些对策。

![](img/efa9c899ed910dfdbaff7ce1cf47edac.png)

Source: [https://steemit.com/cryptocurrency/@truantlife/blockchain-101](https://steemit.com/cryptocurrency/@truantlife/blockchain-101)

正如您可能从我之前的讨论中看到的，很难跟踪区块链的问题，尤其是当基础设施管理是分布式的时候。正因为如此，我们正在为每个验证器节点构建**轻量级监控系统，因此我们可以获得一些关于网络的非指导性信息，并跟踪可能导致我们过去几周所面临问题的异常情况，并快速从中恢复。该监控工具的第一个 alpha 版本已经在其存储库中发布[。](https://github.com/alastria/monitor)**

> [直接在您的收件箱中获取最佳软件交易](https://coincodecap.com/?utm_source=coinmonks)

[![](img/7c0b3dfdcbfea594cc0ae7d4f9bf6fcb.png)](https://coincodecap.com/?utm_source=coinmonks)

此外，为了分析来自验证器监视器的所有信息，我们正在设计一个系统，以便轻松处理、分析和可视化这些数据，监视整个网络的状态，并检测系统中的潜在异常，尽可能减少其影响。我们称该系统为 **Alastria DNA(分散网络管理)。**

**一如既往，我们需要尽可能多的帮助来构建所有这些工具，并让 Alastria 的 main-net 做好行动准备，因此我们非常高兴您加入我们的团队**。如果您想在上述任何系统中提供帮助，或者与 Alastria 平台相关的任何事情，请前往 [Alastria 的 github](https://github.com/alastria) 、[论坛](https://alastriaplatform.invisionzone.com)、[看板](https://tree.taiga.io/project/marcossanlab-alastria-platform/kanban?q=)或[联系我](https://www.linkedin.com/in/adlrocha/)(或团队的任何成员)，如果您需要更多信息。我们期待您的贡献；).

[![](img/449450761cd76f44f9ae574333f9e9af.png)](http://bit.ly/2G71Sp7)