<html>
<head>
<title>Implementing Proof of Stake Part — 2</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">实施利害关系证明第2部分</h1>
<blockquote>原文：<a href="https://medium.com/coinmonks/implementing-proof-of-stake-part-2-748156d5c85e?source=collection_archive---------0-----------------------#2019-01-28">https://medium.com/coinmonks/implementing-proof-of-stake-part-2-748156d5c85e?source=collection_archive---------0-----------------------#2019-01-28</a></blockquote><div><div class="ef hh hi hj hk hl"/><div class="hm hn ho hp hq"><div class=""/><p id="a38e" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">本文给出了一个在node.js中实现利益一致性算法的简单方法</p><figure class="jp jq jr js fq jt fe ff paragraph-image"><div class="fe ff jo"><img src="../Images/67a3c3a562cf394e00d1dc1fd2774c83.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*X1523S70lXzN1lyg8sm7mQ.jpeg"/></div><figcaption class="jw jx fg fe ff jy jz bd b be z ek">Source <a class="ae ka" href="https://en.bitcoinwiki.org/upload/en/images/thumb/e/e5/Proof%E2%80%93of%E2%80%93Stake_%28PoS%29.jpg/500px-Proof%E2%80%93of%E2%80%93Stake_%28PoS%29.jpg" rel="noopener ugc nofollow" target="_blank">bitcoin wiki</a></figcaption></figure><p id="6f76" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">在<a class="ae ka" rel="noopener" href="/coinmonks/implementing-proof-of-stake-e26fa5fb8716">上一篇</a>文章中，我们介绍了stake的证明，它是如何工作的，还讨论了我们将要实现的代码的设计和架构。</p><p id="f2b0" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">在这篇文章中，我们将开始编码。</p><h1 id="af9b" class="kb kc ht bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky dt translated">先决条件:</h1><ol class=""><li id="488a" class="kz la ht is b it lb ix lc jb ld jf le jj lf jn lg lh li lj dt translated"><a class="ae ka" href="https://nodejs.org/en/download/" rel="noopener ugc nofollow" target="_blank"> Node.js </a>和<a class="ae ka" href="https://www.npmjs.com/" rel="noopener ugc nofollow" target="_blank"> NPM </a></li><li id="da7a" class="kz la ht is b it lk ix ll jb lm jf ln jj lo jn lg lh li lj dt translated"><a class="ae ka" href="https://code.visualstudio.com/download" rel="noopener ugc nofollow" target="_blank">文本编辑器</a>(带有深色主题😛)</li><li id="eee4" class="kz la ht is b it lk ix ll jb lm jf ln jj lo jn lg lh li lj dt translated"><a class="ae ka" href="https://www.getpostman.com/" rel="noopener ugc nofollow" target="_blank"> Postman </a>或任何其他app与HTTP APIs交互。</li></ol><p id="ca4e" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated"><strong class="is hu"> <em class="lp">就是这样。</em> </strong></p><h1 id="0f53" class="kb kc ht bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky dt translated">让我们编码:</h1><p id="5f1b" class="pw-post-body-paragraph iq ir ht is b it lb iv iw ix lc iz ja jb lq jd je jf lr jh ji jj ls jl jm jn hm dt translated">我们将从创建项目的根目录开始。为您的项目命名。就说POSchain吧。</p><pre class="jp jq jr js fq lt lu lv lw aw lx dt"><span id="602e" class="ly kc ht lu b fv lz ma l mb mc">mkdir poschain<br/>cd poschain</span></pre><p id="27c3" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">创建新的节点项目</p><pre class="jp jq jr js fq lt lu lv lw aw lx dt"><span id="ae35" class="ly kc ht lu b fv lz ma l mb mc">npm init -y</span></pre><p id="3a28" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">我们需要一个名为nodemon的包来运行我们的开发服务器，并在每次保存时重新加载服务器。这个工具让我们免去了很多麻烦。</p><pre class="jp jq jr js fq lt lu lv lw aw lx dt"><span id="adc4" class="ly kc ht lu b fv lz ma l mb mc">npm install nodemon --save-dev</span></pre><p id="bd10" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">好吧。继续前进。</p><h1 id="07e6" class="kb kc ht bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky dt translated">街区</h1><p id="9d8a" class="pw-post-body-paragraph iq ir ht is b it lb iv iw ix lc iz ja jb lq jd je jf lr jh ji jj ls jl jm jn hm dt translated">区块链是由块组成的，所以让我们创建一个块类。块具有以下主要属性:</p><p id="de3b" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">时间戳—块的创建时间，以毫秒为单位</p><p id="2c38" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">lastHash —链上最后一个块的哈希</p><p id="8a5d" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">哈希-当前块的哈希</p><p id="427c" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">数据—块或事务中的数据</p><p id="c7f5" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">验证者——制作这个程序块的人的地址</p><p id="f579" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">签名—由验证程序签名的块的加密哈希</p><p id="279f" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">因此，在根目录下创建一个新文件<code class="eh md me mf lu b">block.js</code>,并创建一个具有这些属性的类。</p><figure class="jp jq jr js fq jt"><div class="bz el l di"><div class="mg mh l"/></div><figcaption class="jw jx fg fe ff jy jz bd b be z ek">the block</figcaption></figure><p id="48f8" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">另外，添加一个<code class="eh md me mf lu b">toString()</code>函数，该函数将以可读格式打印块的细节。</p><p id="d37e" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">由于在链的开始没有积木，区块链有了创世纪积木的概念。创世街区服务于成为区块链起源的目的。这是一个硬编码的块，包含时间戳、lastHash、Hash和数据值的虚拟值。</p><p id="4f27" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">让我们用一些硬编码值给我们的块类添加一个静态的<code class="eh md me mf lu b">genesis()</code>函数。该函数将创建一个带有虚拟值的新块。这是静态的，因为我们不想创建一个实例来调用这个函数。</p><figure class="jp jq jr js fq jt"><div class="bz el l di"><div class="mg mh l"/></div></figure><p id="3a56" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">接下来我们要添加到block类中的是基于数据和最后一个散列创建新块的能力。姑且称之为<code class="eh md me mf lu b">createBlock()</code></p><p id="dc02" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">这个静态的<code class="eh md me mf lu b">createBlock()</code>函数目前有两个参数，最后一个块和数据，基于这两个参数它生成一个新的块。我们在整个项目中的许多功能将是静态的。</p><p id="3f3e" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">为了生成哈希值，我们需要一个名为<code class="eh md me mf lu b">crypto-js</code>的节点包，让我们安装它。</p><pre class="jp jq jr js fq lt lu lv lw aw lx dt"><span id="1642" class="ly kc ht lu b fv lz ma l mb mc">npm i crypto-js --save</span></pre><p id="74b0" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">从此模块导入sha-256函数。</p><pre class="jp jq jr js fq lt lu lv lw aw lx dt"><span id="9f59" class="ly kc ht lu b fv lz ma l mb mc">const SHA256 = require('crypto-js/sha256');</span></pre><p id="8154" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">我们不会直接使用散列函数，相反，我们将创建一个单独的函数，因为我们将来会再次使用它。</p><figure class="jp jq jr js fq jt"><div class="bz el l di"><div class="mg mh l"/></div><figcaption class="jw jx fg fe ff jy jz bd b be z ek">The backticks and dollar syntax, that’s ES6.</figcaption></figure><p id="2b4e" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">让我们用上面的东西创建一个<code class="eh md me mf lu b">createBlock()</code>函数。</p><figure class="jp jq jr js fq jt"><div class="bz el l di"><div class="mg mh l"/></div></figure><p id="2b8e" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">在接下来的教程中，我们将在实现钱包时添加验证器和签名。</p><h1 id="2ccf" class="kb kc ht bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky dt translated">区块链</h1><p id="185d" class="pw-post-body-paragraph iq ir ht is b it lb iv iw ix lc iz ja jb lq jd je jf lr jh ji jj ls jl jm jn hm dt translated">在根目录下创建<code class="eh md me mf lu b"> blockchain.js</code>文件。要创建区块链类，我们需要导入块类。</p><p id="1e8a" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">在构造函数中，我们将为链提供一个初始块。在这里，我们将利用我们创建的静态成因函数来启动我们的链。</p><figure class="jp jq jr js fq jt"><div class="bz el l di"><div class="mg mh l"/></div><figcaption class="jw jx fg fe ff jy jz bd b be z ek">The blockchain class</figcaption></figure><p id="3855" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">接下来，让我们给我们的区块链类通过创建一个<code class="eh md me mf lu b">addBlock(data)</code>函数向链中添加更多块的能力。</p><p id="b5ec" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">在这里，我们将使用我们的<code class="eh md me mf lu b">createBlock()</code>功能来创建一个新的块，然后将其推送到链中。我们将访问链上的最后一个块，然后使用传递给<code class="eh md me mf lu b">addBLock()</code>的数据调用<code class="eh md me mf lu b">createBlock()</code>函数</p><figure class="jp jq jr js fq jt"><div class="bz el l di"><div class="mg mh l"/></div></figure><p id="dc8e" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">到目前为止，我们的blockchain.js文件是这样的。</p><figure class="jp jq jr js fq jt"><div class="bz el l di"><div class="mg mh l"/></div></figure><p id="d3ca" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">酷。</p><p id="2419" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">接下来，我们将向区块链添加更多功能，以支持多个贡献者。</p></div><div class="ab cl mi mj hb mk" role="separator"><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn"/></div><div class="hm hn ho hp hq"><p id="3a41" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated"><em class="lp">感谢您的阅读。</em> <strong class="is hu"> <em class="lp">在下一部分，我们将编写代码来验证区块链，并增加对多个节点的支持。</em> </strong> <em class="lp">希望您喜欢编码。</em> <strong class="is hu"> <em class="lp">如果你发现这有帮助，就鼓掌欢呼。</em> </strong></p><p id="4ed5" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated"><em class="lp">如果你对区块链、以太或整个世界有任何疑问，请留言。:)</em></p><blockquote class="mp"><p id="2cd1" class="mq mr ht bd ms mt mu mv mw mx my jn ek translated"><a class="ae ka" href="https://coincodecap.com/?utm_source=coinmonks" rel="noopener ugc nofollow" target="_blank">直接在您的收件箱中获取最佳软件交易</a></p></blockquote><figure class="na nb nc nd ne jt fe ff paragraph-image"><a href="https://coincodecap.com/?utm_source=coinmonks"><div class="fe ff mz"><img src="../Images/7c0b3dfdcbfea594cc0ae7d4f9bf6fcb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1168/format:webp/0*OJ-qb5G6i863msBB.png"/></div></a></figure></div></div>    
</body>
</html>