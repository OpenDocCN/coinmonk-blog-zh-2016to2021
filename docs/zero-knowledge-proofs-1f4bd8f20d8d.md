# 零知识证明

> 原文：<https://medium.com/coinmonks/zero-knowledge-proofs-1f4bd8f20d8d?source=collection_archive---------1----------------------->

## 如何证明你知道(或拥有)某事，而不放弃任何关于你知道什么的信息

![](img/e1871566f0a9084b884a8aad9e3aa98c.png)

在像比特币、以太坊和许多其他交易一样的开放的区块链，交易是公开的，对所有人开放，显示谁在发送，谁在接收，以及转手了多少。然后，您可以查看这些地址中的所有交易，揭示它们的全部历史。这种程度的开放让许多人感到不舒服。那么，我们怎样才能让事情变得更私密一点呢？

你如何隐藏你的交易量、你发送的数据或你的身份？

一个简单的解决方案是用接收方的公钥对整个交易进行哈希运算，使其只对接收方可读。这是一个很好的解决方案，但是也产生了一些问题。输出中的数据用于验证交易，用数据填充钱包，并作为未来输出的输入。因此，将该数据隐藏在哈希之后会使其不可用。否则这是一个伟大的解决方案。也许我们可以逐一解决这些问题。首先，我们必须在不放弃隐私的情况下证明加密交易中的数据是有效的。

这就是零知识证明的用武之地。零知识证明指的是一种证明结构，允许你说服某人你知道某事，而不透露任何关于你在这个过程中知道什么的信息。举个简单的例子，假设我，证明者，想向你，验证者证明我有两个不同颜色的台球，但是我不想让你知道它们是什么颜色。所以我蒙上你的眼睛，把它们放在你手里。我让你把它们放在背后，告诉你你可以换或者不换，然后给我看。然后我可以告诉你你是否调换了它们。当然，我第一次这么做的时候，我有 50%的机会做对。但是我让你一遍又一遍地做，每一次都把我答对的概率降低 50%。如此反复几次后，你会对这些球之间的差异感到满意，然后你把它们交还给我，我把它们放好。因此，我向你证明了我有两个不同颜色的球，而你对此一无所知。

在密码学中，这可以用于证明更复杂的事情，例如给定一个散列，证明者可以使验证者确信确实存在一个满足特定标准的数，并且散列到该值而不暴露该数的任何特征。这是在创建保密交易时使用的，其中地址和交易余额隐藏在哈希后面的区块链上，或者您拥有私钥以便花一张钞票，从而隐藏您的身份。

零知识证明必须满足三个性质:

*   完整性——如果陈述为真，诚实的验证者完全相信证明者所展示的知识。
*   **可靠性** —如果陈述是假的，没有不诚实的证明者能够说服验证者该陈述是真的。在实践中，这些往往不是完全合理的，但在统计上是合理的。
*   **零知识**——如果陈述为真，验证者除了知道该陈述为真之外，不能获得任何关于该陈述的知识。无法获得关于是什么使这一陈述成为事实的其他信息。

# 让我们变得尖刻

目前有三种加密货币(Zcash，Ethereum，INT)提出使用零知识证明(据我所知)，其中只有**一家**成功实现了它们。 **Zcash** 作为比特币的硬分支，在 2016 年末凭借一个名为 zk-SNARKs 的零知识证明的具体实现，成为零知识证明应用的先驱，其中“zk”指的是*、“零知识”*和 SNARK 指的是“*简洁的非交互知识论证*”。这允许用户发送交易而不暴露他们的地址、接收者的地址、发送的金额或他们的余额。

参数的简洁指的是在整个参数减少到只有几百个字节的情况下验证参数的速度，即使是关于复杂程序的语句(在 Zcash 中，验证只需要几毫秒)。

为了使论证是非交互式的，证明者必须向验证者提供他们所需要的一切，以便完全验证证明。在交互式零知识设置中，可以发生“对话”,其中验证者可以向证明者提问，而证明者提供答案。

## 理论上

这可以分为 4 个主要步骤，对所有的 SNARK 实现都是通用的。

*   **编码为多项式** —待证明的陈述被编译为 4 个独立多项式的二次方程，其中等式 *t(x) h(x) = w(x) v(x)在定义的域*内必须成立，以便证明有效。多项式具有奇特的数学性质(称为同态性质)，允许在不影响结果的情况下移动运算，并且很难分解以逆向工程定义。这一特性使它们非常适用于运输、隐藏和利用秘密值而不被人知道。
*   **通过随机采样的简洁性** —通过给予验证者随机评估具有秘密值的多项式的能力， *s* ，它将问题从乘法多项式转换为在特定点评估它们是否相等， *t(s) h(s) = w(s) v(s)，*从而显著减少需要完成的验证工作。通过在给定点随机抽样，在不完全满足证明要求的情况下，函数在该点全部相等的机会非常小，从而确保了完整性。
*   **秘密值**的同态加密——如果秘密值 s 是已知的，证明者可以构造一个只对那个 *s* 有效的证明，从而使验证者相信他们已经满足了所有条件。*为了隐藏秘密值，以便证明者不知道他们的证明将在哪里被评估，该值被嵌入到半同态函数中，以允许在证明者多项式中使用该值，而不暴露该值本身，从而确保可靠性。这个函数， *E(s)* 然后被证明者用来评估他们在给定点的二次证明， *s，* by，*t(E(s))h(E(s))= w(E(s))v(E(s))，*由于同态性质，它与*E(t(s))E(h(s))= E(w(s))E(v(s))相同*
*   **零知识—** 传递 *t(E(s))、h(E(s))、w(E(s))* 和 *v(E(s))* 的问题在于，在验证者知道 *E(s)、*的情况下，这将揭示关于函数 *t(s)、h(s)、w(s)、v(s)* 是什么的一些信息。因此，为了传递零信息，证明者将函数乘以一个随机数 *k* ，因此验证者仍然可以确保结果的“形状”是相同的，只是不在轴上。本质上，这个想法是:对于秘密数字 *k.* ，t(s) h(s) = w(s) v(s) 与*(t(s)h(s))k =(w(s)v(s))k*相同，并且如果所有验证者接收的都是数字，则没有办法确定 *k* 以及函数的细节，从而有效地证明该陈述，而不允许发现任何形成证明的信息。

现在，我方便而优雅地跳过了整个过程中最困难的部分，将语句编码成一个“二次算术程序”(QAP 语)。这不是我们要在这里讨论的内容，但可能会在另一篇文章中讨论，而且不会是为了虚晃一枪。这一步就是为什么 zk-SNARKs 不是一件容易实现的事情的原因，这导致 Zcash 必须将他们的一些共识规则编码到 zk-SNARKs 和以太坊中，以缩小可用智能合约的集合，从而使这一工作有效。即便如此，对于 Zcash 中的一个简单交易，构造证明仍然需要大约 40 秒。另一方面，由于 gas 的限制，以太坊不可能在其智能合约环境中实现这些证明的全球使用，因此[他们提出了一个预编译智能合约的子集，该子集将与 zk-SNARKs](https://github.com/ethereum/EIPs/pull/213) 一起工作。

**特别提示:在这些设置中，秘密值 s 可能被用来生成虚假的可验证的证据，从而赋予在网络中创造硬币的权力。因此，必须尽最大努力确保这一价值得到高度保护。在 Zcash，举行了一个* [*多方仪式*](https://blog.z.cash/generating-zcash-parameters/) *在仪式上，一组第三方演员的每个成员用一台有气隙的电脑创造了最终价值的一部分，然后这台电脑被摧毁。*

*同态意味着您可以在不改变结果的情况下改变数学运算的顺序。在密码学中，这变得很有用，因为你可以对加密的数据进行数学运算，结果就像你在加密前进行运算一样。具体地说，两个消息的加密乘积等于消息乘积的加密。寻找完全同态函数对在实践中是非常困难的，也是激烈研究的主题。在这些应用中，我们满足于“半”。*

## 在实践中—私有令牌传输

在基于 UTXO(未用交易输出)的框架中(如比特币，它是 Zcash 的基础)，输入的总和必须等于输出的总和:

```
output1[toAddress1] + output2[toAddress2] = input1[fromAddress] + input2[fromAddress] + ...
```

其中`output2[toAddress2]`是将地址的整个余额(所有输入的总和)发送到单独的“零钱夹”后剩余的零钱。这为每枚比特币创造了一个从其诞生到目前持有人的持续交易链。除了个人和地址之间的伪匿名关系之外，这不允许用户有任何隐私。为了解决这个问题，Zcash 有效地将证明满足有效交易条件的负担从验证者转移到了证明者，允许在证明者和验证者之间引入零知识证明来屏蔽交易的细节。

为了使交易有效，上述内容必须返回 true，并证明您拥有花费输入、`input1`、`input2`等的私钥。这些都可以构造成 zk-SNARK 证明，证明你持有私钥来花掉投入，并且输出的总和等于投入的总和。

但是现在您已经成功地隐藏并证明了这些有效交易的细节，输出的细节(“to”字段和金额)仍然可见。因此，Zcash 没有像比特币那样将输出存储在区块链上，而是将输出的加密哈希版本作为“笔记”存储在区块链上。这张钞票将用世界卫生组织的私钥“传输密钥”(想想公钥)加密，“查看密钥”将用于解密输入的交易，用输入填充你的钱包。这使得其他用户无法看到正在转移的金额，也无法将加密的交易与传输密钥所有者相关联。

区块链的交易现在完全不透明，能够看到谁发送了什么、去了哪里以及谁有多少的传统框架现在已经解决了。您传统的两个输出的事务现在是一个用于验证的零知识证明和两个加密输出的事务。[图 1]

![](img/66a80708c312e830e7f64234be14c4c2.png)

Fig. 1 The structure of a Zcash transaction

那么，地址是如何使用这些纸币的，区块链是如何记录的，这样就不会发生重复使用或未经授权的硬币创造了？

该票据包括无效值，该值在发行时表示原始票据已经失效。无效符与接收方的传输密钥进行哈希运算，并公开发布。

花费一个票据(屏蔽输出)将需要发布您用来构造新票据的票据的无效符，作为您事务的输入，基本上是销毁旧票据并创建一个新票据，无效符对。你可以再次看到隐藏 T4 的重要性。

这将区块链从 UTXO 转换为基于 UNN(未作废音符)的。

## 在实践中——私有智能合同

如上所述的交易实际上只是简单的智能合约。验证这些 x 标准和令牌所有权是否已转移。因此，在理论上，将零知识证明应用于更一般化的契约应该能够将问题定义为能够定义该智能契约的所有验证标准的 QAP。虽然 Ethereum 已经将 zk-SNARK 兼容性整合到它们的基础代码中，但客户端支持尚未推出。首先让我们看一个基本的交易来理解它和 Zcash 之间的根本区别。

在基于账户的交易框架(如以太坊)中，地址和余额之间存在映射，当发送金额为`value`的交易时，必须满足以下条件:

```
balances[fromAddress] >= value
```

这样做是为了确保该地址有足够的令牌来发送交易金额。

该事务也与 nonce 一起发送。与挖掘中使用的随机数(只是添加到哈希中的一个随机数，以使其符合模式)不同，该随机数用于确保事务按照处理顺序进行维护。如果 nonce 不等于或大于前一个事务的 nonce，则该事务将被拒绝。

这两个验证标准，以及证明您有私钥来签署该地址的交易，可以很容易地表示为零知识证明。

但是如何与合同互动呢？合同不仅需要上述内容，还需要一些依赖于合同本身的投入。为契约实现 zk-SNARKs 需要使契约能够验证零知识证明，并转换函数调用或满足契约的条件来处理加密信息。这给现有合同增加了一个新的层面，从而推高了交易的天然气成本。这极大地限制了 zk-SNARKs 在以太坊中的使用，因为即使对于简单的合同，用于验证证据的气体也消耗了一个街区价值的一半。

这促使 zk-SNARKs 的可行智能合同向下选择，选择那些可以在当前区块气限制和 zk-SNARKs 实施的当前效率下运行的合同。这些预编译的智能合约具有进行简单交易和椭圆曲线运算的能力。

Zcash 还与以太坊合作了一个名为 *Project Alchemy* 或*z cash on ether eum*(*ZoE*)的项目。这个项目希望在两个区块链之间架起一座桥梁，利用其中一个的可编程性和另一个的私密性来开辟另一个应用领域。这种集成将开放自定义匿名令牌的创建，可以像当前的以太坊令牌一样在 dAPPs 中使用，支持重要和敏感合同的真实世界使用，例如投票、身份认证或其他敏感应用。

这种桥梁的构建很像 BTCrelay 对比特币和以太坊所做的，这也是 INT 希望通过他们的异构多链框架来简化的。关于区块链互操作性的更多信息，[阅读这篇文章](/@graytrain/interoperability-the-holy-grail-of-blockchain-eac8e689d50d)。

## 未来

零知识证明找到了完整和有保证的隐私与广泛应用的选择性之间的平衡。当前与证据生成的资源密集性相关的缺点是激烈的学术研究的主题，最新的改进你可以[在这里](https://eprint.iacr.org/2017/1132)阅读。

随着人们对区块链的隐私和适用性越来越感兴趣，人们将会投入更多的精力来开发完善的、有竞争力的隐私保护系统，而某种类型的 zk-SNARK 实现无疑将成为其核心。

**进一步阅读，用作文章的灵感和素材。**

[https://blog . ether eum . org/2016/12/05/zksnarks-in-a-shell/](https://blog.ethereum.org/2016/12/05/zksnarks-in-a-nutshell/)

*关于 QAPs 的更多信息:*

[https://medium . com/@ VitalikButerin/quadratic-algorithm-programs-from-zero-to-hero-f6d 558 CEA 649](/@VitalikButerin/quadratic-arithmetic-programs-from-zero-to-hero-f6d558cea649)

*如何创建 Zcash 的参数:*

[https://blog.z.cash/generating-zcash-parameters/](https://blog.z.cash/generating-zcash-parameters/)

[https://ipfs . io/ipfs/qmxoypizjw3wknfijklwhcnl 72 vedxjqkddp 1 mxwo 6 uco/wiki/Zero-knowledge _ proof . html](https://ipfs.io/ipfs/QmXoypizjW3WknFiJnKLwHCnL72vedxjQkDDP1mXWo6uco/wiki/Zero-knowledge_proof.html)

[](https://blog.ethereum.org/2017/01/19/update-integrating-zcash-ethereum/) [## 在以太坊上集成 Zcash 的更新(ZoE)

### 以太坊研发团队的成员和 Zcash 公司正在合作一个研究项目，解决…

blog.ethereum.org](https://blog.ethereum.org/2017/01/19/update-integrating-zcash-ethereum/) 

> [直接在您的收件箱中获得最佳软件交易](https://coincodecap.com/?utm_source=coinmonks)

[![](img/7c0b3dfdcbfea594cc0ae7d4f9bf6fcb.png)](https://coincodecap.com/?utm_source=coinmonks)