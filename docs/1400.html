<html>
<head>
<title>Simple Escrow Contract using Stellar</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Stellar的简单托管合同</h1>
<blockquote>原文：<a href="https://medium.com/coinmonks/simple-escrow-contract-using-stellar-67aa799f7db?source=collection_archive---------2-----------------------#2018-08-26">https://medium.com/coinmonks/simple-escrow-contract-using-stellar-67aa799f7db?source=collection_archive---------2-----------------------#2018-08-26</a></blockquote><div><div class="ef hh hi hj hk hl"/><div class="hm hn ho hp hq"><div class=""/><p id="a33d" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">这篇文章是上一篇文章的后续，在这篇文章中，我尝试了一个简单的XLM交易:<a class="ae jo" rel="noopener" href="/@slyg/first-impressions-at-creating-stellar-smart-contracts-d51f18552bbc">创造星际智能合同的第一印象</a>。</p><figure class="jq jr js jt fq ju fe ff paragraph-image"><div class="fe ff jp"><img src="../Images/fda85cd345a366519e20f7c34243f582.png" data-original-src="https://miro.medium.com/v2/resize:fit:1082/format:webp/1*L55cbPY2YP2vzpf4gizurw.jpeg"/></div><figcaption class="jx jy fg fe ff jz ka bd b be z ek">Émile-Antoine Bayard’s Illustrations for Around the Moon by Jules Verne (1870)</figcaption></figure><p id="ccd0" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">明星智能合同的一个常见例子是如何创建托管。这就是我将在下面描述的。我很清楚<a class="ae jo" href="https://www.stellar.org/" rel="noopener ugc nofollow" target="_blank">stellar.org</a>网站上的例子也解释得很清楚，我在这里的重点是用一种新手语言给出另一个新手介绍。</p><p id="eedb" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">下面是我们将遵循的场景，我们希望(A)虱子和(B)ob的签名都能从托管账户中释放资金:</p><ul class=""><li id="c3f6" class="kb kc ht is b it iu ix iy jb kd jf ke jj kf jn kg kh ki kj dt translated">Alice创建并资助一个托管账户</li><li id="f335" class="kb kc ht is b it kk ix kl jb km jf kn jj ko jn kg kh ki kj dt translated">Alice创建了一个到Bob账户的托管支付交易</li><li id="1fdd" class="kb kc ht is b it kk ix kl jb km jf kn jj ko jn kg kh ki kj dt translated">稍后，爱丽丝签署托管支付交易</li><li id="fe76" class="kb kc ht is b it kk ix kl jb km jf kn jj ko jn kg kh ki kj dt translated">最后，Bob签署付款交易，并将其提交以接收资金</li></ul><p id="77a1" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">我们会认为爱丽丝和鲍勃的账户已经存在于恒星网络中。您可以参考我上一篇文章<a class="ae jo" rel="noopener" href="/@slyg/first-impressions-at-creating-stellar-smart-contracts-d51f18552bbc"/>来了解如何使用Stellar testnet来实现这一点。</p><p id="b169" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">请原谅，这些步骤可以简化很多。但我选择将它们分开，希望能让推理更清晰。</p></div><div class="ab cl kp kq hb kr" role="separator"><span class="ks bw bk kt ku kv"/><span class="ks bw bk kt ku kv"/><span class="ks bw bk kt ku"/></div><div class="hm hn ho hp hq"><h2 id="07d5" class="kw kx ht bd ky kz la lb lc ld le lf lg jb lh li lj jf lk ll lm jj ln lo lp lq dt translated">爱丽丝创建了一个托管账户</h2><p id="3a53" class="pw-post-body-paragraph iq ir ht is b it lr iv iw ix ls iz ja jb lt jd je jf lu jh ji jj lv jl jm jn hm dt translated">Alice使用她的账户创建一个新账户(托管账户)并为其提供资金。选择2.5流明是因为恒星账户需要至少0.5 XLM的余额，正如文件中规定的<a class="ae jo" href="https://www.stellar.org/developers/guides/concepts/fees.html#minimum-account-balance" rel="noopener ugc nofollow" target="_blank">。我们以后会看到为什么增加了2流明。</a></p><figure class="jq jr js jt fq ju"><div class="bz el l di"><div class="lw lx l"/></div></figure><p id="6494" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">一旦建立，托管账户创建交易被提交到网络。</p><h2 id="ed0d" class="kw kx ht bd ky kz la lb lc ld le lf lg jb lh li lj jf lk ll lm jj ln lo lp lq dt translated">托管账户配置(multisig)</h2><p id="b1b0" class="pw-post-body-paragraph iq ir ht is b it lr iv iw ix ls iz ja jb lt jd je jf lu jh ji jj lv jl jm jn hm dt translated">我们想限制代管账户的支出，因为爱丽丝和鲍勃都需要签名。这是通过更改托管帐户的属性来完成的。</p><p id="a536" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">这是需要意识到的一个关键点:您需要在托管账户上设置选项来应用这些约束。</p><figure class="jq jr js jt fq ju"><div class="bz el l di"><div class="lw lx l"/></div></figure><p id="e004" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">在<code class="eh ly lz ma mb b">threshold</code>属性中，通过给<code class="eh ly lz ma mb b">masterWeight</code>一个0值，我们防止托管账户私钥在将来被用来签署任何交易。</p><p id="7bd7" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">您会看到签名者的权重被设置为每一个<code class="eh ly lz ma mb b">1</code>。因此执行任何交易所需的<a class="ae jo" href="https://www.stellar.org/developers/guides/concepts/operations.html#thresholds" rel="noopener ugc nofollow" target="_blank">阈值</a>被设置为<code class="eh ly lz ma mb b">2</code>:一个给爱丽丝，一个给鲍勃(零个给托管)。</p><p id="a2bb" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">因此，一旦该修改被提交到Stellar network，Bob和Alice都需要签署来自托管账户的交易。</p><p id="0c1d" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">这个修改也是有效的，因为托管账户已经有足够的流明(2.5):每个签名者1+0.5最小余额。</p><h2 id="fce5" class="kw kx ht bd ky kz la lb lc ld le lf lg jb lh li lj jf lk ll lm jj ln lo lp lq dt translated">爱丽丝将流明发送到托管账户</h2><p id="5cc6" class="pw-post-body-paragraph iq ir ht is b it lr iv iw ix ls iz ja jb lt jd je jf lu jh ji jj lv jl jm jn hm dt translated">这可能是在Alice创建托管帐户时完成的。然而，为了清楚起见，我将这个事务隔离开来。</p><figure class="jq jr js jt fq ju"><div class="bz el l di"><div class="lw lx l"/></div></figure><h2 id="c62e" class="kw kx ht bd ky kz la lb lc ld le lf lg jb lh li lj jf lk ll lm jj ln lo lp lq dt translated">创建托管支出交易</h2><p id="c54e" class="pw-post-body-paragraph iq ir ht is b it lr iv iw ix ls iz ja jb lt jd je jf lu jh ji jj lv jl jm jn hm dt translated">该交易仅指定从托管账户向Bob付款。</p><p id="ce52" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">对于双方签署的交易，并触发支付给鲍勃，它必须有可能发送过来。但是Stellar网络只验证所有签署者签署的交易。</p><p id="da45" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">创建一个事务并不意味着它必须提交给网络。毕竟，当您使用Stellar JS SDK时，在您最终通过SDK的<code class="eh ly lz ma mb b">submitTransaction()</code>方法提交事务之前，事务只是内存中的JS对象。</p><p id="1075" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">幸运的是，Stellar使用一种你可以用来交换交易的格式:<a class="ae jo" href="https://www.stellar.org/developers/guides/concepts/xdr.html" rel="noopener ugc nofollow" target="_blank"> XDR </a>。这就是为什么下面的脚本可以<em class="mc">序列化</em>该事务并将其保存为文件的原因。</p><figure class="jq jr js jt fq ju"><div class="bz el l di"><div class="lw lx l"/></div></figure><p id="dd06" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">在文档的大多数例子中，你会看到Alice和Bob的签名在同一个脚本中执行。但是在现实世界的用例中，你很难同时访问Alice和Bob的私钥，或者甚至在同一个设备上访问……如果是这样，你可能会遇到大问题。</p><p id="0892" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated"><em class="mc">稍后……</em></p><h2 id="0081" class="kw kx ht bd ky kz la lb lc ld le lf lg jb lh li lj jf lk ll lm jj ln lo lp lq dt translated"><strong class="ak">爱丽丝签署</strong>托管支付<strong class="ak">交易</strong></h2><p id="21ba" class="pw-post-body-paragraph iq ir ht is b it lr iv iw ix ls iz ja jb lt jd je jf lu jh ji jj lv jl jm jn hm dt translated">Alice可以对事务进行反序列化，并使用其帐户的私钥对其进行签名，然后再次进行序列化，这使得事务到目前为止是半签名的。</p><figure class="jq jr js jt fq ju"><div class="bz el l di"><div class="lw lx l"/></div></figure><h2 id="df3c" class="kw kx ht bd ky kz la lb lc ld le lf lg jb lh li lj jf lk ll lm jj ln lo lp lq dt translated">Bob签署并提交交易</h2><p id="4e71" class="pw-post-body-paragraph iq ir ht is b it lr iv iw ix ls iz ja jb lt jd je jf lu jh ji jj lv jl jm jn hm dt translated">现在，Bob的私钥也可以用于签署交易，并且被所有签署者签署后，可以提交给网络。</p><figure class="jq jr js jt fq ju"><div class="bz el l di"><div class="lw lx l"/></div></figure><p id="84ee" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">这就对了:在接下来的5秒钟内，Bob的账户将会被存入资金。</p></div><div class="ab cl kp kq hb kr" role="separator"><span class="ks bw bk kt ku kv"/><span class="ks bw bk kt ku kv"/><span class="ks bw bk kt ku"/></div><div class="hm hn ho hp hq"><p id="2649" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">我希望这个演示将帮助您从自己的用例开始，并揭示Stellar如何成为智能合同实现的一个非常好的赌注。</p></div><div class="ab cl kp kq hb kr" role="separator"><span class="ks bw bk kt ku kv"/><span class="ks bw bk kt ku kv"/><span class="ks bw bk kt ku"/></div><div class="hm hn ho hp hq"><p id="8ab6" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">你还会发现我在这个频道发布的几个视频:<a class="ae jo" href="https://www.youtube.com/channel/UCAKSRclAwfHyN6dWibj4iVw" rel="noopener ugc nofollow" target="_blank">https://www.youtube.com/channel/UCAKSRclAwfHyN6dWibj4iVw</a></p></div><div class="ab cl kp kq hb kr" role="separator"><span class="ks bw bk kt ku kv"/><span class="ks bw bk kt ku kv"/><span class="ks bw bk kt ku"/></div><div class="hm hn ho hp hq"><p id="de00" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated"><em class="mc">更新(20/08/2019):更新sdk更新后的代码示例，添加视频链接</em></p><blockquote class="md"><p id="42d0" class="me mf ht bd mg mh mi mj mk ml mm jn ek translated"><a class="ae jo" href="https://coincodecap.com/?utm_source=coinmonks" rel="noopener ugc nofollow" target="_blank">直接在您的收件箱中获得最佳软件交易</a></p></blockquote><figure class="mo mp mq mr ms ju fe ff paragraph-image"><a href="https://coincodecap.com/?utm_source=coinmonks"><div class="fe ff mn"><img src="../Images/7c0b3dfdcbfea594cc0ae7d4f9bf6fcb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1168/format:webp/0*OJ-qb5G6i863msBB.png"/></div></a></figure></div></div>    
</body>
</html>