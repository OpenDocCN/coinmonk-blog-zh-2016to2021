<html>
<head>
<title>Smart Contract Factories: How to create a contract, to create another contract</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">智能合同工厂:如何创建合同，如何创建另一个合同</h1>
<blockquote>原文：<a href="https://medium.com/coinmonks/smart-contract-factories-how-to-create-a-contract-to-create-another-contract-248a120f331a?source=collection_archive---------1-----------------------#2021-12-28">https://medium.com/coinmonks/smart-contract-factories-how-to-create-a-contract-to-create-another-contract-248a120f331a?source=collection_archive---------1-----------------------#2021-12-28</a></blockquote><div><div class="ef hh hi hj hk hl"/><div class="hm hn ho hp hq"><div class=""/><blockquote class="iq ir is"><p id="041e" class="it iu iv iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hm dt translated"><em class="ht">TLDR；solidity中的</em> <code class="eh js jt ju jv b"><em class="ht">new</em></code> <em class="ht">关键字允许使用模板创建和部署新的合同实例。“SomethingSomethingFactory”是用于创建“SomethingSomething”契约的命名约定和模式。</em></p></blockquote><p id="0427" class="pw-post-body-paragraph it iu ht iw b ix iy iz ja jb jc jd je jw jg jh ji jx jk jl jm jy jo jp jq jr hm dt translated">本文的目的是通过一个简单的契约工厂的过程，同时理解它是如何工作的，并想象潜在的用例。让我们开始吧。</p><p id="5fbd" class="pw-post-body-paragraph it iu ht iw b ix iy iz ja jb jc jd je jw jg jh ji jx jk jl jm jy jo jp jq jr hm dt translated">契约工厂是一种基于模板创建契约的设计模式。用户可以向字段中引入值，这些值用作输入来初始化新部署的契约的状态变量。这为什么有用？根据您的使用情况，您可以做一些很酷的事情，例如:</p><ul class=""><li id="ecfc" class="jz ka ht iw b ix iy jb jc jw kb jx kc jy kd jr ke kf kg kh dt translated">允许用户创建流动性池:<a class="ae ki" href="https://docs.uniswap.org/protocol/V2/reference/smart-contracts/factory" rel="noopener ugc nofollow" target="_blank"> Uniswap </a></li><li id="4cbd" class="jz ka ht iw b ix kj jb kk jw kl jx km jy kn jr ke kf kg kh dt translated">利用每个地址的阿迪达斯2 NFT造币厂限额:<a class="ae ki" href="https://etherscan.io/tx/0x6a3d8584a6272a1d73ff297592b401fe10d3a90fd385efff55f68f32f29ecf61" rel="noopener ugc nofollow" target="_blank">交易</a></li><li id="9fbd" class="jz ka ht iw b ix kj jb kk jw kl jx km jy kn jr ke kf kg kh dt translated">制作界面，帮助用户创建自己的令牌:<a class="ae ki" href="https://thirdweb.com/portal" rel="noopener ugc nofollow" target="_blank"> ThirdWeb </a></li><li id="596e" class="jz ka ht iw b ix kj jb kk jw kl jx km jy kn jr ke kf kg kh dt translated"><a class="ae ki" href="https://www.researchgate.net/publication/303996559_Untrusted_Business_Process_Monitoring_and_Execution_Using_Blockchain" rel="noopener ugc nofollow" target="_blank">其他如:业务流程管理</a>和<a class="ae ki" href="https://arxiv.org/abs/1706.03700" rel="noopener ugc nofollow" target="_blank">医疗保健</a></li></ul><p id="a625" class="pw-post-body-paragraph it iu ht iw b ix iy iz ja jb jc jd je jw jg jh ji jx jk jl jm jy jo jp jq jr hm dt translated">对于这个例子，我将使用一个银行合同(模板)和我今天早上写的BankFactory合同(工厂)。目的是一次性部署工厂，并创建尽可能多的银行合同，而无需我们自己部署每个合同。</p><figure class="kp kq kr ks fq kt fe ff paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="fe ff ko"><img src="../Images/728feb8a3f804b068d60df08d6c4faf2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*N2MWnCEtDohnc-FOHRjMcw.png"/></div></div><figcaption class="la lb fg fe ff lc ld bd b be z ek">Simple diagram</figcaption></figure><p id="43b0" class="pw-post-body-paragraph it iu ht iw b ix iy iz ja jb jc jd je jw jg jh ji jx jk jl jm jy jo jp jq jr hm dt translated"><strong class="iw hu"> 1 —第一家银行(模板):</strong></p><p id="a51b" class="pw-post-body-paragraph it iu ht iw b ix iy iz ja jb jc jd je jw jg jh ji jx jk jl jm jy jo jp jq jr hm dt translated">构造函数初始化由BankFactory传递给的状态变量。这里我们传递银行拥有的资金量，谁是银行的所有者，谁创建了银行契约。</p><figure class="kp kq kr ks fq kt"><div class="bz el l di"><div class="le lf l"/></div></figure><p id="9d42" class="pw-post-body-paragraph it iu ht iw b ix iy iz ja jb jc jd je jw jg jh ji jx jk jl jm jy jo jp jq jr hm dt translated"><strong class="iw hu"> 2 —第二银行工厂(工厂):</strong></p><p id="274e" class="pw-post-body-paragraph it iu ht iw b ix iy iz ja jb jc jd je jw jg jh ji jx jk jl jm jy jo jp jq jr hm dt translated">这里我们实例化了银行契约<code class="eh js jt ju jv b">Bank bank</code>，创建了一个银行类型列表<code class="eh js jt ju jv b">Bank[] public list_of_banks</code>来跟踪新创建的契约，最后是神奇的函数<code class="eh js jt ju jv b">createBank()</code>，它将银行的构造函数参数作为参数。</p><p id="c275" class="pw-post-body-paragraph it iu ht iw b ix iy iz ja jb jc jd je jw jg jh ji jx jk jl jm jy jo jp jq jr hm dt translated">这是创建新合同的代码行:</p><p id="069a" class="pw-post-body-paragraph it iu ht iw b ix iy iz ja jb jc jd je jw jg jh ji jx jk jl jm jy jo jp jq jr hm dt translated"><code class="eh js jt ju jv b">bank = new Bank(_owner, _funds)</code></p><p id="131d" class="pw-post-body-paragraph it iu ht iw b ix iy iz ja jb jc jd je jw jg jh ji jx jk jl jm jy jo jp jq jr hm dt translated"><code class="eh js jt ju jv b">list_of_banks</code>数组中索引0处的值成为所创建契约的地址！</p><figure class="kp kq kr ks fq kt"><div class="bz el l di"><div class="le lf l"/></div></figure><p id="8b15" class="pw-post-body-paragraph it iu ht iw b ix iy iz ja jb jc jd je jw jg jh ji jx jk jl jm jy jo jp jq jr hm dt translated">太棒了。这就是全部了。现在，当工厂被部署后，用所需的值作为参数调用<code class="eh js jt ju jv b">createBank(..,..)</code>函数将导致一个新的<code class="eh js jt ju jv b">Bank</code>契约保存这些值！</p><p id="1a7d" class="pw-post-body-paragraph it iu ht iw b ix iy iz ja jb jc jd je jw jg jh ji jx jk jl jm jy jo jp jq jr hm dt translated">想看看用HardHat怎么做吗？当然，我们开始吧，反正烤箱里的披萨还没做好。</p><h1 id="04d8" class="lg lh ht bd li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md dt translated">用安全帽测试</h1><p id="df30" class="pw-post-body-paragraph it iu ht iw b ix me iz ja jb mf jd je jw mg jh ji jx mh jl jm jy mi jp jq jr hm dt translated">1 —创建一个新目录并安装hardhat:</p><figure class="kp kq kr ks fq kt fe ff paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="fe ff mj"><img src="../Images/4e3289a4de05892ec02f5db3430d322b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tQvK-RKTLr-mAId3BF22HQ.png"/></div></div></figure><p id="97bf" class="pw-post-body-paragraph it iu ht iw b ix iy iz ja jb jc jd je jw jg jh ji jx jk jl jm jy jo jp jq jr hm dt translated">2 —创建新项目并安装依赖项:</p><figure class="kp kq kr ks fq kt fe ff paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="fe ff mk"><img src="../Images/95197d8884c58629968c103dfcff606c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bZKZjLUhK3vtOX_ruZMW4A.png"/></div></div></figure><p id="87da" class="pw-post-body-paragraph it iu ht iw b ix iy iz ja jb jc jd je jw jg jh ji jx jk jl jm jy jo jp jq jr hm dt translated">3-用您选择的文本编辑器打开文件夹。我喜欢Visual Studio代码:</p><figure class="kp kq kr ks fq kt fe ff paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="fe ff ml"><img src="../Images/e25d0f9e4e047812799dca81e10b8937.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TUyCQAeSNe0wK4m3KOTxOA.png"/></div></div></figure><p id="1271" class="pw-post-body-paragraph it iu ht iw b ix iy iz ja jb jc jd je jw jg jh ji jx jk jl jm jy jo jp jq jr hm dt translated">4-创建一个新的实体文件，并将代码复制到其中:</p><figure class="kp kq kr ks fq kt"><div class="bz el l di"><div class="le lf l"/></div></figure><p id="86fd" class="pw-post-body-paragraph it iu ht iw b ix iy iz ja jb jc jd je jw jg jh ji jx jk jl jm jy jo jp jq jr hm dt translated">5 —编制合同:</p><figure class="kp kq kr ks fq kt fe ff paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="fe ff mm"><img src="../Images/b8d505423fa9765af96a01ce7bdc6149.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jXZLL11OoVF8sbzEOue-ew.png"/></div></div></figure><p id="b5b2" class="pw-post-body-paragraph it iu ht iw b ix iy iz ja jb jc jd je jw jg jh ji jx jk jl jm jy jo jp jq jr hm dt translated">6 —测试一下！。注意测试脚本。复制粘贴代码到它，让我们运行它！</p><figure class="kp kq kr ks fq kt"><div class="bz el l di"><div class="le lf l"/></div></figure><figure class="kp kq kr ks fq kt fe ff paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="fe ff mn"><img src="../Images/a9ce6f6b7f144c6b547647f4d235e49d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CXb73NOwlIclwB_XP4IglA.png"/></div></div></figure><p id="9616" class="pw-post-body-paragraph it iu ht iw b ix iy iz ja jb jc jd je jw jg jh ji jx jk jl jm jy jo jp jq jr hm dt translated">瞧啊。希望你和我一样开心！我得走了，披萨好了。</p><p id="3782" class="pw-post-body-paragraph it iu ht iw b ix iy iz ja jb jc jd je jw jg jh ji jx jk jl jm jy jo jp jq jr hm dt translated"><strong class="iw hu">兴趣链接:</strong></p><p id="3a5d" class="pw-post-body-paragraph it iu ht iw b ix iy iz ja jb jc jd je jw jg jh ji jx jk jl jm jy jo jp jq jr hm dt translated"><a class="ae ki" href="https://docs.uniswap.org/protocol/V2/reference/smart-contracts/factory" rel="noopener ugc nofollow" target="_blank">https://docs . unis WAP . org/protocol/V2/reference/smart-contracts/factory</a></p><p id="0a95" class="pw-post-body-paragraph it iu ht iw b ix iy iz ja jb jc jd je jw jg jh ji jx jk jl jm jy jo jp jq jr hm dt translated"><a class="ae ki" href="https://research.csiro.au/blockchainpatterns/general-patterns/contract-structural-patterns/factory-contract/" rel="noopener ugc nofollow" target="_blank">https://research . CSIRO . au/block chain patterns/general-patterns/contract-structural-patterns/factory-contract/</a></p><p id="eeac" class="pw-post-body-paragraph it iu ht iw b ix iy iz ja jb jc jd je jw jg jh ji jx jk jl jm jy jo jp jq jr hm dt translated"><a class="ae ki" href="https://arxiv.org/abs/1706.03700" rel="noopener ugc nofollow" target="_blank">https://arxiv.org/abs/1706.03700</a></p><p id="3e77" class="pw-post-body-paragraph it iu ht iw b ix iy iz ja jb jc jd je jw jg jh ji jx jk jl jm jy jo jp jq jr hm dt translated"><a class="ae ki" href="https://www.researchgate.net/publication/303996559_Untrusted_Business_Process_Monitoring_and_Execution_Using_Blockchain" rel="noopener ugc nofollow" target="_blank">https://www . research gate . net/publication/303996559 _ Untrusted _ Business _ Process _ Monitoring _ and _ Execution _ Using _ block chain</a></p><p id="9157" class="pw-post-body-paragraph it iu ht iw b ix iy iz ja jb jc jd je jw jg jh ji jx jk jl jm jy jo jp jq jr hm dt translated"><a class="ae ki" href="https://docs.openzeppelin.com/learn/deploying-and-interacting#interacting-from-the-console" rel="noopener ugc nofollow" target="_blank">https://docs . open zeppelin . com/learn/developing-smart-contracts</a></p></div></div>    
</body>
</html>