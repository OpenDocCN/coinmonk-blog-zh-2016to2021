<html>
<head>
<title>What to Expect when your Smart Contract is Audited: The Auditor’s Story</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">当你的智能合同被审计时，你会期待什么:审计师的故事</h1>
<blockquote>原文：<a href="https://medium.com/coinmonks/what-to-expect-when-your-smart-contract-is-audited-the-auditors-story-5099afd4b439?source=collection_archive---------16-----------------------#2018-07-12">https://medium.com/coinmonks/what-to-expect-when-your-smart-contract-is-audited-the-auditors-story-5099afd4b439?source=collection_archive---------16-----------------------#2018-07-12</a></blockquote><div><div class="ef hh hi hj hk hl"/><div class="hm hn ho hp hq"><div class=""/><p id="7014" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">作为一名审计员，我试图确保您的合同能够抵御EVM级别的攻击。这些攻击利用EVM逻辑的细微差别来入侵您的智能合约。我看的不是你的商业逻辑。这项工作落在了您的测试编写人员身上。我可以做到这一点，DApp的开发人员从定义上来说是博学的，但这需要更多的时间，应该分开来研究。</p><p id="1e54" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">具体来说，我针对的是由Consensys和以太坊基金会发布的已知攻击列表。</p><ul class=""><li id="50bc" class="jo jp ht is b it iu ix iy jb jq jf jr jj js jn jt ju jv jw dt translated">竞争条件(可重入性和跨功能竞争条件)</li><li id="8546" class="jo jp ht is b it jx ix jy jb jz jf ka jj kb jn jt ju jv jw dt translated">交易顺序依赖(TOD) /前端运行</li><li id="0dff" class="jo jp ht is b it jx ix jy jb jz jf ka jj kb jn jt ju jv jw dt translated">时间戳依赖性</li><li id="a9cb" class="jo jp ht is b it jx ix jy jb jz jf ka jj kb jn jt ju jv jw dt translated">整数溢出和下溢(包括存储操作)</li><li id="cfa0" class="jo jp ht is b it jx ix jy jb jz jf ka jj kb jn jt ju jv jw dt translated">带有意外回复的拒绝服务</li><li id="225a" class="jo jp ht is b it jx ix jy jb jz jf ka jj kb jn jt ju jv jw dt translated">具有阻塞气体限制的拒绝服务</li><li id="93b0" class="jo jp ht is b it jx ix jy jb jz jf ka jj kb jn jt ju jv jw dt translated">强行发送以太合同</li></ul><p id="5c42" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">(这些攻击的完整描述可在https://consensys . github . io/smart-contract-best-practices/known _ attacks/找到，伯恩哈德·穆勒的权威演讲可在https://youtu.be/iqf6epACgds的<a class="ae kc" href="https://youtu.be/iqf6epACgds" rel="noopener ugc nofollow" target="_blank">找到。)</a></p><p id="733f" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">现在我要做的第一件事是测试你的合同，最好是用你已经写好的测试脚本。如果我不能访问这些，我会用Truffle或Remix编译你的合同，以确保合同编译并公开合同规范中详述的功能。</p><p id="49d5" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">一旦我知道我正在使用一个有效的契约，我需要采取几个步骤来确保我的审计应用程序能够识别您的契约导入的每一个依赖项。我需要获取已经部署的任何依赖项的代码，然后在本地链接它。如果您的代码所在的框架在路径方面有任何问题，我会将您的依赖项复制到与您的契约相同的文件夹中，并将导入语句重定向到这个副本。然后，我需要对我复制的每个依赖项进行同样的操作，因为它们通常也有我需要在本地公开的依赖项。</p><p id="d4f5" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">此时，我将启动Docker，运行我的审计应用程序的本地实例，并使用符号执行命令让它运行与您的合同的一系列模拟交互。这样做的目的是利用任何给定输入的抽象来探索参与者可以与您的契约执行的每一种可能的交互。因此，它不是测试可以传递给每个函数的每一个可能的值，这比宇宙的热寂要花更长的时间，而是传递一个代表每一个可能输入的符号。这为软件测试你的契约的流程控制中所有可能的递归腾出了时间。我测试的标准递归深度是8级递归，但是如果我们要进行正式审计，我会做得更深入，试图伪造正式审计所需的任何数学证明。</p><figure class="ke kf kg kh fq ki fe ff paragraph-image"><div role="button" tabindex="0" class="kj kk di kl bf km"><div class="fe ff kd"><img src="../Images/3ae0391919d019bd69345db5ab53d977.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*sbFqlHOPeRBc78FanLr2Yw.png"/></div></div><figcaption class="kp kq fg fe ff kr ks bd b be z ek"><a class="ae kc" href="https://github.com/ConsenSys/mythril/wiki/Control-Flow-Graph" rel="noopener ugc nofollow" target="_blank">https://github.com/ConsenSys/mythril/wiki/Control-Flow-Graph</a></figcaption></figure><p id="44d7" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">一旦审计应用程序完成了对所有可能性的探索，它将返回一个报告，然后我将把这个报告转换成适当的文件格式；通常是markdown，但是有些项目需要JSON报告，以便被第三方应用程序解析。该报告将包含普通和非普通漏洞。微不足道的是技术上的漏洞，但通常不可利用。例如，如果您的契约构建在OpenZeppelin智能契约之上，理论上它们可能具有恶意的业务逻辑，但是如果我们检查并看到OpenZeppelin是一个被接受的标准，并且没有任何会改变源契约行为的委托调用，我们知道我们是安全的。</p><p id="8ca4" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">您的业务逻辑通常会暴露重要的漏洞。我看到的一个常见问题是整数溢出，这是由处理数组的for循环引起的。在这种情况下，业务逻辑可能是合理的，因为控制到位，没有数组长度的组合或for循环的迭代会导致数组长度超过2**256。但我会建议客户要求或执行对该特定功能的正式审计，以便从数学上证明控制逻辑边界和统计漏洞边界之间没有交集…或者至少它们在给定时间范围内相交的概率在客户的风险承受范围内。</p><p id="2105" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">最后，我将写下我的“正式审计建议”,其中我确定了那些暴露重要漏洞的函数，并建议对它们进行正式审计或重写，以便排除那些漏洞。只有客户和他们的开发团队才能决定哪个选项是最合适的。不过，一般来说，你希望你的合同需要尽可能少的证据，所以明智的做法通常是先重写，然后再进行第二次审计。</p><p id="3e7d" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">审计和测试是良好契约安全性的支柱。如果你在你的合同中处理金钱，你绝对应该从专家那里寻求那些服务。此外，如果您正在寻找区块链解决方案方面的专家，随时欢迎您通过<a class="ae kc" href="https://web3devs.com/" rel="noopener ugc nofollow" target="_blank"> web3devs </a>联系我的团队！</p></div></div>    
</body>
</html>