<html>
<head>
<title>Solidity Smart Contracts Walk-through Series Part-1</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Solidity智能合约演练系列第1部分</h1>
<blockquote>原文：<a href="https://medium.com/coinmonks/solidity-smart-contracts-walk-through-series-part-1-90075f4e9da6?source=collection_archive---------2-----------------------#2019-10-10">https://medium.com/coinmonks/solidity-smart-contracts-walk-through-series-part-1-90075f4e9da6?source=collection_archive---------2-----------------------#2019-10-10</a></blockquote><div><div class="ef hh hi hj hk hl"/><div class="hm hn ho hp hq"><div class=""/><figure class="fi fk ir is it iu fe ff paragraph-image"><div role="button" tabindex="0" class="iv iw di ix bf iy"><div class="fe ff iq"><img src="../Images/341523a99ec4faa6e0177ac501b3d169.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-B5ZnpIYPDdT7leUjjEoyQ.jpeg"/></div></div><figcaption class="jb jc fg fe ff jd je bd b be z ek">Photo by <a class="ae jf" href="https://unsplash.com/@mari?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">Mari Helin</a> on <a class="ae jf" href="https://unsplash.com/s/photos/contracts?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="dec1" class="pw-post-body-paragraph jg jh ht ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated">本系列的基本思想是理解Solidity编写的智能合同的技术流程和基于用例的概念。在这个系列中，我们将经历三个不同的用例:<strong class="ji hu">“财产拍卖”、“出租财产”&amp;“商业伙伴关系”</strong>。对于每个用例，我们将首先讨论我们应该覆盖哪些功能，然后理解技术实现细节。代码库可以在<a class="ae jf" href="https://github.com/Harry-027/Solidity-Smart-Contracts-Walkthrough" rel="noopener ugc nofollow" target="_blank"> <strong class="ji hu">这里找到</strong> </a>。请记住，这不是一个功能齐全的产品。这些智能合约已经在本地使用Ganache &amp;进行了测试，不属于任何生产/测试网络。它们仅仅是为了教育目的而开发的。</p><p id="f39c" class="pw-post-body-paragraph jg jh ht ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated">这是智能合同演练系列的<strong class="ji hu">第1部分</strong>。在接下来的文章中，我将向你深入介绍财产拍卖智能合同的技术实现细节。</p><p id="03c1" class="pw-post-body-paragraph jg jh ht ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated"><strong class="ji hu">房产拍卖用例::</strong></p><p id="e8fe" class="pw-post-body-paragraph jg jh ht ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated">让我们假设一个用户想要拍卖他的财产。保持简单将使我们的场景类似于拍卖(<strong class="ji hu">不是一个完全成熟的拍卖</strong>)。基本场景是任何用户(除了资产所有者)都可以参与拍卖。每位参与者都将获得一次投标机会&amp;转让他们的投标金额。合同将存储参与者的投标金额。业主希望的任何时间；他可以通过将财产所有权转让给最高出价者&amp;最高出价金额到他自己的钱包地址来停止拍卖。其他参与者可以随时从合同中撤回各自的投标金额。新的所有者将无法再次开始拍卖给定的财产，除非所有其他用户从合同中撤回他们以前的出价金额。</p><p id="0534" class="pw-post-body-paragraph jg jh ht ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated"><strong class="ji hu">我们开始吧……</strong></p><p id="9eee" class="pw-post-body-paragraph jg jh ht ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated">以下是我们要使用的不同数据类型:</p><figure class="kf kg kh ki fq iu fe ff paragraph-image"><div role="button" tabindex="0" class="iv iw di ix bf iy"><div class="fe ff ke"><img src="../Images/061305d4e95422179a3974d219e79ac2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SgrwfjvjnC18FyH2F-rd_Q.png"/></div></div><figcaption class="jb jc fg fe ff jd je bd b be z ek">Data Types to be used</figcaption></figure><p id="107a" class="pw-post-body-paragraph jg jh ht ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated">我们正在定义一个<strong class="ji hu">属性</strong>结构，它将存储属性名&amp;和其他细节。因为可能有大量的细节，所以用户可以存储细节的散列(在契约之外准备细节散列)。我们有<strong class="ji hu">状态</strong>结构，它将跟踪以下内容:</p><ul class=""><li id="80dc" class="kj kk ht ji b jj jk jn jo jr kl jv km jz kn kd ko kp kq kr dt translated"><strong class="ji hu">竞拍者</strong>:这将存储参与竞拍的人数。</li><li id="f5af" class="kj kk ht ji b jj ks jn kt jr ku jv kv jz kw kd ko kp kq kr dt translated"><strong class="ji hu">最高出价</strong>:最高出价金额。</li><li id="d85a" class="kj kk ht ji b jj ks jn kt jr ku jv kv jz kw kd ko kp kq kr dt translated"><strong class="ji hu">最高出价者</strong>:最高出价者的地址。</li><li id="9312" class="kj kk ht ji b jj ks jn kt jr ku jv kv jz kw kd ko kp kq kr dt translated"><strong class="ji hu">竞价完成</strong>:检查竞价是否完成。</li></ul><p id="ef34" class="pw-post-body-paragraph jg jh ht ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated"><strong class="ji hu">所有者</strong>将存储资产所有者钱包地址&amp; <strong class="ji hu"> isProspect </strong>是存储每个参与者的投标金额值的映射。</p><p id="54d5" class="pw-post-body-paragraph jg jh ht ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated">为确认各种交易而定义的下列事件:</p><figure class="kf kg kh ki fq iu fe ff paragraph-image"><div class="fe ff kx"><img src="../Images/654511cad1aa620d7070c2299dea0169.png" data-original-src="https://miro.medium.com/v2/resize:fit:996/format:webp/1*TND8E_fWAlCyP5iBS6ZoJw.png"/></div></figure><p id="32f7" class="pw-post-body-paragraph jg jh ht ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated">属性详细信息、合同状态字段和所有者钱包地址将在合同部署时初始化(当构造器被调用时<strong class="ji hu"/>)。在所有者&amp;非所有者之间隔离各种功能的修饰符也定义如下:</p><figure class="kf kg kh ki fq iu fe ff paragraph-image"><div role="button" tabindex="0" class="iv iw di ix bf iy"><div class="fe ff ky"><img src="../Images/2d0ea0c7f21a8ab98ae91a535bef1990.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cM62jhpmtGjeRXopAxkeZw.png"/></div></div></figure><p id="6e7a" class="pw-post-body-paragraph jg jh ht ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated">进入我们的投标功能:</p><figure class="kf kg kh ki fq iu fe ff paragraph-image"><div role="button" tabindex="0" class="iv iw di ix bf iy"><div class="fe ff kz"><img src="../Images/34a59ad6488f5f1334288aaddd76548b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*P2ISyTXEggRsl_T57A7W5w.png"/></div></div></figure><p id="01ca" class="pw-post-body-paragraph jg jh ht ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated">使用<strong class="ji hu"> nonOwner </strong>修饰符这个方法已经被限制为Owner。如果交易成功，则返回true。指定为<strong class="ji hu">应付款</strong>，因为各个参与者将发送其投标金额(需要存储在合同中)。如果用户之前没有参与，我们将允许用户参与(否则我们将恢复交易，这里使用的require operator将帮助我们)。我们将为用户设置<strong class="ji hu"> isProspect </strong>映射，增加参与者计数(<strong class="ji hu">投标人</strong> ++) &amp;，同时设置<strong class="ji hu">最高投标人</strong> &amp; <strong class="ji hu">投标金额</strong>，以防用户金额多于其他参与者。一旦交易成功，将发出<strong class="ji hu"> reg </strong>事件，返回值为<strong class="ji hu"> true </strong>。</p><blockquote class="la lb lc"><p id="a842" class="jg jh ld ji b jj jk jl jm jn jo jp jq le js jt ju lf jw jx jy lg ka kb kc kd hm dt translated">注意——任何具有可支付选项的函数将允许契约在其自己的地址存储乙醚量(在函数调用期间从用户处接收)。</p></blockquote><figure class="kf kg kh ki fq iu fe ff paragraph-image"><div role="button" tabindex="0" class="iv iw di ix bf iy"><div class="fe ff lh"><img src="../Images/62d5cfc309b1831bd9c307fc42c3a95e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JCrgK06HVevWHdcrRbebUg.png"/></div></div><figcaption class="jb jc fg fe ff jd je bd b be z ek">Only owner can invoke this method &amp; declare the result</figcaption></figure><p id="e247" class="pw-post-body-paragraph jg jh ht ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated">仅允许所有者调用<strong class="ji hu">投标结果</strong>。这种方法会将房产所有权转让给<strong class="ji hu">最高出价者</strong>。它还会将最高出价金额转移到当前所有者地址&amp;标记拍卖已完成。它会将<strong class="ji hu">最高出价人</strong>的<strong class="ji hu"> isProspect </strong>映射重置为0 &amp;减少参与者的数量(这将有助于我们跟踪剩余参与者的正确数量以提取他们的金额)。一旦交易成功，它将发出<strong class="ji hu">结果</strong>事件&amp;也返回真布尔值。</p><figure class="kf kg kh ki fq iu fe ff paragraph-image"><div role="button" tabindex="0" class="iv iw di ix bf iy"><div class="fe ff ke"><img src="../Images/dae19dcccb77aa69c24b6430989a2104.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HMUTYv8yL3v5gMGuALphoA.png"/></div></div><figcaption class="jb jc fg fe ff jd je bd b be z ek">Method that helps users to withdraw their respective bidding amount</figcaption></figure><p id="88f1" class="pw-post-body-paragraph jg jh ht ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated">上述方法允许参与者提取他们各自存储投标金额。任何时候，任何用户希望退出拍卖或希望在拍卖完成后取回自己的金额，都可以调用此方法。该方法将检查<strong class="ji hu"> isProspect </strong>映射，以获得用户的相应金额。然后，它会将所需金额转移到用户的钱包地址。<strong class="ji hu">参与者计数</strong>也会减少，以反映实际的参与者计数。请注意，当拍卖结果被宣布时，我们减少了这个计数&amp;还重置了最高出价者的<strong class="ji hu">预期</strong>映射，因为我们不希望拍卖获胜者认领他的钱。</p><figure class="kf kg kh ki fq iu fe ff paragraph-image"><div role="button" tabindex="0" class="iv iw di ix bf iy"><div class="fe ff li"><img src="../Images/f118e54d61c0cf4aa3ba319c4f7d1e91.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*yzeyN9tpTr7IBwEKMnZ9sg.png"/></div></div></figure><p id="5553" class="pw-post-body-paragraph jg jh ht ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated">一旦拍卖完成，新的财产所有人可能会再次开始拍卖。在这种情况下，我们将确保如果前一轮拍卖的所有参与者都提取了他们各自的金额&amp;然后只允许所有者再次开始拍卖。施加此条件是因为我们在这里重置了关键参数，例如<strong class="ji hu">highest bid</strong>&amp;<strong class="ji hu">highest bider</strong>。</p><figure class="kf kg kh ki fq iu fe ff paragraph-image"><div class="fe ff lj"><img src="../Images/6ce87e24187606c2351b4751ee377e66.png" data-original-src="https://miro.medium.com/v2/resize:fit:1380/format:webp/1*y3nO0_4w6niMcVMLymN6cw.png"/></div></figure><p id="3669" class="pw-post-body-paragraph jg jh ht ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated">一旦没有参与者离开，所有者可以销毁拍卖合同，并将储存的乙醚转移到他自己的地址(如果有的话)。</p></div><div class="ab cl lk ll hb lm" role="separator"><span class="ln bw bk lo lp lq"/><span class="ln bw bk lo lp lq"/><span class="ln bw bk lo lp"/></div><div class="hm hn ho hp hq"><p id="8649" class="pw-post-body-paragraph jg jh ht ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated">我希望你喜欢。让它尽可能简单的主要原因是为了理解整体的实现思想。请务必查看下一部分，我们将在这里了解物业租赁智能合同。</p><p id="4b0c" class="pw-post-body-paragraph jg jh ht ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated"><em class="ld">其他部分:</em><a class="ae jf" rel="noopener" href="/@harish0y2j/solidity-smart-contracts-walk-through-series-part-1-90075f4e9da6"><em class="ld">Part-1</em></a><em class="ld">，</em><a class="ae jf" rel="noopener" href="/@harish0y2j/solidity-smart-contracts-walk-through-series-part-2-d526c5d5782e"><em class="ld">Part-2</em></a><em class="ld">，</em> <a class="ae jf" rel="noopener" href="/@harish0y2j/solidity-smart-contracts-walk-through-series-part-3-480ba8019ab9"> <em class="ld"> Part-3 </em> </a></p><p id="d296" class="pw-post-body-paragraph jg jh ht ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated">代码库可以在这里找到<a class="ae jf" href="https://github.com/Harry-027/Solidity-Smart-Contracts-Walkthrough" rel="noopener ugc nofollow" target="_blank">。</a></p><blockquote class="lr"><p id="a910" class="ls lt ht bd lu lv lw lx ly lz ma kd ek translated"><a class="ae jf" href="https://coincodecap.com/?utm_source=coinmonks" rel="noopener ugc nofollow" target="_blank">直接在您的收件箱中获得最佳软件交易</a></p></blockquote><figure class="mc md me mf mg iu fe ff paragraph-image"><a href="https://coincodecap.com/?utm_source=coinmonks"><div class="fe ff mb"><img src="../Images/7c0b3dfdcbfea594cc0ae7d4f9bf6fcb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1168/format:webp/0*OJ-qb5G6i863msBB.png"/></div></a></figure></div></div>    
</body>
</html>