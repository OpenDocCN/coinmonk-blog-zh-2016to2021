<html>
<head>
<title>A Simple ERC20 Exchange Wallet</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">一个简单的ERC20兑换钱包</h1>
<blockquote>原文：<a href="https://medium.com/coinmonks/a-simple-erc20-exchange-wallet-c6720e6c8005?source=collection_archive---------0-----------------------#2018-11-17">https://medium.com/coinmonks/a-simple-erc20-exchange-wallet-c6720e6c8005?source=collection_archive---------0-----------------------#2018-11-17</a></blockquote><div><div class="ef hh hi hj hk hl"/><div class="hm hn ho hp hq"><div class=""/><div class=""><h2 id="fd01" class="pw-subtitle-paragraph iq hs ht bd b ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ek translated">为ERC20代币制作一个保管钱包并不像你想象的那么简单</h2></div><figure class="jj jk jl jm fq jn fe ff paragraph-image"><div class="fe ff ji"><img src="../Images/bc6c4b89d8016d371e49d5147d49f806.png" data-original-src="https://miro.medium.com/v2/resize:fit:1360/format:webp/0*S0dbcbOwQtH9_3DI.png"/></div></figure><h2 id="ce9a" class="jq jr ht bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn dt translated">更新</h2><p id="a351" class="pw-post-body-paragraph ko kp ht kq b kr ks iu kt ku kv ix kw kb kx ky kz kf la lb lc kj ld le lf lg hm dt translated">我是一个很棒的项目的技术顾问。我们正在交易所建设下一代，如果可以的话，我鼓励你去看看！</p><h2 id="7501" class="jq jr ht bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn dt translated">放弃</h2><p id="3535" class="pw-post-body-paragraph ko kp ht kq b kr ks iu kt ku kv ix kw kb kx ky kz kf la lb lc kj ld le lf lg hm dt translated"><em class="li">请明智一点，在没有进行尽职调查并确保代码满足您的安全需求之前，不要将本文中的代码投入生产。本文仅供娱乐和教育之用，并不构成对您组织的安全或保管决策的建议。</em></p><h2 id="8914" class="jq jr ht bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn dt translated">问题是</h2><p id="2b40" class="pw-post-body-paragraph ko kp ht kq b kr ks iu kt ku kv ix kw kb kx ky kz kf la lb lc kj ld le lf lg hm dt translated">以太坊钱包在交易所管理起来可能有点棘手，因为每个以太坊地址都有自己的钱包。它不像比特币或Cardano，你可以在主地址下生成子账户，反映余额，并用单个钱包地址进行管理。这在交换的典型流程中提出了一个问题，其中用户将生成一个存款地址来发送他们的资金。在以太坊中，如果我们为用户生成一个帐户来发送他们的资金，我们还需要在交易所中维护该帐户的私钥。这是一场监护权的噩梦，无法维持。</p><blockquote class="lj"><p id="363e" class="lk ll ht bd lm ln lo lp lq lr ls lg ek translated">还可阅读:<a class="ae lh" rel="noopener" href="/coinmonks/the-best-cryptocurrency-hardware-wallets-of-2020-e28b1c124069">最佳加密货币硬件钱包</a></p></blockquote><h2 id="7142" class="jq jr ht bd js jt lt jv jw jx lu jz ka kb lv kd ke kf lw kh ki kj lx kl km kn dt translated">我们想要什么</h2><p id="a014" class="pw-post-body-paragraph ko kp ht kq b kr ks iu kt ku kv ix kw kb kx ky kz kf la lb lc kj ld le lf lg hm dt translated">我们想要做的是在我们的交易所有一个保管钱包，我们有一个<strong class="kq hu">单个私钥</strong>并生成<strong class="kq hu">多个</strong> <strong class="kq hu">公共存款地址</strong>供客户存款。</p><h2 id="9c0c" class="jq jr ht bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn dt translated">我们的解决方案</h2><p id="f595" class="pw-post-body-paragraph ko kp ht kq b kr ks iu kt ku kv ix kw kb kx ky kz kf la lb lc kj ld le lf lg hm dt translated">解决这个问题的一个方法是创建一个<em class="li">智能契约</em>，它创建并拥有其他<em class="li">智能契约</em>。这是非常高的水平，但是我们本质上是这样做的</p><ul class=""><li id="e283" class="ly lz ht kq b kr ma ku mb kb mc kf md kj me lg mf mg mh mi dt translated">部署由我们的<strong class="kq hu">保管以太坊账户</strong>拥有的智能合同，该合同能够创建<strong class="kq hu">子钱包</strong>并返回它们的列表</li><li id="459d" class="ly lz ht kq b kr mj ku mk kb ml kf mm kj mn lg mf mg mh mi dt translated">让子钱包由<strong class="kq hu">保管以太坊账户</strong>和<strong class="kq hu">而不是</strong>由父智能合约拥有</li></ul><p id="c7bf" class="pw-post-body-paragraph ko kp ht kq b kr ma iu kt ku mb ix kw kb mo ky kz kf mp lb lc kj mq le lf lg hm dt translated">这将允许<strong class="kq hu">保管账户</strong>管理发送到该钱包的所有资金。这是一种类似的方法，大型托管提供商如<strong class="kq hu"> <em class="li">、BitGo </em> </strong>都使用这种方法。</p></div><div class="ab cl mr ms hb mt" role="separator"><span class="mu bw bk mv mw mx"/><span class="mu bw bk mv mw mx"/><span class="mu bw bk mv mw"/></div><div class="hm hn ho hp hq"><h1 id="0255" class="my jr ht bd js mz na nb jw nc nd ne ka iz nf ja ke jc ng jd ki jf nh jg km ni dt translated">超级钱包！！！</h1><figure class="jj jk jl jm fq jn"><div class="bz el l di"><div class="nj nk l"/></div></figure><p id="3b58" class="pw-post-body-paragraph ko kp ht kq b kr ma iu kt ku mb ix kw kb mo ky kz kf mp lb lc kj mq le lf lg hm dt translated">我们的<em class="li"> MegaWallet </em>代码如下，你可以看到我们创建钱包的方法，并列出拥有的钱包。</p><figure class="jj jk jl jm fq jn"><div class="bz el l di"><div class="nl nk l"/></div></figure><p id="b019" class="pw-post-body-paragraph ko kp ht kq b kr ma iu kt ku mb ix kw kb mo ky kz kf mp lb lc kj mq le lf lg hm dt translated">如果您注意到，我们能够在创建的<em class="li"> ERC20Wallet </em>中存储<strong class="kq hu">任何</strong> <em class="li"> ERC20 </em>令牌—只要它符合<strong class="kq hu">open zeppelin</strong>detailed er C20类型。</p><pre class="jj jk jl jm fq nm nn no np aw nq dt"><span id="d7de" class="jq jr ht nn b fv nr ns l nt nu">ERC20Wallet wallet = new ERC20Wallet(DetailedERC20(_token), owner);</span></pre><p id="c660" class="pw-post-body-paragraph ko kp ht kq b kr ma iu kt ku mb ix kw kb mo ky kz kf mp lb lc kj mq le lf lg hm dt translated">这既强大又危险，因为你可以在一个钱包里存放你在交易所的所有代币。你不应该这样做，但你应该创造<strong class="kq hu">多个</strong> <strong class="kq hu">热</strong>和<strong class="kq hu">冷</strong>钱包，在流动性和<strong class="kq hu">安全性</strong>之间保持良好的平衡。</p><h2 id="e9e6" class="jq jr ht bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn dt translated">ERC 20钱包</h2><p id="fd99" class="pw-post-body-paragraph ko kp ht kq b kr ks iu kt ku kv ix kw kb kx ky kz kf la lb lc kj ld le lf lg hm dt translated">这就是我们将<strong class="kq hu">生成</strong>并将<strong class="kq hu">公共地址</strong>发送给用户存放的子钱包。</p><figure class="jj jk jl jm fq jn"><div class="bz el l di"><div class="nl nk l"/></div></figure><p id="085a" class="pw-post-body-paragraph ko kp ht kq b kr ma iu kt ku mb ix kw kb mo ky kz kf mp lb lc kj mq le lf lg hm dt translated">注意，我们传入了<strong class="kq hu">令牌</strong>地址和<strong class="kq hu">所有者</strong>地址。我们传入<strong class="kq hu">令牌</strong>地址，这样当我们想要<strong class="kq hu">清除</strong>所有存款账户时，我们就可以转移那个特定的令牌。我们传入<strong class="kq hu">所有者</strong>地址，这样我们就可以从我们的<strong class="kq hu">保管账户</strong>中拥有这个钱包，并为<strong class="kq hu">扫描</strong>设置目的地。</p></div><div class="ab cl mr ms hb mt" role="separator"><span class="mu bw bk mv mw mx"/><span class="mu bw bk mv mw mx"/><span class="mu bw bk mv mw"/></div><div class="hm hn ho hp hq"><h1 id="cdac" class="my jr ht bd js mz na nb jw nc nd ne ka iz nf ja ke jc ng jd ki jf nh jg km ni dt translated">试验</h1><p id="a6e6" class="pw-post-body-paragraph ko kp ht kq b kr ks iu kt ku kv ix kw kb kx ky kz kf la lb lc kj ld le lf lg hm dt translated">我们在下面的测试中设定了一些期望。我们需要一个<strong class="kq hu">外部</strong>账户，我们知道其<strong class="kq hu">私有</strong>密钥，所以我们使用<em class="li">truffle-HD-wallet-privkey</em>库来模拟一个exchange用户向我们生成的钱包地址发送资金。我们还必须创造一个虚拟的<em class="li"> ERC20 </em>硬币来测试我们的钱包功能，这个硬币被恰当地命名为<em class="li">genericer 20</em>。测试本身应该是不言自明的，但如果你对它的意图有任何疑问，请随时问我。</p><figure class="jj jk jl jm fq jn"><div class="bz el l di"><div class="nl nk l"/></div></figure></div><div class="ab cl mr ms hb mt" role="separator"><span class="mu bw bk mv mw mx"/><span class="mu bw bk mv mw mx"/><span class="mu bw bk mv mw"/></div><div class="hm hn ho hp hq"><h1 id="0290" class="my jr ht bd js mz na nb jw nc nd ne ka iz nf ja ke jc ng jd ki jf nh jg km ni dt translated">尝试一下</h1><h2 id="1f99" class="jq jr ht bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn dt translated">环境和回购</h2><p id="c3c3" class="pw-post-body-paragraph ko kp ht kq b kr ks iu kt ku kv ix kw kb kx ky kz kf la lb lc kj ld le lf lg hm dt translated">您需要安装以下软件</p><ul class=""><li id="dab8" class="ly lz ht kq b kr ma ku mb kb mc kf md kj me lg mf mg mh mi dt translated">加纳切—<a class="ae lh" href="https://truffleframework.com/ganache" rel="noopener ugc nofollow" target="_blank">https://truffleframework.com/ganache</a></li><li id="7b41" class="ly lz ht kq b kr mj ku mk kb ml kf mm kj mn lg mf mg mh mi dt translated">块菌— <code class="eh nv nw nx nn b">npm install -g truffle</code></li></ul><pre class="jj jk jl jm fq nm nn no np aw nq dt"><span id="70b5" class="jq jr ht nn b fv nr ns l nt nu"># Clone the wallet repository<br/>git clone <a class="ae lh" href="mailto:git@github.com" rel="noopener ugc nofollow" target="_blank">git@github.com</a>:cipherzzz/erc20-megawallet.git</span><span id="09d1" class="jq jr ht nn b fv ny ns l nt nu"># Install the dependencies<br/>npm install</span></pre><h2 id="aca5" class="jq jr ht bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn dt translated">项目设置</h2><p id="983e" class="pw-post-body-paragraph ko kp ht kq b kr ks iu kt ku kv ix kw kb kx ky kz kf la lb lc kj ld le lf lg hm dt translated">将<code class="eh nv nw nx nn b">.env.example</code>复制到名为<code class="eh nv nw nx nn b">.env</code>的新文件中</p><p id="3401" class="pw-post-body-paragraph ko kp ht kq b kr ma iu kt ku mb ix kw kb mo ky kz kf mp lb lc kj mq le lf lg hm dt translated">将ganache应用程序中的助记短语添加到您的<code class="eh nv nw nx nn b">.env</code></p><p id="d4e1" class="pw-post-body-paragraph ko kp ht kq b kr ma iu kt ku mb ix kw kb mo ky kz kf mp lb lc kj mq le lf lg hm dt translated">在你的<code class="eh nv nw nx nn b">.env</code>文件中添加一个除了第一个以外的任何一个ganache账户的公钥和私钥(我用的是第六个)。只需点击<code class="eh nv nw nx nn b">key</code>图标，您将看到公钥和私钥。</p><p id="a028" class="pw-post-body-paragraph ko kp ht kq b kr ma iu kt ku mb ix kw kb mo ky kz kf mp lb lc kj mq le lf lg hm dt translated">您还需要确保您的<code class="eh nv nw nx nn b">truffle.js</code>中列出的post与您的ganache服务器运行的端口相匹配。通常不是<code class="eh nv nw nx nn b">7545</code>就是<code class="eh nv nw nx nn b">8545</code>。</p><h2 id="bd36" class="jq jr ht bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn dt translated">运行它</h2><p id="0246" class="pw-post-body-paragraph ko kp ht kq b kr ks iu kt ku kv ix kw kb kx ky kz kf la lb lc kj ld le lf lg hm dt translated">现在你已经准备好享受你的劳动成果了——看看所有这些是否会奏效。请注意测试的输出，并研究它们以了解隐藏的内容。</p><pre class="jj jk jl jm fq nm nn no np aw nq dt"><span id="2a5d" class="jq jr ht nn b fv nr ns l nt nu"># Compile the contracts<br/>truffle compile</span><span id="14b6" class="jq jr ht nn b fv ny ns l nt nu"># Migrate/Deploy them to the network(Ganache in this case)<br/>truffle migrate</span><span id="233f" class="jq jr ht nn b fv ny ns l nt nu"># Run the tests<br/>truffle test</span></pre></div><div class="ab cl mr ms hb mt" role="separator"><span class="mu bw bk mv mw mx"/><span class="mu bw bk mv mw mx"/><span class="mu bw bk mv mw"/></div><div class="hm hn ho hp hq"><h1 id="2162" class="my jr ht bd js mz na nb jw nc nd ne ka iz nf ja ke jc ng jd ki jf nh jg km ni dt translated">摘要</h1><p id="f403" class="pw-post-body-paragraph ko kp ht kq b kr ks iu kt ku kv ix kw kb kx ky kz kf la lb lc kj ld le lf lg hm dt translated">这篇文章中有很多高阶概念，一开始可能并不明显。我鼓励大家深入研究这些测试，如果有任何问题，可以问我。这是一个具有挑战性的问题，希望它能给你一些启发，让你在将来使用智能合约来解决自己的问题。这个项目的仓库是<a class="ae lh" href="https://github.com/cipherzzz/erc20-megawallet" rel="noopener ugc nofollow" target="_blank">这里</a>供你参考。</p><h2 id="0aac" class="jq jr ht bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn dt translated">放弃</h2><p id="6f84" class="pw-post-body-paragraph ko kp ht kq b kr ks iu kt ku kv ix kw kb kx ky kz kf la lb lc kj ld le lf lg hm dt translated"><em class="li">请明智一点，不要将本文中的代码投入生产，除非首先进行尽职调查并确保它符合您的安全需求。本文仅供娱乐和教育之用，并不构成对您组织的安全或保管决策的建议。</em></p><blockquote class="lj"><p id="76b9" class="lk ll ht bd lm ln lo lp lq lr ls lg ek translated"><a class="ae lh" href="https://coincodecap.com/?utm_source=coinmonks" rel="noopener ugc nofollow" target="_blank">直接在您的收件箱中获得最佳软件交易</a></p></blockquote><figure class="oa ob oc od oe jn fe ff paragraph-image"><a href="https://coincodecap.com/?utm_source=coinmonks"><div class="fe ff nz"><img src="../Images/7c0b3dfdcbfea594cc0ae7d4f9bf6fcb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1168/format:webp/0*OJ-qb5G6i863msBB.png"/></div></a></figure></div></div>    
</body>
</html>