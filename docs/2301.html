<html>
<head>
<title>Intro to Solidity Linting and Formatting</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">固体林挺和格式简介</h1>
<blockquote>原文：<a href="https://medium.com/coinmonks/introduction-to-solidity-linting-and-formatting-e838c074791a?source=collection_archive---------0-----------------------#2019-07-05">https://medium.com/coinmonks/introduction-to-solidity-linting-and-formatting-e838c074791a?source=collection_archive---------0-----------------------#2019-07-05</a></blockquote><div><div class="ef hh hi hj hk hl"/><div class="hm hn ho hp hq"><div class=""/><div class=""><h2 id="9478" class="pw-subtitle-paragraph iq hs ht bd b ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ek translated">Solhint、beauty-Solidity和Git挂钩的开发人员工作流</h2></div><figure class="jj jk jl jm fq jn fe ff paragraph-image"><div role="button" tabindex="0" class="jo jp di jq bf jr"><div class="fe ff ji"><img src="../Images/bc9b767991030346ff2174d7d0d7626b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UwaAIpO6UmRAY_ICQ9xikw.jpeg"/></div></div><figcaption class="ju jv fg fe ff jw jx bd b be z ek">Photo by <a class="ae jy" href="https://unsplash.com/@markusspiske?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">Markus Spiske</a> on <a class="ae jy" href="https://unsplash.com/search/photos/digital?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="a283" class="pw-post-body-paragraph jz ka ht kb b kc kd iu ke kf kg ix kh ki kj kk kl km kn ko kp kq kr ks kt ku hm dt translated">以太坊开发者社区开始开发一些<a class="ae jy" rel="noopener" href="/protofire-blog/solhint-an-advanced-linter-for-ethereums-solidity-c6b155aced7b">漂亮的</a> <a class="ae jy" href="https://github.com/duaraghav8/Ethlint" rel="noopener ugc nofollow" target="_blank">令人敬畏的</a> <a class="ae jy" href="https://github.com/prettier-solidity/prettier-plugin-solidity" rel="noopener ugc nofollow" target="_blank">工具</a>，让我们更接近自动化工作流和开发者“驾驶舱”，我们在更成熟的语言如Javascript或Go中已经有了。</p><p id="8d2c" class="pw-post-body-paragraph jz ka ht kb b kc kd iu ke kf kg ix kh ki kj kk kl km kn ko kp kq kr ks kt ku hm dt translated">其中两个工具触及了开发人员工作流程中最核心的部分:编写代码:</p><ul class=""><li id="a695" class="kv kw ht kb b kc kd kf kg ki kx km ky kq kz ku la lb lc ld dt translated">Linters 自动分析代码中可能的编程和样式错误(常见的例子:ESLint for Javascript)</li><li id="885b" class="kv kw ht kb b kc le kf lf ki lg km lh kq li ku la lb lc ld dt translated"><strong class="kb hu">格式化器</strong>根据预定义的规则和缩进默认值自动格式化代码(通俗的例子:gofmt for go)</li></ul><p id="881f" class="pw-post-body-paragraph jz ka ht kb b kc kd iu ke kf kg ix kh ki kj kk kl km kn ko kp kq kr ks kt ku hm dt translated">本教程介绍了<strong class="kb hu">中的<strong class="kb hu">一种</strong>多种</strong>设置方法。我们在使用<a class="ae jy" href="https://www.trufflesuite.com/" rel="noopener ugc nofollow" target="_blank"> Truffle框架</a>的回购环境中介绍了这些工具，但是这些步骤可以适用于任何框架(或者不适用)。</p></div><div class="ab cl lj lk hb ll" role="separator"><span class="lm bw bk ln lo lp"/><span class="lm bw bk ln lo lp"/><span class="lm bw bk ln lo"/></div><div class="hm hn ho hp hq"><h1 id="3f01" class="lq lr ht bd ls lt lu lv lw lx ly lz ma iz mb ja mc jc md jd me jf mf jg mg mh dt translated">第1部分:棉绒</h1><p id="5b75" class="pw-post-body-paragraph jz ka ht kb b kc mi iu ke kf mj ix kh ki mk kk kl km ml ko kp kq mm ks kt ku hm dt translated">Solhint 和<a class="ae jy" href="https://github.com/duaraghav8/Ethlint" rel="noopener ugc nofollow" target="_blank"> Ethlint </a>(以前的Solium)是Solidity语言的两个奇妙的社区标记。他们就像自动代码审查者，标记安全错误并在团队中灌输最佳实践。</p><p id="9bf1" class="pw-post-body-paragraph jz ka ht kb b kc kd iu ke kf kg ix kh ki kj kk kl km kn ko kp kq kr ks kt ku hm dt translated">对于本教程，我们将重点关注Solhint，尽管我强烈建议您也带Ethlint出去转转。</p><h2 id="8dda" class="mn lr ht bd ls mo mp mq lw mr ms mt ma ki mu mv mc km mw mx me kq my mz mg na dt translated">Solhint</h2><p id="fb1d" class="pw-post-body-paragraph jz ka ht kb b kc mi iu ke kf mj ix kh ki mk kk kl km ml ko kp kq mm ks kt ku hm dt translated">首先，确保您在项目根目录中，然后使用NPM或Yarn添加solhint模块。</p><pre class="jj jk jl jm fq nb nc nd ne aw nf dt"><span id="e934" class="mn lr ht nc b fv ng nh l ni nj">&gt; npm install --save-dev solhint</span></pre><h2 id="1ee5" class="mn lr ht bd ls mo mp mq lw mr ms mt ma ki mu mv mc km mw mx me kq my mz mg na dt translated">配置Solhint</h2><p id="4530" class="pw-post-body-paragraph jz ka ht kb b kc mi iu ke kf mj ix kh ki mk kk kl km ml ko kp kq mm ks kt ku hm dt translated">用基本配置文件初始化<code class="eh nk nl nm nc b">solhint</code>。</p><pre class="jj jk jl jm fq nb nc nd ne aw nf dt"><span id="ba39" class="mn lr ht nc b fv ng nh l ni nj">&gt; ./node_modules/.bin/solhint init-config</span></pre><p id="9496" class="pw-post-body-paragraph jz ka ht kb b kc kd iu ke kf kg ix kh ki kj kk kl km kn ko kp kq kr ks kt ku hm dt translated">这应该会在项目的根目录下创建一个<code class="eh nk nl nm nc b">./solhint.json</code>文件。这个文件确切地指定了您希望sol hint lint处理哪些规则。Solhint对<a class="ae jy" href="https://github.com/protofire/solhint/blob/master/docs/rules.md#security-rules" rel="noopener ugc nofollow" target="_blank">安全规则</a>、<a class="ae jy" href="https://github.com/protofire/solhint/blob/master/docs/rules.md#style-guide-rules" rel="noopener ugc nofollow" target="_blank">风格指南规则</a>和<a class="ae jy" href="https://github.com/protofire/solhint/blob/master/docs/rules.md#best-practise-rules" rel="noopener ugc nofollow" target="_blank">最佳实践规则</a>的覆盖范围相当惊人。</p><p id="4415" class="pw-post-body-paragraph jz ka ht kb b kc kd iu ke kf kg ix kh ki kj kk kl km kn ko kp kq kr ks kt ku hm dt translated">一个大问题:<strong class="kb hu">默认情况下很少规则被打开</strong>。经过一些试验和错误之后，我发现<code class="eh nk nl nm nc b"><strong class="kb hu">solhint:recommended</strong></code>比Solhint在<a class="ae jy" href="https://github.com/protofire/solhint#configuration" rel="noopener ugc nofollow" target="_blank">文档</a>中列出的<code class="eh nk nl nm nc b">solhint:default</code>稍微好一点。</p><p id="c9e4" class="pw-post-body-paragraph jz ka ht kb b kc kd iu ke kf kg ix kh ki kj kk kl km kn ko kp kq kr ks kt ku hm dt translated">我强烈建议浏览一下规则列表，把你想要的添加到<code class="eh nk nl nm nc b">./solhint.json</code>中。我个人认为安全规则和最佳实践非常有用。</p><figure class="jj jk jl jm fq jn"><div class="bz el l di"><div class="nn no l"/></div></figure><h2 id="dfc3" class="mn lr ht bd ls mo mp mq lw mr ms mt ma ki mu mv mc km mw mx me kq my mz mg na dt translated">Solhint忽略</h2><p id="6e84" class="pw-post-body-paragraph jz ka ht kb b kc mi iu ke kf mj ix kh ki mk kk kl km ml ko kp kq mm ks kt ku hm dt translated">类似于<code class="eh nk nl nm nc b">.gitignore</code>，你可以让<code class="eh nk nl nm nc b">solhint</code>忽略文件和文件夹</p><pre class="jj jk jl jm fq nb nc nd ne aw nf dt"><span id="ebfb" class="mn lr ht nc b fv ng nh l ni nj">node_modules/<br/>migrations/</span></pre><h2 id="7f77" class="mn lr ht bd ls mo mp mq lw mr ms mt ma ki mu mv mc km mw mx me kq my mz mg na dt translated">Solhint脚本</h2><p id="ce58" class="pw-post-body-paragraph jz ka ht kb b kc mi iu ke kf mj ix kh ki mk kk kl km ml ko kp kq mm ks kt ku hm dt translated">编辑您的<code class="eh nk nl nm nc b">package.json</code>以包含一个新脚本来运行Solhint。</p><pre class="jj jk jl jm fq nb nc nd ne aw nf dt"><span id="33f5" class="mn lr ht nc b fv ng nh l ni nj">"solhint": "./node_modules/.bin/solhint -f table contracts/**/*.sol"</span></pre><p id="6953" class="pw-post-body-paragraph jz ka ht kb b kc kd iu ke kf kg ix kh ki kj kk kl km kn ko kp kq kr ks kt ku hm dt translated">上面的命令有几点需要注意:</p><ul class=""><li id="59aa" class="kv kw ht kb b kc kd kf kg ki kx km ky kq kz ku la lb lc ld dt translated"><code class="eh nk nl nm nc b">Solhint</code>在匹配文件模式的globs上运行。在上面的例子中，它运行在<code class="eh nk nl nm nc b">contracts</code>目录中的所有<code class="eh nk nl nm nc b">**/*.sol</code>文件上</li><li id="3e13" class="kv kw ht kb b kc le kf lf ki lg km lh kq li ku la lb lc ld dt translated"><code class="eh nk nl nm nc b">-f table</code>以表格形式展示调查结果。您可以从其他选项中选择(例如<code class="eh nk nl nm nc b">unix</code>、<code class="eh nk nl nm nc b">tap</code>)</li></ul><h2 id="2289" class="mn lr ht bd ls mo mp mq lw mr ms mt ma ki mu mv mc km mw mx me kq my mz mg na dt translated">Solhint在行动</h2><pre class="jj jk jl jm fq nb nc nd ne aw nf dt"><span id="894b" class="mn lr ht nc b fv ng nh l ni nj">&gt; npm run solhint</span></pre><p id="078c" class="pw-post-body-paragraph jz ka ht kb b kc kd iu ke kf kg ix kh ki kj kk kl km kn ko kp kq kr ks kt ku hm dt translated">您可能会看到许多错误，尤其是缩进和样式错误。不需要手动修复这些！我们的下一个工具(格式化程序)将对此有很大帮助。</p><figure class="jj jk jl jm fq jn fe ff paragraph-image"><div role="button" tabindex="0" class="jo jp di jq bf jr"><div class="fe ff np"><img src="../Images/5e0e0419f162a02045038056c325c92a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*2n7XzJ2Z9_fpru2Az9ek-A.gif"/></div></div><figcaption class="ju jv fg fe ff jw jx bd b be z ek">Solhint in action</figcaption></figure></div><div class="ab cl lj lk hb ll" role="separator"><span class="lm bw bk ln lo lp"/><span class="lm bw bk ln lo lp"/><span class="lm bw bk ln lo"/></div><div class="hm hn ho hp hq"><h1 id="6e8a" class="lq lr ht bd ls lt lu lv lw lx ly lz ma iz mb ja mc jc md jd me jf mf jg mg mh dt translated">第二步:格式化程序</h1><p id="a993" class="pw-post-body-paragraph jz ka ht kb b kc mi iu ke kf mj ix kh ki mk kk kl km ml ko kp kq mm ks kt ku hm dt translated">是一个神奇的工具，它可以根据预定义的风格指南自动格式化代码库。只需在团队层面事先就规则达成一致，然后beauty会以同样的方式自动套用每个人的代码。</p><p id="c53f" class="pw-post-body-paragraph jz ka ht kb b kc kd iu ke kf kg ix kh ki kj kk kl km kn ko kp kq kr ks kt ku hm dt translated"><a class="ae jy" href="https://github.com/prettier-solidity/prettier-plugin-solidity" rel="noopener ugc nofollow" target="_blank">beauty-solidity</a>是一个与Solhint协同工作的更漂亮的solidity文件。它有助于自动修复Solhint发现的许多错误，尤其是像缩进和代码样式这样简单的错误。</p><p id="a645" class="pw-post-body-paragraph jz ka ht kb b kc kd iu ke kf kg ix kh ki kj kk kl km kn ko kp kq kr ks kt ku hm dt translated">这是一项与活跃的<a class="ae jy" href="https://gitter.im/prettier-solidity/Lobby" rel="noopener ugc nofollow" target="_blank"> Gitter社区一起进行的工作，在过去的几个月里进展非常快。</a></p><h2 id="1685" class="mn lr ht bd ls mo mp mq lw mr ms mt ma ki mu mv mc km mw mx me kq my mz mg na dt translated">安装更漂亮</h2><pre class="jj jk jl jm fq nb nc nd ne aw nf dt"><span id="0a87" class="mn lr ht nc b fv ng nh l ni nj">&gt; npm install --save-dev prettier prettier-plugin-solidity</span></pre><h2 id="826f" class="mn lr ht bd ls mo mp mq lw mr ms mt ma ki mu mv mc km mw mx me kq my mz mg na dt translated">配置更漂亮</h2><p id="c138" class="pw-post-body-paragraph jz ka ht kb b kc mi iu ke kf mj ix kh ki mk kk kl km ml ko kp kq mm ks kt ku hm dt translated">您可以使用<code class="eh nk nl nm nc b">.prettierrc</code>文件进行更漂亮的配置。Solhint的大多数规则都是现成的，但是您可能想要添加或关闭其中的一些。我建议保持简短。</p><p id="00cb" class="pw-post-body-paragraph jz ka ht kb b kc kd iu ke kf kg ix kh ki kj kk kl km kn ko kp kq kr ks kt ku hm dt translated">你可以阅读<a class="ae jy" href="https://prettier.io/docs/en/options.html" rel="noopener ugc nofollow" target="_blank">更漂亮的文档</a>了解更多细节。您也可以在<code class="eh nk nl nm nc b">.prettierignore</code>中指定想要忽略的文件。</p><pre class="jj jk jl jm fq nb nc nd ne aw nf dt"><span id="0ebe" class="mn lr ht nc b fv ng nh l ni nj">{<br/>  "printWidth": 100,<br/>  "singleQuote": true<br/>}</span></pre><h2 id="9a14" class="mn lr ht bd ls mo mp mq lw mr ms mt ma ki mu mv mc km mw mx me kq my mz mg na dt translated">配置Solhint以使用更漂亮的</h2><p id="1963" class="pw-post-body-paragraph jz ka ht kb b kc mi iu ke kf mj ix kh ki mk kk kl km ml ko kp kq mm ks kt ku hm dt translated">安装<a class="ae jy" href="https://github.com/fvictorio/solhint-plugin-prettier" rel="noopener ugc nofollow" target="_blank">solhint-plugin-appearlier</a>，这使得sol hint可以很好地与appearlier-Solidity配合使用。</p><pre class="jj jk jl jm fq nb nc nd ne aw nf dt"><span id="cdee" class="mn lr ht nc b fv ng nh l ni nj">&gt; npm install --save-dev solhint-plugin-prettier</span></pre><p id="a3c5" class="pw-post-body-paragraph jz ka ht kb b kc kd iu ke kf kg ix kh ki kj kk kl km kn ko kp kq kr ks kt ku hm dt translated">然后更新<code class="eh nk nl nm nc b">./solhint.json</code>把更漂亮的作为插件和规则加入。</p><figure class="jj jk jl jm fq jn"><div class="bz el l di"><div class="nn no l"/></div></figure><h2 id="e18e" class="mn lr ht bd ls mo mp mq lw mr ms mt ma ki mu mv mc km mw mx me kq my mz mg na dt translated">运行更漂亮-可靠性</h2><p id="25be" class="pw-post-body-paragraph jz ka ht kb b kc mi iu ke kf mj ix kh ki mk kk kl km ml ko kp kq mm ks kt ku hm dt translated">给你的<code class="eh nk nl nm nc b">package.json</code>添加更漂亮的命令。</p><p id="70ac" class="pw-post-body-paragraph jz ka ht kb b kc kd iu ke kf kg ix kh ki kj kk kl km kn ko kp kq kr ks kt ku hm dt translated"><code class="eh nk nl nm nc b">--write</code>标志将格式化并覆盖您现有的文件。根据更漂亮的<a class="ae jy" href="https://prettier.io/docs/en/cli.html" rel="noopener ugc nofollow" target="_blank">文档</a>，首先提交代码是个好主意。</p><pre class="jj jk jl jm fq nb nc nd ne aw nf dt"><span id="800d" class="mn lr ht nc b fv ng nh l ni nj">"prettier:solidity": "./node_modules/.bin/prettier --write contracts/**/*.sol"</span></pre><p id="f758" class="pw-post-body-paragraph jz ka ht kb b kc kd iu ke kf kg ix kh ki kj kk kl km kn ko kp kq kr ks kt ku hm dt translated">然后在命令行中</p><pre class="jj jk jl jm fq nb nc nd ne aw nf dt"><span id="3c43" class="mn lr ht nc b fv ng nh l ni nj">&gt; npm run prettier:solidity</span></pre><figure class="jj jk jl jm fq jn fe ff paragraph-image"><div role="button" tabindex="0" class="jo jp di jq bf jr"><div class="fe ff nq"><img src="../Images/9d694b49fcac469119a8fe1f87fefcc3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*LFiubKRmu732FTOhNKDXQw.gif"/></div></div><figcaption class="ju jv fg fe ff jw jx bd b be z ek">Prettier in action</figcaption></figure></div><div class="ab cl lj lk hb ll" role="separator"><span class="lm bw bk ln lo lp"/><span class="lm bw bk ln lo lp"/><span class="lm bw bk ln lo"/></div><div class="hm hn ho hp hq"><h1 id="ff50" class="lq lr ht bd ls lt lu lv lw lx ly lz ma iz mb ja mc jc md jd me jf mf jg mg mh dt translated">步骤3: Git挂钩(可选)</h1><p id="bb78" class="pw-post-body-paragraph jz ka ht kb b kc mi iu ke kf mj ix kh ki mk kk kl km ml ko kp kq mm ks kt ku hm dt translated">在一个理想的世界里，我们总是记得在将代码推送到我们团队的代码库之前运行我们的linter和formatter。</p><p id="8346" class="pw-post-body-paragraph jz ka ht kb b kc kd iu ke kf kg ix kh ki kj kk kl km kn ko kp kq kr ks kt ku hm dt translated">幸运的是，我们可以用Git钩子自动化这个过程。这些小脚本总是在Git事件之前或之后运行，比如<strong class="kb hu">提交、推送或接收。</strong></p><h2 id="4222" class="mn lr ht bd ls mo mp mq lw mr ms mt ma ki mu mv mc km mw mx me kq my mz mg na dt translated">设置Husky</h2><p id="a02b" class="pw-post-body-paragraph jz ka ht kb b kc mi iu ke kf mj ix kh ki mk kk kl km ml ko kp kq mm ks kt ku hm dt translated">我们将使用一个<a class="ae jy" href="https://github.com/typicode/husky" rel="noopener ugc nofollow" target="_blank"> Husky </a>，这是一个非常有用的npm模块，负责处理git挂钩的丑陋内部。</p><pre class="jj jk jl jm fq nb nc nd ne aw nf dt"><span id="7c4e" class="mn lr ht nc b fv ng nh l ni nj">npm install --save-dev husky</span></pre><p id="4b57" class="pw-post-body-paragraph jz ka ht kb b kc kd iu ke kf kg ix kh ki kj kk kl km kn ko kp kq kr ks kt ku hm dt translated">然后，给你的<code class="eh nk nl nm nc b">package.json</code>加几行。在下面的例子中，我们使用<code class="eh nk nl nm nc b">pre-push</code>钩子来运行我们的漂亮格式化程序。</p><pre class="jj jk jl jm fq nb nc nd ne aw nf dt"><span id="38cd" class="mn lr ht nc b fv ng nh l ni nj">// package.json<br/>{<br/>  "husky": {<br/>    "hooks": {<br/>       "pre-push": "npm run prettier:solidity"<br/>    }<br/>  }<br/>}</span></pre><p id="1453" class="pw-post-body-paragraph jz ka ht kb b kc kd iu ke kf kg ix kh ki kj kk kl km kn ko kp kq kr ks kt ku hm dt translated">现在，每当您团队中的任何开发人员向Github推送时，您的格式化程序都会运行。</p><figure class="jj jk jl jm fq jn fe ff paragraph-image"><div role="button" tabindex="0" class="jo jp di jq bf jr"><div class="fe ff nr"><img src="../Images/7eef681e34dac817e4f1c368678bfb02.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*HOAnbZLQ1PYH-uz_L-JaQA.gif"/></div></div><figcaption class="ju jv fg fe ff jw jx bd b be z ek">Git Hooks: formatting your code automatically before pushing to Github</figcaption></figure><blockquote class="ns"><p id="fc4e" class="nt nu ht bd nv nw nx ny nz oa ob ku ek translated"><a class="ae jy" href="https://coincodecap.com/?utm_source=coinmonks" rel="noopener ugc nofollow" target="_blank">直接在您的收件箱中获得最佳软件交易</a></p></blockquote><figure class="od oe of og oh jn fe ff paragraph-image"><a href="https://coincodecap.com/?utm_source=coinmonks"><div class="fe ff oc"><img src="../Images/7c0b3dfdcbfea594cc0ae7d4f9bf6fcb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1168/format:webp/0*OJ-qb5G6i863msBB.png"/></div></a></figure></div></div>    
</body>
</html>