# 气温能预测 MLB 奥运会的上座率吗？

> 原文：<https://medium.com/coinmonks/can-temperature-predict-attendance-at-mlb-games-d0b6a50217e0?source=collection_archive---------7----------------------->

[本系列的第 1 部分](/@jordanbean/whats-the-deal-with-declining-mlb-attendance-part-1-62a0f39ba0b0)确定了问题陈述以及我们希望通过数据揭示的内容，并完成了所需数据的获取和清理。提醒一下，我们试图回答的问题是:**气温对美国职业棒球大联盟比赛的上座率有影响吗？**

[第 2 部分](/@jordanbean/analyzing-mlb-attendance-and-temperature-6cb2b1af2bd4)通过对转换后的子数据段进行图形分析，开始了一些探索性的数据分析。例如，我们验证了整体上座率下降的趋势，确定了异常数据点及其解释，查看了可能影响上座率的其他非天气因素(即每场比赛的时间、进攻输出)。

最后，我们查看了一系列散点图，试图通过使用 1990 年至 2017 年期间每个城市的月平均温度和每场比赛的上座率来寻找温度和每场比赛的上座率之间的关系。

![](img/802775af6112e05375d4ef8a7bccdd1f.png)

总的来说，这两个变量之间几乎没有关系(0.09 的 r 平方，其中 0 =没有关系)。了解到在夏季，“低于平均值”的温度实际上并不是一个问题(实际上在一些城市可能是一个优势)，然后我们在较冷的月份(4 月、5 月)寻找这两个变量之间的关系。再次，仍然没有有意义的关系。

我们关注的最后一个削减是在春季寒冷天气的城市(四月平均温度低于 55 度)。如果这两个变量之间有关系，它肯定会在这里显示出来，但它没有。这给我们留下了什么？

![](img/d21c75822767bc3e6f89f8f4bbb3c422.png)![](img/20df584aad344416e1e7e44f2e480d5a.png)

在这个系列中，我要采取的最后两个步骤是:1)尝试用数据中的变量来模拟每场比赛的上座率数字，2)在寒冷天气城市的春季比赛中，寻找高于和低于平均水平的每场比赛上座率之间的差异的统计意义(下一篇文章)。

完整代码[可在这里](https://nbviewer.jupyter.org/github/jordanbean/MLB-Weather-Attendance/blob/master/MLB%20Weather%20Attendance%20Final.ipynb)获得，欢迎任何反馈！

**建模**

我们建模的目标将是回答这个问题: ***我们能否根据温度(以及是高于还是低于平均值)、月份和团队来准确预测出席率？***

为了实现这一点，我选择尝试两种不同类型的模型:线性回归和随机森林。坦白地说，这是我第一次在课程之外学习建模，所以我相信还有很大的改进空间，我欢迎任何想法或主意。

线性回归试图通过给每个变量指定一个相对斜率来拟合数据点的 1 次线。随机森林模型是一系列聚集的决策树，为每个观察值输出一个预测。

建模的第一步是准备数据。在本例中，有两个重要的分类(非数字)变量是我想要包含的，因此必须进行转换。第一个是主队，第二个是月份。

这些变量之所以重要，是因为不同的球队有不同的体育场容量和受欢迎程度，如下图所示。我们想在预测中考虑到主队的受欢迎程度。我们也可以在逐场比赛的数据集中使用客队的变量，但这不包括在本次分析中。月份很重要，因为每场比赛的平均上座率也会随着月份的不同而略有不同，因此我们也想把这个变量包括进去。

![](img/6e8620a18ed683c379f6012adddd52f5.png)![](img/3e1fe30b630425cb2e5f44f84265bdf8.png)

为了包含这些变量，我们对它们进行“一次热编码”。这个过程为每个变量创建新的列，当变量为真时，给它赋值 1，否则为 0。下面是独热编码数据的表示。前五行都对应于明尼苏达双城队，所以那一列有一个 1，其余的标记为 0。第一行代码创建编码的变量，而第二行将新列连接到更大的数据集。

![](img/f76ffc30c53e5f6f1b12d1ff20f663eb.png)

**基线模型:**

为了确定模型的有效性，通过标准化的误差计算建立基线预测非常重要。这将创建一个度量值，通过该度量值来比较其他模型预测。如果模型可以改善(降低)错误，那么机器学习可能是解决问题的有效资源。如果不是，那么可能需要更多的数据收集、不同的输入或新的方法。

对于基线预测，我将一个城市的平均月出席率与每个月团队数据点进行匹配，并计算平均绝对误差(MAE ),即预测值和实际值之间的总误差，然后除以观察次数。

解读下面第一个数据点的方法是:1990 年 4 月，洋基队每场比赛的平均上座率是 23，700，而在这个分析的所有年份(1990-2017)，洋基队 4 月的平均上座率是 36，641。

![](img/33e5512763976d7ab31248dbbb233ab2.png)![](img/06a3af0c640f050d6dde266f8e5a5189.png)

使用这种方法的 MAE 约为 5，550，这可以解释为，平均而言，每场比赛的“预测”上座率和实际上座率之间的差异约为 5，550 名粉丝。

**线性回归**

使用 Python 的 sci-kit 学习库，我们将对每场比赛的出席人数进行建模。为便于分析，选择了以下变量。选择这些的原因是我们正在确定天气和团队是否可以预测出席率。

![](img/d826d3825b4c7363caf450eb7e6c44ef.png)

由于变量之间的数量级不同，我们还必须对它们进行缩放，以获得一个共同的范围。这缓解了具有较高绝对值的变量仅仅因为其大小而支配模型的问题。

我在简单的多元线性回归中遇到的一个问题是系数的大小。当我运行模型时，团队和月份编码变量的系数是一致的(即所有月份变量都是相同的，所有团队变量也是如此)，它们的大小远远超过了合理范围内的值。

我知道有些事情是错误的，因为正如探索性数据分析所证明的那样，我们知道每场比赛的平均上座率因月份和团队而异，这意味着 7 月份纽约的上座率与 4 月份坦帕湾的不同，我们的模型应该反映这一点。

因此，我在普通最小二乘线性回归上运行了两个变量，岭回归和套索回归。岭回归和 Lasso 回归都是避免更复杂的线性模型过度拟合的方法，主要区别在于岭回归将非重要特征最小化，而 Lasso 将无关因素的系数一直推至 0，从而将其排除在考虑范围之外。要了解更多信息，我发现[这篇文章](https://codingstartups.com/practical-machine-learning-ridge-regression-vs-lasso/)写得很好，用通俗的语言解释了为什么这些在线性回归建模中是有益的。

*山脊* *&套索*

岭回归和套索回归为我们提供了一幅缩放变量每次增量变化的幅度图。下面显示了两个回归的每个变量的系数值。因为它们非常相似，所以我只讨论岭回归的发现。

![](img/224cf0b20c47d75049a756ea485fba0f.png)![](img/36aa874cb4368ac84176937405c95d69.png)

具有较高绝对量值的变量对我们的最终模型预测更有影响。例如，洛杉矶道奇队和扬基队作为主队显著增加了每场比赛的预计上座率，而坦帕湾队和迈阿密队显著降低了预测。

从方向上来说，我们的温度变量是正的，这意味着随着温度的上升，每场比赛的上座率也会上升，大约有 870 名球迷。

平均绝对误差——我们的评分标准——是三个回归(简单线性回归、岭回归、套索回归)中每一个的大约 5，665，这与我们大约 5，550 的基线误差不太相称。

![](img/660c150a8571fb1f66eb6ca11c0af1c4.png)

## 随机森林模型

我还花了一些时间试图开发一个随机森林模型来预测每场比赛的上座率变量。

在高层次上，随机森林建模采用一系列决策树，并对结果进行平均，以提供单个具体输出。例如，如果我们试图对温度是高于平均值(1)还是低于平均值(0)进行分类，随机森林将创建一定数量的决策树(比如 1000 个),每个决策树代表一个来自随机数据样本的决策树。

每棵树将给出 1 或 0 的值作为预测，最终输出将是在 1000 个随机采样的决策树中出现频率更高的值。对于回归，同样的过程发生在创建树的过程中，最终结果是每棵树的集合平均值。

我不会对这一点进行太多的详细描述，因为我早期的尝试产生了大约 5，917 的 MAE，所以我无法获得与回归或基线模型相匹配的预测能力，但所有代码都可以在笔记本中找到。

**接下来:**

在系列的[最后一篇文章中，我将运行一些统计显著性测试，并写出练习的结论。](/@jordanbean/is-mlb-attendance-per-game-significantly-different-when-its-cold-793a3553132c)