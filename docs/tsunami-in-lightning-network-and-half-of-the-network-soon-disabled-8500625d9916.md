# 海啸在闪电网络和一半的网络很快禁用？

> 原文：<https://medium.com/coinmonks/tsunami-in-lightning-network-and-half-of-the-network-soon-disabled-8500625d9916?source=collection_archive---------1----------------------->

我以前通过执行健康检查来研究过 Lightning Network，以查看哪些节点实际存在。TL；DR 就是 2/3 的节点[都是僵尸](/@robban_69827/lightning-network-routing-fud-and-zombies-776b8238e66b)。我猜你可以称之为对闪电网络的 67%的攻击，但它仍然工作得很好，支付被路由。实现中的不同路由算法似乎都能够在大多数时候推动支付。

有一些理论分析说，从 A 点到 B 点有一定比例的获得一定数量的资金，但大多数这些研究包括只与测试通道连接的节点，以尝试这种新东西。

就像如果你对法定货币感到好奇，并得到一张预付的 VISA 卡并存入 1 美元，你用 2 美元买一杯咖啡的可能性极低。这并不能让你说美元永远不能用来买咖啡。

正如 [Andreas M. Antonopoulos](https://medium.com/u/898f59563d67?source=post_page-----8500625d9916--------------------------------) 所说，路由发现甚至不是 LN 规范的一部分，实现可以自由使用他们认为合适的任何算法。目前，路由仅基于源，因此发送方决定尝试什么路由。Dijkstra 和 Bellman-Ford 使用的关于局部网络的观点是最常见的方法。这个视频有点旧，但仍然相关，是必看的。快进到 8m16s 获取源路由信息，但说真的，请观看整个视频。

Misconceptions about Lightning Network

# 第 1 层和第 2 层

比特币区块链和闪电都是点对点网络，信息传播到所有节点。

在第一层，即区块链网络中，每一杯被买走的咖啡都被传播到所有的节点，被验证和记录，直到永远。如果你或任何人对你的咖啡消费习惯感兴趣，这当然非常有用。

通过在区块链上添加第二层，您只需存储区块链上某个频道的打开和关闭。不管你买了多少咖啡，除了你这个顾客，没人知道你买了多少咖啡。卖家也不会，除非你每次买咖啡他都会给你做 KYC。如果你仍然希望每个人都知道你的咖啡习惯，你可以使用第三方解决方案，如 facebook。

我想把区块链号想象成一堆加固的大型机库船，更小更快的飞机可以在这里起飞和降落。

[闪电网络的粉丝 Roger Ver](https://medium.com/u/6d5e25448edf?source=post_page-----8500625d9916--------------------------------) 将 LN 比作将超越东京火车的飞行汽车。

Roger Ver Loves Lightning Network

还有许多其他的类比，越来越多的加密货币正在将闪电网络视为他们的第二层解决方案。它不是为 BTC 保留的，而是所有想要加入的货币的共同网络。

似乎在加密领域的所有部分都有一个共识，即第 2 层是需要的，并且需要更加成熟，而第 1 层，即区块链，应该被认为是一个分布式数据库，只保留给较大值的长期/中期存储，您可以在其中等待区块链确认。

现在回到主题。我想是时候调查闪电网络中使用的八卦协议了。我很好奇我会发现什么。我甚至有点害怕。会有很多流言蜚语吗？如果我用更新淹没网络会发生什么？

所以，足够幸运的是，我已经建立了自己的 Lightning Network 实现，我用它来为 https://www.robtex.com/lightning/收集原始数据，但是到目前为止，我只是用它来被动地收集和更新数据库。

![](img/968a9e323417f13dee081be3a48ec98a.png)

# 初始同步

当您连接到一个节点并[可选地]请求所有通道的完全同步时，执行初始同步。有一种新的比我使用的更有效的格式，但我想内容是一样的，我太懒了，没有在我的 BOLT 实现中实现它。真的没什么大不了的，因为网络仍然很小，所以即使旧的未压缩的完全同步对我的 ADSL/ADHD 组合也很好。

我让我的节点连接到随机的节点，并发现一些实现发送它们曾经见过的所有通道，即使这些通道很久以前就关闭了。

一些实现发送按频道 id 排序的频道，一些实现发送按最后更新时间排序的频道。在它们身上做指纹识别相当容易。我改天会做那件事。

# 正常运算

初始同步完成后，您将只有在实际发生变化时才能获得更新。例如，如果一个频道永久地或暂时地下降或上升。节点还广播更新，除了时间戳之外没有任何改变，以确保网络知道它们。一些实现似乎每 24 小时做一次，并发送所有通道的脉冲串。

这显示了更新的爆发。我使用的通道格式是 LN 中最常用的格式，表示块号、块中的索引和输出数。我添加了最后一个数字来显示是通道的左侧还是右侧被更新，因为它们是由每个节点单独更新和签名的。在这种情况下，它们都是 0，这意味着是 ID 最低的节点发送它们，否则应该是 1

```
GOT update btc:531568:2154:1:0 DELTA 86400 AGE 7
GOT update btc:530373:1163:0:0 DELTA 86400 AGE 7
GOT update btc:530981:2243:0:0 DELTA 86400 AGE 7
GOT update btc:531040:1169:0:0 DELTA 86400 AGE 7
GOT update btc:531994:904:1:0 DELTA 86400 AGE 7
GOT update btc:533805:986:0:0 DELTA 86400 AGE 7
GOT update btc:531010:1286:0:0 DELTA 86400 AGE 7
GOT update btc:530838:1880:1:0 DELTA 86400 AGE 7
GOT update btc:530838:1923:1:0 DELTA 86400 AGE 7
```

增量值 86400 意味着从频道的这一侧最后一次广播起正好是 24 小时。年龄 7 意味着消息通过网络到达我的节点需要 7 秒。如果发送节点时钟同步。大部分好像都是。

日志中的另一段摘录显示几个通道明显在摆动

```
GOT update btc:527455:179:1:0 DELTA 7 AGE 29
GOT update btc:527455:179:1:0 DELTA 22 AGE 29
GOT update btc:535105:2130:0:0 DELTA 22 AGE 10
GOT update btc:527455:179:1:0 DELTA 8 AGE 27
GOT update btc:527455:179:1:0 DELTA 12 AGE 39
```

在这里，我们可以清楚地看到，需要一些[更好的]抑制，信道 527455:179:1 感觉不是很好，即使源节点泛洪网络，它也应该被中继节点抑制。在某种程度上确实如此。我不太担心那里。尽管有一些摆动的信道，但网络上每秒钟的字节数并不多。

所以，我想要更多的行动。我试图故意每秒向网络中的多个节点发送一个频道的更新，只是为了看看发生了什么。我是通过为节点 B 和 C 之间的通道编造通道更新来做到这一点的，而我自己的节点则假装只是转发数据包，然后等待回声以另一种方式返回。

我希望我可以开始海啸般的更新，回到我的探测节点，但我完全失败了。我只收到了更新的一个子集，收到更新之间平均需要 20 秒。电视网处理得很好。这是一个非常有趣的实验，虽然很无聊，但结果是积极的。

# 100%支持禁用位

现在有更好的消息！

不幸的是，根据当前螺栓规格对[更新的剖析目前非常单薄，仅限于以下内容:](https://github.com/lightningnetwork/lightning-rfc/blob/master/07-routing-gossip.md)

```
[64:signature]
[32:chain_hash]
[8:short_channel_id]
[4:timestamp]
[2:flags]
[2:cltv_expiry_delta]
[8:htlc_minimum_msat]
[4:fee_base_msat]
[4:fee_proportional_millionths]
```

然而，大多数信息对这个故事来说并不有趣。我们将重点关注如下所示的标志字段:

```
Bit Position  Name       Meaning
0             direction  Direction this update refers to.
1             disable    Disable the channel.
```

第 0 位仅表示哪一方实际进行了更新。消息由发送它的一方签名，因此它更像是消息的限定符，而不是通道的标志。

到目前为止，唯一定义的实际标志是“禁用”位。节点使用它来告诉网络某个通道已关闭，很可能是因为另一个节点脱机。这是**在试图寻找工作路径时非常**有用的知识。现在，LND，可能是最常见的实现，加入了其他两个实现，并开始支持在最新的主机中发送信号。

如果我对死节点的计算和估计是正确的，这将意味着网络上可能有一半的通道将被禁用。这是一个好消息，因为这意味着现在可以在路由之前避免它们。我已经升级了我自己的节点，我已经禁用了略多于 50%的频道，尽管事实上我已经[检测并移除了所有超过三周的僵尸](https://www.moneni.com/nodematch?node=02ad6fb8d693dc1e4569bcedefadf5f72a931ae027dc0f0c544b34c1c6f3b9a02b)。

考虑一下，如果 50%的信道不可用，并且您找到包含 2 个信道的路径，这将意味着 50%*50% = 25%的成功机会。如果有 3 个通道，就意味着 12.5%的几率，4 个通道就意味着 6.25%的几率。现在，随着这一禁用功能很快在网络中的所有节点上启用，发送者将不再需要徒劳地尝试那些死胡同。这将对路径查找和支付速度产生巨大影响。

在支付时，我们仍然需要在渠道的平衡上赌博和试错。我希望在不久的将来，我们也能对此提供更好的支持。但是在所有实现中对禁用位的支持是长期以来最好的进步！LND 的一小步，闪电网络的一大步。我们才刚刚开始！

> [在您的收件箱中直接获得最佳软件交易](https://coincodecap.com/?utm_source=coinmonks)

[![](img/7c0b3dfdcbfea594cc0ae7d4f9bf6fcb.png)](https://coincodecap.com/?utm_source=coinmonks)