<html>
<head>
<title>Executing smart contracts in your browser using Truffle, Ganache, Browserify, and Web3</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Truffle、Ganache、Browserify和Web3在浏览器中执行智能合同</h1>
<blockquote>原文：<a href="https://medium.com/coinmonks/executing-smart-contracts-in-your-browser-using-truffle-ganache-browserify-and-web3-200574d13064?source=collection_archive---------0-----------------------#2021-04-11">https://medium.com/coinmonks/executing-smart-contracts-in-your-browser-using-truffle-ganache-browserify-and-web3-200574d13064?source=collection_archive---------0-----------------------#2021-04-11</a></blockquote><div><div class="ef hh hi hj hk hl"/><div class="hm hn ho hp hq"><div class=""/><p id="d573" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">这里陈述的观点是我个人的，而不是我公司的。</p><p id="fff6" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">有各种各样的工具来构建一个基于区块链的web应用程序。例如，您可以在下面看到一个简单的银行应用程序:</p><figure class="jq jr js jt fq ju fe ff paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="fe ff jp"><img src="../Images/92891fe3e6754c5184d54bf2c904dac3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*iC2AxAJHP_s3IvhPPRWqmg.png"/></div></div><figcaption class="kb kc fg fe ff kd ke bd b be z ek">Simple Bank on the web, with deposit/withdraw smart contracts</figcaption></figure><p id="6750" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">这些合同用<a class="ae kf" href="https://docs.soliditylang.org/en/v0.8.3/" rel="noopener ugc nofollow" target="_blank"> Solidity </a>写成，通过<a class="ae kf" href="https://www.trufflesuite.com/" rel="noopener ugc nofollow" target="_blank"> Truffle </a>执行。虽然我可以验证它们的工作，但让它们在浏览器环境中运行是很困难的。事实上，基本上没有关于这些技术集成的文档。</p><p id="d26c" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">这篇博客文章为你提供了所有的设置，但是没有深入到建立一个简单银行的细节。相反，这将是一个更一般的例子。</p><h1 id="b732" class="kg kh ht bd ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld dt translated">松露</h1><p id="cd51" class="pw-post-body-paragraph iq ir ht is b it le iv iw ix lf iz ja jb lg jd je jf lh jh ji jj li jl jm jn hm dt translated">假设你已经有了你的<code class="eh lj lk ll lm b">MyContract.sol</code>可靠性合同。使用松露部署到您的区块链网络。就我而言，我使用的是Ganache。这在本地运行(在端口<code class="eh lj lk ll lm b">7545</code>上)。</p><p id="155e" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">当您运行<code class="eh lj lk ll lm b">truffle migrate</code>命令时，请注意输出的几个属性。</p><pre class="jq jr js jt fq ln lm lo lp aw lq dt"><span id="1fcf" class="lr kh ht lm b fv ls lt l lu lv">$ truffle deploy<br/><br/>   Replacing 'MyContract'<br/>   ----------------------<br/>   &gt; transaction hash:    0x562f463faa3666e948a08ea96f96ae239aff9f48298f6096ecbd09404903027e<br/>   &gt; Blocks: 0            Seconds: 0</span><span id="dc89" class="lr kh ht lm b fv lw lt l lu lv">   <strong class="lm hu">&gt; contract address:    0x941F4963540B1df054343d115767B9cb3E3cDc3D<br/>   </strong>&gt; block number:        3<br/>   &gt; block timestamp:     1617929065<br/>   <strong class="lm hu">&gt; account:             0xA866B5C54e06fF40cA96d93b7B7FaE1809D0d858<br/>   </strong>&gt; balance:             99.98373884<br/>   &gt; gas used:            390433 (0x5f521)<br/>   &gt; gas price:           20 gwei<br/>   &gt; value sent:          0 ETH<br/>   &gt; total cost:          0.00780866 ETH</span><span id="80e6" class="lr kh ht lm b fv lw lt l lu lv">   &gt; Saving migration to chain.<br/>   &gt; Saving artifacts<br/>   -------------------------------------<br/>   &gt; Total cost:          0.01626116 ETH</span></pre><p id="e2e4" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">保存合同地址和账户地址。因为我们将使用网络浏览器，所以创建一个新的<code class="eh lj lk ll lm b">index.js</code>文件并将它们保存为常量:</p><figure class="jq jr js jt fq ju"><div class="bz el l di"><div class="lx ly l"/></div></figure><p id="046b" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">在我们的根项目目录中创建一个<code class="eh lj lk ll lm b">package.json</code>文件来安装我们的依赖项。NPM可以使用<a class="ae kf" href="https://docs.npmjs.com/about-packages-and-modules" rel="noopener ugc nofollow" target="_blank">包文件</a>来定义你的项目和它需要什么。它允许我们在单个文件中定义依赖项和构建脚本，以获得更大的便利。该文件在行业中使用。</p><figure class="jq jr js jt fq ju"><div class="bz el l di"><div class="lx ly l"/></div></figure><p id="a02a" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">一定要运行<code class="eh lj lk ll lm b">npm install</code>下载一切。</p><p id="2ee0" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">注意，当松露建立你的合同时，会创建一个<code class="eh lj lk ll lm b">build/contracts/MyContract.json</code>。记下这个文件，我们以后会用到它。</p><h1 id="e0cc" class="kg kh ht bd ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld dt translated">设置网站3</h1><p id="3920" class="pw-post-body-paragraph iq ir ht is b it le iv iw ix lf iz ja jb lg jd je jf lh jh ji jj li jl jm jn hm dt translated"><a class="ae kf" href="https://web3js.readthedocs.io/en/v1.3.4/index.html" rel="noopener ugc nofollow" target="_blank"> Web3 </a>本质上是<a class="ae kf" href="https://www.trufflesuite.com/ganache" rel="noopener ugc nofollow" target="_blank"> Ganache测试网络</a>和你的智能合约之间的绑定。它允许您在节点环境中访问您的帐户和执行合同。</p><p id="9705" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">请注意，尽管节点环境和浏览器环境都运行JavaScript，但它们在细微但重要的方面有所不同。我们可以使用类似于<a class="ae kf" href="http://browserify.org/" rel="noopener ugc nofollow" target="_blank">browser ify</a>to<em class="jo">trans file</em>our<code class="eh lj lk ll lm b">index.js</code>into a<code class="eh lj lk ll lm b">bundle.js</code>可以在浏览器中运行。</p><p id="0fdf" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">这就是<code class="eh lj lk ll lm b">package.json</code>中<code class="eh lj lk ll lm b">scripts.build</code>字段的含义。当你运行<code class="eh lj lk ll lm b">npm run build</code>时，我们执行那个命令。</p><p id="91d0" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">为了连接到我们的Ganache网络，我们可以向我们的<code class="eh lj lk ll lm b">index.js</code>添加一行代码:</p><figure class="jq jr js jt fq ju"><div class="bz el l di"><div class="lx ly l"/></div></figure><p id="ce08" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">为了帮助调试，我建议也在你的<code class="eh lj lk ll lm b">index.js</code>中设置<code class="eh lj lk ll lm b">window.web3 = web3</code>。这将让您在浏览器开发工具中更有效地调试和执行命令。</p><figure class="jq jr js jt fq ju fe ff paragraph-image"><div class="fe ff lz"><img src="../Images/40a48af276e7d93af221974e64390fd6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1022/format:webp/1*UvREYvu5pU6m4FrOvHJN-A.png"/></div><figcaption class="kb kc fg fe ff kd ke bd b be z ek">You can execute commands directly in DevTools to get a feel for them</figcaption></figure><p id="5fa3" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">我们怎么知道这有用呢？让我们添加一个元素，用一个<code class="eh lj lk ll lm b">index.html</code>文件显示我们的账户和余额:</p><figure class="jq jr js jt fq ju"><div class="bz el l di"><div class="lx ly l"/></div></figure><p id="1126" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">用事件监听器更新我们的<code class="eh lj lk ll lm b">index.js</code>文件。当页面加载时，执行<code class="eh lj lk ll lm b">updateBalance</code>功能。通过将它提取到一个单独的函数中，我们可以调用它来响应契约的执行。</p><figure class="jq jr js jt fq ju"><div class="bz el l di"><div class="lx ly l"/></div></figure><p id="41e0" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">现在重新生成<code class="eh lj lk ll lm b">bundle.js</code>并在浏览器中打开<code class="eh lj lk ll lm b">index.html</code>。你应该看到地址和余额自动出现在屏幕上。</p><p id="6eab" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">如果你做到了这一点，你就成功地设置了Web3。</p><h1 id="4eec" class="kg kh ht bd ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld dt translated">设置合同</h1><p id="a5a6" class="pw-post-body-paragraph iq ir ht is b it le iv iw ix lf iz ja jb lg jd je jf lh jh ji jj li jl jm jn hm dt translated">现在我们已经连接到Web3，让我们连接到合同本身。这就是我们之前创建的JSON文件的用处。</p><p id="26d4" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">请注意，我们再次将对象绑定到窗口(JavaScript中的对象是<a class="ae kf" rel="noopener" href="/nodesimplified/javascript-pass-by-value-and-pass-by-reference-in-javascript-fcf10305aa9c">按引用传递</a>)来帮助调试控制台中的命令。</p><p id="c03e" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">Web3契约实例化需要契约ABI，它是更大的JSON包的一部分。我们还传入之前获得的合同地址:</p><figure class="jq jr js jt fq ju"><div class="bz el l di"><div class="lx ly l"/></div></figure><p id="a9c7" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">注意，我完全确定我在这里使用的<code class="eh lj lk ll lm b"><a class="ae kf" href="https://web3js.readthedocs.io/en/v1.3.4/web3-eth-contract.html#defaultaccount" rel="noopener ugc nofollow" target="_blank">defaultAccount</a></code>是准确的。但是我的代码确实有效，所以我不会抱怨。</p><p id="4495" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">现在我们的合同应该在我们的执行环境中，所以我们可以开始执行合同。</p><h1 id="080f" class="kg kh ht bd ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld dt translated">执行智能合同</h1><p id="969e" class="pw-post-body-paragraph iq ir ht is b it le iv iw ix lf iz ja jb lg jd je jf lh jh ji jj li jl jm jn hm dt translated">通常有两种智能合约命令:调用和发送。在Solidity中，一个调用通常映射到一个<code class="eh lj lk ll lm b">view</code>:一个不涉及事务的方法。这可能被视为“吸气剂”。Sends实际上创建了一个事务并改变了契约状态，就像Solidity <code class="eh lj lk ll lm b">payable</code>。</p><p id="fdd3" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">我们可以在合同中看到其中的一些。首先，让我们在网页上添加一个按钮和一个响应标签:</p><figure class="jq jr js jt fq ju"><div class="bz el l di"><div class="lx ly l"/></div></figure><figure class="jq jr js jt fq ju"><div class="bz el l di"><div class="lx ly l"/></div></figure><p id="4fbe" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">您可以在按钮上的click事件监听器中看到整个过程。我们还在执行过程中禁用它，作为一种去抖的方式。</p><p id="08ef" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">我们发送一个带有我们的帐户和硬编码值的事件。稍后我们可以调用第二个方法来读取余额并显示在页面上。</p><p id="b972" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">这里有许多异步操作。阅读Mozilla 的<a class="ae kf" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise" rel="noopener ugc nofollow" target="_blank">承诺指南将会提供一个很好的背景。</a></p><h1 id="3f4f" class="kg kh ht bd ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld dt translated">解决纷争</h1><p id="9777" class="pw-post-body-paragraph iq ir ht is b it le iv iw ix lf iz ja jb lg jd je jf lh jh ji jj li jl jm jn hm dt translated">在我的开发过程中，当我试图用我的合同做任何事情时，我遇到了一个模糊的错误:</p><blockquote class="ma mb mc"><p id="8e83" class="iq ir jo is b it iu iv iw ix iy iz ja md jc jd je me jg jh ji mf jk jl jm jn hm dt translated">错误:返回值无效，是汽油用完了吗？如果您没有为从中检索数据的合同使用正确的ABI，从不存在的块号请求数据，或者查询未完全同步的节点，也可能会看到此错误。</p></blockquote><p id="3d3d" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">我花了一些时间才弄清楚为什么会发生这种事。谷歌搜索错误没有提供一个单一的答案。原来我的合同地址是错的。我需要用松露的地址，而不是加纳切的钱包地址。</p></div><div class="ab cl mg mh hb mi" role="separator"><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml"/></div><div class="hm hn ho hp hq"><p id="a756" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">我希望这个指南至少能帮助你开始。由于这种编程环境是新的，所以资源不足。虽然有些工具可能有自己的文档，但集成指南并不多。</p><p id="9437" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">这是我从自己的经验和开发中得到的，而不是任何工具上的任何内部消息。当然，在快速发展的速度下，这个职位可能会很快过时。</p><blockquote class="mn"><p id="10df" class="mo mp ht bd mq mr ms mt mu mv mw jn ek translated">加入<a class="ae kf" href="https://t.me/coincodecap" rel="noopener ugc nofollow" target="_blank"> Coinmonks电报频道</a>，了解加密交易和投资</p></blockquote><h2 id="3e0c" class="lr kh ht bd ki mx my mz km na nb nc kq jb nd ne ku jf nf ng ky jj nh ni lc nj dt translated">另外，阅读</h2><ul class=""><li id="6c6b" class="nk nl ht is b it le ix lf jb nm jf nn jj no jn np nq nr ns dt translated"><a class="ae kf" href="https://blog.coincodecap.com/grid-trading" rel="noopener ugc nofollow" target="_blank">网格交易机器人</a> | <a class="ae kf" rel="noopener" href="/coinmonks/cryptohopper-review-a388ff5bae88">加密交易机器人</a> | <a class="ae kf" href="https://blog.coincodecap.com/best-crypto-trading-bots" rel="noopener ugc nofollow" target="_blank">加密交易机器人</a></li><li id="06fb" class="nk nl ht is b it nt ix nu jb nv jf nw jj nx jn np nq nr ns dt translated"><a class="ae kf" rel="noopener" href="/coinmonks/top-10-crypto-copy-trading-platforms-for-beginners-d0c37c7d698c">加密复制交易平台</a> | <a class="ae kf" rel="noopener" href="/coinmonks/buy-bitcoin-on-wazirx-2d12b7989af1">如何在WazirX上购买比特币</a></li><li id="8769" class="nk nl ht is b it nt ix nu jb nv jf nw jj nx jn np nq nr ns dt translated"><a class="ae kf" rel="noopener" href="/coinmonks/coinloan-review-18128b9badc4"> CoinLoan点评</a>|【Crypto.com】点评 | <a class="ae kf" rel="noopener" href="/coinmonks/huobi-margin-trading-b3b06cdc1519">火币保证金交易</a></li><li id="7cd5" class="nk nl ht is b it nt ix nu jb nv jf nw jj nx jn np nq nr ns dt translated"><a class="ae kf" rel="noopener" href="/coinmonks/youhodler-vs-coinloan-vs-hodlnaut-b1050acde55a">尤霍德勒vs科恩洛vs霍德诺特</a> | <a class="ae kf" href="https://blog.coincodecap.com/cryptohopper-vs-haasbot" rel="noopener ugc nofollow" target="_blank"> Cryptohopper vs哈斯博特</a></li><li id="65b3" class="nk nl ht is b it nt ix nu jb nv jf nw jj nx jn np nq nr ns dt translated"><a class="ae kf" href="https://blog.coincodecap.com/blockchain-courses" rel="noopener ugc nofollow" target="_blank">顶级付费加密货币和区块链课程</a> | <a class="ae kf" rel="noopener" href="/coinmonks/binance-review-ee10d3bf3b6e">币安评论</a></li><li id="c1d3" class="nk nl ht is b it nt ix nu jb nv jf nw jj nx jn np nq nr ns dt translated"><a class="ae kf" rel="noopener" href="/coinmonks/mxc-exchange-review-3af0ec1cba8c"> MXC交易所评论</a> | <a class="ae kf" href="https://blog.coincodecap.com/pionex-vs-binance" rel="noopener ugc nofollow" target="_blank"> Pionex vs币安</a> | <a class="ae kf" href="https://blog.coincodecap.com/pionex-arbitrage-bot" rel="noopener ugc nofollow" target="_blank"> Pionex套利机器人</a></li><li id="28f5" class="nk nl ht is b it nt ix nu jb nv jf nw jj nx jn np nq nr ns dt translated"><a class="ae kf" rel="noopener" href="/coinmonks/buy-bitcoin-in-india-feb50ddfef94">如何在印度购买比特币？</a> | <a class="ae kf" rel="noopener" href="/coinmonks/wazirx-review-5c811b074f5b"> WazirX评论</a> | <a class="ae kf" href="https://blog.coincodecap.com/bitmex-review" rel="noopener ugc nofollow" target="_blank"> BitMEX评论</a></li><li id="c02f" class="nk nl ht is b it nt ix nu jb nv jf nw jj nx jn np nq nr ns dt translated"><a class="ae kf" rel="noopener" href="/coinmonks/bitcoin-exchange-in-india-7f1fe79715c9">印度比特币交易所</a> | <a class="ae kf" rel="noopener" href="/coinmonks/bitcoin-savings-account-e65b13f92451">比特币储蓄账户</a> | <a class="ae kf" rel="noopener" href="/coinmonks/hitbtc-review-c5143c5d53c2"> HitBTC审核</a></li></ul></div></div>    
</body>
</html>