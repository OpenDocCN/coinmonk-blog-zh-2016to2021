<html>
<head>
<title>Unlocking the Secrets of an Ethereum Transaction</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">解开以太坊交易的秘密</h1>
<blockquote>原文：<a href="https://medium.com/coinmonks/discovering-the-secrets-of-an-ethereum-transaction-64febb00935c?source=collection_archive---------1-----------------------#2021-06-24">https://medium.com/coinmonks/discovering-the-secrets-of-an-ethereum-transaction-64febb00935c?source=collection_archive---------1-----------------------#2021-06-24</a></blockquote><div><div class="ef hh hi hj hk hl"/><div class="hm hn ho hp hq"><div class=""/><div class=""><h2 id="00ae" class="pw-subtitle-paragraph iq hs ht bd b ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ek translated">用Python解码输入数据</h2></div><figure class="jj jk jl jm fq jn fe ff paragraph-image"><div role="button" tabindex="0" class="jo jp di jq bf jr"><div class="fe ff ji"><img src="../Images/b63e736c5afac46f3f7fd45bcd1322d1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xqLENx2CzSSuzaLVwmSjdg.jpeg"/></div></div></figure><p id="192e" class="pw-post-body-paragraph ju jv ht jw b jx jy iu jz ka kb ix kc kd ke kf kg kh ki kj kk kl km kn ko kp hm dt translated">如果你是作为区块链工程师迈出的第一步，一个很好的起点是构建一个解码事务的应用程序，特别是输入数据。解码输入数据是理解交易中实际发生了什么的关键。比如看一下<a class="ae kq" href="https://etherscan.io/tx/0xac80bab0940f061e184b0dda380d994e6fc14ab5d0c6f689035631c81bfe220b" rel="noopener ugc nofollow" target="_blank">下面这个交易</a>。</p><figure class="jj jk jl jm fq jn"><div class="bz el l di"><div class="kr ks l"/></div></figure><p id="7444" class="pw-post-body-paragraph ju jv ht jw b jx jy iu jz ka kb ix kc kd ke kf kg kh ki kj kk kl km kn ko kp hm dt translated">您可以看到它包含有关交易的高级细节，包括往来地址、使用的气体、交易价值、签名组件等。但是在这个交易中到底发生了什么呢？换了哪些代币？使用了谁的智能合同？为了真正理解细节，我们需要解码<em class="kt">输入数据</em>。</p><h2 id="6fb6" class="ku kv ht bd kw kx ky kz la lb lc ld le kd lf lg lh kh li lj lk kl ll lm ln lo dt translated">输入数据…那是什么？</h2><p id="e708" class="pw-post-body-paragraph ju jv ht jw b jx lp iu jz ka lq ix kc kd lr kf kg kh ls kj kk kl lt kn ko kp hm dt translated">在开始编写代码之前，让我们花点时间了解一下输入数据以及它在区块链上的使用方式。我们将使用上面显示的事务作为我们的例子。</p><p id="7168" class="pw-post-body-paragraph ju jv ht jw b jx jy iu jz ka kb ix kc kd ke kf kg kh ki kj kk kl km kn ko kp hm dt translated">当我们在<a class="ae kq" href="https://etherscan.io/tx/0xac80bab0940f061e184b0dda380d994e6fc14ab5d0c6f689035631c81bfe220b" rel="noopener ugc nofollow" target="_blank"> Etherscan </a>上搜索交易时，我们看到有人将<code class="eh lu lv lw lx b">4.195472736637743549 ETH</code>发送到一个SushiSwap智能合约，以换取<code class="eh lu lv lw lx b">20 BOR</code>令牌。用户可能在SushiSwap用户界面中启动了事务，这导致事务由智能合约执行。但是智能合同是如何知道该做什么的呢？你猜对了——输入数据。</p><p id="94bf" class="pw-post-body-paragraph ju jv ht jw b jx jy iu jz ka kb ix kc kd ke kf kg kh ki kj kk kl km kn ko kp hm dt translated">输入数据由<a class="ae kq" href="https://ethereum.org/en/developers/docs/data-and-analytics/block-explorers/#transactions" rel="noopener ugc nofollow" target="_blank">ethereum.org</a>描述为<em class="kt">交易</em>所需的额外信息。这种信息的结构因交易类型的不同而不同。如果交易是一个<code class="eh lu lv lw lx b">message call</code>(由一个外部拥有的账户(EOA)签署，或者从一个智能合同到一个EOA)，输入数据包含正确执行智能合同功能所需的信息。如果是一个<code class="eh lu lv lw lx b">contract creation</code>事务，输入数据将保存合同字节码和构造函数所需的任何编码参数。如果交易是两个EOA之间的<code class="eh lu lv lw lx b">funds transfer</code>，输入数据将为空，因为不需要额外的信息。</p><p id="6151" class="pw-post-body-paragraph ju jv ht jw b jx jy iu jz ka kb ix kc kd ke kf kg kh ki kj kk kl km kn ko kp hm dt translated">在我们的示例中，事务是一个<code class="eh lu lv lw lx b">message call</code>,因为我们在一个已部署的智能契约上调用一个函数。输入数据如下所示:</p><pre class="jj jk jl jm fq ly lx lz ma aw mb dt"><span id="db89" class="ku kv ht lx b fv mc md l me mf">0x8803dbee000000000000000000000000000000000000000000000001158e460913d000000000000000000000000000000000000000000000000000003a4837fc5242c4ec00000000000000000000000000000000000000000000000000000000000000a00000000000000000000000009a7ed54b8c2c5816c1800476f5111a1e886575020000000000000000000000000000000000000000000000000000000060cfee3f0000000000000000000000000000000000000000000000000000000000000002000000000000000000000000c02aaa39b223fe8d0a0e5c4f27ead9083c756cc20000000000000000000000003c9d6c1c73b31c837832c72e04d3152f051fc1a9</span></pre><p id="16b9" class="pw-post-body-paragraph ju jv ht jw b jx jy iu jz ka kb ix kc kd ke kf kg kh ki kj kk kl km kn ko kp hm dt translated">智能协定使用这个十六进制值来确定需要执行哪个函数以及需要哪些参数来确保函数按照SushiSwap用户的意图执行。解码后，您会得到函数定义:</p><pre class="jj jk jl jm fq ly lx lz ma aw mb dt"><span id="e8b1" class="ku kv ht lx b fv mc md l me mf">swapTokensForExactTokens(uint256 amountOut, uint256 amountInMax, address[] path, address to, uint256 deadline)</span></pre><p id="265f" class="pw-post-body-paragraph ju jv ht jw b jx jy iu jz ka kb ix kc kd ke kf kg kh ki kj kk kl km kn ko kp hm dt translated">它的论点是:</p><pre class="jj jk jl jm fq ly lx lz ma aw mb dt"><span id="5243" class="ku kv ht lx b fv mc md l me mf"><strong class="lx hu">amountOut</strong>: 20000000000000000000<br/><strong class="lx hu">amountInMax</strong>: 4199668209374381292<br/><strong class="lx hu">path</strong>: <a class="ae kq" href="https://etherscan.io/address/0xC02aaA39b223FE8D0A0e5C4F27eAD9083C756Cc2" rel="noopener ugc nofollow" target="_blank">0xC02aaA39b223FE8D0A0e5C4F27eAD9083C756Cc2</a>, <a class="ae kq" href="https://etherscan.io/address/0x3c9d6c1C73b31c837832c72E04D3152f051fc1A9" rel="noopener ugc nofollow" target="_blank">0x3c9d6c1C73b31c837832c72E04D3152f051fc1A9</a><br/><strong class="lx hu">to</strong>: <a class="ae kq" href="https://etherscan.io/address/0x9A7eD54b8c2c5816C1800476F5111A1e88657502" rel="noopener ugc nofollow" target="_blank">0x9A7eD54b8c2c5816C1800476F5111A1e88657502</a><br/><strong class="lx hu">deadline</strong>: 1624239679</span></pre><p id="48b7" class="pw-post-body-paragraph ju jv ht jw b jx jy iu jz ka kb ix kc kd ke kf kg kh ki kj kk kl km kn ko kp hm dt translated">但是我们如何使用Python将这种十六进制输入转换成纯文本呢？让我们分解代码。</p><h2 id="7a07" class="ku kv ht bd kw kx ky kz la lb lc ld le kd lf lg lh kh li lj lk kl ll lm ln lo dt translated">解码输入数据</h2><p id="b739" class="pw-post-body-paragraph ju jv ht jw b jx lp iu jz ka lq ix kc kd lr kf kg kh ls kj kk kl lt kn ko kp hm dt translated">我们将使用Web3库与以太坊节点进行交互。有关安装和入门要求，请参见<a class="ae kq" href="https://web3py.readthedocs.io/en/stable/quickstart.html" rel="noopener ugc nofollow" target="_blank"> Web3文档</a>。</p><p id="7d22" class="pw-post-body-paragraph ju jv ht jw b jx jy iu jz ka kb ix kc kd ke kf kg kh ki kj kk kl km kn ko kp hm dt translated">我们的第一步是通过将事务散列传递给Web3的<code class="eh lu lv lw lx b">get_transaction()</code>方法来获取事务摘要。这将返回一个字典，其中包含与我们的事务相关的信息，如本文开头所示。</p><figure class="jj jk jl jm fq jn"><div class="bz el l di"><div class="kr ks l"/></div></figure><p id="780a" class="pw-post-body-paragraph ju jv ht jw b jx jy iu jz ka kb ix kc kd ke kf kg kh ki kj kk kl km kn ko kp hm dt translated">接下来我们需要得到智能合约的<a class="ae kq" href="https://en.wikipedia.org/wiki/Application_binary_interface" rel="noopener ugc nofollow" target="_blank">应用二进制接口(ABI) </a>。这允许我们创建一个<em class="kt">契约对象</em>，用于与智能契约进行交互。我们可以通过调用Etherscan API来实现这一点。你需要一个Etherscan API密钥，可以通过在<a class="ae kq" href="https://etherscan.io/apis" rel="noopener ugc nofollow" target="_blank"> Etherscan的开发者页面</a>上设置和注册来免费获得一个。</p><figure class="jj jk jl jm fq jn"><div class="bz el l di"><div class="kr ks l"/></div></figure><p id="5361" class="pw-post-body-paragraph ju jv ht jw b jx jy iu jz ka kb ix kc kd ke kf kg kh ki kj kk kl km kn ko kp hm dt translated">注意，我们使用事务中的<code class="eh lu lv lw lx b">to</code>值作为智能合约地址。对于调用智能合约功能的交易，智能合约地址将始终是交易的<code class="eh lu lv lw lx b">to</code>地址。</p><p id="fe6d" class="pw-post-body-paragraph ju jv ht jw b jx jy iu jz ka kb ix kc kd ke kf kg kh ki kj kk kl km kn ko kp hm dt translated">接下来，我们将通过将智能契约的地址和ABI作为参数传递给<code class="eh lu lv lw lx b">contract()</code>方法<em class="kt">来创建我们的契约对象<em class="kt"> </em>。</em>返回的对象包含许多有用的方法和属性，我们可以用它们来与我们的智能合约进行交互。</p><figure class="jj jk jl jm fq jn"><div class="bz el l di"><div class="kr ks l"/></div></figure><p id="5099" class="pw-post-body-paragraph ju jv ht jw b jx jy iu jz ka kb ix kc kd ke kf kg kh ki kj kk kl km kn ko kp hm dt translated">一旦我们有了契约对象<em class="kt"> </em>，我们就使用<code class="eh lu lv lw lx b">decode_function_input()</code>方法来解码我们的输入。</p><figure class="jj jk jl jm fq jn"><div class="bz el l di"><div class="kr ks l"/></div></figure><p id="925b" class="pw-post-body-paragraph ju jv ht jw b jx jy iu jz ka kb ix kc kd ke kf kg kh ki kj kk kl km kn ko kp hm dt translated">然后砰！我们做到了。该方法返回一个元组，我们可以将它解包成两个对象。<code class="eh lu lv lw lx b">func_obj</code> <em class="kt"> </em>是我们交易使用的智能合约函数的一个实例。</p><pre class="jj jk jl jm fq ly lx lz ma aw mb dt"><span id="5c92" class="ku kv ht lx b fv mc md l me mf">&lt;class 'web3._utils.datatypes.swapTokensForExactTokens'&gt;</span><span id="b1ba" class="ku kv ht lx b fv mg md l me mf">swapTokensForExactTokens(unit256,united256,address[],unit256)</span></pre><p id="73d6" class="pw-post-body-paragraph ju jv ht jw b jx jy iu jz ka kb ix kc kd ke kf kg kh ki kj kk kl km kn ko kp hm dt translated">该对象包括智能合约的ABI、函数名、气体评估工具以及其他我们可以用来构建和调用新交易的方法和属性。</p><p id="919f" class="pw-post-body-paragraph ju jv ht jw b jx jy iu jz ka kb ix kc kd ke kf kg kh ki kj kk kl km kn ko kp hm dt translated"><code class="eh lu lv lw lx b">func_params</code> <em class="kt"> </em>是一个字典，将事务的参数作为键，将它的参数作为值。</p><figure class="jj jk jl jm fq jn"><div class="bz el l di"><div class="kr ks l"/></div></figure><p id="0462" class="pw-post-body-paragraph ju jv ht jw b jx jy iu jz ka kb ix kc kd ke kf kg kh ki kj kk kl km kn ko kp hm dt translated">解码输入数据后，我们现在可以看到SushiSwap用户支付的ETH金额、他们收到的BOR代币金额、所涉及代币的智能合约地址以及交易的截止日期。这让我们真正了解了在这个交易中发生了什么。</p><h2 id="d4aa" class="ku kv ht bd kw kx ky kz la lb lc ld le kd lf lg lh kh li lj lk kl ll lm ln lo dt translated">接下来…</h2><p id="3ce2" class="pw-post-body-paragraph ju jv ht jw b jx lp iu jz ka lq ix kc kd lr kf kg kh ls kj kk kl lt kn ko kp hm dt translated">这项基本技能可应用于许多应用，包括区块链智能、区块链数据分析等。我的下一篇文章将是关于解码事务日志。点击跟随按钮，这样你就不会错过它。</p><p id="e4cb" class="pw-post-body-paragraph ju jv ht jw b jx jy iu jz ka kb ix kc kd ke kf kg kh ki kj kk kl km kn ko kp hm dt translated">如果你觉得这篇文章有帮助，如果你能留下评论并鼓掌，我们将不胜感激。谢谢大家！</p><blockquote class="mh"><p id="347d" class="mi mj ht bd mk ml mm mn mo mp mq kp ek translated">加入Coinmonks <a class="ae kq" href="https://t.me/coincodecap" rel="noopener ugc nofollow" target="_blank">电报频道</a>和<a class="ae kq" href="https://www.youtube.com/c/coinmonks/videos" rel="noopener ugc nofollow" target="_blank"> Youtube频道</a>获取每日<a class="ae kq" href="http://coincodecap.com/" rel="noopener ugc nofollow" target="_blank">加密新闻</a></p></blockquote><h2 id="15d6" class="ku kv ht bd kw kx mr kz la lb ms ld le kd mt lg lh kh mu lj lk kl mv lm ln lo dt translated">另外，阅读</h2><ul class=""><li id="20fb" class="mw mx ht jw b jx lp ka lq kd my kh mz kl na kp nb nc nd ne dt translated"><a class="ae kq" rel="noopener" href="/coinmonks/top-10-crypto-copy-trading-platforms-for-beginners-d0c37c7d698c">复制交易</a> | <a class="ae kq" rel="noopener" href="/coinmonks/crypto-tax-software-ed4b4810e338">加密税务软件</a></li><li id="723e" class="mw mx ht jw b jx nf ka ng kd nh kh ni kl nj kp nb nc nd ne dt translated"><a class="ae kq" href="https://coincodecap.com/grid-trading" rel="noopener ugc nofollow" target="_blank">网格交易</a> | <a class="ae kq" rel="noopener" href="/coinmonks/the-best-cryptocurrency-hardware-wallets-of-2020-e28b1c124069">加密硬件钱包</a></li><li id="e761" class="mw mx ht jw b jx nf ka ng kd nh kh ni kl nj kp nb nc nd ne dt translated"><a class="ae kq" rel="noopener" href="/coinmonks/top-3-telegram-channels-for-crypto-traders-in-2021-8385f4411ff4">密码电报信号</a> | <a class="ae kq" rel="noopener" href="/coinmonks/crypto-trading-bot-c2ffce8acb2a">密码交易机器人</a></li><li id="874f" class="mw mx ht jw b jx nf ka ng kd nh kh ni kl nj kp nb nc nd ne dt translated"><a class="ae kq" rel="noopener" href="/coinmonks/crypto-exchange-dd2f9d6f3769">最佳加密交易所</a> | <a class="ae kq" rel="noopener" href="/coinmonks/bitcoin-exchange-in-india-7f1fe79715c9">印度最佳加密交易所</a></li><li id="47a8" class="mw mx ht jw b jx nf ka ng kd nh kh ni kl nj kp nb nc nd ne dt translated">开发人员的最佳加密API</li><li id="6f41" class="mw mx ht jw b jx nf ka ng kd nh kh ni kl nj kp nb nc nd ne dt translated"><a class="ae kq" href="https://coincodecap.com/nft-marketplaces" rel="noopener ugc nofollow" target="_blank">NFT十大市场造币集锦</a></li><li id="f72f" class="mw mx ht jw b jx nf ka ng kd nh kh ni kl nj kp nb nc nd ne dt translated"><a class="ae kq" href="https://coincodecap.com/ascendex-staking" rel="noopener ugc nofollow" target="_blank">AscendEx Staking</a>|<a class="ae kq" href="https://coincodecap.com/bot-ocean-review" rel="noopener ugc nofollow" target="_blank">Bot Ocean Review</a>|<a class="ae kq" href="https://coincodecap.com/bitcoin-wallets-india" rel="noopener ugc nofollow" target="_blank">最佳比特币钱包</a></li><li id="15e5" class="mw mx ht jw b jx nf ka ng kd nh kh ni kl nj kp nb nc nd ne dt translated"><a class="ae kq" href="https://coincodecap.com/bitget-review" rel="noopener ugc nofollow" target="_blank"> Bitget回顾</a> | <a class="ae kq" href="https://coincodecap.com/gemini-vs-blockfi" rel="noopener ugc nofollow" target="_blank">双子vs区块链</a> | <a class="ae kq" href="https://coincodecap.com/okex-futures-trading" rel="noopener ugc nofollow" target="_blank"> OKEx期货交易</a></li><li id="c009" class="mw mx ht jw b jx nf ka ng kd nh kh ni kl nj kp nb nc nd ne dt translated"><a class="ae kq" href="https://coincodecap.com/crypto-trading-bots-in-the-us" rel="noopener ugc nofollow" target="_blank">美国最佳加密交易机器人</a> | <a class="ae kq" href="https://coincodecap.com/changelly-review" rel="noopener ugc nofollow" target="_blank">经常性回顾</a></li><li id="7716" class="mw mx ht jw b jx nf ka ng kd nh kh ni kl nj kp nb nc nd ne dt translated"><a class="ae kq" href="https://coincodecap.com/crypto-arbitrage-in-india" rel="noopener ugc nofollow" target="_blank">在印度利用加密套利赚取被动收入</a></li><li id="b359" class="mw mx ht jw b jx nf ka ng kd nh kh ni kl nj kp nb nc nd ne dt translated">最佳<a class="ae kq" rel="noopener" href="/coinmonks/top-5-crypto-lending-platforms-in-2020-that-you-need-to-know-a1b675cec3fa">密码借贷平台</a></li><li id="3c98" class="mw mx ht jw b jx nf ka ng kd nh kh ni kl nj kp nb nc nd ne dt translated"><a class="ae kq" rel="noopener" href="/coinmonks/free-crypto-signals-48b25e61a8da">免费加密信号</a> | <a class="ae kq" rel="noopener" href="/coinmonks/crypto-trading-bot-c2ffce8acb2a">加密交易机器人</a></li><li id="9487" class="mw mx ht jw b jx nf ka ng kd nh kh ni kl nj kp nb nc nd ne dt translated">杠杆代币的终极指南</li></ul></div></div>    
</body>
</html>