<html>
<head>
<title>Bitcoin P2PKH Transaction Breakdown</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">比特币P2PKH交易明细</h1>
<blockquote>原文：<a href="https://medium.com/coinmonks/bitcoin-p2pkh-transaction-breakdown-bb663034d6df?source=collection_archive---------0-----------------------#2018-09-19">https://medium.com/coinmonks/bitcoin-p2pkh-transaction-breakdown-bb663034d6df?source=collection_archive---------0-----------------------#2018-09-19</a></blockquote><div><div class="ef hh hi hj hk hl"/><div class="hm hn ho hp hq"><div class=""/><p id="8915" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">这篇文章的目的是全面介绍最常见的比特币交易类型，<em class="jo">Pay-to-Public-Key-Hash</em>(P2PKH)。为了实现这一点，提出了以下内容:</p><ul class=""><li id="7201" class="jp jq ht is b it iu ix iy jb jr jf js jj jt jn ju jv jw jx dt translated">对未用完事务输出(UTXO)的概念以及事务是如何形成的简要概述</li><li id="3da3" class="jp jq ht is b it jy ix jz jb ka jf kb jj kc jn ju jv jw jx dt translated">P2PKH交易的每个部分的细分</li><li id="d9c6" class="jp jq ht is b it jy ix jz jb ka jf kb jj kc jn ju jv jw jx dt translated">解锁和锁定脚本如何配合使用资金的概述</li></ul><p id="7464" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">P2PKH交易是大多数人通常通过钱包接口将指定数量的比特币从一个地址转移到另一个地址时进行的交易类型。一个示例交易用于清楚地展示一个普通钱包的幕后发生的部分事情。</p><h1 id="17a8" class="kd ke ht bd kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la dt translated">未用交易产出</h1><p id="7a14" class="pw-post-body-paragraph iq ir ht is b it lb iv iw ix lc iz ja jb ld jd je jf le jh ji jj lf jl jm jn hm dt translated">在深入事务分解之前，需要理解一个非常重要的概念，即<em class="jo">未用完的事务输出</em>或UTXO。在比特币交易中，UTXOs是被消费或花费的东西。一个UTXO只能用一次。在耗尽之后，它被称为<em class="jo">耗尽的事务输出</em>。</p><p id="983a" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">消费UTXO类似于拿一张20美元的钞票去买10美元的东西，但不是收银员保留20美元钞票，而是她点燃它，凭空创造两张新的10美元钞票，保留一张，另一张作为零钱退还给你。</p><p id="bc51" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">在这个类比中，焚烧后的20美元钞票开始是一个UTXO，但一旦它被消费，就变成了一个失效的交易输出，这产生了两张新的10美元钞票，代表两个准备在未来交易中使用的新UTXO。</p><p id="da25" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">网络上所有可供消费的比特币都被称为<em class="jo"> UTXO集合</em>。</p><h1 id="81b2" class="kd ke ht bd kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la dt translated">交易构建流程</h1><p id="d666" class="pw-post-body-paragraph iq ir ht is b it lb iv iw ix lc iz ja jb ld jd je jf le jh ji jj lf jl jm jn hm dt translated">每个交易由<em class="jo">版本号</em>、<em class="jo">输入</em>、<em class="jo">输出</em>和<em class="jo">锁定时间</em>组成。</p><p id="c523" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">输入包含一个<em class="jo">输出点</em>、一个<em class="jo">序列号</em>和一个<em class="jo">解锁脚本</em>，也称为<em class="jo">脚本签名</em>。</p><p id="6944" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">输出包含花费金额的<em class="jo">值</em>和<em class="jo">锁定脚本</em>，也称为<em class="jo"> scriptPubKey </em>。</p><p id="5461" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">锁定时间规定了交易生效的时间。</p><p id="9090" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">每个事务至少有一个输入和一个输出。输入包含告诉网络消耗哪些UTXOs(通过输出点)并证明它被允许消耗它们(通过解锁脚本)的逻辑。输出包含告诉网络允许未来事务使用新创建的UTXOs的条件的逻辑(通过锁定脚本)。</p><p id="fe6b" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">下图旨在说明已确认交易与已用产出、已确认交易与未用产出以及新的未提交交易之间的关系。</p><figure class="lh li lj lk fq ll fe ff paragraph-image"><div role="button" tabindex="0" class="lm ln di lo bf lp"><div class="fe ff lg"><img src="../Images/c3421c9fcfa2eda714e93b5ed6b24e8e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*45weRC1vzYsEvG1Y3w1qrA.png"/></div></div><figcaption class="ls lt fg fe ff lu lv bd b be z ek">Transaction Relationship</figcaption></figure><h2 id="d09a" class="lw ke ht bd kf lx ly lz kj ma mb mc kn jb md me kr jf mf mg kv jj mh mi kz mj dt translated">构建事务的步骤</h2><p id="0e70" class="pw-post-body-paragraph iq ir ht is b it lb iv iw ix lc iz ja jb ld jd je jf le jh ji jj lf jl jm jn hm dt translated">构建P2PKH事务的步骤如下:</p><ol class=""><li id="e4b5" class="jp jq ht is b it iu ix iy jb jr jf js jj jt jn mk jv jw jx dt translated">找出一个包含你控制的UTXOs的以前的交易(只是一些你已经拥有的比特币)。</li><li id="183a" class="jp jq ht is b it jy ix jz jb ka jf kb jj kc jn mk jv jw jx dt translated">构建新事务的输入输出点，以确定前一个事务要花费的UTXO。</li><li id="8876" class="jp jq ht is b it jy ix jz jb ka jf kb jj kc jn mk jv jw jx dt translated">构建新事务的输出，这样锁定脚本将包含新创建的UTXOs可以被下一个事务使用/解锁的条件。</li><li id="0fe0" class="jp jq ht is b it jy ix jz jb ka jf kb jj kc jn mk jv jw jx dt translated">创建解锁脚本，使其满足前面事务输出的锁定脚本设置的条件。它包含接收者的签名，并在最后一步创建，但也是输入的一部分，实际上位于交易的中间。</li></ol><h1 id="41e7" class="kd ke ht bd kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la dt translated">序列化事务的介绍</h1><p id="69df" class="pw-post-body-paragraph iq ir ht is b it lb iv iw ix lc iz ja jb ld jd je jf le jh ji jj lf jl jm jn hm dt translated">下面详细讨论一个完整的已签名的P2PKH比特币交易。</p><pre class="lh li lj lk fq ml mm mn mo aw mp dt"><span id="f7fe" class="lw ke ht mm b fv mq mr l ms mt">01000000019c2e0f24a03e72002a96acedb12a632e72b6b74c05dc3ceab1fe78237f886c48010000006a47304402203da9d487be5302a6d69e02a861acff1da472885e43d7528ed9b1b537a8e2cac9022002d1bca03a1e9715a99971bafe3b1852b7a4f0168281cbd27a220380a01b3307012102c9950c622494c2e9ff5a003e33b690fe4832477d32c2d256c67eab8bf613b34effffffff02b6f50500000000001976a914bdf63990d6dc33d705b756e13dd135466c06b3b588ac845e0201000000001976a9145fb0e9755a3424efd2ba0587d20b1e98ee29814a88ac00000000</span></pre><p id="49e6" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">这个交易是从Blockchain.com随机抽取的，可以在这里查看<a class="ae mu" href="https://www.blockchain.com/en/btc/tx/e65ad475a01384b086ce0d04199835fdd580739422ece1e0f1c4e362d43735d9" rel="noopener ugc nofollow" target="_blank"/>(<a class="ae mu" href="https://blockchain.info/rawtx/e65ad475a01384b086ce0d04199835fdd580739422ece1e0f1c4e362d43735d9" rel="noopener ugc nofollow" target="_blank">原始值</a>)。</p><p id="7767" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">从一个值为17，373，066的UTXO地址19 iy 8 hkpg 5 ebsqb 2 gunvpudbxitrpxpsx发送390，582个satoshi到1 jkrg 4 f 7k 1 b 7 PBA HQ 7 he euv 5 atjdpk 9 ts并接收16，932，484个satoshi作为更改返回。投入和产出之间的剩余差额作为交易处理费归矿商所有。</p><h1 id="7ce2" class="kd ke ht bd kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la dt translated">版本号</h1><pre class="lh li lj lk fq ml mm mn mo aw mp dt"><span id="9ff2" class="lw ke ht mm b fv mq mr l ms mt"><strong class="mm hu">01000000</strong>019c2e0f24a03e72002a96acedb12a632e72b6b74c05dc3ceab1fe78237f886c48010000006a47304402203da9d487be5302a6d69e02a861acff1da472885e43d7528ed9b1b537a8e2cac9022002d1bca03a1e9715a99971bafe3b1852b7a4f0168281cbd27a220380a01b3307012102c9950c622494c2e9ff5a003e33b690fe4832477d32c2d256c67eab8bf613b34effffffff02b6f50500000000001976a914bdf63990d6dc33d705b756e13dd135466c06b3b588ac845e0201000000001976a9145fb0e9755a3424efd2ba0587d20b1e98ee29814a88ac00000000</span></pre><p id="ee97" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">版本号有四个字节长，以little endian格式表示为十六进制值。</p><p id="2737" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">有两种版本类型。版本01表示没有相对时间锁。版本02表示可能存在相对时间锁定。版本02在<a class="ae mu" href="https://github.com/bitcoin/bips/blob/master/bip-0068.mediawiki" rel="noopener ugc nofollow" target="_blank"> BIP0068 </a>中推出，增加了OP_CHECKSEQUENCEVERIFY和<a class="ae mu" href="https://github.com/bitcoin/bips/blob/master/bip-0112.mediawiki#Bidirectional_Payment_Channels" rel="noopener ugc nofollow" target="_blank"> BIP0112 </a>对其进行了升级。版本02与下面描述的序列号一起使用。</p><p id="7676" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">示例交易是版本01。</p><h1 id="ccfa" class="kd ke ht bd kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la dt translated">交易输入</h1><pre class="lh li lj lk fq ml mm mn mo aw mp dt"><span id="3cff" class="lw ke ht mm b fv mq mr l ms mt">01000000<strong class="mm hu">019c2e0f24a03e72002a96acedb12a632e72b6b74c05dc3ceab1fe78237f886c48010000006a47304402203da9d487be5302a6d69e02a861acff1da472885e43d7528ed9b1b537a8e2cac9022002d1bca03a1e9715a99971bafe3b1852b7a4f0168281cbd27a220380a01b3307012102c9950c622494c2e9ff5a003e33b690fe4832477d32c2d256c67eab8bf613b34effffffff</strong>02b6f50500000000001976a914bdf63990d6dc33d705b756e13dd135466c06b3b588ac845e0201000000001976a9145fb0e9755a3424efd2ba0587d20b1e98ee29814a88ac00000000</span></pre><p id="49d7" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">每个事务输入指向前一个事务输出。如果当前事务输入中的解锁脚本满足上一个事务的输出脚本设置的条件，那么上一个事务“持有”的UTXO就可以花掉。</p><h2 id="3c81" class="lw ke ht bd kf lx ly lz kj ma mb mc kn jb md me kr jf mf mg kv jj mh mi kz mj dt translated">输出点数</h2><pre class="lh li lj lk fq ml mm mn mo aw mp dt"><span id="b442" class="lw ke ht mm b fv mq mr l ms mt">01000000<strong class="mm hu">01</strong>9c2e0f24a03e72002a96acedb12a632e72b6b74c05dc3ceab1fe78237f886c48010000006a47304402203da9d487be5302a6d69e02a861acff1da472885e43d7528ed9b1b537a8e2cac9022002d1bca03a1e9715a99971bafe3b1852b7a4f0168281cbd27a220380a01b3307012102c9950c622494c2e9ff5a003e33b690fe4832477d32c2d256c67eab8bf613b34effffffff02b6f50500000000001976a914bdf63990d6dc33d705b756e13dd135466c06b3b588ac845e0201000000001976a9145fb0e9755a3424efd2ba0587d20b1e98ee29814a88ac00000000</span></pre><p id="1a27" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">事务输入中接下来的1到9个字节定义了包含的输出点数，类型为VarInt。对于每个被使用的UTXO，总是有一个outpoint。</p><p id="765e" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">示例事务将1 UTXO作为输入。</p><h2 id="871c" class="lw ke ht bd kf lx ly lz kj ma mb mc kn jb md me kr jf mf mg kv jj mh mi kz mj dt translated">交易输出点</h2><pre class="lh li lj lk fq ml mm mn mo aw mp dt"><span id="a351" class="lw ke ht mm b fv mq mr l ms mt">0100000001<strong class="mm hu">9c2e0f24a03e72002a96acedb12a632e72b6b74c05dc3ceab1fe78237f886c4801000000</strong>6a47304402203da9d487be5302a6d69e02a861acff1da472885e43d7528ed9b1b537a8e2cac9022002d1bca03a1e9715a99971bafe3b1852b7a4f0168281cbd27a220380a01b3307012102c9950c622494c2e9ff5a003e33b690fe4832477d32c2d256c67eab8bf613b34effffffff02b6f50500000000001976a914bdf63990d6dc33d705b756e13dd135466c06b3b588ac845e0201000000001976a9145fb0e9755a3424efd2ba0587d20b1e98ee29814a88ac00000000</span></pre><p id="4e90" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">每个outpoint都是对以前事务散列的引用，以及指向正在使用的确切UTXO的相应索引。</p><p id="f622" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">outpoint的前32个字节是对包含以little endian格式消费的UTXO的前一个事务散列的引用。例如，前面的事务哈希是:</p><pre class="lh li lj lk fq ml mm mn mo aw mp dt"><span id="d9c9" class="lw ke ht mm b fv mq mr l ms mt">486c887f2378feb1ea3cdc054cb7b6722e632ab1edac962a00723ea0240f2e9c</span></pre><p id="b15f" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">当它包含在事务outpoint中时，它以little endian格式(反向字节顺序)表示:</p><pre class="lh li lj lk fq ml mm mn mo aw mp dt"><span id="a073" class="lw ke ht mm b fv mq mr l ms mt">01<strong class="mm hu">9c2e0f24a03e72002a96acedb12a632e72b6b74c05dc3ceab1fe78237f886c48</strong>01000000</span></pre><p id="abcd" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">outpoint的最后四个字节定义了前一个事务的UTXO正在使用的索引。它也表示为小端格式的十六进制值。</p><pre class="lh li lj lk fq ml mm mn mo aw mp dt"><span id="6942" class="lw ke ht mm b fv mq mr l ms mt">019c2e0f24a03e72002a96acedb12a632e72b6b74c05dc3ceab1fe78237f886c48<strong class="mm hu">01000000</strong></span></pre><p id="6fef" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">包含被花费的UTXO的交易可以在这里 ( <a class="ae mu" href="https://blockchain.info/rawtx/486c887f2378feb1ea3cdc054cb7b6722e632ab1edac962a00723ea0240f2e9c" rel="noopener ugc nofollow" target="_blank">原始值</a>)查看<a class="ae mu" href="http://486c887f2378feb1ea3cdc054cb7b6722e632ab1edac962a00723ea0240f2e9c" rel="noopener ugc nofollow" target="_blank">。前一个事务的“out”键中的第一个条目显示，包含十进制值17，373，066 satoshi的UTXO正在当前事务中使用。请注意，当前事务没有显式包含17，373，066 satoshi UTXO，只包含通过outpoint内容对它的引用。</a></p><h2 id="d033" class="lw ke ht bd kf lx ly lz kj ma mb mc kn jb md me kr jf mf mg kv jj mh mi kz mj dt translated">解锁脚本</h2><p id="4950" class="pw-post-body-paragraph iq ir ht is b it lb iv iw ix lc iz ja jb ld jd je jf le jh ji jj lf jl jm jn hm dt translated">解锁脚本也称为scriptSig，包含构建交易和接收资金的用户的堆栈脚本(签名)和赎回脚本(公钥)。</p><pre class="lh li lj lk fq ml mm mn mo aw mp dt"><span id="2bff" class="lw ke ht mm b fv mq mr l ms mt">01000000019c2e0f24a03e72002a96acedb12a632e72b6b74c05dc3ceab1fe78237f886c4801000000<strong class="mm hu">6a47304402203da9d487be5302a6d69e02a861acff1da472885e43d7528ed9b1b537a8e2cac9022002d1bca03a1e9715a99971bafe3b1852b7a4f0168281cbd27a220380a01b3307012102c9950c622494c2e9ff5a003e33b690fe4832477d32c2d256c67eab8bf613b34e</strong>ffffffff02b6f50500000000001976a914bdf63990d6dc33d705b756e13dd135466c06b3b588ac845e0201000000001976a9145fb0e9755a3424efd2ba0587d20b1e98ee29814a88ac00000000</span></pre><p id="2c06" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated"><strong class="is hu">解锁脚本长度</strong></p><pre class="lh li lj lk fq ml mm mn mo aw mp dt"><span id="6f96" class="lw ke ht mm b fv mq mr l ms mt"><strong class="mm hu">6a</strong>47304402203da9d487be5302a6d69e02a861acff1da472885e43d7528ed9b1b537a8e2cac9022002d1bca03a1e9715a99971bafe3b1852b7a4f0168281cbd27a220380a01b330701</span></pre><p id="2d38" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">前1–9个字节属于VarInt类型，定义了组成堆栈脚本和赎回脚本的后续字节数。在这种情况下，第一个字节(0x6a)声明将接下来的106个字节压入堆栈(将在下面讨论)。</p><p id="1bf0" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated"><strong class="is hu">堆栈脚本(签名)</strong></p><pre class="lh li lj lk fq ml mm mn mo aw mp dt"><span id="5749" class="lw ke ht mm b fv mq mr l ms mt">01000000019c2e0f24a03e72002a96acedb12a632e72b6b74c05dc3ceab1fe78237f886c48010000006a<strong class="mm hu">47304402203da9d487be5302a6d69e02a861acff1da472885e43d7528ed9b1b537a8e2cac9022002d1bca03a1e9715a99971bafe3b1852b7a4f0168281cbd27a220380a01b330701</strong>2102c9950c622494c2e9ff5a003e33b690fe4832477d32c2d256c67eab8bf613b34effffffff02b6f50500000000001976a914bdf63990d6dc33d705b756e13dd135466c06b3b588ac845e0201000000001976a9145fb0e9755a3424efd2ba0587d20b1e98ee29814a88ac00000000</span></pre><p id="ce43" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">堆栈脚本包含向网络提交交易的人的签名和sighash。它是确认用户(签名者)被允许使用事务outpoint所指向的UTXOs的证据的一部分。</p><p id="7164" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">前1–9个字节属于VarInt类型，定义了组成签名的后续字节数。</p><pre class="lh li lj lk fq ml mm mn mo aw mp dt"><span id="59b2" class="lw ke ht mm b fv mq mr l ms mt"><strong class="mm hu">47</strong>304402203da9d487be5302a6d69e02a861acff1da472885e43d7528ed9b1b537a8e2cac9022002d1bca03a1e9715a99971bafe3b1852b7a4f0168281cbd27a220380a01b330701</span></pre><p id="5821" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">在这种情况下，第一个字节(0x47)声明接下来的71个字节是签名和sighash。签名源自用户的私钥。</p><pre class="lh li lj lk fq ml mm mn mo aw mp dt"><span id="8515" class="lw ke ht mm b fv mq mr l ms mt">47<strong class="mm hu">304402203da9d487be5302a6d69e02a861acff1da472885e43d7528ed9b1b537a8e2cac9022002d1bca03a1e9715a99971bafe3b1852b7a4f0168281cbd27a220380a01b3307</strong>01</span></pre><p id="f348" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">签名可以进一步细分如下:</p><pre class="lh li lj lk fq ml mm mn mo aw mp dt"><span id="b221" class="lw ke ht mm b fv mq mr l ms mt"><strong class="mm hu">30</strong> - DER signature marker</span><span id="308a" class="lw ke ht mm b fv mv mr l ms mt"><strong class="mm hu">44</strong> - declares signature is 68 bytes in length</span><span id="6683" class="lw ke ht mm b fv mv mr l ms mt"><strong class="mm hu">02</strong> - r value marker</span><span id="f918" class="lw ke ht mm b fv mv mr l ms mt"><strong class="mm hu">20</strong> - declare r value is 32 bytes in length</span><span id="0d77" class="lw ke ht mm b fv mv mr l ms mt"><strong class="mm hu">3da9d487be5302a6d69e02a861acff1da472885e43d7528ed9b1b537a8e2cac9 </strong> <br/>          - r value</span><span id="7c84" class="lw ke ht mm b fv mv mr l ms mt"><strong class="mm hu">02</strong> - s value marker</span><span id="9933" class="lw ke ht mm b fv mv mr l ms mt"><strong class="mm hu">20</strong> - declare s value is 32 bytes in length</span><span id="2a29" class="lw ke ht mm b fv mv mr l ms mt"><strong class="mm hu">02d1bca03a1e9715a99971bafe3b1852b7a4f0168281cbd27a220380a01b3307<br/></strong>          - s value</span></pre><p id="b864" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">最后，代表sighash标志的单个字节被附加到签名中。在P2PKH事务中，sighash标志可以是下列标志之一:</p><ul class=""><li id="6030" class="jp jq ht is b it iu ix iy jb jr jf js jj jt jn ju jv jw jx dt translated">SIGHASH_ALL (0x01):签名适用于所有输入和输出，这是P2PKH事务中最常见的</li><li id="aedc" class="jp jq ht is b it jy ix jz jb ka jf kb jj kc jn ju jv jw jx dt translated">SIGHASH_SINGLE (0x03):签名适用于所有输入和单个输出</li><li id="455e" class="jp jq ht is b it jy ix jz jb ka jf kb jj kc jn ju jv jw jx dt translated">SIGHASH_ANYONECANPAY结合SIGHASH_ALL (0x81):签名适用于一个输入和所有输出</li><li id="4039" class="jp jq ht is b it jy ix jz jb ka jf kb jj kc jn ju jv jw jx dt translated">SIGHASH_ANYONECANPAY结合SIGHASH_SINGLE (ox83):签名适用于一个输入和一个输出</li></ul><pre class="lh li lj lk fq ml mm mn mo aw mp dt"><span id="ea9d" class="lw ke ht mm b fv mq mr l ms mt">47304402203da9d487be5302a6d69e02a861acff1da472885e43d7528ed9b1b537a8e2cac9022002d1bca03a1e9715a99971bafe3b1852b7a4f0168281cbd27a220380a01b3307<strong class="mm hu">01</strong></span></pre><p id="6371" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated"><strong class="is hu">赎回脚本</strong></p><pre class="lh li lj lk fq ml mm mn mo aw mp dt"><span id="b546" class="lw ke ht mm b fv mq mr l ms mt">01000000019c2e0f24a03e72002a96acedb12a632e72b6b74c05dc3ceab1fe78237f886c48010000006a47304402203da9d487be5302a6d69e02a861acff1da472885e43d7528ed9b1b537a8e2cac9022002d1bca03a1e9715a99971bafe3b1852b7a4f0168281cbd27a220380a01b330701<strong class="mm hu">2102c9950c622494c2e9ff5a003e33b690fe4832477d32c2d256c67eab8bf613b34e</strong>ffffffff02b6f50500000000001976a914bdf63990d6dc33d705b756e13dd135466c06b3b588ac845e0201000000001976a9145fb0e9755a3424efd2ba0587d20b1e98ee29814a88ac00000000</span></pre><p id="4ac3" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">rename脚本包含由scriptPubKey设置的条件。在P2PKH事务中，redempte脚本只是用户(签名者)的公钥。</p><p id="112e" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">VarInt类型的rename脚本的前1–9个字节定义了组成公钥哈希的后续字节数。</p><pre class="lh li lj lk fq ml mm mn mo aw mp dt"><span id="8171" class="lw ke ht mm b fv mq mr l ms mt"><strong class="mm hu">21</strong>02c9950c622494c2e9ff5a003e33b690fe4832477d32c2d256c67eab8bf613b34e</span></pre><p id="969a" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">在这种情况下，第一个字节(0x21)声明接下来的33个字节是用户的公钥散列。哈希算法是HASH160，也就是SHA256后跟一个RIPEMD160哈希。公钥源自用户的私钥。</p><pre class="lh li lj lk fq ml mm mn mo aw mp dt"><span id="d1f1" class="lw ke ht mm b fv mq mr l ms mt">21<strong class="mm hu">02c9950c622494c2e9ff5a003e33b690fe4832477d32c2d256c67eab8bf613b34e</strong></span></pre><h2 id="72b2" class="lw ke ht bd kf lx ly lz kj ma mb mc kn jb md me kr jf mf mg kv jj mh mi kz mj dt translated">序列号(nSequence)</h2><pre class="lh li lj lk fq ml mm mn mo aw mp dt"><span id="a0b1" class="lw ke ht mm b fv mq mr l ms mt">01000000019c2e0f24a03e72002a96acedb12a632e72b6b74c05dc3ceab1fe78237f886c48010000006a47304402203da9d487be5302a6d69e02a861acff1da472885e43d7528ed9b1b537a8e2cac9022002d1bca03a1e9715a99971bafe3b1852b7a4f0168281cbd27a220380a01b3307012102c9950c622494c2e9ff5a003e33b690fe4832477d32c2d256c67eab8bf613b34e<strong class="mm hu">ffffffff</strong>02b6f50500000000001976a914bdf63990d6dc33d705b756e13dd135466c06b3b588ac845e0201000000001976a9145fb0e9755a3424efd2ba0587d20b1e98ee29814a88ac00000000</span></pre><p id="e7b2" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">nSequence有四个字节长，以小端格式表示为十六进制值。</p><p id="caa0" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">nSequence最初是为了让用户可以用具有相同输入但nSequence更高的新事务替换以前提交的未确认事务。然而，这在实践中并不奏效，因为矿工们没有动力去确认具有更高nSequence的交易，而是更愿意确认具有更高费用的交易。</p><p id="5618" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">最初nSequence仅用于禁用nLockTime(下面讨论)。如果nSequence设置为0xFFFFFFFF，则忽略nLockTime。</p><p id="b263" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">BIP0125 引入了nSequence的一个新用途，如果它的值小于0xFFFFFFFE，就用它来通知RBF。希望这样做的一个例子是，用户向网络提交他们的交易，但是意识到费用不够，并且想要重新提交分配更高费用的交易。</p><p id="9d80" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">事务通常将nSequence默认为0xFFFFFFFE，选择退出RBF并允许nLockTime。要使用nLockTime并选择加入RBF，通常将nSequence设置为0xFFFFFFFD。</p><p id="29b3" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">在<a class="ae mu" href="https://github.com/bitcoin/bips/blob/master/bip-0068.mediawiki" rel="noopener ugc nofollow" target="_blank"> BIP0068 </a>中，nSequence被重新利用，以允许使用相对时间锁。当且仅当事务处理版本为02时，才能实现此功能。</p><p id="cfcb" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">nSequence本质上是交易被确认所必须经过的持续时间，通过块高度或从当前时间开始的2⁹ (512)秒的集合来指定。相对时间锁定事务在其父事务被确认之前(nSequence * 521秒)或(nSequence *块数)是无效的。</p><p id="dd10" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">nSequence值的32位中的18位用于相对时间锁定。剩余的14位保留用于将来的升级，如下所示:</p><pre class="lh li lj lk fq ml mm mn mo aw mp dt"><span id="bd85" class="lw ke ht mm b fv mq mr l ms mt"> 31                22            15              7             0 </span><span id="a685" class="lw ke ht mm b fv mv mr l ms mt">|<strong class="mm hu">D</strong> 0 0 0 0 0 0 0|0 <strong class="mm hu">T</strong> 0 0 0 0 0 0|<strong class="mm hu">V</strong> <strong class="mm hu">V</strong> <strong class="mm hu">V</strong> <strong class="mm hu">V</strong> <strong class="mm hu">V</strong> <strong class="mm hu">V</strong> <strong class="mm hu">V</strong> <strong class="mm hu">V</strong>|<strong class="mm hu">V</strong> <strong class="mm hu">V</strong> <strong class="mm hu">V</strong> <strong class="mm hu">V</strong> <strong class="mm hu">V</strong> <strong class="mm hu">V</strong> <strong class="mm hu">V</strong> <strong class="mm hu">V</strong>|</span><span id="5948" class="lw ke ht mm b fv mv mr l ms mt"><strong class="mm hu">D</strong> Bit 31: Disable Flag. 0 - enable time lock, 1 - disable time lock<br/><strong class="mm hu">T</strong> Bit 22: Type Flag. 0 - time in blocks, time in 2⁹ second sets<br/><strong class="mm hu">V</strong> Bits 15-0: Value. Number of blocks or 2⁹ second sets</span></pre><p id="d42b" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">关于时间锁的全面解释可以在<a class="ae mu" href="https://prestwi.ch/bitcoin-time-locks/" rel="noopener ugc nofollow" target="_blank">这里</a>找到。</p><p id="c270" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">示例事务是序列号为0xFFFFFFF的版本01，选择退出RBF并禁用nLockTime。</p><h1 id="72fe" class="kd ke ht bd kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la dt translated">交易输出</h1><pre class="lh li lj lk fq ml mm mn mo aw mp dt"><span id="f945" class="lw ke ht mm b fv mq mr l ms mt">01000000019c2e0f24a03e72002a96acedb12a632e72b6b74c05dc3ceab1fe78237f886c48010000006a47304402203da9d487be5302a6d69e02a861acff1da472885e43d7528ed9b1b537a8e2cac9022002d1bca03a1e9715a99971bafe3b1852b7a4f0168281cbd27a220380a01b3307012102c9950c622494c2e9ff5a003e33b690fe4832477d32c2d256c67eab8bf613b34effffffff<strong class="mm hu">02b6f50500000000001976a914bdf63990d6dc33d705b756e13dd135466c06b3b588ac845e0201000000001976a9145fb0e9755a3424efd2ba0587d20b1e98ee29814a88ac</strong>00000000</span></pre><p id="5c24" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">事务输出包含输出脚本和这些脚本控制的数量。通常，事务有多个输出。在典型的P2PKH中，一个事务有一个包含花费输出和变化输出的输出。每一个输出都包含了以satoshis表示的被消耗的数量，以及使用它们必须满足的条件。</p><h2 id="ac6c" class="lw ke ht bd kf lx ly lz kj ma mb mc kn jb md me kr jf mf mg kv jj mh mi kz mj dt translated">产出数量</h2><pre class="lh li lj lk fq ml mm mn mo aw mp dt"><span id="ba00" class="lw ke ht mm b fv mq mr l ms mt">01000000019c2e0f24a03e72002a96acedb12a632e72b6b74c05dc3ceab1fe78237f886c48010000006a47304402203da9d487be5302a6d69e02a861acff1da472885e43d7528ed9b1b537a8e2cac9022002d1bca03a1e9715a99971bafe3b1852b7a4f0168281cbd27a220380a01b3307012102c9950c622494c2e9ff5a003e33b690fe4832477d32c2d256c67eab8bf613b34effffffff<strong class="mm hu">02</strong>b6f50500000000001976a914bdf63990d6dc33d705b756e13dd135466c06b3b588ac845e0201000000001976a9145fb0e9755a3424efd2ba0587d20b1e98ee29814a88ac00000000</span></pre><p id="0a9b" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">事务输出中的第一个字节定义了输出的数量，其类型为VarInt。</p><p id="f0ab" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">在这个事务中，有两个输出，一个是来自传入UTXO的花费金额，另一个是变化金额。</p><h1 id="a307" class="kd ke ht bd kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la dt translated">输出</h1><pre class="lh li lj lk fq ml mm mn mo aw mp dt"><span id="9744" class="lw ke ht mm b fv mq mr l ms mt">01000000019c2e0f24a03e72002a96acedb12a632e72b6b74c05dc3ceab1fe78237f886c48010000006a47304402203da9d487be5302a6d69e02a861acff1da472885e43d7528ed9b1b537a8e2cac9022002d1bca03a1e9715a99971bafe3b1852b7a4f0168281cbd27a220380a01b3307012102c9950c622494c2e9ff5a003e33b690fe4832477d32c2d256c67eab8bf613b34effffffff02<strong class="mm hu">b6f50500000000001976a914bdf63990d6dc33d705b756e13dd135466c06b3b588ac845e0201000000001976a9145fb0e9755a3424efd2ba0587d20b1e98ee29814a88ac</strong>00000000</span></pre><p id="ed40" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">每个输出的前16个字节表示由解锁(下面详细描述)所指示的消耗量，并以小端格式表示为十六进制值。</p><pre class="lh li lj lk fq ml mm mn mo aw mp dt"><span id="2aaf" class="lw ke ht mm b fv mq mr l ms mt">01000000019c2e0f24a03e72002a96acedb12a632e72b6b74c05dc3ceab1fe78237f886c48010000006a47304402203da9d487be5302a6d69e02a861acff1da472885e43d7528ed9b1b537a8e2cac9022002d1bca03a1e9715a99971bafe3b1852b7a4f0168281cbd27a220380a01b3307012102c9950c622494c2e9ff5a003e33b690fe4832477d32c2d256c67eab8bf613b34effffffff02<strong class="mm hu">b6f5050000000000</strong>1976a914bdf63990d6dc33d705b756e13dd135466c06b3b588ac<strong class="mm hu">845e020100000000</strong>1976a9145fb0e9755a3424efd2ba0587d20b1e98ee29814a88ac00000000</span></pre><p id="0982" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">输出的第二部分是一个称为锁定脚本的可变长度值，或者等效地，称为scriptPubKey。锁定脚本定义了可以使用指定的条件。换句话说，它只允许具有正确签名的用户访问资金。</p><pre class="lh li lj lk fq ml mm mn mo aw mp dt"><span id="5949" class="lw ke ht mm b fv mq mr l ms mt">01000000019c2e0f24a03e72002a96acedb12a632e72b6b74c05dc3ceab1fe78237f886c48010000006a47304402203da9d487be5302a6d69e02a861acff1da472885e43d7528ed9b1b537a8e2cac9022002d1bca03a1e9715a99971bafe3b1852b7a4f0168281cbd27a220380a01b3307012102c9950c622494c2e9ff5a003e33b690fe4832477d32c2d256c67eab8bf613b34effffffff02b6f5050000000000<strong class="mm hu">1976a914bdf63990d6dc33d705b756e13dd135466c06b3b588ac</strong>845e020100000000<strong class="mm hu">1976a9145fb0e9755a3424efd2ba0587d20b1e98ee29814a88ac</strong>00000000</span></pre><p id="e2f9" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">此P2PKH事务正在消耗一个UTXO previous，它由地址19 iy 8 hkpg 5 ebsqb 2 gunvpudbxitrpxpsx控制，值为17，373，066 satoshi。此事务的第一个输出创建一个新的UTXO，其值为390，582 satoshi，由接收地址1 jkrg 4 f 7k 1 b 7 PBA HQ 7 he euv 5 atjdpk 9 ts控制。</p><p id="77a4" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">此事务的第二个输出创建一个新的UTXO，其值为16，932，484 satoshi，由原始发送地址19 iy 8 hkpg 5 ebsqb 2 gunvpudbxitrpxpsx控制。这就是来自交易的“变化”。</p><p id="9eb9" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated"><strong class="is hu">第一次输出</strong></p><p id="7592" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">第一个十进制的输出量是390，582 satoshi (0x0005F5B6 hex)。</p><pre class="lh li lj lk fq ml mm mn mo aw mp dt"><span id="8bec" class="lw ke ht mm b fv mq mr l ms mt"><strong class="mm hu">b6f5050000000000</strong>1976a914bdf63990d6dc33d705b756e13dd135466c06b3b588ac</span></pre><p id="6203" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">锁定脚本源自接收资金的用户的地址。</p><pre class="lh li lj lk fq ml mm mn mo aw mp dt"><span id="efcd" class="lw ke ht mm b fv mq mr l ms mt">b6f5050000000000<strong class="mm hu">1976a914bdf63990d6dc33d705b756e13dd135466c06b3b588ac</strong></span></pre><p id="4956" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">锁定脚本只是一个脚本，一段代码，告诉网络如何使用这笔钱。代码是用比特币脚本编写的，这是一种基于堆栈的反向波兰符号(RPN)语言，是图灵不完全的。这是一种非常原始的语言，本质上只是通过一系列名为<a class="ae mu" href="https://en.bitcoin.it/wiki/Script" rel="noopener ugc nofollow" target="_blank"> OP_CODES </a>的命令将值放入栈中和从栈中取出，并对项目执行操作。</p><p id="0d83" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">锁定脚本来自接收资金的人的地址，细分如下:</p><pre class="lh li lj lk fq ml mm mn mo aw mp dt"><span id="c77f" class="lw ke ht mm b fv mq mr l ms mt"><strong class="mm hu">19</strong> - (25 bytes) byte length of the following unlocking script</span><span id="3bd3" class="lw ke ht mm b fv mv mr l ms mt"><strong class="mm hu">76</strong> - OP_DUP: Duplicates the top stack item.</span><span id="79e3" class="lw ke ht mm b fv mv mr l ms mt"><strong class="mm hu">a9</strong> - OP_HASH160: The input is hashed twice: first with SHA-256 and then with RIPEMD-160</span><span id="ffc7" class="lw ke ht mm b fv mv mr l ms mt"><strong class="mm hu">14</strong> - (20 bytes) length of the following public key hash</span><span id="91be" class="lw ke ht mm b fv mv mr l ms mt"><strong class="mm hu">bdf63990d6dc33d705b756e13dd135466c06b3b5</strong> - public key hash of funds receiver</span><span id="ad1d" class="lw ke ht mm b fv mv mr l ms mt"><strong class="mm hu">88</strong> - OP_EQUALVERIFY: Returns 1 if the inputs are exactly equal, 0 otherwise. Then runs OP_VERIFY which fails and marks the transaction as invalid of the top stack value is false</span><span id="e10f" class="lw ke ht mm b fv mv mr l ms mt"><strong class="mm hu">ac</strong> - OP_CHECKSIG: The entire transaction's outputs, inputs, and script are hashed. The signature used by OP_CHECKSIG must be a valid signature for this hash and public key. If it is, 1 is returned, 0 otherwise</span></pre><p id="8142" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated"><strong class="is hu">第二输出</strong></p><pre class="lh li lj lk fq ml mm mn mo aw mp dt"><span id="d91a" class="lw ke ht mm b fv mq mr l ms mt">01000000019c2e0f24a03e72002a96acedb12a632e72b6b74c05dc3ceab1fe78237f886c48010000006a47304402203da9d487be5302a6d69e02a861acff1da472885e43d7528ed9b1b537a8e2cac9022002d1bca03a1e9715a99971bafe3b1852b7a4f0168281cbd27a220380a01b3307012102c9950c622494c2e9ff5a003e33b690fe4832477d32c2d256c67eab8bf613b34effffffff02b6f50500000000001976a914bdf63990d6dc33d705b756e13dd135466c06b3b588ac845e020100000000<strong class="mm hu">1976a9145fb0e9755a3424efd2ba0587d20b1e98ee29814a88ac</strong>00000000</span></pre><p id="28c3" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">第二个输出值是16，932，484 satoshi。</p><pre class="lh li lj lk fq ml mm mn mo aw mp dt"><span id="f1b7" class="lw ke ht mm b fv mq mr l ms mt"><strong class="mm hu">845e020100000000</strong>1976a9145fb0e9755a3424efd2ba0587d20b1e98ee29814a88ac</span></pre><p id="8121" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">第二个输出的锁定脚本将16，932，484 satoshi发送回发送方。这是寄件人的零钱。</p><pre class="lh li lj lk fq ml mm mn mo aw mp dt"><span id="e31e" class="lw ke ht mm b fv mq mr l ms mt">845e020100000000<strong class="mm hu">1976a9145fb0e9755a3424efd2ba0587d20b1e98ee29814a88ac</strong></span></pre><p id="e280" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">锁定脚本可以分解如下</p><pre class="lh li lj lk fq ml mm mn mo aw mp dt"><span id="7241" class="lw ke ht mm b fv mq mr l ms mt"><strong class="mm hu">19</strong> - (25 bytes) byte length of the following unlocking script</span><span id="b807" class="lw ke ht mm b fv mv mr l ms mt"><strong class="mm hu">76</strong> - OP_DUP: Duplicates the top stack item.</span><span id="8316" class="lw ke ht mm b fv mv mr l ms mt"><strong class="mm hu">a9</strong> - OP_HASH160: The input is hashed twice: first with SHA-256 and then with RIPEMD-160.</span><span id="ab50" class="lw ke ht mm b fv mv mr l ms mt"><strong class="mm hu">14</strong> - (20 bytes) length of the following public key hash</span><span id="aa14" class="lw ke ht mm b fv mv mr l ms mt"><strong class="mm hu">5fb0e9755a3424efd2ba0587d20b1e98ee29814a</strong> - public key hash of funds receiver</span><span id="62a5" class="lw ke ht mm b fv mv mr l ms mt"><strong class="mm hu">88</strong> - OP_EQUALVERIFY: Returns 1 if the inputs are exactly equal, 0 otherwise. Then runs OP_VERIFY which fails and marks the transaction as invalid of the top stack value is false</span><span id="3673" class="lw ke ht mm b fv mv mr l ms mt"><strong class="mm hu">ac</strong> - OP_CHECKSIG: The entire transaction's outputs, inputs, and script are hashed. The signature used by OP_CHECKSIG must be a valid signature for this hash and public key. If it is, 1 is returned, 0 otherwise</span></pre><p id="de55" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated"><strong class="is hu">交易费用</strong></p><p id="fb0d" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">矿商的交易费是总投入和总产出之间的差额。在示例交易中，矿工费用计算如下:</p><pre class="lh li lj lk fq ml mm mn mo aw mp dt"><span id="02c3" class="lw ke ht mm b fv mq mr l ms mt">miner_fee = (input_amount) - (spend_amount + change_amount)<br/>miner_fee = (17373066) - (390582 + 16932484)<br/>miner_fee = 50000 satoshi</span></pre><h1 id="18e9" class="kd ke ht bd kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la dt translated">锁定时间</h1><pre class="lh li lj lk fq ml mm mn mo aw mp dt"><span id="a714" class="lw ke ht mm b fv mq mr l ms mt">01000000019c2e0f24a03e72002a96acedb12a632e72b6b74c05dc3ceab1fe78237f886c48010000006a47304402203da9d487be5302a6d69e02a861acff1da472885e43d7528ed9b1b537a8e2cac9022002d1bca03a1e9715a99971bafe3b1852b7a4f0168281cbd27a220380a01b3307012102c9950c622494c2e9ff5a003e33b690fe4832477d32c2d256c67eab8bf613b34effffffff02b6f50500000000001976a914bdf63990d6dc33d705b756e13dd135466c06b3b588ac845e0201000000001976a9145fb0e9755a3424efd2ba0587d20b1e98ee29814a88ac<strong class="mm hu">00000000</strong></span></pre><p id="25b0" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">nLockTime允许使用绝对时间锁。它有四个字节长，以little endian格式表示为十六进制值。绝对时间锁使用户能够向网络提交事务，该事务将保持无效，直到指定的时间过去。nLockTime本质上是要确认的事务的时间目标，并通过块号或纪元时间来指定。</p><p id="70a8" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">如果nLockTime为0，则没有时间锁。交易立即生效。</p><p id="2a26" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">如果nLockTime大于0且小于500，000，000，则绝对时间锁定以块数来衡量。</p><p id="3ac8" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">如果nLockTime大于或等于500，000，000，则绝对时间锁定以纪元时间为单位。</p><p id="05a7" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">需要注意的是，如果nSequence设为0xFFFFFFFF，则nLockTime完全禁用。</p><p id="87cf" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">示例事务的nLockTime为0。</p><h1 id="0edf" class="kd ke ht bd kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la dt translated">解锁锁定脚本</h1><p id="bf8c" class="pw-post-body-paragraph iq ir ht is b it lb iv iw ix lc iz ja jb ld jd je jf le jh ji jj lf jl jm jn hm dt translated">下面显示了锁定和解锁脚本如何协同工作来解锁P2PKH输出中的资金。仅显示了第一个输出的值，但该逻辑适用于两个输出。</p><p id="5342" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">最左边一列显示锁定脚本内容，中间一列显示解锁脚本内容，最右边一列显示堆栈是如何构建的(记住，比特币脚本是一种类似Forth的RPN语言)。</p><pre class="lh li lj lk fq ml mm mn mo aw mp dt"><span id="3c46" class="lw ke ht mm b fv mq mr l ms mt"><strong class="mm hu">Locking Script </strong>    |     <strong class="mm hu">Unlocking Script </strong>    |<strong class="mm hu"> </strong>    <strong class="mm hu">Script</strong><br/>                   |<strong class="mm hu"> </strong>                         |<br/>OP_DUP             |     &lt;signature&gt;<strong class="mm hu"> </strong>         |     &lt;signature&gt;<br/>OP_HASH160         |     &lt;pubkey&gt;<strong class="mm hu"> </strong>            |     &lt;pubkey&gt;<br/>&lt;pubkey hash&gt;      |<strong class="mm hu"> </strong>                         |     OP_DUP<br/>OP_EQUALVERIFY     |<strong class="mm hu"> </strong>                         |     OP_HASH160<br/>OP_CHECKSIG        |<strong class="mm hu"> </strong>                         |     &lt;hash&gt;<br/>                   |<strong class="mm hu"> </strong>                         |     OP_EQUALVERIFY<br/>                   |<strong class="mm hu"> </strong>                         |     OP_CHECKSIG</span><span id="e5db" class="lw ke ht mm b fv mv mr l ms mt"><br/>where, for the first output:</span><span id="38a2" class="lw ke ht mm b fv mv mr l ms mt">&lt;pubkey hash&gt; - bdf63990d6dc33d705b756e13dd135466c06b3b5</span><span id="27d9" class="lw ke ht mm b fv mv mr l ms mt">&lt;signature&gt; - 304402203da9d487be5302a6d69e02a861acff1da472885e43d7528ed9b1b537a8e2cac9022002d1bca03a1e9715a99971bafe3b1852b7a4f0168281cbd27a220380a01b330701</span><span id="69fa" class="lw ke ht mm b fv mv mr l ms mt">&lt;pubkey&gt; - 02c9950c622494c2e9ff5a003e33b690fe4832477d32c2d256c67eab8bf613b34e</span></pre><p id="ee35" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">该脚本执行如下:</p><pre class="lh li lj lk fq ml mm mn mo aw mp dt"><span id="a118" class="lw ke ht mm b fv mq mr l ms mt"><strong class="mm hu">Script</strong>             |           <strong class="mm hu">Stack       </strong>   |<strong class="mm hu"> </strong>    <strong class="mm hu">Execution</strong><br/>                   |<strong class="mm hu"> </strong>                         |<br/>&lt;signature&gt;        |                          |     <br/>&lt;pubkey&gt;           |             <strong class="mm hu"> </strong>            |     <br/>OP_DUP             |<strong class="mm hu"> </strong>                         |     <br/>OP_HASH160         |<strong class="mm hu"> </strong>                         |     <br/>&lt;pubkey hash&gt;      |<strong class="mm hu"> </strong>                         |     <br/>OP_EQUALVERIFY     |<strong class="mm hu"> </strong>                         |     <br/>OP_CHECKSIG        |<strong class="mm hu"> </strong>                         |     </span></pre><p id="1e11" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">将签名和公钥推送到堆栈上:</p><pre class="lh li lj lk fq ml mm mn mo aw mp dt"><span id="f257" class="lw ke ht mm b fv mq mr l ms mt"><strong class="mm hu">Script</strong>             |           <strong class="mm hu">Stack       </strong>   |<strong class="mm hu"> </strong>    <strong class="mm hu">Processed</strong><br/>                   |<strong class="mm hu"> </strong>                         |<br/>                   |                          |     <br/>                   |             <strong class="mm hu"> </strong>            |     <br/>OP_DUP             |<strong class="mm hu"> </strong>                         |     <br/>OP_HASH160         |<strong class="mm hu"> </strong>                         |     <br/>&lt;pubkey hash&gt;      |<strong class="mm hu"> </strong>                         |     <br/>OP_EQUALVERIFY     |<strong class="mm hu"> </strong>       &lt;pubkey&gt;          |     <br/>OP_CHECKSIG        |        &lt;signature&gt;       |</span></pre><p id="8e6f" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">OP_DUP复制堆栈顶部的项目，即公钥，并将其推送到堆栈顶部:</p><pre class="lh li lj lk fq ml mm mn mo aw mp dt"><span id="5013" class="lw ke ht mm b fv mq mr l ms mt"><strong class="mm hu">Script</strong>             |           <strong class="mm hu">Stack       </strong>   |<strong class="mm hu"> </strong>    <strong class="mm hu">Processed</strong><br/>                   |<strong class="mm hu"> </strong>                         |<br/>                   |                          |     <br/>                   |             <strong class="mm hu"> </strong>            |     <br/>                   |<strong class="mm hu"> </strong>                         |     <br/>OP_HASH160         |<strong class="mm hu"> </strong>                         |     <br/>&lt;pubkey hash&gt;      |<strong class="mm hu"> </strong>        &lt;pubkey&gt;         |     <br/>OP_EQUALVERIFY     |<strong class="mm hu"> </strong>        &lt;pubkey&gt;         |     <br/>OP_CHECKSIG        |        &lt;signature&gt;       |        OP_DUP</span></pre><p id="debb" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">OP_HASH160从堆栈中弹出顶部项目，并对其执行SHA256哈希和RIPEMD160哈希:</p><pre class="lh li lj lk fq ml mm mn mo aw mp dt"><span id="249c" class="lw ke ht mm b fv mq mr l ms mt">&lt;pubkey hash&gt; = RIPEMD160(SHA256(public key))</span></pre><p id="a4dc" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">然后，它将该哈希值推到堆栈的顶部:</p><pre class="lh li lj lk fq ml mm mn mo aw mp dt"><span id="4c20" class="lw ke ht mm b fv mq mr l ms mt"><strong class="mm hu">Script</strong>             |           <strong class="mm hu">Stack       </strong>   |<strong class="mm hu"> </strong>    <strong class="mm hu">Processed</strong><br/>                   |<strong class="mm hu"> </strong>                         |<br/>                   |                          |     <br/>                   |             <strong class="mm hu"> </strong>            |     <br/>                   |<strong class="mm hu"> </strong>                         |     <br/>                   |<strong class="mm hu"> </strong>                         |     <br/>&lt;pubkey hash&gt;      |<strong class="mm hu"> </strong>      &lt;pubkey hash&gt;      |     <br/>OP_EQUALVERIFY     |<strong class="mm hu"> </strong>        &lt;pubkey&gt;         |     <br/>OP_CHECKSIG        |        &lt;signature&gt;       |      OP_HASH160</span></pre><p id="44df" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">公钥散列被推到堆栈的顶部:</p><pre class="lh li lj lk fq ml mm mn mo aw mp dt"><span id="71d6" class="lw ke ht mm b fv mq mr l ms mt"><strong class="mm hu">Script</strong>             |           <strong class="mm hu">Stack       </strong>   |<strong class="mm hu"> </strong>    <strong class="mm hu">Processed</strong><br/>                   |<strong class="mm hu"> </strong>                         |<br/>                   |                          |     <br/>                   |             <strong class="mm hu"> </strong>            |     <br/>                   |<strong class="mm hu"> </strong>                         |     <br/>                   |<strong class="mm hu"> </strong>      &lt;pubkey hash&gt;      |     <br/>                   |<strong class="mm hu"> </strong>      &lt;pubkey hash&gt;      |     <br/>OP_EQUALVERIFY     |<strong class="mm hu"> </strong>        &lt;pubkey&gt;         |     <br/>OP_CHECKSIG        |        &lt;signature&gt;       |      </span></pre><p id="3704" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">OP_EQUALVERIFY从堆栈中弹出前两项，并检查它们是否相等。如果两个公共密钥散列不相等，那么试图索取资金的接收者无意或恶意地提供了不正确的公共密钥。如果发生这种情况，OP_EQUALVERIFY将使脚本失败，并且事务无效。</p><pre class="lh li lj lk fq ml mm mn mo aw mp dt"><span id="4bb3" class="lw ke ht mm b fv mq mr l ms mt"><strong class="mm hu">Script</strong>             |           <strong class="mm hu">Stack       </strong>   |<strong class="mm hu"> </strong>    <strong class="mm hu">Processed</strong><br/>                   |<strong class="mm hu"> </strong>                         |<br/>                   |                          |     <br/>                   |             <strong class="mm hu"> </strong>            |     <br/>                   |<strong class="mm hu"> </strong>                         |     <br/>                   |<strong class="mm hu"> </strong>                         |     <br/>                   |<strong class="mm hu"> </strong>                         |     <br/>                   |<strong class="mm hu"> </strong>        &lt;pubkey&gt;         |     <br/>OP_CHECKSIG        |        &lt;signature&gt;       |    OP_EQUALVERIFY</span></pre><p id="faf0" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">最后，OP_CHECKSIG从堆栈中弹出最上面的两项，应该是一个公钥和一个签名，并检查签名对于公钥是否有效。</p><p id="c746" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">如果OP_CHECKSIG运行成功，它会将1推送到堆栈，并且事务是有效的和完整的。</p><p id="d266" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">如果用户没有为公钥提供有效的签名，OP_CHECKSIG将0压入堆栈，表示事务无效。</p><pre class="lh li lj lk fq ml mm mn mo aw mp dt"><span id="ff77" class="lw ke ht mm b fv mq mr l ms mt"><strong class="mm hu">Script</strong>             |           <strong class="mm hu">Stack       </strong>   |<strong class="mm hu"> </strong>    <strong class="mm hu">Processed</strong><br/>                   |<strong class="mm hu"> </strong>                         |<br/>                   |                          |     <br/>                   |             <strong class="mm hu"> </strong>            |     <br/>                   |<strong class="mm hu"> </strong>                         |     <br/>                   |<strong class="mm hu"> </strong>                         |     <br/>                   |<strong class="mm hu"> </strong>                         |     <br/>                   |<strong class="mm hu"> </strong>                         |     <br/>                   |             1            |      OP_CHECKSIG</span></pre><blockquote class="mw"><p id="e2e4" class="mx my ht bd mz na nb nc nd ne nf jn ek translated"><a class="ae mu" href="https://coincodecap.com/?utm_source=coinmonks" rel="noopener ugc nofollow" target="_blank">在您的收件箱中直接获得最佳软件交易</a></p></blockquote><figure class="nh ni nj nk nl ll fe ff paragraph-image"><a href="https://coincodecap.com/?utm_source=coinmonks"><div class="fe ff ng"><img src="../Images/7c0b3dfdcbfea594cc0ae7d4f9bf6fcb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1168/format:webp/0*OJ-qb5G6i863msBB.png"/></div></a></figure></div></div>    
</body>
</html>