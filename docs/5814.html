<html>
<head>
<title>Verifying Solidity Signatures</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">验证可靠性签名</h1>
<blockquote>原文：<a href="https://medium.com/coinmonks/verifying-solidity-signatures-4898d003846b?source=collection_archive---------0-----------------------#2021-10-22">https://medium.com/coinmonks/verifying-solidity-signatures-4898d003846b?source=collection_archive---------0-----------------------#2021-10-22</a></blockquote><div><div class="ef hh hi hj hk hl"/><div class="hm hn ho hp hq"><div class=""/><figure class="fi fk ir is it iu fe ff paragraph-image"><div role="button" tabindex="0" class="iv iw di ix bf iy"><div class="fe ff iq"><img src="../Images/672c7ec70efd22c08ff21a50cf0742e4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PVutC5Ve7MEZsqn54tp4Bw.png"/></div></div></figure><p id="77b1" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">处理链上的所有东西是很棒的，但并不总是实际的，有时你可能想做一些小技巧，以节省用户的汽油。</p><p id="8520" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">可悲的是，简单地将所需的数据传递给合同是不安全的，如果没有安全措施，人们肯定会滥用您的合同。</p><p id="6dab" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">这个问题有一个很好的解决方案。</p><h1 id="eba0" class="jz ka ht bd kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw dt translated">固体签名和签名数据</h1><p id="01a9" class="pw-post-body-paragraph jb jc ht jd b je kx jg jh ji ky jk jl jm kz jo jp jq la js jt ju lb jw jx jy hm dt translated">您可以将所需的数据捆绑到一个散列中，并用所需的wallet对其进行签名。</p><p id="af10" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">下面你可以看到我在hardhat上运行一个非常简单的签名，我把签名者[0]当作我的后端。</p><figure class="lc ld le lf fq iu"><div class="bz el l di"><div class="lg lh l"/></div></figure><p id="4a21" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">在第45行，您可以看到我作为userWallet连接到sigTest契约，并启动了isDataValid函数。传入时间戳和签名。让我们跳到合同上看看接下来会发生什么。</p><figure class="lc ld le lf fq iu"><div class="bz el l di"><div class="lg lh l"/></div></figure><p id="71b3" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">查看isdatavailable()，我们可以看到我们做的第一件事是在契约中构建散列，使用的数据与我们在客户端使用的数据相同。得到的msgHash应该等于客户端上的messageHash。如果数据中有任何差异，哈希将不会匹配，签名测试将失败。</p><p id="4e82" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">仍然看isdatavailable()，您可以看到它触发了一个require并调用isValidSignature()。在这里，我们必须首先签署散列。将<strong class="jd hu">\ x19以太坊签名的消息:\n32 </strong>打包似乎有些武断，好好利用谷歌来理解它的重要性——从安全角度来看，这非常有趣。</p><p id="aa36" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">有了签名的数据，我们可以利用ECDSA库来恢复基于散列和签名的地址。</p><p id="99ad" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">如果恢复的地址与系统地址匹配，则一切正常，我们认为成功，否则，失败。</p><p id="1beb" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">我不会深入研究ECDSA库是如何工作的，因为我相信对于开发人员来说，学习如何阅读其他合同并搜索以填补知识空白是很重要的，另外我不想破坏这种乐趣:)</p><div class="li lj fm fo lk ll"><a href="https://github.com/OpenZeppelin/openzeppelin-contracts/blob/master/contracts/utils/cryptography/ECDSA.sol" rel="noopener  ugc nofollow" target="_blank"><div class="lm ab ej"><div class="ln ab lo cl cj lp"><h2 class="bd hu fv z el lq eo ep lr er et hs dt translated">open zeppelin-contracts/ECD sa . sol位于主open zeppelin/open zeppelin-contracts</h2><div class="ls l"><h3 class="bd b fv z el lq eo ep lr er et ek translated">OpenZeppelin Contracts是一个用于安全智能合约开发的库。-open zeppelin-contracts/ECD sa . sol at master…</h3></div><div class="lt l"><p class="bd b gc z el lq eo ep lr er et ek translated">github.com</p></div></div><div class="lu l"><div class="lv l lw lx ly lu lz iz ll"/></div></div></a></div><h1 id="14be" class="jz ka ht bd kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw dt translated">重要注意事项</h1><p id="06e5" class="pw-post-body-paragraph jb jc ht jd b je kx jg jh ji ky jk jl jm kz jo jp jq la js jt ju lb jw jx jy hm dt translated">我提供的代码根本不适合生产。它写得非常快，没有经过测试。</p><p id="723b" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">跟踪随机数是一个很好的特性，您应该考虑添加到这段代码中。它有助于避免重放攻击。</p><h1 id="c357" class="jz ka ht bd kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw dt translated">参考</h1><ul class=""><li id="e49a" class="ma mb ht jd b je kx ji ky jm mc jq md ju me jy mf mg mh mi dt translated">【https://solidity-by-example.org/signature/ T2】号</li><li id="807d" class="ma mb ht jd b je mk ji ml jm mm jq mn ju mo jy mf mg mh mi dt translated"><a class="ae mj" href="https://blog.ricmoo.com/verifying-messages-in-solidity-50a94f82b2ca" rel="noopener ugc nofollow" target="_blank">https://blog . ricmoo . com/verified-messages-in-solidity-50a 94 f 82 B2 ca</a></li><li id="c526" class="ma mb ht jd b je mk ji ml jm mm jq mn ju mo jy mf mg mh mi dt translated"><a class="ae mj" href="https://yos.io/2018/11/16/ethereum-signatures/" rel="noopener ugc nofollow" target="_blank">https://yos.io/2018/11/16/ethereum-signatures/</a></li></ul><blockquote class="mp"><p id="8996" class="mq mr ht bd ms mt mu mv mw mx my jy ek translated">交易新手？试试<a class="ae mj" rel="noopener" href="/coinmonks/crypto-trading-bot-c2ffce8acb2a">加密交易机器人</a>或者<a class="ae mj" rel="noopener" href="/coinmonks/top-10-crypto-copy-trading-platforms-for-beginners-d0c37c7d698c">复制交易</a></p></blockquote></div></div>    
</body>
</html>