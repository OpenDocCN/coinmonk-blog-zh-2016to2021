<html>
<head>
<title>How to Implement Voting Functionality: From Backend to UI</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何实现投票功能:从后端到用户界面</h1>
<blockquote>原文：<a href="https://medium.com/coinmonks/add-voting-functionality-fcead1e1e56?source=collection_archive---------4-----------------------#2020-07-01">https://medium.com/coinmonks/add-voting-functionality-fcead1e1e56?source=collection_archive---------4-----------------------#2020-07-01</a></blockquote><div><div class="ef hh hi hj hk hl"/><div class="hm hn ho hp hq"><div class=""/><div class=""><h2 id="e429" class="pw-subtitle-paragraph iq hs ht bd b ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ek translated"><em class="ji">本文是区块链公司治理系列文章的一部分。</em></h2></div><figure class="jk jl jm jn fq jo fe ff paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="fe ff jj"><img src="../Images/38a40e87aac3d8db9a9c5f23e9106557.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*AnUUgZ0ZJvwiqxFwHY6dHA.png"/></div></div></figure><p id="b560" class="pw-post-body-paragraph jv jw ht jx b jy jz iu ka kb kc ix kd ke kf kg kh ki kj kk kl km kn ko kp kq hm dt translated">本系列的第1部分概述了区块链在公司治理中的潜在应用，并介绍了如何按照本系列建立您的项目。</p><p id="5a80" class="pw-post-body-paragraph jv jw ht jx b jy jz iu ka kb kc ix kd ke kf kg kh ki kj kk kl km kn ko kp kq hm dt translated"><a class="ae kr" href="https://www.trycrypto.com/blog/part-2-voting-smart-contract" rel="noopener ugc nofollow" target="_blank">第2部分</a>概述了股东投票智能合同的整个业务逻辑，包括智能合同开发的最佳实践。</p><p id="412f" class="pw-post-body-paragraph jv jw ht jx b jy jz iu ka kb kc ix kd ke kf kg kh ki kj kk kl km kn ko kp kq hm dt translated">在第3部分<a class="ae kr" href="https://www.trycrypto.com/guides-and-tutorials/connecting-a-smart-contract-with-a-ui-and-reading-from-the-blockchain" rel="noopener ugc nofollow" target="_blank">中，我们开始在UI中编织，并学习如何从区块链中读取。</a></p><p id="c9d3" class="pw-post-body-paragraph jv jw ht jx b jy jz iu ka kb kc ix kd ke kf kg kh ki kj kk kl km kn ko kp kq hm dt translated">在这一部分，我们将为两个候选人添加投票功能，并学习如何写区块链。</p></div><div class="ab cl ks kt hb ku" role="separator"><span class="kv bw bk kw kx ky"/><span class="kv bw bk kw kx ky"/><span class="kv bw bk kw kx"/></div><div class="hm hn ho hp hq"><p id="8d9a" class="pw-post-body-paragraph jv jw ht jx b jy jz iu ka kb kc ix kd ke kf kg kh ki kj kk kl km kn ko kp kq hm dt translated">在第3部分结束时，我们的dapp看起来是这样的:</p><figure class="jk jl jm jn fq jo fe ff paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="fe ff kz"><img src="../Images/219b6c4020c75db682f235cc0844ea5d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*ZKyMmtQVCQmBXVh3.png"/></div></div></figure><p id="f1d8" class="pw-post-body-paragraph jv jw ht jx b jy jz iu ka kb kc ix kd ke kf kg kh ki kj kk kl km kn ko kp kq hm dt translated">在这一部分，我们将遵循3个步骤来促进dapp中的投票。</p><ol class=""><li id="be0a" class="la lb ht jx b jy jz kb kc ke lc ki ld km le kq lf lg lh li dt translated">在我们的库中创建投票功能，<code class="eh lj lk ll lm b">dapp-lib.js</code>。该函数将负责向区块链写入投票。(注意:写入区块链类似于调用HTTP POST方法，并且不是免费的。)</li><li id="2bf0" class="la lb ht jx b jy ln kb lo ke lp ki lq km lr kq lf lg lh li dt translated">为两个候选人添加一个动作按钮，并用我们在<code class="eh lj lk ll lm b">dapp-lib.js</code>的步骤1中编写的投票功能连接按钮。</li><li id="f3f6" class="la lb ht jx b jy ln kb lo ke lp ki lq km lr kq lf lg lh li dt translated">最后，让我们验证一下我们的投票逻辑是否工作正常。我们将再次调用<code class="eh lj lk ll lm b">getCandidates()</code>函数。两位候选人的<code class="eh lj lk ll lm b">voteCount</code>现在应该不同了。</li></ol></div><div class="ab cl ks kt hb ku" role="separator"><span class="kv bw bk kw kx ky"/><span class="kv bw bk kw kx ky"/><span class="kv bw bk kw kx"/></div><div class="hm hn ho hp hq"><h1 id="115b" class="ls lt ht bd lu lv lw lx ly lz ma mb mc iz md ja me jc mf jd mg jf mh jg mi mj dt translated">步骤1:在我们的库dapp-lib.js中创建一个投票函数</h1><p id="c4b2" class="pw-post-body-paragraph jv jw ht jx b jy mk iu ka kb ml ix kd ke mm kg kh ki mn kk kl km mo ko kp kq hm dt translated">DappStarter已经为此生成了<code class="eh lj lk ll lm b">dapp-lib.js</code>。您可以通过以下路径找到它:</p><pre class="jk jl jm jn fq mp lm mq mr aw ms dt"><span id="4b80" class="mt lt ht lm b fv mu mv l mw mx">packages<br/>  - dapplib<br/>    - src<br/>      - lib<br/>        -&gt; dapp-lib.js</span></pre><p id="a439" class="pw-post-body-paragraph jv jw ht jx b jy jz iu ka kb kc ix kd ke kf kg kh ki kj kk kl km kn ko kp kq hm dt translated">作为一个好的实践，我建议你把这个函数写在<code class="eh lj lk ll lm b">getCandidates()</code>函数附近，这样可以更容易地跟踪哪些函数被添加到了<code class="eh lj lk ll lm b">dapp-lib.js</code>文件中。</p><p id="13cd" class="pw-post-body-paragraph jv jw ht jx b jy jz iu ka kb kc ix kd ke kf kg kh ki kj kk kl km kn ko kp kq hm dt translated">对于打算写入区块链的所有函数，该函数的格式将保持相似。</p><figure class="jk jl jm jn fq jo"><div class="bz el l di"><div class="my mz l"/></div></figure><p id="a84c" class="pw-post-body-paragraph jv jw ht jx b jy jz iu ka kb kc ix kd ke kf kg kh ki kj kk kl km kn ko kp kq hm dt translated">该函数将把<code class="eh lj lk ll lm b">data</code>作为输入参数。这个输入对象将从<code class="eh lj lk ll lm b">&lt;action-button&gt;</code>接收，我们将在下一步的<code class="eh lj lk ll lm b">dapp-page.js</code>中创建它。在这个<code class="eh lj lk ll lm b">data</code>对象中，将有一个名为<code class="eh lj lk ll lm b">candidateId</code>的属性，该属性也将从<code class="eh lj lk ll lm b">&lt;action-button&gt;</code>接收。</p><p id="1fd9" class="pw-post-body-paragraph jv jw ht jx b jy jz iu ka kb kc ix kd ke kf kg kh ki kj kk kl km kn ko kp kq hm dt translated">在引擎下，<code class="eh lj lk ll lm b">dapp-page.js</code>在内部与<code class="eh lj lk ll lm b">blockchain.js</code>通信以写入区块链。所以从<code class="eh lj lk ll lm b">dapp-page.js</code>开始，我们要做的就是调用<code class="eh lj lk ll lm b">Blockchain.post()</code>方法。</p><p id="9ee2" class="pw-post-body-paragraph jv jw ht jx b jy jz iu ka kb kc ix kd ke kf kg kh ki kj kk kl km kn ko kp kq hm dt translated">我们在<code class="eh lj lk ll lm b">dapp-lib.js</code>的工作现在完成了。让我们转到<code class="eh lj lk ll lm b">dapp-page.js</code>来为UI添加动作按钮。</p><h1 id="7f25" class="ls lt ht bd lu lv na lx ly lz nb mb mc iz nc ja me jc nd jd mg jf ne jg mi mj dt translated">步骤2:添加一个动作按钮，并将它们连接到投票逻辑</h1><p id="c720" class="pw-post-body-paragraph jv jw ht jx b jy mk iu ka kb ml ix kd ke mm kg kh ki mn kk kl km mo ko kp kq hm dt translated"><code class="eh lj lk ll lm b">&lt;action-button&gt;</code>是一个自定义元素，它提供了一个与<code class="eh lj lk ll lm b">dapp-lib.js</code>通信的接口，以访问我们的智能合约的功能。</p><p id="fcf4" class="pw-post-body-paragraph jv jw ht jx b jy jz iu ka kb kc ix kd ke kf kg kh ki kj kk kl km kn ko kp kq hm dt translated">一个<code class="eh lj lk ll lm b">&lt;action-button&gt;</code>需要以下标签:</p><ul class=""><li id="291c" class="la lb ht jx b jy jz kb kc ke lc ki ld km le kq nf lg lh li dt translated"><strong class="jx hu">源</strong>:应该指向要提取数据的源<code class="eh lj lk ll lm b">div</code></li><li id="ced9" class="la lb ht jx b jy ln kb lo ke lp ki lq km lr kq nf lg lh li dt translated"><strong class="jx hu">动作</strong>:这是我们在<code class="eh lj lk ll lm b">dapp-lib.js</code>中写的函数名</li><li id="0be7" class="la lb ht jx b jy ln kb lo ke lp ki lq km lr kq nf lg lh li dt translated"><strong class="jx hu">方法</strong> : <code class="eh lj lk ll lm b">GET/POST</code></li><li id="b349" class="la lb ht jx b jy ln kb lo ke lp ki lq km lr kq nf lg lh li dt translated"><strong class="jx hu">字段</strong>:将作为<code class="eh lj lk ll lm b">dapp-lib.js</code>功能输入的<code class="eh lj lk ll lm b">data</code>对象下的属性</li><li id="722a" class="la lb ht jx b jy ln kb lo ke lp ki lq km lr kq nf lg lh li dt translated"><strong class="jx hu">文本</strong>:这是按钮上对用户可见的文本</li><li id="beac" class="la lb ht jx b jy ln kb lo ke lp ki lq km lr kq nf lg lh li dt translated"><strong class="jx hu">类</strong>:按钮的CSS类</li><li id="48ae" class="la lb ht jx b jy ln kb lo ke lp ki lq km lr kq nf lg lh li dt translated"><strong class="jx hu">。点击</strong>:点击该按钮时调用的函数。</li></ul><p id="ed26" class="pw-post-body-paragraph jv jw ht jx b jy jz iu ka kb kc ix kd ke kf kg kh ki kj kk kl km kn ko kp kq hm dt translated">首先，让我们为我们的第一位候选人Kitty小姐添加一个动作按钮。导航到<code class="eh lj lk ll lm b">dapp-page.js</code>中的<code class="eh lj lk ll lm b">render()</code>功能。</p><figure class="jk jl jm jn fq jo"><div class="bz el l di"><div class="my mz l"/></div></figure><p id="5acd" class="pw-post-body-paragraph jv jw ht jx b jy jz iu ka kb kc ix kd ke kf kg kh ki kj kk kl km kn ko kp kq hm dt translated">在上面的代码片段中，我们创建了一个隐藏的<code class="eh lj lk ll lm b">&lt;input&gt;</code>，并预先填充了<code class="eh lj lk ll lm b">0</code>的<code class="eh lj lk ll lm b">value</code>，因为猫咪小姐的<code class="eh lj lk ll lm b">candidateId</code>是<code class="eh lj lk ll lm b">0</code>。<code class="eh lj lk ll lm b">data-field</code>被设置为<code class="eh lj lk ll lm b">candidateId</code>，因为<code class="eh lj lk ll lm b">&lt;action-button&gt;</code>将从<code class="eh lj lk ll lm b">candidateId</code>获取其数据。请注意，这被包装在一个名为<code class="eh lj lk ll lm b">kitty-form</code>的<code class="eh lj lk ll lm b">div</code>中。</p><p id="5c94" class="pw-post-body-paragraph jv jw ht jx b jy jz iu ka kb kc ix kd ke kf kg kh ki kj kk kl km kn ko kp kq hm dt translated">让我们创建<code class="eh lj lk ll lm b">showResults()</code>函数。每次点击<code class="eh lj lk ll lm b">&lt;action-button&gt;</code>都会调用该函数。我们将在<code class="eh lj lk ll lm b">dapp-page.js</code>的开头，靠近<code class="eh lj lk ll lm b">constructor(args)</code>的地方创建这个函数。</p><p id="d54b" class="pw-post-body-paragraph jv jw ht jx b jy jz iu ka kb kc ix kd ke kf kg kh ki kj kk kl km kn ko kp kq hm dt translated">该功能的名称为<code class="eh lj lk ll lm b">showResults()</code>。我们将调用<code class="eh lj lk ll lm b">dapp-lib.js</code>中的<code class="eh lj lk ll lm b">getCandidates()</code>函数并显示结果。当我们在UI中显示结果时，我们将在后面的部分中修改这个函数。</p><figure class="jk jl jm jn fq jo"><div class="bz el l di"><div class="my mz l"/></div></figure><p id="01f1" class="pw-post-body-paragraph jv jw ht jx b jy jz iu ka kb kc ix kd ke kf kg kh ki kj kk kl km kn ko kp kq hm dt translated">同样，我们将为Doggo先生写一个<code class="eh lj lk ll lm b">&lt;action-button&gt;</code>。注意<code class="eh lj lk ll lm b">data-field</code>的<code class="eh lj lk ll lm b">value</code>是<code class="eh lj lk ll lm b">1</code>，源<code class="eh lj lk ll lm b">div</code>的名称是<code class="eh lj lk ll lm b">doggo-form</code>。</p><figure class="jk jl jm jn fq jo"><div class="bz el l di"><div class="my mz l"/></div></figure><p id="7f8c" class="pw-post-body-paragraph jv jw ht jx b jy jz iu ka kb kc ix kd ke kf kg kh ki kj kk kl km kn ko kp kq hm dt translated">成功完成这些更改后，您的dapp应该如下所示:</p><figure class="jk jl jm jn fq jo fe ff paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="fe ff kz"><img src="../Images/f2e7635f01efbe1727b010cf0c026790.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*4VRPsRYMgzZKJ5D3.png"/></div></div></figure><h1 id="4201" class="ls lt ht bd lu lv na lx ly lz nb mb mc iz nc ja me jc nd jd mg jf ne jg mi mj dt translated">步骤3:验证我们的投票逻辑工作正常</h1><p id="6e22" class="pw-post-body-paragraph jv jw ht jx b jy mk iu ka kb ml ix kd ke mm kg kh ki mn kk kl km mo ko kp kq hm dt translated">我们差不多完成了。现在我们只需验证它是否正常工作。</p><p id="773e" class="pw-post-body-paragraph jv jw ht jx b jy jz iu ka kb kc ix kd ke kf kg kh ki kj kk kl km kn ko kp kq hm dt translated">要检查一切是否按预期运行，请单击UI中的按钮。你可以多次点击它们。；)</p><p id="7ae6" class="pw-post-body-paragraph jv jw ht jx b jy jz iu ka kb kc ix kd ke kf kg kh ki kj kk kl km kn ko kp kq hm dt translated">在开发人员的控制台中，您应该会看到类似这样的内容。我们看到一个干净的表，而不是嵌套的JSON，因为我们没有做<code class="eh lj lk ll lm b">console.log()</code>，而是做了<code class="eh lj lk ll lm b">console.table()</code>。</p><figure class="jk jl jm jn fq jo fe ff paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="fe ff kz"><img src="../Images/886726fcbd38c3a5baab9e9b20445182.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*ExmW_X6BR4v6TR06.png"/></div></div></figure><p id="b7b5" class="pw-post-body-paragraph jv jw ht jx b jy jz iu ka kb kc ix kd ke kf kg kh ki kj kk kl km kn ko kp kq hm dt translated">终端还应反映区块链上发生的交易。您将能够看到交易id、气体使用量、阻塞号和阻塞时间。它应该是这样的:</p><figure class="jk jl jm jn fq jo fe ff paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="fe ff kz"><img src="../Images/56b824dc8fdea6e825c49fd307139874.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*Q3xCCm9Ms_iAP-37.png"/></div></div></figure><p id="468a" class="pw-post-body-paragraph jv jw ht jx b jy jz iu ka kb kc ix kd ke kf kg kh ki kj kk kl km kn ko kp kq hm dt translated">在本文中，我们学习了如何为候选人添加投票功能。如第1部分所述，除了为候选人投票，您还可以选择为议程投票。你可以用任何你喜欢的方式定制你的dapp。我们还学习了如何给区块链写信。我们学会了如何使用<code class="eh lj lk ll lm b">&lt;action-button&gt;</code>。这些定制元素是DappStarter的主要神奇特性之一。</p><p id="464b" class="pw-post-body-paragraph jv jw ht jx b jy jz iu ka kb kc ix kd ke kf kg kh ki kj kk kl km kn ko kp kq hm dt translated">我们非常接近完成这个dapp。在下一篇文章中，我们将看到如何在UI中直接显示结果，让用户更容易看到每个候选人的当前分数。</p><blockquote class="ng"><p id="bae4" class="nh ni ht bd nj nk nl nm nn no np kq ek translated"><a class="ae kr" href="https://coincodecap.com/?utm_source=coinmonks" rel="noopener ugc nofollow" target="_blank">在您的收件箱中直接获得最佳软件交易</a></p></blockquote><figure class="nr ns nt nu nv jo fe ff paragraph-image"><a href="https://coincodecap.com/?utm_source=coinmonks"><div class="fe ff nq"><img src="../Images/7c0b3dfdcbfea594cc0ae7d4f9bf6fcb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1168/format:webp/0*OJ-qb5G6i863msBB.png"/></div></a></figure><h2 id="0f4f" class="mt lt ht bd lu nw nx ny ly nz oa ob mc ke oc od me ki oe of mg km og oh mi oi dt translated">用<a class="ae kr" href="https://dappstarter.trycrypto.com/" rel="noopener ugc nofollow" target="_blank"> DappStarter </a>开始建造。</h2><h2 id="4129" class="mt lt ht bd lu nw nx ny ly nz oa ob mc ke oc od me ki oe of mg km og oh mi oi dt translated">敬请关注。</h2></div></div>    
</body>
</html>