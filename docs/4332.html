<html>
<head>
<title>How to make Dapp using solidity and web3js</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何使用solidity和web3js制作Dapp</h1>
<blockquote>原文：<a href="https://medium.com/coinmonks/how-to-make-dapp-using-solidity-and-web3js-1c758628033?source=collection_archive---------1-----------------------#2021-04-05">https://medium.com/coinmonks/how-to-make-dapp-using-solidity-and-web3js-1c758628033?source=collection_archive---------1-----------------------#2021-04-05</a></blockquote><div><div class="ef hh hi hj hk hl"/><div class="hm hn ho hp hq"><div class=""/><figure class="fi fk ir is it iu fe ff paragraph-image"><div role="button" tabindex="0" class="iv iw di ix bf iy"><div class="fe ff iq"><img src="../Images/64c629c9caa57d710f92b59f6063783c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*M-p2nZwJZYzwnDBc.png"/></div></div></figure><h1 id="39a1" class="jb jc ht bd jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy dt translated">我们在做什么？</h1><p id="7422" class="pw-post-body-paragraph jz ka ht kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw hm dt translated">一个基本的计数器应用程序，它将在solidity中具有递增和递减功能，我们将能够在浏览器中使用web3.js与这些功能进行交互</p><h1 id="d750" class="jb jc ht bd jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy dt translated"><strong class="ak">Dapp是什么？</strong></h1><p id="cae6" class="pw-post-body-paragraph jz ka ht kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw hm dt translated">一个<strong class="kb hu"> Dapp </strong>，或者分散式应用，是一个运行在分布式网络上的软件应用。它不是托管在一个中央服务器上，而是托管在一个点对点的分散网络上。</p><h1 id="c26c" class="jb jc ht bd jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy dt translated"><strong class="ak">什么是固态语言？</strong></h1><p id="a720" class="pw-post-body-paragraph jz ka ht kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw hm dt translated"><strong class="kb hu"> Solidity </strong>是一种高级的面向合同的语言<strong class="kb hu">，用于</strong>编写智能合同。由以太坊区块链平台的核心贡献者开发，用于<strong class="kb hu">在以太坊虚拟机和其他区块链开发平台内</strong>设计和实现智能合约。</p><h1 id="e7d2" class="jb jc ht bd jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy dt translated">什么是Web3.js，我们为什么要使用Web3.js？</h1><p id="4733" class="pw-post-body-paragraph jz ka ht kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw hm dt translated"><strong class="kb hu"> Web3.js </strong>是一个库集合，允许你使用HTTP、IPC或WebSocket与本地或远程以太坊节点进行交互。web 3 JavaScript库与以太坊区块链交互。它可以检索用户帐户，发送交易，与智能合同交互，等等。</p><h1 id="b9da" class="jb jc ht bd jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy dt translated">先决条件<strong class="ak"> : </strong></h1><p id="87a4" class="pw-post-body-paragraph jz ka ht kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw hm dt translated">Npm:  npm是JavaScript编程语言的一个包管理器。链接:<a class="ae kx" href="https://nodejs.org/en/" rel="noopener ugc nofollow" target="_blank">https://nodejs.org/en/T21</a></p><p id="180f" class="pw-post-body-paragraph jz ka ht kb b kc ky ke kf kg kz ki kj kk la km kn ko lb kq kr ks lc ku kv kw hm dt translated"><strong class="kb hu">Ganache:</strong><a class="ae kx" href="https://www.trufflesuite.com/ganache" rel="noopener ugc nofollow" target="_blank">Ganache</a>是一款用于快速以太坊和Corda分布式应用开发的个人区块链。您可以在整个开发周期中使用Ganache使您能够在安全和确定的环境中开发、部署和测试您的<a class="ae kx" href="https://blog.coincodecap.com/what-are-dapps-an-ultimate-guide" rel="noopener ugc nofollow" target="_blank">dapp</a>。成功安装npm后，安装ganache-cli。命令:</p><pre class="ld le lf lg fq lh li lj lk aw ll dt"><span id="9b8f" class="lm jc ht li b fv ln lo l lp lq">npm install ganache-cli</span></pre><p id="e47e" class="pw-post-body-paragraph jz ka ht kb b kc ky ke kf kg kz ki kj kk la km kn ko lb kq kr ks lc ku kv kw hm dt translated"><strong class="kb hu"> Web3.js命令:</strong></p><pre class="ld le lf lg fq lh li lj lk aw ll dt"><span id="6f0f" class="lm jc ht li b fv ln lo l lp lq">npm install web3</span></pre><p id="ca3a" class="pw-post-body-paragraph jz ka ht kb b kc ky ke kf kg kz ki kj kk la km kn ko lb kq kr ks lc ku kv kw hm dt translated"><strong class="kb hu"> Solcjs: </strong>是一个节点。用于编译实体文件的js库和命令行工具。命令:</p><pre class="ld le lf lg fq lh li lj lk aw ll dt"><span id="b7ba" class="lm jc ht li b fv ln lo l lp lq">npm install solc</span></pre><h1 id="1920" class="jb jc ht bd jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy dt translated">开始使用:</h1><p id="0001" class="pw-post-body-paragraph jz ka ht kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw hm dt translated">该项目将被分为3个主要文件，counter.sol将是我们的solidity合同，counter.js将由我们的部署代码组成，counter.sol将使用web3js连接到合同，并有我们的应用程序的前端。</p><p id="45ca" class="pw-post-body-paragraph jz ka ht kb b kc ky ke kf kg kz ki kj kk la km kn ko lb kq kr ks lc ku kv kw hm dt translated">完成所有步骤后，将获得项目结构:</p><figure class="ld le lf lg fq iu fe ff paragraph-image"><div class="fe ff lr"><img src="../Images/cb585a0bb227e510550e8dd43367ac82.png" data-original-src="https://miro.medium.com/v2/resize:fit:814/format:webp/1*-jmQ4qHLEi41TW_IVk_psQ.jpeg"/></div><figcaption class="ls lt fg fe ff lu lv bd b be z ek">File system structure</figcaption></figure><h1 id="62c5" class="jb jc ht bd jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy dt translated">写我们的第一份合同</h1><p id="ef2a" class="pw-post-body-paragraph jz ka ht kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw hm dt translated"><strong class="kb hu"> Counter.sol </strong></p><pre class="ld le lf lg fq lh li lj lk aw ll dt"><span id="df0a" class="lm jc ht li b fv ln lo l lp lq">// SPDX-License-Identifier: MIT<br/>pragma solidity &gt;=0.7.4;<br/>contract FirstContract {<br/>int public count = 0;<br/>  function incr() public{<br/>    count++;<br/>  }<br/>  function decr() public{<br/>    count--;<br/>  }<br/>  function display() public view returns (int){<br/>    return count;<br/>  }<br/>}</span></pre><p id="045d" class="pw-post-body-paragraph jz ka ht kb b kc ky ke kf kg kz ki kj kk la km kn ko lb kq kr ks lc ku kv kw hm dt translated">你可以把可靠性和java联系起来，因为它和java有相似的结构。正如在java中，我们有类，我们有契约。契约是驻留在以太坊区块链上特定地址的功能和数据的集合。</p><p id="0a57" class="pw-post-body-paragraph jz ka ht kb b kc ky ke kf kg kz ki kj kk la km kn ko lb kq kr ks lc ku kv kw hm dt translated">所以在上面的代码中，我们有3个函数和一个维护计数器的公共变量。</p><p id="3d66" class="pw-post-body-paragraph jz ka ht kb b kc ky ke kf kg kz ki kj kk la km kn ko lb kq kr ks lc ku kv kw hm dt translated">默认情况下，契约状态是<strong class="kb hu">只读的</strong>，除非它被指定为<strong class="kb hu">公共的</strong>，所以我们将所有的函数都设置为公共的。</p><p id="c864" class="pw-post-body-paragraph jz ka ht kb b kc ky ke kf kg kz ki kj kk la km kn ko lb kq kr ks lc ku kv kw hm dt translated"><strong class="kb hu">视图函数</strong>是只读函数，确保状态变量在调用后不能被修改。由于<strong class="kb hu"> display() </strong>函数不会修改该变量，因此该变量将保留给<strong class="kb hu"> view </strong>函数。</p><p id="0bb5" class="pw-post-body-paragraph jz ka ht kb b kc ky ke kf kg kz ki kj kk la km kn ko lb kq kr ks lc ku kv kw hm dt translated">使用solc编译代码:</p><pre class="ld le lf lg fq lh li lj lk aw ll dt"><span id="13b6" class="lm jc ht li b fv ln lo l lp lq">solcjs --bin --abi -o ./build counter.sol</span></pre><figure class="ld le lf lg fq iu fe ff paragraph-image"><div class="fe ff lw"><img src="../Images/3b2e1f0c4c7b10f0b6e3e101e3b9f764.png" data-original-src="https://miro.medium.com/v2/resize:fit:844/format:webp/1*hcIzy459GmXoVBySEjTTsg.jpeg"/></div></figure><p id="e53d" class="pw-post-body-paragraph jz ka ht kb b kc ky ke kf kg kz ki kj kk la km kn ko lb kq kr ks lc ku kv kw hm dt translated">因为我们在需要启动ganache之前安装了<strong class="kb hu"> ganache </strong>。命令:</p><pre class="ld le lf lg fq lh li lj lk aw ll dt"><span id="f505" class="lm jc ht li b fv ln lo l lp lq">ganache-cli</span></pre><h1 id="978e" class="jb jc ht bd jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy dt translated">在我们的本地服务器上部署</h1><p id="cc47" class="pw-post-body-paragraph jz ka ht kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw hm dt translated"><strong class="kb hu"> Deploy.js </strong></p><pre class="ld le lf lg fq lh li lj lk aw ll dt"><span id="73fc" class="lm jc ht li b fv ln lo l lp lq">const fs = require('fs');<br/>const Web3 = require('web3');<br/>const web3 = new Web3('http://localhost:8545');<br/>const bytecode = fs.readFileSync('build/counter_sol_FirstContract.bin');<br/>const abi = JSON.parse(fs.readFileSync('build/counter_sol_FirstContract.abi'));(async function () {<br/>  const ganacheAccounts = await web3.eth.getAccounts();<br/>  const myWalletAddress = ganacheAccounts[0];<br/>  const myContract = new web3.eth.Contract(abi);<br/>  myContract.deploy({<br/>    data: bytecode.toString()<br/>  }).send({<br/>    from: myWalletAddress,<br/>    gas: 5000000<br/>  }).then((deployment) =&gt; {<br/>    console.log('voting was successfully deployed!');<br/>    console.log('voting can be interfaced with at this address:');<br/>    console.log(deployment.options.address);<br/>  }).catch((err) =&gt; {<br/>    console.error(err);<br/>  });<br/>})();</span></pre><p id="b8bc" class="pw-post-body-paragraph jz ka ht kb b kc ky ke kf kg kz ki kj kk la km kn ko lb kq kr ks lc ku kv kw hm dt translated">一旦完成了solidity代码的编译并启动了ganache，我们需要部署上面的脚本。上面的脚本并不太复杂，无法理解，所以请冷静下来。</p><p id="0998" class="pw-post-body-paragraph jz ka ht kb b kc ky ke kf kg kz ki kj kk la km kn ko lb kq kr ks lc ku kv kw hm dt translated">前3行是基本的包含语句，我们将需要部署脚本。</p><p id="a2f3" class="pw-post-body-paragraph jz ka ht kb b kc ky ke kf kg kz ki kj kk la km kn ko lb kq kr ks lc ku kv kw hm dt translated">接下来的两个变量，即<strong class="kb hu">字节码</strong>和<strong class="kb hu"> abi </strong>是在<strong class="kb hu">编译期间构建的文件。sol </strong>脚本。<strong class="kb hu"> ABI </strong>是一个<code class="eh lx ly lz li b">.json</code>文件，描述部署的契约及其功能。它允许我们将契约上下文化并调用它的函数。<code class="eh lx ly lz li b">bin</code>只是编译后的字节码的压缩二进制表示。<code class="eh lx ly lz li b">PUSH</code>、<code class="eh lx ly lz li b">PULL</code>或<code class="eh lx ly lz li b">DELEGATECALL</code>引用的不是操作码，而是它们的二进制表示，在文本编辑器中读起来就像随机数。</p><p id="f2f2" class="pw-post-body-paragraph jz ka ht kb b kc ky ke kf kg kz ki kj kk la km kn ko lb kq kr ks lc ku kv kw hm dt translated">接下来的几行接受不同的参数，如ganache帐户、钱包地址和合同的abi，一旦部署，我们将从web3.js获得用于intract的合同地址</p><p id="ffe9" class="pw-post-body-paragraph jz ka ht kb b kc ky ke kf kg kz ki kj kk la km kn ko lb kq kr ks lc ku kv kw hm dt translated">部署命令:</p><pre class="ld le lf lg fq lh li lj lk aw ll dt"><span id="483a" class="lm jc ht li b fv ln lo l lp lq">node counter.js</span></pre><figure class="ld le lf lg fq iu fe ff paragraph-image"><div class="fe ff ma"><img src="../Images/41980bd0908bc97c5dfe77e347e42b00.png" data-original-src="https://miro.medium.com/v2/resize:fit:934/format:webp/1*oX2YRf9QoiFwrxNH7rf0SA.jpeg"/></div><figcaption class="ls lt fg fe ff lu lv bd b be z ek">Contract address</figcaption></figure><h1 id="73a4" class="jb jc ht bd jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy dt translated">我们Dapp的前端</h1><p id="e273" class="pw-post-body-paragraph jz ka ht kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw hm dt translated">Counter.html</p><pre class="ld le lf lg fq lh li lj lk aw ll dt"><span id="70b3" class="lm jc ht li b fv ln lo l lp lq"><br/>&lt;!DOCTYPE html&gt;<br/>&lt;html&gt;<br/>&lt;head&gt;<br/>  &lt;title&gt;First DApp&lt;/title&gt;<br/>&lt;/head&gt;<br/>&lt;body&gt;<br/>  Increment<br/>  &lt;button id="incr"&gt;+&lt;/button&gt;<br/>  &lt;br&gt;<br/>  Decrement<br/>  &lt;button id="decr"&gt;-&lt;/button&gt;<br/>  &lt;br /&gt;<br/>  &lt;label id="myLabel"&gt;&lt;/label&gt;<br/>&lt;/body&gt;<br/>&lt;script src="<a class="ae kx" href="https://code.jquery.com/jquery-3.6.0.min.js" rel="noopener ugc nofollow" target="_blank">https://code.jquery.com/jquery-3.6.0.min.js</a>"<br/>  integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"&gt;&lt;/script&gt;<br/>&lt;script src="<a class="ae kx" href="https://cdn.jsdelivr.net/npm/web3@1.2.6/dist/web3.min.js" rel="noopener ugc nofollow" target="_blank">https://cdn.jsdelivr.net/npm/web3@1.2.6/dist/web3.min.js</a>"&gt;&lt;/script&gt;</span></pre><p id="1276" class="pw-post-body-paragraph jz ka ht kb b kc ky ke kf kg kz ki kj kk la km kn ko lb kq kr ks lc ku kv kw hm dt translated">Html 代码的前半部分只有2个按钮，它们被分配了2个id来增加和减少值。我的标签将显示显示柜台。之后它包含2个CDN脚本，第一个是用于处理点击事件的<strong class="kb hu"> JQuery </strong>，第二个是用于与契约交互的<strong class="kb hu"> web3js </strong></p><pre class="ld le lf lg fq lh li lj lk aw ll dt"><span id="3d0e" class="lm jc ht li b fv ln lo l lp lq">&lt;script&gt;<br/>  const <strong class="li hu">web3</strong> = new Web3('<a class="ae kx" href="http://localhost:8545'" rel="noopener ugc nofollow" target="_blank">http://localhost:8545'</a>);<br/>  const <strong class="li hu">myContractAddress</strong> = //paste the address generated during deployment with single quotes;<br/>  const <strong class="li hu">myAbi</strong> = // paste your abi code as it is.<br/>  const myContract = new web3.eth.Contract(myAbi, myContractAddress);<br/>  const <strong class="li hu">htmlLabel</strong> = document.getElementById('myLabel');<br/>  myContract.methods.display().call().then((jsonRpcResult) =&gt; {<br/>    htmlLabel.innerHTML = jsonRpcResult;<br/>    console.log(jsonRpcResult);<br/>  });<br/>  $('#incr').click(function () {<br/><strong class="li hu">    </strong>myContract.methods<strong class="li hu">.incr</strong>().send({from:'<strong class="li hu">//paste avaiable accounts from ganache</strong>'},function () {<br/>      myContract.methods.<strong class="li hu">display</strong>().call((error, result) =&gt; { htmlLabel.innerHTML = result; console.log(result) })<br/>    })<br/>  });<br/>  $('#decr').click(function () {<br/>    myContract.methods.<strong class="li hu">decr</strong>().send({from:'<strong class="li hu">//paste avaiable accounts from ganache</strong>'}, function () {<br/>      myContract.methods.<strong class="li hu">display</strong>().call((error, result) =&gt; { htmlLabel.innerHTML = result; console.log(result) })<br/>    })<br/>  });<br/>&lt;/script&gt;<br/>&lt;/html&gt;</span></pre><p id="3c42" class="pw-post-body-paragraph jz ka ht kb b kc ky ke kf kg kz ki kj kk la km kn ko lb kq kr ks lc ku kv kw hm dt translated">将部署过程中生成的合同地址粘贴到<strong class="kb hu"> myContractAddress </strong>变量中。</p><p id="86cb" class="pw-post-body-paragraph jz ka ht kb b kc ky ke kf kg kz ki kj kk la km kn ko lb kq kr ks lc ku kv kw hm dt translated">从编译期间生成的abi文件中粘贴<strong class="kb hu"> abi </strong>代码。sol文件。</p><p id="6747" class="pw-post-body-paragraph jz ka ht kb b kc ky ke kf kg kz ki kj kk la km kn ko lb kq kr ks lc ku kv kw hm dt translated">Htmllabel只是获取对<strong class="kb hu"> myLabel </strong>的引用，以便在单击按钮时更新。</p><p id="a48e" class="pw-post-body-paragraph jz ka ht kb b kc ky ke kf kg kz ki kj kk la km kn ko lb kq kr ks lc ku kv kw hm dt translated">每当我们试图访问函数时，我们需要传递一个from变量，即我们从哪个帐户访问合同，这可以从ganache cli获取，粘贴到任何一个地址中。</p><figure class="ld le lf lg fq iu fe ff paragraph-image"><div class="fe ff mb"><img src="../Images/2210349505b9b5e4e75d94e1f8ceab28.png" data-original-src="https://miro.medium.com/v2/resize:fit:1084/format:webp/1*zJ1_-lV8nn7YUMB-LssuvQ.jpeg"/></div></figure><h1 id="1bd7" class="jb jc ht bd jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy dt translated">输出:</h1><p id="e9be" class="pw-post-body-paragraph jz ka ht kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw hm dt translated">完成所有步骤后，在chrome或任何其他网络浏览器中打开你的HTML文件，看看你的第一个Dapp是如何工作的！Woho！</p><figure class="ld le lf lg fq iu fe ff paragraph-image"><div role="button" tabindex="0" class="iv iw di ix bf iy"><div class="fe ff mc"><img src="../Images/9e7db1ae0a2ef651bfa905bbea183d80.png" data-original-src="https://miro.medium.com/v2/resize:fit:324/format:webp/1*u1ICVQ3Aumk795kuxHTyPg.png"/></div></div></figure><p id="b7fc" class="pw-post-body-paragraph jz ka ht kb b kc ky ke kf kg kz ki kj kk la km kn ko lb kq kr ks lc ku kv kw hm dt translated">恭喜你！你正在写你的第一个Dapp，希望你会喜欢。如果你需要更多关于分散式网络应用的有趣文章，请放弃你的建议！</p><p id="0439" class="pw-post-body-paragraph jz ka ht kb b kc ky ke kf kg kz ki kj kk la km kn ko lb kq kr ks lc ku kv kw hm dt translated">感谢阅读！👋👋</p><p id="6dbe" class="pw-post-body-paragraph jz ka ht kb b kc ky ke kf kg kz ki kj kk la km kn ko lb kq kr ks lc ku kv kw hm dt translated"><strong class="kb hu">做检查我的网站</strong><a class="ae kx" href="https://sagargada.me/" rel="noopener ugc nofollow" target="_blank"><strong class="kb hu">Sagar gada . me</strong></a><strong class="kb hu">和GitHub </strong> <a class="ae kx" href="http://github.com/sagargada73/" rel="noopener ugc nofollow" target="_blank"> <strong class="kb hu">这里</strong> </a> <strong class="kb hu"> <br/>关注我的</strong><a class="ae kx" href="https://www.linkedin.com/in/sagar-gada-7631b6108/" rel="noopener ugc nofollow" target="_blank"><strong class="kb hu">LinkedIn</strong></a></p></div></div>    
</body>
</html>