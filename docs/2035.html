<html>
<head>
<title>Hyperledger Fabric — Updating Channel Configs</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Hyperledger结构-更新渠道配置</h1>
<blockquote>原文：<a href="https://medium.com/coinmonks/hyperledger-fabric-updating-channel-configs-45082a5dc9b2?source=collection_archive---------0-----------------------#2019-02-04">https://medium.com/coinmonks/hyperledger-fabric-updating-channel-configs-45082a5dc9b2?source=collection_archive---------0-----------------------#2019-02-04</a></blockquote><div><div class="ef hh hi hj hk hl"/><div class="hm hn ho hp hq"><div class=""/><figure class="fi fk ir is it iu fe ff paragraph-image"><div role="button" tabindex="0" class="iv iw di ix bf iy"><div class="fe ff iq"><img src="../Images/765278433dae0c90cd6d652a81927a48.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VpWGKXub015e_zDbg1LlWw.png"/></div></div><figcaption class="jb jc fg fe ff jd je bd b be z ek"><a class="ae jf" href="https://www.hyperledger.org/blog/2018/11/28/conducting-data-with-concerto-and-hyperledger-fabric" rel="noopener ugc nofollow" target="_blank">Hyperledger Fabric Image</a></figcaption></figure><h2 id="aed0" class="jg jh ht bd ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd dt translated">介绍</h2><p id="5920" class="pw-post-body-paragraph ke kf ht kg b kh ki kj kk kl km kn ko jr kp kq kr jv ks kt ku jz kv kw kx ky hm dt translated">这是关于<strong class="kg hu"> <em class="kz">在Hyperledger Fabric </em> </strong>中更新渠道配置的分步指南。<strong class="kg hu"> <em class="kz"> </em> </strong>这些步骤使用Hyperledger Fabric<a class="ae jf" href="https://hyperledger-fabric.readthedocs.io/en/release-1.4/build_network.html" rel="noopener ugc nofollow" target="_blank"><strong class="kg hu"><em class="kz">【构建你的第一个网络】(BYFN) </em> </strong> </a>来演示。我们使用Hyperledger Fabric<strong class="kg hu"><em class="kz">v 1.4</em></strong>。</p><blockquote class="la lb lc"><p id="d613" class="ke kf kz kg b kh ld kj kk kl le kn ko lf lg kq kr lh li kt ku lj lk kw kx ky hm dt translated">如果你不知道如何启动一个BYFN，我也会在本教程中提供步骤，不用担心！</p><p id="aa6e" class="ke kf kz kg b kh ld kj kk kl le kn ko lf lg kq kr lh li kt ku lj lk kw kx ky hm dt translated">Hyperledger Fabric中的<strong class="kg hu">通道</strong>是区块链网络中的私有组。每个区块链网络可以包含多个渠道，其中每个渠道都独立于其他渠道，有自己的分类账，并包含(多个)组织。</p></blockquote><p id="d0cf" class="pw-post-body-paragraph ke kf ht kg b kh ld kj kk kl le kn ko jr lg kq kr jv li kt ku jz lk kw kx ky hm dt translated">每个通道都是独立的，因此每个通道都有独立的配置集，如一些策略、一个块中有多少个事务等。我们将讨论如何更新<strong class="kg hu"><em class="kz"/></strong>通道的配置集。</p></div><div class="ab cl ll lm hb ln" role="separator"><span class="lo bw bk lp lq lr"/><span class="lo bw bk lp lq lr"/><span class="lo bw bk lp lq"/></div><div class="hm hn ho hp hq"><h2 id="c66f" class="jg jh ht bd ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd dt translated">步骤–概述</h2><p id="96b2" class="pw-post-body-paragraph ke kf ht kg b kh ki kj kk kl km kn ko jr kp kq kr jv ks kt ku jz kv kw kx ky hm dt translated">因为更新频道配置的步骤很容易让人迷路(文件太多了！)，我在这里列出了步骤概述:</p><ol class=""><li id="624d" class="ls lt ht kg b kh ld kl le jr lu jv lv jz lw ky lx ly lz ma dt translated">建立一个BYFN(我们的区块链网络)</li><li id="4204" class="ls lt ht kg b kh mb kl mc jr md jv me jz mf ky lx ly lz ma dt translated"><strong class="kg hu"> <em class="kz">取</em> </strong>当前通道配置为<strong class="kg hu"><em class="kz">my channel</em></strong>–output:<code class="eh mg mh mi mj b"><strong class="kg hu"><em class="kz">config_block.pb</em></strong></code>，为块文件</li><li id="71a5" class="ls lt ht kg b kh mb kl mc jr md jv me jz mf ky lx ly lz ma dt translated">将<code class="eh mg mh mi mj b"><strong class="kg hu"><em class="kz">config_block.pb</em></strong></code>配置转换成可理解的JSON文件——输出:<code class="eh mg mh mi mj b"><strong class="kg hu"><em class="kz">config.json</em></strong></code></li><li id="5d10" class="ls lt ht kg b kh mb kl mc jr md jv me jz mf ky lx ly lz ma dt translated">将<code class="eh mg mh mi mj b"><strong class="kg hu"><em class="kz">config.json</em></strong></code>复制到<code class="eh mg mh mi mj b"><strong class="kg hu"><em class="kz">modified_config.json</em></strong></code>，我们将根据需要更新的内容对其进行修改</li><li id="cf49" class="ls lt ht kg b kh mb kl mc jr md jv me jz mf ky lx ly lz ma dt translated">安装vim修改JSON文件</li><li id="a435" class="ls lt ht kg b kh mb kl mc jr md jv me jz mf ky lx ly lz ma dt translated">修改<code class="eh mg mh mi mj b"><strong class="kg hu"><em class="kz">modified_config.json</em></strong></code>中的配置</li><li id="9170" class="ls lt ht kg b kh mb kl mc jr md jv me jz mf ky lx ly lz ma dt translated">将<code class="eh mg mh mi mj b"><strong class="kg hu"><em class="kz">modified_config.json</em></strong></code>转换为块文件–输出:<code class="eh mg mh mi mj b"><strong class="kg hu"><em class="kz">modified_config.pb</em></strong></code></li><li id="7192" class="ls lt ht kg b kh mb kl mc jr md jv me jz mf ky lx ly lz ma dt translated">将<code class="eh mg mh mi mj b"><strong class="kg hu"><em class="kz">config.json</em></strong></code>转换为块文件—输出:<code class="eh mg mh mi mj b"><strong class="kg hu"><em class="kz">config.pb</em></strong></code></li><li id="a985" class="ls lt ht kg b kh mb kl mc jr md jv me jz mf ky lx ly lz ma dt translated">计算<code class="eh mg mh mi mj b"><strong class="kg hu"><em class="kz">modified_config.pb</em></strong></code>和<code class="eh mg mh mi mj b"><strong class="kg hu"><em class="kz">config.json</em></strong></code>之间的差值–输出:<code class="eh mg mh mi mj b"><strong class="kg hu"><em class="kz">diff_config.pb</em></strong></code></li><li id="af92" class="ls lt ht kg b kh mb kl mc jr md jv me jz mf ky lx ly lz ma dt translated">将<code class="eh mg mh mi mj b"><strong class="kg hu"><em class="kz">diff_config.pb</em></strong></code>配置转换成可理解的JSON文件——输出:<code class="eh mg mh mi mj b"><strong class="kg hu"><em class="kz">diff_config.json</em></strong></code></li><li id="9319" class="ls lt ht kg b kh mb kl mc jr md jv me jz mf ky lx ly lz ma dt translated">在<code class="eh mg mh mi mj b"><strong class="kg hu"><em class="kz">diff_config.json</em></strong></code> <strong class="kg hu"> <em class="kz"> </em> </strong>中添加<strong class="kg hu"> <em class="kz">信封</em> </strong>文本—输出:<code class="eh mg mh mi mj b"><strong class="kg hu"><em class="kz">diff_config_envelope.json</em></strong></code></li><li id="dbef" class="ls lt ht kg b kh mb kl mc jr md jv me jz mf ky lx ly lz ma dt translated">将<code class="eh mg mh mi mj b"><strong class="kg hu"><em class="kz">diff_config_envelope.json</em></strong></code> <strong class="kg hu"> <em class="kz"> </em> </strong>转换为块文件—输出:<code class="eh mg mh mi mj b"><strong class="kg hu"><em class="kz">diff_config_envelope.pb</em></strong></code></li><li id="606b" class="ls lt ht kg b kh mb kl mc jr md jv me jz mf ky lx ly lz ma dt translated">签署<code class="eh mg mh mi mj b"><strong class="kg hu"><em class="kz">diff_config_envelope.pb</em></strong></code> <strong class="kg hu"> <em class="kz"> </em> </strong>作为订单管理员(取决于政策)</li><li id="66ef" class="ls lt ht kg b kh mb kl mc jr md jv me jz mf ky lx ly lz ma dt translated">发送渠道更新交易</li></ol><p id="ee83" class="pw-post-body-paragraph ke kf ht kg b kh ld kj kk kl le kn ko jr lg kq kr jv li kt ku jz lk kw kx ky hm dt translated">一些问答:</p><blockquote class="la lb lc"><p id="51df" class="ke kf kz kg b kh ld kj kk kl le kn ko lf lg kq kr lh li kt ku lj lk kw kx ky hm dt translated">问:在步骤2中，为什么那些配置是通过<strong class="kg hu">取块</strong>得到的？</p><p id="83cf" class="ke kf kz kg b kh ld kj kk kl le kn ko lf lg kq kr lh li kt ku lj lk kw kx ky hm dt translated">答:这是因为在Hyperledger Fabric中，渠道配置是在区块链分类帐中编码的，它们只是区块链中的信息。</p><p id="a7cb" class="ke kf kz kg b kh ld kj kk kl le kn ko lf lg kq kr lh li kt ku lj lk kw kx ky hm dt translated">问:在第9步中，为什么我们需要计算差异？</p><p id="2e92" class="ke kf kz kg b kh ld kj kk kl le kn ko lf lg kq kr lh li kt ku lj lk kw kx ky hm dt translated">答:根据Hyperledger Fabric文档，“我们能够放弃Org1和Org2的大量MSP材料和修改政策信息，因为这些数据已经存在于渠道的genesis块中。因此，我们只需要两种配置之间的增量”。</p><p id="271b" class="ke kf kz kg b kh ld kj kk kl le kn ko lf lg kq kr lh li kt ku lj lk kw kx ky hm dt translated">问:在步骤13中，为什么我们需要以OrdererOrg admin的身份签署配置块？</p><p id="a8c4" class="ke kf kz kg b kh ld kj kk kl le kn ko lf lg kq kr lh li kt ku lj lk kw kx ky hm dt translated">答:要看政策。有关Hyperledger结构策略的更多详细信息，您可以查看:</p><p id="91d3" class="ke kf kz kg b kh ld kj kk kl le kn ko lf lg kq kr lh li kt ku lj lk kw kx ky hm dt translated">(1)<a class="ae jf" href="https://hyperledger-fabric.readthedocs.io/en/release-1.4/policies.html?highlight=policy" rel="noopener ugc nofollow" target="_blank">https://hyperledger-fabric . readthedocs . io/en/release-1.4/policies . html？突出显示=政策</a></p><p id="b30b" class="ke kf kz kg b kh ld kj kk kl le kn ko lf lg kq kr lh li kt ku lj lk kw kx ky hm dt translated">(2)<a class="ae jf" rel="noopener" href="/@reasdom/hyperledger-fabric-damn-implicitmetapolicy-44cc9cc5c472">https://medium . com/@ reasdom/hyperledger-fabric-damn-implicitmeta policy-44c C9 cc 5c 472</a></p></blockquote></div><div class="ab cl ll lm hb ln" role="separator"><span class="lo bw bk lp lq lr"/><span class="lo bw bk lp lq lr"/><span class="lo bw bk lp lq"/></div><div class="hm hn ho hp hq"><h2 id="4800" class="jg jh ht bd ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd dt translated">步骤1-建立BYFN(我们的区块链网络)</h2><h2 id="3f14" class="jg jh ht bd ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd dt translated"><strong class="ak"> 1.1安装先决条件</strong></h2><p id="5343" class="pw-post-body-paragraph ke kf ht kg b kh ki kj kk kl km kn ko jr kp kq kr jv ks kt ku jz kv kw kx ky hm dt translated">在本教程中，我们使用Hyperledger Fabric v1.4版。</p><p id="40c0" class="pw-post-body-paragraph ke kf ht kg b kh ld kj kk kl le kn ko jr lg kq kr jv li kt ku jz lk kw kx ky hm dt translated">首先，您可以按照官方说明安装先决条件:</p><ol class=""><li id="f620" class="ls lt ht kg b kh ld kl le jr lu jv lv jz lw ky lx ly lz ma dt translated"><a class="ae jf" href="https://hyperledger-fabric.readthedocs.io/en/release-1.4/prereqs.html#prerequisites" rel="noopener ugc nofollow" target="_blank">安装先决条件</a></li><li id="eb7f" class="ls lt ht kg b kh mb kl mc jr md jv me jz mf ky lx ly lz ma dt translated"><a class="ae jf" href="https://hyperledger-fabric.readthedocs.io/en/release-1.4/install.html" rel="noopener ugc nofollow" target="_blank">从Hyperledger Fabric安装示例、程序和docker映像</a></li></ol><h2 id="2a64" class="jg jh ht bd ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd dt translated"><strong class="ak"> 1.2切换到BYFN目录</strong></h2><p id="5a50" class="pw-post-body-paragraph ke kf ht kg b kh ki kj kk kl km kn ko jr kp kq kr jv ks kt ku jz kv kw kx ky hm dt translated">让我们切换到BYFN目录(*假设您完成了先决条件部分，您应该已经有了所有需要的文件和目录):</p><pre class="mk ml mm mn fq mo mj mp mq aw mr dt"><span id="5b59" class="jg jh ht mj b fv ms mt l mu mv">cd fabric<strong class="mj hu">-</strong>samples<strong class="mj hu">/</strong>first<strong class="mj hu">-</strong>network</span></pre><h2 id="64fe" class="jg jh ht bd ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd dt translated"><strong class="ak"> 1.3调出网络！</strong></h2><p id="198a" class="pw-post-body-paragraph ke kf ht kg b kh ki kj kk kl km kn ko jr kp kq kr jv ks kt ku jz kv kw kx ky hm dt translated">有一个脚本可以轻松调出网络，运行一下就可以了。谢了，超级账本。</p><pre class="mk ml mm mn fq mo mj mp mq aw mr dt"><span id="2f9c" class="jg jh ht mj b fv ms mt l mu mv">./byfn.sh up</span></pre><blockquote class="la lb lc"><p id="7be0" class="ke kf kz kg b kh ld kj kk kl le kn ko lf lg kq kr lh li kt ku lj lk kw kx ky hm dt translated">运行此脚本后，您可能需要等待一会儿…</p><p id="c02b" class="ke kf kz kg b kh ld kj kk kl le kn ko lf lg kq kr lh li kt ku lj lk kw kx ky hm dt translated">另外，在运行上面的命令之前，记得启动Docker。</p><p id="6168" class="ke kf kz kg b kh ld kj kk kl le kn ko lf lg kq kr lh li kt ku lj lk kw kx ky hm dt translated">*万一你做错了什么，你可以运行下面的命令来关闭网络，并重新启动(而且要小心):</p><p id="aea2" class="ke kf kz kg b kh ld kj kk kl le kn ko lf lg kq kr lh li kt ku lj lk kw kx ky hm dt translated">。/byfn.sh down <br/>。/byfn.sh up</p></blockquote><h2 id="3da2" class="jg jh ht bd ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd dt translated">1.4访问Cli </h2><p id="71ec" class="pw-post-body-paragraph ke kf ht kg b kh ki kj kk kl km kn ko jr kp kq kr jv ks kt ku jz kv kw kx ky hm dt translated">有一个cli Docker容器是自动创建的，它是一个命令行接口<strong class="kg hu"> <em class="kz">控制节点</em> </strong>。</p><p id="6fef" class="pw-post-body-paragraph ke kf ht kg b kh ld kj kk kl le kn ko jr lg kq kr jv li kt ku jz lk kw kx ky hm dt translated">让我们进入命令行界面:</p><pre class="mk ml mm mn fq mo mj mp mq aw mr dt"><span id="069e" class="jg jh ht mj b fv ms mt l mu mv">docker exec -it cli bash</span></pre><p id="e9db" class="pw-post-body-paragraph ke kf ht kg b kh ld kj kk kl le kn ko jr lg kq kr jv li kt ku jz lk kw kx ky hm dt translated">然后，设置一些程序使用的<strong class="kg hu"> <em class="kz">环境变量</em> </strong>:</p><pre class="mk ml mm mn fq mo mj mp mq aw mr dt"><span id="c531" class="jg jh ht mj b fv ms mt l mu mv">export CHANNEL_NAME=mychannel<br/>export CORE_PEER_MSPCONFIGPATH=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org1.example.com/users/Admin@org1.example.com/msp<br/>export CORE_PEER_ADDRESS=peer0.org1.example.com:7051<br/>export CORE_PEER_LOCALMSPID="Org1MSP"<br/>export CORE_PEER_TLS_ROOTCERT_FILE=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org1.example.com/peers/peer0.org1.example.com/tls/ca.crt<br/>export ORDERER_CA=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/ordererOrganizations/example.com/orderers/orderer.example.com/msp/tlscacerts/tlsca.example.com-cert.pem</span></pre><blockquote class="la lb lc"><p id="5185" class="ke kf kz kg b kh ld kj kk kl le kn ko lf lg kq kr lh li kt ku lj lk kw kx ky hm dt translated">你可以把它们都复制下来，然后粘贴到你的终端上，按下“回车”键。</p><p id="d09d" class="ke kf kz kg b kh ld kj kk kl le kn ko lf lg kq kr lh li kt ku lj lk kw kx ky hm dt translated">有点乱，不好意思。</p></blockquote></div><div class="ab cl ll lm hb ln" role="separator"><span class="lo bw bk lp lq lr"/><span class="lo bw bk lp lq lr"/><span class="lo bw bk lp lq"/></div><div class="hm hn ho hp hq"><h2 id="a21f" class="jg jh ht bd ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd dt translated"><strong class="ak"> <em class="mw">第二步—取</em></strong><strong class="ak"><em class="mw">my channel</em></strong>的当前通道配置—输出:<strong class="ak"><em class="mw">config _ block . Pb</em></strong>，为块文件</h2><pre class="mk ml mm mn fq mo mj mp mq aw mr dt"><span id="074e" class="jg jh ht mj b fv ms mt l mu mv">peer channel fetch config config_block.pb -o orderer.example.com:7050 -c $CHANNEL_NAME --tls --cafile $ORDERER_CA</span></pre></div><div class="ab cl ll lm hb ln" role="separator"><span class="lo bw bk lp lq lr"/><span class="lo bw bk lp lq lr"/><span class="lo bw bk lp lq"/></div><div class="hm hn ho hp hq"><h2 id="b524" class="jg jh ht bd ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd dt translated">第3步—将<strong class="ak"><em class="mw">config _ block . Pb</em></strong>配置转换为可理解的JSON文件—输出:<strong class="ak"> <em class="mw"> config.json </em> </strong></h2><pre class="mk ml mm mn fq mo mj mp mq aw mr dt"><span id="41a3" class="jg jh ht mj b fv ms mt l mu mv">configtxlator proto_decode --input config_block.pb --type common.Block | jq .data.data[0].payload.data.config &gt; config.json</span></pre></div><div class="ab cl ll lm hb ln" role="separator"><span class="lo bw bk lp lq lr"/><span class="lo bw bk lp lq lr"/><span class="lo bw bk lp lq"/></div><div class="hm hn ho hp hq"><h2 id="1f95" class="jg jh ht bd ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd dt translated">第四步——复制<strong class="ak"> <em class="mw"> config.json </em> </strong>到<strong class="ak"><em class="mw">modified _ config . JSON</em></strong>，我们会根据需要更新的内容对其进行修改</h2><pre class="mk ml mm mn fq mo mj mp mq aw mr dt"><span id="bc4d" class="jg jh ht mj b fv ms mt l mu mv">cp config.json modified_config.json</span></pre></div><div class="ab cl ll lm hb ln" role="separator"><span class="lo bw bk lp lq lr"/><span class="lo bw bk lp lq lr"/><span class="lo bw bk lp lq"/></div><div class="hm hn ho hp hq"><h2 id="866f" class="jg jh ht bd ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd dt translated">步骤5 —安装vim以修改JSON文件</h2><p id="cfdc" class="pw-post-body-paragraph ke kf ht kg b kh ki kj kk kl km kn ko jr kp kq kr jv ks kt ku jz kv kw kx ky hm dt translated">vim是Linux中著名的编辑工具。</p><pre class="mk ml mm mn fq mo mj mp mq aw mr dt"><span id="30f4" class="jg jh ht mj b fv ms mt l mu mv">sudo apt-get update -y<br/>sudo apt-get install vim -y</span></pre></div><div class="ab cl ll lm hb ln" role="separator"><span class="lo bw bk lp lq lr"/><span class="lo bw bk lp lq lr"/><span class="lo bw bk lp lq"/></div><div class="hm hn ho hp hq"><h2 id="d3a0" class="jg jh ht bd ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd dt translated">第6步—修改<strong class="ak"><em class="mw">modified _ config . JSON</em></strong>中的配置</h2><pre class="mk ml mm mn fq mo mj mp mq aw mr dt"><span id="2b0b" class="jg jh ht mj b fv ms mt l mu mv">vim modified_config.json</span></pre><p id="1acc" class="pw-post-body-paragraph ke kf ht kg b kh ld kj kk kl le kn ko jr lg kq kr jv li kt ku jz lk kw kx ky hm dt translated">在本教程中，让我们编辑<strong class="kg hu"> <em class="kz"> BatchSize </em> </strong>，这是关于一个块中有多少个事务(默认为10个事务/块)。我们要修改<strong class="kg hu"><em class="kz">max _ message _ count</em></strong>。</p><ol class=""><li id="f6d5" class="ls lt ht kg b kh ld kl le jr lu jv lv jz lw ky lx ly lz ma dt translated"><strong class="kg hu"> <em class="kz">按“/”</em></strong>开始搜索文本</li><li id="3569" class="ls lt ht kg b kh mb kl mc jr md jv me jz mf ky lx ly lz ma dt translated"><strong class="kg hu"> <em class="kz">键入“最大消息数”</em> </strong></li><li id="66ec" class="ls lt ht kg b kh mb kl mc jr md jv me jz mf ky lx ly lz ma dt translated">那么你的光标应该位于文本的开头"<strong class="kg hu"><em class="kz">max _ message _ count</em></strong>"</li></ol><figure class="mk ml mm mn fq iu"><div class="bz el l di"><div class="mx my l"/></div></figure><p id="3d57" class="pw-post-body-paragraph ke kf ht kg b kh ld kj kk kl le kn ko jr lg kq kr jv li kt ku jz lk kw kx ky hm dt translated">你看到上面的文字了吗？</p><ol class=""><li id="7ed6" class="ls lt ht kg b kh ld kl le jr lu jv lv jz lw ky lx ly lz ma dt translated">现在，<strong class="kg hu"> <em class="kz">按“I”</em></strong>进入vim中的插入模式(这样我们就可以开始编辑了)，按下后，你应该看到在终端的左下方有“- Insert -”</li><li id="f9e1" class="ls lt ht kg b kh mb kl mc jr md jv me jz mf ky lx ly lz ma dt translated">将光标放在“10”上(上面的第6行)</li><li id="ea19" class="ls lt ht kg b kh mb kl mc jr md jv me jz mf ky lx ly lz ma dt translated">将“10”改为“11”:</li></ol><figure class="mk ml mm mn fq iu"><div class="bz el l di"><div class="mx my l"/></div></figure><p id="bf60" class="pw-post-body-paragraph ke kf ht kg b kh ld kj kk kl le kn ko jr lg kq kr jv li kt ku jz lk kw kx ky hm dt translated">注意第6行。我们有相同的短信吗？我们只是将每个块的事务数量从10个更改为11个。</p><blockquote class="la lb lc"><p id="9af2" class="ke kf kz kg b kh ld kj kk kl le kn ko lf lg kq kr lh li kt ku lj lk kw kx ky hm dt translated">温馨提示(<strong class="kg hu">可选</strong>到本教程):</p><p id="46c6" class="ke kf kz kg b kh ld kj kk kl le kn ko lf lg kq kr lh li kt ku lj lk kw kx ky hm dt translated">一般来说，增加这个数字可能会导致更高的吞吐量(以TPS，每秒事务数为单位)，但太多可能会导致更大的延迟。我个人用100(你可能需要调整“absolute_max_bytes”，“preferre_max_bytes”，一些Kafka设置如果有的话，还有block release超时)。如果你有非常强大的机器，这个数字可能会更大。在我的负载测试中，我可以达到超过2 XXX TPS(GOLang chain code使用基本的getState()和putState()操作，并使用LevelDB，v1.4 network)。</p><p id="4e4b" class="ke kf kz kg b kh ld kj kk kl le kn ko lf lg kq kr lh li kt ku lj lk kw kx ky hm dt translated">记得自己进行负载/性能测试，以验证<strong class="kg hu">生产案例</strong>。更多细节你可以看看:<a class="ae jf" href="https://arxiv.org/pdf/1805.11390.pdf" rel="noopener ugc nofollow" target="_blank">https://arxiv.org/pdf/1805.11390.pdf</a></p></blockquote><ol class=""><li id="599c" class="ls lt ht kg b kh ld kl le jr lu jv lv jz lw ky lx ly lz ma dt translated">然后，<strong class="kg hu"> <em class="kz">按【ESC】</em></strong>退出vim的插入模式</li><li id="5c76" class="ls lt ht kg b kh mb kl mc jr md jv me jz mf ky lx ly lz ma dt translated">按“shift +:”，键入“wq！”，然后按“回车”。现在您应该离开vim，修改被保存。</li></ol></div><div class="ab cl ll lm hb ln" role="separator"><span class="lo bw bk lp lq lr"/><span class="lo bw bk lp lq lr"/><span class="lo bw bk lp lq"/></div><div class="hm hn ho hp hq"><h2 id="8724" class="jg jh ht bd ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd dt translated">第7步—将<strong class="ak"><em class="mw">modified _ config . JSON</em></strong>转换为块文件—输出:<strong class="ak"><em class="mw">modified _ config . Pb</em></strong></h2><pre class="mk ml mm mn fq mo mj mp mq aw mr dt"><span id="9aa0" class="jg jh ht mj b fv ms mt l mu mv">configtxlator proto_encode --input modified_config.json --type common.Config --output modified_config.pb</span></pre></div><div class="ab cl ll lm hb ln" role="separator"><span class="lo bw bk lp lq lr"/><span class="lo bw bk lp lq lr"/><span class="lo bw bk lp lq"/></div><div class="hm hn ho hp hq"><h2 id="3c8a" class="jg jh ht bd ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd dt translated">步骤8 —将<strong class="ak"> <em class="mw"> config.json </em> </strong>转换为块文件—输出:<strong class="ak"> <em class="mw"> config.pb </em> </strong></h2><pre class="mk ml mm mn fq mo mj mp mq aw mr dt"><span id="19e1" class="jg jh ht mj b fv ms mt l mu mv">configtxlator proto_encode --input config.json --type common.Config --output config.pb</span></pre></div><div class="ab cl ll lm hb ln" role="separator"><span class="lo bw bk lp lq lr"/><span class="lo bw bk lp lq lr"/><span class="lo bw bk lp lq"/></div><div class="hm hn ho hp hq"><h2 id="7bb7" class="jg jh ht bd ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd dt translated">第9步—计算<strong class="ak"><em class="mw">modified _ config . Pb</em></strong>和<strong class="ak"> <em class="mw"> config.pb </em> </strong> —输出:<strong class="ak"><em class="mw">diff _ config . Pb</em></strong></h2><pre class="mk ml mm mn fq mo mj mp mq aw mr dt"><span id="a29c" class="jg jh ht mj b fv ms mt l mu mv">configtxlator compute_update --channel_id $CHANNEL_NAME --original config.pb --updated modified_config.pb --output diff_config.pb</span></pre></div><div class="ab cl ll lm hb ln" role="separator"><span class="lo bw bk lp lq lr"/><span class="lo bw bk lp lq lr"/><span class="lo bw bk lp lq"/></div><div class="hm hn ho hp hq"><h2 id="256c" class="jg jh ht bd ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd dt translated">步骤10 —将<strong class="ak"><em class="mw">diff _ config . Pb</em></strong>配置转换为可理解的JSON文件—输出:<strong class="ak"><em class="mw">diff _ config . JSON</em></strong></h2><pre class="mk ml mm mn fq mo mj mp mq aw mr dt"><span id="1bb7" class="jg jh ht mj b fv ms mt l mu mv">configtxlator proto_decode --input diff_config.pb --type common.ConfigUpdate | jq . &gt; diff_config.json</span></pre></div><div class="ab cl ll lm hb ln" role="separator"><span class="lo bw bk lp lq lr"/><span class="lo bw bk lp lq lr"/><span class="lo bw bk lp lq"/></div><div class="hm hn ho hp hq"><h2 id="175f" class="jg jh ht bd ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd dt translated">步骤11 —在<strong class="ak"><em class="mw">diff _ config . JSON</em></strong>中添加<strong class="ak"> <em class="mw">信封</em> </strong>文本—输出:<strong class="ak"><em class="mw">diff _ config _ envelope . JSON</em></strong></h2><pre class="mk ml mm mn fq mo mj mp mq aw mr dt"><span id="f6da" class="jg jh ht mj b fv ms mt l mu mv">echo '{"payload":{"header":{"channel_header":{"channel_id":"mychannel", "type":2}},"data":{"config_update":'$(cat diff_config.json)'}}}' | jq . &gt; diff_config_envelope.json</span></pre></div><div class="ab cl ll lm hb ln" role="separator"><span class="lo bw bk lp lq lr"/><span class="lo bw bk lp lq lr"/><span class="lo bw bk lp lq"/></div><div class="hm hn ho hp hq"><h2 id="f133" class="jg jh ht bd ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd dt translated">步骤12 —将<strong class="ak"><em class="mw">diff _ config _ envelope . JSON</em></strong>转换为块文件—输出:<strong class="ak"><em class="mw">diff _ config _ envelope . Pb</em></strong></h2><pre class="mk ml mm mn fq mo mj mp mq aw mr dt"><span id="706d" class="jg jh ht mj b fv ms mt l mu mv">configtxlator proto_encode --input diff_config_envelope.json --type common.Envelope --output diff_config_envelope.pb</span></pre></div><div class="ab cl ll lm hb ln" role="separator"><span class="lo bw bk lp lq lr"/><span class="lo bw bk lp lq lr"/><span class="lo bw bk lp lq"/></div><div class="hm hn ho hp hq"><h2 id="9a80" class="jg jh ht bd ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd dt translated">第13步—作为订单管理员签署<strong class="ak"><em class="mw">diff _ config _ envelope . Pb</em></strong>(取决于政策)</h2><p id="b483" class="pw-post-body-paragraph ke kf ht kg b kh ki kj kk kl km kn ko jr kp kq kr jv ks kt ku jz kv kw kx ky hm dt translated">在步骤1中，在“访问cli”下，我们的Cli通过环境变量表示Org1中的Peer0。</p><p id="15ae" class="pw-post-body-paragraph ke kf ht kg b kh ld kj kk kl le kn ko jr lg kq kr jv li kt ku jz lk kw kx ky hm dt translated">在第13步中，我们将切换到order org admin来执行签名，因为我们的策略要求order org admin签署此更新事务。</p><blockquote class="la lb lc"><p id="d46e" class="ke kf kz kg b kh ld kj kk kl le kn ko lf lg kq kr lh li kt ku lj lk kw kx ky hm dt translated">有关Hyperledger结构策略的详细信息，请参考“步骤-概述”一节末尾提供的两个链接</p></blockquote><pre class="mk ml mm mn fq mo mj mp mq aw mr dt"><span id="7221" class="jg jh ht mj b fv ms mt l mu mv">export CORE_PEER_ADDRESS=orderer.example.com:7050<br/>export CORE_PEER_LOCALMSPID="OrdererMSP"<br/>export CORE_PEER_TLS_ROOTCERT_FILE=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/ordererOrganizations/example.com/orderers/orderer.example.com/tls/ca.crt<br/>export CORE_PEER_MSPCONFIGPATH=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/ordererOrganizations/example.com/users/Admin\@example.com/msp</span></pre><blockquote class="la lb lc"><p id="524b" class="ke kf kz kg b kh ld kj kk kl le kn ko lf lg kq kr lh li kt ku lj lk kw kx ky hm dt translated">你可以把它们都复制下来，然后粘贴到你的终端上，按下“回车”键。</p><p id="7e67" class="ke kf kz kg b kh ld kj kk kl le kn ko lf lg kq kr lh li kt ku lj lk kw kx ky hm dt translated">有点乱(又)，不好意思那个(又):P :P。</p></blockquote><p id="3317" class="pw-post-body-paragraph ke kf ht kg b kh ld kj kk kl le kn ko jr lg kq kr jv li kt ku jz lk kw kx ky hm dt translated">现在，我们做手语:</p><pre class="mk ml mm mn fq mo mj mp mq aw mr dt"><span id="5848" class="jg jh ht mj b fv ms mt l mu mv">peer channel signconfigtx -f diff_config_envelope.pb</span></pre><blockquote class="la lb lc"><p id="e8ad" class="ke kf kz kg b kh ld kj kk kl le kn ko lf lg kq kr lh li kt ku lj lk kw kx ky hm dt translated">如果你足够细心，应该会观察到diff_config_envelope.pb在签名前的文件大小比签名后的要小。</p><p id="be6d" class="ke kf kz kg b kh ld kj kk kl le kn ko lf lg kq kr lh li kt ku lj lk kw kx ky hm dt translated">而且签多次也没关系，你自己试试吧。</p></blockquote></div><div class="ab cl ll lm hb ln" role="separator"><span class="lo bw bk lp lq lr"/><span class="lo bw bk lp lq lr"/><span class="lo bw bk lp lq"/></div><div class="hm hn ho hp hq"><h2 id="fc4d" class="jg jh ht bd ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd dt translated">步骤14 —发送渠道更新交易</h2><p id="f230" class="pw-post-body-paragraph ke kf ht kg b kh ki kj kk kl km kn ko jr kp kq kr jv ks kt ku jz kv kw kx ky hm dt translated">是时候更新频道了！</p><pre class="mk ml mm mn fq mo mj mp mq aw mr dt"><span id="8996" class="jg jh ht mj b fv ms mt l mu mv">peer channel update -f diff_config_envelope.pb -c $CHANNEL_NAME -o orderer.example.com:7050 --tls --cafile $ORDERER_CA</span></pre><blockquote class="la lb lc"><p id="0a54" class="ke kf kz kg b kh ld kj kk kl le kn ko lf lg kq kr lh li kt ku lj lk kw kx ky hm dt translated">事实上，这个命令也执行签名。我们仍然在步骤13中对其进行签名，因为我想使这些步骤变得清晰，这也是出于教学目的——在某些情况下，当策略需要多个管理员签名时，您可能需要在最终签名者提交渠道更新事务之前多次使用步骤13中的命令。</p></blockquote><p id="117f" class="pw-post-body-paragraph ke kf ht kg b kh ld kj kk kl le kn ko jr lg kq kr jv li kt ku jz lk kw kx ky hm dt translated">好了，我们结束了！</p></div><div class="ab cl ll lm hb ln" role="separator"><span class="lo bw bk lp lq lr"/><span class="lo bw bk lp lq lr"/><span class="lo bw bk lp lq"/></div><div class="hm hn ho hp hq"><h2 id="158f" class="jg jh ht bd ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd dt translated">额外步骤15 —验证渠道更新</h2><p id="c2bc" class="pw-post-body-paragraph ke kf ht kg b kh ki kj kk kl km kn ko jr kp kq kr jv ks kt ku jz kv kw kx ky hm dt translated">我们如何知道我们真的更新了配置？</p><p id="f361" class="pw-post-body-paragraph ke kf ht kg b kh ld kj kk kl le kn ko jr lg kq kr jv li kt ku jz lk kw kx ky hm dt translated">一种可能的方法是再次获取配置块，并将其转换为JSON文件。最后，我们检查<strong class="kg hu"><em class="kz">max _ message _ count</em></strong>是否为11。</p><pre class="mk ml mm mn fq mo mj mp mq aw mr dt"><span id="dcbe" class="jg jh ht mj b fv ms mt l mu mv">peer channel fetch config config_block2.pb -o orderer.example.com:7050 -c $CHANNEL_NAME --tls --cafile $ORDERER_CA</span><span id="a10a" class="jg jh ht mj b fv mz mt l mu mv">configtxlator proto_decode --input config_block2.pb --type common.Block | jq .data.data[0].payload.data.config &gt; config2.json</span><span id="8059" class="jg jh ht mj b fv mz mt l mu mv">vim config2.json</span></pre><p id="9549" class="pw-post-body-paragraph ke kf ht kg b kh ld kj kk kl le kn ko jr lg kq kr jv li kt ku jz lk kw kx ky hm dt translated">接下来，我不提供进一步的步骤来验证，让我们自己尝试一下作为练习。</p></div><div class="ab cl ll lm hb ln" role="separator"><span class="lo bw bk lp lq lr"/><span class="lo bw bk lp lq lr"/><span class="lo bw bk lp lq"/></div><div class="hm hn ho hp hq"><p id="a567" class="pw-post-body-paragraph ke kf ht kg b kh ld kj kk kl le kn ko jr lg kq kr jv li kt ku jz lk kw kx ky hm dt translated"><strong class="kg hu">谢谢！如果你喜欢我的故事，</strong> <a class="ae jf" rel="noopener" href="/@reasdom"> <strong class="kg hu">请关注我</strong> </a> <strong class="kg hu">的新更新！</strong></p></div><div class="ab cl ll lm hb ln" role="separator"><span class="lo bw bk lp lq lr"/><span class="lo bw bk lp lq lr"/><span class="lo bw bk lp lq"/></div><div class="hm hn ho hp hq"><h2 id="b069" class="jg jh ht bd ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd dt translated">参考</h2><div class="na nb fm fo nc nd"><a href="https://hyperledger-fabric.readthedocs.io/en/release-1.4/build_network.html" rel="noopener  ugc nofollow" target="_blank"><div class="ne ab ej"><div class="nf ab ng cl cj nh"><h2 class="bd hu fv z el ni eo ep nj er et hs dt translated">构建您的第一个网络- hyperledger-fabricdocs主文档</h2><div class="nk l"><h3 class="bd b fv z el ni eo ep nj er et ek translated">编辑描述</h3></div><div class="nl l"><p class="bd b gc z el ni eo ep nj er et ek translated">hyperledger-fabric . readthedocs . io</p></div></div><div class="nm l"><div class="nn l no np nq nm nr iz nd"/></div></div></a></div><div class="na nb fm fo nc nd"><a href="https://hyperledger-fabric.readthedocs.io/en/release-1.4/channel_update_tutorial.html" rel="noopener  ugc nofollow" target="_blank"><div class="ne ab ej"><div class="nf ab ng cl cj nh"><h2 class="bd hu fv z el ni eo ep nj er et hs dt translated">将组织添加到渠道- hyperledger-fabricdocs主文档</h2><div class="nk l"><h3 class="bd b fv z el ni eo ep nj er et ek translated">确保您已经下载了安装示例、二进制文件和Docker…中概述的适当的映像和二进制文件</h3></div><div class="nl l"><p class="bd b gc z el ni eo ep nj er et ek translated">hyperledger-fabric . readthedocs . io</p></div></div><div class="nm l"><div class="ns l no np nq nm nr iz nd"/></div></div></a></div><figure class="mk ml mm mn fq iu fe ff paragraph-image"><a href="http://bit.ly/2G71Sp7"><div class="fe ff nt"><img src="../Images/449450761cd76f44f9ae574333f9e9af.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fKX2mtg7p1lOs7JmosPLsA.png"/></div></a></figure></div></div>    
</body>
</html>