<html>
<head>
<title>3 Things I Learned This Week Using Solidity, Truffle, and Web3</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">本周我从坚固、松露和网络中学到的3件事</h1>
<blockquote>原文：<a href="https://medium.com/coinmonks/3-things-i-learned-this-week-using-solidity-truffle-and-web3-a911c3adc730?source=collection_archive---------1-----------------------#2017-06-25">https://medium.com/coinmonks/3-things-i-learned-this-week-using-solidity-truffle-and-web3-a911c3adc730?source=collection_archive---------1-----------------------#2017-06-25</a></blockquote><div><div class="ef hh hi hj hk hl"/><div class="hm hn ho hp hq"><div class=""/><figure class="fi fk ir is it iu fe ff paragraph-image"><div role="button" tabindex="0" class="iv iw di ix bf iy"><div class="fe ff iq"><img src="../Images/0dfe7962fe6105d904e2e99a076b6549.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BSKueLKvOJrr0U2DH_J3AA.jpeg"/></div></div><figcaption class="jb jc fg fe ff jd je bd b be z ek">Eye-candy so you’ll like my article ❤</figcaption></figure><p id="cf38" class="pw-post-body-paragraph jf jg ht jh b ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc hm dt translated">当我开始开发时，很难找到简单问题的答案。在这里，我列出了我的问题和它们的答案。</p><p id="a8cc" class="pw-post-body-paragraph jf jg ht jh b ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc hm dt translated">在本文中，我将回答这些问题:</p><ol class=""><li id="8499" class="ke kf ht jh b ji jj jm jn jq kg ju kh jy ki kc kj kk kl km dt translated">如何向智能合同功能发送以太网？</li><li id="54e5" class="ke kf ht jh b ji kn jm ko jq kp ju kq jy kr kc kj kk kl km dt translated">我如何生成一个随机数？</li><li id="bbe3" class="ke kf ht jh b ji kn jm ko jq kp ju kq jy kr kc kj kk kl km dt translated">如何在智能合约中记录事件，然后在事件发生时读取它们？</li></ol><blockquote class="ks"><p id="fab8" class="kt ku ht bd kv kw kx ky kz la lb kc ek translated"><a class="ae lc" href="https://coincodecap.com/?utm_source=coinmonks" rel="noopener ugc nofollow" target="_blank">在您的收件箱中直接获得最佳软件交易</a></p></blockquote><figure class="le lf lg lh li iu fe ff paragraph-image"><a href="https://coincodecap.com/?utm_source=coinmonks"><div class="fe ff ld"><img src="../Images/7c0b3dfdcbfea594cc0ae7d4f9bf6fcb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1168/format:webp/0*OJ-qb5G6i863msBB.png"/></div></a></figure><p id="ea46" class="pw-post-body-paragraph jf jg ht jh b ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc hm dt translated">智能合同功能？</p><p id="3c21" class="pw-post-body-paragraph jf jg ht jh b ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc hm dt translated">有一些关于向智能合约发送以太网的非常好的文档，但它已经经历了一些迭代。此外，如何向合约交付资金取决于您使用的媒介。</p><p id="1d49" class="pw-post-body-paragraph jf jg ht jh b ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc hm dt translated">如果你试图通过另一个智能合约将以太发送到一个智能合约，在<a class="ae lc" href="https://ethereum.stackexchange.com/questions/2876/how-does-one-contract-send-ether-to-another-contract-with-more-than-2300-gas" rel="noopener ugc nofollow" target="_blank">以太坊栈交易所有一篇关于这个过程的很好的文章，日期是2016年8月22日。</a></p><p id="22d5" class="pw-post-body-paragraph jf jg ht jh b ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc hm dt translated">如果你试图通过web3或Truffle控制台发送以太网，我是这样做的:</p><p id="3977" class="pw-post-body-paragraph jf jg ht jh b ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc hm dt translated">首先，您的智能合约必须包含一个<em class="kd">应付款</em>函数。</p><p id="6507" class="pw-post-body-paragraph jf jg ht jh b ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc hm dt translated">这是一个构造函数的示例，您可以在其中用Ether初始化智能协定:</p><pre class="lj lk ll lm fq ln lo lp lq aw lr dt"><span id="cb2f" class="ls lt ht lo b fv lu lv l lw lx">Solidity: function Contract() payable { }</span></pre><p id="4157" class="pw-post-body-paragraph jf jg ht jh b ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc hm dt translated">以下是智能合同中一些可支付功能的示例:</p><pre class="lj lk ll lm fq ln lo lp lq aw lr dt"><span id="a0fc" class="ls lt ht lo b fv lu lv l lw lx">Solidity:</span><span id="6470" class="ls lt ht lo b fv ly lv l lw lx">function payableFunction() payable { }</span><span id="8ca8" class="ls lt ht lo b fv ly lv l lw lx">function payableFunction(uint randomVal) payable returns (bool) { }</span></pre><p id="0d28" class="pw-post-body-paragraph jf jg ht jh b ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc hm dt translated">以下是如何从web3或Truffle控制台调用这些函数:</p><pre class="lj lk ll lm fq ln lo lp lq aw lr dt"><span id="aea2" class="ls lt ht lo b fv lu lv l lw lx">truffle(development)&gt; contract.payableFunction({from: address, value: etherAmount})</span><span id="e0cf" class="ls lt ht lo b fv ly lv l lw lx">truffle(development)&gt; contract.payableFunction(randomVal, {from: address, value: etherAmount})</span></pre><p id="b65e" class="pw-post-body-paragraph jf jg ht jh b ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc hm dt translated">难住我的是我如何调用函数来发送Ether <em class="kd">和</em>给它一个任意值。原来您首先传递您的函数参数，然后是一个包含您的<em class="kd"> from </em>和<em class="kd"> value </em>变量的字典(它们映射到Solidity中的msg.sender和msg.value)。</p></div><div class="ab cl lz ma hb mb" role="separator"><span class="mc bw bk md me mf"/><span class="mc bw bk md me mf"/><span class="mc bw bk md me"/></div><div class="hm hn ho hp hq"><h1 id="5e2d" class="mg lt ht bd mh mi mj mk ml mm mn mo mp mq mr ms mt mu mv mw mx my mz na nb nc dt translated">如何在智能合约中生成随机数？</h1><p id="c6d8" class="pw-post-body-paragraph jf jg ht jh b ji nd jk jl jm ne jo jp jq nf js jt ju ng jw jx jy nh ka kb kc hm dt translated">由于区块链是确定性的，随机数实际上是不可能产生的。在大多数赌博合同中实施的产业实力解决方案(其中大量资金依赖于RNG)通常依赖于基于预言或票证的解决方案，其中多个玩家提交散列，然后对所有提交进行散列，然后显示强伪随机生成的数字。</p><p id="bfab" class="pw-post-body-paragraph jf jg ht jh b ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc hm dt translated">我个人走的是简单的一条直线路线，至少在我的应用程序发展到可以处理更多以太网之前是这样:</p><pre class="lj lk ll lm fq ln lo lp lq aw lr dt"><span id="319d" class="ls lt ht lo b fv lu lv l lw lx">Solidity: </span><span id="f135" class="ls lt ht lo b fv ly lv l lw lx">// Generate a random number from 1-MAX_VALUE (MAX_VALUE is set <br/>// arbitrarily by the developer). </span><span id="5de9" class="ls lt ht lo b fv ly lv l lw lx">uint random_number = uint(block.blockhash(block.number-1))% MAX_VALUE + 1;</span></pre></div><div class="ab cl lz ma hb mb" role="separator"><span class="mc bw bk md me mf"/><span class="mc bw bk md me mf"/><span class="mc bw bk md me"/></div><div class="hm hn ho hp hq"><h1 id="a29b" class="mg lt ht bd mh mi mj mk ml mm mn mo mp mq mr ms mt mu mv mw mx my mz na nb nc dt translated">我如何处理智能合约中的事件？</h1><p id="6dcd" class="pw-post-body-paragraph jf jg ht jh b ji nd jk jl jm ne jo jp jq nf js jt ju ng jw jx jy nh ka kb kc hm dt translated">事件是以太坊开发中一个众所周知的棘手、复杂的主题。我想出了如何处理一个错误条件，并以下面的方式记录一个事件。</p><p id="00a5" class="pw-post-body-paragraph jf jg ht jh b ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc hm dt translated">首先，在您的Solidity smart合同中定义一个事件:</p><pre class="lj lk ll lm fq ln lo lp lq aw lr dt"><span id="9e98" class="ls lt ht lo b fv lu lv l lw lx">event Error(address indexed _sender, bytes32 error);</span></pre><p id="612a" class="pw-post-body-paragraph jf jg ht jh b ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc hm dt translated"><em class="kd">索引</em>关键字很重要，因为这是我们通过调用合同函数的帐户来跟踪事件的方式。</p><p id="d0c2" class="pw-post-body-paragraph jf jg ht jh b ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc hm dt translated">以下是在合同函数中调用事件的方式:</p><pre class="lj lk ll lm fq ln lo lp lq aw lr dt"><span id="2ac6" class="ls lt ht lo b fv lu lv l lw lx">Error(msg.sender, "ERROR_DETAILS_HERE");</span></pre><p id="6ee6" class="pw-post-body-paragraph jf jg ht jh b ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc hm dt translated">下面是我们如何在Truffle控制台中使用web3来跟踪事件:</p><pre class="lj lk ll lm fq ln lo lp lq aw lr dt"><span id="377c" class="ls lt ht lo b fv lu lv l lw lx">truffle(development)&gt; var errorEvent = contract.Error({_sender: web3.eth.coinbase})</span><span id="248d" class="ls lt ht lo b fv ly lv l lw lx">truffle(development)&gt; errorEvent.watch(function(err, result){ console.log(result.args) })</span></pre><p id="7884" class="pw-post-body-paragraph jf jg ht jh b ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc hm dt translated">然后，当我们调用函数并引发一个事件时，我们的观察器可以获取它、读取它并做出相应的响应。</p><p id="41d8" class="pw-post-body-paragraph jf jg ht jh b ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc hm dt translated">希望这有所帮助！我正在整理一篇关于开发的更全面的文章，但是将会发布我在这个过程中学到的东西。</p><h2 id="fbb0" class="ls lt ht bd mh ni nj nk ml nl nm nn mp jq no np mt ju nq nr mx jy ns nt nb nu dt translated">如果你喜欢这篇文章，请推荐并分享给你的朋友！</h2><h2 id="98fb" class="ls lt ht bd mh ni nj nk ml nl nm nn mp jq no np mt ju nq nr mx jy ns nt nb nu dt translated">在Twitter上联系我:@ <a class="ae lc" href="http://www.twitter.com/valkn0t" rel="noopener ugc nofollow" target="_blank"> valkn0t </a></h2><figure class="lj lk ll lm fq iu fe ff paragraph-image"><a href="http://bit.ly/2G71Sp7"><div class="fe ff nv"><img src="../Images/449450761cd76f44f9ae574333f9e9af.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fKX2mtg7p1lOs7JmosPLsA.png"/></div></a></figure></div></div>    
</body>
</html>