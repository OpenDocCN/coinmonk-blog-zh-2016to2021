<html>
<head>
<title>Link your Amazon Alexa Skill with a Google API within 5 minutes</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在5分钟内将你的亚马逊Alexa技能与谷歌API联系起来</h1>
<blockquote>原文：<a href="https://medium.com/coinmonks/link-your-amazon-alexa-skill-with-a-google-api-within-5-minutes-7e488dc43168?source=collection_archive---------0-----------------------#2018-06-11">https://medium.com/coinmonks/link-your-amazon-alexa-skill-with-a-google-api-within-5-minutes-7e488dc43168?source=collection_archive---------0-----------------------#2018-06-11</a></blockquote><div><div class="ef hh hi hj hk hl"/><div class="hm hn ho hp hq"><div class=""/><figure class="fi fk ir is it iu fe ff paragraph-image"><div role="button" tabindex="0" class="iv iw di ix bf iy"><div class="fe ff iq"><img src="../Images/a0cae3bea2a64ecbc2bd9d277e617809.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*Nu0Lt7lJpz1cAf9G"/></div></div></figure><p id="43c9" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">亚马逊Alexa一直是好奇的开发者社区的吸引力中心，他们一直在尝试为Alexa开发技能。但是，当涉及到将他们的Alexa技能与谷歌API集成时，人们一直面临着问题。我不知道谷歌在Alexa的搜索查询上有什么，它们已经被重定向到谷歌的主页。本文只是试图帮助您成功集成Google API。在本文中，我使用了Google Sheets API v4。我们开始吧！</p><p id="33ab" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">我假设你已经设置好了你的技能发展环境。如果您还没有配置自己的，那么请阅读这篇文章，以获得技能和lambda函数(如果您正在使用的话)集成方面的帮助，并按照这篇教程学习在NodeJS中为Lambda函数编码。您可能需要帮助来完成教程中的这个小变化，并且您已经准备好了。在教程中，他们试图像这样调用一个函数。AskQuestion 将返回一个未定义的输出。这可以通过将<em class="jz"> AskQuestion </em>函数重写为:</p><pre class="ka kb kc kd fq ke kf kg kh aw ki dt"><span id="818f" class="kj kk ht kf b fv kl km l kn ko">function <strong class="kf hu">AskQuestion(attributes)</strong> {<br/>    var language = attributes.language;<br/>    var currentQuestion = flashcardsDictionary[attributes.currentFlashcardIndex].question;<br/>    return "In "+ language+" "+ currentQuestion;<br/>}</span></pre><p id="2ad1" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">然后把这个问题叫做，</p><pre class="ka kb kc kd fq ke kf kg kh aw ki dt"><span id="1699" class="kj kk ht kf b fv kl km l kn ko">if (this.attributes.currentFlashcardIndex &lt; DECK_LENGTH) {<br/>  message += "Here is your next question. " + <strong class="kf hu">AskQuestion(this.attributes)</strong>;<br/>  this.response.speak(message).listen(<strong class="kf hu">AskQuestion(this.attributes)</strong>);<br/>}</span></pre><p id="9614" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">现在，你知道了如何编写Lambda函数，并且已经掌握了基本技能。我们现在需要理解OAuth2框架是如何工作的。OAuth2是一个容易理解的架构。基本上有一个客户端(您的技能)、一个资源所有者(用户)、一个资源服务器(Google Sheets)和一个认证服务器(Google OAuth)。下图可能会让您更好地理解该框架。</p><figure class="ka kb kc kd fq iu fe ff paragraph-image"><div class="fe ff kp"><img src="../Images/196cacc39e2a713d84c542fd750247d5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1122/format:webp/1*fyfmxv1QjNyo9uan1YZroQ.png"/></div></figure><p id="b2de" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">请看这个图，授权请求是一个登录页面，它授权用户的凭证并返回一个授权代码。进而当应用程序将授权码发送到授权服务器时，授权服务器返回刷新/访问令牌对。这个访问令牌与资源请求一起被发送到资源服务器，在那里它被验证，并且适当的响应被发送到客户机。默认情况下，此访问令牌的生命周期为一小时，因此当访问令牌到期时，将发送刷新令牌以获取新的访问令牌，请求-响应过程将继续。为了更好地理解OAuth2框架<a class="ae kq" href="https://developers.google.com/oauthplayground/" rel="noopener ugc nofollow" target="_blank">请访问</a>谷歌的OAuth2游乐场。这个网站可以用来调试常见的请求响应问题，就像我们在使用类似邮递员的软件建立网站时所做的那样。</p><p id="d83a" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">理解了OAuth2框架的工作原理之后，我们现在可以在Google的API控制台中注册一个API了。请按照下面的步骤操作。</p><p id="a9b1" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated"><em class="jz">步骤1 </em>:使用该向导注册您的项目，或者如果您已经创建了一个项目，则选择一个项目。单击继续并转到凭据。</p><p id="aee4" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated"><em class="jz">第二步</em>:在<strong class="jd hu">添加项目证书</strong>页面，点击<strong class="jd hu">取消</strong>按钮。</p><p id="85df" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated"><em class="jz">步骤3 </em>:在页面顶部，选择<strong class="jd hu"> OAuth同意屏幕</strong>选项卡。选择一个<strong class="jd hu">电子邮件地址</strong>，输入一个<strong class="jd hu">产品名称</strong>(如果尚未设置)，点击<strong class="jd hu">保存</strong>按钮。</p><p id="097d" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated"><em class="jz">第四步</em>:选择<strong class="jd hu">凭证</strong>页签，点击<strong class="jd hu">创建凭证</strong>按钮，选择<strong class="jd hu"> OAuth客户端ID </strong>。</p><p id="08f8" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated"><em class="jz">步骤5: </em>选择应用类型Web应用，点击<strong class="jd hu">创建</strong>按钮。</p><p id="9653" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated"><em class="jz">第六步</em>:点击<strong class="jd hu">确定</strong>关闭弹出的对话框。</p><p id="ba7b" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated"><em class="jz">步骤7 </em>:点击客户端ID右侧的下载图标(下载JSON)按钮。将该文件另存为client_credentials.json。</p><p id="d399" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">现在你需要按照下面的步骤将你的谷歌API和你的Alexa技能联系起来。</p><p id="2d1a" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated"><em class="jz">第一步</em>:回到你的Alexa技能开发控制台，点击屏幕左下方的账户链接选项。这将打开一个表单。</p><p id="a765" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated"><em class="jz">第2步</em>:打开账户链接，选择授权码授权类型。使用您下载的client_credentials.json文件中的凭据填写表单。(将客户端身份验证方案设置为推荐的HTTP Basic)。</p><p id="1393" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated"><em class="jz">第三步</em>:进入谷歌应用编程接口浏览器，或者直接进入谷歌应用编程接口浏览器，选择你的Alexa技能需要使用的应用编程接口，然后使用OAuth2.0打开一个对话框，要求检查一些范围。检查所需的并复制相同的内容。</p><p id="184e" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated"><em class="jz">步骤4 </em>:回到你的Alexa技能开发控制台，粘贴示波器。以相同的形式从下面复制重定向URL。</p><p id="3e3e" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated"><em class="jz">第五步</em>:返回谷歌开发者控制台。单击左侧导航列中的凭据，然后单击您的OAuth2.0客户端，逐个粘贴重定向URL，然后单击保存。</p><figure class="ka kb kc kd fq iu fe ff paragraph-image"><div role="button" tabindex="0" class="iv iw di ix bf iy"><div class="fe ff kr"><img src="../Images/4f6f9d344a6b354988418c4727821a77.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DzjD9N7EvQBq9QVcHXc_qA.png"/></div></div></figure><p id="10ea" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">之后，你可以在手机上使用亚马逊Alexa应用程序测试账户链接。如果您收到成功消息，则帐户链接设置成功。继续从开发控制台测试你的alexa技能，尝试说任何话。如果帐户链接工作正常，你将能够看到JSON alexa技能请求中传递的accessToken。你可以在“userId”下面的相邻图片中看到这一点。</p><p id="437c" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated"><strong class="jd hu"> <em class="jz">注</em></strong>——如果请求中没有传递accessToken，尝试从app中禁用启用你的技能。如果不行就告诉我。</p><p id="9ed4" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">如果您已经到达这里，您已经成功地启用了与您的Alexa技能的帐户链接。现在您需要在Lambda函数中处理技能请求内的accessToken。Alexa做得最好的事情是用OAuth2.0处理涉及访问令牌、刷新令牌和授权码的内部业务。您只需要处理与API请求一起发送的访问令牌，以便从资源服务器获取数据。</p><p id="2646" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">在您的技能的Lambda代码中，每当您需要从资源服务器请求数据时，请转到该特定意图并从技能请求中获取访问令牌，</p><figure class="ka kb kc kd fq iu fe ff paragraph-image"><div class="fe ff ks"><img src="../Images/17d885122f46c7cd8ded28022b5b3316.png" data-original-src="https://miro.medium.com/v2/resize:fit:1264/format:webp/1*a60UWBofsCfhh_ExmT1Czw.png"/></div></figure><p id="3415" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">跟随alexa技能请求中的访问令牌的目录。该访问令牌随后与API请求报头一起发送，</p><figure class="ka kb kc kd fq iu fe ff paragraph-image"><div role="button" tabindex="0" class="iv iw di ix bf iy"><div class="fe ff kt"><img src="../Images/a84222e6b045381a541cf39d755b2704.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DG6MCf_i7ZXa71Z48wcfig.png"/></div></div></figure><p id="724c" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">请注意，URL应该遵循文档和参考资料中给出的格式。这里，URL遵循Google Sheets API格式，从用户Google帐户的电子表格中获取一系列值。你可以随时使用Google OAuth2.0 playground查看响应格式。这将有助于您构建对Alexa技能的回应。</p><p id="c9af" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">让我知道问题和疑问。谢谢你。</p></div></div>    
</body>
</html>