<html>
<head>
<title>Raspberry Pi 3 — Shell Scripting — Door Monitor (an IoT Device)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Raspberry Pi 3 —外壳脚本—门监控器(物联网设备)</h1>
<blockquote>原文：<a href="https://medium.com/coinmonks/raspberry-pi-3-model-b-shell-scripting-door-monitor-b44944f82d87?source=collection_archive---------1-----------------------#2018-06-18">https://medium.com/coinmonks/raspberry-pi-3-model-b-shell-scripting-door-monitor-b44944f82d87?source=collection_archive---------1-----------------------#2018-06-18</a></blockquote><div><div class="ef hh hi hj hk hl"/><div class="hm hn ho hp hq"><div class=""/><p id="7d47" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">我最近在做一个有趣的项目，我们在本地安装了不同的硬件和服务器。为了安全起见，我安装了一个门监控系统来跟踪房间里的每个入口。</p><p id="6827" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">尽管有一些门监控设备、服务和小工具我可以在网上购买，但我决定利用我电子和编程背景，用Raspberry Pi从头开始构建一个。</p><figure class="jp jq jr js fq jt fe ff paragraph-image"><div role="button" tabindex="0" class="ju jv di jw bf jx"><div class="fe ff jo"><img src="../Images/52f4aeea9e3ae3f43e78ed443cd9c471.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*A_I9CHNsFv1EMX2LL1lQ8g.png"/></div></div><figcaption class="ka kb fg fe ff kc kd bd b be z ek"><strong class="bd ke">Raspberry Pi 3 Model B</strong></figcaption></figure><p id="94b9" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">因此，我将分享我在使用Raspberry Pi 3 Model B、迷你试验板、磁性开关门传感器、端子板、3米钟形线、2个电阻(10K和1K)和3条到Pi的IDC连接线构建全功能门监控器时遇到的一些问题以及我如何解决这些问题。所有这些套件都可以在亚马逊网上购买。</p><figure class="jp jq jr js fq jt fe ff paragraph-image"><div role="button" tabindex="0" class="ju jv di jw bf jx"><div class="fe ff kf"><img src="../Images/3d27f48d80248498675faf337fabb455.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nuYR1fgQPV_E50KEqEahSw.jpeg"/></div></div><figcaption class="ka kb fg fe ff kc kd bd b be z ek">connection diagram — photo credit: Tim Rustige</figcaption></figure><p id="0ba0" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">完成所有连接后，下一步是编码，创建一个脚本来监控门的状态并发送通知。我在我的项目中使用了shell脚本。脚本也可以用python编写。</p><figure class="jp jq jr js fq jt fe ff paragraph-image"><div role="button" tabindex="0" class="ju jv di jw bf jx"><div class="fe ff kg"><img src="../Images/1b44c581453182a88f07a0d3a6b990f2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*OKc_T5yX1UEysIF8a7OsKw.jpeg"/></div></div><figcaption class="ka kb fg fe ff kc kd bd b be z ek"><strong class="bd ke">IoT Device</strong></figcaption></figure><p id="23c9" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">上图我的Pi是通过电池组扩展板电源连接供电的。这种做法解决了断电故障，并在断电的情况下保持Pi运行，这允许我们在Pi无法发送电子邮件通知时检查门状态日志文件。</p><figure class="jp jq jr js fq jt fe ff paragraph-image"><div class="fe ff kh"><img src="../Images/7078d5654bdbea8c4d44390e5139da30.png" data-original-src="https://miro.medium.com/v2/resize:fit:464/format:webp/1*edyQyS5t7JsfuYlX5ytDNg.jpeg"/></div><figcaption class="ka kb fg fe ff kc kd bd b be z ek"><strong class="bd ke">Door Sensors</strong></figcaption></figure><p id="51c2" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">磁性开关门传感器应安装在要监控的门上。</p></div><div class="ab cl ki kj hb kk" role="separator"><span class="kl bw bk km kn ko"/><span class="kl bw bk km kn ko"/><span class="kl bw bk km kn"/></div><div class="hm hn ho hp hq"><h2 id="e05b" class="kp kq ht bd kr ks kt ku kv kw kx ky kz jb la lb lc jf ld le lf jj lg lh li lj dt translated">什么是剧本？“用简单的英语”</h2><p id="309b" class="pw-post-body-paragraph iq ir ht is b it lk iv iw ix ll iz ja jb lm jd je jf ln jh ji jj lo jl jm jn hm dt translated">计算机是严格的逻辑机器，毫无常识。这意味着如果我们想让他们做些什么，我们必须为他们提供详细的、一步一步的指示，告诉他们到底该怎么做。这就是剧本。按特定顺序完成的步骤列表，如果我们正在做一些非常基本的事情，比如简单的数学方程，这就足够简单了，但是当我们运行更复杂的运算时，就变得困难多了。</p><blockquote class="lp lq lr"><p id="44d9" class="iq ir ls is b it iu iv iw ix iy iz ja lt jc jd je lu jg jh ji lv jk jl jm jn hm dt translated"><strong class="is hu">如何制作可执行的shell脚本</strong></p></blockquote><p id="d6f5" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">在这一点上，我假设您已经完成了所有必要的连接，并且已经在Raspbian OS的最新版本上为Raspberry Pi设置并运行了您的Pi。</p><p id="f9bb" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">打开终端，键入以下命令:</p><pre class="jp jq jr js fq lw lx ly lz aw ma dt"><span id="e114" class="kp kq ht lx b fv mb mc l md me">nano test.sh</span></pre><p id="3dbf" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">这将打开nano，一个基本的文本编辑器，并允许您输入一系列命令，以便在执行脚本时执行，从而形成脚本的基础。让我们编写一个脚本，在执行时显示一条消息。在test.sh上输入以下内容:</p><pre class="jp jq jr js fq lw lx ly lz aw ma dt"><span id="0380" class="kp kq ht lx b fv mb mc l md me">echo "Hello! this is a test script"</span></pre><p id="44e2" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">然后保存文件并退出。如果您不熟悉nano:</p><blockquote class="lp lq lr"><p id="1aa0" class="iq ir ls is b it iu iv iw ix iy iz ja lt jc jd je lu jg jh ji lv jk jl jm jn hm dt translated">要保存您所做的更改，请按Ctrl + O。要退出nano，请按Ctrl + X。如果您要求nano退出已修改的文件，它会询问您是否要保存它。如果不知道就按N，如果知道就按Y。然后它会要求你输入文件名。只要输入它，或者如果你已经有一个文件，比如test.sh。只要按下回车键。</p><p id="23e2" class="iq ir ls is b it iu iv iw ix iy iz ja lt jc jd je lu jg jh ji lv jk jl jm jn hm dt translated">如果您意外地确认了想要保存文件，但实际上并没有，那么当系统提示您输入文件名时，您总是可以通过按Ctrl + C来取消。</p></blockquote><p id="5f94" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">要使<em class="ls"> test.sh </em>可执行类型:</p><pre class="jp jq jr js fq lw lx ly lz aw ma dt"><span id="66f6" class="kp kq ht lx b fv mb mc l md me">chmod u+x test.sh</span></pre><p id="5ddd" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">然后运行脚本:</p><pre class="jp jq jr js fq lw lx ly lz aw ma dt"><span id="4ba8" class="kp kq ht lx b fv mb mc l md me">sudo ./test.sh</span></pre><p id="5532" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">以下是我在项目中使用的door motored shell脚本。当门打开或关闭时，它会发送一封电子邮件，并将门的状态写入日志文件，以便在互联网连接中断或断电时进行检查。</p><figure class="jp jq jr js fq jt"><div class="bz el l di"><div class="mf mg l"/></div><figcaption class="ka kb fg fe ff kc kd bd b be z ek">doorStatus.sh</figcaption></figure><p id="55a3" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">如果您正在处理一个类似的项目，并且想要使用这个脚本，您可以简单地创建一个shell文件，复制并粘贴上面的代码，使这个脚本可执行，并在您的Pi上运行它。</p><p id="4950" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">在运行脚本之前，您需要将Pi连接到互联网，拥有或创建一个Gmail帐户(使用您的PC ),该帐户将用于从Pi发送电子邮件通知，并从互联网安装配置几个邮件应用程序。</p><p id="0008" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">安装以下软件包:</p><pre class="jp jq jr js fq lw lx ly lz aw ma dt"><span id="4b47" class="kp kq ht lx b fv mb mc l md me">sudo apt-get install ssmtp</span><span id="96b2" class="kp kq ht lx b fv mh mc l md me">sudo apt-get install mailutils</span><span id="2cf1" class="kp kq ht lx b fv mh mc l md me">sudo apt-get install mpack</span></pre><p id="deb1" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">设置默认设置SSMTP，以便Pi可以发送电子邮件。打开ssmtp.config文件:</p><pre class="jp jq jr js fq lw lx ly lz aw ma dt"><span id="c94c" class="kp kq ht lx b fv mb mc l md me">sudo nano /etc/ssmtp/ssmtp.conf</span></pre><p id="ca2b" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">下面是我如何配置我的ssmtp.config文件:</p><figure class="jp jq jr js fq jt"><div class="bz el l di"><div class="mf mg l"/></div><figcaption class="ka kb fg fe ff kc kd bd b be z ek">ssmtp.config file</figcaption></figure><p id="87ff" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">保存文件并退出。</p><p id="a4a5" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">确保Pi已连接到互联网。使用此命令发送一封测试电子邮件，将下面的电子邮件地址替换为您自己的电子邮件地址:</p><pre class="jp jq jr js fq lw lx ly lz aw ma dt"><span id="a8a9" class="kp kq ht lx b fv mb mc l md me">echo “This is a test email” | mail -s “Subject” example2@gmail.com</span></pre><p id="6e8a" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">假设一切正常，现在可以运行您的脚本了。</p><pre class="jp jq jr js fq lw lx ly lz aw ma dt"><span id="e5c6" class="kp kq ht lx b fv mb mc l md me">sudo ./yourDoorScript.sh</span></pre><p id="e9ab" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">假设所有的硬件连接都是正确的，脚本也写得很好。每次开门时，都会向脚本中指定的电子邮件地址发送一封电子邮件通知。</p></div><div class="ab cl ki kj hb kk" role="separator"><span class="kl bw bk km kn ko"/><span class="kl bw bk km kn ko"/><span class="kl bw bk km kn"/></div><div class="hm hn ho hp hq"><h1 id="511c" class="mi kq ht bd kr mj mk ml kv mm mn mo kz mp mq mr lc ms mt mu lf mv mw mx li my dt translated">树莓pi 3提示</h1><p id="fbe4" class="pw-post-body-paragraph iq ir ht is b it lk iv iw ix ll iz ja jb lm jd je jf ln jh ji jj lo jl jm jn hm dt translated">以下是一些关于设置Pi的提示。</p><blockquote class="lp lq lr"><p id="0c72" class="iq ir ls is b it iu iv iw ix iy iz ja lt jc jd je lu jg jh ji lv jk jl jm jn hm dt translated"><strong class="is hu">检查脚本状态/检测脚本崩溃</strong></p></blockquote><p id="765c" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">门监视器脚本旨在连续运行(无限循环运行),检查门的状态并在门打开时发送通知。我创建了另一个名为scriptStatus.sh的脚本，它检查door monitor脚本是否运行良好，如果它由于某种原因崩溃了，就重新启动它。</p><figure class="jp jq jr js fq jt"><div class="bz el l di"><div class="mf mg l"/></div></figure><blockquote class="lp lq lr"><p id="72f9" class="iq ir ls is b it iu iv iw ix iy iz ja lt jc jd je lu jg jh ji lv jk jl jm jn hm dt translated"><strong class="is hu">启动时如何在RPi3上运行脚本或程序</strong></p></blockquote><p id="94de" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">它们是在Raspberry Pi上引导时运行程序或脚本的五种可用方式或方法:</p><ul class=""><li id="3c3b" class="mz na ht is b it iu ix iy jb nb jf nc jj nd jn ne nf ng nh dt translated">rc .本地</li><li id="e43a" class="mz na ht is b it ni ix nj jb nk jf nl jj nm jn ne nf ng nh dt translated">。bashrc</li><li id="44bb" class="mz na ht is b it ni ix nj jb nk jf nl jj nm jn ne nf ng nh dt translated">初始标签</li><li id="2125" class="mz na ht is b it ni ix nj jb nk jf nl jj nm jn ne nf ng nh dt translated">系统d</li><li id="ac2b" class="mz na ht is b it ni ix nj jb nk jf nl jj nm jn ne nf ng nh dt translated">crontab</li></ul><p id="6bc7" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">在本文中，我将探索<strong class="is hu"> rc.local </strong>方法。如果Pi不打算连接到显示器，您希望在无头模式下启动Pi，并让它在没有配置或手动启动的情况下运行程序，此方法特别有用。</p><p id="349c" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">为了在Pi启动时运行命令或程序，编辑/etc/rc.local文件，并将命令添加到<strong class="is hu"> rc.local </strong>文件中。我在这篇文章中使用的是nano，你可以使用自己选择的编辑器。</p><pre class="jp jq jr js fq lw lx ly lz aw ma dt"><span id="b850" class="kp kq ht lx b fv mb mc l md me">sudo nano /etc/rc.local</span></pre><p id="33a0" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">使用完整的文件路径或文件位置的绝对引用<em class="ls">添加命令以运行shell脚本。确保行<strong class="is hu">出口0 </strong>在末尾，然后保存文件并退出。</em></p><blockquote class="lp lq lr"><p id="a55e" class="iq ir ls is b it iu iv iw ix iy iz ja lt jc jd je lu jg jh ji lv jk jl jm jn hm dt translated"><strong class="is hu">提示</strong></p></blockquote><ul class=""><li id="13c4" class="mz na ht is b it iu ix iy jb nb jf nc jj nd jn ne nf ng nh dt translated">确保引用绝对文件名，而不是相对于您的个人文件夹。例如，使用“/home/pi/Desktop/myScript.sh”而不是“myScript.sh”。</li><li id="415d" class="mz na ht is b it ni ix nj jb nk jf nl jj nm jn ne nf ng nh dt translated">如果您的命令连续运行(可能运行无限循环)或者可能不会退出，您必须确保通过在命令末尾添加一个&amp;符号来分叉该进程，如下所示:</li></ul><pre class="jp jq jr js fq lw lx ly lz aw ma dt"><span id="de01" class="kp kq ht lx b fv mb mc l md me">sudo /home/pi/Desktop/myScript.sh &amp;</span></pre><p id="ce6b" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">否则，脚本不会结束，Pi也不会启动。“与”符号允许命令在单独的进程中运行，并在进程运行时继续引导。这是我编辑过的rc.local文件的副本:</p><figure class="jp jq jr js fq jt"><div class="bz el l di"><div class="mf mg l"/></div></figure><p id="e548" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">重新启动Pi以执行脚本启动:</p><pre class="jp jq jr js fq lw lx ly lz aw ma dt"><span id="ee34" class="kp kq ht lx b fv mb mc l md me">sudo reboot</span></pre><blockquote class="lp lq lr"><p id="5e28" class="iq ir ls is b it iu iv iw ix iy iz ja lt jc jd je lu jg jh ji lv jk jl jm jn hm dt translated">更多详情，请查看我的<a class="ae nn" href="https://github.com/YannMjl/RaspberryPi-Scripts" rel="noopener ugc nofollow" target="_blank"> <strong class="is hu"> GitHub </strong> </a>上的项目代码</p><p id="7905" class="iq ir ls is b it iu iv iw ix iy iz ja lt jc jd je lu jg jh ji lv jk jl jm jn hm dt translated">如果你喜欢这篇文章，你可能也会喜欢“<a class="ae nn" rel="noopener" href="/coinmonks/how-to-built-a-bidirectional-app-for-internet-of-thing-chat-with-python-fc926e605b0f"> <strong class="is hu">如何构建物联网双向应用/用Python聊天</strong> </a>”</p></blockquote><blockquote class="no"><p id="d6b0" class="np nq ht bd nr ns nt nu nv nw nx jn ek translated">干杯！！！！</p><p id="b8a8" class="np nq ht bd nr ns ny nz oa ob oc jn ek translated">加入Coinmonks <a class="ae nn" href="https://t.me/coincodecap" rel="noopener ugc nofollow" target="_blank">电报频道</a>和<a class="ae nn" href="https://www.youtube.com/c/coinmonks/videos" rel="noopener ugc nofollow" target="_blank"> Youtube频道</a>获取每日<a class="ae nn" href="http://coincodecap.com/" rel="noopener ugc nofollow" target="_blank">加密新闻</a></p></blockquote><h2 id="15d6" class="kp kq ht bd kr ks od ku kv kw oe ky kz jb of lb lc jf og le lf jj oh lh li lj dt translated">另外，阅读</h2><ul class=""><li id="20fb" class="mz na ht is b it lk ix ll jb oi jf oj jj ok jn ne nf ng nh dt translated"><a class="ae nn" rel="noopener" href="/coinmonks/top-10-crypto-copy-trading-platforms-for-beginners-d0c37c7d698c">复制交易</a> | <a class="ae nn" rel="noopener" href="/coinmonks/crypto-tax-software-ed4b4810e338">加密税务软件</a></li><li id="723e" class="mz na ht is b it ni ix nj jb nk jf nl jj nm jn ne nf ng nh dt translated"><a class="ae nn" href="https://coincodecap.com/grid-trading" rel="noopener ugc nofollow" target="_blank">网格交易</a> | <a class="ae nn" rel="noopener" href="/coinmonks/the-best-cryptocurrency-hardware-wallets-of-2020-e28b1c124069">加密硬件钱包</a></li><li id="874f" class="mz na ht is b it ni ix nj jb nk jf nl jj nm jn ne nf ng nh dt translated"><a class="ae nn" href="http://Top 4 Telegram Channels for Crypto Traders" rel="noopener ugc nofollow" target="_blank">密码电报信号</a> | <a class="ae nn" rel="noopener" href="/coinmonks/crypto-trading-bot-c2ffce8acb2a">密码交易机器人</a></li><li id="f33b" class="mz na ht is b it ni ix nj jb nk jf nl jj nm jn ne nf ng nh dt translated"><a class="ae nn" rel="noopener" href="/coinmonks/crypto-exchange-dd2f9d6f3769">最佳加密交易所</a> | <a class="ae nn" rel="noopener" href="/coinmonks/bitcoin-exchange-in-india-7f1fe79715c9">印度最佳加密交易所</a></li><li id="47a8" class="mz na ht is b it ni ix nj jb nk jf nl jj nm jn ne nf ng nh dt translated"><a class="ae nn" rel="noopener" href="/coinmonks/best-crypto-apis-for-developers-5efe3a597a9f">面向开发人员的最佳加密API</a></li><li id="b359" class="mz na ht is b it ni ix nj jb nk jf nl jj nm jn ne nf ng nh dt translated">最佳<a class="ae nn" rel="noopener" href="/coinmonks/top-5-crypto-lending-platforms-in-2020-that-you-need-to-know-a1b675cec3fa">密码借贷平台</a></li><li id="3c98" class="mz na ht is b it ni ix nj jb nk jf nl jj nm jn ne nf ng nh dt translated"><a class="ae nn" rel="noopener" href="/coinmonks/free-crypto-signals-48b25e61a8da">免费加密信号</a> | <a class="ae nn" rel="noopener" href="/coinmonks/crypto-trading-bot-c2ffce8acb2a">加密交易机器人</a></li><li id="9487" class="mz na ht is b it ni ix nj jb nk jf nl jj nm jn ne nf ng nh dt translated">杠杆代币的终极指南</li></ul></div></div>    
</body>
</html>