<html>
<head>
<title>Understanding Gas in Ethereum</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">了解以太坊中的气体</h1>
<blockquote>原文：<a href="https://medium.com/coinmonks/understanding-gas-in-ethereum-53ad816f79ae?source=collection_archive---------0-----------------------#2018-07-16">https://medium.com/coinmonks/understanding-gas-in-ethereum-53ad816f79ae?source=collection_archive---------0-----------------------#2018-07-16</a></blockquote><div><div class="ef hh hi hj hk hl"/><div class="hm hn ho hp hq"><div class=""/><figure class="fi fk ir is it iu fe ff paragraph-image"><div role="button" tabindex="0" class="iv iw di ix bf iy"><div class="fe ff iq"><img src="../Images/0d72ed24dd0478a488a214687f23c287.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*M7FW-MvAhamfFbR-.png"/></div></div></figure><p id="e363" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">在以太坊中，<strong class="jd hu"> Gas </strong>是计算工作量的度量单位，需要支付给以太坊客户端以将交易提交给区块链网络。消息/交易的发送者支付该费用。在非常高的层次上，gas是用于在以太坊虚拟机中执行事务的指令数量。在以太坊架构中，它确保提交给网络的交易支付适当的费用。通过要求交易为其执行的每个操作付费，以太坊确保了网络不会被滥用。</p><p id="127e" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">交易可以小到在HelloWorld greetings合同中设置消息、合同部署、十亿美元的商业合同、支付(价值)转移、ICO或任何不仅仅是网络上的只读查询的东西。</p><p id="944c" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">虽然执行的操作与gas之间存在直接映射，但在现实世界中，我们以以太(以太坊网络上的内置令牌)的形式支付这一成本。气体只存在于EVM(以太坊虚拟机)内部，作为正在执行的工作量的计数。在支付汽油费用时，交易费是以乙醚的形式收取的，这是根据汽油价格计算的。</p><p id="6d9d" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">主要有两种获取以太网的方法，可用于在网络上执行任何交易/操作</p><ul class=""><li id="727e" class="jz ka ht jd b je jf ji jj jm kb jq kc ju kd jy ke kf kg kh dt translated">来开采你自己</li><li id="7df5" class="jz ka ht jd b je ki ji kj jm kk jq kl ju km jy ke kf kg kh dt translated">从第三方获得以太坊</li></ul><p id="d22f" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">在这篇文章中，我们将看看成本计算的不同方面，以及它如何映射到天然气。</p><h1 id="acce" class="kn ko ht bd kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk dt translated">气体是一种神秘的燃料</h1><p id="2f27" class="pw-post-body-paragraph jb jc ht jd b je ll jg jh ji lm jk jl jm ln jo jp jq lo js jt ju lp jw jx jy hm dt translated">由于区块链网络上的交易费用，需要由发送方以气体的形式支付，这是物理生活中的一种燃料，气体也被称为加密燃料。</p><p id="5ca3" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">作为一种加密燃料，天然气有助于推动智能合同。发送者用气体交换被称为以太的货币。钱包为一个单位的汽油设置默认的最小值。例如，默认值可以是20香农(0.02萨博斯或0.00000002乙醚)。发送者(通常是钱包开发者)可以改变成本以优化交易的等待时间。</p><h1 id="cd03" class="kn ko ht bd kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk dt translated">影响矿工选择你的交易</h1><p id="861d" class="pw-post-body-paragraph jb jc ht jd b je ll jg jh ji lm jk jl jm ln jo jp jq lo js jt ju lp jw jx jy hm dt translated">如你所知，gas在以太坊网络上被用于促进网络上交易的广播和确认。网络区块中包含的每一笔天然气量都是对矿商进行交易的额外激励。因此，提高天然气价格可以让用户吸引矿工参与交易，并更快地确认他们的转让。</p><p id="ee24" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">因此，作为钱包开发者，目标是</p><ul class=""><li id="7d06" class="jz ka ht jd b je jf ji jj jm kb jq kc ju kd jy ke kf kg kh dt translated">确保用户的交易尽快得到确认</li><li id="2080" class="jz ka ht jd b je ki ji kj jm kk jq kl ju km jy ke kf kg kh dt translated">用户不必为交易超支费用</li></ul><p id="b640" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">因此，当交易处理时间变得至关重要时(例如，在crypto ICO的情况下)，开发者抬高天然气价格，以使他们的交易在其他钱包用户之前被接受。</p><h1 id="d2aa" class="kn ko ht bd kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk dt translated">气体及其转换的测量单位</h1><p id="5175" class="pw-post-body-paragraph jb jc ht jd b je ll jg jh ji lm jk jl jm ln jo jp jq lo js jt ju lp jw jx jy hm dt translated">下表显示了不同醚单元的转化率:</p><figure class="lr ls lt lu fq iu fe ff paragraph-image"><div role="button" tabindex="0" class="iv iw di ix bf iy"><div class="fe ff lq"><img src="../Images/8dd251bebd643954a6fd3a3b7fcab01e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*eIk918oo__h5rYJu.png"/></div></div></figure><p id="de4f" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">**信用* *:<a class="ae lv" href="https://etherconverter.online/" rel="noopener ugc nofollow" target="_blank">https://etherconverter.online/</a></p><h1 id="780f" class="kn ko ht bd kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk dt translated">以太坊交易费用表</h1><p id="3ea8" class="pw-post-body-paragraph jb jc ht jd b je ll jg jh ji lm jk jl jm ln jo jp jq lo js jt ju lp jw jx jy hm dt translated">由于以太坊中的每项操作(即每一行实体代码)都需要一些气体，因此了解以太坊的费用表非常重要。</p><p id="badc" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">白皮书中的下图显示了各种测量结果:</p><figure class="lr ls lt lu fq iu fe ff paragraph-image"><div role="button" tabindex="0" class="iv iw di ix bf iy"><div class="fe ff lw"><img src="../Images/a0d9116ca66dae119f37d52f16dc5ab0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*wED6f2w8glwUjpwU.png"/></div></div></figure><p id="930c" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">此外，以下是指令的子集:</p><ul class=""><li id="f3bd" class="jz ka ht jd b je jf ji jj jm kb jq kc ju kd jy ke kf kg kh dt translated">Wzero = {STOP，RETURN}</li><li id="925c" class="jz ka ht jd b je ki ji kj jm kk jq kl ju km jy ke kf kg kh dt translated">Wbase = {ADDRESS，ORIGIN，CALLER，CALLVALUE，CALLDATASIZE，CODESIZE，GASPRICE，COINBASE，时间戳，数字，难度，GASLIMIT，POP，PC，MSIZE，GAS}</li><li id="7b17" class="jz ka ht jd b je ki ji kj jm kk jq kl ju km jy ke kf kg kh dt translated">Wverylow = {ADD，SUB，NOT，LT，GT，SLT，SGT，EQ，ISZERO，AND，OR，XOR，BYTE，CALLDATALOAD，MLOAD，MSTORE，MSTORE8，PUSH*，DUP*，SWAP*}</li><li id="61fc" class="jz ka ht jd b je ki ji kj jm kk jq kl ju km jy ke kf kg kh dt translated">Wlow = {MUL，DIV，SDIV，MOD，SMOD，SIGNEXTEND}</li><li id="b76d" class="jz ka ht jd b je ki ji kj jm kk jq kl ju km jy ke kf kg kh dt translated">Wmid = {ADDMOD，MULMOD，JUMP}</li><li id="c8c2" class="jz ka ht jd b je ki ji kj jm kk jq kl ju km jy ke kf kg kh dt translated">Whigh = {JUMPI}</li><li id="bb65" class="jz ka ht jd b je ki ji kj jm kk jq kl ju km jy ke kf kg kh dt translated">Wextcode = {EXTCODESIZE}</li></ul><p id="1164" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">您可能需要注意以下几点:</p><ul class=""><li id="1d52" class="jz ka ht jd b je jf ji jj jm kb jq kc ju kd jy ke kf kg kh dt translated">停止和返回零成本汽油</li><li id="a7c4" class="jz ka ht jd b je ki ji kj jm kk jq kl ju km jy ke kf kg kh dt translated">给定交易的最低支付额为21000美元</li><li id="a531" class="jz ka ht jd b je ki ji kj jm kk jq kl ju km jy ke kf kg kh dt translated">签订合同至少要支付32000英镑的汽油费</li></ul><h1 id="1482" class="kn ko ht bd kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk dt translated">气体估算与实际使用的气体</h1><p id="1ae5" class="pw-post-body-paragraph jb jc ht jd b je ll jg jh ji lm jk jl jm ln jo jp jq lo js jt ju lp jw jx jy hm dt translated">以太坊协议对交易中执行的每个计算步骤收费。每笔交易都必须包括天然气限额和愿意为每笔天然气支付的费用，矿商可以选择包括这笔交易。</p><p id="e87c" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">假设用户正在发送有效的交易，如果交易中的计算操作所使用的气体总量小于或等于气体限制，则交易被处理。但是，如果事务所需的总气体量超过气体量限制，则所有更改都将被恢复。交易保持有效，但是，矿工仍然可以收取部分处理交易的费用。交易执行过程中未使用的所有多余气体将作为乙醚退还给发送方。因此，我们总是建议您发送的交易的气体限制应远远高于估计值。</p><p id="d825" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">API web 3 . eth . estimate Gas为您提供了执行事务所需的gas的大致概念。以下是一个如何计算天然气估计值的示例:</p><pre class="lr ls lt lu fq lx ly lz ma aw mb dt"><span id="40f2" class="mc ko ht ly b fv md me l mf mg">&lt;strong&gt;Estimation Code&lt;/strong&gt;</span><span id="4f75" class="mc ko ht ly b fv mh me l mf mg">truffle(ganache)&gt; var result = web3.eth.estimateGas(app.setGreetings(“Hello! Gas Estimate Please!”,</span><span id="e5c7" class="mc ko ht ly b fv mh me l mf mg">{from:’0xf928ac0ed0d0e91f51287a5f28dbdb1019fbba55'}))</span><span id="ff0d" class="mc ko ht ly b fv mh me l mf mg">undefined</span><span id="16bb" class="mc ko ht ly b fv mh me l mf mg">truffle(ganache)&gt; result</span><span id="b287" class="mc ko ht ly b fv mh me l mf mg">53000</span></pre><p id="1a53" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">当您进行真正的交易时，您会得到如下输出，显示使用了34476 gas。</p><pre class="lr ls lt lu fq lx ly lz ma aw mb dt"><span id="dcf4" class="mc ko ht ly b fv md me l mf mg">&lt;strong&gt;Actual Gas Uses&lt;/strong&gt;</span><span id="e7ab" class="mc ko ht ly b fv mh me l mf mg">truffle(ganache)&gt; app.setGreetings(“Hello! Gas Estimate Please!”, {from:’0xf928ac0ed0d0e91f51287a5f28dbdb1019fbba55'})</span><span id="c5b8" class="mc ko ht ly b fv mh me l mf mg">{ tx: ‘0x7e42fe63048ddd85261bd7f33901ffedc48b5a0a3b480d2919cb89a6fc81122d’,</span><span id="7dc7" class="mc ko ht ly b fv mh me l mf mg">receipt:</span><span id="9c7e" class="mc ko ht ly b fv mh me l mf mg">{ transactionHash: ‘0x7e42fe63048ddd85261bd7f33901ffedc48b5a0a3b480d2919cb89a6fc81122d’,</span><span id="94b5" class="mc ko ht ly b fv mh me l mf mg">transactionIndex: 0,</span><span id="7f77" class="mc ko ht ly b fv mh me l mf mg">blockHash: ‘0xd18acc3b8a748f3fa225520440bf02f3b2ff340c428a79658e5c53523b24d20f’,</span><span id="03cf" class="mc ko ht ly b fv mh me l mf mg">blockNumber: 10,</span><span id="623e" class="mc ko ht ly b fv mh me l mf mg">gasUsed: 34476,</span><span id="5bb0" class="mc ko ht ly b fv mh me l mf mg">cumulativeGasUsed: 34476,</span><span id="59d5" class="mc ko ht ly b fv mh me l mf mg">contractAddress: null,</span><span id="ba47" class="mc ko ht ly b fv mh me l mf mg">logs: [],</span><span id="4fb5" class="mc ko ht ly b fv mh me l mf mg">status: ‘0x01’,</span><span id="9ac8" class="mc ko ht ly b fv mh me l mf mg">logsBloom: ‘…’ },</span><span id="c366" class="mc ko ht ly b fv mh me l mf mg">logs: [] }</span></pre><p id="7b42" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">estimateGas API假装这个特定的交易包含在区块链中，其操作将在网络上执行。在这种情况下，它使用与任何采矿者计算实际交易费用相同的机制。</p><p id="12b6" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">在执行交易时，稍微高估一点是好的。你不想在执行过程中汽油不够吧。此外，即使有一点高估，也不能保证所需的气体不会超过你已经提出的气体估计。</p><h1 id="3d5d" class="kn ko ht bd kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk dt translated">交易成本</h1><p id="b72e" class="pw-post-body-paragraph jb jc ht jd b je ll jg jh ji lm jk jl jm ln jo jp jq lo js jt ju lp jw jx jy hm dt translated">以太坊网络中交易的总成本基于两个因素:</p><ul class=""><li id="ce05" class="jz ka ht jd b je jf ji jj jm kb jq kc ju kd jy ke kf kg kh dt translated">使用的气体是消耗的气体总量</li><li id="3169" class="jz ka ht jd b je ki ji kj jm kk jq kl ju km jy ke kf kg kh dt translated">交易中指定的汽油价格</li></ul><pre class="lr ls lt lu fq lx ly lz ma aw mb dt"><span id="0966" class="mc ko ht ly b fv md me l mf mg">&lt;strong&gt;Transaction Cost&lt;/strong&gt;</span><span id="81c6" class="mc ko ht ly b fv mh me l mf mg">Total Transaction Cost = gasUsed * gasPrice</span></pre><p id="0b4c" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated"><strong class="jd hu">注释</strong></p><ul class=""><li id="876f" class="jz ka ht jd b je jf ji jj jm kb jq kc ju kd jy ke kf kg kh dt translated">以太网中的任何气价参考，特别是在以太网、货币、余额或付款的上下文中，应被假定为计入<strong class="jd hu">魏</strong></li><li id="3132" class="jz ka ht jd b je ki ji kj jm kk jq kl ju km jy ke kf kg kh dt translated">在EVM的每次行动都需要一定量的汽油。对于有效的交易，基于交易代码(例如，可靠性代码)，决定操作，因此也决定每个操作对gas的需求。<strong class="jd hu">使用的气体</strong>是执行所有操作的所有气体的总和</li><li id="60bd" class="jz ka ht jd b je ki ji kj jm kk jq kl ju km jy ke kf kg kh dt translated">当用户构建并签署交易时，他/她可以指定他们认为合适的任何价格。他们经常使用钱包进行交易，通常，钱包开发商会尝试为他们优化汽油价格，以给他们最好的体验</li><li id="4ba1" class="jz ka ht jd b je ki ji kj jm kk jq kl ju km jy ke kf kg kh dt translated">使用上一节中显示的单位换算表，您可以计算乙醚的价格，其法定货币值一直在变化。</li></ul><h1 id="6e28" class="kn ko ht bd kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk dt translated">使用Ganache计算天然气用量和成本的示例</h1><p id="b5ab" class="pw-post-body-paragraph jb jc ht jd b je ll jg jh ji lm jk jl jm ln jo jp jq lo js jt ju lp jw jx jy hm dt translated">假设您一直使用Ganache network来部署和测试您的合同，一个基本的HelloWorld类型的问候合同将具有以下事务:</p><figure class="lr ls lt lu fq iu fe ff paragraph-image"><div role="button" tabindex="0" class="iv iw di ix bf iy"><div class="fe ff lw"><img src="../Images/7365f6d3c11c335944e00c5d4821ae71.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*US-HKt_q-k5L9kw5.png"/></div></div></figure><p id="913e" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">上图显示了合同部署和更新合同版本的总成本</p><pre class="lr ls lt lu fq lx ly lz ma aw mb dt"><span id="16b6" class="mc ko ht ly b fv md me l mf mg">Total Gas = 277462 + 42008 + 306523 + 27008 = 653001</span></pre><p id="b292" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">默认情况下，Ganache将天然气价格的值设置为10000000000。目前，它的UI值没有被拾取(可能是一个bug)。</p><p id="d3e7" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">所以，总价=总气*默认价格= 653001 * 100000000000 = 6.53 * 10的16次方= 6.5 / 100乙醚= 0.0653乙醚</p><figure class="lr ls lt lu fq iu fe ff paragraph-image"><div role="button" tabindex="0" class="iv iw di ix bf iy"><div class="fe ff lw"><img src="../Images/98d1d71500d44d28bfbf10257b0e5645.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*IJuG0r-bJDZdPs0K.png"/></div></div></figure><p id="fbe9" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">在上图中，您可以看到100乙醚的初始余额减少到99.93乙醚，这基本上表明0.0653乙醚已经被该帐户用于部署合同。</p><p id="e089" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">我们注意到4个事务对应于合同部署。如果你想更深入地了解这一点，那么让我们看看交易数据，并将它们解码成字节码，称为操作码，以太坊EVM可以理解。使用以下网站，您可以尝试解码相同的内容，以查看在给定交易期间执行的确切操作:<br/><a class="ae lv" href="https://etherscan.io/opcode-tool" rel="noopener ugc nofollow" target="_blank">https://etherscan.io/opcode-tool</a></p><h1 id="e5f2" class="kn ko ht bd kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk dt translated">交易燃料和交易费用对交易的影响</h1><p id="9956" class="pw-post-body-paragraph jb jc ht jd b je ll jg jh ji lm jk jl jm ln jo jp jq lo js jt ju lp jw jx jy hm dt translated">下表总结了交易费用的影响及其对交易的影响:</p><figure class="lr ls lt lu fq iu fe ff paragraph-image"><div class="fe ff mi"><img src="../Images/b42863ef2442e944911b9fea38f73388.png" data-original-src="https://miro.medium.com/v2/resize:fit:1270/format:webp/0*vQQnTD5LJoq8Cird.png"/></div></figure><p id="3bc4" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">在事务开始时，startGas所需的以太被搁置，剩余的以太被设置为startGas。随着交易的每一次操作，天然气被消耗，剩余的天然气被降低。如果出现气体耗尽的异常情况，所有操作都将恢复，所有最初放在一边的乙醚都将交给矿工。如果交易成功完成，所有剩余的天然气将退还给发起人，其余部分将支付给矿工。</p><p id="886b" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">您可以参考以下网址了解更多关于燃气的信息和建议:<br/><a class="ae lv" href="https://ethgasstation.info/index.php" rel="noopener ugc nofollow" target="_blank">【https://ethgasstation.info/index.php】</a></p><p id="c0ac" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">来源:<a class="ae lv" href="https://walkingtree.tech/understanding-gas-in-ethereum/" rel="noopener ugc nofollow" target="_blank">https://walkingtree.tech/understanding-gas-in-ethereum/</a></p></div></div>    
</body>
</html>