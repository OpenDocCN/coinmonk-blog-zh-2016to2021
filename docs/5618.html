<html>
<head>
<title>Introducing Stateful Properties</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">介绍有状态属性</h1>
<blockquote>原文：<a href="https://medium.com/coinmonks/introducing-stateful-properties-f0f6bce45a06?source=collection_archive---------8-----------------------#2021-10-06">https://medium.com/coinmonks/introducing-stateful-properties-f0f6bce45a06?source=collection_archive---------8-----------------------#2021-10-06</a></blockquote><div><div class="ef hh hi hj hk hl"/><div class="hm hn ho hp hq"><div class=""/><div class=""><h2 id="f271" class="pw-subtitle-paragraph iq hs ht bd b ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ek translated">我是如何学会不再担心并热爱比特币国家的</h2></div><p id="0ac5" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated">对于sCrypt初学者来说，最具挑战性的部分之一是在契约中保持内部状态。我们使用<a class="ae ke" href="https://scryptdoc.readthedocs.io/en/latest/state.html" rel="noopener ugc nofollow" target="_blank">州装饰者</a>提供了一个优雅的解决方案。</p><figure class="kg kh ki kj fq kk fe ff paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="fe ff kf"><img src="../Images/90596573ed016136a82f43ba913b10dc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3VyQW2SqxGr1XRE3ig3Vng.png"/></div></div><figcaption class="kr ks fg fe ff kt ku bd b be z ek">State is carried across UTXOs in a contract</figcaption></figure><h1 id="2052" class="kv kw ht bd kx ky kz la lb lc ld le lf iz lg ja lh jc li jd lj jf lk jg ll lm dt translated">问题是</h1><p id="c6a5" class="pw-post-body-paragraph ji jj ht jk b jl ln iu jn jo lo ix jq jr lp jt ju jv lq jx jy jz lr kb kc kd hm dt translated">比特币智能合约使用UTXO模型，默认无状态。之前，我们已经开发了一种通用的方法来维护契约中的状态，它建立在<a class="ae ke" href="https://xiaohuiliu.medium.com/op-push-tx-3d3d279174c1" rel="noopener"> OP_PUSH_TX </a>技术的基础上。即使这种方法证明保持状态是可行的，它充其量也是笨拙的。</p><figure class="kg kh ki kj fq kk"><div class="bz el l di"><div class="ls lt l"/></div><figcaption class="kr ks fg fe ff kt ku bd b be z ek"><a class="ae ke" href="https://github.com/sCrypt-Inc/boilerplate/blob/79eea1f37a53f7b75ecb74d9605c498a4d50bf61/contracts/counter.scrypt" rel="noopener ugc nofollow" target="_blank">Counter contract</a></figcaption></figure><p id="ee4c" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated">例如，在上面的契约中，我们维护一个状态，计数器，并在每次调用<strong class="jk hu"> <em class="lu"> increment() </em> </strong>时加1。我们在这里只维护了一个计数器，但是已经有大量的样板代码，主要是为了序列化和反序列化状态(第5–9行和第15行)。核心逻辑只是第12行的一行。当状态变得更加复杂时，代码会变得更加麻烦和容易出错。</p><h1 id="5829" class="kv kw ht bd kx ky kz la lb lc ld le lf iz lg ja lh jc li jd lj jf lk jg ll lm dt translated">解决方案:国家装饰者</h1><p id="e4b4" class="pw-post-body-paragraph ji jj ht jk b jl ln iu jn jo lo ix jq jr lp jt ju jv lq jx jy jz lr kb kc kd hm dt translated">使用新的状态装饰器方法，您可以通过三个简单的步骤来维护契约中的状态，如下所示:</p><ol class=""><li id="979b" class="lv lw ht jk b jl jm jo jp jr lx jv ly jz lz kd ma mb mc md dt translated">用decorator <code class="eh me mf mg mh b">@state</code>声明任何属于状态的属性。</li><li id="58e8" class="lv lw ht jk b jl mi jo mj jr mk jv ml jz mm kd ma mb mc md dt translated">将stateful属性用作普通属性:读取并更新它。</li><li id="7d9e" class="lv lw ht jk b jl mi jo mj jr mk jv ml jz mm kd ma mb mc md dt translated">当您准备将新状态传递到当前支出事务的输出中时，只需调用一个内置函数<code class="eh me mf mg mh b">this.getStateScript()</code>来获取包含最新有状态属性的锁定脚本。它是为每个有状态契约自动生成的，也就是说，一个契约至少有一个用<code class="eh me mf mg mh b">@state</code>修饰的属性。</li></ol><figure class="kg kh ki kj fq kk"><div class="bz el l di"><div class="ls lt l"/></div><figcaption class="kr ks fg fe ff kt ku bd b be z ek"><a class="ae ke" href="https://github.com/scrypt-sv/boilerplate/blob/master/contracts/counter.scrypt" rel="noopener ugc nofollow" target="_blank">Counter contract</a></figcaption></figure><p id="18e0" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated">如您所见，这比手动序列化和反序列化状态更加简洁和安全。当国家增长时，这种优势更加显著。</p><h2 id="764d" class="mn kw ht bd kx mo mp mq lb mr ms mt lf jr mu mv lh jv mw mx lj jz my mz ll na dt translated">SDK支持</h2><p id="b349" class="pw-post-body-paragraph ji jj ht jk b jl ln iu jn jo lo ix jq jr lp jt ju jv lq jx jy jz lr kb kc kd hm dt translated">我们已经更新了我们的<a class="ae ke" href="https://github.com/sCrypt-Inc/scryptlib#contracts-with-state" rel="noopener ugc nofollow" target="_blank">JavaScript/TypeScript SDK</a>来支持有状态属性，极大地简化了与有状态契约的交互。其他SDK(<a class="ae ke" href="https://github.com/sCrypt-Inc/py-scryptlib" rel="noopener ugc nofollow" target="_blank">Python</a>&amp;<a class="ae ke" href="https://github.com/sCrypt-Inc/go-scryptlib" rel="noopener ugc nofollow" target="_blank">Go</a>)即将更新。</p></div><div class="ab cl nb nc hb nd" role="separator"><span class="ne bw bk nf ng nh"/><span class="ne bw bk nf ng nh"/><span class="ne bw bk nf ng"/></div><div class="hm hn ho hp hq"><p id="34bb" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated">[1]装饰器语法受到了<a class="ae ke" href="https://www.python.org/dev/peps/pep-0318/" rel="noopener ugc nofollow" target="_blank"> Python </a>、<a class="ae ke" href="https://docs.oracle.com/javaee/7/tutorial/cdi-adv007.htm" rel="noopener ugc nofollow" target="_blank"> Java </a>和<a class="ae ke" href="https://www.typescriptlang.org/docs/handbook/decorators.html" rel="noopener ugc nofollow" target="_blank"> TypeScript </a>的启发。</p><blockquote class="ni"><p id="f87a" class="nj nk ht bd nl nm nn no np nq nr kd ek translated">加入Coinmonks <a class="ae ke" href="https://t.me/coincodecap" rel="noopener ugc nofollow" target="_blank">电报频道</a>和<a class="ae ke" href="https://www.youtube.com/c/coinmonks/videos" rel="noopener ugc nofollow" target="_blank"> Youtube频道</a>了解加密交易和投资</p></blockquote><h2 id="3e0c" class="mn kw ht bd kx mo ns mq lb mr nt mt lf jr nu mv lh jv nv mx lj jz nw mz ll na dt translated">另外，阅读</h2><ul class=""><li id="6c6b" class="lv lw ht jk b jl ln jo lo jr nx jv ny jz nz kd oa mb mc md dt translated"><a class="ae ke" href="https://blog.coincodecap.com/grid-trading" rel="noopener ugc nofollow" target="_blank">网格交易机器人</a> | <a class="ae ke" rel="noopener" href="/coinmonks/cryptohopper-review-a388ff5bae88"> Cryptohopper审查</a> | <a class="ae ke" href="https://blog.coincodecap.com/bexplus-review" rel="noopener ugc nofollow" target="_blank"> Bexplus审查</a></li><li id="c51d" class="lv lw ht jk b jl mi jo mj jr mk jv ml jz mm kd oa mb mc md dt translated"><a class="ae ke" href="https://blog.coincodecap.com/zero-fee-crypto-exchanges" rel="noopener ugc nofollow" target="_blank"> 7个最佳零费用加密交易平台</a></li><li id="98d6" class="lv lw ht jk b jl mi jo mj jr mk jv ml jz mm kd oa mb mc md dt translated"><a class="ae ke" href="https://blog.coincodecap.com/what-are-decentralized-exchanges" rel="noopener ugc nofollow" target="_blank">分散交易所</a> | <a class="ae ke" href="https://blog.coincodecap.com/bitbns-fip" rel="noopener ugc nofollow" target="_blank">比特FIP </a> | <a class="ae ke" href="https://blog.coincodecap.com/pionex-review-exchange-with-crypto-trading-bot" rel="noopener ugc nofollow" target="_blank"> Pionex评论</a></li><li id="a0ae" class="lv lw ht jk b jl mi jo mj jr mk jv ml jz mm kd oa mb mc md dt translated"><a class="ae ke" href="https://blog.coincodecap.com/buy-crypto-with-credit-card" rel="noopener ugc nofollow" target="_blank">用信用卡购买密码的10个最佳地点</a></li><li id="ca05" class="lv lw ht jk b jl mi jo mj jr mk jv ml jz mm kd oa mb mc md dt translated"><a class="ae ke" href="https://blog.coincodecap.com/huobi-review" rel="noopener ugc nofollow" target="_blank">霍比评论</a> | <a class="ae ke" href="https://blog.coincodecap.com/okex-margin-trading" rel="noopener ugc nofollow" target="_blank"> OKEx保证金交易</a> | <a class="ae ke" href="https://blog.coincodecap.com/futures-trading" rel="noopener ugc nofollow" target="_blank">期货交易</a></li><li id="6d51" class="lv lw ht jk b jl mi jo mj jr mk jv ml jz mm kd oa mb mc md dt translated"><a class="ae ke" href="https://blog.coincodecap.com/sparrow-exchange-review" rel="noopener ugc nofollow" target="_blank">麻雀交换评论</a> | <a class="ae ke" href="https://blog.coincodecap.com/nash-exchange-review" rel="noopener ugc nofollow" target="_blank">纳什交换评论</a></li><li id="2f1d" class="lv lw ht jk b jl mi jo mj jr mk jv ml jz mm kd oa mb mc md dt translated"><a class="ae ke" href="https://blog.coincodecap.com/crypto-trading-bots-in-the-us" rel="noopener ugc nofollow" target="_blank">美国最佳加密交易机器人</a> | <a class="ae ke" href="https://blog.coincodecap.com/changelly-review" rel="noopener ugc nofollow" target="_blank">经常性评论</a></li><li id="5af4" class="lv lw ht jk b jl mi jo mj jr mk jv ml jz mm kd oa mb mc md dt translated"><a class="ae ke" href="https://blog.coincodecap.com/crypto-arbitrage-in-india" rel="noopener ugc nofollow" target="_blank">在印度利用加密套利赚取被动收入</a></li></ul></div></div>    
</body>
</html>