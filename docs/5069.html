<html>
<head>
<title>Making Sense of Impermanent Loss</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">理解短暂的损失</h1>
<blockquote>原文：<a href="https://medium.com/coinmonks/making-sense-of-impermanent-loss-9cd8fa7d2e05?source=collection_archive---------0-----------------------#2021-07-29">https://medium.com/coinmonks/making-sense-of-impermanent-loss-9cd8fa7d2e05?source=collection_archive---------0-----------------------#2021-07-29</a></blockquote><div><div class="ef hh hi hj hk hl"/><div class="hm hn ho hp hq"><div class=""/><div class=""><h2 id="2713" class="pw-subtitle-paragraph iq hs ht bd b ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ek translated">或者说，我的137% APR到底在哪里？？</h2></div><p id="cc9d" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated"><em class="ke">初级读本</em> <a class="ae kf" href="https://www.youtube.com/watch?v=cizLhxSKrAc" rel="noopener ugc nofollow" target="_blank"> <em class="ke">这里</em> </a> <em class="ke">。</em></p><p id="33ef" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated">你有没有被朋友或同事在分散交易所(dex)押注加密货币赚取高得离谱的收益的报道取笑过？你决定自己去查看一下，快速回顾一下餐巾纸的计算结果，以确认支付给流动性提供者(LP)的费用除以锁定的总价值(TVL)确实得出APR高于100%。很自然，你往池子里扔一些代币，看看会发生什么。根据你的计算，你的余额应该每分钟增加几美分。你等待，刷新，等待，刷新，你的平衡不动了。你再次刷新，你的余额下降了<em class="ke"/>。什么* &amp; @#？？</p><p id="afee" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated">我们知道，向Uniswap 这样的dex提供流动性的缺点是非永久性损失(IL)。但是，到目前为止，在有限合伙人头寸上承担的风险比使用合理的经济分析为其定价所做的工作要高几个数量级。我要展示的是(不用挥手)IL的风险可以用普通期权复制，因此IL的公平价格的无模型估计可以在某个有限的时间间隔内确定。然后，我将使用这一结果来计算补偿IL风险所需的交易量的盈亏平衡，从而展示如何判断参与流动性池的潜在盈利能力。</p><p id="113e" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated">我将使用的参考框架是像Uniswap v2这样的固定产品做市商(CPMM ),因为v3提供的区间流动性期权使这一分析变得复杂。我后面会把结果推广到v3。</p><p id="f232" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated">对于门外汉来说，我将从短暂的损失概述开始。</p><p id="0519" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated">顾名思义，CPMM流动性池中两种资产X和Y的数量乘积保持不变，这是由运行它们的算法决定的。这种情况给了我们下面这张著名的图表，它展示了我们交易对中两种资产在任何时候的可能数量。由于我们的CPMM池中Y的算法价格是通过将池中X的数量除以Y的数量得出的，当一种资产的市场价格变化时，套利者被激励与池进行交易，从而调整X和Y的数量，直到X/Y与公平的市场价格相匹配。作为资金池的有限合伙人，你拥有资金池资产的按比例索赔权，资金池资产由基于交易者行为的数量不断变化的X和Y组成。因此，你对资产X和Y的敞口将随着时间的推移根据价格趋势而变化。</p><figure class="kh ki kj kk fq kl fe ff paragraph-image"><div class="fe ff kg"><img src="../Images/3d1fe951594c6b553234ade18ef91d42.png" data-original-src="https://miro.medium.com/v2/resize:fit:796/0*GPzqeHlKyJdz805e"/></div><figcaption class="ko kp fg fe ff kq kr bd b be z ek">When k=1, the quantity of X and Y reserves in the pool will sit on this curve.</figcaption></figure><p id="fb83" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated">作为一个例子，假设以X计价的Y的价格为0(如果你需要一个更直观的例子，假设Y是ETH，X是USDC，由于黑客攻击、政府干预等原因，ETH的价格为0)。CPMM协议通过用X的数量除以池中Y的数量来确定Y的价格。因此，套利者会以X/Y的价格将无价值的Y出售给资产池，直到没有X剩下——而资产池的LP将持有一袋资产Y。我们承诺的137% APY就这么多了！重要的结果是，有限合伙人的风险敞口完全变成了资产Y，他们对资产X没有索赔权。因此，以X计价的损失(在我们的例子中是USDC)将是他们的两倍，如果有限合伙人只是HODL了他们的X和Y的50/50投资组合(在我们的例子中，他们损失了全部100美元，而如果是HODL，他们将损失50美元)。</p><p id="f996" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated">在期权交易领域，我们用一个名字来描述随着价格变化而变化的资产数量:gamma。自20世纪70年代布莱克-斯科尔斯法突破以来，其属性、风险状况和公平市场价格在交易业务中已为人熟知。使用一些(不那么花哨的)数学步法，我们可以计算出我们在XY池中LP位置的伽马值。</p><p id="6329" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated">我们从CPMM的参数开始。为了在不失一般性的情况下大大简化我们的分析，让我们假设资产X是USDC，因此它的价值(价格)总是等于1:</p><figure class="kh ki kj kk fq kl fe ff paragraph-image"><div class="fe ff ks"><img src="../Images/3b27273f1bced7bcb3d916ba22566d28.png" data-original-src="https://miro.medium.com/v2/resize:fit:666/format:webp/1*8IFI5Usiv1p0aoKYKwTfeA.png"/></div><figcaption class="ko kp fg fe ff kq kr bd b be z ek">Eq 1</figcaption></figure><figure class="kh ki kj kk fq kl fe ff paragraph-image"><div class="fe ff kt"><img src="../Images/b34d2d30f376966c82bcb9373b31bc3b.png" data-original-src="https://miro.medium.com/v2/resize:fit:818/format:webp/1*f-9xCjyNqMYxhRx-WtuUEg.png"/></div><figcaption class="ko kp fg fe ff kq kr bd b be z ek">Eq 2</figcaption></figure><p id="c39c" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated">接下来，我们把X和Y的投资组合的价值写成</p><figure class="kh ki kj kk fq kl fe ff paragraph-image"><div class="fe ff ku"><img src="../Images/a3598143161fd2103ed1f20972df71c0.png" data-original-src="https://miro.medium.com/v2/resize:fit:822/format:webp/1*gBZgswlBcoWOKTZ3JYoUYA.png"/></div></figure><p id="9645" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated">在均衡状态下，套利者将与资金池交易，以执行:</p><figure class="kh ki kj kk fq kl fe ff paragraph-image"><div class="fe ff kv"><img src="../Images/c68c0b6a6489a964be795506f01dd7c8.png" data-original-src="https://miro.medium.com/v2/resize:fit:790/format:webp/1*F-R6jqHsETwoTOy3u7fXNQ.png"/></div></figure><p id="8c59" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated">我们可以重新排列等式2，看到<em class="ke"> x = P y </em>，并代入等式1得到:</p><figure class="kh ki kj kk fq kl fe ff paragraph-image"><div class="fe ff kw"><img src="../Images/94f89242f9d75a641b45a64c2700b40e.png" data-original-src="https://miro.medium.com/v2/resize:fit:730/format:webp/1*mOXK-2dxG1D41i2ixZhdIw.png"/></div></figure><p id="d2dd" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated">利用上述内容，我们可以根据CPMM算法的参数改写我们投资组合的价值:</p><figure class="kh ki kj kk fq kl fe ff paragraph-image"><div class="fe ff kx"><img src="../Images/21e371b465914c0eae3b7887f0e44632.png" data-original-src="https://miro.medium.com/v2/resize:fit:808/format:webp/1*4wEyFc90JmevvVXywGLFRw.png"/></div><figcaption class="ko kp fg fe ff kq kr bd b be z ek">Eq 4</figcaption></figure><p id="179a" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated">最后，我们可以开始对Y的市场价格求导(你很快就会明白为什么)。</p><figure class="kh ki kj kk fq kl fe ff paragraph-image"><div class="fe ff ky"><img src="../Images/2acc46a2a2b49b3697de3cfaea7e84d5.png" data-original-src="https://miro.medium.com/v2/resize:fit:770/format:webp/1*YVUoxKbAvnVwDYhW5YkHiA.png"/></div><figcaption class="ko kp fg fe ff kq kr bd b be z ek">Eq 5</figcaption></figure><p id="7f87" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated">我们现在有了一个封闭形式的表达式，表示池XY中LP位置的γ。正如预期的那样，它是负的，用行业术语来说，这意味着LP是空头gamma，相当于空头期权头寸。因为空头期权头寸的价值与基础资产的波动性成反比，等式5从数学上解释了为什么LP头寸在大的价格变动中亏损。</p><p id="4e44" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated"><a class="ae kf" href="https://www.researchgate.net/publication/2352870_Optimal_Positioning_in_Derivative_Securities" rel="noopener ugc nofollow" target="_blank">卡尔和马丹(2001) </a>的见解表明，任何连续的、两次可微分的支付<em class="ke"> f </em>都可以用下面的公式分解成普通期权:</p><figure class="kh ki kj kk fq kl fe ff paragraph-image"><div class="fe ff kz"><img src="../Images/dd3df4ad6e4a388353b7a01fbed1b36f.png" data-original-src="https://miro.medium.com/v2/resize:fit:842/format:webp/1*n7M_pSXpksV_qB6wFysGyA.png"/></div></figure><figure class="kh ki kj kk fq kl fe ff paragraph-image"><div class="fe ff la"><img src="../Images/9754b50acd62820126a9055a7df2b4ca.png" data-original-src="https://miro.medium.com/v2/resize:fit:806/format:webp/1*towOwX1P2umri7PSqLdIkQ.png"/></div><figcaption class="ko kp fg fe ff kq kr bd b be z ek">Definition of European Call/Put payout at expiry. Note that (S-K)+ is equivalent to max(S-K)</figcaption></figure><p id="90e2" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated">在上式中，<em class="ke">f”’</em>是支付相对于基础资产价格的二阶导数，我们已将其写在等式5中。我们现在确实需要做一个简化的假设，即将我们LP基金的假设锁定与我们在复制投资组合中使用的期权期限(到期时间)相匹配。换句话说，要对持有24小时LP头寸的风险进行定价，我们需要使用24小时到期的期权作为基准。</p><p id="c570" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated">因此，等式3中LP头寸的价值可以根据资产Y的期权改写如下(不幸的是，我们必须引入大K，这里是执行价格):</p><figure class="kh ki kj kk fq kl fe ff paragraph-image"><div class="fe ff lb"><img src="../Images/a300962051c4d3b81a6a4ca84d420a60.png" data-original-src="https://miro.medium.com/v2/resize:fit:880/format:webp/1*4smQJlQV1b7lawMsUre3-A.png"/></div><figcaption class="ko kp fg fe ff kq kr bd b be z ek">Eq 6</figcaption></figure><p id="ecee" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated">卡尔和马丹表明，在求解了所有P点的伽马值(<em class="ke">f″</em>)后，我们可以在普通期权空间中复制l P位置。<em class="ke"> f'' </em>也被称为“权重”，因为它们描述了在复制投资组合中包含多少行权价为K的期权。</p><p id="3099" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated">让我们把数学放在一边，回到直觉上来。回想一下，在资产Y崩溃的情况下，这个资金池会剩下一堆毫无价值的Y代币。注意，我们的权重与<em class="ke"> sqrt(1/K)成正比。</em>这意味着当K接近0时，它的重量趋于无穷大。换句话说，LP头寸是空头的，有<em class="ke">无限</em>数量的零成交看跌期权。当Y的价格趋向于0时，套利者<em class="ke">将</em>无限量的无价值Y放入池中，以吸走所有的x。我们的数学与我们的直觉相符。</p><p id="d712" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated">这些结果是非同寻常的，因为感谢ETH/USDC的流动性期权市场，我们实际上可以在实践中使用它们来赚钱(或省钱)。我最喜欢的加密期权交易所一直是Deribit。我们可以在这里查看ETH期权<a class="ae kf" href="https://www.deribit.com/main#/options?tab=all" rel="noopener ugc nofollow" target="_blank">的最新价格(一定要点击左上角的以太坊)。</a></p><p id="3ffd" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated">为了实际计算参与uni WAP v2 ETH/USDC池的公允价值，我们将只关注等式6中的最后一项。这是因为第一项(不依赖于<em class="ke"> P </em>的那一项)复制了投资组合的初始值(<em class="ke"> x+P y </em>)，第二项(依赖于<em class="ke"> P </em>的第一个订单的那一项)复制了资产Y的初始敞口(即Y的<em class="ke"> y </em>单位)。这些术语在P中没有凸性，因此并不有趣，因为任何非凸性的支付都可以通过借钱(或资产)和购买(或做空)基础资产单位来复制。</p><p id="fa22" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated">为了近似积分，我们将离散化如下:</p><figure class="kh ki kj kk fq kl fe ff paragraph-image"><div class="fe ff lc"><img src="../Images/327907026091a85d7c560e589a2c2351.png" data-original-src="https://miro.medium.com/v2/resize:fit:896/format:webp/1*sUfTmeHqYVV_lgSDN2BjZA.png"/></div></figure><p id="9dbc" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated">简单地说，我们将采用价外(OTM)看跌期权和看涨期权的价格，乘以计算出的权重(<em class="ke"> f'' </em>)，将它们相加，然后除以2(负数只是告诉我们我们正在做空期权，并不具有启发性)。此外，我会将价格0分配给比最后一个报价的OTM期权稍高的期权。最后，我将使用<a class="ae kf" href="https://en.wikipedia.org/wiki/Trapezoidal_rule" rel="noopener ugc nofollow" target="_blank">陷阱规则</a>对总和进行数值估计。</p><p id="1f25" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated">查看我的<a class="ae kf" href="https://docs.google.com/spreadsheets/d/e/2PACX-1vQhYykcQhwi3vJsCO0YeHfyoBcy1gQayqJ1pdJBl189rhO1qX8lXsMdvLqyTS3qYr8Fc-ORdt5ec8ih/pubhtml" rel="noopener ugc nofollow" target="_blank">电子表格</a>来查看运行中的计算。在撰写本文时，我使用了列出的最接近1周的到期日(结果是离到期日还有200个小时)，并选择常量产品参数<em class="ke"> k </em>等于1。还有，我做这个计算的时候乙醚的价格大概是2305。</p><p id="832d" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated">在这种情况下，复制期权投资组合的估计年回报率为16.16%。使用uni WAP v2 ETH/USDC池中的TVL，我们现在可以计算需要为有限合伙人产生多少费用，以匹配期权16.16%的年化回报率。首先回忆一下:</p><figure class="kh ki kj kk fq kl fe ff paragraph-image"><div class="fe ff ld"><img src="../Images/84e66a7f9035724a712f68c669b20c44.png" data-original-src="https://miro.medium.com/v2/resize:fit:902/format:webp/1*p9epgtMTEuQz6txXY4gC1g.png"/></div></figure><p id="811f" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated">现在，我们想使用我们计算的ROI来计算盈亏平衡交易量:</p><figure class="kh ki kj kk fq kl fe ff paragraph-image"><div class="fe ff lc"><img src="../Images/e9065c67ca75fb343363b6d34cf1e37d.png" data-original-src="https://miro.medium.com/v2/resize:fit:896/format:webp/1*5F6sV3L8SLWX1hUSUsof5w.png"/></div><figcaption class="ko kp fg fe ff kq kr bd b be z ek">Eq 7</figcaption></figure><p id="293c" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated">大约在拍摄选项链的同时，我拍摄了Uniswap v2上的池统计信息，如下所示:</p><figure class="kh ki kj kk fq kl fe ff paragraph-image"><div role="button" tabindex="0" class="lf lg di lh bf li"><div class="fe ff le"><img src="../Images/7ef7891d0cf202b9eb27f79bb8b4fe16.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nLb7jpv3Z5foj3udHDHEvg.png"/></div></div></figure><p id="35a0" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated">将观察到的池TVL、我们要求的16.16%的回报率和0.3%的v2费率代入等式7，我们可以求解盈亏平衡交易量。我们得到的结果是147亿美元，这是一个年率，等于7天的盈亏平衡交易量2.816亿美元。正如我们在上面看到的，这比过去7天的交易量2.532亿美元略高，可以有几种解释。</p><p id="1c71" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated">一种解释是，市场预计未来7天的交易量将高于过去7天，在这种情况下，Uniswap和Deribit上观察到的价格可能会持平。更有趣的解释是，Uniswap v2上的交易者预计未来7天的波动性低于Deribit上的交易者，在这种情况下，在没有交易成本的情况下，将存在arb机会。<strong class="jk hu">无论如何，最重要的一点是，如果你不认为下周交易量会上升，Uniswap v2的LP头寸将具有负的预期值。</strong>这是因为Deribit上期权组合的成本是一个“公平”或“有效”的价值，即持有头寸的预期为0，否则交易商将买入或卖出期权并改变价格。</p><p id="4cc1" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated">最后要注意的一点是，如果你卖出复制期权组合，你很少会期望保留全部溢价，即16.16%。要实现这一点，基础资产价格必须与头寸开始时的价格完全相同。否则，一些OTM看跌期权或看涨期权将到期，卖方将拥有正值。<strong class="jk hu">类似地，你几乎不应该期望通过预期费用除以TVL </strong>来计算餐巾背面的APR。</p><p id="f214" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated">这里还有大量的研究要做，我的分析只是触及了表面。我对Uniswap v3引入的新特性感到非常兴奋，并期待着撰写关于它们的文章。如果你喜欢这篇文章，并且它帮助你赚钱(或防止你亏损)，请分享它并发送提示到0x 4683 e 61663 D1 df 94340d 09 e 3 ed 92d 7 b 05 af 2 fdb 0。另外，在推特上关注我@ <a class="ae kf" href="https://twitter.com/BasriRoss" rel="noopener ugc nofollow" target="_blank"> BasriRoss </a>。</p><h2 id="8a7d" class="lj lk ht bd ll lm ln lo lp lq lr ls lt jr lu lv lw jv lx ly lz jz ma mb mc md dt translated">也阅读</h2><div class="me mf fm fo mg mh"><a rel="noopener follow" target="_blank" href="/coinmonks/best-crypto-tax-tool-for-my-money-72d4b430816b"><div class="mi ab ej"><div class="mj ab mk cl cj ml"><h2 class="bd hu fv z el mm eo ep mn er et hs dt translated">加密税务软件——五大最佳比特币税务计算器[2021]</h2><div class="mo l"><h3 class="bd b fv z el mm eo ep mn er et ek translated">不管你是刚接触加密还是已经在这个领域呆了一段时间，你都需要交税。</h3></div><div class="mp l"><p class="bd b gc z el mm eo ep mn er et ek translated">medium.com</p></div></div><div class="mq l"><div class="mr l ms mt mu mq mv km mh"/></div></div></a></div></div></div>    
</body>
</html>