<html>
<head>
<title>My attempt to build a GoFundMe version on the Ethereum Blockchain part 2</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">我在以太坊区块链上构建GoFundMe版本的尝试第2部分</h1>
<blockquote>原文：<a href="https://medium.com/coinmonks/my-attempt-to-build-a-gofundme-version-on-the-ethereum-blockchain-part-2-50bb7b886953?source=collection_archive---------0-----------------------#2018-12-06">https://medium.com/coinmonks/my-attempt-to-build-a-gofundme-version-on-the-ethereum-blockchain-part-2-50bb7b886953?source=collection_archive---------0-----------------------#2018-12-06</a></blockquote><div><div class="ef hh hi hj hk hl"/><div class="hm hn ho hp hq"><div class=""/><p id="8e12" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">这是在以太坊区块链上构建类似于gofundme的去中心化应用程序的第二部分。</p><p id="6482" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">第一部分的链接是<a class="ae jo" rel="noopener" href="/coinmonks/my-attempt-to-build-a-gofundme-version-on-the-ethereum-blockchain-part-1-501024653138">这里是</a></p><figure class="jq jr js jt fq ju fe ff paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="fe ff jp"><img src="../Images/14da54ef113382e36f068bd02b083f32.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*nqYaSCPaiQ6SzJAY"/></div></div><figcaption class="kb kc fg fe ff kd ke bd b be z ek">Photo by <a class="ae jo" href="https://unsplash.com/@alecuffia?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">José Alejandro Cuffia</a> on <a class="ae jo" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><h2 id="2824" class="kf kg ht bd kh ki kj kk kl km kn ko kp jb kq kr ks jf kt ku kv jj kw kx ky kz dt translated"><strong class="ak">FundMe合同的附加代码。</strong></h2><p id="0065" class="pw-post-body-paragraph iq ir ht is b it la iv iw ix lb iz ja jb lc jd je jf ld jh ji jj le jl jm jn hm dt translated">我们将添加一个fundmeFactory合同。这将负责生产的FundMe合同，是的，工厂给了它。这是它的代码。</p><figure class="jq jr js jt fq ju fe ff paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="fe ff lf"><img src="../Images/c22048d88d208768b6bd20bd88ef5fc2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*yrwbJejwzh7sGCTu-L0kdQ.png"/></div></div></figure><p id="1f53" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated"><em class="lg">如你所见，这是一份非常简单的合同。我们创建了一个名为deployedFundraisers的地址数组。创建了一个名为createFundMe的函数，它接受名字、姓氏、描述和所需金额，这个函数调用FundMe合同的构造函数，将所有这些参数传递给它，包括msg.sender。我们得到一个地址，这是我们在创建合同时得到的。我们将新创建的合同地址保存在newFundMe中，然后将其推送到deployedFundraisers数组。</em></p><p id="2761" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated"><em class="lg">第二个函数getDeployedFundraisers只返回DeployedFundraisers数组。当solidity自动允许我们像调用函数一样调用公共变量(即deployedFundraisers)时，我们为什么还需要这个函数？很好，你问了。为数组自由创建的函数将只允许我们一次访问一个项目，但我们希望在调用数组时访问所有项目，因此，我们创建了getDeployedFundraisers。</em></p><p id="6404" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">我们已经在<a class="ae jo" rel="noopener" href="/coinmonks/my-attempt-to-build-a-gofundme-version-on-the-ethereum-blockchain-part-1-501024653138">第一部分写好了合同，</a>添加了一份工厂合同，是时候测试一下了。但在此之前，我们需要整理我们的合同。为此，我们需要下载一些依赖项。</p><p id="b48f" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">我们需要Solc来编辑我们的合同。使用<strong class="is hu"> npm安装solc </strong></p><p id="251e" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">我们需要fs-extra，一个构建文件路径的节点模块。使用<strong class="is hu"> npm安装fs-extra </strong></p><p id="3d7f" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">我假设您熟悉节点包管理器和节点js。如果没有，您可以下载<a class="ae jo" href="https://nodejs.org/en/" rel="noopener ugc nofollow" target="_blank"> Nodejs </a>，在命令行上导航到您的项目目录，然后运行命令<strong class="is hu"> npm init。</strong></p><h2 id="b39b" class="kf kg ht bd kh ki kj kk kl km kn ko kp jb kq kr ks jf kt ku kv jj kw kx ky kz dt translated">收集</h2><p id="b146" class="pw-post-body-paragraph iq ir ht is b it la iv iw ix lb iz ja jb lc jd je jf ld jh ji jj le jl jm jn hm dt translated">创建一个名为compile.js的新文件，并向其中添加以下代码。</p><figure class="jq jr js jt fq ju fe ff paragraph-image"><div class="fe ff lh"><img src="../Images/9a6a436b21f32a42f41c7d889bfbbb05.png" data-original-src="https://miro.medium.com/v2/resize:fit:1240/format:webp/1*Ys_hB3VEPm2t_9YQcl8ivQ.png"/></div></figure><p id="a09d" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated"><strong class="is hu">注意:</strong>我把我的fundme.sol文件放在一个名为contracts的文件夹中，你也可以这样做</p><p id="1d96" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">在您的终端上运行命令<strong class="is hu">节点compile.js </strong>确保您位于终端上compile.js文件所在的相同目录中。如果你的代码编译了，你会看到一个编译文件夹出现在你的项目中，里面有两个文件，FundMe.json和FundMeFactory.json，这是json格式的ABI。当我们将合同部署到区块链时，我们将用它来与合同沟通</p><figure class="jq jr js jt fq ju fe ff paragraph-image"><div class="fe ff li"><img src="../Images/5efbd4872738508caae669fe53231d3f.png" data-original-src="https://miro.medium.com/v2/resize:fit:372/format:webp/1*gRB1x2RnQ4Mm-VB4gjSRFQ.png"/></div></figure><p id="f695" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">如果您在构建文件夹中看到这两个编译好的契约，那么恭喜您，您已经准备好享用主菜了。</p><h2 id="4db7" class="kf kg ht bd kh ki kj kk kl km kn ko kp jb kq kr ks jf kt ku kv jj kw kx ky kz dt translated">测试</h2><p id="607c" class="pw-post-body-paragraph iq ir ht is b it la iv iw ix lb iz ja jb lc jd je jf ld jh ji jj le jl jm jn hm dt translated">现在是有趣的部分了。我已经为这个智能合约编写了10个测试。编写一个全面且健壮的测试非常重要，尤其是对于智能合约。如果你到现在还不知道为什么，你真的不应该写智能合同，但只是提到几个原因，这是由于它们的不变性，以及我们可能在处理金钱或其他贵重物品的事实。一旦部署，我们不能改变它，这变得更糟，如果一个恶意用户发现了合同的漏洞。因此，我们必须确保我们的合同发挥其应有的作用。</p><p id="f52f" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">添加以下依赖项开始。</p><p id="7d5a" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">我们需要摩卡来测试。使用<strong class="is hu"> npm安装摩卡。</strong></p><p id="aecd" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">我们需要Web3与我们的合同沟通。使用<strong class="is hu"> npm安装web 3 @ 1 . 0 . 0-beta 26</strong>。这是我正在使用的web3版本。</p><p id="3524" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">我们需要ganache-cli在我们的计算机上创建本地区块链环境，请使用<strong class="is hu"> npm安装ganache-cli。</strong></p><p id="f642" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">在package.json文件中添加脚本<strong class="is hu">“test”:“mocha”。</strong></p><p id="db40" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">创建名为FundMe.test.js的新文件</p><p id="aa53" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">在顶部需要以下内容</p><figure class="jq jr js jt fq ju fe ff paragraph-image"><div class="fe ff lj"><img src="../Images/1100527f2e357b7e74f8c486aef13cc1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1258/format:webp/1*mEjunXxWBHGsBEC1HvkOfQ.png"/></div></figure><p id="ca52" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">对于compiledFactory和compiledFundMe，请记住它们在您的构建文件夹中，请确保您导航到正确的目录，因为我的目录与您的不同。</p><p id="4c0a" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">我们将需要以下变量</p><p id="3541" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated"><strong class="is hu">让账目</strong>。<em class="lg">加纳切的账户列表</em></p><p id="7615" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated"><strong class="is hu">让工厂</strong>。<em class="lg">资金工厂合同实例</em></p><p id="2743" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">让我们尽情享受吧。 <em class="lg">资金合同地址</em></p><p id="86e5" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated"><strong class="is hu">让fundMe </strong>。<em class="lg">基金合同的实例</em></p><p id="bb42" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated"><em class="lg">在我们的beforeEach中，我们将从web3获取所有帐户的列表，将FundMe工厂合同部署到区块链，然后我们调用createFundMe函数来创建新的FundMe合同，获取新创建的FundMe合同的地址。然后，我们访问新创建的合同。不要忘记将beforeEach标记为async，因为我们正在处理需要承诺的区块链。如果你不知道那是什么意思，不要担心。这只是意味着我们想要执行的动作不会立即发生，所以我们需要等待一段时间。</em></p><p id="c193" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">这是上面的代码。</p><figure class="jq jr js jt fq ju fe ff paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="fe ff lk"><img src="../Images/0ec37247bee4ff650d7f4adf49326547.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NZfkFg7YuPlRcCs2fIIMYw.png"/></div></div></figure><h2 id="bd86" class="kf kg ht bd kh ki kj kk kl km kn ko kp jb kq kr ks jf kt ku kv jj kw kx ky kz dt translated">现在我们可以开始测试了。</h2><p id="1970" class="pw-post-body-paragraph iq ir ht is b it la iv iw ix lb iz ja jb lc jd je jf ld jh ji jj le jl jm jn hm dt translated">创建一个描述，我称之为mine FundMe，带有一个回调函数，把…我会展示给你看</p><figure class="jq jr js jt fq ju fe ff paragraph-image"><div class="fe ff ll"><img src="../Images/c5cab258d59dc081501d1f79adc7b795.png" data-original-src="https://miro.medium.com/v2/resize:fit:1032/format:webp/1*bX9Fbux0uMD1lNGVH0U8HQ.png"/></div></figure><p id="0823" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">因此，在这里，我们正在测试我们是否已经成功部署了这两个合同。然后，如果我们创建的工厂契约实例中有地址，我们断言. ok。我们为fundME做了同样的事情。</p><figure class="jq jr js jt fq ju fe ff paragraph-image"><div class="fe ff lm"><img src="../Images/f998e1af3765e3a35c4d66d07d328377.png" data-original-src="https://miro.medium.com/v2/resize:fit:1140/format:webp/1*p4G5reKFiUdQKCXKUqbPPw.png"/></div></figure><p id="8aee" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">我们的测试通过了。干得好，我们已经成功部署了我们的合同。</p><p id="0e2e" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated"><strong class="is hu">注意:</strong>将每个测试放入describe中，并在终端中输入<strong class="is hu"> npm运行测试</strong>每次你想测试的时候</p><p id="aec1" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated"><strong class="is hu">测试2 </strong></p><p id="1b98" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">我们将添加第二个“it ”,以确保合同将合同调用方标记为接收方。</p><figure class="jq jr js jt fq ju fe ff paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="fe ff lh"><img src="../Images/a8a83bff17ae53c3eb0133821b31c8bf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1240/format:webp/1*leP9Le040wzz7V-SYAj-PQ.png"/></div></div></figure><p id="228b" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated"><em class="lg">这里我们调用的是由solidity自由创建的方法，recipient()，注意我们添加了。调用()。这是因为我们只是在读取数据，并没有改变契约的状态。所以这个操作是免费的。我们将它保存在recipient中，然后断言. equal account[0]与recipient相同。请记住，我们在beforeEach中从帐户[0]部署了我们的合同。</em></p><figure class="jq jr js jt fq ju fe ff paragraph-image"><div class="fe ff ln"><img src="../Images/0611dd3fd0cfb23da7c391720d71728d.png" data-original-src="https://miro.medium.com/v2/resize:fit:922/format:webp/1*iM6Ue1iFwymR1gYu857D9g.png"/></div></figure><p id="b878" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">我们的测试通过了。</p><p id="72cb" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">测试3</p><p id="deee" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">我们将测试我们的合同是否允许人们捐款，并检查是否有人捐了钱。</p><figure class="jq jr js jt fq ju fe ff paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="fe ff lo"><img src="../Images/acd3feccc9cb5859e3779a44f464be9c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9FLLbGHLCrAzKwV7CwO_rQ.png"/></div></div></figure><p id="2c07" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated"><em class="lg">我们调用了donate()，这一次我们将改变合同的状态，这将耗费一些汽油。该值从以太转换为wei (0.5以太，我们的合同只接受wei)，并且提供者是accounts[1]。因此，我们如何检查他们是否真的捐了款，我们可以检查目前的金额或检查合同的余额，但这里我们使用的是donorsAmount，它显示每个地址向募捐者捐了多少钱</em>。我们现在可以断言，看看金额是否大于0。</p><figure class="jq jr js jt fq ju fe ff paragraph-image"><div class="fe ff lp"><img src="../Images/96f7a411dc496e9940d6195e7b342c66.png" data-original-src="https://miro.medium.com/v2/resize:fit:1104/format:webp/1*SCN9mj0ObEKr1AHoVr8L2w.png"/></div></figure><p id="c89b" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">我们的测试通过了。你可以在wei中看到这个值，它是17个0，我给你数过了。</p><p id="493f" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated"><strong class="is hu">测试4 </strong></p><p id="c694" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">我们在这里测试合同是否允许接收者从合同中取钱。</p><figure class="jq jr js jt fq ju fe ff paragraph-image"><div class="fe ff lq"><img src="../Images/4b1965660fd5109433b55bde393ce5da.png" data-original-src="https://miro.medium.com/v2/resize:fit:1322/format:webp/1*jFQDDHFqKIk18_lMkLzD4w.png"/></div></figure><p id="b1cc" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">我们首先捐赠。然后，我们通过调用accounts[0]来提取资金，accounts[0]是创建合同的帐户，也就是我们的接收方。为了确认钱确实被取走了，我们获取了合同的余额，并断言余额是否为0。</p><figure class="jq jr js jt fq ju fe ff paragraph-image"><div class="fe ff lr"><img src="../Images/eb79b8da3a1773003790e518329f98c7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1126/format:webp/1*iPSyhcIZ6rf1SIbG7bgB9g.png"/></div></figure><p id="ed7e" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">我们的测试通过了。</p><p id="cbc1" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated"><strong class="is hu">测试5。</strong></p><p id="f568" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">我们将测试接受者是否可以结束募捐。</p><figure class="jq jr js jt fq ju fe ff paragraph-image"><div class="fe ff ls"><img src="../Images/b3a8459bb178998852660ac0dbb270a8.png" data-original-src="https://miro.medium.com/v2/resize:fit:980/format:webp/1*eq1JLr3zZJSsc5aAohUW4Q.png"/></div></figure><p id="c44e" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">这里我们调用方法end from acounts[0]。为了确认这次募捐已经结束，我们调用了正在进行的方法，该方法返回一个布尔值并保存在isLive中，应该是false。我们断言(！isLive)。！应该否定假，使断言为真。</p><figure class="jq jr js jt fq ju fe ff paragraph-image"><div class="fe ff lt"><img src="../Images/b2d4cc3bab75af410c7b68bf014ee5b3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1094/format:webp/1*R0xFF6MIf3WMb9mPr-Gwdw.png"/></div></figure><p id="e360" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">我们的测试通过了。我们已经成功了一半，对于一些程序员来说，测试并不有趣，但是作为一名区块链开发者，你必须热爱测试，所以现在就去习惯它吧。</p><p id="c52d" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated"><strong class="is hu">测试6 </strong></p><p id="8e43" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">我们将测试筹款活动是否会在目标达成时结束。</p><figure class="jq jr js jt fq ju fe ff paragraph-image"><div class="fe ff lu"><img src="../Images/eb92a629109721dd24ee323d0b570011.png" data-original-src="https://miro.medium.com/v2/resize:fit:1040/format:webp/1*Bqk3XYX0y3NdgKFf1NhsCg.png"/></div></figure><p id="ed35" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">在这里，我们从账户[1]中捐款，并且捐得比需要的多，这应该结束募捐。确认是和上面一样的逻辑。</p><figure class="jq jr js jt fq ju fe ff paragraph-image"><div class="fe ff lv"><img src="../Images/d4bdc759a7d78b66bbd45b4a492f4dfc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1110/format:webp/1*32neMmphQ-1IvSQexWs2_Q.png"/></div></figure><p id="66d7" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">我们的测试通过了。</p><p id="8af0" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated"><strong class="is hu">测试7 </strong></p><p id="f460" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">这个测试会有一点不同，我们会让我们的操作失败，尝试用一个不是收款人的地址取款。</p><figure class="jq jr js jt fq ju fe ff paragraph-image"><div class="fe ff lw"><img src="../Images/bf6f1e19ad45054ff5a8211ef6f88583.png" data-original-src="https://miro.medium.com/v2/resize:fit:1270/format:webp/1*E33Lx52lyxp8QRUUgRhYeg.png"/></div></figure><p id="1a39" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">在这里，我们对契约进行了捐赠，然后我们添加了一个try catch，因为我们想要执行的操作将会失败。我们尝试从帐户[2]中退出，这显然会失败。在catch中，我们断言err来确认存在错误。</p><figure class="jq jr js jt fq ju fe ff paragraph-image"><div class="fe ff lx"><img src="../Images/b960d0171b97d955dee6fd7c4863771b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1120/format:webp/1*O-oqGgDeJFru3lW8Po11JQ.png"/></div></figure><p id="0995" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated"><strong class="is hu">测试8 </strong></p><p id="7ed8" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">我们将做一些类似于上面的事情，这里我们将检查我们的合同不允许其他任何人终止合同。</p><figure class="jq jr js jt fq ju fe ff paragraph-image"><div class="fe ff ly"><img src="../Images/bf5ec5a0fd035656475d80e14d767c0f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1158/format:webp/1*L98BLBsTJoz0J3dtV0cCXw.png"/></div></figure><p id="ec41" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">在这里，我们向募捐者捐款，然后在我们的尝试中，我们从accounts[2]调用end函数，这显然会失败。为了确认我们的筹款活动仍然在进行，我们像在测试5和6中那样调用了正在进行的()，但是这次我们检查筹款活动是否仍然在进行。</p><figure class="jq jr js jt fq ju fe ff paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="fe ff lp"><img src="../Images/f245f661dddc783f338177c5220c0232.png" data-original-src="https://miro.medium.com/v2/resize:fit:1104/format:webp/1*oaNweZwAUreBuk-ag-FxyA.png"/></div></div></figure><p id="362a" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated"><strong class="is hu">测试9 </strong></p><p id="aeae" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">我们想测试一下，在募捐活动结束后，合同没有收集捐款</p><figure class="jq jr js jt fq ju fe ff paragraph-image"><div class="fe ff lz"><img src="../Images/73ee0398369d654d0632d010926d8dee.png" data-original-src="https://miro.medium.com/v2/resize:fit:1144/format:webp/1*r3MtZies5YeoCqeI6u-gRg.png"/></div></figure><p id="f145" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">在这里，接收者结束募捐，我们检查募捐是否仍在进行，以确认它是否已经结束。然后我们把我们的逻辑放在一个尝试中，我们试图从帐户[2]中捐赠，这应该会失败。我们断言catch中是否有错误，以确认捐赠失败。</p><figure class="jq jr js jt fq ju fe ff paragraph-image"><div class="fe ff ma"><img src="../Images/b36f8570d84b602aca3dcf8613a172f2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1084/format:webp/1*JNt2cZ5d-mUNCza6pFAxpQ.png"/></div></figure><p id="7f73" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated"><strong class="is hu">测试10 </strong></p><p id="f56b" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">终于，我们到了最后的考验。在这里，我们将做一个端到端的测试，即试图模拟一个筹款活动的流程。流程将是这样的:</p><p id="61ba" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">该合同需要两笔捐款。</p><p id="5b6a" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">检查是否有两个人捐赠了。</p><p id="ce1f" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">接收方提取余额，使合同余额为0。</p><p id="1d8c" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">募捐活动应该还在进行。</p><p id="59fe" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">合同需要第三次捐赠。</p><p id="d2e5" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">第三次捐赠应该会触发募捐的结束。</p><p id="0d49" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">检查现在是否有3个捐赠者</p><p id="3f1c" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">检查合同余额是否为0</p><p id="216e" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">检查目标是否达到</p><p id="9b7d" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">检查收款人的余额是否大于初始余额</p><p id="0c00" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">检查筹款活动是否已经结束</p><p id="a5b8" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">合同不允许更多的捐赠</p><figure class="jq jr js jt fq ju fe ff paragraph-image"><div class="fe ff mb"><img src="../Images/3b2eab61340657b68efa8f63c7e36088.png" data-original-src="https://miro.medium.com/v2/resize:fit:1324/format:webp/1*KLDuBT7GyMHnF5vBwpcUHg.png"/></div></figure><figure class="jq jr js jt fq ju fe ff paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="fe ff mc"><img src="../Images/82498d60363d96487da5e5e4b624183d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DmN5p3cceIioFgtrMu19Dg.png"/></div></div></figure><p id="537e" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">是的，最后一次测试要长得多。但是我们终于结束了。</p><figure class="jq jr js jt fq ju fe ff paragraph-image"><div class="fe ff md"><img src="../Images/3441109bed035ebd2e923ffe58ef2664.png" data-original-src="https://miro.medium.com/v2/resize:fit:1136/format:webp/1*N5qg7piE6ICnrp6KKmCz-A.png"/></div></figure><p id="7ea2" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated"><strong class="is hu">注</strong>:每个账户的原始余额为100以太。如我们所见，帐户[0]余额现在为102.96英镑。</p><div class="me mf fm fo mg mh"><a href="https://github.com/Gbenro/FundMe/blob/master/test/FundMe.test.js" rel="noopener  ugc nofollow" target="_blank"><div class="mi ab ej"><div class="mj ab mk cl cj ml"><h2 class="bd hu fv z el mm eo ep mn er et hs dt translated">Gbenro/FundMe</h2><div class="mo l"><h3 class="bd b fv z el mm eo ep mn er et ek translated">以太坊区块链上的一个GoFundMe版本。通过在…上创建帐户，为Gbenro/FundMe的发展做出贡献</h3></div><div class="mp l"><p class="bd b gc z el mm eo ep mn er et ek translated">github.com</p></div></div><div class="mq l"><div class="mr l ms mt mu mq mv jz mh"/></div></div></a></div><p id="2d9c" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">测试的链接在上面。</p><p id="9223" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">感谢您完成这个测试，对于许多初学者来说，这可能会有压力，但开始习惯测试是一个好主意。</p><p id="db18" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">我确信我们还可以测试其他的东西。想出一个我们可以编写的测试，并在评论中告诉我。</p><p id="b9c8" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">我们现在有了与我们的合同进行通信的所有逻辑，并且可以轻松地为这个智能合同创建一个前端。</p><p id="9145" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">接下来我将写一份智能合同审计。审计您的合同总是很重要的，只是为了增加额外的安全性，并确保您的智能合同中没有漏洞。让外部区块链专家做审计是至关重要的，因为他们用他们新鲜的眼睛和专业知识，他们可能会发现你错过了什么。在这次审计中。我会尝试从一个新的角度来做这件事。</p><blockquote class="mw"><p id="2285" class="mx my ht bd mz na nb nc nd ne nf jn ek translated"><a class="ae jo" href="https://coincodecap.com/?utm_source=coinmonks" rel="noopener ugc nofollow" target="_blank">在您的收件箱中直接获得最佳软件交易</a></p></blockquote><figure class="nh ni nj nk nl ju fe ff paragraph-image"><a href="https://coincodecap.com/?utm_source=coinmonks"><div class="fe ff ng"><img src="../Images/7c0b3dfdcbfea594cc0ae7d4f9bf6fcb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1168/format:webp/0*OJ-qb5G6i863msBB.png"/></div></a></figure><figure class="jq jr js jt fq ju fe ff paragraph-image"><a href="http://bit.ly/2G71Sp7"><div class="fe ff nm"><img src="../Images/449450761cd76f44f9ae574333f9e9af.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fKX2mtg7p1lOs7JmosPLsA.png"/></div></a><figcaption class="kb kc fg fe ff kd ke bd b be z ek"><a class="ae jo" href="http://bit.ly/2G71Sp7" rel="noopener ugc nofollow" target="_blank"><strong class="bd nn">Click to read today’s top story</strong></a></figcaption></figure></div></div>    
</body>
</html>