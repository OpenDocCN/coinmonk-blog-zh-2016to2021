<html>
<head>
<title>‘Hello World’ Smart Contract using Ethers.js</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Ethers.js的“Hello World”智能合约</h1>
<blockquote>原文：<a href="https://medium.com/coinmonks/hello-world-smart-contract-using-ethers-js-e33b5bf50c19?source=collection_archive---------1-----------------------#2018-06-25">https://medium.com/coinmonks/hello-world-smart-contract-using-ethers-js-e33b5bf50c19?source=collection_archive---------1-----------------------#2018-06-25</a></blockquote><div><div class="ef hh hi hj hk hl"/><div class="hm hn ho hp hq"><div class=""/><p id="f3af" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated"><a class="ae jo" href="https://docs.ethers.io/ethers.js/html/index.html" rel="noopener ugc nofollow" target="_blank"> <strong class="is hu"> Ethers.js </strong> </a>是<a class="ae jo" href="https://web3js.readthedocs.io/en/1.0/" rel="noopener ugc nofollow" target="_blank"> <strong class="is hu"> web3.js </strong> </a>的替代，旨在更容易与<strong class="is hu">以太坊区块链</strong>进行通信。嗯，使用<em class="jp"> Keythereum </em>和<strong class="is hu"> Ethers.js </strong>有助于我们在客户端实现保存私钥的钱包功能，我们将在即将发布的本系列<strong class="is hu"> <em class="jp">第二部分</em> </strong>中看到详细内容。</p><p id="6df4" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">区块链是现实世界问题和以太的解决方案，js是我们实现它的工具之一。</p><figure class="jr js jt ju fq jv fe ff paragraph-image"><div role="button" tabindex="0" class="jw jx di jy bf jz"><div class="fe ff jq"><img src="../Images/db4884271be640703bbf2e62c29b739f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pmvPXTgE_z7UPnOkabJNdA.png"/></div></div></figure><p id="37ae" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">我们将分三个部分进行讲解:</p><ol class=""><li id="78cc" class="kc kd ht is b it iu ix iy jb ke jf kf jj kg jn kh ki kj kk dt translated"><strong class="is hu">智能合约</strong></li><li id="201f" class="kc kd ht is b it kl ix km jb kn jf ko jj kp jn kh ki kj kk dt translated"><strong class="is hu">将智能合约部署到以太坊Rinkeby Testnet </strong></li><li id="1340" class="kc kd ht is b it kl ix km jb kn jf ko jj kp jn kh ki kj kk dt translated"><strong class="is hu">与来自Nodejs的合同进行沟通</strong></li></ol><blockquote class="kq"><p id="65ac" class="kr ks ht bd kt ku kv kw kx ky kz jn ek translated">交易新手？尝试<a class="ae jo" rel="noopener" href="/coinmonks/crypto-trading-bot-c2ffce8acb2a">加密交易机器人</a>或<a class="ae jo" rel="noopener" href="/coinmonks/top-10-crypto-copy-trading-platforms-for-beginners-d0c37c7d698c">复制交易</a></p></blockquote><h2 id="a675" class="la lb ht bd lc ld le lf lg lh li lj lk jb ll lm ln jf lo lp lq jj lr ls lt lu dt translated">1.智能合同</h2><figure class="jr js jt ju fq jv"><div class="bz el l di"><div class="lv lw l"/></div></figure><h2 id="9aac" class="la lb ht bd lc ld lx lf lg lh ly lj lk jb lz lm ln jf ma lp lq jj mb ls lt lu dt translated">2.将智能合约部署到以太坊Rinkeby Testnet</h2><p id="2057" class="pw-post-body-paragraph iq ir ht is b it mc iv iw ix md iz ja jb me jd je jf mf jh ji jj mg jl jm jn hm dt translated">为了部署这个智能合同，我们需要在我们的谷歌chrome浏览器上安装<a class="ae jo" href="https://metamask.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="is hu">元掩码</strong> </a>插件，并且帐户应该加载足够的以太网。如果您是安装metamask的新手，请参考下面的指南。</p><div class="mh mi fm fo mj mk"><a href="https://blog.ujomusic.com/how-to-use-metamask-for-chrome-f258e6034226" rel="noopener  ugc nofollow" target="_blank"><div class="ml ab ej"><div class="mm ab mn cl cj mo"><h2 class="bd hu fv z el mp eo ep mq er et hs dt translated">如何为Chrome使用MetaMask</h2><div class="mr l"><h3 class="bd b fv z el mp eo ep mq er et ek translated">MetaMask是浏览器的以太坊扩展。它可以轻松地将您连接到以太坊应用程序(称为dApps ),并且…</h3></div><div class="ms l"><p class="bd b gc z el mp eo ep mq er et ek translated">blog.ujomusic.com</p></div></div><div class="mt l"><div class="mu l mv mw mx mt my ka mk"/></div></div></a></div><p id="f21f" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">将你的网络切换到Rinkeby testnet并复制你的地址。任何拥有Twitter、Google+或脸书账户的人都可以在许可范围内向https://faucet.rinkeby.io/申请资金。</p><p id="a47e" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">我将使用twitter，我的帐户地址是<strong class="is hu">0x7c 477 a 59578710 EC 7 bfd 2 BF 29 D7 a 24 f 53 a 33979 a</strong>。</p><p id="d7ea" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">我现在将<strong class="is hu">用这个地址发推文</strong>并且<strong class="is hu">复制推文链接</strong>粘贴到水龙头。</p><figure class="jr js jt ju fq jv fe ff paragraph-image"><div role="button" tabindex="0" class="jw jx di jy bf jz"><div class="fe ff mz"><img src="../Images/66ea1bb3544c46bbb7538669af8e7661.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HuEK-1zLZRrloJSZNk7MGw.png"/></div></div><figcaption class="na nb fg fe ff nc nd bd b be z ek">Copying the tweet to use it in the faucet to load ethers</figcaption></figure><p id="774a" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">将推文链接粘贴到<strong class="is hu"> Rinkeby水龙头</strong>中，并请求乙醚，如下图所示。</p><figure class="jr js jt ju fq jv fe ff paragraph-image"><div role="button" tabindex="0" class="jw jx di jy bf jz"><div class="fe ff ne"><img src="../Images/614a08bc77e89ea74524fac82bdeb1de.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Ivayerw61dKXCPe2KZgtQQ.png"/></div></div><figcaption class="na nb fg fe ff nc nd bd b be z ek">Load 18.75 Ethers for 3 days</figcaption></figure><p id="694b" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">成功后，您将能够在Metamask中的帐户地址中看到18.75以太作为余额。</p><p id="0d1b" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">好了，现在我们必须将我们的智能合约从名为<strong class="is hu"> Remix </strong>的<strong class="is hu">在线IDE </strong>部署到以太坊Rinkeby Testnet。在http://remix.ethereum.org<a class="ae jo" href="http://remix.ethereum.org" rel="noopener ugc nofollow" target="_blank">打开混音</a></p><figure class="jr js jt ju fq jv fe ff paragraph-image"><div role="button" tabindex="0" class="jw jx di jy bf jz"><div class="fe ff nf"><img src="../Images/ef518e7465fc834e4d0c36b614d7a4a9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2E1ojNeIztMZgokpOWbYsQ.png"/></div></div><figcaption class="na nb fg fe ff nc nd bd b be z ek">Deploying Smart Contract</figcaption></figure><p id="dd37" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">请确保使用<strong class="is hu">环境</strong>作为<strong class="is hu">注入的Web3 </strong>，当您按下<strong class="is hu">部署</strong>按钮时，会出现Metamask弹出窗口，要求您<strong class="is hu">确认提交</strong>交易。提交交易后，您将能够在Remix控制台下方看到Rinkeby交易链接浏览器。点击链接后，可以在Rinkeby Etherscan中查看交易，如下所示。</p><figure class="jr js jt ju fq jv fe ff paragraph-image"><div role="button" tabindex="0" class="jw jx di jy bf jz"><div class="fe ff ng"><img src="../Images/63c123be9262c32a5f3be8e46fa4e2e3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LMGhTs7DpSm1bFweB44dnw.png"/></div></div></figure><p id="7ff1" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">当合同创建成功时，<strong class="is hu"> TxReceiptStatus </strong>:将显示<strong class="is hu">‘Success’</strong>，请注意<strong class="is hu">‘To’</strong>地址，一旦我们必须从Nodejs应用程序与区块链合同通信，我们将不得不使用该地址。</p><p id="9a8b" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">在我的例子中，收件人地址是<strong class="is hu">0x 74 a9 a 20 f 67d 5499 b 62255 BFA 1 DCA 195d 06 aa 4617</strong>。</p><p id="3636" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">现在从<strong class="is hu"> Remix IDE </strong>中，我们需要复制<strong class="is hu"> ABI </strong>，这是应用二进制接口，稍后也需要用它与智能合约进行通信。在Remix中，在<strong class="is hu">‘编译’</strong>标签下，点击<strong class="is hu">‘细节’</strong>，你会看到ABI。点击ABI复制它。你可以用一个JSON丑化器(<a class="ae jo" href="http://jsonmate.com/" rel="noopener ugc nofollow" target="_blank">http://jsonmate.com/</a>)来丑化得到的ABI，它会是这样的。</p><figure class="jr js jt ju fq jv"><div class="bz el l di"><div class="lv lw l"/></div></figure><h2 id="e6e2" class="la lb ht bd lc ld lx lf lg lh ly lj lk jb lz lm ln jf ma lp lq jj mb ls lt lu dt translated">3.从Nodejs与智能合约通信</h2><p id="eed8" class="pw-post-body-paragraph iq ir ht is b it mc iv iw ix md iz ja jb me jd je jf mf jh ji jj mg jl jm jn hm dt translated">现在我们有了我们的契约所在的地址和ABI，这足以让我们从Nodejs与我们的智能契约进行通信。我们需要使用模块“ethers”与合同进行通信。</p><p id="c095" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">转到您的工作目录，从命令行键入<strong class="is hu">‘NPM init’</strong>来创建package.json文件。请注意，您需要在系统中安装“node”和“npm”。</p><p id="32b8" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">现在，我们可以通过执行'<strong class="is hu">NPM install—save ethers @ 3</strong>'来安装ethers模块，这将在目录中安装ethers节点模块。</p><p id="e68b" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated"><em class="jp">‘请注意，在撰写本文时，它是ethers版本3，但现在ethers已经到了更新的版本，因此当您使用npm安装ethers时，您必须使用NPM install-save ethers @ 3’</em>。</p><p id="81ce" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">现在在同一个目录下创建setvalue.js文件，内容如下。</p><figure class="jr js jt ju fq jv"><div class="bz el l di"><div class="lv lw l"/></div></figure><p id="baa5" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated"><em class="jp">'请注意，在撰写本文时，ethers版本3支持通过调用上述方法中的provider直接访问</em> <strong class="is hu"> <em class="jp"> infura rinkeby节点</em> </strong> <em class="jp">。然而，现在</em> <strong class="is hu"> <em class="jp"> infura已经改变了</em> </strong> <em class="jp">，你必须用infura创建一个帐户，你将免费获得一个项目id。我已经创建了一个新的提供者初始化如何做的例子如下。</em></p><h1 id="3afc" class="nh lb ht bd lc ni nj nk lg nl nm nn lk no np nq ln nr ns nt lq nu nv nw lt nx dt translated">var provider = new ethers . providers . jsonrpcprovider(" https://rinke by . in fura . io/v3/62349 EDB 370 e 4523 b 328 b 8823d 211551 "，" rinke by ")；</h1><p id="fb71" class="pw-post-body-paragraph iq ir ht is b it mc iv iw ix md iz ja jb me jd je jf mf jh ji jj mg jl jm jn hm dt translated"><em class="jp">其中</em><strong class="is hu"><em class="jp">62349 EDB 370 e 4523 b 328 b 8823d 211551</em></strong><em class="jp">是我的项目id。请注意用此提供程序替换下面的所有内容。请不要发垃圾邮件。</em></p><p id="e74a" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">这会将网络提供者设置为Rinkeby testnet。现在我们需要添加合同所在的地址，以及我们在第2步中获得的ABI。</p><figure class="jr js jt ju fq jv"><div class="bz el l di"><div class="lv lw l"/></div></figure><h2 id="f5ac" class="la lb ht bd lc ld lx lf lg lh ly lj lk jb lz lm ln jf ma lp lq jj mb ls lt lu dt translated">3.1设置Hello World</h2><p id="afcd" class="pw-post-body-paragraph iq ir ht is b it mc iv iw ix md iz ja jb me jd je jf mf jh ji jj mg jl jm jn hm dt translated">现在我们的智能合约有两个功能，一个是设置值，一个是获取值。请注意，设置一个值会改变智能合约的状态，其中必须发生一个事务，而获取该值不会调用状态更改，并且是一个常量函数。</p><p id="e424" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">因此，为了设置值，我们必须使用与智能合约通信的帐户的私钥来签署交易。我们可以从元掩码中获取帐户的私钥。单击Metamask中的“导出私钥”,并提供您的密码。</p><figure class="jr js jt ju fq jv fe ff paragraph-image"><div class="fe ff ny"><img src="../Images/13a69e859af8be44b89370d08efe0ffc.png" data-original-src="https://miro.medium.com/v2/resize:fit:718/format:webp/1*-h-nV6mA3NgMvjAq0mo1EQ.png"/></div><figcaption class="na nb fg fe ff nc nd bd b be z ek">Exporting Private Key From Metamask</figcaption></figure><p id="e712" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">我得到的私钥是3ab 6468 f 2465130 c 51946 a 5456 b 8e 2d 309 be 7 af 2f 8 afcd 6823996d 281 c 0990d 0。</p><p id="8c57" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">我们必须添加前缀0x使其成为十六进制，因此私钥将是0x3ab 6468 f 2465130 c 51946 a 5456 b8e 2d 309 be 7 af 2 f 8 afcd 6823996d 281 c 0990d 0。</p><figure class="jr js jt ju fq jv"><div class="bz el l di"><div class="lv lw l"/></div></figure><p id="9810" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">现在，我们必须使用Ethers.js提供的钱包功能来签署我们的交易，并使用契约功能来初始化契约，以便与它进行通信，如下所示。</p><figure class="jr js jt ju fq jv"><div class="bz el l di"><div class="lv lw l"/></div></figure><p id="a144" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">现在让我们通过将“Hello World”设置为参数来调用setValue函数。</p><figure class="jr js jt ju fq jv"><div class="bz el l di"><div class="lv lw l"/></div></figure><p id="9ed1" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">现在从你的工作目录中，运行“node setvalue.js”来调用setvalue函数，将值设置为“Hello World”。</p><p id="37e9" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">您将能够在控制台中看到如下所示的交易。</p><figure class="jr js jt ju fq jv"><div class="bz el l di"><div class="lv lw l"/></div></figure><h2 id="3f8e" class="la lb ht bd lc ld lx lf lg lh ly lj lk jb lz lm ln jf ma lp lq jj mb ls lt lu dt translated">3.2了解世界</h2><p id="c9e7" class="pw-post-body-paragraph iq ir ht is b it mc iv iw ix md iz ja jb me jd je jf mf jh ji jj mg jl jm jn hm dt translated">正如我提到的，获取值是一个常量函数，不会改变区块链的状态，所以我们不需要签署交易或使用Ethers.js中的wallet功能。因此，我们将只使用足以与区块链通信的提供者，而不是作为合同中的参数的wallet。</p><figure class="jr js jt ju fq jv"><div class="bz el l di"><div class="lv lw l"/></div></figure><p id="fda5" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">现在我们将调用如下所示的getValue函数。</p><figure class="jr js jt ju fq jv"><div class="bz el l di"><div class="lv lw l"/></div></figure><p id="bc5b" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">现在，从您的工作目录中，运行“node callPromise.js”来获取智能合约函数getValue()的返回值。</p><blockquote class="kq"><p id="2b72" class="kr ks ht bd kt ku nz oa ob oc od jn ek translated">您将能够在您的控制台中看到返回的'<strong class="ak"> Hello World </strong>'。</p></blockquote><p id="5097" class="pw-post-body-paragraph iq ir ht is b it oe iv iw ix of iz ja jb og jd je jf oh jh ji jj oi jl jm jn hm dt translated">感谢您的阅读，如果您认为这值得，请随意鼓掌。</p><blockquote class="kq"><p id="86ac" class="kr ks ht bd kt ku nz oa ob oc od jn ek translated">加入Coinmonks <a class="ae jo" href="https://t.me/coincodecap" rel="noopener ugc nofollow" target="_blank">电报频道</a>和<a class="ae jo" href="https://www.youtube.com/c/coinmonks/videos" rel="noopener ugc nofollow" target="_blank"> Youtube频道</a>获取每日<a class="ae jo" href="http://coincodecap.com/" rel="noopener ugc nofollow" target="_blank">加密新闻</a></p></blockquote><h2 id="15d6" class="la lb ht bd lc ld le lf lg lh li lj lk jb ll lm ln jf lo lp lq jj lr ls lt lu dt translated">另外，阅读</h2><ul class=""><li id="20fb" class="kc kd ht is b it mc ix md jb oj jf ok jj ol jn om ki kj kk dt translated"><a class="ae jo" rel="noopener" href="/coinmonks/top-10-crypto-copy-trading-platforms-for-beginners-d0c37c7d698c">复制交易</a> | <a class="ae jo" rel="noopener" href="/coinmonks/crypto-tax-software-ed4b4810e338">加密税务软件</a></li><li id="723e" class="kc kd ht is b it kl ix km jb kn jf ko jj kp jn om ki kj kk dt translated"><a class="ae jo" href="https://coincodecap.com/grid-trading" rel="noopener ugc nofollow" target="_blank">网格交易</a> | <a class="ae jo" rel="noopener" href="/coinmonks/the-best-cryptocurrency-hardware-wallets-of-2020-e28b1c124069">加密硬件钱包</a></li><li id="874f" class="kc kd ht is b it kl ix km jb kn jf ko jj kp jn om ki kj kk dt translated"><a class="ae jo" href="http://Top 4 Telegram Channels for Crypto Traders" rel="noopener ugc nofollow" target="_blank">密码电报信号</a> | <a class="ae jo" rel="noopener" href="/coinmonks/crypto-trading-bot-c2ffce8acb2a">密码交易机器人</a></li><li id="f33b" class="kc kd ht is b it kl ix km jb kn jf ko jj kp jn om ki kj kk dt translated"><a class="ae jo" rel="noopener" href="/coinmonks/crypto-exchange-dd2f9d6f3769">最佳加密交易所</a> | <a class="ae jo" rel="noopener" href="/coinmonks/bitcoin-exchange-in-india-7f1fe79715c9">印度最佳加密交易所</a></li><li id="47a8" class="kc kd ht is b it kl ix km jb kn jf ko jj kp jn om ki kj kk dt translated">开发人员的最佳加密API</li><li id="b359" class="kc kd ht is b it kl ix km jb kn jf ko jj kp jn om ki kj kk dt translated">最佳<a class="ae jo" rel="noopener" href="/coinmonks/top-5-crypto-lending-platforms-in-2020-that-you-need-to-know-a1b675cec3fa">密码借贷平台</a></li><li id="3c98" class="kc kd ht is b it kl ix km jb kn jf ko jj kp jn om ki kj kk dt translated"><a class="ae jo" rel="noopener" href="/coinmonks/free-crypto-signals-48b25e61a8da">免费加密信号</a> | <a class="ae jo" rel="noopener" href="/coinmonks/crypto-trading-bot-c2ffce8acb2a">加密交易机器人</a></li><li id="9487" class="kc kd ht is b it kl ix km jb kn jf ko jj kp jn om ki kj kk dt translated"><a class="ae jo" rel="noopener" href="/coinmonks/leveraged-token-3f5257808b22">杠杆代币</a>终极指南</li></ul></div></div>    
</body>
</html>