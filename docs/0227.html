<html>
<head>
<title>ERC721 TokenPool</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">ERC721令牌池</h1>
<blockquote>原文：<a href="https://medium.com/coinmonks/erc721-tokenpool-e6576c94a4fc?source=collection_archive---------8-----------------------#2018-04-07">https://medium.com/coinmonks/erc721-tokenpool-e6576c94a4fc?source=collection_archive---------8-----------------------#2018-04-07</a></blockquote><div><div class="ef hh hi hj hk hl"/><div class="hm hn ho hp hq"><div class=""/><p id="668d" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated"><code class="eh jo jp jq jr b">TokenPool</code>是具有4级池结构的<code class="eh jo jp jq jr b">TokenContainer</code>:</p><pre class="js jt ju jv fq jw jr jx jy aw jz dt"><span id="5d13" class="ka kb ht jr b fv kc kd l ke kf">Level     Container / Member<br/>--------------------------------------------<br/>  0       SuperPool<br/>  1           |_____.Pool<br/>  2                   |_____.SubPool<br/>  3                             |_____.Token</span></pre><p id="f68f" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">由以下结构描述的池模式:</p><pre class="js jt ju jv fq jw jr jx jy aw jz dt"><span id="d504" class="ka kb ht jr b fv kc kd l ke kf">struct Pool {<br/>        uint8   level;      // Pool level: 0,1,2,3<br/>        uint256 maxNumber;  // Maximum number of pools on this lavel<br/>        uint256 maxMember;  // Maximum number of members for the pool<br/>        uint256 number;     // Pool number for this level<br/>        uint256 last;       // NFT ID for last availible pool (with member capacity)<br/>        uint256 share;      // Pool share from token investment<br/> }</span></pre><p id="276b" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">使用<code class="eh jo jp jq jr b">insertPool</code>方法在池结构中插入令牌:</p><pre class="js jt ju jv fq jw jr jx jy aw jz dt"><span id="86a4" class="ka kb ht jr b fv kc kd l ke kf">function insertPool(uint256 _id) public returns(bool);</span></pre><p id="9391" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">该函数调用<code class="eh jo jp jq jr b">_insertPool</code>来插入令牌，如果需要，还可以在结构中插入新的池:</p><pre class="js jt ju jv fq jw jr jx jy aw jz dt"><span id="35d9" class="ka kb ht jr b fv kc kd l ke kf">function _insertPool(uint256 _id, uint8 _level) internal returns (bool);</span></pre><p id="cb71" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">在令牌被插入到池结构中之后，函数<code class="eh jo jp jq jr b">insertPool</code>调用值分布函数:</p><pre class="js jt ju jv fq jw jr jx jy aw jz dt"><span id="cafc" class="ka kb ht jr b fv kc kd l ke kf">function _distributeValue(uint256 _id) internal returns (bool);</span></pre><p id="a4b9" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">然后根据<code class="eh jo jp jq jr b">Pool.share</code>在<code class="eh jo jp jq jr b">SuperPool</code>、<code class="eh jo jp jq jr b">Pool</code>和<code class="eh jo jp jq jr b">SubPool</code>之间分配代币值。池分配后剩余的代币价值将用于佣金。使用以下方法获取收集的佣金和当前池值:</p><pre class="js jt ju jv fq jw jr jx jy aw jz dt"><span id="d0c5" class="ka kb ht jr b fv kc kd l ke kf">function getComission() public view returns(uint256 commission);</span><span id="e354" class="ka kb ht jr b fv kg kd l ke kf">function getDistribution() public view returns(uint256[4] distribution)</span></pre><p id="53d8" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">最后一个函数返回以下值:</p><pre class="js jt ju jv fq jw jr jx jy aw jz dt"><span id="16fb" class="ka kb ht jr b fv kc kd l ke kf">distribution[0];         // Super Pool Value<br/>distribution[1];         // Pool Value<br/>distribution[2];         // SubPool Value<br/>distribution[3];         // Tokens Value (must be 0)</span></pre><p id="ead8" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">为了支付价值，智能合约使用以下函数:</p><pre class="js jt ju jv fq jw jr jx jy aw jz dt"><span id="d94f" class="ka kb ht jr b fv kc kd l ke kf">function _payValue(uint256 _id, uint256 _value) internal returns(uint256[4] distribution);</span></pre><p id="b261" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated"><code class="eh jo jp jq jr b">__payValue</code>基于与<code class="eh jo jp jq jr b">getDistribution</code>相同的结构返回支付的分布，但是在这种情况下，只有一个数组元素可以具有等于<code class="eh jo jp jq jr b">_value</code>的非零值。例如，如果Pool已经付款，那么<code class="eh jo jp jq jr b">distribution[1] == _value</code>和剩余的<code class="eh jo jp jq jr b">distribution[0,2,3] == 0</code>。如果所有元素的值都为零，则支付不成功，并且所有池都没有足够的值来支付请求的金额。在这种情况下，<code class="eh jo jp jq jr b">_payValue</code>发出<code class="eh jo jp jq jr b">SecondTierCall</code>事件。如果支付成功，则发出事件<code class="eh jo jp jq jr b">PaymentValue</code>:</p><pre class="js jt ju jv fq jw jr jx jy aw jz dt"><span id="aee8" class="ka kb ht jr b fv kc kd l ke kf">event PaymentValue(uint256 id, uint256 value, uint8 level);</span></pre><p id="a573" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">它将返回已付款的池级别，在我们的示例中是<code class="eh jo jp jq jr b">level == 1</code>。</p><blockquote class="kh"><p id="a513" class="ki kj ht bd kk kl km kn ko kp kq jn ek translated"><a class="ae kr" href="https://coincodecap.com/?utm_source=coinmonks" rel="noopener ugc nofollow" target="_blank">直接在您的收件箱中获得最佳软件交易</a></p></blockquote><figure class="kt ku kv kw kx ky fe ff paragraph-image"><a href="https://coincodecap.com/?utm_source=coinmonks"><div class="fe ff ks"><img src="../Images/7c0b3dfdcbfea594cc0ae7d4f9bf6fcb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1168/format:webp/0*OJ-qb5G6i863msBB.png"/></div></a></figure></div></div>    
</body>
</html>