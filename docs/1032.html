<html>
<head>
<title>Using EOSFactory</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用EOSFactory</h1>
<blockquote>原文：<a href="https://medium.com/coinmonks/your-first-eos-dapp-using-eosfactory-aa0394df95d9?source=collection_archive---------4-----------------------#2018-07-13">https://medium.com/coinmonks/your-first-eos-dapp-using-eosfactory-aa0394df95d9?source=collection_archive---------4-----------------------#2018-07-13</a></blockquote><div><div class="ef hh hi hj hk hl"/><div class="hm hn ho hp hq"><figure class="hs ht fm fo hu hv fe ff paragraph-image"><div role="button" tabindex="0" class="hw hx di hy bf hz"><div class="fe ff hr"><img src="../Images/a07fe0ffce8c8555b1535a672ea610be.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hexhcWaRXY5RmxZneD0IDQ.png"/></div></div></figure><div class=""/><div class=""><h2 id="d0a1" class="pw-subtitle-paragraph jb id ie bd b jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js ek translated">寻找我们的EOS开发工具集</h2></div><p id="c7c2" class="pw-post-body-paragraph jt ju ie jv b jw jx jf jy jz ka ji kb kc kd ke kf kg kh ki kj kk kl km kn ko hm dt translated">在我们之前的两篇文章中，我们讨论了建立一个EOS智能合同来帮助解决学校入学彩票的问题。<a class="ae kp" rel="noopener" href="/coinmonks/your-first-eos-dapp-the-setup-dde55d3dcfb7">第一篇文章</a>关注如何启动和运行EOS链，以及如何使用一些可用的CLI工具。第二篇文章深入研究了彩票智能合约本身的创建、部署和交互。</p><p id="db68" class="pw-post-body-paragraph jt ju ie jv b jw jx jf jy jz ka ji kb kc kd ke kf kg kh ki kj kk kl km kn ko hm dt translated">在这篇文章中，我们将探索一个由block producer开发的工具，<a class="ae kp" href="https://tokenika.io/" rel="noopener ugc nofollow" target="_blank"> Tokenika </a>，它是相当于<a class="ae kp" href="https://truffleframework.com/" rel="noopener ugc nofollow" target="_blank"> Truffle </a>的EOS。我们将测试它的速度，看看我们是否想用它来继续开发彩票dApp。该工具名为<em class="kq"> EOSFactory </em>，其网站承诺如下:</p><p id="76c1" class="pw-post-body-paragraph jt ju ie jv b jw jx jf jy jz ka ji kb kc kd ke kf kg kh ki kj kk kl km kn ko hm dt translated"><em class="kq">毫无疑问，EOSFactory提供的一切都可以用EOSIO官方工具集来完成，即</em> <code class="eh kr ks kt ku b"><em class="kq">cleos</em></code> <em class="kq">和</em> <code class="eh kr ks kt ku b"><em class="kq">eosiocpp</em></code> <em class="kq">。它是否使EOSFactory成为这些工具的简单替代品？不完全是。</em></p><p id="2dae" class="pw-post-body-paragraph jt ju ie jv b jw jx jf jy jz ka ji kb kc kd ke kf kg kh ki kj kk kl km kn ko hm dt translated">试着浏览一下基于 <code class="eh kr ks kt ku b"><em class="kq">cleos</em></code> <em class="kq">的</em> <a class="ae kp" href="https://github.com/EOSIO/eos/wiki/Tutorial-eosio-token-Contract" rel="noopener ugc nofollow" target="_blank"> <em class="kq"> EOS教程</em> </a> <em class="kq">，你就会明白，要做到不犯一点错误地遵循那些简单的例子需要多大的专注度。现在想象做10或100次。当然，这是一项艰巨的任务！</em></p><p id="7d7b" class="pw-post-body-paragraph jt ju ie jv b jw jx jf jy jz ka ji kb kc kd ke kf kg kh ki kj kk kl km kn ko hm dt translated">代码开发和单元测试涉及到需要执行数百次的任务，每次都以完全相同的方式和完全相同的上下文执行。因此，这些任务需要完全自动化，否则会浪费大量时间，更糟糕的是，还会引入许多额外的不确定性。手动执行的操作容易出错。</p><p id="dbc8" class="pw-post-body-paragraph jt ju ie jv b jw jx jf jy jz ka ji kb kc kd ke kf kg kh ki kj kk kl km kn ko hm dt translated">这就是EOSFactory真正带来的东西:一种简单直观的方式来自动化处理智能合同的过程。以Python脚本的形式写下需要以完全相同的方式和完全相同的上下文多次完成的事情，然后运行脚本。EOSFactory将负责其他一切:它将编译您的智能合约，创建新的testnet，部署合约，调用其方法并验证响应，然后拆除testnet，最后报告结果。所有这些都在几秒钟内完成。</p><p id="270b" class="pw-post-body-paragraph jt ju ie jv b jw jx jf jy jz ka ji kb kc kd ke kf kg kh ki kj kk kl km kn ko hm dt translated">对于那些读过本系列第<a class="ae kp" rel="noopener" href="/coinmonks/your-first-eos-dapp-the-setup-dde55d3dcfb7">篇第</a>篇和第<a class="ae kp" rel="noopener" href="/coinmonks/your-first-eos-dapp-the-contract-ce793f43d852">篇第二</a>篇文章的人来说，你知道<em class="kq"> cleos </em> CLI对于可重复和迭代开发来说并不理想，像EOSFactory这样的东西是绝对需要的。</p><p id="f389" class="pw-post-body-paragraph jt ju ie jv b jw jx jf jy jz ka ji kb kc kd ke kf kg kh ki kj kk kl km kn ko hm dt translated">松露的一个警告是EOSFactory使用Python3作为其选择的语言，而不是javascript。对于一些人来说，这可能是一个巨大的障碍，但是我发现Python很容易掌握。</p></div><div class="ab cl kv kw hb kx" role="separator"><span class="ky bw bk kz la lb"/><span class="ky bw bk kz la lb"/><span class="ky bw bk kz la"/></div><div class="hm hn ho hp hq"><h2 id="3f7d" class="lc ld ie bd le lf lg lh li lj lk ll lm kc ln lo lp kg lq lr ls kk lt lu lv lw dt translated">先决条件</h2><p id="2c57" class="pw-post-body-paragraph jt ju ie jv b jw lx jf jy jz ly ji kb kc lz ke kf kg ma ki kj kk mb km kn ko hm dt translated">您需要安装EOS v1.08或更高版本，以便与EOSFactory工具兼容。完整的说明是<a class="ae kp" href="https://developers.eos.io/eosio-nodeos/docs/getting-the-code" rel="noopener ugc nofollow" target="_blank">这里</a>构建和安装EOS，但是如果你在mac上你可以参考下面。</p><pre class="mc md me mf fq mg ku mh mi aw mj dt"><span id="cd3d" class="lc ld ie ku b fv mk ml l mm mn">mkdir -p ~/Projects/EOS &amp;&amp; cd ~/Projects/EOS</span><span id="fd9b" class="lc ld ie ku b fv mo ml l mm mn">git clone https://github.com/EOSIO/eos --recursive</span><span id="aee2" class="lc ld ie ku b fv mo ml l mm mn">cd eos</span><span id="ca70" class="lc ld ie ku b fv mo ml l mm mn">./eosio_build.sh</span></pre><p id="9002" class="pw-post-body-paragraph jt ju ie jv b jw jx jf jy jz ka ji kb kc kd ke kf kg kh ki kj kk kl km kn ko hm dt translated">你现在应该有一个可运行的链。让我们测试一下</p><pre class="mc md me mf fq mg ku mh mi aw mj dt"><span id="e121" class="lc ld ie ku b fv mk ml l mm mn">nodeos // Should start your chain - may have to qualify path</span></pre><p id="8b38" class="pw-post-body-paragraph jt ju ie jv b jw jx jf jy jz ka ji kb kc kd ke kf kg kh ki kj kk kl km kn ko hm dt translated">在这一点上，我们不应该做任何更多的链配置。我们应该可以推迟到工厂。让我们继续安装EOSFactory。</p><p id="2fe5" class="pw-post-body-paragraph jt ju ie jv b jw jx jf jy jz ka ji kb kc kd ke kf kg kh ki kj kk kl km kn ko hm dt translated"><strong class="jv if">安装EOSFactory </strong></p><p id="096d" class="pw-post-body-paragraph jt ju ie jv b jw jx jf jy jz ka ji kb kc kd ke kf kg kh ki kj kk kl km kn ko hm dt translated">如果您有mac，请遵循以下步骤或参考此处的<a class="ae kp" href="http://eosfactory.io/sphinx/build/html/tutorials/01.InstallingEOSFactory.html" rel="noopener ugc nofollow" target="_blank"/></p><pre class="mc md me mf fq mg ku mh mi aw mj dt"><span id="94ac" class="lc ld ie ku b fv mk ml l mm mn">cd ~/Projects/EOS</span><span id="e599" class="lc ld ie ku b fv mo ml l mm mn">git clone <a class="ae kp" href="https://github.com/tokenika/eosfactory.git" rel="noopener ugc nofollow" target="_blank">https://github.com/tokenika/eosfactory.git</a></span><span id="35d2" class="lc ld ie ku b fv mo ml l mm mn">mkdir -p lottery/contracts // Our smart contracts dir</span><span id="fdeb" class="lc ld ie ku b fv mo ml l mm mn">cd eosfactory</span><span id="7d27" class="lc ld ie ku b fv mo ml l mm mn">./build.sh -e ~/Projects/EOS/eos -w ~/Projects/EOS/lottery/contracts</span></pre><p id="04e8" class="pw-post-body-paragraph jt ju ie jv b jw jx jf jy jz ka ji kb kc kd ke kf kg kh ki kj kk kl km kn ko hm dt translated">这将为您提供以下输出</p><pre class="mc md me mf fq mg ku mh mi aw mj dt"><span id="132e" class="lc ld ie ku b fv mk ml l mm mn">EOSFactory has been successfully built.</span><span id="a11c" class="lc ld ie ku b fv mo ml l mm mn">0min 2sec</span><span id="4539" class="lc ld ie ku b fv mo ml l mm mn">______ ____   _____  ______      _____ _______ ____  _______     __|  ____/ __ \ / ____||  ____/\   / ____|__   __/ __ \|  __ \ \   / /| |__ | |  | | (___  | |__ /  \ | |       | | | |  | | |__) \ \_/ /|  __|| |  | |\___ \ |  __/ /\ \| |       | | | |  | |  _  / \   /| |___| |__| |____) || | / ____ \ |____   | | | |__| | | \ \  | ||______\____/|_____/ |_|/_/    \_\_____|  |_|  \____/|_|  \_\ |_|</span><span id="5bb2" class="lc ld ie ku b fv mo ml l mm mn">TO COMPLETE your installation please load the newly created system variables</span><span id="76d3" class="lc ld ie ku b fv mo ml l mm mn">by RUNNING THIS COMMAND:<br/></span><span id="b454" class="lc ld ie ku b fv mo ml l mm mn">$ source ~/.bash_profile<br/></span><span id="473c" class="lc ld ie ku b fv mo ml l mm mn">INSTALL a Python module that allows for color priting:</span><span id="7cfb" class="lc ld ie ku b fv mo ml l mm mn">sudo python3 -m pip install termcolor<br/></span><span id="9a7d" class="lc ld ie ku b fv mo ml l mm mn">To verify EOSFactory installation navigate to the 'eosfactory' folder and run</span><span id="7185" class="lc ld ie ku b fv mo ml l mm mn">these tests:</span><span id="c024" class="lc ld ie ku b fv mo ml l mm mn">$ python3 ./tests/unittest1.py</span><span id="c203" class="lc ld ie ku b fv mo ml l mm mn">$ python3 ./tests/unittest2.py</span><span id="01bb" class="lc ld ie ku b fv mo ml l mm mn">$ python3 ./tests/unittest3.py</span></pre><p id="331e" class="pw-post-body-paragraph jt ju ie jv b jw jx jf jy jz ka ji kb kc kd ke kf kg kh ki kj kk kl km kn ko hm dt translated">遵循上面的说明</p><pre class="mc md me mf fq mg ku mh mi aw mj dt"><span id="e20a" class="lc ld ie ku b fv mk ml l mm mn">source ~/.bash_profile</span><span id="0623" class="lc ld ie ku b fv mo ml l mm mn">sudo python3 -m pip install termcolor</span></pre><p id="e9c5" class="pw-post-body-paragraph jt ju ie jv b jw jx jf jy jz ka ji kb kc kd ke kf kg kh ki kj kk kl km kn ko hm dt translated">您可能需要安装<a class="ae kp" href="https://wsvincent.com/install-python3-mac/" rel="noopener ugc nofollow" target="_blank"> Python3 </a>和<a class="ae kp" href="https://itsevans.com/install-pip-osx/" rel="noopener ugc nofollow" target="_blank"> pip3 </a>。安装python3和pip3并运行上面的命令后，从您所在的eosfactory目录运行下面的测试。</p><pre class="mc md me mf fq mg ku mh mi aw mj dt"><span id="3440" class="lc ld ie ku b fv mk ml l mm mn">python3 ./tests/unittest1.py</span><span id="63c6" class="lc ld ie ku b fv mo ml l mm mn">python3 ./tests/unittest2.py</span><span id="3d31" class="lc ld ie ku b fv mo ml l mm mn">python3 ./tests/unittest3.py</span></pre><p id="8e20" class="pw-post-body-paragraph jt ju ie jv b jw jx jf jy jz ka ji kb kc kd ke kf kg kh ki kj kk kl km kn ko hm dt translated">这些测试应该会通过，并给出与mocha或chai测试相似的输出</p><figure class="mc md me mf fq hv fe ff paragraph-image"><div class="fe ff mp"><img src="../Images/782dcae1d16a115ceb6318d2e49a101b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1290/format:webp/1*0tczldaGy46r-5vWoEfJPg.png"/></div></figure><p id="5c34" class="pw-post-body-paragraph jt ju ie jv b jw jx jf jy jz ka ji kb kc kd ke kf kg kh ki kj kk kl km kn ko hm dt translated">到目前为止还不错吧。</p></div><div class="ab cl kv kw hb kx" role="separator"><span class="ky bw bk kz la lb"/><span class="ky bw bk kz la lb"/><span class="ky bw bk kz la"/></div><div class="hm hn ho hp hq"><h2 id="ff1b" class="lc ld ie bd le lf lg lh li lj lk ll lm kc ln lo lp kg lq lr ls kk lt lu lv lw dt translated">试车</h2><p id="6c18" class="pw-post-body-paragraph jt ju ie jv b jw lx jf jy jz ly ji kb kc lz ke kf kg ma ki kj kk mb km kn ko hm dt translated">我为我们创建了一个测试文件，可以在下面找到。继续并执行以下操作</p><pre class="mc md me mf fq mg ku mh mi aw mj dt"><span id="db04" class="lc ld ie ku b fv mk ml l mm mn">git clone <a class="ae kp" href="mailto:git@github.com" rel="noopener ugc nofollow" target="_blank">git@github.com</a>:cipherzzz/school_lottery.git<br/>cd school_lottery<br/>npm i<br/>mkdir test</span></pre><p id="f6aa" class="pw-post-body-paragraph jt ju ie jv b jw jx jf jy jz ka ji kb kc kd ke kf kg kh ki kj kk kl km kn ko hm dt translated">用下面的内容在<em class="kq"> /test </em>文件夹中创建<em class="kq"> lottery.spec.py </em>文件，但是将第<em class="kq"> 22 </em>行的<em class="kq"> CONTRACT_NAME </em>变量改为指向您系统中实际的合同文件夹。</p><figure class="mc md me mf fq hv"><div class="bz el l di"><div class="mq mr l"/></div></figure></div><div class="ab cl kv kw hb kx" role="separator"><span class="ky bw bk kz la lb"/><span class="ky bw bk kz la lb"/><span class="ky bw bk kz la"/></div><div class="hm hn ho hp hq"><h2 id="94b3" class="lc ld ie bd le lf lg lh li lj lk ll lm kc ln lo lp kg lq lr ls kk lt lu lv lw dt translated">把所有的放在一起</h2><h2 id="f0bf" class="lc ld ie bd le lf lg lh li lj lk ll lm kc ln lo lp kg lq lr ls kk lt lu lv lw dt translated">道歉</h2><p id="dff6" class="pw-post-body-paragraph jt ju ie jv b jw lx jf jy jz ly ji kb kc lz ke kf kg ma ki kj kk mb km kn ko hm dt translated">我真的试图让abi和wast编译作为测试的一部分，但它是不一致的。所以，现在你需要在每次修改后运行我的助手编译脚本——抱歉！</p><pre class="mc md me mf fq mg ku mh mi aw mj dt"><span id="9f29" class="lc ld ie ku b fv mk ml l mm mn">./compile.sh</span></pre><p id="5fcb" class="pw-post-body-paragraph jt ju ie jv b jw jx jf jy jz ka ji kb kc kd ke kf kg kh ki kj kk kl km kn ko hm dt translated">您应该会看到下面的文件是从Lottery.cpp文件生成的——我们现在已经准备好运行测试了！</p><figure class="mc md me mf fq hv fe ff paragraph-image"><div class="fe ff ms"><img src="../Images/8eae2d97057ed38f932ade673e28766f.png" data-original-src="https://miro.medium.com/v2/resize:fit:960/format:webp/1*IfUU6GDttUP2Kn_vTO7YQw.png"/></div></figure><h2 id="3a08" class="lc ld ie bd le lf lg lh li lj lk ll lm kc ln lo lp kg lq lr ls kk lt lu lv lw dt translated">运行它！</h2><p id="c566" class="pw-post-body-paragraph jt ju ie jv b jw lx jf jy jz ly ji kb kc lz ke kf kg ma ki kj kk mb km kn ko hm dt translated">从根项目目录运行下面的命令，并观察它的运行！</p><pre class="mc md me mf fq mg ku mh mi aw mj dt"><span id="7cbe" class="lc ld ie ku b fv mk ml l mm mn">python3 ./test/lottery.spec.py</span></pre><p id="6e59" class="pw-post-body-paragraph jt ju ie jv b jw jx jf jy jz ka ji kb kc kd ke kf kg kh ki kj kk kl km kn ko hm dt translated">您应该会看到大量的输出，最后一行表示没有错误</p><figure class="mc md me mf fq hv fe ff paragraph-image"><div role="button" tabindex="0" class="hw hx di hy bf hz"><div class="fe ff mt"><img src="../Images/6e5457b40754620680cfa58564d1e063.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HGdCwKdu5zoGSD47SN2M_g.png"/></div></div></figure></div><div class="ab cl kv kw hb kx" role="separator"><span class="ky bw bk kz la lb"/><span class="ky bw bk kz la lb"/><span class="ky bw bk kz la"/></div><div class="hm hn ho hp hq"><h2 id="c4e6" class="lc ld ie bd le lf lg lh li lj lk ll lm kc ln lo lp kg lq lr ls kk lt lu lv lw dt translated">摘要</h2><p id="77de" class="pw-post-body-paragraph jt ju ie jv b jw lx jf jy jz ly ji kb kc lz ke kf kg ma ki kj kk mb km kn ko hm dt translated">启动并运行EOSFactory并不是一项简单的任务，人们不禁要问，<em class="kq">这值得吗？</em>我可以用<em class="kq"> eosjs </em>做一些摩卡规范，然后试着做同样的事情吗？也许我可以也应该做一些测试。事实是，能够将eos实例作为我们单元测试的一部分是非常有价值的，我可能会使用EOSFactory，直到有更好的东西出现。我真的很想有一个类似于truffle的npm实用程序，可以和js一起使用，但我相信随着时间的推移和平台的成熟，它会出现的。为<a class="mu mv gr" href="https://medium.com/u/6874f45b41e1?source=post_page-----aa0394df95d9--------------------------------" rel="noopener" target="_blank"> Tokenika </a>的令人敬畏的产品大声喊出来！</p></div></div>    
</body>
</html>