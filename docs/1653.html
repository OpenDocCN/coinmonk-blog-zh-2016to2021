<html>
<head>
<title>Avenger Bot: A Twitter Bot To Avenge Customer Abuse</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">复仇者机器人:一个报复客户虐待的推特机器人</h1>
<blockquote>原文：<a href="https://medium.com/coinmonks/avenger-bot-a6270ff7a957?source=collection_archive---------5-----------------------#2018-10-14">https://medium.com/coinmonks/avenger-bot-a6270ff7a957?source=collection_archive---------5-----------------------#2018-10-14</a></blockquote><div><div class="ef hh hi hj hk hl"/><div class="hm hn ho hp hq"><figure class="hs ht fm fo hu hv fe ff paragraph-image"><div role="button" tabindex="0" class="hw hx di hy bf hz"><div class="fe ff hr"><img src="../Images/4f1024dcfe14ab3594e1e143260f26a6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DGAoIDBaRCnaeYPRcNVo-g.png"/></div></div></figure><div class=""/><div class=""><h2 id="676d" class="pw-subtitle-paragraph jb id ie bd b jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js ek translated">构建一个多线程机器人来回复选定的推文</h2></div><p id="01ea" class="pw-post-body-paragraph jt ju ie jv b jw jx jf jy jz ka ji kb kc kd ke kf kg kh ki kj kk kl km kn ko hm dt translated"><strong class="jv if">TL；DR: </strong>一个多线程Twitter机器人的完整Java代码，它传播关于客户滥用以及如何(不)被Twitter禁止的消息。</p><p id="67df" class="pw-post-body-paragraph jt ju ie jv b jw jx jf jy jz ka ji kb kc kd ke kf kg kh ki kj kk kl km kn ko hm dt translated">Twitter API是主要互联网组织最早提供的API之一，它可能是全球使用最多的API，尽管在过去几年中Twitter一直在让开发者更难使用它，你可以查看<a class="ae kp" href="https://www.theverge.com/2018/5/16/17362138/twitter-api-third-party-apps-changes-explained" rel="noopener ugc nofollow" target="_blank"> <strong class="jv if">这个</strong> </a>作为例子。不是每个人都在Twitter上，但几乎每个企业都在，尤其是大型电信公司。他们中的大多数甚至通过Twitter提供客户支持，尽管通常很糟糕(支持)，但至少这是一个开放的渠道，你可以与其他沮丧的客户分享你的沮丧。</p><h1 id="5df7" class="kq kr ie bd ks kt ku kv kw kx ky kz la jk lb jl lc jn ld jo le jq lf jr lg lh dt translated">动机</h1><p id="c785" class="pw-post-body-paragraph jt ju ie jv b jw li jf jy jz lj ji kb kc lk ke kf kg ll ki kj kk lm km kn ko hm dt translated">当西班牙的一家主要电信运营商开始大肆追逐我的母亲和我的整个家庭时，因为有人使用她的名字和身份证号码从他们那里欺诈性地购买服务，而这些服务从来没有支付过(看起来他们是故意的？几乎没有任何安全控制，我决定在Twitter上报复。</p><p id="8a10" class="pw-post-body-paragraph jt ju ie jv b jw jx jf jy jz ka ji kb kc kd ke kf kg kh ki kj kk kl km kn ko hm dt translated">我非常生气，Jazztel(电信公司)对寻找真相不感兴趣，他们指责我妈妈不支付她的账单，并威胁她要去法院，这个电话对话(西班牙语)证明了这一点。</p><p id="ea3a" class="pw-post-body-paragraph jt ju ie jv b jw jx jf jy jz ka ji kb kc kd ke kf kg kh ki kj kk kl km kn ko hm dt translated">我从几个月前看的这篇文章中获得了灵感。</p><p id="0f8e" class="pw-post-body-paragraph jt ju ie jv b jw jx jf jy jz ka ji kb kc kd ke kf kg kh ki kj kk kl km kn ko hm dt translated">但我的“<em class="ln">复仇者机器人</em>”比这更复杂，它使用<a class="ae kp" href="https://developer.twitter.com/en/docs/tutorials/consuming-streaming-data.html" rel="noopener ugc nofollow" target="_blank"> <strong class="jv if"> Twitter流媒体API </strong> </a>来监听发给Jazztel的推文，然后用愤怒的抱怨来回复它们(我知道这可能不会有任何影响，但至少这是一种在学习的同时释放我的愤怒的方式，因为这在技术上具有挑战性，我也觉得这很有趣)。</p><h1 id="4f18" class="kq kr ie bd ks kt ku kv kw kx ky kz la jk lb jl lc jn ld jo le jq lf jr lg lh dt translated">履行</h1><p id="7c18" class="pw-post-body-paragraph jt ju ie jv b jw li jf jy jz lj ji kb kc lk ke kf kg ll ki kj kk lm km kn ko hm dt translated">因此，我需要的第一件事是一个Twitter帐户，我的机器人将在这个帐户下运行，然后还有一个“Twitter应用程序”，以便检索针对Twitter API进行身份验证和授权所需的四个安全密钥。</p><p id="0384" class="pw-post-body-paragraph jt ju ie jv b jw jx jf jy jz ka ji kb kc kd ke kf kg kh ki kj kk kl km kn ko hm dt translated">幸运的是，我从我之前的一个宠物项目 的工作中获得了所有这些，因为从几个月前开始，Twitter强迫他们API的新用户注册一个开发者账户，并等待注册(希望)被批准。</p><figure class="lp lq lr ls fq hv fe ff paragraph-image"><div class="fe ff lo"><img src="../Images/015ba320ad87555e99e097265296a905.png" data-original-src="https://miro.medium.com/v2/resize:fit:1280/format:webp/0*r6vxd8KbpuhDIrri.png"/></div></figure><p id="05fe" class="pw-post-body-paragraph jt ju ie jv b jw jx jf jy jz ka ji kb kc kd ke kf kg kh ki kj kk kl km kn ko hm dt translated">然后我开始开发我的机器人，几个晚上之后我就把它准备好了，整个源代码(Java 8)都可以在<a class="ae kp" href="https://github.com/VictorGil/avenger-bot" rel="noopener ugc nofollow" target="_blank"> <strong class="jv if"> GitHub </strong> </a>上找到。</p><p id="e8cc" class="pw-post-body-paragraph jt ju ie jv b jw jx jf jy jz ka ji kb kc kd ke kf kg kh ki kj kk kl km kn ko hm dt translated">这些是<strong class="jv if">的主要特点:</strong></p><p id="9e83" class="pw-post-body-paragraph jt ju ie jv b jw jx jf jy jz ka ji kb kc kd ke kf kg kh ki kj kk kl km kn ko hm dt translated">-四个安全密钥:<br/> <em class="ln">消费者密钥(API密钥)<br/>消费者秘密(API秘密)</em> <br/> <em class="ln">访问令牌</em> <br/> <em class="ln">访问令牌秘密</em> <br/>在<a class="ae kp" href="https://github.com/VictorGil/avenger-bot/blob/master/src/main/resources/config/config.json" rel="noopener ugc nofollow" target="_blank"> <strong class="jv if"> JSON配置文件</strong> </a>中加密，并在运行时使用存储在环境变量中的密码解密。</p><p id="5359" class="pw-post-body-paragraph jt ju ie jv b jw jx jf jy jz ka ji kb kc kd ke kf kg kh ki kj kk kl km kn ko hm dt translated">-它通过Spring Framework使用非常简单的依赖注入，我选择XML配置而不是注释，因为正如Sam Atkinson在四年半多前他的<a class="ae kp" href="http://samatkinson.com/why-i-hate-spring/" rel="noopener ugc nofollow" target="_blank"> <strong class="jv if">著名帖子</strong> </a>中所说:<em class="ln">我不喜欢魔术。<br/> </em>我也不喜欢在XML中使用"<em class="ln">代码</em>"，这就是为什么我说"<strong class="jv if"><em class="ln"/></strong><em class="ln"/><strong class="jv if"><em class="ln">简单的</em> </strong> <em class="ln">依赖注入</em>"之前，我强烈认为Spring(或任何其他DI框架)应该被使用<strong class="jv if">只是为了将beans连接在一起</strong>，仅此而已，没有智能/定制类型转换，没有SpEL，等等</p><p id="ad00" class="pw-post-body-paragraph jt ju ie jv b jw jx jf jy jz ka ji kb kc kd ke kf kg kh ki kj kk kl km kn ko hm dt translated">-它使用一个<a class="ae kp" href="https://github.com/VictorGil/avenger-bot/blob/master/src/main/java/net/devaction/avengerbot/tweetscapturedproducer/TweetsQueueImpl.java" rel="noopener ugc nofollow" target="_blank"> <strong class="jv if">阻塞队列</strong> </a>来实现生产者/消费者模式。</p><p id="b54a" class="pw-post-body-paragraph jt ju ie jv b jw jx jf jy jz ka ji kb kc kd ke kf kg kh ki kj kk kl km kn ko hm dt translated">-应用程序在Linux上通过实现<a class="ae kp" href="https://github.com/VictorGil/avenger-bot/blob/master/src/main/java/net/devaction/avengerbot/main/Manager.java#L17" rel="noopener ugc nofollow" target="_blank"><strong class="jv if">signal handler</strong></a>接口接收到WINCH信号后正确关闭(优雅地从tweets流中断开连接)(这个关闭机制的完整动机和解释值得我在不久的将来写一篇自己的帖子)。</p><p id="2806" class="pw-post-body-paragraph jt ju ie jv b jw jx jf jy jz ka ji kb kc kd ke kf kg kh ki kj kk kl km kn ko hm dt translated">bot使用<a class="ae kp" href="http://twitter4j.org/" rel="noopener ugc nofollow" target="_blank"> <strong class="jv if"> Twitter4j </strong> </a>库，所以我不需要直接处理REST/HTTP。</p><p id="2f05" class="pw-post-body-paragraph jt ju ie jv b jw jx jf jy jz ka ji kb kc kd ke kf kg kh ki kj kk kl km kn ko hm dt translated">-没有单元测试，但至少包含了一些“<em class="ln">测试器</em>”类，它们帮助我在编写代码时验证代码。</p><h1 id="c0d6" class="kq kr ie bd ks kt ku kv kw kx ky kz la jk lb jl lc jn ld jo le jq lf jr lg lh dt translated">执行</h1><p id="96c8" class="pw-post-body-paragraph jt ju ie jv b jw li jf jy jz lj ji kb kc lk ke kf kg ll ki kj kk lm km kn ko hm dt translated">在我完成编码后，我准备运行它，看看机器人在行动。</p><p id="28e3" class="pw-post-body-paragraph jt ju ie jv b jw jx jf jy jz ka ji kb kc kd ke kf kg kh ki kj kk kl km kn ko hm dt translated">我第一次启动它时，一切似乎都很好，每次发布包含在<a class="ae kp" href="https://github.com/VictorGil/avenger-bot/blob/master/src/main/resources/config/config.json#L7" rel="noopener ugc nofollow" target="_blank"> <strong class="jv if"> config.json </strong> </a>中定义的关键字的新推文时，机器人都会在等待半随机时间后回复。</p><figure class="lp lq lr ls fq hv fe ff paragraph-image"><div class="fe ff lt"><img src="../Images/fdfee4c99941137e9fdede97de3055cc.png" data-original-src="https://miro.medium.com/v2/resize:fit:884/format:webp/0*BFJTWcIBCtHtqEU_.png"/></div></figure><p id="c8fa" class="pw-post-body-paragraph jt ju ie jv b jw jx jf jy jz ka ji kb kc kd ke kf kg kh ki kj kk kl km kn ko hm dt translated">但是过了一个小时左右，我得到了下面这个难看的错误:</p><figure class="lp lq lr ls fq hv fe ff paragraph-image"><div class="fe ff lo"><img src="../Images/11f83a4624ab22895f49ff7cc15457d1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1280/format:webp/0*ZeHQ7RkvhfNWtvsf.png"/></div></figure><p id="8b73" class="pw-post-body-paragraph jt ju ie jv b jw jx jf jy jz ka ji kb kc kd ke kf kg kh ki kj kk kl km kn ko hm dt translated">这意味着我的应用程序被禁止发布推文，尽管它仍然可以阅读它们。我也可以在Twitter网络用户界面上看到它</p><figure class="lp lq lr ls fq hv fe ff paragraph-image"><div class="fe ff lu"><img src="../Images/8858a6f7a8f36cbcc745e6721d0e266b.png" data-original-src="https://miro.medium.com/v2/resize:fit:640/format:webp/0*7r4wF6vvB7izGt_Z.png"/></div></figure><p id="f2c9" class="pw-post-body-paragraph jt ju ie jv b jw jx jf jy jz ka ji kb kc kd ke kf kg kh ki kj kk kl km kn ko hm dt translated">但是为什么呢？我一直小心翼翼地不去达到Twitter API的限制，我的机器人总是在两个连续的tweet提交之间等待超过2.5分钟，远远超过36秒的限制。</p><p id="8016" class="pw-post-body-paragraph jt ju ie jv b jw jx jf jy jz ka ji kb kc kd ke kf kg kh ki kj kk kl km kn ko hm dt translated">经过一番研究，我在Twitter垃圾邮件规则中找到了答案:</p><figure class="lp lq lr ls fq hv fe ff paragraph-image"><div class="fe ff lo"><img src="../Images/ff86fc0b91118dc31c8dd4819510050a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1280/format:webp/0*IONa2qOABwWLTf4T.png"/></div></figure><p id="9875" class="pw-post-body-paragraph jt ju ie jv b jw jx jf jy jz ka ji kb kc kd ke kf kg kh ki kj kk kl km kn ko hm dt translated">我的机器人从20条文本中随机选择推文的内容，因此在发布了几条包含相同文本的推文后，我的应用程序被禁止了。</p><h1 id="d1e9" class="kq kr ie bd ks kt ku kv kw kx ky kz la jk lb jl lc jn ld jo le jq lf jr lg lh dt translated">未来的工作</h1><p id="c6dc" class="pw-post-body-paragraph jt ju ie jv b jw li jf jy jz lj ji kb kc lk ke kf kg ll ki kj kk lm km kn ko hm dt translated">所有软件开发人员都讨厌松散的需求，但它们是日常事务，而像Scrum这样的完整方法论就是为了解决这个问题而产生的。</p><p id="54bf" class="pw-post-body-paragraph jt ju ie jv b jw jx jf jy jz ka ji kb kc kd ke kf kg kh ki kj kk kl km kn ko hm dt translated">在这种情况下，几个悬而未决的问题浮现在我的脑海:<br/> <em class="ln">到底是什么让两条推文“基本相似”？<br/>如果两条推文包含相同的单词，但顺序不同，Twitter会认为它们是重复的吗？<br/>如果只有80%的词是一样的呢？如果只有60%呢？一天只重复一次同样的推文可以吗？或者一周一次？</em></p><p id="5433" class="pw-post-body-paragraph jt ju ie jv b jw jx jf jy jz ka ji kb kc kd ke kf kg kh ki kj kk kl km kn ko hm dt translated">Twitter文档故意不回答这些问题，并且从其他来源获得的信息是<a class="ae kp" href="https://code.tutsplus.com/tutorials/using-the-twitter-api-to-tweet-repetitive-content--cms-28096" rel="noopener ugc nofollow" target="_blank"><strong class="jv if"/></a>。所以我唯一的选择就是实验和测试。</p><p id="8695" class="pw-post-body-paragraph jt ju ie jv b jw jx jf jy jz ka ji kb kc kd ke kf kg kh ki kj kk kl km kn ko hm dt translated">这是否意味着所有的争论都是徒劳的？绝对不行！我有了一个想法，一个挑战，并完成了它。有些事情困扰着我，我做了些什么(我也很享受)。因此，尽管由于一些不可预见的限制，结果并不理想，但整个经历是完全值得的。<br/>我必须尝试一些对我来说新的东西，我也有机会与任何可能对它感兴趣的人分享整个故事。</p><p id="a4aa" class="pw-post-body-paragraph jt ju ie jv b jw jx jf jy jz ka ji kb kc kd ke kf kg kh ki kj kk kl km kn ko hm dt translated">目前，我正在等待我的Twitter开发者请求被接受，以便我可以创建一个新的应用程序。一旦我能够再次使用API发布推文，我甚至可能会做一些研究并加入一些人工智能，以便生成足够清晰的推文来发布，而不会被Twitter禁止…</p><p id="3253" class="pw-post-body-paragraph jt ju ie jv b jw jx jf jy jz ka ji kb kc kd ke kf kg kh ki kj kk kl km kn ko hm dt translated">因此，如果我找到一个变通办法，我也可能会启动我的复仇者机器人来对付另一家不尊重他们的客户/乘客的公司:<a class="ae kp" rel="noopener" href="/p/826c1bb4add0"><strong class="jv if">【smart wings</strong></a>。<br/>敬请期待！</p><p id="e3d5" class="pw-post-body-paragraph jt ju ie jv b jw jx jf jy jz ka ji kb kc kd ke kf kg kh ki kj kk kl km kn ko hm dt translated"><em class="ln">原载于</em><a class="ae kp" href="https://www.devaction.net/2018/10/avenger-bot.html" rel="noopener ugc nofollow" target="_blank"><strong class="jv if"><em class="ln">www.devaction.net</em></strong></a><em class="ln">。</em></p><blockquote class="lv"><p id="790f" class="lw lx ie bd ly lz ma mb mc md me ko ek translated"><a class="ae kp" href="https://coincodecap.com/?utm_source=coinmonks" rel="noopener ugc nofollow" target="_blank">直接在您的收件箱中获得最佳软件交易</a></p></blockquote><figure class="mg mh mi mj mk hv fe ff paragraph-image"><a href="https://coincodecap.com/?utm_source=coinmonks"><div class="fe ff mf"><img src="../Images/7c0b3dfdcbfea594cc0ae7d4f9bf6fcb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1168/format:webp/0*OJ-qb5G6i863msBB.png"/></div></a></figure></div></div>    
</body>
</html>