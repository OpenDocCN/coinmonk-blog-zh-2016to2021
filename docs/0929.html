<html>
<head>
<title>Specific fee routing for multi-path payments in Lightning Networks</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">闪电网络中多路径支付的特定费用路由</h1>
<blockquote>原文：<a href="https://medium.com/coinmonks/specific-fee-routing-for-multi-path-payments-in-lightning-networks-b0e662c79819?source=collection_archive---------4-----------------------#2018-07-02">https://medium.com/coinmonks/specific-fee-routing-for-multi-path-payments-in-lightning-networks-b0e662c79819?source=collection_archive---------4-----------------------#2018-07-02</a></blockquote><div><div class="ef hh hi hj hk hl"/><div class="hm hn ho hp hq"><div class=""/><div class=""><h2 id="2391" class="pw-subtitle-paragraph iq hs ht bd b ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ek translated">支付费用最小化的启发式算法</h2></div><figure class="jj jk jl jm fq jn fe ff paragraph-image"><div role="button" tabindex="0" class="jo jp di jq bf jr"><div class="fe ff ji"><img src="../Images/c9171f936df6239d9ad9c5fc607c3e15.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*74rh2aieT7gi5jUnv8A1Aw.jpeg"/></div></div><figcaption class="ju jv fg fe ff jw jx bd b be z ek">Photo by <a class="ae jy" href="https://unsplash.com/photos/br9D5K3UTRQ?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">Nick Fewings</a> on <a class="ae jy" href="https://unsplash.com/search/photos/highway?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="b404" class="pw-post-body-paragraph jz ka ht kb b kc kd iu ke kf kg ix kh ki kj kk kl km kn ko kp kq kr ks kt ku hm dt translated">本文假设读者熟悉比特币、闪电、<a class="ae jy" href="https://lists.linuxfoundation.org/pipermail/lightning-dev/2018-February/000993.html" rel="noopener ugc nofollow" target="_blank">原子多路(AMP)支付</a>和<a class="ae jy" rel="noopener" href="/p/6409201ff5ed">与金额无关的路由</a>的概念。</p><p id="9847" class="pw-post-body-paragraph jz ka ht kb b kc kd iu ke kf kg ix kh ki kj kk kl km kn ko kp kq kr ks kt ku hm dt translated">简而言之，AMP就是将一笔付款拆分成多个部分付款，共同构成总金额。只有当所有部分付款都已收到时，收款人才能要求全额付款。这是它的<em class="kv">原子</em>方面。</p><p id="62d9" class="pw-post-body-paragraph jz ka ht kb b kc kd iu ke kf kg ix kh ki kj kk kl km kn ko kp kq kr ks kt ku hm dt translated">本文描述了一个使用route属性的多路径支付路由算法，该属性将作为<em class="kv">特定费用</em>引入。它不是关于原子性的解决方案。</p><h2 id="a471" class="kw kx ht bd ky kz la lb lc ld le lf lg ki lh li lj km lk ll lm kq ln lo lp lq dt translated">目标</h2><p id="49a0" class="pw-post-body-paragraph jz ka ht kb b kc lr iu ke kf ls ix kh ki lt kk kl km lu ko kp kq lv ks kt ku hm dt translated">给定闪电信道图、目的地节点和支付金额，找出一组路径和部分金额，这些路径和部分金额一起导致最小可能的总费用。</p><p id="07c5" class="pw-post-body-paragraph jz ka ht kb b kc kd iu ke kf kg ix kh ki kj kk kl km kn ko kp kq kr ks kt ku hm dt translated">在下图中，爱丽丝和查理之间有两个通道。两个信道在A到c方向都有10 sat的容量，不涉及费用，因为没有中间跳。</p><figure class="jj jk jl jm fq jn fe ff paragraph-image"><div class="fe ff lw"><img src="../Images/c9c10c90a2d73524f03f1be533425120.png" data-original-src="https://miro.medium.com/v2/resize:fit:422/format:webp/1*35-LeFx33uMfjcUv2CpOEQ.png"/></div></figure><p id="c395" class="pw-post-body-paragraph jz ka ht kb b kc kd iu ke kf kg ix kh ki kj kk kl km kn ko kp kq kr ks kt ku hm dt translated">在此图中，发送15 sat的付款仅可能使用两次部分付款，每次不超过10 sat，合计15 sat。</p><p id="74e6" class="pw-post-body-paragraph jz ka ht kb b kc kd iu ke kf kg ix kh ki kj kk kl km kn ko kp kq kr ks kt ku hm dt translated">下图变得更有趣了:</p><figure class="jj jk jl jm fq jn fe ff paragraph-image"><div class="fe ff lx"><img src="../Images/5c6ba908758eaf57ce35cae9986e3c52.png" data-original-src="https://miro.medium.com/v2/resize:fit:1064/format:webp/1*QiPxcURFR7qfgAtahssF4A.png"/></div></figure><p id="f559" class="pw-post-body-paragraph jz ka ht kb b kc kd iu ke kf kg ix kh ki kj kk kl km kn ko kp kq kr ks kt ku hm dt translated">这里，Alice不需要构建多路径支付。她可以通过Bob与Charlie的昂贵的2+50%渠道一次性支付15个sat。总费用为9.5 sat。通过较便宜的渠道进行单次支付是不可能的，因为该渠道的容量只有10 sat。</p><p id="601e" class="pw-post-body-paragraph jz ka ht kb b kc kd iu ke kf kg ix kh ki kj kk kl km kn ko kp kq kr ks kt ku hm dt translated">然而，如果她使用两种渠道，并且不通过昂贵的渠道发送不必要的费用，她最终将得到:(2+5的50)+(3+10的10) = 4.5 + 4 = 8.5 sat的总费用。</p><p id="2cb7" class="pw-post-body-paragraph jz ka ht kb b kc kd iu ke kf kg ix kh ki kj kk kl km kn ko kp kq kr ks kt ku hm dt translated">这也说明，如果单个路径的支付是不可能的，那么任何只将支付分成多个路径的算法都不可能是最优的。</p><h2 id="aeab" class="kw kx ht bd ky kz la lb lc ld le lf lg ki lh li lj km lk ll lm kq ln lo lp lq dt translated">复杂性</h2><p id="09cc" class="pw-post-body-paragraph jz ka ht kb b kc lr iu ke kf ls ix kh ki lt kk kl km lu ko kp kq lv ks kt ku hm dt translated">考虑下图。从B到C有多个渠道，都只有基础费，没有比例费成分。要支付100 sat，有多种方式组成多路径支付。</p><figure class="jj jk jl jm fq jn fe ff paragraph-image"><div role="button" tabindex="0" class="jo jp di jq bf jr"><div class="fe ff ly"><img src="../Images/1a7f678744cff9834bcb22649c94133d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*l9eOwmZgl6RU9hbSKStakA.png"/></div></div></figure><p id="21d1" class="pw-post-body-paragraph jz ka ht kb b kc kd iu ke kf kg ix kh ki kj kk kl km kn ko kp kq kr ks kt ku hm dt translated">事实上，有了这样的图，多路径路由问题开始类似于背包问题，<a class="ae jy" href="https://en.wikipedia.org/wiki/Knapsack_problem" rel="noopener ugc nofollow" target="_blank">https://en.wikipedia.org/wiki/Knapsack_problem</a>。</p><blockquote class="lz ma mb"><p id="a315" class="jz ka kv kb b kc kd iu ke kf kg ix kh mc kj kk kl md kn ko kp me kr ks kt ku hm dt translated">给定一组项目，每个项目都有一个权重和值，确定集合中要包含的每个项目的数量，使总权重小于或等于给定的限制，并且总值尽可能大</p></blockquote><p id="7ca7" class="pw-post-body-paragraph jz ka ht kb b kc kd iu ke kf kg ix kh ki kj kk kl km kn ko kp kq kr ks kt ku hm dt translated">物品是渠道，重量是容量，价值是费用。这并不完全一样，因为我们正在寻找总重量(容量)超过限额(付款金额)且总价值(费用)尽可能小的物品。</p><p id="8408" class="pw-post-body-paragraph jz ka ht kb b kc kd iu ke kf kg ix kh ki kj kk kl km kn ko kp kq kr ks kt ku hm dt translated">真实频道图更复杂，并且每个部分付费减少了频道中可用于进一步部分付费的剩余容量。此外，需要在去往目标节点的路由上添加费用，从而减少最大支付金额。直觉上，我认为多路径路由问题至少和背包问题一样难解决，但是没有证据。</p><p id="1a06" class="pw-post-body-paragraph jz ka ht kb b kc kd iu ke kf kg ix kh ki kj kk kl km kn ko kp kq kr ks kt ku hm dt translated">这也意味着路由算法需要使用启发式算法来解决问题。</p><h2 id="2d24" class="kw kx ht bd ky kz la lb lc ld le lf lg ki lh li lj km lk ll lm kq ln lo lp lq dt translated">与金额无关的路由</h2><p id="01e1" class="pw-post-body-paragraph jz ka ht kb b kc lr iu ke kf ls ix kh ki lt kk kl km lu ko kp kq lv ks kt ku hm dt translated">在当前的Lightning实现中，查找路线的过程是针对特定的支付金额来执行的。它返回特定数量的最佳路径。</p><p id="a5fb" class="pw-post-body-paragraph jz ka ht kb b kc kd iu ke kf kg ix kh ki kj kk kl km kn ko kp kq kr ks kt ku hm dt translated">对于多路径路由，这样一个特定数量的数据点不是很有用。有许多划分需要考虑，像这样对整个支付金额范围进行抽样是没有效率的。</p><p id="9d15" class="pw-post-body-paragraph jz ka ht kb b kc kd iu ke kf kg ix kh ki kj kk kl km kn ko kp kq kr ks kt ku hm dt translated">相反，需要的是一组唯一的路线，每个路线对应一个或多个支付金额范围。该集合可以通过使用<a class="ae jy" rel="noopener" href="/p/6409201ff5ed">独立于数量的路由算法</a>获得。</p><h2 id="45ca" class="kw kx ht bd ky kz la lb lc ld le lf lg ki lh li lj km lk ll lm kq ln lo lp lq dt translated">多途径支付</h2><p id="de31" class="pw-post-body-paragraph jz ka ht kb b kc lr iu ke kf ls ix kh ki lt kk kl km lu ko kp kq lv ks kt ku hm dt translated">从独立于数量的路由，到多路径路由的步骤相对简单。但是让我强调一下，下面的内容并不保证会产生最佳的多路径划分。</p><p id="e45a" class="pw-post-body-paragraph jz ka ht kb b kc kd iu ke kf kg ix kh ki kj kk kl km kn ko kp kq kr ks kt ku hm dt translated">基本想法很简单:对于第一次部分付款，选择金额和路线，给出最低的具体费用。具体费用定义为支付给目标节点的每笔<em class="kv">费用。例如，如果10 sat费用可以支付100 sat，或者12 sat费用可以支付150 sat，那么将后者作为第一部分付款(0.08 sat/sat vs 0.10 sat/sat)。这是算法的核心启发式部分。</em></p><p id="7bdf" class="pw-post-body-paragraph jz ka ht kb b kc kd iu ke kf kg ix kh ki kj kk kl km kn ko kp kq kr ks kt ku hm dt translated">没有必要考虑所有的支付金额。对于单一路线，复合费用为<em class="kv">基础费用+费率*金额</em>。这意味着每次satoshi的最低费用总是在这条路线可以运载的最大数量时达到。金额越高，基本费用的相对影响越低。</p><p id="f627" class="pw-post-body-paragraph jz ka ht kb b kc kd iu ke kf kg ix kh ki kj kk kl km kn ko kp kq kr ks kt ku hm dt translated">因此，对于每条路线，每个satoshi的费用是根据其范围的上限计算的，结果最低的路线被选择作为第一部分付款。这也意味着在选择低费用、低容量的路线之前，可能会选择高费用、高容量的路线。比如10+2%到100 (0.12 sat/sat)用在10+1%到50 (0.21 sat/sat)之前。</p><p id="242f" class="pw-post-body-paragraph jz ka ht kb b kc kd iu ke kf kg ix kh ki kj kk kl km kn ko kp kq kr ks kt ku hm dt translated">在第一次部分支付之后，通过减去这些信道为第一次部分支付所携带的金额和费用来更新可用的信道容量。</p><p id="ed37" class="pw-post-body-paragraph jz ka ht kb b kc kd iu ke kf kg ix kh ki kj kk kl km kn ko kp kq kr ks kt ku hm dt translated">然后，该过程通过再次运行与金额无关的路由算法、根据相同的特定费用标准选择第二部分支付并更新容量来继续。</p><p id="ea8e" class="pw-post-body-paragraph jz ka ht kb b kc kd iu ke kf kg ix kh ki kj kk kl km kn ko kp kq kr ks kt ku hm dt translated">重复该循环，直到再也找不到路线或者已经支付了所需的支付金额。</p><h2 id="45a2" class="kw kx ht bd ky kz la lb lc ld le lf lg ki lh li lj km lk ll lm kq ln lo lp lq dt translated">示例输出</h2><p id="1338" class="pw-post-body-paragraph jz ka ht kb b kc lr iu ke kf ls ix kh ki lt kk kl km lu ko kp kq lv ks kt ku hm dt translated">下面是所描述算法的输出截图。</p><figure class="jj jk jl jm fq jn fe ff paragraph-image"><div role="button" tabindex="0" class="jo jp di jq bf jr"><div class="fe ff mf"><img src="../Images/2966bc36f96759f0634d93f51c2790e8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QZQN0gfkBvHz6xlQKLTFow.png"/></div></div></figure><p id="5615" class="pw-post-body-paragraph jz ka ht kb b kc kd iu ke kf kg ix kh ki kj kk kl km kn ko kp kq kr ks kt ku hm dt translated">连接良好的节点通常会出现的情况是，有大量可能的路径通往目的地，随着支付金额的增加，越来越多的节点会参与多路径支付。</p><h2 id="5eec" class="kw kx ht bd ky kz la lb lc ld le lf lg ki lh li lj km lk ll lm kq ln lo lp lq dt translated">次优</h2><p id="79fd" class="pw-post-body-paragraph jz ka ht kb b kc lr iu ke kf ls ix kh ki lt kk kl km lu ko kp kq lv ks kt ku hm dt translated">存在这样的情况，其中该算法返回次优结果。在Lightning实施中，将针对特定数量执行多路径路由。这意味着几乎总是最后的部分支付没有使用路由的全部容量。倒数第二个部分不考虑这一点。倒数第二次付款可能具有最低的每周六费用，但另一条路线可能能够携带全部余额并避免第二次基本费用。</p><p id="5a50" class="pw-post-body-paragraph jz ka ht kb b kc kd iu ke kf kg ix kh ki kj kk kl km kn ko kp kq kr ks kt ku hm dt translated">可能有更多导致次优结果的情况。需要进一步调查。</p><p id="35ce" class="pw-post-body-paragraph jz ka ht kb b kc kd iu ke kf kg ix kh ki kj kk kl km kn ko kp kq kr ks kt ku hm dt translated">(强力)多路径路由测试集对于基准算法也是有用的。</p><h2 id="90ed" class="kw kx ht bd ky kz la lb lc ld le lf lg ki lh li lj km lk ll lm kq ln lo lp lq dt translated">结果</h2><p id="5fba" class="pw-post-body-paragraph jz ka ht kb b kc lr iu ke kf ls ix kh ki lt kk kl km lu ko kp kq lv ks kt ku hm dt translated">对于本文中描述的算法产生的最优单路径支付与多路径支付的费用水平，没有大量的测试结果可用。但是通常收益是巨大的。关于从雅尔斯到Satoshi住处的路线示例，请参见下面的图表。作为用户，你不再依赖于稀缺、高容量、高收费的频道。</p><figure class="jj jk jl jm fq jn fe ff paragraph-image"><div class="fe ff mg"><img src="../Images/34db0144eac87ea849f298a87168435c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1352/format:webp/1*cdN6DjmLmNUAM5lk4QVFag.png"/></div><figcaption class="ju jv fg fe ff jw jx bd b be z ek">Single-path fees</figcaption></figure><figure class="jj jk jl jm fq jn fe ff paragraph-image"><div class="fe ff mh"><img src="../Images/59b9222219c1b48e80ee24b0ed047a8e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1320/format:webp/1*gZAiqXtPtotRobxpd31Yuw.png"/></div><figcaption class="ju jv fg fe ff jw jx bd b be z ek">Multi-path fees</figcaption></figure><h2 id="cf22" class="kw kx ht bd ky kz la lb lc ld le lf lg ki lh li lj km lk ll lm kq ln lo lp lq dt translated">最后的话</h2><p id="1a0b" class="pw-post-body-paragraph jz ka ht kb b kc lr iu ke kf ls ix kh ki lt kk kl km lu ko kp kq lv ks kt ku hm dt translated">原子多路径支付的想法非常有前途。未解决的问题是是否有一种算法可以在合理的计算时间内提供有保证的最佳路线。</p><p id="623a" class="pw-post-body-paragraph jz ka ht kb b kc kd iu ke kf kg ix kh ki kj kk kl km kn ko kp kq kr ks kt ku hm dt translated">实际上，任何合理的多路径路由算法都可以节省大量成本。通过这篇文章，我希望贡献出一种合理的算法。</p></div></div>    
</body>
</html>