<html>
<head>
<title>Caffeine for Ethereum: the NodeJS Oracle that empowers DApps</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">以太坊的咖啡因:赋予DApps力量的NodeJS神谕</h1>
<blockquote>原文：<a href="https://medium.com/coinmonks/caffeine-for-ethereum-the-nodejs-oracle-987b8db13a5c?source=collection_archive---------2-----------------------#2019-01-11">https://medium.com/coinmonks/caffeine-for-ethereum-the-nodejs-oracle-987b8db13a5c?source=collection_archive---------2-----------------------#2019-01-11</a></blockquote><div><div class="ef hh hi hj hk hl"/><div class="hm hn ho hp hq"><div class=""/><p id="96fd" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">一段时间以前，我不得不写一份基于以太坊的合同，作为信托。该信托的所有者能够向该合同发送乙醚，然后该合同本身在每月15日将一些乙醚转移到会员的钱包中。转移给每个成员的乙醚量基于成员资格的长度和当前的美元汇率。</p><p id="8882" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">设计这样一个信托基金是可行的，但我经常对稳健的本质感到绝望。这就是为什么我决定在Solidity中实现一种开发智能合同的更智能的方式。我将向您展示如何以更智能的方式实现这种信任——用更少的代码、更少的压力和合同本身更多的自主权。</p><figure class="jp jq jr js fq jt fe ff paragraph-image"><div class="fe ff jo"><img src="../Images/9a2c679ba5c185be6891b273d8725e22.png" data-original-src="https://miro.medium.com/v2/resize:fit:800/format:webp/1*36bKhh4wGpEsExGX0YEbOg.jpeg"/></div></figure><h1 id="213d" class="jw jx ht bd jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt dt translated">首先，看看令人痛苦的“今天是怎么做的”代码</h1><p id="9336" class="pw-post-body-paragraph iq ir ht is b it ku iv iw ix kv iz ja jb kw jd je jf kx jh ji jj ky jl jm jn hm dt translated">开发一个基于以太坊的契约可能会变得相当耗时，因为以太坊自己的编程语言的可靠性有些奇怪和有限。这就是为什么用Solidity写的智能合约大部分都很简单，业务逻辑都在外面实现。</p><p id="dafa" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated"><a class="ae kz" rel="noopener" href="/@daniel.jozsef"> Daniel Joszef </a>在2018年写了一篇关于此事的漂亮的<a class="ae kz" rel="noopener" href="/@daniel.jozsef/on-the-evm-solidity-ivy-and-giving-idiocy-a-platform-8b133982d9c2">帖子</a>:</p><blockquote class="la lb lc"><p id="14c5" class="iq ir ld is b it iu iv iw ix iy iz ja le jc jd je lf jg jh ji lg jk jl jm jn hm dt translated">可靠之所以成为如此热门的现象，是因为它让人们<em class="ht">相信</em>他们可以编写以太坊代码。毕竟，智能契约并不复杂(考虑到平台的限制，它<em class="ht">不能</em>太复杂)…但是，这与一种远非显而易见的语言结构相结合(你知道Solidity有<em class="ht">指针</em>吗，甚至更糟的是，<a class="ae kz" rel="noopener" href="/cryptronics/storage-allocation-exploits-in-ethereum-smart-contracts-16c2aa312743">指针<em class="ht">算法</em> </a>？)，还有一百万加一的方法搞砸。</p></blockquote><p id="25a5" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">现在让我们回到我不久前开发的简单信托:有一个所有者和一些信托成员。你需要在每个月15日根据当前的瑞士法郎对美元的汇率支付一些钱。</p><p id="099c" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">整个合同开始时非常简单:</p><figure class="jp jq jr js fq jt"><div class="bz el l di"><div class="lh li l"/></div></figure><p id="298a" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">在<code class="eh lj lk ll lm b">function NewMembership</code>中，第一拳击中了你的开发者的肝脏:今天是几号？我只想知道当前的年份和月份，但是计算这些值需要我在互联网上搜索解决方案。幸运的是，我发现了P <a class="ae kz" href="https://github.com/pipermerriam" rel="noopener ugc nofollow" target="_blank"> iper Merriam </a>早在2017年完成的一项伟大的<a class="ae kz" href="https://github.com/pipermerriam/ethereum-datetime/blob/master/contracts/DateTime.sol" rel="noopener ugc nofollow" target="_blank"> 216行固化代码</a>工作。</p><p id="a7c1" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">既然坚固性本身无法调用外界(<em class="ld">是的！在区块链</em>之外还有另一个世界。作为一名开发者，你需要离开区块链以太坊来获得ETH对美元的汇率。oracle是查找和验证这些信息的代理。Oraclize是Solidity开发人员使用最多的oracle，开发非常简单:</p><figure class="jp jq jr js fq jt"><div class="bz el l di"><div class="lh li l"/></div></figure><p id="9f4a" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated"><strong class="is hu">总结</strong>:</p><ul class=""><li id="c9a5" class="ln lo ht is b it iu ix iy jb lp jf lq jj lr jn ls lt lu lv dt translated">我们有287行通过编译器检查的可靠性代码</li><li id="4fcc" class="ln lo ht is b it lw ix lx jb ly jf lz jj ma jn ls lt lu lv dt translated">我们已经花了很多时间来测试松露，混合等。—检查</li><li id="ed5f" class="ln lo ht is b it lw ix lx jb ly jf lz jj ma jn ls lt lu lv dt translated">我们有日期的解决方案—检查</li><li id="b46d" class="ln lo ht is b it lw ix lx jb ly jf lz jj ma jn ls lt lu lv dt translated">我们得到了瑞士法郎对美元的汇率——核对</li><li id="24ac" class="ln lo ht is b it lw ix lx jb ly jf lz jj ma jn ls lt lu lv dt translated">我们已经花了0.001923瑞士法郎的煤气费——检查</li><li id="1f42" class="ln lo ht is b it lw ix lx jb ly jf lz jj ma jn ls lt lu lv dt translated">我们有一个聪明的合同，在每个月的15号支付一些钱— <strong class="is hu">等等</strong></li></ul><p id="8597" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">合同不能在每月15日生效。我们需要另一个区块链以外的解决方案，它必须确保在每15日调用合同… <strong class="is hu">这一切都让我不高兴</strong>。这就是为什么我决定在Solidity中寻找一种更智能的方式来编写智能合同。</p><h1 id="49b7" class="jw jx ht bd jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt dt translated">介绍在Solidity中编写智能合同的更智能方式</h1><p id="5413" class="pw-post-body-paragraph iq ir ht is b it ku iv iw ix kv iz ja jb kw jd je jf kx jh ji jj ky jl jm jn hm dt translated">我是以太坊的超级粉丝。稳健是可以的——但不是很好。实现真实世界的业务逻辑非常耗时，有时甚至是不可能的。我相信，如果智能合约中实现了更多真实的业务逻辑，那么我们都将挖掘以太坊作为加密平台的全部潜力。</p><p id="d158" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">我喜欢NodeJS和JavaScript。每当我写复杂的可靠性代码时，我都会问自己“<em class="ld">为什么会这么复杂？在JavaScript中，这将非常容易……</em>”</p><p id="f118" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">例如，找出离下个月的15号还有多少天:</p><figure class="jp jq jr js fq jt"><div class="bz el l di"><div class="lh li l"/></div></figure><p id="be3f" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">或者计算信托成员资格的持续时间，然后询问北海巨妖关于当前的ETH对美元的汇率，最后计算关于成员资格持续时间的信托支付值:</p><figure class="jp jq jr js fq jt"><div class="bz el l di"><div class="lh li l"/></div></figure><p id="0b75" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">但那是NodeJS代码。不能用在实处？不，除非有先知。根本没有。直到2018年11月我决定实施一个。我称之为<a class="ae kz" href="https://github.com/CaptainJavaScript" rel="noopener ugc nofollow" target="_blank"> CaptainJS' #ScriptIt </a>，它允许你将NodeJS代码直接集成到Solidity中，编译整个代码，并将业务逻辑和数据存储到以太坊区块链中。</p><p id="e087" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">结果是，结合NodeJS代码和Solidity不仅增加了Solidity的潜力，还大大减少了您的开发和测试时间。</p><p id="c65f" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated"><strong class="is hu">现在让我们用Solidity和NodeJS代码编写相同的trust】。这样的合同一定是<code class="eh lj lk ll lm b">usingCaptainJS</code>。然后整个魔术就可以开始了:</strong></p><figure class="jp jq jr js fq jt"><div class="bz el l di"><div class="lh li l"/></div></figure><p id="22bb" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">差异从<code class="eh lj lk ll lm b">constructor</code>开始。在<code class="eh lj lk ll lm b">constructor</code>中，我们将强制合约在下个月的15号自动回调。因此，一旦我们部署了它，它会自动调用自己。不需要外部调用。您可以向信任发送以太网，向信任添加成员(外部)。但是信托会自己执行它的商业逻辑:</p><figure class="jp jq jr js fq jt"><div class="bz el l di"><div class="lh li l"/></div></figure><p id="abad" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">在<code class="eh lj lk ll lm b">function DaysUntilNext15th</code>中，你用一个<code class="eh lj lk ll lm b">string</code>嵌入NodeJS代码。然后你调用<code class="eh lj lk ll lm b">usingCaptainJS</code>的<code class="eh lj lk ll lm b">Run</code>方法，用一个惟一的Id传递代码来标识你的回调，并通知NodeJS容器加载模块<code class="eh lj lk ll lm b">moment</code>。</p><p id="e0db" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">当这个JavaScript代码在NodeJS容器中执行时，如果没有错误，#ScriptIt oracle将调用<code class="eh lj lk ll lm b">function CaptainsResult</code>。剩下的代码流是</p><ul class=""><li id="5fe3" class="ln lo ht is b it iu ix iy jb lp jf lq jj lr jn ls lt lu lv dt translated">如果今天是15号，那么调用<code class="eh lj lk ll lm b">function Payout</code></li><li id="9cd0" class="ln lo ht is b it lw ix lx jb ly jf lz jj ma jn ls lt lu lv dt translated">否则在下个月15日收回该合同(用<code class="eh lj lk ll lm b">function CallbackOn15th</code></li></ul><p id="22e1" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">通过调用<code class="eh lj lk ll lm b">RingShipsBell</code>来调用回调请求，这导致了<code class="eh lj lk ll lm b">function RingRing</code>的#ScriptIt回调。</p><figure class="jp jq jr js fq jt"><div class="bz el l di"><div class="lh li l"/></div></figure><p id="c6b4" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated"><strong class="is hu">总结</strong>:</p><ul class=""><li id="9c1b" class="ln lo ht is b it iu ix iy jb lp jf lq jj lr jn ls lt lu lv dt translated">我们有82行通过编译器检查的可靠性代码(包括NodeJS代码)</li><li id="dafc" class="ln lo ht is b it lw ix lx jb ly jf lz jj ma jn ls lt lu lv dt translated">在将NodeJS代码嵌入Solidity之前，我们花了一些时间在本地测试它，并用Truffle、Remix等做了一些简短的测试。—检查</li><li id="e319" class="ln lo ht is b it lw ix lx jb ly jf lz jj ma jn ls lt lu lv dt translated">我们有日期的解决方案—检查</li><li id="97dd" class="ln lo ht is b it lw ix lx jb ly jf lz jj ma jn ls lt lu lv dt translated">我们得到了瑞士法郎对美元的汇率——核对</li><li id="9e0a" class="ln lo ht is b it lw ix lx jb ly jf lz jj ma jn ls lt lu lv dt translated">我们已经花了0.001462瑞士法郎的煤气费——检查</li><li id="6a11" class="ln lo ht is b it lw ix lx jb ly jf lz jj ma jn ls lt lu lv dt translated">我们有一份精明的合同，每月15日支付一些钱——没错</li></ul></div><div class="ab cl mb mc hb md" role="separator"><span class="me bw bk mf mg mh"/><span class="me bw bk mf mg mh"/><span class="me bw bk mf mg"/></div><div class="hm hn ho hp hq"><p id="ae2e" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">更新@<a class="ae kz" href="https://twitter.com/captainjs_v2" rel="noopener ugc nofollow" target="_blank">https://twitter.com/captainjs_v2</a></p><p id="2181" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">坚固性代码@<a class="ae kz" href="https://github.com/CaptainJavaScript/Solidity" rel="noopener ugc nofollow" target="_blank">https://github.com/CaptainJavaScript/Solidity</a></p><p id="e1fa" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">新旧学校代码@<a class="ae kz" href="https://github.com/CaptainJavaScript/Solidity/tree/master/TrustExample" rel="noopener ugc nofollow" target="_blank">https://github . com/captain JavaScript/Solidity/tree/master/trust example</a></p><blockquote class="mi"><p id="a36f" class="mj mk ht bd ml mm mn mo mp mq mr jn ek translated"><a class="ae kz" href="https://coincodecap.com/?utm_source=coinmonks" rel="noopener ugc nofollow" target="_blank">直接在您的收件箱中获得最佳软件交易</a></p></blockquote><figure class="mt mu mv mw mx jt fe ff paragraph-image"><a href="https://coincodecap.com/?utm_source=coinmonks"><div class="fe ff ms"><img src="../Images/7c0b3dfdcbfea594cc0ae7d4f9bf6fcb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1168/format:webp/0*OJ-qb5G6i863msBB.png"/></div></a></figure></div></div>    
</body>
</html>