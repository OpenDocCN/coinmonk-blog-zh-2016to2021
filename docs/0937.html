<html>
<head>
<title>Neural Style Transfer Using Tensorflow in Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Python中使用张量流的神经风格转换</h1>
<blockquote>原文：<a href="https://medium.com/coinmonks/neural-style-transfer-using-tensorflow-in-python-499b39084827?source=collection_archive---------6-----------------------#2018-07-03">https://medium.com/coinmonks/neural-style-transfer-using-tensorflow-in-python-499b39084827?source=collection_archive---------6-----------------------#2018-07-03</a></blockquote><div><div class="ef hh hi hj hk hl"/><div class="hm hn ho hp hq"><div class=""/><figure class="fi fk ir is it iu fe ff paragraph-image"><div role="button" tabindex="0" class="iv iw di ix bf iy"><div class="fe ff iq"><img src="../Images/af6781d8c29de34ae687ca134be06048.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zV7GGD_qoNXwgA0EtClWvA.png"/></div></div><figcaption class="jb jc fg fe ff jd je bd b be z ek">Credits to Magdiel Lopez</figcaption></figure><p id="db92" class="pw-post-body-paragraph jf jg ht jh b ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc hm dt translated">在当代高科技世界中，深度学习被以不同的方式用于实现特定主题中的特定目标。世界各地的工程师和开发人员将人工智能算法用于维护、网络安全、数学解决方案、客户服务等。</p><p id="7eb9" class="pw-post-body-paragraph jf jg ht jh b ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc hm dt translated">图像识别和分类并不是一件难事，这要归功于世界级的算法，如<strong class="jh hu"> Inception </strong>或<strong class="jh hu"> ResNet </strong> are。但今天，我要讨论的算法需要更少的处理器能力，但能够在良好的数据传播和预处理的情况下给你惊人的结果。<br/> <strong class="jh hu"> Tensorflow </strong>用几种技术实现让我们能够合成具有特定风格的普通图片。</p><p id="bd89" class="pw-post-body-paragraph jf jg ht jh b ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc hm dt translated">让我们从依赖关系开始。<br/>你们中的一些人可能没有安装所有需要的依赖项，所以，为了确保一切顺利，我将从零开始。</p><h1 id="f6a3" class="kd ke ht bd kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la dt translated">又及:我是mac用户，所以我要在CPU上重新训练神经网络。</h1><p id="dcc2" class="pw-post-body-paragraph jf jg ht jh b ji lb jk jl jm lc jo jp jq ld js jt ju le jw jx jy lf ka kb kc hm dt translated">我已经使用过这个项目几次，所以为了确保我从一开始就向您展示了一切，我将在虚拟环境中完成所有工作(因为我已经在前面安装了所有的依赖项)。</p><p id="5934" class="pw-post-body-paragraph jf jg ht jh b ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc hm dt translated">我要从安装pip，homebrew，tensorflow，opencv开始。但是，在我安装它们之后，我将向您展示如何使用这些命令来完成同样的操作。这很简单，即使你是初学者。</p><h1 id="e6ce" class="kd ke ht bd kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la dt translated">要求:</h1><p id="383a" class="pw-post-body-paragraph jf jg ht jh b ji lb jk jl jm lc jo jp jq ld js jt ju le jw jx jy lf ka kb kc hm dt translated"><strong class="jh hu">Pip:</strong>sudo easy _ install Pip<br/><strong class="jh hu">Brew:</strong>Pip安装家酿<br/> <strong class="jh hu"> Tensorflow: </strong> pip安装tensor flow<br/><strong class="jh hu">OpenCV:</strong>Pip安装opencv-python</p><p id="e5c9" class="pw-post-body-paragraph jf jg ht jh b ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc hm dt translated">(在拒绝访问的情况下，请使用“sudo”命令使用管理权限。示例:<strong class="jh hu"> sudo pip安装自制软件</strong></p><p id="fbc9" class="pw-post-body-paragraph jf jg ht jh b ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc hm dt translated">安装完依赖项后，让我们通过命令<br/> <strong class="jh hu"> pip freeze </strong>检查环境</p><figure class="lh li lj lk fq iu fe ff paragraph-image"><div role="button" tabindex="0" class="iv iw di ix bf iy"><div class="fe ff lg"><img src="../Images/9c8f7797518da5f77b2d05b2d19a1237.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Oz7mdz9w4EzuPgsZdz_ayQ.png"/></div></div></figure><p id="c427" class="pw-post-body-paragraph jf jg ht jh b ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc hm dt translated">去某个地方，例如在桌面上，创建一个新文件夹，让我们称之为deepstyle。使用命令进入目录:<br/><strong class="jh hu">CD Desktop/deep style</strong></p><h1 id="2186" class="kd ke ht bd kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la dt translated">克隆到存储库中</h1><p id="cdbd" class="pw-post-body-paragraph jf jg ht jh b ji lb jk jl jm lc jo jp jq ld js jt ju le jw jx jy lf ka kb kc hm dt translated">安装完所有的依赖项后，您已经创建了新的目录，让我们在github上使用以下命令从<a class="ae ll" href="https://github.com/cysmith/neural-style-tf.git" rel="noopener ugc nofollow" target="_blank">https://github.com/cysmith/neural-style-tf.git</a>克隆deepstyle库:</p><p id="99eb" class="pw-post-body-paragraph jf jg ht jh b ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc hm dt translated"><strong class="jh hu"> git克隆</strong>T31】https://github.com/cysmith/neural-style-tf.git</p><figure class="lh li lj lk fq iu fe ff paragraph-image"><div role="button" tabindex="0" class="iv iw di ix bf iy"><div class="fe ff lm"><img src="../Images/63f0f75be0473427e696a07d86a1913f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3IBqRTEeeCGNf4K8ikZ6nw.png"/></div></div></figure><p id="cb65" class="pw-post-body-paragraph jf jg ht jh b ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc hm dt translated">如果一切进展顺利，那就没问题。克隆到资源库后，让我们进入它的目录:<br/> <strong class="jh hu"> cd neural-style-tf </strong></p><h1 id="54b6" class="kd ke ht bd kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la dt translated">预训练模型</h1><p id="fa48" class="pw-post-body-paragraph jf jg ht jh b ji lb jk jl jm lc jo jp jq ld js jt ju le jw jx jy lf ka kb kc hm dt translated">下一步是下载预先训练好的模型。我们将把一个图像合成到另一个图像中，正如你所知道的，两个图像对于AI来说是不够的数据。让我们继续链接:<a class="ae ll" href="http://www.vlfeat.org/matconvnet/pretrained/" rel="noopener ugc nofollow" target="_blank">http://www.vlfeat.org/matconvnet/pretrained/</a></p><figure class="lh li lj lk fq iu fe ff paragraph-image"><div role="button" tabindex="0" class="iv iw di ix bf iy"><div class="fe ff ln"><img src="../Images/162d030042aa0411a6fa93f91f5a6133.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7kx5eoXOlP7aQP6MBn29eQ.png"/></div></div></figure><p id="be2f" class="pw-post-body-paragraph jf jg ht jh b ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc hm dt translated">我们应该搜索<strong class="jh hu"> imagenet VGG-19 </strong>预训练模型(imagenet-vgg-verydeep-19)的重量。下载就是了。它的大小是534.9Mb，所以可能需要一段时间。下载文件后，只需将它移动到项目目录(neural-style-tf文件夹)中，如下所示。</p><figure class="lh li lj lk fq iu fe ff paragraph-image"><div role="button" tabindex="0" class="iv iw di ix bf iy"><div class="fe ff lo"><img src="../Images/9a1e5df4edf5b9bc9158f1343cba28f5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*p56sY5PS8hEivjCBkM3P6Q.png"/></div></div><figcaption class="jb jc fg fe ff jd je bd b be z ek"><strong class="bd lp">Name of the file is imagenet-vgg-verydeep-19.mat</strong></figcaption></figure><h1 id="70d4" class="kd ke ht bd kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la dt translated">输入和样式图像</h1><p id="a0f4" class="pw-post-body-paragraph jf jg ht jh b ji lb jk jl jm lc jo jp jq ld js jt ju le jw jx jy lf ka kb kc hm dt translated">做完这一切，我们就快完成了。现在，我们需要两幅图像来从其中一幅中提取样式，并将其实现到另一幅中。让我们以一种浪漫的方式保持下去，想象一下:如果<strong class="jh hu">玛格达·艾森哈特</strong>(<strong class="jh hu">水银</strong>之母)<strong class="jh hu"> </strong>和<strong class="jh hu">亨利·艾伦</strong>(<strong class="jh hu">闪电侠</strong>之父)相遇会怎样？<br/>你猜对了，我们来合成一下<strong class="jh hu">闪光</strong>和<strong class="jh hu">水银</strong>的图像。</p><p id="6fde" class="pw-post-body-paragraph jf jg ht jh b ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc hm dt translated">我将使用闪光灯作为一种风格，并将其实现为水银图像。一个建议是:尽可能使用准确的面部图像。如果你用的是CPU甚至更多，它就没那么强大了，神经网络会发现很难合成它们。因此，可能会有一些不准确之处。</p><p id="3e17" class="pw-post-body-paragraph jf jg ht jh b ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc hm dt translated">我搜索并下载了他们的照片，我将在下一张照片中展示给你们看:</p><figure class="lh li lj lk fq iu fe ff paragraph-image"><div role="button" tabindex="0" class="iv iw di ix bf iy"><div class="fe ff lq"><img src="../Images/423cab1c4afa176cc575b6516a3996fd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Qyo-dW67FFeVe0WIhpKlfw.png"/></div></div><figcaption class="jb jc fg fe ff jd je bd b be z ek">Sources: SharkAttack.com &amp; Bustle.com</figcaption></figure><p id="7273" class="pw-post-body-paragraph jf jg ht jh b ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc hm dt translated">将下载的图像复制到项目目录。<br/>您正在用于输入图像的图像应被复制到名为<strong class="jh hu">“图像输入”</strong>的文件夹中</p><figure class="lh li lj lk fq iu fe ff paragraph-image"><div role="button" tabindex="0" class="iv iw di ix bf iy"><div class="fe ff lr"><img src="../Images/2442b6abe855533cc8ede42a05095412.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lDpLJxC7NjFUimJybj72lg.png"/></div></div></figure><p id="fd0a" class="pw-post-body-paragraph jf jg ht jh b ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc hm dt translated">输入的图像应该被复制到名为<strong class="jh hu">“样式”的文件夹中。</strong></p><figure class="lh li lj lk fq iu fe ff paragraph-image"><div role="button" tabindex="0" class="iv iw di ix bf iy"><div class="fe ff ls"><img src="../Images/519c3fb04eb7e979b323ec6e706d8d8f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*EudG1msTNG7KWdrYDcQ3Vg.png"/></div></div></figure><h1 id="324e" class="kd ke ht bd kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la dt translated">培训(再培训)</h1><p id="1e79" class="pw-post-body-paragraph jf jg ht jh b ji lb jk jl jm lc jo jp jq ld js jt ju le jw jx jy lf ka kb kc hm dt translated">我们都准备好了。让我们进入终端并运行以下命令:<br/>确保您在<strong class="jh hu"> neural-style-tf </strong>目录中。</p><p id="381a" class="pw-post-body-paragraph jf jg ht jh b ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc hm dt translated"><strong class="jh hu">bash stylate _ image . sh。/image_input/quicksilver.png。/styles/theflash.png </strong></p><p id="004d" class="pw-post-body-paragraph jf jg ht jh b ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc hm dt translated"><em class="lt">该命令代表:bash stylize_image.sh。/ &lt;输入图像目录&gt; / &lt;输入图像名称&gt;。/ &lt;样式图像目录&gt; / &lt;样式图像名称&gt; </em></p><p id="2c14" class="pw-post-body-paragraph jf jg ht jh b ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc hm dt translated">按下回车键，它会问你是否已经安装了所需的依赖项，只需按下键盘上的“y”按钮，然后按下回车键。</p><figure class="lh li lj lk fq iu fe ff paragraph-image"><div role="button" tabindex="0" class="iv iw di ix bf iy"><div class="fe ff lu"><img src="../Images/a901c54d14d5ecdf203f03f984bcf396.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vdj8KLWDGhGtNSNjrjOr_g.png"/></div></div></figure><p id="c27e" class="pw-post-body-paragraph jf jg ht jh b ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc hm dt translated">之后，它会问你要<strong class="jh hu"> CUDA </strong>启用的GPU，但正如我上面提到的，我是mac用户，所以我会按“n”键。</p><p id="509c" class="pw-post-body-paragraph jf jg ht jh b ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc hm dt translated">如果出了问题，不要害怕。这只是因为您没有安装所有必需的依赖项。在我的例子中，它是<strong class="jh hu"> scipy </strong>库。<br/>继续使用命令:<strong class="jh hu"> pip install &lt;库名&gt; <br/> </strong>在我的例子中:<strong class="jh hu"> pip install scipy </strong></p><figure class="lh li lj lk fq iu fe ff paragraph-image"><div role="button" tabindex="0" class="iv iw di ix bf iy"><div class="fe ff lv"><img src="../Images/e1e885ade9510571109d9635f199d6d2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*yiZUvnGNi5A_VhPlErjvhA.png"/></div></div></figure><p id="76d8" class="pw-post-body-paragraph jf jg ht jh b ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc hm dt translated">安装完所需的库后，只需使用上面我向您展示的相同命令:</p><p id="1520" class="pw-post-body-paragraph jf jg ht jh b ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc hm dt translated"><strong class="jh hu"> bash stylize_image.sh。/image_input/quicksilver.png。/styles/theflash.png </strong></p><p id="e490" class="pw-post-body-paragraph jf jg ht jh b ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc hm dt translated">神奇的事情发生了:</p><figure class="lh li lj lk fq iu fe ff paragraph-image"><div role="button" tabindex="0" class="iv iw di ix bf iy"><div class="fe ff lw"><img src="../Images/37137e6aabd0d509bfd989b5f1439da8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IgiLrs4SiBcRB0PdXAz3kg.png"/></div></div><figcaption class="jb jc fg fe ff jd je bd b be z ek">The model is being re-trained on your input images</figcaption></figure><p id="d729" class="pw-post-body-paragraph jf jg ht jh b ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc hm dt translated">这个过程不需要太长时间。有关迭代次数和图像精度的详细信息将出现在终端窗口中，如下所示:</p><figure class="lh li lj lk fq iu fe ff paragraph-image"><div role="button" tabindex="0" class="iv iw di ix bf iy"><div class="fe ff lu"><img src="../Images/e854d93050f1991d01453fb181fa2eea.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*chCeZ4_Tg3yrBtKF_ZakNg.png"/></div></div></figure><p id="c578" class="pw-post-body-paragraph jf jg ht jh b ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc hm dt translated">神经网络需要<strong class="jh hu"> 1000次迭代</strong>来合成图像。只是等待一些时间。对于我的<strong class="jh hu">配备<strong class="jh hu"> 2.2GHz i7处理器</strong>和<strong class="jh hu"> 16GB RAM </strong>的MacBook Pro </strong>来说，“一些时间”大约是<strong class="jh hu"> 47.62306分钟</strong>。</p><h1 id="8aae" class="kd ke ht bd kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la dt translated">结果呢</h1><p id="ef2a" class="pw-post-body-paragraph jf jg ht jh b ji lb jk jl jm lc jo jp jq ld js jt ju le jw jx jy lf ka kb kc hm dt translated">该过程完成后，您将看到精度细节和经过的时间:</p><figure class="lh li lj lk fq iu fe ff paragraph-image"><div role="button" tabindex="0" class="iv iw di ix bf iy"><div class="fe ff lx"><img src="../Images/8897c7362600925266f705c3dafe3aa1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*EQ6_zgEq_5w32jUK4yntOQ.png"/></div></div><figcaption class="jb jc fg fe ff jd je bd b be z ek">The process is done.</figcaption></figure><p id="bae5" class="pw-post-body-paragraph jf jg ht jh b ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc hm dt translated">开始了。让我们转到<strong class="jh hu"> image_output </strong>目录并检查<strong class="jh hu"> result </strong>文件夹。在这里，我们将看到一些文件，包括预处理的图像和元数据。</p><figure class="lh li lj lk fq iu fe ff paragraph-image"><div role="button" tabindex="0" class="iv iw di ix bf iy"><div class="fe ff ly"><img src="../Images/e478e90c2a8ce1af348879d0d7507667.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Xozn4nH9tmCV4EQ6uS3r8g.png"/></div></div></figure><p id="a084" class="pw-post-body-paragraph jf jg ht jh b ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc hm dt translated">这里我们所需要的就是result.png。</p><figure class="lh li lj lk fq iu fe ff paragraph-image"><div class="fe ff lz"><img src="../Images/b175a0d5873b26a585840a3a6d767c09.png" data-original-src="https://miro.medium.com/v2/resize:fit:1024/format:webp/1*31jb6FsMfy_Zd26JQe0Xyw.png"/></div></figure><p id="340b" class="pw-post-body-paragraph jf jg ht jh b ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc hm dt translated">正如我们所看到的，flash图像的样式已经实现到我们的输入图像中。</p><p id="ba86" class="pw-post-body-paragraph jf jg ht jh b ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc hm dt translated">它没有令人惊讶的准确性，但算法完成了它的工作:它把风格从一个图像转移到另一个。</p><p id="7387" class="pw-post-body-paragraph jf jg ht jh b ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc hm dt translated">你可以用这个神经网络把世界级画家的风格转换成某些人的形象，也许是你的，而且效果相当好。</p><h1 id="07f1" class="kd ke ht bd kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la dt translated"><em class="ma">最后:</em></h1><p id="88b3" class="pw-post-body-paragraph jf jg ht jh b ji lb jk jl jm lc jo jp jq ld js jt ju le jw jx jy lf ka kb kc hm dt translated">如果你觉得读这篇文章很有趣，就点击喜欢并欣赏我的作品</p><p id="b970" class="pw-post-body-paragraph jf jg ht jh b ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc hm dt translated">下面我想听听你的反馈和问题！</p></div></div>    
</body>
</html>