<html>
<head>
<title>Access Blockchain Data from Bitcoin Smart Contracts: Part 5</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">从比特币智能合约访问区块链数据:第5部分</h1>
<blockquote>原文：<a href="https://medium.com/coinmonks/access-blockchain-data-from-bitcoin-smart-contracts-part-5-799c11e1e536?source=collection_archive---------4-----------------------#2021-12-02">https://medium.com/coinmonks/access-blockchain-data-from-bitcoin-smart-contracts-part-5-799c11e1e536?source=collection_archive---------4-----------------------#2021-12-02</a></blockquote><div><div class="ef hh hi hj hk hl"/><div class="hm hn ho hp hq"><div class=""/><div class=""><h2 id="173a" class="pw-subtitle-paragraph iq hs ht bd b ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ek translated">不带OP_CheckSequenceVerify的相对锁定时间</h2></div><p id="313f" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated">在本系列前几部分奠定的基础上，我们演示了如何在不使用新操作码OP_CheckSequenceVerify的情况下，在比特币中实现相对锁定时间。</p><h1 id="f2b9" class="ke kf ht bd kg kh ki kj kk kl km kn ko iz kp ja kq jc kr jd ks jf kt jg ku kv dt translated">时间锁链</h1><p id="ac48" class="pw-post-body-paragraph ji jj ht jk b jl kw iu jn jo kx ix jq jr ky jt ju jv kz jx jy jz la kb kc kd hm dt translated">一个时间锁<strong class="jk hu"> </strong>限制一些比特币的消费，直到指定的未来时间或区块高度。有两种类型的时间锁:</p><ol class=""><li id="f307" class="lb lc ht jk b jl jm jo jp jr ld jv le jz lf kd lg lh li lj dt translated"><strong class="jk hu">绝对</strong>:例如，一个人可以证明锁定1，100，000个比特币，直到区块高度800，000，或者直到2025年1月1日。</li><li id="5e0e" class="lb lc ht jk b jl lk jo ll jr lm jv ln jz lo kd lg lh li lj dt translated"><strong class="jk hu">相对</strong>:比如一个人可以锁定21个比特币，这些比特币只能在100块或者3天后才能花掉。</li></ol><p id="b552" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated">为了启用绝对和相对时间锁，在<a class="ae lq" href="https://github.com/bitcoin/bips/blob/master/bip-0065.mediawiki" rel="noopener ugc nofollow" target="_blank"> BIP65 </a>和<a class="ae lq" href="https://en.bitcoin.it/wiki/Timelock#CheckSequenceVerify" rel="noopener ugc nofollow" target="_blank"> BIP68/112/113 </a>中分别引入了新的操作码<em class="lp">OP _ CheckLockTimeVerify/OP _ CLTV</em>和<em class="lp">OP _ CheckSequenceVerify/OP _ CSV</em>。</p><h1 id="35c0" class="ke kf ht bd kg kh ki kj kk kl km kn ko iz kp ja kq jc kr jd ks jf kt jg ku kv dt translated">无OP_CSV的相对锁定时间</h1><p id="b750" class="pw-post-body-paragraph ji jj ht jk b jl kw iu jn jo kx ix jq jr ky jt ju jv kz jx jy jz la kb kc kd hm dt translated">恢复原来的比特币协议，比特币SV<a class="ae lq" href="https://bitcoinsv.io/2020/01/15/changes-for-the-genesis-upgrade/" rel="noopener ugc nofollow" target="_blank">还原了</a>前述的改动。原来<em class="lp"> OP_CSV </em>可以用原来的协议实现。</p><figure class="ls lt lu lv fq lw fe ff paragraph-image"><div role="button" tabindex="0" class="lx ly di lz bf ma"><div class="fe ff lr"><img src="../Images/30cd33e6533e28b8927c5b0773ce2b9e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mvekScjL2YbjkwWCBkcDng.png"/></div></div><figcaption class="md me fg fe ff mf mg bd b be z ek"><a class="ae lq" href="https://teachbitcoin.io/presentations/transaction_timelocks.html#/3" rel="noopener ugc nofollow" target="_blank">Relative Transaction Timelocks</a></figcaption></figure><p id="00d6" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated">在第1部分中，我们已经展示了如何访问包含给定契约UTXO的块。将这个块头与指定的相对时间锁结合起来，我们可以知道UTXO可以使用的最早的块。我们要求截止日期之后的任何块都可以用于解锁UTXO，本质上是像OP_CSV一样在其上放置一个相对时间锁。下面列出了完整的代码。</p><figure class="ls lt lu lv fq lw"><div class="bz el l di"><div class="mh mi l"/></div><figcaption class="md me fg fe ff mf mg bd b be z ek"><a class="ae lq" href="https://github.com/sCrypt-Inc/boilerplate/blob/master/contracts/csv.scrypt" rel="noopener ugc nofollow" target="_blank">CheckSequenceVerify Contact</a></figcaption></figure><p id="46d4" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated">第11行显示了基于unix时间(例如，以秒为单位)的解锁。第33行的函数validateHelper() 验证包含UTXO的块和最新的块都是有效的(第41–42行)。它还使用与第1部分中的<a class="ae lq" href="https://xiaohuiliu.medium.com/access-blockchain-data-from-bitcoin-smart-contracts-without-oracles-e13b9c911d32" rel="noopener">相同的技术验证前一个块实际包含UTXO(第34–38行)。第15行确保从开采UTXO开始已经过了所需的时间。</a></p><p id="31da" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated">第19行显示了基于块高度(例如，块的数量)的解锁。第24-25行得到两个区块的高度，如第3部分中<a class="ae lq" href="https://xiaohuiliu.medium.com/access-blockchain-data-from-bitcoin-smart-contracts-part-3-c3b5140bf3e6" rel="noopener">所示。第27行检查在UTXO之后已经开采了指定数量的块。</a></p><h1 id="fe3e" class="ke kf ht bd kg kh ki kj kk kl km kn ko iz kp ja kq jc kr jd ks jf kt jg ku kv dt translated">摘要</h1><p id="4b90" class="pw-post-body-paragraph ji jj ht jk b jl kw iu jn jo kx ix jq jr ky jt ju jv kz jx jy jz la kb kc kd hm dt translated">除了OP_CSV，我们之前已经实现了<a class="ae lq" href="https://xiaohuiliu.medium.com/op-push-tx-3d3d279174c1" rel="noopener"> OP_CLTV </a>，没有对原来的比特币协议做任何改动。有两层含义:</p><ol class=""><li id="39af" class="lb lc ht jk b jl jm jo jp jr ld jv le jz lf kd lg lh li lj dt translated">这两个操作码对于启用UTXO级别的时间锁来说并不像以前认为的那样是必需的。</li><li id="1cd4" class="lb lc ht jk b jl lk jo ll jr lm jv ln jz lo kd lg lh li lj dt translated">如果需要，OP_CSV/CLTV支持的所有用例，如闪电网络、侧链和<a class="ae lq" href="https://en.bitcoin.it/wiki/Payment_channels#CLTV-style_payment_channels" rel="noopener ugc nofollow" target="_blank"> CLTV式支付通道</a>，都可以直接建立在原始比特币上。</li></ol><blockquote class="mj"><p id="d782" class="mk ml ht bd mm mn mo mp mq mr ms kd ek translated">加入Coinmonks <a class="ae lq" href="https://t.me/coincodecap" rel="noopener ugc nofollow" target="_blank">电报频道</a>和<a class="ae lq" href="https://www.youtube.com/c/coinmonks/videos" rel="noopener ugc nofollow" target="_blank"> Youtube频道</a>了解加密交易和投资</p></blockquote><h2 id="6048" class="mt kf ht bd kg mu mv mw kk mx my mz ko jr na nb kq jv nc nd ks jz ne nf ku ng dt translated">也阅读</h2><div class="nh ni fm fo nj nk"><a rel="noopener follow" target="_blank" href="/coinmonks/leveraged-token-3f5257808b22"><div class="nl ab ej"><div class="nm ab nn cl cj no"><h2 class="bd hu fv z el np eo ep nq er et hs dt translated">杠杆代币[多头代币]终极指南</h2><div class="nr l"><h3 class="bd b fv z el np eo ep nq er et ek translated">杠杆化令牌是具有杠杆化风险敞口的ERC20令牌，不考虑保证金、要求、管理…</h3></div><div class="ns l"><p class="bd b gc z el np eo ep nq er et ek translated">medium.com</p></div></div><div class="nt l"><div class="nu l nv nw nx nt ny mb nk"/></div></div></a></div><div class="nh ni fm fo nj nk"><a href="https://blog.coincodecap.com/crypto-exchange" rel="noopener  ugc nofollow" target="_blank"><div class="nl ab ej"><div class="nm ab nn cl cj no"><h2 class="bd hu fv z el np eo ep nq er et hs dt translated">最佳加密交易所| 2021年十大加密货币交易所</h2><div class="nr l"><h3 class="bd b fv z el np eo ep nq er et ek translated">加密货币交易所的加密交易需要了解市场，这可以帮助你获得利润。之前…</h3></div><div class="ns l"><p class="bd b gc z el np eo ep nq er et ek translated">blog.coincodecap.com</p></div></div><div class="nt l"><div class="nz l nv nw nx nt ny mb nk"/></div></div></a></div><div class="nh ni fm fo nj nk"><a rel="noopener follow" target="_blank" href="/coinmonks/top-5-crypto-lending-platforms-in-2020-that-you-need-to-know-a1b675cec3fa"><div class="nl ab ej"><div class="nm ab nn cl cj no"><h2 class="bd hu fv z el np eo ep nq er et hs dt translated">2021年最佳加密借贷平台| 6大比特币借贷平台</h2><div class="nr l"><h3 class="bd b fv z el np eo ep nq er et ek translated">获得比特币和其他加密货币的最佳贷款利率</h3></div><div class="ns l"><p class="bd b gc z el np eo ep nq er et ek translated">medium.com</p></div></div><div class="nt l"><div class="oa l nv nw nx nt ny mb nk"/></div></div></a></div><div class="nh ni fm fo nj nk"><a rel="noopener follow" target="_blank" href="/coinmonks/crypto-trading-bot-c2ffce8acb2a"><div class="nl ab ej"><div class="nm ab nn cl cj no"><h2 class="bd hu fv z el np eo ep nq er et hs dt translated">2021年最佳免费加密交易机器人</h2><div class="nr l"><h3 class="bd b fv z el np eo ep nq er et ek translated">2021年币安、比特币基地、库币和其他密码交易所的最佳密码交易机器人。四进制，位间隙…</h3></div><div class="ns l"><p class="bd b gc z el np eo ep nq er et ek translated">medium.com</p></div></div><div class="nt l"><div class="ob l nv nw nx nt ny mb nk"/></div></div></a></div></div></div>    
</body>
</html>