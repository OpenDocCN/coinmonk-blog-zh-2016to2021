<html>
<head>
<title>Handling Imbalanced Datasets: Predicting Credit Card Fraud</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">处理不平衡数据集:预测信用卡欺诈</h1>
<blockquote>原文：<a href="https://medium.com/coinmonks/handling-imbalanced-datasets-predicting-credit-card-fraud-544f5e74e0fd?source=collection_archive---------1-----------------------#2018-07-26">https://medium.com/coinmonks/handling-imbalanced-datasets-predicting-credit-card-fraud-544f5e74e0fd?source=collection_archive---------1-----------------------#2018-07-26</a></blockquote><div><div class="ef hh hi hj hk hl"/><div class="hm hn ho hp hq"><div class=""/><figure class="fi fk ir is it iu fe ff paragraph-image"><div class="fe ff iq"><img src="../Images/cd5b91bb6fc28a80e755d20702d3f3f2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1320/format:webp/1*PcYvD4PSsqiDXlD6dMfuJg.jpeg"/></div><figcaption class="ix iy fg fe ff iz ja bd b be z ek">Credit Cards (<a class="ae jb" href="https://www.google.com.ng/url?sa=i&amp;source=images&amp;cd=&amp;cad=rja&amp;uact=8&amp;ved=2ahUKEwjmzI6qnbvcAhUGLBoKHYm7AyEQjhx6BAgBEAM&amp;url=https%3A%2F%2Fwww.finanzen.net%2Fnachricht%2Fprivate-finanzen%2Feuro-am-sonntag-service-grosser-exklusiv-test-das-sind-die-top-kreditkarten-6072848&amp;psig=AOvVaw3mKM2m8d-yTNzTGnt9TiTQ&amp;ust=1532641638127212" rel="noopener ugc nofollow" target="_blank">source</a>)</figcaption></figure><p id="e69d" class="pw-post-body-paragraph jc jd ht je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hm dt translated">作为数据科学家，我们会遇到各种类型的数据集。一个这样的数据集是不平衡数据集。这种类型的数据集总是给初学数据的科学家带来一个问题，因为大多数机器学习算法都不擅长处理它。</p><p id="4efa" class="pw-post-body-paragraph jc jd ht je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hm dt translated"><strong class="je hu">什么是不平衡数据集？</strong></p><p id="3d55" class="pw-post-body-paragraph jc jd ht je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hm dt translated">不平衡数据集是指属于一个组或一个类的观察值的数量明显高于属于其他类的观察值的数量。</p><figure class="kb kc kd ke fq iu fe ff paragraph-image"><div role="button" tabindex="0" class="kf kg di kh bf ki"><div class="fe ff ka"><img src="../Images/2a0003cc069ad3cf1d4bf5b6f8fa7d96.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZeGXHtNu8fu_PswjHivGwg.jpeg"/></div></div><figcaption class="ix iy fg fe ff iz ja bd b be z ek">Imbalance (<a class="ae jb" href="https://www.google.com.ng/url?sa=i&amp;source=images&amp;cd=&amp;cad=rja&amp;uact=8&amp;ved=2ahUKEwjQja_2p7vcAhUMxoUKHY1kDEoQjhx6BAgBEAM&amp;url=https%3A%2F%2Fmedium.com%2F%40mikeal%2Fcommunity-imbalance-theory-c5f8688ae352&amp;psig=AOvVaw2HPqvgwmquuXbxmYHbori5&amp;ust=1532644524044133" rel="noopener ugc nofollow" target="_blank">Source</a>)</figcaption></figure><p id="6e5e" class="pw-post-body-paragraph jc jd ht je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hm dt translated">这种情况发生在诸如信用卡欺诈检测的情况下，在超过100万次交易中可能只有1000个欺诈案例，仅占数据集的0.1%。罕见疾病的识别是处理不平衡数据的另一种可能情况。</p><p id="e8d1" class="pw-post-body-paragraph jc jd ht je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hm dt translated"><strong class="je hu">处理不平衡数据集的挑战</strong></p><p id="1df9" class="pw-post-body-paragraph jc jd ht je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hm dt translated">当机器学习算法用不平衡数据集训练时，它们很可能产生错误的分类器。这些算法倾向于偏向多数类，将少数类视为数据集中的噪声。使用许多标准分类器算法，如逻辑回归、朴素贝叶斯和决策树，有可能对少数类进行错误分类。</p><p id="9da1" class="pw-post-body-paragraph jc jd ht je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hm dt translated">在不平衡数据集上测量算法的性能时，还存在虚荣度量的问题。如果我们有一个不平衡的数据集，包含1%的少数类和99%的多数类，算法可以预测所有情况都属于多数类。这种算法的准确度分数将产生99%的准确度，这似乎令人印象深刻，但真的是这样吗？在这种情况下，少数群体被完全忽略，这在一些分类问题上可能会被证明是昂贵的，例如信用卡欺诈，这可能会使个人和企业损失大量金钱。</p><p id="2532" class="pw-post-body-paragraph jc jd ht je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hm dt translated"><strong class="je hu">处理不平衡数据集的方法</strong></p><p id="1bde" class="pw-post-body-paragraph jc jd ht je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hm dt translated">有两种处理不平衡数据集的主要方法，下面将对它们进行讨论:</p><p id="365a" class="pw-post-body-paragraph jc jd ht je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hm dt translated"><strong class="je hu">过采样:</strong>这种方法通过复制或创建少数类的新观察值来减少或消除数据集中的不平衡。有四种过采样技术:</p><ul class=""><li id="f0e9" class="kj kk ht je b jf jg jj jk jn kl jr km jv kn jz ko kp kq kr dt translated"><strong class="je hu">随机过采样</strong>:在这种情况下，通过随机复制现有样本来创建少数类的新实例，以便增加数据集中的少数计数。然而，这种方法会导致过度拟合，因为它只是简单地复制了少数类的现有实例。</li><li id="1824" class="kj kk ht je b jf ks jj kt jn ku jr kv jv kw jz ko kp kq kr dt translated"><strong class="je hu">基于聚类的过采样</strong>:这里，K-means算法分别应用于多数和少数实例。这有助于识别数据集中的聚类。在识别之后，对每个聚类进行过采样，使得所有聚类具有相同数量的观察值。同样，使用这种方法有过度拟合模型的风险。</li><li id="afb9" class="kj kk ht je b jf ks jj kt jn ku jr kv jv kw jz ko kp kq kr dt translated"><strong class="je hu">合成过采样</strong>:这种方法有助于避免过拟合。在该方法中，选择少数的一个小子集，并创建该子集的合成示例以平衡整个数据集。这向数据集添加了新的信息，并增加了观察的总数。</li><li id="96ec" class="kj kk ht je b jf ks jj kt jn ku jr kv jv kw jz ko kp kq kr dt translated"><strong class="je hu">改进的合成过采样</strong>:这就像合成过采样方法，但是这种方法为少数类的噪声和固有分布留出了空间。</li></ul><p id="b54d" class="pw-post-body-paragraph jc jd ht je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hm dt translated"><strong class="je hu"> 2。欠采样:</strong>在这种方法中，通过关注多数类来减少数据集的不平衡。一种流行的类型解释如下:</p><ul class=""><li id="a512" class="kj kk ht je b jf jg jj jk jn kl jr km jv kn jz ko kp kq kr dt translated"><strong class="je hu">随机欠采样</strong>:在这种情况下，多数类的现有实例被随机消除。这种技术不是最好的，因为它会消除对分类算法有用的信息或数据点。</li></ul><p id="bf41" class="pw-post-body-paragraph jc jd ht je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hm dt translated"><strong class="je hu">在不平衡数据集上测量算法性能</strong></p><figure class="kb kc kd ke fq iu fe ff paragraph-image"><div role="button" tabindex="0" class="kf kg di kh bf ki"><div class="fe ff kx"><img src="../Images/07a1974d5305e7e9278db7bbb3f15ddf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7_V4pAp6b0mVA0l-_5AJcQ.jpeg"/></div></div><figcaption class="ix iy fg fe ff iz ja bd b be z ek">Performance (<a class="ae jb" href="https://www.google.com.ng/url?sa=i&amp;source=images&amp;cd=&amp;cad=rja&amp;uact=8&amp;ved=2ahUKEwinttnwqLvcAhVSxxoKHfllCzUQjhx6BAgBEAM&amp;url=https%3A%2F%2Fblog.usejournal.com%2Fswift-performance-tips-55dc5688808b&amp;psig=AOvVaw0xjlu5-xjkrZ9bKbwaM7E9&amp;ust=1532644777416597" rel="noopener ugc nofollow" target="_blank">Source</a>)</figcaption></figure><p id="73d7" class="pw-post-body-paragraph jc jd ht je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hm dt translated">既然我们已经确定在不平衡的数据集上，精确度是一个很差的性能度量，那么我们如何度量性能呢？为了确定这一点，让我们首先定义一些术语:</p><p id="5c33" class="pw-post-body-paragraph jc jd ht je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hm dt translated"><strong class="je hu">假阳性(FP) </strong>:这个用来形容现实生活中实际上是负面的正面预测。一个例子是预测信用卡交易是欺诈性的，而事实上它不是。</p><p id="bf26" class="pw-post-body-paragraph jc jd ht je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hm dt translated"><strong class="je hu">真阳性(TP) </strong>:这是用来形容现实生活中实际上是正面的正面预测。</p><p id="4d42" class="pw-post-body-paragraph jc jd ht je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hm dt translated"><strong class="je hu">假阴性(FN): </strong>这个用来形容现实生活中实际上是正面的负面预测。一个例子是预测信用卡交易不是欺诈性的，而事实上它是。</p><p id="587f" class="pw-post-body-paragraph jc jd ht je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hm dt translated"><strong class="je hu">真否定(TN): </strong>这个用来形容现实生活中实际上是否定的否定预测。</p><p id="378e" class="pw-post-body-paragraph jc jd ht je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hm dt translated">现在我们已经解决了这个问题，让我们来看看可能的性能指标。</p><p id="a6f8" class="pw-post-body-paragraph jc jd ht je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hm dt translated"><strong class="je hu">模型性能的一些度量和指标包括— </strong></p><p id="0088" class="pw-post-body-paragraph jc jd ht je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hm dt translated"><strong class="je hu">精度:</strong>这是在所有被识别为阳性的项目中，被正确识别为阳性的项目数的指标。公式如下:TP/(TP+FP)</p><p id="d255" class="pw-post-body-paragraph jc jd ht je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hm dt translated"><strong class="je hu">召回率/敏感度/真阳性率(TPR): </strong>这是在实际阳性总数中被正确识别为阳性的项目数量的指标。公式如下:TP/(TP+FN)</p><p id="cf5d" class="pw-post-body-paragraph jc jd ht je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hm dt translated">精准可以看做“结果有多有用”，召回就是“结果有多完整”</p><p id="0fe0" class="pw-post-body-paragraph jc jd ht je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hm dt translated"><strong class="je hu">特异性</strong> / <strong class="je hu">真阴性率(TNR) </strong>:这是实际阴性总数中被正确识别为阴性的项目数的指标。公式为:TN/(TN+FP)</p><p id="2d3f" class="pw-post-body-paragraph jc jd ht je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hm dt translated"><strong class="je hu"> F1评分:</strong>这是一个综合了准确率和召回率的性能评分。这是这两个变量的调和平均值。公式给出为:2 *精度*召回/(精度+召回)</p><p id="7082" class="pw-post-body-paragraph jc jd ht je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hm dt translated"><strong class="je hu">马修相关系数评分:</strong>这是一个考虑了真阳性和假阳性，以及真阴性和假阴性的表现评分。这个分数对于不平衡数据集给出了很好的评价。公式如下所示:</p><figure class="kb kc kd ke fq iu fe ff paragraph-image"><div role="button" tabindex="0" class="kf kg di kh bf ki"><div class="fe ff ky"><img src="../Images/8be1e4527e9b98f67ce72756b8322523.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WATDEJrO-0QQ2EZZBBoh9A.jpeg"/></div></div><figcaption class="ix iy fg fe ff iz ja bd b be z ek">MCC</figcaption></figure><p id="803a" class="pw-post-body-paragraph jc jd ht je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hm dt translated"><strong class="je hu">ROC曲线下面积:</strong>ROC曲线(接收机工作特性曲线)是显示分类算法在所有分类阈值下的性能的图形。这条曲线描绘了TPR与FPR的关系。</p><p id="330f" class="pw-post-body-paragraph jc jd ht je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hm dt translated"><strong class="je hu">精确召回曲线下的区域:</strong>精确召回曲线是通过绘制精确召回曲线来显示性能的图形。</p><p id="4328" class="pw-post-body-paragraph jc jd ht je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hm dt translated"><strong class="je hu">混淆矩阵:</strong>这是TP、FP、FN和TN的图形表示。广义混淆矩阵如下所示:</p><figure class="kb kc kd ke fq iu fe ff paragraph-image"><div class="fe ff kz"><img src="../Images/d69e2d9ea41ff78263e83e6b2aa0de80.png" data-original-src="https://miro.medium.com/v2/resize:fit:848/format:webp/1*PQmvCX6JVHeQ1RK3nVmK6A.png"/></div><figcaption class="ix iy fg fe ff iz ja bd b be z ek">Confusion Matrix</figcaption></figure><p id="fbe0" class="pw-post-body-paragraph jc jd ht je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hm dt translated">通常，不平衡数据集的最佳度量是:Matthew系数相关分数、F1分数和精确-召回曲线下的面积。</p><p id="3b37" class="pw-post-body-paragraph jc jd ht je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hm dt translated">然而，在选择绩效评估指标时，理解模型的业务含义是很重要的。理想情况下，在现实生活中会有假阳性和假阴性之间的权衡。例如，如果您正在针对信用卡欺诈进行分类，您可能更喜欢出现误报而不是漏报。也就是说，你宁愿预测一个交易是欺诈性的，而实际上它不是，也不愿预测一个交易不是欺诈性的。请记住，过多的假阳性预测可能会导致糟糕的客户体验，因此您可能也必须考虑这一点。此外，例如，如果您正在构建一个电影推荐模型，您可能更喜欢出现假阴性而不是假阳性。也就是说，你宁愿告诉一个人他们不喜欢一部电影，而不是告诉一个人他们不喜欢一部电影。</p><p id="fe67" class="pw-post-body-paragraph jc jd ht je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hm dt translated">本质上，在满足于一个指标之前，需要考虑这些指标的业务含义。</p><p id="ce4a" class="pw-post-body-paragraph jc jd ht je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hm dt translated"><strong class="je hu">实际例子:信用卡欺诈预测</strong></p><p id="8f6c" class="pw-post-body-paragraph jc jd ht je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hm dt translated">这个实际例子利用了一个<a class="ae jb" href="https://www.kaggle.com/mlg-ulb/creditcardfraud" rel="noopener ugc nofollow" target="_blank">匿名信用卡交易数据集。</a></p><p id="402f" class="pw-post-body-paragraph jc jd ht je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hm dt translated">非欺诈交易与欺诈交易的比率是惊人的——99.83%比0.17%</p><figure class="kb kc kd ke fq iu fe ff paragraph-image"><div class="fe ff la"><img src="../Images/9ffdd57f8a0cc7d77fcd1bc30017a4b8.png" data-original-src="https://miro.medium.com/v2/resize:fit:864/format:webp/1*CiCmwPQ6a8to8KdUbj81aw.jpeg"/></div><figcaption class="ix iy fg fe ff iz ja bd b be z ek">Imbalance in the dataset</figcaption></figure><p id="be20" class="pw-post-body-paragraph jc jd ht je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hm dt translated">我继续建模，选择逻辑回归作为我的算法。我用不平衡数据集训练了算法。以下是我的结果:</p><figure class="kb kc kd ke fq iu fe ff paragraph-image"><div role="button" tabindex="0" class="kf kg di kh bf ki"><div class="fe ff lb"><img src="../Images/c5ef17cf25930937b984ddba801d3b1b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QCD9ieJ0CmiweBIW3cdnpA.png"/></div></div><figcaption class="ix iy fg fe ff iz ja bd b be z ek">Result for imbalanced data</figcaption></figure><figure class="kb kc kd ke fq iu fe ff paragraph-image"><div class="fe ff lc"><img src="../Images/1868085c74d1ce83fa6db00ced9ed727.png" data-original-src="https://miro.medium.com/v2/resize:fit:940/format:webp/1*J_owglnVSrbsWhC0fqgq1A.png"/></div><figcaption class="ix iy fg fe ff iz ja bd b be z ek">confusion matrix</figcaption></figure><p id="f6c4" class="pw-post-body-paragraph jc jd ht je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hm dt translated">请注意，尽管存在假阳性和假阴性，但准确率非常高。然而，F1分数和MCC分数更能说明实际模型的性能</p><figure class="kb kc kd ke fq iu fe ff paragraph-image"><div class="fe ff ld"><img src="../Images/4c3e3543ec75c405571a5b7819a865d2.png" data-original-src="https://miro.medium.com/v2/resize:fit:960/1*pVq9FfKsyyVroJpPlLWq1A.gif"/></div><figcaption class="ix iy fg fe ff iz ja bd b be z ek">Shame (Source- Giphy)</figcaption></figure><p id="781b" class="pw-post-body-paragraph jc jd ht je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hm dt translated">然后我开始平衡数据集。</p><p id="5af7" class="pw-post-body-paragraph jc jd ht je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hm dt translated">我用<a class="ae jb" href="https://imbalanced-learn.readthedocs.io/en/stable/generated/imblearn.over_sampling.SMOTE.html" rel="noopener ugc nofollow" target="_blank"> SMOTE(合成少数过采样技术)</a>来平衡数据集。</p><figure class="kb kc kd ke fq iu fe ff paragraph-image"><div role="button" tabindex="0" class="kf kg di kh bf ki"><div class="fe ff le"><img src="../Images/fa86ad7c1e2852060331681993e1cc18.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BdcclZnt5dxHFHPSx-ZQRg.png"/></div></div><figcaption class="ix iy fg fe ff iz ja bd b be z ek">Applying SMOTE algorithm</figcaption></figure><p id="d3da" class="pw-post-body-paragraph jc jd ht je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hm dt translated">然后，我用平衡数据集训练算法，用原始数据进行测试，并获得以下结果:</p><figure class="kb kc kd ke fq iu fe ff paragraph-image"><div class="fe ff lf"><img src="../Images/046397a95e18cb883a57b0ade13e4df0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1170/format:webp/1*NaavmkvTyw4Mdv5Zw4nP3g.png"/></div><figcaption class="ix iy fg fe ff iz ja bd b be z ek">Smote result</figcaption></figure><p id="b1c9" class="pw-post-body-paragraph jc jd ht je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hm dt translated">正如我们所看到的，这个模型比前一个好得多。</p><figure class="kb kc kd ke fq iu fe ff paragraph-image"><div class="fe ff lg"><img src="../Images/67ed6d354fbac24779639106a2ea5f12.png" data-original-src="https://miro.medium.com/v2/resize:fit:1280/1*SSGjl39_ONrsdMYNlQ7-gA.gif"/></div><figcaption class="ix iy fg fe ff iz ja bd b be z ek">Cooool (Souce — Giphy)</figcaption></figure><p id="f7db" class="pw-post-body-paragraph jc jd ht je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hm dt translated">你有它！我希望你喜欢读这一半就像我喜欢写它一样。如果有，请为帖子鼓掌并分享。你也应该关注我，看看我的其他帖子。</p></div></div>    
</body>
</html>