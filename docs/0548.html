<html>
<head>
<title>Subverting the Circular Reference Error in Solidity</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在坚固性上颠覆循环参考误差</h1>
<blockquote>原文：<a href="https://medium.com/coinmonks/subverting-the-circular-reference-error-in-solidity-f7167bf9fdb?source=collection_archive---------12-----------------------#2018-05-16">https://medium.com/coinmonks/subverting-the-circular-reference-error-in-solidity-f7167bf9fdb?source=collection_archive---------12-----------------------#2018-05-16</a></blockquote><div><div class="ef hh hi hj hk hl"/><div class="hm hn ho hp hq"><div class=""/><figure class="fi fk ir is it iu fe ff paragraph-image"><div class="fe ff iq"><img src="../Images/4b7159a73c5eab863d43fd5a0383e033.png" data-original-src="https://miro.medium.com/v2/resize:fit:1180/format:webp/0*4qvPEDLWc52Gxf4Q.jpg"/></div></figure><p id="e278" class="pw-post-body-paragraph ix iy ht iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju hm dt translated">最近，在我的Solidity adventures中，我一直在开发一个简单的留言板合同(仍在开发中)，带有类似于reddit的投票机制。在尝试实现注释链之前，我一直在宁静中编码。如果你不知道评论链风格的留言板(欢迎来到互联网，你一定是新来的)，这里有一个来自reddit的例子。</p><figure class="jx jy jz ka fq iu fe ff paragraph-image"><div class="fe ff jw"><img src="../Images/45850c3ca04e84db89c89fb39b68b675.png" data-original-src="https://miro.medium.com/v2/resize:fit:1280/0*Zurrt3Amic0lnKvD."/></div></figure><p id="f36a" class="pw-post-body-paragraph ix iy ht iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju hm dt translated">如你所见，一个评论可以包含许多子评论，子评论可以有自己的子评论。</p><h2 id="21f2" class="kb kc ht bd kd ke kf kg kh ki kj kk kl ji km kn ko jm kp kq kr jq ks kt ku kv dt translated">遇到循环引用错误</h2><p id="3f65" class="pw-post-body-paragraph ix iy ht iz b ja kw jc jd je kx jg jh ji ky jk jl jm kz jo jp jq la js jt ju hm dt translated">在匆忙中，我编写了一个简单的实现，其中注释契约只是存储了一组其他注释的地址。这样，我的应用程序的前端就可以在合同中查询评论的子评论。这个不可编译的实现如下所示。</p><figure class="jx jy jz ka fq iu fe ff paragraph-image"><div role="button" tabindex="0" class="lc ld di le bf lf"><div class="fe ff lb"><img src="../Images/78506a999a47f6133d4cb323846df4db.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*oBE9_bHgFJnDMceZp-OELQ.png"/></div></div><figcaption class="lg lh fg fe ff li lj bd b be z ek">Note: Much of the contract left out for brevity. Using remix.ethereum.org IDE.</figcaption></figure><p id="fe3e" class="pw-post-body-paragraph ix iy ht iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju hm dt translated">对于像我这样的日常工作的java开发人员来说，这种类型的引用是正常的，但是在solidity中，您不能进行这样的循环引用，否则将会收到一个编译器错误。</p><figure class="jx jy jz ka fq iu fe ff paragraph-image"><div role="button" tabindex="0" class="lc ld di le bf lf"><div class="fe ff lk"><img src="../Images/9d84c0237943d8a97942a043dbbbf7ec.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GLHdXmPHQiJ5rrwZkRy6Aw.png"/></div></div><figcaption class="lg lh fg fe ff li lj bd b be z ek">Circular reference error</figcaption></figure><h2 id="9aed" class="kb kc ht bd kd ke kf kg kh ki kj kk kl ji km kn ko jm kp kq kr jq ks kt ku kv dt translated">(丑陋的)解决方案</h2><p id="d7ce" class="pw-post-body-paragraph ix iy ht iz b ja kw jc jd je kx jg jh ji ky jk jl jm kz jo jp jq la js jt ju hm dt translated">不幸的是，我没有找到解决这个错误的干净的方法，但是有志者事竟成。我们可以通过创建两个新契约来颠覆这个编译错误。我将这些合同命名为<strong class="iz hu">制造商</strong>和<strong class="iz hu">供应商</strong>合同。<strong class="iz hu"> Maker </strong>契约包含创建您希望存储的任何契约的实际功能，在我的例子中，是VotethComment，而<strong class="iz hu"> Supplier </strong>契约是对Maker契约的抽象，所以当我们使用它时，编译器并不知道。要创建这个供应商契约，您所需要的就是maker契约的方法签名。供应商将是我们在主合同中使用的合同。</p><figure class="jx jy jz ka fq iu fe ff paragraph-image"><div role="button" tabindex="0" class="lc ld di le bf lf"><div class="fe ff ll"><img src="../Images/984383c229ef74b03ce490a856a45e77.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_oSrO3I8KDC0WVt-FuChuA.png"/></div></div><figcaption class="lg lh fg fe ff li lj bd b be z ek">Comment maker and supplier contracts.</figcaption></figure><p id="38ce" class="pw-post-body-paragraph ix iy ht iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju hm dt translated">现在这个实现带有一个警告，我们现在必须生成一个Maker契约，并把它的地址传递给我们的主契约。新的VotethComment契约现在看起来会是这样的。</p><figure class="jx jy jz ka fq iu fe ff paragraph-image"><div role="button" tabindex="0" class="lc ld di le bf lf"><div class="fe ff lm"><img src="../Images/23b716d03a6c04db1b4afd2dc05f13a1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zkz6jqFiI56jpwtb_Yl7mw.png"/></div></div><figcaption class="lg lh fg fe ff li lj bd b be z ek">Full code with main contract, maker contract, and supplier contract</figcaption></figure><p id="384c" class="pw-post-body-paragraph ix iy ht iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju hm dt translated">如您所见，我们现在必须将生成的<strong class="iz hu"> Maker </strong>契约传递给构造函数。addComment函数也进行了修改。现在我们用制造商的地址创建一个<strong class="iz hu">供应商</strong>。这通常是在创建调用现有契约的契约时完成的(<a class="ae jv" href="https://ethereum.stackexchange.com/questions/9733/calling-function-from-deployed-contract?utm_medium=organic&amp;utm_source=google_rich_qa&amp;utm_campaign=google_rich_qa" rel="noopener ugc nofollow" target="_blank">又名抽象契约</a>)。供应商现在可以创建一个VotethComment，我们将该注释添加到VotethComments数组中，以便在前端使用。哒哒！评论链！(至少在后端……)</p><h2 id="b140" class="kb kc ht bd kd ke kf kg kh ki kj kk kl ji km kn ko jm kp kq kr jq ks kt ku kv dt translated">打扫干净</h2><p id="6102" class="pw-post-body-paragraph ix iy ht iz b ja kw jc jd je kx jg jh ji ky jk jl jm kz jo jp jq la js jt ju hm dt translated">因为我正在创建一个reddit风格的留言板应用程序，所以我能够通过将Maker契约放在VotethComment契约的父契约中来清理它的生成，而不是手动生成这个类。这使得我可以忽略漂浮在区块链某处的Maker契约的存在，将它存储在VotethPost契约中以供继续使用。</p><figure class="jx jy jz ka fq iu fe ff paragraph-image"><div role="button" tabindex="0" class="lc ld di le bf lf"><div class="fe ff ln"><img src="../Images/3247cf936a9ab04b8c34d7f3486b5efc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XnQfYPsEG2zV4o9qF02O9A.png"/></div></div></figure><p id="b3a1" class="pw-post-body-paragraph ix iy ht iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju hm dt translated">正如您在这里看到的，当我调用“new VotethComment()”时，我传递的是方便地存储在创建时的VotethPost契约中的注释标记。</p><p id="6035" class="pw-post-body-paragraph ix iy ht iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju hm dt translated">你可以在我的github上的这里查看完整的示例解决方案<a class="ae jv" href="https://github.com/Kyrrui/SoliditySandbox/blob/master/CircularReferenceExampleSolution.sol" rel="noopener ugc nofollow" target="_blank">！请随意在混音中使用它！</a></p><p id="ba94" class="pw-post-body-paragraph ix iy ht iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju hm dt translated">如果你对我有任何建议或替代方案，请在下面的评论中告诉我！</p><h1 id="8216" class="lo kc ht bd kd lp lq lr kh ls lt lu kl lv lw lx ko ly lz ma kr mb mc md ku me dt translated">感谢阅读！</h1><p id="fc28" class="pw-post-body-paragraph ix iy ht iz b ja kw jc jd je kx jg jh ji ky jk jl jm kz jo jp jq la js jt ju hm dt translated">我的以太坊地址:0x 947 dee 856 a 22 e 8598 addfe 4 EC 3175248235 eef 01</p><p id="fa57" class="pw-post-body-paragraph ix iy ht iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju hm dt translated">我的LinkedIn:【https://www.linkedin.com/in/kyle-c-bryant/】T2</p><p id="a7cb" class="pw-post-body-paragraph ix iy ht iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju hm dt translated">我这个月会去布宜诺斯艾利斯参加<a class="ae jv" href="https://ethbuenosaires.com/" rel="noopener ugc nofollow" target="_blank">黑客马拉松</a>，请告诉我你是否会去，这样我们就可以联系了！</p></div></div>    
</body>
</html>