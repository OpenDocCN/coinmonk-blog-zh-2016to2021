<html>
<head>
<title>A day with Vyper</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">与Vyper共度的一天</h1>
<blockquote>原文：<a href="https://medium.com/coinmonks/a-day-with-vyper-6a0a5861f24a?source=collection_archive---------2-----------------------#2018-09-20">https://medium.com/coinmonks/a-day-with-vyper-6a0a5861f24a?source=collection_archive---------2-----------------------#2018-09-20</a></blockquote><div><div class="ef hh hi hj hk hl"/><div class="hm hn ho hp hq"><div class=""/><figure class="fi fk ir is it iu fe ff paragraph-image"><div role="button" tabindex="0" class="iv iw di ix bf iy"><div class="fe ff iq"><img src="../Images/2f96a8def56f76c3e9e1386456bf5f45.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*g2GN7aR_a7pRE_TiRmDmqg.jpeg"/></div></div></figure><p id="609b" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">几天前，为了继续我的认证注册，我收到了一封来自<a class="ae jz" href="https://b9lab.com/" rel="noopener ugc nofollow" target="_blank"> <strong class="jd hu"> B9Lab </strong> </a>的电子邮件，要求我发送一个代表我的EOA地址或合同地址。</p><p id="312d" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">这听起来像是一个检查我的待办事项列表中的三项的好机会:</p><p id="f6da" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">1.在媒体上写我的第一篇文章</p><p id="a336" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">2.在<strong class="jd hu"> Vyper </strong>中编写智能合同</p><p id="6f3a" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">3.检查Vyper在<a class="ae jz" href="https://truffleframework.com/" rel="noopener ugc nofollow" target="_blank"> <strong class="jd hu">松露</strong> </a>环境中的实际集成。</p><p id="6fc9" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">让我们从Vyper开始这一天吧！</p><h1 id="e344" class="ka kb ht bd kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx dt translated">为什么是Vyper</h1><p id="7c61" class="pw-post-body-paragraph jb jc ht jd b je ky jg jh ji kz jk jl jm la jo jp jq lb js jt ju lc jw jx jy hm dt translated">在问为什么是Vyper之前，让我们先看看什么是智能合同。这是一个微服务，有一些函数可以调用，以便在一个分散的环境中存储和读取东西？是的，当然是。但是从非技术的角度来看，智能合同是机器和世界其他部分之间的交易。只要网络存在，就以某种方式工作的协议。</p><p id="8dc6" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">考虑到这些原则，一份巧妙的合同应该<strong class="jd hu">易于书写</strong>但也必须<strong class="jd hu">易于阅读</strong>。</p><p id="1e3a" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">从<a class="ae jz" href="https://github.com/ethereum/vyper" rel="noopener ugc nofollow" target="_blank">到<strong class="jd hu">的Doc </strong>到</a>:</p><blockquote class="ld le lf"><p id="62eb" class="jb jc lg jd b je jf jg jh ji jj jk jl lh jn jo jp li jr js jt lj jv jw jx jy hm dt translated">对读者来说简单比对作者来说简单更重要，而对没有多少Vyper使用经验(以及一般编程经验)的读者来说简单尤为重要。</p></blockquote><p id="5f5e" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">简单首先将意味着Vyper没有:<strong class="jd hu">修饰符</strong>、<strong class="jd hu">类继承、内联汇编、函数重载、运算符重载、递归调用、无限长循环</strong>和<strong class="jd hu">二进制不动点。</strong></p></div><div class="ab cl lk ll hb lm" role="separator"><span class="ln bw bk lo lp lq"/><span class="ln bw bk lo lp lq"/><span class="ln bw bk lo lp"/></div><div class="hm hn ho hp hq"><h1 id="70f1" class="ka kb ht bd kc kd lr kf kg kh ls kj kk kl lt kn ko kp lu kr ks kt lv kv kw kx dt translated">安装Vyper</h1><p id="0406" class="pw-post-body-paragraph jb jc ht jd b je ky jg jh ji kz jk jl jm la jo jp jq lb js jt ju lc jw jx jy hm dt translated">我在<strong class="jd hu"> MacOS </strong>上，对于不同的OS点击<a class="ae jz" href="https://vyper.readthedocs.io/en/latest/installing-vyper.html" rel="noopener ugc nofollow" target="_blank">这里</a>。</p><p id="19ba" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated"><strong class="jd hu">先决条件:</strong></p><ol class=""><li id="1649" class="lw lx ht jd b je jf ji jj jm ly jq lz ju ma jy mb mc md me dt translated">安装<a class="ae jz" href="https://docs.brew.sh/Installation.html" rel="noopener ugc nofollow" target="_blank"> Brew </a></li><li id="b951" class="lw lx ht jd b je mf ji mg jm mh jq mi ju mj jy mb mc md me dt translated">安装<a class="ae jz" href="https://python-guide.readthedocs.io/en/latest/starting/install3/osx/" rel="noopener ugc nofollow" target="_blank"> Python </a> ≥ 3.6</li><li id="6565" class="lw lx ht jd b je mf ji mg jm mh jq mi ju mj jy mb mc md me dt translated">安装<a class="ae jz" href="https://changelog.com/posts/install-node-js-with-homebrew-on-os-x" rel="noopener ugc nofollow" target="_blank"> npm </a></li><li id="fc2d" class="lw lx ht jd b je mf ji mg jm mh jq mi ju mj jy mb mc md me dt translated">检查<em class="lg"> gmp </em> <em class="lg"> leveldb </em>是否安装了Brew。</li></ol><p id="6f93" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">Vyper仍然是测试版，所以我们将把它安装在一个虚拟的python环境中。</p><p id="195d" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated"><strong class="jd hu">虚拟环境:</strong></p><pre class="mk ml mm mn fq mo mp mq mr aw ms dt"><span id="2699" class="mt kb ht mp b fv mu mv l mw mx">$ sudo apt install virtualenv</span><span id="575e" class="mt kb ht mp b fv my mv l mw mx">$ virtualenv -p python3.6 — no-site-packages ~/vyper-venv</span><span id="f188" class="mt kb ht mp b fv my mv l mw mx">$ source ~/vyper-venv/bin/activate</span></pre><p id="f239" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated"><strong class="jd hu">维普:</strong></p><pre class="mk ml mm mn fq mo mp mq mr aw ms dt"><span id="84c7" class="mt kb ht mp b fv mu mv l mw mx">$ git clone <a class="ae jz" href="https://github.com/ethereum/vyper.git" rel="noopener ugc nofollow" target="_blank">https://github.com/ethereum/vyper.git</a></span><span id="aaf9" class="mt kb ht mp b fv my mv l mw mx">$ cd vyper</span><span id="7b02" class="mt kb ht mp b fv my mv l mw mx">$ make</span><span id="6b65" class="mt kb ht mp b fv my mv l mw mx">$ make test</span></pre></div><div class="ab cl lk ll hb lm" role="separator"><span class="ln bw bk lo lp lq"/><span class="ln bw bk lo lp lq"/><span class="ln bw bk lo lp"/></div><div class="hm hn ho hp hq"><h1 id="ffa7" class="ka kb ht bd kc kd lr kf kg kh ls kj kk kl lt kn ko kp lu kr ks kt lv kv kw kx dt translated">项目设置</h1><p id="cd03" class="pw-post-body-paragraph jb jc ht jd b je ky jg jh ji kz jk jl jm la jo jp jq lb js jt ju lc jw jx jy hm dt translated">我们将使用Truttle的<code class="eh mz na nb mp b">init</code>选项来搭建我们的项目。</p><p id="b682" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">首先我们要装松露:</p><pre class="mk ml mm mn fq mo mp mq mr aw ms dt"><span id="d07d" class="mt kb ht mp b fv mu mv l mw mx">$ npm install -g truffle</span></pre><p id="c8d8" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">创建并移动到新文件夹:</p><pre class="mk ml mm mn fq mo mp mq mr aw ms dt"><span id="5d8a" class="mt kb ht mp b fv mu mv l mw mx">$ mkdir identity-test &amp;&amp; cd identity-test</span></pre><p id="7191" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">初始化项目:</p><pre class="mk ml mm mn fq mo mp mq mr aw ms dt"><span id="f4ca" class="mt kb ht mp b fv mu mv l mw mx">$ truffle init</span></pre></div><div class="ab cl lk ll hb lm" role="separator"><span class="ln bw bk lo lp lq"/><span class="ln bw bk lo lp lq"/><span class="ln bw bk lo lp"/></div><div class="hm hn ho hp hq"><h1 id="0fb9" class="ka kb ht bd kc kd lr kf kg kh ls kj kk kl lt kn ko kp lu kr ks kt lv kv kw kx dt translated">写身份契约</h1><p id="38cc" class="pw-post-body-paragraph jb jc ht jd b je ky jg jh ji kz jk jl jm la jo jp jq lb js jt ju lc jw jx jy hm dt translated">该项目的目的是写一个基本的身份契约，代表我是谁。我的基本身份是由:<em class="lg">名</em>、<em class="lg">姓</em>和<em class="lg">年龄组成，仅此而已</em>和<em class="lg">不比</em>少。</p><p id="ee01" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">在<em class="lg"> contracts </em>文件夹中创建一个名为Identity.v.py的文件(是的，我们可以使用python语法highlighter)。</p><h2 id="7510" class="mt kb ht bd kc nc nd ne kg nf ng nh kk jm ni nj ko jq nk nl ks ju nm nn kw no dt translated">声明五个公共变量:</h2><figure class="mk ml mm mn fq iu"><div class="bz el l di"><div class="np nq l"/></div></figure><ol class=""><li id="3f47" class="lw lx ht jd b je jf ji jj jm ly jq lz ju ma jy mb mc md me dt translated"><em class="lg">所有者</em>是创建合同的所有者的地址</li><li id="e59c" class="lw lx ht jd b je mf ji mg jm mh jq mi ju mj jy mb mc md me dt translated"><em class="lg">名和姓</em>是名和姓的32字节表示。</li><li id="0da1" class="lw lx ht jd b je mf ji mg jm mh jq mi ju mj jy mb mc md me dt translated"><em class="lg">出生</em>是一个int128，代表出生的时间戳。(如果我使用负时间戳—1970年之前的日期—，<code class="eh mz na nb mp b">assert birth &lt; block.timestamp </code>恢复我的交易，如果您知道原因，请写在注释中)。</li><li id="4dfc" class="lw lx ht jd b je mf ji mg jm mh jq mi ju mj jy mb mc md me dt translated"><em class="lg">创建时间</em>时间戳代表身份创建的日期<em class="lg">。</em></li></ol><h2 id="3e4b" class="mt kb ht bd kc nc nd ne kg nf ng nh kk jm ni nj ko jq nk nl ks ju nm nn kw no dt translated"><strong class="ak">申报创作<em class="nr">事件:</em> </strong></h2><figure class="mk ml mm mn fq iu"><div class="bz el l di"><div class="np nq l"/></div></figure><h2 id="391e" class="mt kb ht bd kc nc nd ne kg nf ng nh kk jm ni nj ko jq nk nl ks ju nm nn kw no dt translated"><strong class="ak">建造者:</strong></h2><figure class="mk ml mm mn fq iu"><div class="bz el l di"><div class="np nq l"/></div></figure><p id="cd76" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated"><em class="lg">我们定义:</em></p><ol class=""><li id="c5e8" class="lw lx ht jd b je jf ji jj jm ly jq lz ju ma jy mb mc md me dt translated">一个<em class="lg">公共</em> __init__函数，取:<em class="lg">名</em>、<em class="lg">姓</em>和<em class="lg">出生</em>。</li><li id="85a3" class="lw lx ht jd b je mf ji mg jm mh jq mi ju mj jy mb mc md me dt translated">我们检查我们的函数参数不为空(注意:<code class="eh mz na nb mp b">assert not not _firstname </code>等于<code class="eh mz na nb mp b">assert _firstname != 0x000000000000000</code>)</li><li id="b892" class="lw lx ht jd b je mf ji mg jm mh jq mi ju mj jy mb mc md me dt translated">我们定义我们的公共变量。</li><li id="dc2e" class="lw lx ht jd b je mf ji mg jm mh jq mi ju mj jy mb mc md me dt translated">我们记录了<em class="lg">创建</em>事件</li></ol><h2 id="0f05" class="mt kb ht bd kc nc nd ne kg nf ng nh kk jm ni nj ko jq nk nl ks ju nm nn kw no dt translated"><strong class="ak">名字更新功能:</strong></h2><figure class="mk ml mm mn fq iu"><div class="bz el l di"><div class="np nq l"/></div></figure><p id="e189" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">这里，我们更新<em class="lg">名字</em>，如果:(I)不为空，(ii)交易来自所有者，以及(iii)新名字不等于旧名字。最后我们返回新的名字。</p><h2 id="3af8" class="mt kb ht bd kc nc nd ne kg nf ng nh kk jm ni nj ko jq nk nl ks ju nm nn kw no dt translated"><strong class="ak">回退功能:</strong></h2><p id="7f6a" class="pw-post-body-paragraph jb jc ht jd b je ky jg jh ji kz jk jl jm la jo jp jq lb js jt ju lc jw jx jy hm dt translated">当函数签名与任何可用函数都不匹配时，或者当有人试图向我们的合同发送以太网时，就会触发回退函数。</p><figure class="mk ml mm mn fq iu"><div class="bz el l di"><div class="np nq l"/></div></figure><p id="e003" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">如果有人想在我们的合同上签字，我们会退回去。</p></div><div class="ab cl lk ll hb lm" role="separator"><span class="ln bw bk lo lp lq"/><span class="ln bw bk lo lp lq"/><span class="ln bw bk lo lp"/></div><div class="hm hn ho hp hq"><h1 id="bd21" class="ka kb ht bd kc kd lr kf kg kh ls kj kk kl lt kn ko kp lu kr ks kt lv kv kw kx dt translated">块菌整合</h1><p id="fb2b" class="pw-post-body-paragraph jb jc ht jd b je ky jg jh ji kz jk jl jm la jo jp jq lb js jt ju lc jw jx jy hm dt translated">Truffle还不支持Vyper契约，所以我们需要一些工具来将Vyper编译成Truffle的兼容工件。救救我们吧！</p><p id="4ba4" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">安装Truper:</p><pre class="mk ml mm mn fq mo mp mq mr aw ms dt"><span id="d502" class="mt kb ht mp b fv mu mv l mw mx">$ npm install -g truper</span></pre><p id="eb2c" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">创建包文件:</p><pre class="mk ml mm mn fq mo mp mq mr aw ms dt"><span id="d303" class="mt kb ht mp b fv mu mv l mw mx">$ npm init</span></pre><p id="f26a" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">在<em class="lg">脚本</em>字段中添加以下脚本:</p><pre class="mk ml mm mn fq mo mp mq mr aw ms dt"><span id="7790" class="mt kb ht mp b fv mu mv l mw mx">"scripts": {</span><span id="fe09" class="mt kb ht mp b fv my mv l mw mx">  "build:sol": "truffle compile",</span><span id="e6aa" class="mt kb ht mp b fv my mv l mw mx">  "build:vyper": "truper",</span><span id="0e7c" class="mt kb ht mp b fv my mv l mw mx">  "build": "npm run build:sol &amp;&amp; npm run build:vyper",</span><span id="d3bf" class="mt kb ht mp b fv my mv l mw mx">  "console": "truffle console",</span><span id="bace" class="mt kb ht mp b fv my mv l mw mx">  "migrate:ganache": "truffle migrate --network ganache",</span><span id="9d3d" class="mt kb ht mp b fv my mv l mw mx">  "migrate:mainnet": "truffle migrate --network mainnet",</span><span id="9af3" class="mt kb ht mp b fv my mv l mw mx">  "test": "truffle test"</span><span id="c223" class="mt kb ht mp b fv my mv l mw mx">},</span></pre><p id="5c30" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">现在我们可以运行构建任务，将vyper和solidity契约构建到<em class="lg"> /build </em>文件夹中(<strong class="jd hu"> N.B. </strong>记得运行到<strong class="jd hu"> virtualenv </strong>)。</p><pre class="mk ml mm mn fq mo mp mq mr aw ms dt"><span id="488b" class="mt kb ht mp b fv mu mv l mw mx">$ npm run build</span></pre></div><div class="ab cl lk ll hb lm" role="separator"><span class="ln bw bk lo lp lq"/><span class="ln bw bk lo lp lq"/><span class="ln bw bk lo lp"/></div><div class="hm hn ho hp hq"><h1 id="898d" class="ka kb ht bd kc kd lr kf kg kh ls kj kk kl lt kn ko kp lu kr ks kt lv kv kw kx dt translated">试验</h1><p id="168b" class="pw-post-body-paragraph jb jc ht jd b je ky jg jh ji kz jk jl jm la jo jp jq lb js jt ju lc jw jx jy hm dt translated">关于我们的块菌集成，最有趣的事情之一是我们可以很容易地测试我们的代码。</p><p id="1969" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">在<em class="lg">测试</em>文件夹中创建一个新文件<em class="lg"> Identity.test.js </em>。</p><p id="8e28" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">添加<a class="ae jz" href="https://momentjs.com/" rel="noopener ugc nofollow" target="_blank"> momentjs </a>和<a class="ae jz" href="http://bluebirdjs.com/docs/getting-started.html" rel="noopener ugc nofollow" target="_blank">蓝鸟</a>:</p><pre class="mk ml mm mn fq mo mp mq mr aw ms dt"><span id="5a42" class="mt kb ht mp b fv mu mv l mw mx">$ npm install moment bluebird</span></pre><h2 id="15a3" class="mt kb ht bd kc nc nd ne kg nf ng nh kk jm ni nj ko jq nk nl ks ju nm nn kw no dt translated"><strong class="ak">现在我们测试我们的构造函数:</strong></h2><figure class="mk ml mm mn fq iu"><div class="bz el l di"><div class="np nq l"/></div></figure><p id="fc33" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">为了<strong class="jd hu">测试</strong>我们的构造器，我们有两个<strong class="jd hu">主“块”</strong>:</p><ol class=""><li id="6a46" class="lw lx ht jd b je jf ji jj jm ly jq lz ju ma jy mb mc md me dt translated"><strong class="jd hu">失败案例:</strong>我们测试合同创建是否失败(I)值<strong class="jd hu">为空</strong>；以及(ii)如果我们在事务中使用<strong class="jd hu">值，则<strong class="jd hu"> </strong>。</strong></li><li id="b7a3" class="lw lx ht jd b je mf ji mg jm mh jq mi ju mj jy mb mc md me dt translated"><strong class="jd hu">成功案例:</strong>我们测试<em class="lg">名</em>、<em class="lg">姓</em>、<em class="lg">主</em>和<em class="lg">出生</em>是否有正确的值。注意，我们必须用<code class="eh mz na nb mp b">web3.toUtf8()</code>将utf8中的字节32和bigNumber转换成用<code class="eh mz na nb mp b">toString(10)</code>表示的字符串</li></ol><h2 id="97be" class="mt kb ht bd kc nc nd ne kg nf ng nh kk jm ni nj ko jq nk nl ks ju nm nn kw no dt translated"><strong class="ak">更新FistName测试:</strong></h2><figure class="mk ml mm mn fq iu"><div class="bz el l di"><div class="np nq l"/></div></figure><ol class=""><li id="231f" class="lw lx ht jd b je jf ji jj jm ly jq lz ju ma jy mb mc md me dt translated"><strong class="jd hu">失败情况:</strong>我们测试函数是否失败，其中(I)事务来自<strong class="jd hu">非所有者</strong>地址(ii) <strong class="jd hu"> </strong>新名称为<strong class="jd hu">空</strong>，以及(iii)新名称<strong class="jd hu">等于旧名称</strong>。</li><li id="2c3c" class="lw lx ht jd b je mf ji mg jm mh jq mi ju mj jy mb mc md me dt translated"><strong class="jd hu">成功案例:</strong>我们测试新的<em class="lg">名字</em>是否有新的值。</li></ol><h2 id="20ba" class="mt kb ht bd kc nc nd ne kg nf ng nh kk jm ni nj ko jq nk nl ks ju nm nn kw no dt translated"><strong class="ak">回退测试:</strong></h2><figure class="mk ml mm mn fq iu"><div class="bz el l di"><div class="np nq l"/></div></figure><p id="447f" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">回退功能发送回不包括交易费用的交易值，因此我们在交易开始和结束时检查发送方的余额。</p><p id="8350" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">现在跑<code class="eh mz na nb mp b">$ npm run test</code></p></div><div class="ab cl lk ll hb lm" role="separator"><span class="ln bw bk lo lp lq"/><span class="ln bw bk lo lp lq"/><span class="ln bw bk lo lp"/></div><div class="hm hn ho hp hq"><h1 id="795f" class="ka kb ht bd kc kd lr kf kg kh ls kj kk kl lt kn ko kp lu kr ks kt lv kv kw kx dt translated"><strong class="ak">部署到主网</strong></h1><p id="90a1" class="pw-post-body-paragraph jb jc ht jd b je ky jg jh ji kz jk jl jm la jo jp jq lb js jt ju lc jw jx jy hm dt translated">现在我们把合同放在主网上。我将使用<a class="ae jz" href="https://infura.io/" rel="noopener ugc nofollow" target="_blank"> Infura </a>作为以太坊的连接提供者。</p><p id="39d3" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">首先，我们必须安装<a class="ae jz" href="https://github.com/trufflesuite/truffle-hdwallet-provider" rel="noopener ugc nofollow" target="_blank"> HDWalletProvider </a>来处理交易签名以及与以太网的连接。</p><pre class="mk ml mm mn fq mo mp mq mr aw ms dt"><span id="92fa" class="mt kb ht mp b fv mu mv l mw mx">$ npm install <!-- -->truffle-hdwallet-provider</span></pre><p id="45be" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">接下来在<em class="lg"> truffle.js </em>中，我们必须设置我们的钱包提供商:</p><figure class="mk ml mm mn fq iu"><div class="bz el l di"><div class="np nq l"/></div></figure><ol class=""><li id="35f4" class="lw lx ht jd b je jf ji jj jm ly jq lz ju ma jy mb mc md me dt translated"><strong class="jd hu">记忆:</strong>是你钱包的12个种子字。</li><li id="7ad9" class="lw lx ht jd b je mf ji mg jm mh jq mi ju mj jy mb mc md me dt translated">infura api key: 注册infura后的key。</li><li id="33f8" class="lw lx ht jd b je mf ji mg jm mh jq mi ju mj jy mb mc md me dt translated"><strong class="jd hu">气价</strong>:查看<a class="ae jz" href="https://ethgasstation.info/" rel="noopener ugc nofollow" target="_blank"> Eth加油站</a>了解当前气价(<strong class="jd hu"> N.B. </strong>气价以卫为单位，Eth加油站以Gwei为单位)。</li></ol><p id="a753" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">运行<code class="eh mz na nb mp b">$ npm run migrate:mainnet</code></p><p id="8560" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">仅此而已。回头见！:)</p><blockquote class="ns"><p id="377a" class="nt nu ht bd nv nw nx ny nz oa ob jy ek translated"><a class="ae jz" href="https://coincodecap.com/?utm_source=coinmonks" rel="noopener ugc nofollow" target="_blank">在您的收件箱中直接获得最佳软件交易</a></p></blockquote><figure class="od oe of og oh iu fe ff paragraph-image"><a href="https://coincodecap.com/?utm_source=coinmonks"><div class="fe ff oc"><img src="../Images/7c0b3dfdcbfea594cc0ae7d4f9bf6fcb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1168/format:webp/0*OJ-qb5G6i863msBB.png"/></div></a></figure></div></div>    
</body>
</html>