<html>
<head>
<title>USA Election POC — Ethereum DAPP</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">美国选举POC —以太坊DAPP</h1>
<blockquote>原文：<a href="https://medium.com/coinmonks/usa-election-poc-ethereum-dapp-8cf02b6e20a?source=collection_archive---------2-----------------------#2020-07-07">https://medium.com/coinmonks/usa-election-poc-ethereum-dapp-8cf02b6e20a?source=collection_archive---------2-----------------------#2020-07-07</a></blockquote><div><div class="ef hh hi hj hk hl"/><div class="hm hn ho hp hq"><div class=""/><figure class="fi fk ir is it iu fe ff paragraph-image"><div role="button" tabindex="0" class="iv iw di ix bf iy"><div class="fe ff iq"><img src="../Images/3ceef33be1ed0256b63020d39f4f7c11.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*C5Y8SXpwMCv2WwuI_8OJ-A.jpeg"/></div></div></figure><p id="b445" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">嘿，各位，在这篇博客中，我们将经历编译、部署和交互一个极其简单的应用程序的过程，它所做的只是初始化一组候选人，在我们的例子中是<strong class="jd hu"><em class="jz">【唐纳德·川普</em></strong>&amp;<strong class="jd hu"><em class="jz">【乔·拜登】</em> </strong> <strong class="jd hu"> <em class="jz">(如果埃隆·马斯克真的推动我们很快将“凯恩·韦斯特”加入名单…) </em> </strong>，这个应用程序将让任何人给候选人投票，并显示每个候选人获得的总票数</p><p id="b475" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">用专业术语来说，我们将在两位候选人之间举行选举。我们将针对智能合约编写测试，将其部署到<strong class="jd hu">以太坊区块链</strong>，并开发一个允许帐户投票的客户端应用程序。我们还将考察一些关键概念，如<strong class="jd hu"><em class="jz"/></strong><a class="ae ka" href="https://blog.coincodecap.com/what-is-blockchain-a-simple-guide-for-dummies/" rel="noopener ugc nofollow" target="_blank"><strong class="jd hu"><em class="jz">什么是区块链</em> </strong> </a> <strong class="jd hu"> <em class="jz">？”</em> </strong>、<strong class="jd hu"> <em class="jz">“什么是智能合约？”</em> </strong>，还有<strong class="jd hu"><em class="jz"/></strong><a class="ae ka" href="https://blog.coincodecap.com/what-are-dapps-an-ultimate-guide" rel="noopener ugc nofollow" target="_blank"><strong class="jd hu"><em class="jz">一个dApp怎么工作</em> </strong> </a> <strong class="jd hu"> <em class="jz">？”。</em>T45】</strong></p><h1 id="8cac" class="kb kc ht bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky dt translated">什么是区块链？</h1><p id="c373" class="pw-post-body-paragraph jb jc ht jd b je kz jg jh ji la jk jl jm lb jo jp jq lc js jt ju ld jw jx jy hm dt translated">通常当你与网络应用程序交互时，你使用网络浏览器通过网络连接到<strong class="jd hu"> <em class="jz">中央服务器</em> </strong>。这个web应用程序的所有代码都保存在这个中央服务器上，所有数据都保存在一个中央数据库中。每当您处理应用程序时，都必须与web上的这个中央服务器进行通信。</p><p id="5d0a" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">如果我们要在web上构建投票应用程序，我们会遇到一些问题:</p><ol class=""><li id="14b0" class="le lf ht jd b je jf ji jj jm lg jq lh ju li jy lj lk ll lm dt translated">数据库中的数据可能会被更改:它可能会被多次计数，或者被完全删除。</li><li id="0826" class="le lf ht jd b je ln ji lo jm lp jq lq ju lr jy lj lk ll lm dt translated">web服务器上的源代码也可以随时更改。</li></ol><p id="e65e" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">我们不想在网络上构建我们的应用程序。我们希望将它建立在区块链上，任何连接到网络的人都可以参加选举。我们希望确保他们的选票被计算在内，而且只被计算一次。让我们来看看它是如何工作的。</p><p id="117d" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">区块链不是有网络、中央服务器和数据库，<strong class="jd hu"> <em class="jz">而是集网络和数据库于一身的</em> </strong>。区块链是一个由计算机组成的<strong class="jd hu"><em class="jz"/></strong>对等网络，称为节点，共享网络中的所有数据和代码。不再有中央服务器了。只是一堆在同一个网络上互相交流的计算机。与集中式数据库不同，区块链中跨节点共享的所有交易数据都包含在称为块、  <em class="jz"> </em>的<strong class="jd hu"> <em class="jz">记录包中，这些记录被链接在一起以创建<strong class="jd hu">公共分类账</strong>。该公共分类账代表区块链中的所有数据。公共分类账中的所有数据都通过加密哈希进行保护，并通过一致算法进行验证。网络上的节点参与进来，以确保分布在网络上的所有数据副本都是相同的。这是我们在区块链上构建投票应用程序的一个非常重要的原因，因为我们希望确保我们的投票被计算在内，并且不会改变。</em></strong></p><h1 id="38e5" class="kb kc ht bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky dt translated">什么是智能合同？</h1><p id="6e03" class="pw-post-body-paragraph jb jc ht jd b je kz jg jh ji la jk jl jm lb jo jp jq lc js jt ju ld jw jx jy hm dt translated">这就是投票过程的工作方式，但是我们实际上如何编写我们的应用程序呢？嗯，以太坊区块链允许我们用区块链上的以太坊虚拟机(EVM)通过一种叫做智能合约的东西来执行代码。</p><p id="fd58" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">智能合约是我们应用程序的所有业务逻辑所在。这是我们实际编写应用程序分散部分的地方。智能合约负责向区块链读写数据，以及执行业务逻辑。智能联系人是用一种叫做<a class="ae ka" href="https://solidity.readthedocs.io/en/v0.4.21/" rel="noopener ugc nofollow" target="_blank"> Solidity </a>的编程语言编写的。</p><figure class="lt lu lv lw fq iu fe ff paragraph-image"><div class="fe ff ls"><img src="../Images/d496f20d14dfb16069b5f8579d49ffc2.png" data-original-src="https://miro.medium.com/v2/resize:fit:978/format:webp/0*HMpyJNDP2yB6jpVv.png"/></div><figcaption class="lx ly fg fe ff lz ma bd b be z ek"><a class="ae ka" href="https://www.dappuniversity.com/dapp_diagram.png" rel="noopener ugc nofollow" target="_blank">https://www.dappuniversity.com/dapp_diagram.png</a></figcaption></figure><p id="6f4a" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated"><strong class="jd hu">什么是DAPP？</strong></p><p id="5143" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">DApp是分散应用的缩写形式。DApp的后端代码运行在一个分散的对等网络上。与后端代码运行在集中式服务器上的应用程序形成对比。</p><p id="72b7" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">一个DApp可以有用任何语言编写的前端代码和用户界面(就像一个应用程序一样)，可以调用它的后端。此外，它的前端可以托管在分散存储上，如<a class="ae ka" href="https://ethereum.stackexchange.com/q/375/42" rel="noopener ugc nofollow" target="_blank"> Swarm </a>或<a class="ae ka" href="https://ipfs.io/" rel="noopener ugc nofollow" target="_blank"> IPFS </a>。</p><p id="6685" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">如果app=frontend+server，由于以太坊契约是在全球以太坊去中心化对等网络上运行的代码，那么:</p><p id="6efb" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated"><strong class="jd hu"> DApp =前端+合约</strong></p><p id="2830" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">来源:<a class="ae ka" href="https://ethereum.stackexchange.com/questions/383/what-is-a-dapp" rel="noopener ugc nofollow" target="_blank">https://ether eum . stack exchange . com/questions/383/what-is-a-dapp</a></p><h1 id="35f4" class="kb kc ht bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky dt translated">DAPP的类型</h1><blockquote class="mb mc md"><p id="1f56" class="jb jc jz jd b je jf jg jh ji jj jk jl me jn jo jp mf jr js jt mg jv jw jx jy hm dt translated"><em class="ht"> Johnston指出有三种dapps。</em></p><p id="9099" class="jb jc jz jd b je jf jg jh ji jj jk jl me jn jo jp mf jr js jt mg jv jw jx jy hm dt translated"><strong class="jd hu"><em class="ht">I型</em> </strong> <em class="ht">分散式应用有自己的区块链，比如比特币。</em></p><p id="a9d0" class="jb jc jz jd b je jf jg jh ji jj jk jl me jn jo jp mf jr js jt mg jv jw jx jy hm dt translated"><strong class="jd hu"> <em class="ht">类型II </em> </strong> <em class="ht">分散式应用程序使用类型I分散式应用程序的区块链，但像Omni协议一样是“协议并具有其功能所必需的令牌”。</em></p><p id="6865" class="jb jc jz jd b je jf jg jh ji jj jk jl me jn jo jp mf jr js jt mg jv jw jx jy hm dt translated"><strong class="jd hu"> <em class="ht">第三类</em> </strong> <em class="ht">分散式应用程序使用第二类分散式应用程序的协议，并且“是协议并且具有其功能所必需的令牌”，例如</em> <a class="ae ka" href="https://safenetwork.org/" rel="noopener ugc nofollow" target="_blank"> <em class="ht">安全网络</em> </a> <em class="ht">使用Omni协议来发行‘安全币’。”</em></p><p id="31f6" class="jb jc jz jd b je jf jg jh ji jj jk jl me jn jo jp mf jr js jt mg jv jw jx jy hm dt translated"><em class="ht">把Dapps想象成和Windows、Mac OS X、Linux、Android、iOS一样的操作系统，作为I类分类。这些系统上的程序，如文字处理器或Dropbox，属于第二类。第三种类型的例子是集成了Dropbox的博客平台。</em></p></blockquote><p id="87c6" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">来源:<a class="ae ka" href="https://due.com/blog/why-build-decentralized-applications-understanding-dapp/" rel="noopener ugc nofollow" target="_blank">https://due . com/blog/why-build-decentralized-applications-understanding-dapp/</a></p></div><div class="ab cl mh mi hb mj" role="separator"><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm"/></div><div class="hm hn ho hp hq"><p id="e0bf" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">本博客的目标是:</p><ol class=""><li id="6ea7" class="le lf ht jd b je jf ji jj jm lg jq lh ju li jy lj lk ll lm dt translated">设置开发环境</li><li id="53f6" class="le lf ht jd b je ln ji lo jm lp jq lq ju lr jy lj lk ll lm dt translated">学习编写契约、编译它并在您的开发环境中部署它的过程。</li><li id="b87f" class="le lf ht jd b je ln ji lo jm lp jq lq ju lr jy lj lk ll lm dt translated">安装名为<a class="ae ka" href="http://truffleframework.com/" rel="noopener ugc nofollow" target="_blank"> Truffle </a>的以太坊dapp框架，它将用于编译和部署我们的合同</li><li id="d5f4" class="le lf ht jd b je ln ji lo jm lp jq lq ju lr jy lj lk ll lm dt translated">安装Ganache</li><li id="564f" class="le lf ht jd b je ln ji lo jm lp jq lq ju lr jy lj lk ll lm dt translated">通过网页与合同互动</li></ol><p id="bb89" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">首先也是最重要的是你的操作系统，你可以在Linux VM上工作，但是我推荐使用基于云的AWS EC2。我们可以很容易地免费设置它，跟随这个伟大的博客来设置您的AWS帐户和EC2实例很容易。</p><p id="9dee" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated"><a class="ae ka" rel="noopener" href="/@jameshamann/setting-up-an-ubuntu-ec2-instance-from-scratch-78a166167a22"><em class="jz">https://medium . com/@ James Hamann/setting-up-an-Ubuntu-ec2-instance-from-scratch-78a 166167 a22</em></a></p><p id="d9b1" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">下面是两张gif图，分别展示了创建实例和启动实例的过程。</p><figure class="lt lu lv lw fq iu fe ff paragraph-image"><div class="fe ff mo"><img src="../Images/ebf5c2177d7493ea53470f634871a888.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/0*lDTfAP1BrBCk2oru.gif"/></div><figcaption class="lx ly fg fe ff lz ma bd b be z ek">GIF 1 : Launching an AWS EC2 Instance</figcaption></figure><figure class="lt lu lv lw fq iu fe ff paragraph-image"><div class="fe ff mo"><img src="../Images/1b3788e9233ba7399401c9c2a102a691.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/0*ioduYTuqq4CLBkI9.gif"/></div><figcaption class="lx ly fg fe ff lz ma bd b be z ek">GIF 2: Launching an AWS EC2 Instance</figcaption></figure><p id="2f40" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated"><strong class="jd hu"> Node.js &amp; npm — </strong></p><ul class=""><li id="86f1" class="le lf ht jd b je jf ji jj jm lg jq lh ju li jy mp lk ll lm dt translated">Node.js是一个开源服务器环境</li><li id="9858" class="le lf ht jd b je ln ji lo jm lp jq lq ju lr jy mp lk ll lm dt translated">Node.js是免费的</li><li id="03c4" class="le lf ht jd b je ln ji lo jm lp jq lq ju lr jy mp lk ll lm dt translated">Node.js运行在各种平台上(Windows、Linux、Unix、Mac OS X等。)</li><li id="8b06" class="le lf ht jd b je ln ji lo jm lp jq lq ju lr jy mp lk ll lm dt translated">Node.js在服务器上使用JavaScript</li></ul><p id="59b4" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated"><strong class="jd hu">为什么是Node.js？</strong></p><p id="5e7e" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">Node.js使用异步编程，它消除了等待，只需继续处理下一个请求。Node.js运行单线程、非阻塞、异步编程，非常节省内存。</p><p id="b8b6" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">NPM是Node.js包或模块的包管理器。</p><p id="2d29" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">有关安装或更新<strong class="jd hu"> Node.js </strong>和<strong class="jd hu"> npm的详细信息，请访问<a class="ae ka" href="https://nodejs.org/en/download/" rel="noopener ugc nofollow" target="_blank">https://nodejs.org/en/download/</a>。</strong></p><p id="160d" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">以下是相同的GIF:</p><figure class="lt lu lv lw fq iu fe ff paragraph-image"><div class="fe ff mq"><img src="../Images/ea3c08541e0982f42e2c6909dd40ba1e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1304/0*0aqZT5E_ADsPG2x1.gif"/></div></figure><p id="c1a4" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated"><strong class="jd hu">故障排除提示#1 : </strong>您可以先安装<strong class="jd hu"> nvm </strong>即节点版本管理器，然后使用它来安装node，这样您就可以选择nodejs的版本号并使用多个nodejs发行版来安装&amp;。对于我的dapp，我使用了13.1.0。</p><blockquote class="mb mc md"><p id="5b86" class="jb jc jz jd b je jf jg jh ji jj jk jl me jn jo jp mf jr js jt mg jv jw jx jy hm dt translated">$ nvm安装13.1.0</p></blockquote><h1 id="1153" class="kb kc ht bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky dt translated"><strong class="ak">块菌框架</strong></h1><p id="d754" class="pw-post-body-paragraph jb jc ht jd b je kz jg jh ji la jk jl jm lb jo jp jq lc js jt ju ld jw jx jy hm dt translated">下一个依赖项是<a class="ae ka" href="http://truffleframework.com/" rel="noopener ugc nofollow" target="_blank">松露框架</a>，它允许我们在以太坊区块链上构建去中心化的应用程序。它提供了一套工具，允许我们用Solidity编程语言编写智能合同。它还使我们能够测试我们的智能合同，并将其部署到区块链。它还为我们提供了一个开发客户端应用程序的地方。</p><p id="655d" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">您可以在命令行中安装带有NPM的松露，如下所示:</p><blockquote class="mb mc md"><p id="f7b4" class="jb jc jz jd b je jf jg jh ji jj jk jl me jn jo jp mf jr js jt mg jv jw jx jy hm dt translated">$ npm install -g truffle@5.1.18</p></blockquote><figure class="lt lu lv lw fq iu fe ff paragraph-image"><div class="fe ff mr"><img src="../Images/96941363f7cda69244be80233beaa69c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1392/format:webp/1*0OfPTVpGtQ9LB5Y7IVvrqw.png"/></div></figure><p id="6a69" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated"><strong class="jd hu">故障排除提示#2: </strong>默认情况下，与truffle一起安装的solo版本将与我们在其中编写合同的版本不同，为了解决这个问题，我们需要在<strong class="jd hu"> <em class="jz"> truffle.js </em> </strong>文件中添加额外的一行来指定<strong class="jd hu"> <em class="jz">编译器版本</em> </strong>，因此当我们编译truffle时，它将自动下载我们需要的版本并使用相同的版本。遵循下面的步骤，当您准备好truffle.js文件时，再回到这里。</p><h1 id="1e9d" class="kb kc ht bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky dt translated">加纳切</h1><p id="43e6" class="pw-post-body-paragraph jb jc ht jd b je kz jg jh ji la jk jl jm lb jo jp jq lc js jt ju ld jw jx jy hm dt translated">下一个依赖项是<a class="ae ka" href="http://truffleframework.com/ganache" rel="noopener ugc nofollow" target="_blank"> Ganache </a>，一个本地内存区块链。它会给我们10个外部帐户的地址在我们当地的以太坊区块链。每个账户都预装了100个假乙醚。在我们的例子中，由于我们使用AWS，我们将安装ganache-cli。使用以下命令也可以做到这一点:</p><blockquote class="mb mc md"><p id="71e2" class="jb jc jz jd b je jf jg jh ji jj jk jl me jn jo jp mf jr js jt mg jv jw jx jy hm dt translated">$ npm install -g ganache-cli</p></blockquote><h1 id="15aa" class="kb kc ht bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky dt translated">元掩码</h1><p id="ade4" class="pw-post-body-paragraph jb jc ht jd b je kz jg jh ji la jk jl jm lb jo jp jq lc js jt ju ld jw jx jy hm dt translated">下一个依赖项是Google Chrome 的<a class="ae ka" href="https://chrome.google.com/webstore/detail/metamask/nkbihfbeogaeaoehlefnkodbefgpgknn?hl=en" rel="noopener ugc nofollow" target="_blank">元掩码扩展。为了使用区块链，我们必须连接到它(记住，我说过区块链是一个网络)。为了使用以太坊区块链，我们必须安装一个特殊的浏览器扩展。这就是metamask的用武之地。我们将能够使用我们的个人账户连接到我们当地的以太坊区块链，并与我们的智能合约进行交互。</a></p></div><div class="ab cl mh mi hb mj" role="separator"><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm"/></div><div class="hm hn ho hp hq"><p id="1b8d" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">现在我们已经安装了依赖项，让我们开始构建dApp吧！</p><p id="4e74" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">我们将从使用以下命令在后台运行ganache-cli开始:</p><blockquote class="mb mc md"><p id="5625" class="jb jc jz jd b je jf jg jh ji jj jk jl me jn jo jp mf jr js jt mg jv jw jx jy hm dt translated">$ ganache-cli &amp;</p></blockquote><p id="f5b2" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">接下来，我们将为我们的dapp制作一个目录，接下来，我们需要一个<a class="ae ka" href="http://truffleframework.com/boxes/" rel="noopener ugc nofollow" target="_blank">松露盒</a>。在本教程中，我们将使用<a class="ae ka" href="http://truffleframework.com/boxes/pet-shop" rel="noopener ugc nofollow" target="_blank">宠物店盒子</a>。在我们的项目目录中，我们将从命令行安装宠物店盒子</p><blockquote class="mb mc md"><p id="82f0" class="jb jc jz jd b je jf jg jh ji jj jk jl me jn jo jp mf jr js jt mg jv jw jx jy hm dt translated">$ mkdir选举</p><p id="acea" class="jb jc jz jd b je jf jg jh ji jj jk jl me jn jo jp mf jr js jt mg jv jw jx jy hm dt translated">$ cd选举</p><p id="b757" class="jb jc jz jd b je jf jg jh ji jj jk jl me jn jo jp mf jr js jt mg jv jw jx jy hm dt translated">松露拆箱宠物店</p></blockquote><p id="65a0" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">成功拆箱后，我们将得到如下所示的目录结构:</p><figure class="lt lu lv lw fq iu fe ff paragraph-image"><div class="fe ff ms"><img src="../Images/7c1dbc1cd55d3e3097348c6e6daadb25.png" data-original-src="https://miro.medium.com/v2/resize:fit:1016/format:webp/1*_n75LFeZ1NM5k8ZMt8OvMg.png"/></div></figure><ul class=""><li id="96ed" class="le lf ht jd b je jf ji jj jm lg jq lh ju li jy mp lk ll lm dt translated"><strong class="jd hu"> <em class="jz">合同目录:</em> </strong>这是所有智能联系人居住的地方。我们已经有了一份移民合同，处理我们到区块链的移民事宜。</li><li id="8566" class="le lf ht jd b je ln ji lo jm lp jq lq ju lr jy mp lk ll lm dt translated"><strong class="jd hu"> <em class="jz">迁移目录:</em> </strong>这是所有迁移文件所在的位置。这些迁移类似于其他需要迁移来改变数据库状态的web开发框架。每当我们在区块链部署智能合约时，我们都在更新区块链的状态，因此需要迁移。</li><li id="ba91" class="le lf ht jd b je ln ji lo jm lp jq lq ju lr jy mp lk ll lm dt translated"><strong class="jd hu"> <em class="jz"> node_modules目录:</em> </strong>这是我们所有节点依赖项的主目录。</li><li id="12f8" class="le lf ht jd b je ln ji lo jm lp jq lq ju lr jy mp lk ll lm dt translated"><strong class="jd hu"> <em class="jz"> src目录:</em> </strong>这是我们开发客户端应用程序的地方。</li><li id="57c8" class="le lf ht jd b je ln ji lo jm lp jq lq ju lr jy mp lk ll lm dt translated">测试目录: 这是我们为智能合约编写测试的地方。</li><li id="72e4" class="le lf ht jd b je ln ji lo jm lp jq lq ju lr jy mp lk ll lm dt translated"><strong class="jd hu"> <em class="jz"> truffle.js文件:</em> </strong>这是我们的truffle项目的主配置文件</li></ul><p id="c30a" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated"><em class="jz">现在您可以回到故障排除提示#2，通过在</em><strong class="jd hu"><em class="jz">truffle . js</em></strong><em class="jz">文件中添加编译器版本来解决solc版本错误。</em></p><h1 id="c9c4" class="kb kc ht bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky dt translated">设置投票合同</h1><p id="ce68" class="pw-post-body-paragraph jb jc ht jd b je kz jg jh ji la jk jl jm lb jo jp jq lc js jt ju ld jw jx jy hm dt translated">我们将使用solidity编程语言来编写我们的合同。</p><figure class="lt lu lv lw fq iu"><div class="bz el l di"><div class="mt mu l"/></div></figure><p id="f39d" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">将上述代码复制到contracts目录中名为Voting.sol的文件中。现在让我们编译代码，并将其部署到加纳切区块链。</p><h1 id="1d36" class="kb kc ht bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky dt translated"><strong class="ak">编译</strong></h1><p id="9c6a" class="pw-post-body-paragraph jb jc ht jd b je kz jg jh ji la jk jl jm lb jo jp jq lc js jt ju ld jw jx jy hm dt translated">要使用truffle进行编译，请输入以下命令:</p><blockquote class="mb mc md"><p id="e26c" class="jb jc jz jd b je jf jg jh ji jj jk jl me jn jo jp mf jr js jt mg jv jw jx jy hm dt translated">$ truffle编译</p></blockquote><h1 id="5522" class="kb kc ht bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky dt translated"><strong class="ak">迁移</strong></h1><p id="a126" class="pw-post-body-paragraph jb jc ht jd b je kz jg jh ji la jk jl jm lb jo jp jq lc js jt ju ld jw jx jy hm dt translated">接下来，用以下内容替换迁移目录中2_deploy_contracts.js的内容:</p><figure class="lt lu lv lw fq iu"><div class="bz el l di"><div class="mt mu l"/></div></figure><p id="0633" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">首先，我们需要我们已经创建的契约，并将其分配给一个名为“Election”的变量。接下来，我们将它添加到已部署契约的清单中，以确保它在我们运行迁移时得到部署。现在，让我们像这样从命令行运行我们的迁移:</p><blockquote class="mb mc md"><p id="948f" class="jb jc jz jd b je jf jg jh ji jj jk jl me jn jo jp mf jr js jt mg jv jw jx jy hm dt translated">块菌迁移</p></blockquote><h1 id="467c" class="kb kc ht bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky dt translated">试验</h1><p id="460b" class="pw-post-body-paragraph jb jc ht jd b je kz jg jh ji la jk jl jm lb jo jp jq lc js jt ju ld jw jx jy hm dt translated">现在让我们写一些测试。确保首先运行Ganache。然后，在命令行中从项目的根目录创建一个新的测试文件，如下所示:</p><blockquote class="mb mc md"><p id="e110" class="jb jc jz jd b je jf jg jh ji jj jk jl me jn jo jp mf jr js jt mg jv jw jx jy hm dt translated">$ touch test/election.js</p></blockquote><p id="a471" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">我们将在这个文件中用Javascript编写所有的测试，用<a class="ae ka" href="https://mochajs.org/" rel="noopener ugc nofollow" target="_blank">Mocha测试框架</a>和<a class="ae ka" href="http://www.chaijs.com/" rel="noopener ugc nofollow" target="_blank">Chai断言库</a>。这些都与Truffle框架捆绑在一起。我们将使用Javascript编写所有这些测试来模拟客户端与智能合约的交互，就像我们在控制台中所做的一样。以下是测试的所有代码:</p><figure class="lt lu lv lw fq iu"><div class="bz el l di"><div class="mt mu l"/></div></figure><p id="a0e6" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">首先，我们需要契约并将其赋给一个变量，就像我们在迁移文件中所做的那样。接下来，我们调用“契约”函数，并在回调函数中编写所有测试。这个回调函数提供了一个“accounts”变量，代表我们的区块链上的所有帐户，由Ganache提供。</p><p id="805b" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">第一个测试通过检查候选人计数是否等于2来检查合同是否用正确的候选人数量进行了初始化。</p><p id="5ae8" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">下一个测试检查选举中每个候选人的值，确保每个候选人都有正确的id、姓名和票数。</p><p id="fdd0" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">现在让我们从命令行运行测试，如下所示:</p><blockquote class="mb mc md"><p id="c0ee" class="jb jc jz jd b je jf jg jh ji jj jk jl me jn jo jp mf jr js jt mg jv jw jx jy hm dt translated">块菌测试</p></blockquote><p id="fbbb" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">您的输出应该类似于:</p><figure class="lt lu lv lw fq iu fe ff paragraph-image"><div role="button" tabindex="0" class="iv iw di ix bf iy"><div class="fe ff mv"><img src="../Images/580278d565bc411f9124f160fc3c2023.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*okUHMnH_m6XOpezxRvwyug.png"/></div></div></figure><h1 id="5c46" class="kb kc ht bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky dt translated">前端应用程序</h1><p id="3110" class="pw-post-body-paragraph jb jc ht jd b je kz jg jh ji la jk jl jm lb jo jp jq lc js jt ju ld jw jx jy hm dt translated">现在，让我们开始构建将与我们的智能合约对话的客户端应用程序。我们将通过修改上一节中安装的Truffle Pet Shop box附带的HTML和Javascript文件来实现这一点。我们将使用现有的代码开始。让我们也注意一下松露宠物店盒子附带的一些其他东西，比如<a class="ae ka" href="https://getbootstrap.com/" rel="noopener ugc nofollow" target="_blank">引导框架</a>，这将使我们在本教程中不必编写任何CSS。我们还得到了<a class="ae ka" href="https://www.npmjs.com/package/light-server" rel="noopener ugc nofollow" target="_blank"> lite-server </a>，它将为我们的资产提供开发服务。</p><p id="6566" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">继续用以下代码替换“index.html”文件的所有内容:</p><figure class="lt lu lv lw fq iu"><div class="bz el l di"><div class="mt mu l"/></div></figure><p id="4a0a" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">接下来，用以下代码替换“app.js”文件的所有内容:</p><figure class="lt lu lv lw fq iu"><div class="bz el l di"><div class="mt mu l"/></div></figure><p id="8b8f" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">让我们注意一下这段代码做的一些事情:</p><ol class=""><li id="1ba9" class="le lf ht jd b je jf ji jj jm lg jq lh ju li jy lj lk ll lm dt translated">设置web3: <a class="ae ka" href="https://web3js.readthedocs.io/en/1.0/" rel="noopener ugc nofollow" target="_blank"> web3.js </a>是一个javascript库，它允许我们的客户端应用程序与区块链对话。我们在“initWeb3”函数中配置web3。</li><li id="4244" class="le lf ht jd b je ln ji lo jm lp jq lq ju lr jy lj lk ll lm dt translated">初始化契约:我们在这个函数中获取智能契约的已部署实例，并分配一些允许我们与之交互的值。</li><li id="bc46" class="le lf ht jd b je ln ji lo jm lp jq lq ju lr jy lj lk ll lm dt translated">Render函数:render函数使用智能合约中的数据来布局页面上的所有内容。现在，我们列出我们在智能合同中创建的候选人。我们通过遍历映射中的每个候选项，并将其呈现到表中来实现这一点。我们还在这个函数中获取连接到区块链的当前帐户，并将其显示在页面上。</li></ol><p id="dee4" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">现在让我们在浏览器中查看客户端应用程序。首先，确保您已经像这样迁移了合同:</p><blockquote class="mb mc md"><p id="4f2d" class="jb jc jz jd b je jf jg jh ji jj jk jl me jn jo jp mf jr js jt mg jv jw jx jy hm dt translated">块菌迁移</p></blockquote><p id="c21c" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">注意—这样做时，请确保ganache正在后台运行。</p><h1 id="0320" class="kb kc ht bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky dt translated">部署</h1><p id="d3ce" class="pw-post-body-paragraph jb jc ht jd b je kz jg jh ji la jk jl jm lb jo jp jq lc js jt ju ld jw jx jy hm dt translated">接下来，从命令行启动开发服务器，如下所示:</p><blockquote class="mb mc md"><p id="b456" class="jb jc jz jd b je jf jg jh ji jj jk jl me jn jo jp mf jr js jt mg jv jw jx jy hm dt translated">$ npm运行开发</p></blockquote><p id="6af7" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">这应该会自动打开一个包含您的客户端应用程序的新浏览器窗口。如果你使用的是VM，那么它应该会在本地主机上的浏览器中自动打开，但是如果你使用的是AWS EC2，你必须手动打开，使用你机器的外部IP，后跟应用程序运行的端口号。</p><figure class="lt lu lv lw fq iu fe ff paragraph-image"><div role="button" tabindex="0" class="iv iw di ix bf iy"><div class="fe ff mw"><img src="../Images/de31a1e6a938fb3bcc1792839d28bae3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*B2mBRBCtf9JMSGm8_VdpEQ.png"/></div></div><figcaption class="lx ly fg fe ff lz ma bd b be z ek">Loading Frontend</figcaption></figure><p id="41f9" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">它的<strong class="jd hu">仍然在加载</strong>，因为它没有连接到本地的区块链，这里出现了<strong class="jd hu">元掩码</strong>。为了连接到区块链，我们需要将其中一个帐户从Ganache导入Metamask。只需从ganache复制任意一个私钥，然后在metamask扩展窗口中，选择import account - &gt;在此粘贴私钥，您就成功了！</p><p id="3175" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">现在只需重新加载，一旦你与元掩码连接，你应该看到所有的合同和帐户数据加载。</p><figure class="lt lu lv lw fq iu fe ff paragraph-image"><div role="button" tabindex="0" class="iv iw di ix bf iy"><div class="fe ff mx"><img src="../Images/6dc193619d4316998062782da50b6d10.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ih3ESYfbdZ3co-TJSKiqIA.png"/></div></div></figure><p id="dd84" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">以下是最终概念验证的GIF形式的演示:</p><figure class="lt lu lv lw fq iu fe ff paragraph-image"><div role="button" tabindex="0" class="iv iw di ix bf iy"><div class="fe ff my"><img src="../Images/9e205e73968aa521a033a59a94eb9e8c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*QnMBTP53p9Xbm2j614k65w.gif"/></div></div><figcaption class="lx ly fg fe ff lz ma bd b be z ek">GIF : App Demo</figcaption></figure><p id="cfd3" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">因此我们的教程到此结束。</p><figure class="lt lu lv lw fq iu fe ff paragraph-image"><div class="fe ff mz"><img src="../Images/32db04c5f8bfa84138445f2dba7b75f0.png" data-original-src="https://miro.medium.com/v2/resize:fit:960/1*JaHDKdRWQZazHt_M-yxPAg.gif"/></div></figure><p id="d809" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">以下是该项目的github资源库:</p><div class="na nb fm fo nc nd"><a href="https://github.com/sakshm-aurora/USA-Election-Dapp-POC" rel="noopener  ugc nofollow" target="_blank"><div class="ne ab ej"><div class="nf ab ng cl cj nh"><h2 class="bd hu fv z el ni eo ep nj er et hs dt translated">萨克什姆-奥罗拉/美国-选举-Dapp-POC</h2><div class="nk l"><h3 class="bd b fv z el ni eo ep nj er et ek translated">在GitHub上创建一个帐户，为sakshm-aurora/USA-Election-Dapp-POC的发展做出贡献。</h3></div><div class="nl l"><p class="bd b gc z el ni eo ep nj er et ek translated">github.com</p></div></div><div class="nm l"><div class="nn l no np nq nm nr iz nd"/></div></div></a></div><p id="1c02" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated"><strong class="jd hu">参考文献:</strong></p><p id="7c6e" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">许多插图和内容取自以下博客，所有的荣誉都属于它们:</p><div class="na nb fm fo nc nd"><a href="https://www.dappuniversity.com/articles/the-ultimate-ethereum-dapp-tutorial" rel="noopener  ugc nofollow" target="_blank"><div class="ne ab ej"><div class="nf ab ng cl cj nh"><h2 class="bd hu fv z el ni eo ep nj er et hs dt translated">以太坊Dapp终极教程(如何构建全栈去中心化应用…</h2><div class="nk l"><h3 class="bd b fv z el ni eo ep nj er et ek translated">今天我将向您展示如何在以太坊区块链上构建您的第一个去中心化应用程序，或dApp</h3></div><div class="nl l"><p class="bd b gc z el ni eo ep nj er et ek translated">www.dappuniversity.com</p></div></div><div class="nm l"><div class="ns l no np nq nm nr iz nd"/></div></div></a></div><div class="na nb fm fo nc nd"><a rel="noopener follow" target="_blank" href="/@mvmurthy/full-stack-hello-world-voting-ethereum-dapp-tutorial-part-2-30b3d335aa1f"><div class="ne ab ej"><div class="nf ab ng cl cj nh"><h2 class="bd hu fv z el ni eo ep nj er et hs dt translated">全栈Hello World投票以太坊Dapp教程—第2部分</h2><div class="nk l"><h3 class="bd b fv z el ni eo ep nj er et ek translated">【教程最后更新于2020年3月】</h3></div><div class="nl l"><p class="bd b gc z el ni eo ep nj er et ek translated">medium.com</p></div></div><div class="nm l"><div class="nt l no np nq nm nr iz nd"/></div></div></a></div><div class="na nb fm fo nc nd"><a rel="noopener follow" target="_blank" href="/heptagon/step-by-step-guide-to-build-a-dapp-a-homo-sapiens-2-day-love-affair-with-ethereum-dapp-de2b0dea12f1"><div class="ne ab ej"><div class="nf ab ng cl cj nh"><h2 class="bd hu fv z el ni eo ep nj er et hs dt translated">构建Dapp的逐步指南</h2><div class="nk l"><h3 class="bd b fv z el ni eo ep nj er et ek translated">dapp——分散应用。这篇文章将帮助你从头开始建造一个以太坊Dapp！</h3></div><div class="nl l"><p class="bd b gc z el ni eo ep nj er et ek translated">medium.com</p></div></div><div class="nm l"><div class="nu l no np nq nm nr iz nd"/></div></div></a></div><blockquote class="nv"><p id="5f23" class="nw nx ht bd ny nz oa ob oc od oe jy ek translated"><a class="ae ka" href="https://coincodecap.com/?utm_source=coinmonks" rel="noopener ugc nofollow" target="_blank">在您的收件箱中直接获得最佳软件交易</a></p></blockquote><figure class="og oh oi oj ok iu fe ff paragraph-image"><a href="https://coincodecap.com/?utm_source=coinmonks"><div class="fe ff of"><img src="../Images/7c0b3dfdcbfea594cc0ae7d4f9bf6fcb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1168/format:webp/0*OJ-qb5G6i863msBB.png"/></div></a></figure></div></div>    
</body>
</html>