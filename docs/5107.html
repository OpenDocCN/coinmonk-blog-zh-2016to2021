<html>
<head>
<title>Code and Deploy your First Ethereum Smart contract using Solidity, Truffle and Ganache</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Solidity、Truffle和Ganache编写和部署您的第一个以太坊智能合约</h1>
<blockquote>原文：<a href="https://medium.com/coinmonks/code-and-deploy-your-first-ethereum-smart-contract-b0fe6453daab?source=collection_archive---------6-----------------------#2021-08-04">https://medium.com/coinmonks/code-and-deploy-your-first-ethereum-smart-contract-b0fe6453daab?source=collection_archive---------6-----------------------#2021-08-04</a></blockquote><div><div class="ef hh hi hj hk hl"/><div class="hm hn ho hp hq"><figure class="hs ht fm fo hu hv fe ff paragraph-image"><div role="button" tabindex="0" class="hw hx di hy bf hz"><div class="fe ff hr"><img src="../Images/3fbd9c80c6fc59fde42e8a99f21e9e9c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qk8SOCnQSbiiY6q3FrB2Aw.png"/></div></div><figcaption class="ic id fg fe ff ie if bd b be z ek">source: ethereum.org</figcaption></figure><div class=""/><p id="f270" class="pw-post-body-paragraph jf jg ii jh b ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc hm dt translated">随着2009年比特币的出现，世界见证了一场前所未有的变革。第一种真正去中心化的数字货币诞生了，并将开始一场针对我们所知的金融体系的革命。但最重要的是，比特币背后的技术，称为区块链，吸引了极大的关注。2013年，Vitalik Buterin发布了以太坊白皮书，该项目于2015年启动。这是一个社区驱动的开源项目，是释放区块链技术潜力的一个重大飞跃。以太坊是一个区块链，旨在支持分散式应用和智能合约，本质上是一组由区块链实施的协议。</p><p id="2c40" class="pw-post-body-paragraph jf jg ii jh b ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc hm dt translated">以太坊智能合约是用一种叫做Solidity的编程语言编写的。它是一种图灵完全静态类型语言，被编译成运行在以太坊虚拟机(EVM)上的字节码。在本教程中，我将向您介绍编码和部署一个简单的计数器以太坊智能契约的步骤。</p><h1 id="09cb" class="kd ke ii bd kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la dt translated"><strong class="ak">步骤1 -安装要求</strong></h1><p id="8997" class="pw-post-body-paragraph jf jg ii jh b ji lb jk jl jm lc jo jp jq ld js jt ju le jw jx jy lf ka kb kc hm dt translated">安装<a class="ae lg" href="https://nodejs.org/en/" rel="noopener ugc nofollow" target="_blank">节点JS </a>(使用LTS)。</p><p id="6af3" class="pw-post-body-paragraph jf jg ii jh b ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc hm dt translated"><em class="lh">注意:如果你使用的是Windows，确保Node和npm已经添加到PATH中。</em></p><p id="e88d" class="pw-post-body-paragraph jf jg ii jh b ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc hm dt translated">我们需要使用npm安装Truffle和Ganache CLI。打开一个新的终端窗口并运行以下命令-</p><pre class="li lj lk ll fq lm ln lo lp aw lq dt"><span id="20a5" class="lr ke ii ln b fv ls lt l lu lv">$ npm install -g truffle</span><span id="e919" class="lr ke ii ln b fv lw lt l lu lv">$ npm install -g ganache-cli</span></pre><p id="998f" class="pw-post-body-paragraph jf jg ii jh b ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc hm dt translated">就是这样！现在我们可以开始编写我们的智能契约了。</p><h1 id="d5c5" class="kd ke ii bd kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la dt translated"><strong class="ak">第2步-撰写智能合同</strong></h1><p id="b488" class="pw-post-body-paragraph jf jg ii jh b ji lb jk jl jm lc jo jp jq ld js jt ju le jw jx jy lf ka kb kc hm dt translated">首先让我们创建一个名为“counter”的新truffle项目。</p><pre class="li lj lk ll fq lm ln lo lp aw lq dt"><span id="f0ff" class="lr ke ii ln b fv ls lt l lu lv">$ truffle init counter<br/>$ cd counter</span></pre><p id="f8a5" class="pw-post-body-paragraph jf jg ii jh b ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc hm dt translated">通过名称<em class="lh">计数器</em>创建一个新合同</p><pre class="li lj lk ll fq lm ln lo lp aw lq dt"><span id="1b3d" class="lr ke ii ln b fv ls lt l lu lv">$ truffle create contract Counter</span></pre><p id="bdd5" class="pw-post-body-paragraph jf jg ii jh b ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc hm dt translated">并在您选择的代码编辑器中打开它。</p><p id="fc77" class="pw-post-body-paragraph jf jg ii jh b ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc hm dt translated">在<em class="lh"> Counter.sol </em>契约中，第一行指定了Solidity编译器的支持版本。</p><p id="2bb9" class="pw-post-body-paragraph jf jg ii jh b ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc hm dt translated">让我们在契约中创建一个状态变量“count ”,它将包含当前计数，</p><pre class="li lj lk ll fq lm ln lo lp aw lq dt"><span id="7da3" class="lr ke ii ln b fv ls lt l lu lv">uint count;</span></pre><p id="53d1" class="pw-post-body-paragraph jf jg ii jh b ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc hm dt translated">它定义了一个新的无符号整数类型的变量，因为我们还没有初始化count，所以默认情况下它的值为0。</p><p id="a2a1" class="pw-post-body-paragraph jf jg ii jh b ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc hm dt translated">让我们创建一个函数来增加计数。</p><pre class="li lj lk ll fq lm ln lo lp aw lq dt"><span id="0d5a" class="lr ke ii ln b fv ls lt l lu lv">function increment() public {<br/>   count++;<br/>}</span></pre><p id="e274" class="pw-post-body-paragraph jf jg ii jh b ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc hm dt translated">和一个返回当前count值的函数，我们可以将其指定为一个view函数，这意味着该函数只执行一个read操作，而不修改状态。</p><pre class="li lj lk ll fq lm ln lo lp aw lq dt"><span id="4d77" class="lr ke ii ln b fv ls lt l lu lv">function showCount() public view returns(uint) {<br/>   return count;<br/>}</span></pre><p id="0e7e" class="pw-post-body-paragraph jf jg ii jh b ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc hm dt translated">就是这样！最终的合同会是这样的-</p><pre class="li lj lk ll fq lm ln lo lp aw lq dt"><span id="321c" class="lr ke ii ln b fv ls lt l lu lv">pragma solidity &gt;=0.5.0;</span><span id="1e37" class="lr ke ii ln b fv lw lt l lu lv">contract Counter {<br/>   uint count;</span><span id="2018" class="lr ke ii ln b fv lw lt l lu lv">   function increment() public {<br/>     count++;<br/>   }<br/>   <br/>   function showCount() public view returns(uint) {<br/>     return count;<br/>   }<br/>}</span></pre><p id="7aeb" class="pw-post-body-paragraph jf jg ii jh b ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc hm dt translated">现在，让我们编译智能合约，打开终端并运行命令-</p><pre class="li lj lk ll fq lm ln lo lp aw lq dt"><span id="ca2c" class="lr ke ii ln b fv ls lt l lu lv">$ truffle compile</span></pre><p id="210d" class="pw-post-body-paragraph jf jg ii jh b ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc hm dt translated">希望智能合约已经编译成功，没有任何错误。您可能已经注意到，在您的repo中已经创建了一个新的目录<em class="lh"> build/ </em>。它包含智能合约的应用程序二进制接口或ABI。</p><h1 id="2fca" class="kd ke ii bd kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la dt translated"><strong class="ak">步骤3 -部署智能合同</strong></h1><p id="612d" class="pw-post-body-paragraph jf jg ii jh b ji lb jk jl jm lc jo jp jq ld js jt ju le jw jx jy lf ka kb kc hm dt translated">注意:有一些公共测试网络可以用来部署合同，但是在本教程中，为了简单起见，我们将使用一个个人区块链。</p><p id="0ab2" class="pw-post-body-paragraph jf jg ii jh b ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc hm dt translated">在部署之前，首先我们需要修改Truffle配置。打开回购的<em class="lh"> truffle-config.js </em>文件，替换如下-</p><pre class="li lj lk ll fq lm ln lo lp aw lq dt"><span id="4dfd" class="lr ke ii ln b fv ls lt l lu lv">module.exports = {<br/>networks: {<br/> development: {<br/>   host: "127.0.0.1",<br/>   port: 8545,<br/>   network_id: "*"<br/> },<br/>},</span><span id="b00d" class="lr ke ii ln b fv lw lt l lu lv">compilers: {<br/>  solc: {<br/>    optimizer: {<br/>      enabled: true,<br/>      runs: 200<br/>    }<br/>  }<br/>}<br/>}</span></pre><p id="f3c5" class="pw-post-body-paragraph jf jg ii jh b ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc hm dt translated">接下来，在<em class="lh">迁移/ </em>目录中，用下面的代码创建一个名为<em class="lh"> 2_deploy_contracts.js </em>的新文件。</p><pre class="li lj lk ll fq lm ln lo lp aw lq dt"><span id="084b" class="lr ke ii ln b fv ls lt l lu lv">const Counter = artifacts.require("Counter");</span><span id="0b26" class="lr ke ii ln b fv lw lt l lu lv">module.exports = function(deployer) {<br/>  deployer.deploy(Counter);<br/>};</span></pre><p id="82a7" class="pw-post-body-paragraph jf jg ii jh b ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc hm dt translated">为了在你的计算机上旋转出一个个人的区块链，我们将使用Ganache。我们可以用它来部署和测试我们的智能合约。打开一个单独的终端并运行-</p><pre class="li lj lk ll fq lm ln lo lp aw lq dt"><span id="7c9f" class="lr ke ii ln b fv ls lt l lu lv">$ ganache-cli</span></pre><figure class="li lj lk ll fq hv fe ff paragraph-image"><div class="fe ff lx"><img src="../Images/13dcd54fb3530f83f397e993f77d57f1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1174/format:webp/1*mEvKhzzWJmbF6_Ej85n__w.png"/></div></figure><p id="e236" class="pw-post-body-paragraph jf jg ii jh b ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc hm dt translated">您可以看到，它运行了一个本地区块链，有10个帐户，每个帐户有100个(测试)以太网。</p><p id="f5b9" class="pw-post-body-paragraph jf jg ii jh b ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc hm dt translated">好吧！现在终于到了部署合同的时候了。回到另一个终端运行-</p><pre class="li lj lk ll fq lm ln lo lp aw lq dt"><span id="a5d1" class="lr ke ii ln b fv ls lt l lu lv">$ truffle migrate</span></pre><p id="add6" class="pw-post-body-paragraph jf jg ii jh b ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc hm dt translated">如果合同部署成功，您将获得此信息。</p><figure class="li lj lk ll fq hv fe ff paragraph-image"><div role="button" tabindex="0" class="hw hx di hy bf hz"><div class="fe ff ly"><img src="../Images/c90133c553bf928455b64f26b3038086.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*K6mFkVZiWfne20GHOMpDNA.png"/></div></div></figure><p id="494d" class="pw-post-body-paragraph jf jg ii jh b ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc hm dt translated">为了与部署的契约进行交互，让我们打开Truffle控制台并创建一个实例。</p><pre class="li lj lk ll fq lm ln lo lp aw lq dt"><span id="c95c" class="lr ke ii ln b fv ls lt l lu lv">$ truffle console<br/>&gt; counter = await Counter.deployed()</span></pre><p id="f4b9" class="pw-post-body-paragraph jf jg ii jh b ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc hm dt translated">检查<em class="lh">计数</em>变量的当前值，</p><pre class="li lj lk ll fq lm ln lo lp aw lq dt"><span id="475f" class="lr ke ii ln b fv ls lt l lu lv">&gt; count = await counter.showCount()<br/>&gt; count.toString()</span></pre><p id="4ca5" class="pw-post-body-paragraph jf jg ii jh b ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc hm dt translated">这将产生输出‘0’。现在让我们调用<em class="lh"> increment() </em>函数并检查<em class="lh"> count </em>的新值。</p><pre class="li lj lk ll fq lm ln lo lp aw lq dt"><span id="1aa5" class="lr ke ii ln b fv ls lt l lu lv">&gt; counter.increment()<br/>&gt; count = await counter.showCount()<br/>&gt; count.toString()</span></pre><p id="07d1" class="pw-post-body-paragraph jf jg ii jh b ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc hm dt translated">瞧啊。<em class="lh">计数</em>已成功增加。您可以尝试多次调用<em class="lh"> increment() </em>函数，然后检查<em class="lh"> count </em>的值。</p><p id="7c24" class="pw-post-body-paragraph jf jg ii jh b ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc hm dt translated">这就到了本教程的结尾，在本教程中，您已经学习了编码、部署和与一个简单的柜台以太坊智能合约进行交互。</p><p id="0f53" class="pw-post-body-paragraph jf jg ii jh b ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc hm dt translated">希望这对你有所帮助！请在评论中告诉我你的疑惑和反馈。</p><h2 id="2802" class="lr ke ii bd kf lz ma mb kj mc md me kn jq mf mg kr ju mh mi kv jy mj mk kz ml dt translated">另外，阅读</h2><div class="hs ht fm fo hu mm"><a href="https://blog.coincodecap.com/smart-contract-smartpy" rel="noopener  ugc nofollow" target="_blank"><div class="mn ab ej"><div class="mo ab mp cl cj mq"><h2 class="bd ij fv z el mr eo ep ms er et ih dt translated">如何使用SmartPy编写智能合同？</h2><div class="mt l"><h3 class="bd b fv z el mr eo ep ms er et ek translated">在本文中，您将学习使用SmartPy编写智能合同。智能合同是存储在…</h3></div><div class="mu l"><p class="bd b gc z el mr eo ep ms er et ek translated">blog.coincodecap.com</p></div></div><div class="mv l"><div class="mw l mx my mz mv na ia mm"/></div></div></a></div></div></div>    
</body>
</html>