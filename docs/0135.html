<html>
<head>
<title>NEO Smart Contracts: Invocation Triggers</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">NEO智能合约:调用触发器</h1>
<blockquote>原文：<a href="https://medium.com/coinmonks/neo-smart-contracts-invocation-triggers-490f945902e1?source=collection_archive---------1-----------------------#2018-03-04">https://medium.com/coinmonks/neo-smart-contracts-invocation-triggers-490f945902e1?source=collection_archive---------1-----------------------#2018-03-04</a></blockquote><div><div class="ef hh hi hj hk hl"/><div class="hm hn ho hp hq"><div class=""/><p id="d5c2" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">您知道直接调用事务并不是运行契约代码的唯一场景吗？</p><figure class="jo jp jq jr fq js"><div class="bz el l di"><div class="jt ju l"/></div></figure><p id="19a0" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">在它的一般用法中，可以直接调用您的智能合约代码，传递您在初始导入时指定的类型的输入参数。这构成了与持有NEP5令牌或合约存储中的托管资产数据的合约往来的大部分呼叫。但是，当创建交易以将NEO或GAS等资产转移到合同地址或从合同地址转移出时，您的合同代码也会被调用。</p><p id="d15c" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">在发送或接收合同地址的资产时调用合同代码，可让您的合同能够自行管理其NEO和GAS资产。例如，如果您的合同允许用户用NEO交换您的NEP5令牌，则NEO会存入合同地址。这可以通过直接调用具有适当参数的合同并将NEO附加到交易来完成；或者通过执行NEO到合同地址的资产转移。在后一种情况下，您将希望契约代码能够处理NEO的用户存款，并以与直接契约调用类似的流程对其进行处理。</p><blockquote class="jv"><p id="91be" class="jw jx ht bd jy jz ka kb kc kd ke jn ek translated"><a class="ae kf" href="https://coincodecap.com/?utm_source=coinmonks" rel="noopener ugc nofollow" target="_blank">在您的收件箱中直接获得最佳软件交易</a></p></blockquote><figure class="kh ki kj kk kl js fe ff paragraph-image"><a href="https://coincodecap.com/?utm_source=coinmonks"><div class="fe ff kg"><img src="../Images/7c0b3dfdcbfea594cc0ae7d4f9bf6fcb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1168/format:webp/0*OJ-qb5G6i863msBB.png"/></div></a></figure><p id="87fb" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">此外，一旦资产开始在合同地址中积累，您将需要一种方法来直接管理这些资金。因此，当代表合同地址执行发送事务时，我们希望能够根据具体情况批准或不批准这些撤销。</p><p id="5f1f" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">为了在您的契约代码中处理这一点，neo-python提供了方法:</p><pre class="jo jp jq jr fq ko kp kq kr aw ks dt"><span id="be28" class="kt ku ht kp b fv kv kw l kx ky">boa.blockchain.vm.Neo.Runtime.GetTrigger</span></pre><p id="2996" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated"><strong class="is hu"> <em class="kz"> GetTrigger </em> </strong>是一个函数，在执行时返回契约是作为<strong class="is hu"> <em class="kz">应用</em> </strong>还是用于<strong class="is hu"> <em class="kz">验证</em> </strong>被调用。我们还提供了以下常量来帮助我们进行验证:</p><pre class="jo jp jq jr fq ko kp kq kr aw ks dt"><span id="2aca" class="kt ku ht kp b fv kv kw l kx ky">boa.interop.Neo.TriggerType.Application<br/>boa.interop.Neo.TriggerType.Verification</span></pre><h2 id="f5f9" class="kt ku ht bd la lb lc ld le lf lg lh li jb lj lk ll jf lm ln lo jj lp lq lr ls dt translated">GetTrigger() ==应用程序</h2><p id="94b8" class="pw-post-body-paragraph iq ir ht is b it lt iv iw ix lu iz ja jb lv jd je jf lw jh ji jj lx jl jm jn hm dt translated">智能契约代码的执行是直接调用的，我们可以预期我们指定的类型的输入参数会出现。在这种情况下，我们应该期望利用这些输入值来确定契约的结果状态及其输出。</p><h2 id="1bdd" class="kt ku ht bd la lb lc ld le lf lg lh li jb lj lk ll jf lm ln lo jj lp lq lr ls dt translated">GetTrigger() ==验证</h2><p id="e8d1" class="pw-post-body-paragraph iq ir ht is b it lt iv iw ix lu iz ja jb lv jd je jf lw jh ji jj lx jl jm jn hm dt translated">正在执行合同代码以提供是否应该允许涉及合同地址所拥有的资产的交易成功的验证。在这种情况下，我们最终应该拥有返回True或False值的逻辑。返回<strong class="is hu"> <em class="kz">真</em> </strong>将验证事务将允许它成功执行。返回<strong class="is hu"> <em class="kz"> False </em> </strong>将拒绝交易，转账不会发生。</p><h1 id="4535" class="ly ku ht bd la lz ma mb le mc md me li mf mg mh ll mi mj mk lo ml mm mn lr mo dt translated">用法示例</h1><p id="c6ff" class="pw-post-body-paragraph iq ir ht is b it lt iv iw ix lu iz ja jb lv jd je jf lw jh ji jj lx jl jm jn hm dt translated">在下面的例子中，我们将模拟一个契约，其中我们有用于<strong class="is hu"> <em class="kz">应用</em> </strong>和<strong class="is hu"> <em class="kz">验证</em> </strong>触发器的处理程序。在验证触发器处理程序中，我们将只接受由合同所有者执行的交易，而在应用程序触发器中，如果提供了正确的输入密码，我们将返回一条特殊的秘密消息。</p><pre class="jo jp jq jr fq ko kp kq kr aw ks dt"><span id="8913" class="kt ku ht kp b fv kv kw l kx ky">from boa.interop.Neo.Runtime import GetTrigger, CheckWitness</span><span id="aacc" class="kt ku ht kp b fv mp kw l kx ky">from boa.interop.Neo.TriggerType import Application, Verification</span><span id="b69b" class="kt ku ht kp b fv mp kw l kx ky">def Main(password):</span><span id="05a3" class="kt ku ht kp b fv mp kw l kx ky">    trigger = GetTrigger()</span><span id="382c" class="kt ku ht kp b fv mp kw l kx ky">    if trigger == Verification:<br/>        return handleVerification()</span><span id="5e65" class="kt ku ht kp b fv mp kw l kx ky">    elif trigger == Application:<br/>        return handleApplication(password)</span><span id="ba79" class="kt ku ht kp b fv mp kw l kx ky">    return False</span><span id="80b7" class="kt ku ht kp b fv mp kw l kx ky">def handleVerification():</span><span id="9cab" class="kt ku ht kp b fv mp kw l kx ky">    owner = 'AK2nJJpJr6o664CWJKi1QRXjqeic2zRp8y'</span><span id="8e05" class="kt ku ht kp b fv mp kw l kx ky">    is_owner = CheckWitness(owner)</span><span id="78c9" class="kt ku ht kp b fv mp kw l kx ky">    if is_owner:<br/>        return True</span><span id="9268" class="kt ku ht kp b fv mp kw l kx ky">    return False</span><span id="8180" class="kt ku ht kp b fv mp kw l kx ky">def handleApplication(password):</span><span id="bb25" class="kt ku ht kp b fv mp kw l kx ky">    if password == 'elephant':<br/>        return 'banana'</span><span id="03f6" class="kt ku ht kp b fv mp kw l kx ky">    return False</span></pre><h2 id="f882" class="kt ku ht bd la lb lc ld le lf lg lh li jb lj lk ll jf lm ln lo jj lp lq lr ls dt translated">处理验证</h2><p id="8d15" class="pw-post-body-paragraph iq ir ht is b it lt iv iw ix lu iz ja jb lv jd je jf lw jh ji jj lx jl jm jn hm dt translated">在我们处理一个<strong class="is hu"> <em class="kz">验证</em> </strong>触发器的情况下，如果创建发送或接收事务的地址是我们硬编码到合同代码中的所有者，我们将只返回True。所有其他地址，试图发送或提取资产到或从这个帐户将有他们的交易被拒绝。</p><h2 id="85ea" class="kt ku ht bd la lb lc ld le lf lg lh li jb lj lk ll jf lm ln lo jj lp lq lr ls dt translated">handle应用程序</h2><p id="9200" class="pw-post-body-paragraph iq ir ht is b it lt iv iw ix lu iz ja jb lv jd je jf lw jh ji jj lx jl jm jn hm dt translated">在我们正在处理一个<strong class="is hu"> <em class="kz">应用</em> </strong>触发器的cast中，我们将期待一个密码作为输入。当且仅当提供的密码是<strong class="is hu"> <em class="kz">大象</em> </strong>时，会返回秘密消息<strong class="is hu"> <em class="kz">香蕉</em> </strong>。如果没有提供正确的密码，我们将简单地返回<strong class="is hu"> <em class="kz">假</em> </strong>。</p><p id="f3a6" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">有关更深入的示例，请参考<a class="ae kf" href="https://github.com/nickfujita/hasty-ogre-name-service/blob/master/smartContract/hons-ico.py" rel="noopener ugc nofollow" target="_blank"> Hasty Ogre名称服务合同代码</a>。</p><p id="f326" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">如果你觉得这个教程有帮助，请在:</p><pre class="jo jp jq jr fq ko kp kq kr aw ks dt"><span id="b697" class="kt ku ht kp b fv kv kw l kx ky">NEO/GAS/NEP5 tokens: AR8rRBxgWw5siKsp1dUmfTLy6QQTjcqoqB</span><span id="d665" class="kt ku ht kp b fv mp kw l kx ky">ETH/ERC20 tokens: 0x575970777095575fDd12d9cD3B105b41D8DD1344</span><span id="fe64" class="kt ku ht kp b fv mp kw l kx ky">NANO/XRB: xrb_3rpmim57tqbrb8hhjfzm1x5uk135yhmgqoj7j7wsufpo53e3ad5k93ggy1cd</span><span id="9901" class="kt ku ht kp b fv mp kw l kx ky">LTC: M8nZ7FwJXSMAkAfiGmTKjbB7MWpdwsp52d</span><span id="3585" class="kt ku ht kp b fv mp kw l kx ky">BTC: 3LcA1ztxFjghexRNWPyGXA59VFU3gF4PTz</span><span id="0f11" class="kt ku ht kp b fv mp kw l kx ky">BCH: 1LXLiF7SjWGday6gm61hzbYHKbSAMevwXo</span></pre><figure class="jo jp jq jr fq js fe ff paragraph-image"><div role="button" tabindex="0" class="mr ms di mt bf mu"><div class="fe ff mq"><img src="../Images/91f2e8a771fcb1f8158aa184c8f8e3c0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GqEk84mU3n0X8AKV1-0EbQ.png"/></div></div></figure></div></div>    
</body>
</html>