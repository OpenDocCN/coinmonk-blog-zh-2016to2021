<html>
<head>
<title>Simplified code of Bitcoin Lightning Network part3 — Spend HTLC Execution Revocable Delivery</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">比特币闪电网络简化代码第三部分——消费HTLC执行可撤销交付</h1>
<blockquote>原文：<a href="https://medium.com/coinmonks/simplified-code-of-bitcoin-lightning-network-part3-spend-htlc-execution-revocable-delivery-49991e3cfe34?source=collection_archive---------6-----------------------#2018-10-07">https://medium.com/coinmonks/simplified-code-of-bitcoin-lightning-network-part3-spend-htlc-execution-revocable-delivery-49991e3cfe34?source=collection_archive---------6-----------------------#2018-10-07</a></blockquote><div><div class="ef hh hi hj hk hl"/><div class="hm hn ho hp hq"><div class=""/><p id="d1f2" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">雷电网络的基本概念很简单。为了进一步理解，参考<a class="ae jo" href="https://lightning.network/lightning-network-paper.pdf" rel="noopener ugc nofollow" target="_blank">白皮书</a>，将lightning网络交易流程表示为javascript代码。</p><p id="8f6d" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">如果我在一篇博文中解释所有的交易流程，会很难读懂。所以我分成几篇博文。这篇博客文章的目标是花HTLC执行可撤销交付，这是相应的白皮书图12。</p><p id="f16b" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">Github上的代码:<a class="ae jo" href="https://github.com/tak1827/lightning-network-tx-flow/tree/spend-HERD" rel="noopener ugc nofollow" target="_blank">闪电网tx流</a></p><p id="aed7" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">前置:<a class="ae jo" rel="noopener" href="/@t.tak/simplified-code-of-bitcoin-lightning-network-part2-spend-breach-remedy-997de8a21f29">比特币闪电网络简化代码第二部分——消费违约补救</a></p><p id="d22f" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">下一篇:<a class="ae jo" rel="noopener" href="/@t.tak/simplified-code-of-bitcoin-lightning-network-part4-spend-htlc-breach-remedy-61ebc5587fc4">比特币闪电网络简化代码第四部分——花HTLC违约补救</a></p><figure class="jq jr js jt fq ju fe ff paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="fe ff jp"><img src="../Images/4b90b7783278eb25dc750ead7ed9af9f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kmYaEUHIjgQuRXfnDqU5iA.png"/></div></div></figure></div><div class="ab cl kb kc hb kd" role="separator"><span class="ke bw bk kf kg kh"/><span class="ke bw bk kf kg kh"/><span class="ke bw bk kf kg"/></div><div class="hm hn ho hp hq"><h2 id="6410" class="ki kj ht bd kk kl km kn ko kp kq kr ks jb kt ku kv jf kw kx ky jj kz la lb lc dt translated">花费HTLC执行可撤销交付的14个步骤</h2><p id="e326" class="pw-post-body-paragraph iq ir ht is b it ld iv iw ix le iz ja jb lf jd je jf lg jh ji jj lh jl jm jn hm dt translated">由于重复的解释，我跳过了第4步。所以想了解请参考<a class="ae jo" rel="noopener" href="/@t.tak/simplified-code-of-bitcoin-lightning-network-spend-revocable-delivery-90e50f0256d5">之前的博文</a>。</p><ol class=""><li id="9a21" class="li lj ht is b it iu ix iy jb lk jf ll jj lm jn ln lo lp lq dt translated"><em class="lr">多签名资助</em></li><li id="d7fe" class="li lj ht is b it ls ix lt jb lu jf lv jj lw jn ln lo lp lq dt translated"><em class="lr">建立C1a和C1b(无标志)</em></li><li id="40fd" class="li lj ht is b it ls ix lt jb lu jf lv jj lw jn ln lo lp lq dt translated"><em class="lr">构建RD1a和RD1b </em></li><li id="f5aa" class="li lj ht is b it ls ix lt jb lu jf lv jj lw jn ln lo lp lq dt translated"><em class="lr">C1a和C1b交换签名</em></li><li id="044f" class="li lj ht is b it ls ix lt jb lu jf lv jj lw jn ln lo lp lq dt translated"><em class="lr">建立C2a和C2b(无标志)</em></li><li id="5de4" class="li lj ht is b it ls ix lt jb lu jf lv jj lw jn ln lo lp lq dt translated">建造RD2a和RD2b </li><li id="1cd0" class="li lj ht is b it ls ix lt jb lu jf lv jj lw jn ln lo lp lq dt translated"><em class="lr">构建HTD1b </em></li><li id="2423" class="li lj ht is b it ls ix lt jb lu jf lv jj lw jn ln lo lp lq dt translated"><em class="lr">建造HE1b </em></li><li id="c54d" class="li lj ht is b it ls ix lt jb lu jf lv jj lw jn ln lo lp lq dt translated"><em class="lr">打造HERD1b </em></li><li id="bdeb" class="li lj ht is b it ls ix lt jb lu jf lv jj lw jn ln lo lp lq dt translated"><em class="lr">C2a和C2b的交换签名</em></li><li id="0c55" class="li lj ht is b it ls ix lt jb lu jf lv jj lw jn ln lo lp lq dt translated"><em class="lr">建造BR1a和BR1b </em></li><li id="5cae" class="li lj ht is b it ls ix lt jb lu jf lv jj lw jn ln lo lp lq dt translated"><em class="lr">花C2b </em></li><li id="a17a" class="li lj ht is b it ls ix lt jb lu jf lv jj lw jn ln lo lp lq dt translated"><em class="lr">花合1b </em></li><li id="371f" class="li lj ht is b it ls ix lt jb lu jf lv jj lw jn ln lo lp lq dt translated"><em class="lr">花掉HERD1b </em></li></ol></div><div class="ab cl kb kc hb kd" role="separator"><span class="ke bw bk kf kg kh"/><span class="ke bw bk kf kg kh"/><span class="ke bw bk kf kg"/></div><div class="hm hn ho hp hq"><h2 id="ccac" class="ki kj ht bd kk kl km kn ko kp kq kr ks jb kt ku kv jf kw kx ky jj kz la lb lc dt translated">5.建立C2a和C2b(无标志)</h2><p id="f28e" class="pw-post-body-paragraph iq ir ht is b it ld iv iw ix le iz ja jb lf jd je jf lg jh ji jj lh jl jm jn hm dt translated">首先，爱丽丝创建了前像R，还创建了相应散列H。只有当鲍勃知道前像R时，爱丽丝才想要向鲍勃支付0.1 BTC。对于鲍勃，当H由爱丽丝提供时，他应该回答R以接收0.1 BTC。此时，Alice使用私钥作为R，公钥作为h。</p><pre class="jq jr js jt fq lx ly lz ma aw mb dt"><span id="4c1c" class="ki kj ht ly b fv mc md l me mf">// Use private key as preimage R<br/>const preimageR = generatePrivateKey();</span><span id="2639" class="ki kj ht ly b fv mg md l me mf">// Preimage H is public key<br/>const preimageH = getPubKey(preimageR);</span><span id="825b" class="ki kj ht ly b fv mg md l me mf">let C2a = new Transaction(<br/>  [<br/>    new TxIn( // This is same as C1a<br/>      fTxAH, <br/>      0, <br/>      { <br/>        type: 'MULTI',<br/>        sig: [ <br/>          redeemScript.pubKeyHashs[0], <br/>          redeemScript.pubKeyHashs[1] <br/>        ],<br/>        redeemScript<br/>      }<br/>    ),<br/>    new TxIn( // This is same as C1a<br/>      fTxBH, <br/>      0, <br/>      { <br/>        type: 'MULTI',<br/>        sig: [ <br/>          redeemScript.pubKeyHashs[0], <br/>          redeemScript.pubKeyHashs[1] <br/>        ],<br/>        redeemScript<br/>      }<br/>    )<br/>  ],<br/>  [<br/>    new TxOut(<br/>      40000000, <br/>      { <br/>        type: 'RSMS',<br/>        pubKeyHash: [ <br/>          getPubKeyHash(AliceKeys[4]), <br/>          getPubKeyHash(BobKeys[4]) <br/>        ]<br/>      }<br/>    ),<br/>    new TxOut(<br/>      50000000, <br/>      { <br/>        type: 'NORMAL',<br/>        pubKeyHash: getPubKeyHash(BobKeys[4])<br/>      }<br/>    ),<br/>    new TxOut(<br/>      10000000, <br/>      { <br/>        type: 'HTLC',<br/>        pubKeyHash: [<br/>          getPubKeyHash(AliceKeys[4]),<br/>          getPubKeyHash(BobKeys[4])<br/>        ],<br/>        preimageH // Alice provide H, Bob need to know R<br/>      }<br/>    )<br/>  ]<br/>)</span></pre><p id="ed8b" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">Json格式scriptPubKey如下。</p><pre class="jq jr js jt fq lx ly lz ma aw mb dt"><span id="1794" class="ki kj ht ly b fv mc md l me mf">scriptPubKey = { <br/>  type: 'HTLC',<br/>  pubKeyHash: [<br/>    pubKeyHash1,<br/>    pubKeyHash2<br/>  ],<br/>  preimageH: preimageH<br/>}</span></pre><p id="4242" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">用同样的方法，鲍勃建立C2b。</p></div><div class="ab cl kb kc hb kd" role="separator"><span class="ke bw bk kf kg kh"/><span class="ke bw bk kf kg kh"/><span class="ke bw bk kf kg"/></div><div class="hm hn ho hp hq"><h2 id="8699" class="ki kj ht bd kk kl km kn ko kp kq kr ks jb kt ku kv jf kw kx ky jj kz la lb lc dt translated">6.构建RD2a和RD2b</h2><p id="b309" class="pw-post-body-paragraph iq ir ht is b it ld iv iw ix le iz ja jb lf jd je jf lg jh ji jj lh jl jm jn hm dt translated">跳过重复解释。请参考<a class="ae jo" rel="noopener" href="/@t.tak/simplified-code-of-bitcoin-lightning-network-spend-revocable-delivery-90e50f0256d5">上一篇</a>中的“<em class="lr">构建RD1a和RD1b </em>”部分。</p></div><div class="ab cl kb kc hb kd" role="separator"><span class="ke bw bk kf kg kh"/><span class="ke bw bk kf kg kh"/><span class="ke bw bk kf kg"/></div><div class="hm hn ho hp hq"><h2 id="9c29" class="ki kj ht bd kk kl km kn ko kp kq kr ks jb kt ku kv jf kw kx ky jj kz la lb lc dt translated">7.构建HTD1b</h2><p id="5253" class="pw-post-body-paragraph iq ir ht is b it ld iv iw ix le iz ja jb lf jd je jf lg jh ji jj lh jl jm jn hm dt translated">如果Bob不能回答R，只有Alice可以广播该交易以在3个确认时间锁定之后退还0.1 BTC。对于Bob，最好回答R，直到该时间锁定到期。</p><pre class="jq jr js jt fq lx ly lz ma aw mb dt"><span id="f9ab" class="ki kj ht ly b fv mc md l me mf">let HTD1b = new Transaction(<br/>  [<br/>    new TxIn(<br/>      '', <br/>      2, <br/>      { <br/>        type: 'HTLCT',<br/>        sig: [ <br/>          getPubKeyHash(AliceKeys[4]), <br/>          getPubKeyHash(BobKeys[4])<br/>        ],<br/>        sequence: 3<br/>      }<br/>    )<br/>  ],<br/>  [<br/>    new TxOut(<br/>      10000000, <br/>      { <br/>        type: 'NORMAL',<br/>        pubKeyHash: getPubKeyHash(AliceKeys[5])<br/>      }<br/>    )<br/>  ]<br/>)</span><span id="db30" class="ki kj ht ly b fv mg md l me mf">// Alice hand over HTD1b to Bob and let him sign<br/>HTD1b = signTx(HTD1b, BobKeys[4]);</span></pre><p id="d352" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">Json格式scriptSig如下。</p><pre class="jq jr js jt fq lx ly lz ma aw mb dt"><span id="9bd2" class="ki kj ht ly b fv mc md l me mf">scriptSig = { <br/>  type: 'HTLCT',<br/>  sig: [ <br/>    {<br/>     signature: signature, <br/>     pubKey: pubKey1 <br/>    },<br/>    {<br/>     signature: signature, <br/>     pubKey: pubKey2<br/>    }<br/>  ],<br/>  sequence: 3<br/>}</span></pre><p id="3018" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">请注意，HT1a与HTD1b略有不同，因此请参考<a class="ae jo" href="https://github.com/tak1827/lightning-network-tx-flow/tree/spend-HERD" rel="noopener ugc nofollow" target="_blank"> Gitbub </a>。</p></div><div class="ab cl kb kc hb kd" role="separator"><span class="ke bw bk kf kg kh"/><span class="ke bw bk kf kg kh"/><span class="ke bw bk kf kg"/></div><div class="hm hn ho hp hq"><h2 id="d324" class="ki kj ht bd kk kl km kn ko kp kq kr ks jb kt ku kv jf kw kx ky jj kz la lb lc dt translated">8.构建HE1b</h2><p id="dfa7" class="pw-post-body-paragraph iq ir ht is b it ld iv iw ix le iz ja jb lf jd je jf lg jh ji jj lh jl jm jn hm dt translated">鲍勃可以在任何时候广播这个交易，只要他知道r。不幸的是，他没有从这个交易中获得0.1 BTC。</p><pre class="jq jr js jt fq lx ly lz ma aw mb dt"><span id="9797" class="ki kj ht ly b fv mc md l me mf">let HE1b = new Transaction(<br/>  [<br/>    new TxIn(<br/>      '', <br/>      2, <br/>      { <br/>        type: 'HTLCE',<br/>        sig: [ <br/>          getPubKeyHash(AliceKeys[4]), <br/>          getPubKeyHash(BobKeys[4])<br/>        ],<br/>        preimageR // Bob answer required R<br/>      }<br/>    )<br/>  ],<br/>  [<br/>    new TxOut(<br/>      10000000, <br/>      { <br/>        type: 'RSMS',<br/>        pubKeyHash: [ <br/>          getPubKeyHash(AliceKeys[5]), <br/>          getPubKeyHash(BobKeys[5]) <br/>        ]<br/>      }<br/>    )<br/>  ]<br/>)</span><span id="5968" class="ki kj ht ly b fv mg md l me mf">// Bob hand over HE1b to Alice and let her sign<br/>HE1b = signTx(HE1b, AliceKeys[4]);</span></pre><p id="f0db" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">Json格式scriptSig如下。</p><pre class="jq jr js jt fq lx ly lz ma aw mb dt"><span id="adb3" class="ki kj ht ly b fv mc md l me mf">scriptSig = { <br/>  type: 'HTLCE',<br/>  sig: [ <br/>    {<br/>      signature: signature, <br/>      pubKey: pubKey1 <br/>    },<br/>    {<br/>      signature: signature, <br/>      pubKey: pubKey2<br/>    }<br/>  ],<br/>  preimageR: preimageR  <br/>}</span></pre><p id="616a" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">请注意HED1a与HE1b略有不同，因此请参考<a class="ae jo" href="https://github.com/tak1827/lightning-network-tx-flow/tree/spend-HERD" rel="noopener ugc nofollow" target="_blank"> Gitbub </a>。</p></div><div class="ab cl kb kc hb kd" role="separator"><span class="ke bw bk kf kg kh"/><span class="ke bw bk kf kg kh"/><span class="ke bw bk kf kg"/></div><div class="hm hn ho hp hq"><h2 id="e45f" class="ki kj ht bd kk kl km kn ko kp kq kr ks jb kt ku kv jf kw kx ky jj kz la lb lc dt translated">9.构建HERD1b</h2><p id="6eda" class="pw-post-body-paragraph iq ir ht is b it ld iv iw ix le iz ja jb lf jd je jf lg jh ji jj lh jl jm jn hm dt translated">Bob只能在10个确认时间锁定后广播该事务。最后，鲍勃从这笔交易中得到0.1 BTC。</p><pre class="jq jr js jt fq lx ly lz ma aw mb dt"><span id="eac7" class="ki kj ht ly b fv mc md l me mf">let HERD1b = new Transaction(<br/>  [<br/>    new TxIn(<br/>      '', <br/>      0, <br/>      { <br/>        type: 'RD',<br/>        sig: [ <br/>          getPubKeyHash(AliceKeys[5]), <br/>          getPubKeyHash(BobKeys[5])<br/>        ],<br/>        sequence: 10 // 10 block confirmation time lock<br/>      }<br/>    )<br/>  ],<br/>  [<br/>    new TxOut(<br/>      10000000, <br/>      { <br/>        type: 'NORMAL',<br/>        pubKeyHash: getPubKeyHash(BobKeys[6])<br/>      }<br/>    )<br/>  ]<br/>)</span><span id="a633" class="ki kj ht ly b fv mg md l me mf">// Bob hand over HERD1b to Alice and let her sign<br/>HERD1b = signTx(HERD1b, AliceKeys[5]);</span></pre><p id="613f" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">请注意，HTRD1a与HERD1b略有不同，因此请参考<a class="ae jo" href="https://github.com/tak1827/lightning-network-tx-flow/tree/spend-HERD" rel="noopener ugc nofollow" target="_blank"> Gitbub </a>。</p></div><div class="ab cl kb kc hb kd" role="separator"><span class="ke bw bk kf kg kh"/><span class="ke bw bk kf kg kh"/><span class="ke bw bk kf kg"/></div><div class="hm hn ho hp hq"><h2 id="43ec" class="ki kj ht bd kk kl km kn ko kp kq kr ks jb kt ku kv jf kw kx ky jj kz la lb lc dt translated">10.C2a和C2b的交换签名</h2><p id="76ea" class="pw-post-body-paragraph iq ir ht is b it ld iv iw ix le iz ja jb lf jd je jf lg jh ji jj lh jl jm jn hm dt translated">爱丽丝让鲍勃签C2a。现在，爱丽丝可以随时广播这个交易。</p><pre class="jq jr js jt fq lx ly lz ma aw mb dt"><span id="26ff" class="ki kj ht ly b fv mc md l me mf">// Alice hand over C2a to Bob, and let him sign<br/>C2a = signTx(C2a, BobKeys[1]);</span></pre><p id="8c99" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">同样的，鲍勃让爱丽丝签了C2b。</p></div><div class="ab cl kb kc hb kd" role="separator"><span class="ke bw bk kf kg kh"/><span class="ke bw bk kf kg kh"/><span class="ke bw bk kf kg"/></div><div class="hm hn ho hp hq"><h2 id="c4a9" class="ki kj ht bd kk kl km kn ko kp kq kr ks jb kt ku kv jf kw kx ky jj kz la lb lc dt translated">11.建造BR1a和BR1b</h2><p id="ff81" class="pw-post-body-paragraph iq ir ht is b it ld iv iw ix le iz ja jb lf jd je jf lg jh ji jj lh jl jm jn hm dt translated">跳过重复解释。请参考<a class="ae jo" rel="noopener" href="/@t.tak/simplified-code-of-bitcoin-lightning-network-part2-spend-breach-remedy-997de8a21f29">上一篇</a>中的“<em class="lr">构建BR1a和BR1b </em>部分。</p></div><div class="ab cl kb kc hb kd" role="separator"><span class="ke bw bk kf kg kh"/><span class="ke bw bk kf kg kh"/><span class="ke bw bk kf kg"/></div><div class="hm hn ho hp hq"><h2 id="1ffb" class="ki kj ht bd kk kl km kn ko kp kq kr ks jb kt ku kv jf kw kx ky jj kz la lb lc dt translated">12.消费C2b</h2><p id="1121" class="pw-post-body-paragraph iq ir ht is b it ld iv iw ix le iz ja jb lf jd je jf lg jh ji jj lh jl jm jn hm dt translated">鲍勃消费C2b。即使他知道R，他也不能立即接收到Alice的0.1 BTC，因为时间锁定在她的D1b上。</p><p id="08e4" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">但是，如果爱丽丝花C2a，鲍勃只要知道r就可以立即收到。</p><pre class="jq jr js jt fq lx ly lz ma aw mb dt"><span id="e7d2" class="ki kj ht ly b fv mc md l me mf">// Sign by himself(Bob)<br/>C2b = signTx(C2b, BobKeys[1]);</span><span id="e27c" class="ki kj ht ly b fv mg md l me mf">// Validate transaction<br/>validateTx(C2b, Blocks);</span><span id="171c" class="ki kj ht ly b fv mg md l me mf">// Mine block as adding transactions<br/>Blocks = mineBlock(Blocks, createNewBlock([C2b], Blocks));</span></pre></div><div class="ab cl kb kc hb kd" role="separator"><span class="ke bw bk kf kg kh"/><span class="ke bw bk kf kg kh"/><span class="ke bw bk kf kg"/></div><div class="hm hn ho hp hq"><h2 id="c636" class="ki kj ht bd kk kl km kn ko kp kq kr ks jb kt ku kv jf kw kx ky jj kz la lb lc dt translated">13.花费HTD1b</h2><p id="2375" class="pw-post-body-paragraph iq ir ht is b it ld iv iw ix le iz ja jb lf jd je jf lg jh ji jj lh jl jm jn hm dt translated">鲍勃用这笔交易来回答r</p><pre class="jq jr js jt fq lx ly lz ma aw mb dt"><span id="5b70" class="ki kj ht ly b fv mc md l me mf">// Set C2b transaction hash<br/>HE1b.txIns[0].txPrev = calculateTxHash(C2b);</span><span id="21a0" class="ki kj ht ly b fv mg md l me mf">HE1b = signTx(HE1b, BobKeys[4]);</span><span id="a36b" class="ki kj ht ly b fv mg md l me mf">validateTx(HE1b, Blocks);</span><span id="a46a" class="ki kj ht ly b fv mg md l me mf">Blocks.push( createNewBlock([HE1b], Blocks) );</span></pre></div><div class="ab cl kb kc hb kd" role="separator"><span class="ke bw bk kf kg kh"/><span class="ke bw bk kf kg kh"/><span class="ke bw bk kf kg"/></div><div class="hm hn ho hp hq"><h2 id="8022" class="ki kj ht bd kk kl km kn ko kp kq kr ks jb kt ku kv jf kw kx ky jj kz la lb lc dt translated">14.花掉她1b</h2><p id="5b2f" class="pw-post-body-paragraph iq ir ht is b it ld iv iw ix le iz ja jb lf jd je jf lg jh ji jj lh jl jm jn hm dt translated">鲍勃花这笔交易获得0.1 BTC后，10个时间锁定。</p><pre class="jq jr js jt fq lx ly lz ma aw mb dt"><span id="af42" class="ki kj ht ly b fv mc md l me mf">// Set HE1b transaction hash<br/>HERD1b.txIns[0].txPrev = calculateTxHash(HE1b);</span><span id="e7a9" class="ki kj ht ly b fv mg md l me mf">HERD1b = signTx(HERD1b, BobKeys[5]);</span><span id="cbf8" class="ki kj ht ly b fv mg md l me mf">// Wait 10 confirmations for time lock<br/>Blocks = mineBlock(Blocks, createNewBlock([], Blocks));<br/>Blocks = mineBlock(Blocks, createNewBlock([], Blocks));<br/>Blocks = mineBlock(Blocks, createNewBlock([], Blocks));<br/>Blocks = mineBlock(Blocks, createNewBlock([], Blocks));<br/>Blocks = mineBlock(Blocks, createNewBlock([], Blocks));<br/>Blocks = mineBlock(Blocks, createNewBlock([], Blocks));<br/>Blocks = mineBlock(Blocks, createNewBlock([], Blocks));<br/>Blocks = mineBlock(Blocks, createNewBlock([], Blocks));<br/>Blocks = mineBlock(Blocks, createNewBlock([], Blocks));<br/>Blocks = mineBlock(Blocks, createNewBlock([], Blocks));</span><span id="9778" class="ki kj ht ly b fv mg md l me mf">validateTx(HERD1b, Blocks);</span><span id="5dd8" class="ki kj ht ly b fv mg md l me mf">Blocks.push( createNewBlock([HERD1b], Blocks) );</span></pre></div></div>    
</body>
</html>