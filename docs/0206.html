<html>
<head>
<title>ERC721SmartToken — ERC721 Token with ERC20 Adapter</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">ERC721SmartToken —带ERC20适配器的ERC721令牌</h1>
<blockquote>原文：<a href="https://medium.com/coinmonks/erc721smarttoken-erc721-token-with-erc20-adapter-8f3776f2fef0?source=collection_archive---------1-----------------------#2018-04-01">https://medium.com/coinmonks/erc721smarttoken-erc721-token-with-erc20-adapter-8f3776f2fef0?source=collection_archive---------1-----------------------#2018-04-01</a></blockquote><div><div class="ef hh hi hj hk hl"/><div class="hm hn ho hp hq"><div class=""/><figure class="fi fk iq ir is it fe ff paragraph-image"><div class="ab fr cl iu"><img src="../Images/415acadfc7f7648e7cf3d800966b7238.png" data-original-src="https://miro.medium.com/v2/format:webp/1*JPuXetyrEb-qwy1rr9lSVg.png"/></div><figcaption class="ix iy fg fe ff iz ja bd b be z ek"><a class="ae jb" rel="noopener" href="/blockchannel/the-anatomy-of-erc721-2576e40bfc5b">source</a></figcaption></figure><p id="7e35" class="pw-post-body-paragraph jc jd ht je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hm dt translated"><code class="eh ka kb kc kd b"><a class="ae jb" href="https://github.com/REGA-RS/ERC721SmartToken" rel="noopener ugc nofollow" target="_blank">ERC721SmartToken</a></code>契约基于<a class="ae jb" href="https://github.com/ethereum/eips/issues/721" rel="noopener ugc nofollow" target="_blank"> ERC721 </a>标准实现不可替换的令牌，该标准也支持<a class="ae jb" href="https://github.com/ethereum/eips/issues/20" rel="noopener ugc nofollow" target="_blank"> ERC20 </a>接口。主要思想是创建一个既不可替代又具有可转移价值的代币。</p><p id="5da3" class="pw-post-body-paragraph jc jd ht je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hm dt translated">在ERC721契约中，每个不可替换的令牌都表示为一个NFT结构，其中有一个名为<code class="eh ka kb kc kd b">value</code>的成员元素。</p><pre class="ke kf kg kh fq ki kd kj kk aw kl dt"><span id="e120" class="km kn ht kd b fv ko kp l kq kr">struct NFT {<br/>        uint256 value;          // NFT value <br/>        string  metadata;       // ... metadata: IPFS path<br/>        uint256 kind;           // ... type<br/>        uint256 level;          // ... activities level<br/>        uint256 state;          // ... state<br/>    }</span></pre><p id="b32a" class="pw-post-body-paragraph jc jd ht je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hm dt translated">此元素在ERC721令牌中包含ERC20令牌。</p><p id="20ec" class="pw-post-body-paragraph jc jd ht je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hm dt translated">要将ERC721令牌作为普通的ERC20令牌使用，我们需要创建一个实现标准ERC20方法的<code class="eh ka kb kc kd b">ERC20Adapter</code>，例如<code class="eh ka kb kc kd b">balanceOf</code>方法。</p><pre class="ke kf kg kh fq ki kd kj kk aw kl dt"><span id="e9e0" class="km kn ht kd b fv ko kp l kq kr">function balanceOf(address _owner) public view returns (uint256)</span></pre><p id="41e0" class="pw-post-body-paragraph jc jd ht je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hm dt translated">但是在我们的例子中，由于每个<code class="eh ka kb kc kd b">_owner</code>的ERC721结构，可能有许多不可替换的令牌属于这个特定的地址。要为ERC20兼容操作选择特定的令牌，如将令牌值转移到另一个地址，我们需要实现新的方法，该方法将接受地址和令牌ID作为参数。</p><pre class="ke kf kg kh fq ki kd kj kk aw kl dt"><span id="28de" class="km kn ht kd b fv ko kp l kq kr">function approveFrom(uint256 _fromId, address _spender, uint256 _toId, uint256 _value) public returns (bool success)</span></pre><p id="2945" class="pw-post-body-paragraph jc jd ht je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hm dt translated">该方法调用由<code class="eh ka kb kc kd b">ERC721SmartToken</code>契约实现的<code class="eh ka kb kc kd b">ERC20Controller</code>方法，该方法将使用以下映射来存储关于NFT令牌的信息:</p><pre class="ke kf kg kh fq ki kd kj kk aw kl dt"><span id="8198" class="km kn ht kd b fv ko kp l kq kr">mapping (address =&gt; mapping (address =&gt; uint256)) public allowanceIds; // transfer allowance<br/>mapping (address =&gt; mapping (address =&gt; uint256)) public allowanceAmt; // transfer allowance</span></pre><p id="84c6" class="pw-post-body-paragraph jc jd ht je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hm dt translated">现在我们可以使用ERC20标准方法<code class="eh ka kb kc kd b">transfer</code>和<code class="eh ka kb kc kd b">transferFrom</code>在两个NFT令牌之间传递值。</p><p id="d3b9" class="pw-post-body-paragraph jc jd ht je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hm dt translated"><code class="eh ka kb kc kd b">ERC20Controller</code>实现了为<code class="eh ka kb kc kd b">_owner</code>地址提供默认NFT id的<code class="eh ka kb kc kd b">defaultId</code>方法。</p><pre class="ke kf kg kh fq ki kd kj kk aw kl dt"><span id="d023" class="km kn ht kd b fv ko kp l kq kr">function defaultId(address _owner) internal returns (uint256 id);</span></pre><p id="d4ac" class="pw-post-body-paragraph jc jd ht je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hm dt translated">因此，我们可以使用ERC20标准方法<code class="eh ka kb kc kd b">approve</code>来批准<code class="eh ka kb kc kd b">msg.sender</code>和<code class="eh ka kb kc kd b">_spender</code>的两个NFT默认令牌之间的转移。</p><p id="e479" class="pw-post-body-paragraph jc jd ht je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hm dt translated"><a class="ae jb" href="https://github.com/REGA-RS/ERC721SmartToken" rel="noopener ugc nofollow" target="_blank"> REGA风险分担GitHub </a></p><blockquote class="ks"><p id="bf6e" class="kt ku ht bd kv kw kx ky kz la lb jz ek translated"><a class="ae jb" href="https://coincodecap.com/?utm_source=coinmonks" rel="noopener ugc nofollow" target="_blank">在您的收件箱中直接获得最佳软件交易</a></p></blockquote><figure class="ld le lf lg lh it fe ff paragraph-image"><a href="https://coincodecap.com/?utm_source=coinmonks"><div class="fe ff lc"><img src="../Images/7c0b3dfdcbfea594cc0ae7d4f9bf6fcb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1168/format:webp/0*OJ-qb5G6i863msBB.png"/></div></a></figure></div></div>    
</body>
</html>