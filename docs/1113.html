<html>
<head>
<title>Preparing a headless environment for OpenAI’s Gym (with Docker and Tensorflow)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">为OpenAI的健身房准备一个无头环境(与Docker和Tensorflow一起)</h1>
<blockquote>原文：<a href="https://medium.com/coinmonks/preparing-a-headless-environment-for-openais-gym-with-docker-and-tensorflow-1bd0e0d31663?source=collection_archive---------2-----------------------#2018-07-23">https://medium.com/coinmonks/preparing-a-headless-environment-for-openais-gym-with-docker-and-tensorflow-1bd0e0d31663?source=collection_archive---------2-----------------------#2018-07-23</a></blockquote><div><div class="ef hh hi hj hk hl"/><div class="hm hn ho hp hq"><div class=""/><figure class="fi fk ir is it iu fe ff paragraph-image"><div role="button" tabindex="0" class="iv iw di ix bf iy"><div class="fe ff iq"><img src="../Images/f4a37498c38d64ccc7c6f75204d0e642.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IudLHvYjP4lm_5DcwW-c6w.png"/></div></div><figcaption class="jb jc fg fe ff jd je bd b be z ek">Running Cartpole DeepQ OpenAI’s baseline on GTX1060 inside a container</figcaption></figure><p id="8db8" class="pw-post-body-paragraph jf jg ht jh b ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc hm dt translated">应该不难吧？</p><p id="a44e" class="pw-post-body-paragraph jf jg ht jh b ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc hm dt translated">实际上，仅仅在一个无头(或云)服务器上制作OpenAI的Gym渲染是非常困难的，因为自然地，这些服务器没有屏幕。</p><p id="1d5c" class="pw-post-body-paragraph jf jg ht jh b ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc hm dt translated">Gym需要一个显示器(而不是屏幕)来渲染许多环境。我认为最可靠的方法是拥有一个“成熟的桌面环境”,万一你想看现场直播，你可以远程控制它，最好是通过VNC。</p><p id="8710" class="pw-post-body-paragraph jf jg ht jh b ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc hm dt translated">所有这些都可以在一个Docker容器中完成，这将减轻你某种程度的依赖性，我认为这是Gym真正关心的问题。而且，<strong class="jh hu">我更喜欢Ubuntu </strong>。</p><p id="e5a2" class="pw-post-body-paragraph jf jg ht jh b ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc hm dt translated">所以，我们首先在Docker上找到一个工作桌面环境作为起点。我很快找到了这个<a class="ae kd" href="https://github.com/fcwu/docker-ubuntu-vnc-desktop" rel="noopener ugc nofollow" target="_blank">https://github.com/fcwu/docker-ubuntu-vnc-desktop</a>，里面包含:</p><ul class=""><li id="0a06" class="ke kf ht jh b ji jj jm jn jq kg ju kh jy ki kc kj kk kl km dt translated">Ubuntu 18.04(以及你可以选择的其他版本)</li><li id="3076" class="ke kf ht jh b ji kn jm ko jq kp ju kq jy kr kc kj kk kl km dt translated">LXDE on <strong class="jh hu"> Xvfb </strong>。为什么是LXDE？这是一个非常轻便的桌面环境。Xvfb是什么？它是一个虚拟显示提供商。无头服务器没有显示器，这实际上创建了一个显示器。</li><li id="a9fc" class="ke kf ht jh b ji kn jm ko jq kp ju kq jy kr kc kj kk kl km dt translated">允许通过<strong class="jh hu"> x11vnc </strong>远程访问，其要点是x11vnc是一种通过vnc托管X11显示器的方式。基本上，这将托管Xvfb显示。</li><li id="5150" class="ke kf ht jh b ji kn jm ko jq kp ju kq jy kr kc kj kk kl km dt translated">拥有一个网络客户端意味着你不需要安装一个VNC客户端，你只需要一个网络浏览器(这是一个很好的功能，但我不会用它)</li></ul><h2 id="0408" class="ks kt ht bd ku kv kw kx ky kz la lb lc jq ld le lf ju lg lh li jy lj lk ll lm dt translated"><strong class="ak">用什么Ubuntu版本？</strong></h2><p id="992c" class="pw-post-body-paragraph jf jg ht jh b ji ln jk jl jm lo jo jp jq lp js jt ju lq jw jx jy lr ka kb kc hm dt translated">我觉得最兼容的是16.04(不是18.04)。特别是，如果你想使用Tensorflow，你需要CUDA 9.0的官方支持，但是CUDA 9.0的官方支持版本是16.04。这意味着18.04版的CUDA 9.0是一个未知领域。</p><p id="fd82" class="pw-post-body-paragraph jf jg ht jh b ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc hm dt translated">然而，健身房出了点小问题。即使我的内心相信健身房会和16.04一起很棒，但是我试过了，没有用。问题出在环境上。我有足够的证据得出结论，无论是什么原因造成的，都一定是16.04和18.04之间的差异(当然是在安装了桌面环境的情况下)，因为我发现18.04可以工作。</p><p id="fae9" class="pw-post-body-paragraph jf jg ht jh b ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc hm dt translated">最后，我将为本文选择Ubuntu 18.04，并向您展示在未知领域生存的方法。</p><h2 id="2c2d" class="ks kt ht bd ku kv kw kx ky kz la lb lc jq ld le lf ju lg lh li jy lj lk ll lm dt translated">只是一个工作的健身房</h2><p id="8165" class="pw-post-body-paragraph jf jg ht jh b ji ln jk jl jm lo jo jp jq lp js jt ju lq jw jx jy lr ka kb kc hm dt translated">在工作桌面环境中，这似乎微不足道。我们需要的是遵循https://github.com/openai/gym的指示。在18.04中，并不是所有的依赖项都可以用于example<strong class="jh hu">libav-tools</strong>在18.04中不可用，我们需要安装<strong class="jh hu"> ffmpeg </strong>来代替。</p><p id="5654" class="pw-post-body-paragraph jf jg ht jh b ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc hm dt translated">从属关系变成:</p><pre class="lw lx ly lz fq ma lv mb mc aw md dt"><span id="d8fa" class="ks kt ht lv b fv me mf l mg mh">apt-get install -y python-numpy python-dev cmake zlib1g-dev libjpeg-dev xvfb <strong class="lv hu">ffmpeg </strong>xorg-dev python-opengl libboost-all-dev libsdl2-dev swig</span></pre><p id="43cc" class="pw-post-body-paragraph jf jg ht jh b ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc hm dt translated">而且我倾向于不依赖系统的Python主要是因为不完全了解，也有<code class="eh ls lt lu lv b">python</code>是Python 2的意思。如果我们想使用Python 3，需要一直使用对我来说很麻烦的<code class="eh ls lt lu lv b">python3</code>和<code class="eh ls lt lu lv b">pip3</code>。那就别管系统巨蟒了！我们将使用一辆<a class="ae kd" href="https://conda.io/miniconda.html" rel="noopener ugc nofollow" target="_blank">迷你康达</a>。幸运的是，Miniconda提供了一个<a class="ae kd" href="https://github.com/ContinuumIO/docker-images/tree/master/miniconda3" rel="noopener ugc nofollow" target="_blank">官方Dockerfile </a>我们可以很容易地集成它。</p><p id="45d6" class="pw-post-body-paragraph jf jg ht jh b ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc hm dt translated"><strong class="jh hu">我在这里提供了Dockerfile的修改版(没有noVNC和web客户端):</strong><a class="ae kd" href="https://github.com/phizaz/docker-cuda-gym/tree/master/gym-only" rel="noopener ugc nofollow" target="_blank">https://github . com/phizaz/docker-cuda-gym/tree/master/gym-only</a></p><p id="f526" class="pw-post-body-paragraph jf jg ht jh b ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc hm dt translated"><strong class="jh hu">关于文档的注释</strong></p><p id="ee08" class="pw-post-body-paragraph jf jg ht jh b ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc hm dt translated">所有docker文件都假设在容器中总是使用“root”用户。但是，这并不意味着它必须从外部根源。Docker为<a class="ae kd" href="https://docs.docker.com/engine/security/userns-remap/" rel="noopener ugc nofollow" target="_blank">用户名间距</a>提供了一种简洁的方式，这样容器中的根用户在外部将被视为普通用户。这使得我们的docker文件更容易编写。</p><h2 id="8bb5" class="ks kt ht bd ku kv kw kx ky kz la lb lc jq ld le lf ju lg lh li jy lj lk ll lm dt translated">如果你想用Tensorflow</h2><p id="6f58" class="pw-post-body-paragraph jf jg ht jh b ji ln jk jl jm lo jo jp jq lp js jt ju lq jw jx jy lr ka kb kc hm dt translated">我假设你也想要Tensorflow的GPU版本，这意味着你需要安装某个版本的CUDA(最好是官方支持的最新CUDA版本9.0)，为此你还需要<a class="ae kd" href="https://github.com/phizaz/docker-cuda-gym/tree/master/gym-only" rel="noopener ugc nofollow" target="_blank"> nvidia-docker </a>。</p><p id="fde9" class="pw-post-body-paragraph jf jg ht jh b ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc hm dt translated">好吧，我们想用CUDA 9.0，但如上所述我们也想用Ubuntu 18.04(不知何故16.04对Gym有问题)。这造成了一个尴尬的局面，因为CUDA 9.0不支持Ubuntu 18.04(你不会找到来自nvidia的官方Docker映像)。因此，我们需要靠自己实现这一目标。</p><p id="81b7" class="pw-post-body-paragraph jf jg ht jh b ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc hm dt translated">在Ubuntu 18.04上安装CUDA 9.0的通用配方可以从<a class="ae kd" href="https://gist.github.com/Mahedi-61/2a2f1579d4271717d421065168ce6a73" rel="noopener ugc nofollow" target="_blank">https://gist . github . com/马赫迪-61/2a2f 1579d 4271717d 421065168 ce 6a 73</a>中找到</p><p id="851a" class="pw-post-body-paragraph jf jg ht jh b ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc hm dt translated">一般需要从Nvidia网站下载一个“runfile”。此外，Tensorflow需要CUDNN 7才能工作，您也需要从网站下载它。</p><p id="29c6" class="pw-post-body-paragraph jf jg ht jh b ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc hm dt translated">我已经为docker文件提供了一个模板。如果您有一个合适的runfile和CUDNN档案，您应该能够轻松地构建Docker映像。</p><p id="2e86" class="pw-post-body-paragraph jf jg ht jh b ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc hm dt translated">【CUDA Dockerfile的一个配方:【https://github.com/phizaz/docker-cuda-gym/tree/master/cuda】T3</p><p id="7cee" class="pw-post-body-paragraph jf jg ht jh b ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc hm dt translated">鉴于您现在已经有了CUDA基础映像，我们继续安装Tensorflow和Jupyterlab。这应该是最微不足道的，因为我们有CUDA 9.0，它是官方支持的。此外，Jupyterlab也可以通过<code class="eh ls lt lu lv b">conda install</code>获得。</p><p id="973f" class="pw-post-body-paragraph jf jg ht jh b ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc hm dt translated"><strong class="jh hu">下面是其余的Docker食谱(tensor flow+Jupyterlab):</strong><a class="ae kd" href="https://github.com/phizaz/docker-cuda-gym/tree/master/tensorflow" rel="noopener ugc nofollow" target="_blank">https://github . com/phizaz/Docker-cuda-gym/tree/master/tensor flow</a></p><p id="56a0" class="pw-post-body-paragraph jf jg ht jh b ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc hm dt translated"><em class="mi">希望这篇文章能为你节省几个小时的试错时间，为你营造一个工作的健身房环境。</em></p></div></div>    
</body>
</html>