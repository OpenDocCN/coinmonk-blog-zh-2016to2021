# ä¸€ä¸ªå…³äºè¿‡åº¦æ‹Ÿåˆä½ çš„ç¥ç»ç½‘ç»œçš„å°æ•…äº‹

> åŸæ–‡ï¼š<https://medium.com/coinmonks/machine-learning-essentials-a-short-story-about-over-fitting-your-network-or-the-importance-of-c4229957410d?source=collection_archive---------11----------------------->

## ä¸€ä¸ªå…³äºè¿‡åº¦æ‹Ÿåˆä½ çš„ç¥ç»ç½‘ç»œçš„å°æ•…äº‹(æˆ–è€… Keras ä¸ŠéªŒè¯æ•°æ®çš„é‡è¦æ€§)

è¿™æ˜¯ä¸€ä¸ªç®€çŸ­çš„æ•…äº‹ï¼Œè®²è¿°äº†æ·»åŠ ä¸€ä¸ªéªŒè¯åˆ†åŒºçš„é‡è¦æ€§ï¼Œè¯¥åˆ†åŒºå°†åœ¨æ¯ä¸ªæ—¶æœŸè¿›è¡Œè¯„ä¼°ï¼Œè€Œä¸æ˜¯ç­‰åˆ°è®­ç»ƒç»“æŸåæ‰æµ‹é‡è®­ç»ƒæ¨¡å‹åœ¨é¢„æµ‹è®­ç»ƒé˜¶æ®µä»æœªè§è¿‡çš„å®ä¾‹æ–¹é¢æœ‰å¤šå¥½ï¼Œæˆ–è€…æ¢å¥è¯è¯´ï¼Œæ¦‚æ‹¬é—®é¢˜ã€‚

![](img/118ce67af15f352b34a0bb92a5ed36ee.png)

# éƒ¨åˆ†çµæ„Ÿæ¥è‡ªçœŸå®äº‹ä»¶

è®©æˆ‘ä»¬å‡è®¾ä½ æ­£åœ¨ Keras ä¸Šä½¿ç”¨é€’å½’ç¥ç»ç½‘ç»œå¼€å‘ä¸€ä¸ªæ–‡æœ¬åˆ†ç±»å™¨ã€‚ä¸€ä¸ªäºŒå…ƒé—®é¢˜ï¼Œå…¶ä¸­ä¸€ä¸ªå¥å­è¢«é€å­—è¾“å…¥ç½‘ç»œï¼Œé¢„æœŸè¾“å‡ºæ˜¯ä¸€ä¸ªå•å€¼ï¼Œé¢„æµ‹è¯¥å¥å­æ˜¯â€œ**æ­£**è¿˜æ˜¯â€œ**è´Ÿ**â€(æ— è®ºåœ¨ä½ çš„ä¸Šä¸‹æ–‡ä¸­æ˜¯ä»€ä¹ˆæ„æ€)ã€‚æ˜¯çš„ï¼Œæ˜¯çš„ï¼Œå°±åƒæˆ‘åœ¨ä¹‹å‰çš„æ•…äº‹ä¸­è¯¦è¿°çš„[ğŸ˜‰ï¼š](/@monocasero/text-classifier-with-keras-tensorflow-using-recurrent-neural-networks-ad63dd5fc316)

ä¸ºäº†è®­ç»ƒåˆ†ç±»å™¨ï¼Œä½ ä¸ç”¨åƒ Keras æä¾›çš„é‚£æ ·ä½¿ç”¨é¢„å…ˆå‡†å¤‡å¥½çš„æ•°æ®é›†[ã€‚æ‚¨å·²ç»åˆ›å»ºäº†è‡ªå·±çš„é›†åˆï¼Œä»”ç»†å‡†å¤‡äº†è®­ç»ƒç¤ºä¾‹åŠå…¶æ ‡ç­¾ã€‚](https://keras.io/datasets/)

æ­¤æ—¶æ‚¨å¯èƒ½ä¸çŸ¥é“ï¼Œæˆ–è€…æ‚¨ä¸æ‰“ç®—å°†éªŒè¯æ•°æ®å‘é€åˆ° [Keras fit å‡½æ•°](https://keras.io/models/sequential/)ï¼Œä½†æ˜¯æ‚¨ç¡®å®æ‰“ç®—åœ¨è®­ç»ƒç»“æŸæ—¶åˆ†å‰²æ•°æ®é›†è¿›è¡Œè¯„ä¼°(å‡è®¾ 90%è®­ç»ƒï¼Œ10%è¯„ä¼°)ã€‚ä¸ºæ­¤ç›®çš„**ä½ é€‰æ‹©åˆ›å»ºè‡ªå·±çš„å‡½æ•°æ¥æ··æ´—å’Œåˆ†å‰²æ•°æ®é›†**ï¼Œè€Œä¸æ˜¯ä½¿ç”¨ä¸€ä¸ªå·²ç»å¯ç”¨çš„å‡½æ•°[(å¦‚ sklearn çš„ train_test_split](http://scikit-learn.org/stable/modules/generated/sklearn.model_selection.train_test_split.html) )ã€‚

> ***ç„¶è€Œï¼Œä½ åœ¨ä¸çŸ¥ä¸è§‰ä¸­çŠ¯äº†ä¸€ä¸ªé”™è¯¯ï¼ä¸æ˜¯ä¸€èµ·æ··æ´—è®­ç»ƒé›†(X)å’Œå®ƒä»¬çš„æ ‡ç­¾(Y ),è€Œæ˜¯ç‹¬ç«‹åœ°æ··æ´—å®ƒä»¬ï¼Œå› æ­¤ä½ æŠŠæ‰€æœ‰çš„æ ‡ç­¾(Y)éƒ½æ··åœ¨ä¸€èµ·äº†ã€‚***

ä½ æŠŠæ ‡ç­¾å¼„ä¹±äº†ï¼ä½†æ—¢ç„¶ä½ è¿˜ä¸çŸ¥é“ï¼Œä½ å°±å¼€å§‹è®­ç»ƒå§ã€‚å› ä¸ºå¥å­çš„çœŸå®æ€§è´¨å’Œå®ƒçš„æ ‡ç­¾ä¹‹é—´æ²¡æœ‰çœŸæ­£çš„å…³ç³»ï¼Œæ‰€ä»¥è®­ç»ƒä¼šä¸€å¡Œç³Šæ¶‚ï¼Œå¯¹å—ï¼Ÿå¯¹å—ï¼Ÿ

ä¸æˆ‘ä»¬é¢„æœŸçš„ç›¸åï¼Œä¹ä¸€çœ‹ï¼Œå®ƒå¹¶ä¸åƒæ˜¯ä¸€ç‰‡æ··ä¹±:

![](img/af547f8226d00f7954ebc71db2cfc77e.png)

å¦‚ä½ æ‰€è§ï¼Œ10 ä¸ªæ—¶æœŸå’Œè¶…è¿‡ 1 å°æ—¶çš„è®­ç»ƒå·²ç»è¿‡å»ï¼ŒæŸå¤±(æŸå¤±:0.3721)æ­£åœ¨å‡å°‘ï¼Œå¹¶ä¸”è®­ç»ƒé›†ä¸Šçš„å‡†ç¡®åº¦å·²ç»ç¨³å®šåœ°å¢åŠ åˆ° 80% (acc: 0.8067)ï¼å‘ç”Ÿäº†ä»€ä¹ˆäº‹ï¼Ÿ

ä½¿ç”¨ä¸€ä¸ªç›¸å½“å¤æ‚çš„ç½‘ç»œæ¶æ„ï¼Œç‰¹åˆ«æ˜¯æ²¡æœ‰æ­£åˆ™åŒ–(åƒåœ¨è¿™ç§æƒ…å†µä¸‹)ï¼Œ**è®­ç»ƒå°†èƒ½å¤Ÿé€‚åº”è°ƒæ•´åˆ°ä¾‹å­çš„ç»†èŠ‚ä»¥åŠå®ƒä»¬çš„å™ªå£°**ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œç”±äºæ ‡ç­¾æ˜¯æ··æ·†çš„ï¼Œè®­ç»ƒé›†ä¸»è¦æ˜¯éšæœºå™ªå£°ï¼Œä¸çŸ¥ä½•æ•…ï¼Œç½‘ç»œä»ç„¶èƒ½å¤Ÿâ€œå­¦ä¹ â€è¿™ç§å™ªå£°çš„ç»†èŠ‚ã€‚

# é‚£ä½ åº”è¯¥æ€ä¹ˆåšï¼Ÿ

å¦‚æœæ‚¨å·²ç»å¼€å§‹äº†ç›¸åŒçš„è®­ç»ƒï¼Œå‘ fit(æˆ– fit_generator)å‡½æ•°å‘é€éªŒè¯æ•°æ®ï¼Œåˆ™æ¯ä¸ªæ—¶æœŸæ‚¨éƒ½ä¼šçœ‹åˆ°**éªŒè¯é›†(val_accï¼Œæœ€åä¸€åˆ—)ä¸Šçš„ç²¾åº¦æ ¹æœ¬æ²¡æœ‰å¢åŠ **ï¼Œè€Œä¸”æŸå¤±(val_loss:)åœ¨å¢åŠ (åœ¨æ—¶æœŸ 10 ç»“æŸæ—¶ä» 0.6935 å¢åŠ åˆ° 1.4955):

![](img/7cdde94ccfc3055c4431e10575c73c72.png)

> æ¯«ä¸å¥‡æ€ªï¼Œå¯¹äºè®­ç»ƒè¿‡ç¨‹ä¸­ä»æœªè§è¿‡çš„ä¾‹å­ï¼Œåˆ†ç±»å™¨ä¸æ¯”æŠ›ç¡¬å¸å¥½ã€‚

å¦‚æœæ‚¨å‘é€éªŒè¯æ•°æ®ï¼Œæ‚¨å°†èƒ½å¤Ÿåœ¨å°‘é‡æ—¶é—´åæ£€æµ‹åˆ°è¿™ç§é—®é¢˜ï¼Œè€Œä¸æ˜¯ç­‰åˆ°åŸ¹è®­ç»“æŸæ—¶æ‰å‘ç°æœ‰é—®é¢˜ã€‚

# æ€ä¹ˆåšï¼Ÿ

è¿™å¾ˆç®€å•ï¼Œå¦‚æœä½ ä½¿ç”¨çš„æ˜¯[**model . fit**](https://keras.io/models/model/)**(æ²¡æœ‰æ•°æ®ç”Ÿæˆå™¨)æœ‰ä¸€ä¸ªå‚æ•°å¯ä»¥ä»è®­ç»ƒé›†ä¸­è‡ªåŠ¨æ‹†åˆ†:**

*   ****validation_split** :åœ¨ 0 å’Œ 1 ä¹‹é—´æµ®åŠ¨ã€‚ç”¨ä½œéªŒè¯æ•°æ®çš„è®­ç»ƒæ•°æ®éƒ¨åˆ†ã€‚è¯¥æ¨¡å‹å°†æŠŠè¿™éƒ¨åˆ†è®­ç»ƒæ•°æ®åˆ†å¼€ï¼Œä¸åœ¨å…¶ä¸Šè®­ç»ƒï¼Œå¹¶ä¸”å°†åœ¨æ¯ä¸ªæ—¶æœŸç»“æŸæ—¶è¯„ä¼°è¯¥æ•°æ®çš„æŸå¤±å’Œä»»ä½•æ¨¡å‹åº¦é‡ã€‚åœ¨æ´—ç‰Œä¹‹å‰ï¼Œä»æä¾›çš„`x`å’Œ`y`æ•°æ®çš„æœ€åæ ·æœ¬ä¸­é€‰æ‹©éªŒè¯æ•°æ®ã€‚**

**å¦ä¸€æ–¹é¢ï¼Œä½¿ç”¨ **model.fit_generator** ï¼Œæ‚¨å°†éœ€è¦å‘é€å¸¦æœ‰ä»¥ä¸‹å‚æ•°çš„éªŒè¯æ•°æ®æˆ–æ•°æ®ç”Ÿæˆå™¨:**

*   ****validation_data** :å¯ä»¥æ˜¯**

1.  **éªŒè¯æ•°æ®çš„ç”Ÿæˆå™¨æˆ–`Sequence`å¯¹è±¡**
2.  **å…ƒç»„`(x_val, y_val)`**
3.  **å…ƒç»„`(x_val, y_val, val_sample_weights)`**

**åœ¨æ¯ä¸ªæ—¶æœŸç»“æŸæ—¶åœ¨å…¶ä¸Šè¯„ä¼°æŸå¤±å’Œä»»ä½•æ¨¡å‹åº¦é‡ã€‚è¯¥æ¨¡å‹ä¸ä¼šæ ¹æ®æ­¤æ•°æ®è¿›è¡Œè®­ç»ƒã€‚**

*   ****éªŒè¯ _ æ­¥éª¤**:ä»…å½“`validation_data`ä¸ºå‘ç”µæœºæ—¶ç›¸å…³ã€‚åœ¨æ¯ä¸ªæ—¶æœŸç»“æŸæ—¶åœæ­¢ä¹‹å‰ï¼Œä»`validation_data`å‘ç”Ÿå™¨äº§ç”Ÿçš„æ€»æ­¥éª¤æ•°(æ ·å“æ‰¹æ¬¡)ã€‚å®ƒé€šå¸¸åº”ç­‰äºè®¤è¯æ•°æ®é›†çš„æ ·æœ¬æ•°é™¤ä»¥æ‰¹æ¬¡å¤§å°ã€‚`Sequence`å¯é€‰:å¦‚æœæœªæŒ‡å®šï¼Œå°†ä½¿ç”¨`len(validation_data)`ä½œä¸ºæ­¥æ•°ã€‚**

# **æ›´å¤šä¿¡æ¯:**

*   **[https://keras.io/models/sequential/](https://keras.io/models/sequential/)**
*   **[https://machine learning mastery . com/over fitting-and-under fitting-with-machine-learning-algorithms/](https://machinelearningmastery.com/overfitting-and-underfitting-with-machine-learning-algorithms/)**
*   **[http://sci kit-learn . org/stable/modules/generated/sk learn . model _ selection . train _ test _ split . html](http://scikit-learn.org/stable/modules/generated/sklearn.model_selection.train_test_split.html)**
*   **[https://Stanford . edu/~ sher vine/blog/keras-how-to-generate-data-on-the-fly . html](https://stanford.edu/~shervine/blog/keras-how-to-generate-data-on-the-fly.html)**