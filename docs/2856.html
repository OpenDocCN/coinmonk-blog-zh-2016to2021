<html>
<head>
<title>How to build a dapp on a private Ethereum network : Part — 3</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在私有以太网上构建dapp:第3部分</h1>
<blockquote>原文：<a href="https://medium.com/coinmonks/how-to-build-a-dapp-on-a-private-ethereum-network-part-3-31066fedf7a1?source=collection_archive---------0-----------------------#2020-03-22">https://medium.com/coinmonks/how-to-build-a-dapp-on-a-private-ethereum-network-part-3-31066fedf7a1?source=collection_archive---------0-----------------------#2020-03-22</a></blockquote><div><div class="ef hh hi hj hk hl"/><div class="hm hn ho hp hq"><div class=""/><blockquote class="iq ir is"><p id="12a1" class="it iu iv iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hm dt translated">这是一个由5篇文章组成的系列，介绍如何在2个私有以太坊节点的网络上开发一个去中心化的应用程序(dapp ),而无需使用任何第三方API或应用程序(如Infura、MetaMask等)。).本教程涵盖了我在CSIR-CEERI的研究项目中所学到的基本要素。</p><p id="8cf9" class="it iu iv iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hm dt translated">我已经在第1部分和第2部分中介绍了第1-4节。如果你感到失落，你可以通读前2部分，它们的链接在本文底部的<strong class="iw hu">所有系列链接</strong>部分提到。</p></blockquote></div><div class="ab cl js jt hb ju" role="separator"><span class="jv bw bk jw jx jy"/><span class="jv bw bk jw jx jy"/><span class="jv bw bk jw jx"/></div><div class="hm hn ho hp hq"><blockquote class="jz"><p id="1f3f" class="ka kb ht bd kc kd ke kf kg kh ki jr ek translated">最近发布—“<a class="ae kj" rel="noopener" href="/@themadhackerOI/how-to-build-a-dapp-on-a-private-ethereum-network-part-5-84177d5717be">第5部分:第VIII-IX节</a></p></blockquote></div><div class="ab cl js jt hb ju" role="separator"><span class="jv bw bk jw jx jy"/><span class="jv bw bk jw jx jy"/><span class="jv bw bk jw jx"/></div><div class="hm hn ho hp hq"><h1 id="057a" class="kk kl ht bd km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh dt translated">目录</h1><p id="aaa2" class="pw-post-body-paragraph it iu ht iw b ix li iz ja jb lj jd je lk ll jh ji lm ln jl jm lo lp jp jq jr hm dt translated">在这里，您可以找到我将本教程分成的部分和子部分的列表:</p><p id="4241" class="pw-post-body-paragraph it iu ht iw b ix iy iz ja jb jc jd je lk jg jh ji lm jk jl jm lo jo jp jq jr hm dt translated">一.创建项目</p><p id="ae33" class="pw-post-body-paragraph it iu ht iw b ix iy iz ja jb jc jd je lk jg jh ji lm jk jl jm lo jo jp jq jr hm dt translated">二。安装先决条件</p><p id="560d" class="pw-post-body-paragraph it iu ht iw b ix iy iz ja jb jc jd je lk jg jh ji lm jk jl jm lo jo jp jq jr hm dt translated">三。配置网络</p><p id="a32d" class="pw-post-body-paragraph it iu ht iw b ix iy iz ja jb jc jd je lk jg jh ji lm jk jl jm lo jo jp jq jr hm dt translated">四。设计智能合同</p><p id="a33b" class="pw-post-body-paragraph it iu ht iw b ix iy iz ja jb jc jd je lk jg jh ji lm jk jl jm lo jo jp jq jr hm dt translated"><strong class="iw hu"> →五、松露项目立项</strong></p><p id="5993" class="pw-post-body-paragraph it iu ht iw b ix iy iz ja jb jc jd je lk jg jh ji lm jk jl jm lo jo jp jq jr hm dt translated"><strong class="iw hu"> →六。启动网络</strong></p><p id="f16f" class="pw-post-body-paragraph it iu ht iw b ix iy iz ja jb jc jd je lk jg jh ji lm jk jl jm lo jo jp jq jr hm dt translated">七。构建web应用程序</p><p id="d793" class="pw-post-body-paragraph it iu ht iw b ix iy iz ja jb jc jd je lk jg jh ji lm jk jl jm lo jo jp jq jr hm dt translated">八。测试dapp</p><p id="219c" class="pw-post-body-paragraph it iu ht iw b ix iy iz ja jb jc jd je lk jg jh ji lm jk jl jm lo jo jp jq jr hm dt translated">九。修改dapp</p><p id="5f9f" class="pw-post-body-paragraph it iu ht iw b ix iy iz ja jb jc jd je lk jg jh ji lm jk jl jm lo jo jp jq jr hm dt translated">如果您想跳到某一部分，您可以向下滚动到本文末尾的<strong class="iw hu">所有系列链接</strong>部分。</p></div><div class="ab cl js jt hb ju" role="separator"><span class="jv bw bk jw jx jy"/><span class="jv bw bk jw jx jy"/><span class="jv bw bk jw jx"/></div><div class="hm hn ho hp hq"><p id="64da" class="pw-post-body-paragraph it iu ht iw b ix iy iz ja jb jc jd je lk jg jh ji lm jk jl jm lo jo jp jq jr hm dt translated">这一部分将涵盖第V-VI节，向您介绍Truffle并展示如何配置一个包含两个节点的私有以太网。这是dapp开发中极其重要的部分，在这里许多人犹豫不决并倾向于放弃。和我在一起，对你来说会很容易。</p><h1 id="6698" class="kk kl ht bd km kn lq kp kq kr lr kt ku kv ls kx ky kz lt lb lc ld lu lf lg lh dt translated">动词 （verb的缩写）建立松露项目</h1><p id="618f" class="pw-post-body-paragraph it iu ht iw b ix li iz ja jb lj jd je lk ll jh ji lm ln jl jm lo lp jp jq jr hm dt translated">Truffle是以太坊<a class="ae kj" href="https://blog.coincodecap.com/tag/ethereum/" rel="noopener ugc nofollow" target="_blank">以太坊</a>以太坊<a class="ae kj" href="https://blog.coincodecap.com/tag/dapps/" rel="noopener ugc nofollow" target="_blank"> dapps </a>的开发环境和测试框架，可以轻松集成dapp的所有组件。它充当包装器，负责后台进程。这使得开发人员可以专注于用例的实现。</p><ul class=""><li id="74ca" class="lv lw ht iw b ix iy jb jc lk lx lm ly lo lz jr ma mb mc md dt translated">离开我们从第1部分开始就一直在使用的<code class="eh me mf mg mh b">TruffleDapp</code>存储库。要导航到主页，打开一个终端并运行<code class="eh me mf mg mh b">$ cd ~</code>，或者导航到父目录，运行<code class="eh me mf mg mh b">$ cd ./..</code></li><li id="a4c8" class="lv lw ht iw b ix mi jb mj lk mk lm ml lo mm jr ma mb mc md dt translated"><code class="eh me mf mg mh b">truffle init</code>命令要求在运行该命令之前，存储库必须完全清空。要创建一个Truffle项目，运行:</li></ul><pre class="mn mo mp mq fq mr mh ms mt aw mu dt"><span id="6d33" class="mv kl ht mh b fv mw mx l my mz">$ mkdir Temp<br/>$ cd Temp<br/>$ truffle init</span></pre><ul class=""><li id="cb8c" class="lv lw ht iw b ix iy jb jc lk lx lm ly lo lz jr ma mb mc md dt translated">将<code class="eh me mf mg mh b">Temp</code>中的所有文件和文件夹移动并粘贴到<code class="eh me mf mg mh b">TruffleDapp</code>。现在可以删除<code class="eh me mf mg mh b">Temp</code>目录了。</li><li id="5b0d" class="lv lw ht iw b ix mi jb mj lk mk lm ml lo mm jr ma mb mc md dt translated">在<code class="eh me mf mg mh b">TruffeDapp</code>目录中，运行:</li></ul><pre class="mn mo mp mq fq mr mh ms mt aw mu dt"><span id="d74f" class="mv kl ht mh b fv mw mx l my mz">$ truffle create contract helloworld</span></pre><ul class=""><li id="faab" class="lv lw ht iw b ix iy jb jc lk lx lm ly lo lz jr ma mb mc md dt translated">这将在<code class="eh me mf mg mh b">contracts</code>文件夹中创建一个<a class="ae kj" href="https://blog.coincodecap.com/tag/smart-contact/" rel="noopener ugc nofollow" target="_blank">智能合同</a> <code class="eh me mf mg mh b">helloworld.sol</code>(在运行<code class="eh me mf mg mh b">truffle init</code>后创建)。用在RemixIDE中创建的合同代码替换其中的代码<code class="eh me mf mg mh b">helloworld.sol</code>。</li><li id="a5f8" class="lv lw ht iw b ix mi jb mj lk mk lm ml lo mm jr ma mb mc md dt translated">若要编译协定，请运行以下命令。默认情况下，这个过程的输出是<code class="eh me mf mg mh b">build/contracts/helloworld.json</code>文件:</li></ul><pre class="mn mo mp mq fq mr mh ms mt aw mu dt"><span id="d62c" class="mv kl ht mh b fv mw mx l my mz">$ truffle compile</span></pre><ul class=""><li id="1bda" class="lv lw ht iw b ix iy jb jc lk lx lm ly lo lz jr ma mb mc md dt translated">使用以下命令创建迁移文件:</li></ul><pre class="mn mo mp mq fq mr mh ms mt aw mu dt"><span id="60f9" class="mv kl ht mh b fv mw mx l my mz">$ truffle create migration <!-- -->HelloWorld</span></pre><p id="c9b9" class="pw-post-body-paragraph it iu ht iw b ix iy iz ja jb jc jd je lk jg jh ji lm jk jl jm lo jo jp jq jr hm dt translated">这将在<code class="eh me mf mg mh b">migrations</code>文件夹中添加<code class="eh me mf mg mh b">xx_helloworld.js</code>文件(<code class="eh me mf mg mh b">xx</code>是某个整数)。将该文件重命名为<code class="eh me mf mg mh b">2_helloworld.js</code>。然后，打开该文件并更新以下内容:</p><pre class="mn mo mp mq fq mr mh ms mt aw mu dt"><span id="1117" class="mv kl ht mh b fv mw mx l my mz">var hw = artifacts.require("HelloWorld");<br/>module.exports = function(deployer) {<br/>  deployer.deploy(hw);<br/>};</span></pre></div><div class="ab cl js jt hb ju" role="separator"><span class="jv bw bk jw jx jy"/><span class="jv bw bk jw jx jy"/><span class="jv bw bk jw jx"/></div><div class="hm hn ho hp hq"><figure class="mn mo mp mq fq nb fe ff paragraph-image"><div class="fe ff na"><img src="../Images/f3eba086364a6518ba90f2391ee7ea6f.png" data-original-src="https://miro.medium.com/v2/resize:fit:532/format:webp/1*JuFwPlYlfIL44XRqhT_l1A.jpeg"/></div></figure><p id="c437" class="pw-post-body-paragraph it iu ht iw b ix iy iz ja jb jc jd je lk jg jh ji lm jk jl jm lo jo jp jq jr hm dt translated">是的，你的项目代表了你。它们是你工作的鲜活记忆</p><blockquote class="jz"><p id="9586" class="ka kb ht bd kc kd ke kf kg kh ki jr ek translated">“一个被放弃的项目只是一个失去的机会”</p></blockquote><p id="f365" class="pw-post-body-paragraph it iu ht iw b ix ne iz ja jb nf jd je lk ng jh ji lm nh jl jm lo ni jp jq jr hm dt translated">你已经走了很远。相信我，只要你坚持下去，你就会攀上许多人未能到达的顶峰。</p><h1 id="8040" class="kk kl ht bd km kn lq kp kq kr lr kt ku kv ls kx ky kz lt lb lc ld lu lf lg lh dt translated">不及物动词启动网络</h1><p id="8622" class="pw-post-body-paragraph it iu ht iw b ix li iz ja jb lj jd je lk ll jh ji lm ln jl jm lo lp jp jq jr hm dt translated">本节说明了构成网络的节点，dapp在该网络上执行。可以使用以下3种模式之一启动网络:</p><ol class=""><li id="53f9" class="lv lw ht iw b ix iy jb jc lk lx lm ly lo lz jr nj mb mc md dt translated">默认块菌构造</li><li id="c9c9" class="lv lw ht iw b ix mi jb mj lk mk lm ml lo mm jr nj mb mc md dt translated">改良的松露装置</li><li id="fbc6" class="lv lw ht iw b ix mi jb mj lk mk lm ml lo mm jr nj mb mc md dt translated">手动配置的专用网络<em class="iv">(此处使用)</em></li></ol><p id="c25d" class="pw-post-body-paragraph it iu ht iw b ix iy iz ja jb jc jd je lk jg jh ji lm jk jl jm lo jo jp jq jr hm dt translated">你可以直接跳到第三部分。我已经为好奇的头脑提供了前两个。</p><h2 id="58bd" class="mv kl ht bd km nk nl nm kq nn no np ku lk nq nr ky lm ns nt lc lo nu nv lg nw dt translated">1.默认块菌构造</h2><p id="8dc7" class="pw-post-body-paragraph it iu ht iw b ix li iz ja jb lj jd je lk ll jh ji lm ln jl jm lo lp jp jq jr hm dt translated">Truffle提供了一个选项，可以通过一个命令使用内置的开发区块链。这可以通过在终端中键入以下命令来实现:</p><pre class="mn mo mp mq fq mr mh ms mt aw mu dt"><span id="f2bf" class="mv kl ht mh b fv mw mx l my mz">$ truffle develop</span></pre><p id="cb81" class="pw-post-body-paragraph it iu ht iw b ix iy iz ja jb jc jd je lk jg jh ji lm jk jl jm lo jo jp jq jr hm dt translated">这将在<a class="ae kj" href="http://127.0.0.1:9545/" rel="noopener ugc nofollow" target="_blank"> http://127.0.0.1:9545 </a>上运行客户端。它将显示前10个帐户和用于创建这些帐户的助记符。</p><h2 id="fedb" class="mv kl ht bd km nk nl nm kq nn no np ku lk nq nr ky lm ns nt lc lo nu nv lg nw dt translated">2.改良的松露装置</h2><ul class=""><li id="9f48" class="lv lw ht iw b ix li jb lj lk nx lm ny lo nz jr ma mb mc md dt translated">要在truffle环境中本地测试契约，编辑<code class="eh me mf mg mh b">TruffleDapp/truffle-config.js</code>文件以包含:</li></ul><pre class="mn mo mp mq fq mr mh ms mt aw mu dt"><span id="6840" class="mv kl ht mh b fv mw mx l my mz">module.exports = {<br/>  networks: {<br/>    "development": {<br/>      network_id: "*",<br/>      host: "127.0.0.1",<br/>      port: 9545<br/>    },<br/>  }<br/>};</span></pre><p id="c9ad" class="pw-post-body-paragraph it iu ht iw b ix iy iz ja jb jc jd je lk jg jh ji lm jk jl jm lo jo jp jq jr hm dt translated">这为Truffle网络(运行在沙盒环境中)配置了主机和端口。它可用于测试契约是否已被正确部署。</p><ul class=""><li id="7dd4" class="lv lw ht iw b ix iy jb jc lk lx lm ly lo lz jr ma mb mc md dt translated">当契约被部署到Truffle“开发”网络时，<code class="eh me mf mg mh b">1_initial_migration.js</code>首先被迁移，然后是<code class="eh me mf mg mh b">2_helloworld.js</code>。打开一个新的终端，在<code class="eh me mf mg mh b">TruffleDapp</code>目录下运行:</li></ul><pre class="mn mo mp mq fq mr mh ms mt aw mu dt"><span id="1ce5" class="mv kl ht mh b fv mw mx l my mz">$ truffle migrate</span></pre><ul class=""><li id="da9c" class="lv lw ht iw b ix iy jb jc lk lx lm ly lo lz jr ma mb mc md dt translated">要测试合约，请打开一个控制台与Truffle网络进行交互(通过部署的智能合约),并在新的终端中运行:</li></ul><pre class="mn mo mp mq fq mr mh ms mt aw mu dt"><span id="121a" class="mv kl ht mh b fv mw mx l my mz">$ truffle console</span></pre><p id="4cfd" class="pw-post-body-paragraph it iu ht iw b ix iy iz ja jb jc jd je lk jg jh ji lm jk jl jm lo jo jp jq jr hm dt translated">现在，您可以在这个控制台中运行命令，与Truffle网络进行交互。</p><figure class="mn mo mp mq fq nb fe ff paragraph-image"><div class="fe ff oa"><img src="../Images/b053c8628a97fd1823ae36ed4d8c63e4.png" data-original-src="https://miro.medium.com/v2/resize:fit:736/format:webp/1*KbuT0ofNkNdQypxZ_Pu2_A.jpeg"/></div><figcaption class="ob oc fg fe ff od oe bd b be z ek">Pikachu saves the day!</figcaption></figure><h2 id="b323" class="mv kl ht bd km nk nl nm kq nn no np ku lk nq nr ky lm ns nt lc lo nu nv lg nw dt translated">3.手动配置的专用网络</h2><p id="6809" class="pw-post-body-paragraph it iu ht iw b ix li iz ja jb lj jd je lk ll jh ji lm ln jl jm lo lp jp jq jr hm dt translated">这是我将在本系列教程中使用的模式。</p><p id="66bf" class="pw-post-body-paragraph it iu ht iw b ix iy iz ja jb jc jd je lk jg jh ji lm jk jl jm lo jo jp jq jr hm dt translated"><strong class="iw hu"> 1a)创建节点-1 </strong></p><p id="8b68" class="pw-post-body-paragraph it iu ht iw b ix iy iz ja jb jc jd je lk jg jh ji lm jk jl jm lo jo jp jq jr hm dt translated">这些说明仅用于创建<strong class="iw hu"> <em class="iv">的第一个节点</em> </strong>。创建其他节点(在多节点网络中)的步骤类似，但有一些关键区别。</p><ul class=""><li id="1c80" class="lv lw ht iw b ix iy jb jc lk lx lm ly lo lz jr ma mb mc md dt translated">需要一个存储库来存储节点和链数据的公钥和私钥。该节点由<code class="eh me mf mg mh b">./customGenesis.json</code>初始化。在新的终端窗口中运行(T1):</li></ul><pre class="mn mo mp mq fq mr mh ms mt aw mu dt"><span id="a1b5" class="mv kl ht mh b fv mw mx l my mz">$ geth --datadir "./Node1" init ./customGenesis.json</span></pre><figure class="mn mo mp mq fq nb fe ff paragraph-image"><div role="button" tabindex="0" class="og oh di oi bf oj"><div class="fe ff of"><img src="../Images/de6e11149e45d247459f4c53c0f6953b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*uGRNIgCaRRiTemZ1gDuZJg.png"/></div></div></figure><ul class=""><li id="5c6f" class="lv lw ht iw b ix iy jb jc lk lx lm ly lo lz jr ma mb mc md dt translated">要将该节点连接到该节点所属网络的各种参数，请在T1中运行:</li></ul><pre class="mn mo mp mq fq mr mh ms mt aw mu dt"><span id="8aee" class="mv kl ht mh b fv mw mx l my mz">$ geth --datadir "./Node1" --networkid 1999 --identity "testNet" --rpc --rpcvhosts "*" --rpcport "8081" --rpccorsdomain "*" --rpcaddr 127.0.0.1 --rpcapi "db,eth,net,web3,personal,miner,admin" --port "30301"</span></pre><figure class="mn mo mp mq fq nb fe ff paragraph-image"><div role="button" tabindex="0" class="og oh di oi bf oj"><div class="fe ff ok"><img src="../Images/d58c6e86418a528a1de951529b504945.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hNBWpw55mir7CuJ9P4e1bA.png"/></div></div></figure><p id="8fcf" class="pw-post-body-paragraph it iu ht iw b ix iy iz ja jb jc jd je lk jg jh ji lm jk jl jm lo jo jp jq jr hm dt translated"><strong class="iw hu"> <em class="iv">注:</em> </strong>这个剥离一个节点，在T1中显示节点信息。显示的一个这样的属性是<code class="eh me mf mg mh b">self</code>。<code class="eh me mf mg mh b">self</code>的字符串值稍后用于连接Node-1。</p><ul class=""><li id="2c50" class="lv lw ht iw b ix iy jb jc lk lx lm ly lo lz jr ma mb mc md dt translated">在一个新的终端(T2)，运行<code class="eh me mf mg mh b">$ geth attach <a class="ae kj" href="http://127.0.0.1:8081" rel="noopener ugc nofollow" target="_blank">http://127.0.0.1:8081</a></code>打开一个端口连接到Node-1。</li><li id="448b" class="lv lw ht iw b ix mi jb mj lk mk lm ml lo mm jr ma mb mc md dt translated">任何节点(用户)在以太坊环境中访问和操作，都要求它们包含一定量的以太来支付gas作为交易成本。因此，有必要在网络上创建一个帐户来存储以太网。要创建密码为“seed 1”的帐户，请在T2运行:</li></ul><pre class="mn mo mp mq fq mr mh ms mt aw mu dt"><span id="6985" class="mv kl ht mh b fv mw mx l my mz">&gt; personal.newAccount("seed 1")</span></pre><ul class=""><li id="d804" class="lv lw ht iw b ix iy jb jc lk lx lm ly lo lz jr ma mb mc md dt translated">存放采矿奖励(以太)的以太坊账户称为<code class="eh me mf mg mh b">eth.coinbase</code>，默认值为<code class="eh me mf mg mh b">eth.accounts[0]</code></li></ul><figure class="mn mo mp mq fq nb fe ff paragraph-image"><div class="fe ff ol"><img src="../Images/55bd7eeaa1eb5fdc221614e07dd9855b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1358/format:webp/1*VaRdlGCt8k3DSi0mOP7k0g.png"/></div><figcaption class="ob oc fg fe ff od oe bd b be z ek"><code class="eh me mf mg mh b">"ACCOUNT_ADDRESS" is the hexadecimal string highlighted by the red rectangle</code></figcaption></figure><p id="953b" class="pw-post-body-paragraph it iu ht iw b ix iy iz ja jb jc jd je lk jg jh ji lm jk jl jm lo jo jp jq jr hm dt translated"><strong class="iw hu"> <em class="iv">注:</em> </strong>这个返回一个账户地址<code class="eh me mf mg mh b">ACCOUNT_ADDRESS</code>，后来复制到<code class="eh me mf mg mh b">truffle-config.js</code>。</p><ul class=""><li id="c3d2" class="lv lw ht iw b ix iy jb jc lk lx lm ly lo lz jr ma mb mc md dt translated">要使用之前创建的帐户，需要使用创建时输入的相同密码解锁<em class="iv">(见下图)</em>。</li></ul><pre class="mn mo mp mq fq mr mh ms mt aw mu dt"><span id="b035" class="mv kl ht mh b fv mw mx l my mz">&gt; personal.unlockAccount(web3.eth.accounts[0], "seed 1", 15000)<br/>&gt; eth.defaultAccount = eth.accounts[0]</span></pre><p id="a261" class="pw-post-body-paragraph it iu ht iw b ix iy iz ja jb jc jd je lk jg jh ji lm jk jl jm lo jo jp jq jr hm dt translated">当您发送交易时，<code class="eh me mf mg mh b">eth.defaultAccount</code>是<code class="eh me mf mg mh b">from</code>字段的默认账户输入，即如果您发送交易且未指定<code class="eh me mf mg mh b">from</code>字段，将使用<code class="eh me mf mg mh b">eth.defaultAccount</code>的值(如果之前已设置)。</p><figure class="mn mo mp mq fq nb fe ff paragraph-image"><div class="fe ff om"><img src="../Images/ce5e1e0d0f1e7c3c39b702aefaafe403.png" data-original-src="https://miro.medium.com/v2/resize:fit:1142/format:webp/1*BDPeWzlMBHvrqEcuh7pRRA.png"/></div></figure><ul class=""><li id="bd18" class="lv lw ht iw b ix iy jb jc lk lx lm ly lo lz jr ma mb mc md dt translated">这里，<code class="eh me mf mg mh b">eth.coinbase</code>被设置，并且挖掘过程在单个线程上启动。单线程挖掘是最安全的选择，因为否则会有系统冻结的风险。我们可能会在一个计算能力更高的系统中使用&gt; 1线程<em class="iv">(见上图)</em>。</li></ul><pre class="mn mo mp mq fq mr mh ms mt aw mu dt"><span id="b17b" class="mv kl ht mh b fv mw mx l my mz">&gt; miner.setEtherbase(eth.accounts[0])<br/>&gt; miner.start(1)</span></pre><ul class=""><li id="417e" class="lv lw ht iw b ix iy jb jc lk lx lm ly lo lz jr ma mb mc md dt translated">当消息<code class="eh me mf mg mh b">Commit new mining work</code>在T1显示时，暗示挖掘已经在节点-1启动。</li></ul><p id="ad12" class="pw-post-body-paragraph it iu ht iw b ix iy iz ja jb jc jd je lk jg jh ji lm jk jl jm lo jo jp jq jr hm dt translated"><strong class="iw hu"> <em class="iv">注意:</em> </strong>这3条指令对这里创建的所有节点都是通用的:</p><ul class=""><li id="b8b1" class="lv lw ht iw b ix iy jb jc lk lx lm ly lo lz jr ma mb mc md dt translated">要在节点1停止挖掘过程，请在T2控制台中键入<code class="eh me mf mg mh b">&gt; miner.stop()</code></li><li id="6dce" class="lv lw ht iw b ix mi jb mj lk mk lm ml lo mm jr ma mb mc md dt translated">要退出T2的控制台，请在此控制台中键入<code class="eh me mf mg mh b">&gt; exit</code></li><li id="c4db" class="lv lw ht iw b ix mi jb mj lk mk lm ml lo mm jr ma mb mc md dt translated">要退出T1中的控制台，导航到T1的选项卡并按下<code class="eh me mf mg mh b">Ctrl + C</code></li></ul><p id="b3de" class="pw-post-body-paragraph it iu ht iw b ix iy iz ja jb jc jd je lk jg jh ji lm jk jl jm lo jo jp jq jr hm dt translated"><strong class="iw hu"> 1b)重启节点-1 </strong></p><p id="be5c" class="pw-post-body-paragraph it iu ht iw b ix iy iz ja jb jc jd je lk jg jh ji lm jk jl jm lo jo jp jq jr hm dt translated">创建后，执行以下命令重新启动节点1:</p><ul class=""><li id="9479" class="lv lw ht iw b ix iy jb jc lk lx lm ly lo lz jr ma mb mc md dt translated">打开一个新的终端窗口(T1)并运行:</li></ul><pre class="mn mo mp mq fq mr mh ms mt aw mu dt"><span id="1d8a" class="mv kl ht mh b fv mw mx l my mz">$ geth --datadir "./Node1" --networkid 1999 --identity "testNet" --rpc --rpcvhosts "*" --rpcport "8081" --rpccorsdomain "*" --rpcaddr 127.0.0.1 --rpcapi "db,eth,net,web3,personal,miner,admin" --port "30301"</span></pre><ul class=""><li id="cfe2" class="lv lw ht iw b ix iy jb jc lk lx lm ly lo lz jr ma mb mc md dt translated">在另一个终端窗口(T2)中，运行:</li></ul><pre class="mn mo mp mq fq mr mh ms mt aw mu dt"><span id="0761" class="mv kl ht mh b fv mw mx l my mz">$ geth attach <a class="ae kj" href="http://127.0.0.1:8081" rel="noopener ugc nofollow" target="_blank">http://127.0.0.1:8081</a></span></pre><ul class=""><li id="4007" class="lv lw ht iw b ix iy jb jc lk lx lm ly lo lz jr ma mb mc md dt translated">在T2打开的控制台中，键入:</li></ul><pre class="mn mo mp mq fq mr mh ms mt aw mu dt"><span id="5cb7" class="mv kl ht mh b fv mw mx l my mz">&gt; personal.unlockAccount(web3.eth.coinbase, "seed 1", 15000)<br/>&gt; eth.defaultAccount = eth.accounts[0]<br/>&gt; miner.start(1)</span></pre><p id="0bee" class="pw-post-body-paragraph it iu ht iw b ix iy iz ja jb jc jd je lk jg jh ji lm jk jl jm lo jo jp jq jr hm dt translated"><strong class="iw hu"> 2a)创建节点-2 </strong></p><p id="e034" class="pw-post-body-paragraph it iu ht iw b ix iy iz ja jb jc jd je lk jg jh ji lm jk jl jm lo jo jp jq jr hm dt translated">要创建节点2，请按照给定的步骤操作:</p><ul class=""><li id="7d82" class="lv lw ht iw b ix iy jb jc lk lx lm ly lo lz jr ma mb mc md dt translated">打开一个新的终端窗口(T1)并运行:</li></ul><pre class="mn mo mp mq fq mr mh ms mt aw mu dt"><span id="0648" class="mv kl ht mh b fv mw mx l my mz">$ geth --datadir "./Node2" init ./customGenesis.json</span><span id="62b6" class="mv kl ht mh b fv on mx l my mz">$ geth --datadir "./Node2" --networkid 1999 --identity "testNet" --rpc --rpcvhosts "*" --rpcport "8082" --rpccorsdomain "*" --rpcaddr 127.0.0.1 --rpcapi "db,eth,net,web3,personal,miner,admin" --port "30302"</span></pre><ul class=""><li id="460a" class="lv lw ht iw b ix iy jb jc lk lx lm ly lo lz jr ma mb mc md dt translated">在另一个终端窗口(T2)中，运行:</li></ul><pre class="mn mo mp mq fq mr mh ms mt aw mu dt"><span id="1700" class="mv kl ht mh b fv mw mx l my mz">$ geth attach <a class="ae kj" href="http://127.0.0.1:8082" rel="noopener ugc nofollow" target="_blank">http://127.0.0.1:8082</a></span></pre><ul class=""><li id="8212" class="lv lw ht iw b ix iy jb jc lk lx lm ly lo lz jr ma mb mc md dt translated">在T2打开的控制台中，键入:</li></ul><pre class="mn mo mp mq fq mr mh ms mt aw mu dt"><span id="48f2" class="mv kl ht mh b fv mw mx l my mz">&gt; personal.newAccount("seed 2")<br/>&gt; personal.unlockAccount(web3.eth.coinbase, "seed 2", 15000)<br/>&gt; eth.defaultAccount = eth.accounts[0]<br/>&gt;<br/>&gt; miner.setEtherbase(eth.accounts[0])<br/>&gt; miner.start(1)</span></pre><ul class=""><li id="eb9f" class="lv lw ht iw b ix iy jb jc lk lx lm ly lo lz jr ma mb mc md dt translated">到目前为止，已经创建了一个节点(Node-2 ),其网络配置与Node-1相同，但是这两个节点之间尚未建立连接。除非这样做，否则该设置将仅由2个<em class="iv">独立节点</em>组成，而不是所需的<em class="iv">网络</em>。</li></ul><pre class="mn mo mp mq fq mr mh ms mt aw mu dt"><span id="6cfa" class="mv kl ht mh b fv mw mx l my mz">&gt; admin.addPeer("self of Node-1")</span></pre><figure class="mn mo mp mq fq nb fe ff paragraph-image"><div role="button" tabindex="0" class="og oh di oi bf oj"><div class="fe ff oo"><img src="../Images/47475ce651472dfbe203b0e4f66e1207.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-IQWvHA1_zzf-SY0TQakLg.png"/></div></div><figcaption class="ob oc fg fe ff od oe bd b be z ek">“self of Node-1” refers to the string displayed next to the “self” property in T1</figcaption></figure><p id="5133" class="pw-post-body-paragraph it iu ht iw b ix iy iz ja jb jc jd je lk jg jh ji lm jk jl jm lo jo jp jq jr hm dt translated"><code class="eh me mf mg mh b">"self of Node-1"</code>是Node-1的<code class="eh me mf mg mh b">self</code>属性的字符串值，在执行T1中的两个命令后(创建/重启Node-1时)显示在控制台中。将此<code class="eh me mf mg mh b">self</code>值复制粘贴到此处。</p><p id="3674" class="pw-post-body-paragraph it iu ht iw b ix iy iz ja jb jc jd je lk jg jh ji lm jk jl jm lo jo jp jq jr hm dt translated"><strong class="iw hu"> 2b)重新启动节点-2 </strong></p><p id="2454" class="pw-post-body-paragraph it iu ht iw b ix iy iz ja jb jc jd je lk jg jh ji lm jk jl jm lo jo jp jq jr hm dt translated">一旦创建了Node-2，重启它的步骤实际上与Node-1的步骤相同，只是做了一些小的编辑。</p><ul class=""><li id="da16" class="lv lw ht iw b ix iy jb jc lk lx lm ly lo lz jr ma mb mc md dt translated">打开一个新的终端窗口(T1)并运行:</li></ul><pre class="mn mo mp mq fq mr mh ms mt aw mu dt"><span id="86be" class="mv kl ht mh b fv mw mx l my mz">$ geth --datadir "./Node2" --networkid 1999 --identity "testNet" --rpc --rpcvhosts "*" --rpcport "8082" --rpccorsdomain "*" --rpcaddr 127.0.0.1 --rpcapi "db,eth,net,web3,personal,miner,admin" --port "30302"</span></pre><ul class=""><li id="53d0" class="lv lw ht iw b ix iy jb jc lk lx lm ly lo lz jr ma mb mc md dt translated">在另一个终端窗口(T2)中，运行:</li></ul><pre class="mn mo mp mq fq mr mh ms mt aw mu dt"><span id="a2b6" class="mv kl ht mh b fv mw mx l my mz">$ geth attach <a class="ae kj" href="http://127.0.0.1:8082" rel="noopener ugc nofollow" target="_blank">http://127.0.0.1:8082</a></span></pre><ul class=""><li id="a575" class="lv lw ht iw b ix iy jb jc lk lx lm ly lo lz jr ma mb mc md dt translated">在T2打开的控制台中，运行:</li></ul><pre class="mn mo mp mq fq mr mh ms mt aw mu dt"><span id="d310" class="mv kl ht mh b fv mw mx l my mz">&gt; personal.unlockAccount(web3.eth.coinbase, "seed 2", 15000)<br/>&gt; eth.defaultAccount = eth.accounts[0]<br/>&gt; miner.start(1)</span></pre><p id="0692" class="pw-post-body-paragraph it iu ht iw b ix iy iz ja jb jc jd je lk jg jh ji lm jk jl jm lo jo jp jq jr hm dt translated"><strong class="iw hu"> <em class="iv"> Pro-tip : </em> </strong>要创建/重启Node-n，在执行给定步骤后，执行2a/2b中提到的相同命令:</p><ul class=""><li id="4db0" class="lv lw ht iw b ix iy jb jc lk lx lm ly lo lz jr ma mb mc md dt translated">用<code class="eh me mf mg mh b">--rpcport "808n"</code>和<code class="eh me mf mg mh b">--port "3030n"</code>替换<code class="eh me mf mg mh b">--rpcport "8082"</code>和<code class="eh me mf mg mh b">--port "30302"</code>，即对于Node-n是唯一的RPC端口号。</li><li id="c119" class="lv lw ht iw b ix mi jb mj lk mk lm ml lo mm jr ma mb mc md dt translated">用相应的<code class="eh me mf mg mh b">http://127.0.0.1:808n</code>替换<code class="eh me mf mg mh b">http://127.0.0.1:8082</code>，其中<code class="eh me mf mg mh b">808n</code>是传递给<code class="eh me mf mg mh b">--rpcport</code>标志的值(在上一步中)。</li><li id="7f60" class="lv lw ht iw b ix mi jb mj lk mk lm ml lo mm jr ma mb mc md dt translated">将<code class="eh me mf mg mh b">"seed 2"</code>替换为<code class="eh me mf mg mh b">"seed n"</code>，即在Node-n创建的账户所特有的短语。</li><li id="1788" class="lv lw ht iw b ix mi jb mj lk mk lm ml lo mm jr ma mb mc md dt translated">对于Node-n，<code class="eh me mf mg mh b">admin.addPeer("self of Node-i")</code>每个Node-i对应的命令需要在Node-n控制台中单独执行，其中i = 1，2，3，...，n-1</li></ul><p id="ae91" class="pw-post-body-paragraph it iu ht iw b ix iy iz ja jb jc jd je lk jg jh ji lm jk jl jm lo jo jp jq jr hm dt translated"><strong class="iw hu">然而，由于我们的网络只有2个节点，这里使用的方法更简单。</strong></p><p id="e2b4" class="pw-post-body-paragraph it iu ht iw b ix iy iz ja jb jc jd je lk jg jh ji lm jk jl jm lo jo jp jq jr hm dt translated"><strong class="iw hu"> 3)与网络连接</strong></p><p id="2ca0" class="pw-post-body-paragraph it iu ht iw b ix iy iz ja jb jc jd je lk jg jh ji lm jk jl jm lo jo jp jq jr hm dt translated">要将Truffle dapp链接到已启动的网络及其节点，请在编辑器中打开<code class="eh me mf mg mh b">truffle-config.js</code>并将其修改为以下代码，该代码列出了与网络节点(在本例中为Node-1)建立连接所需的配置:</p><pre class="mn mo mp mq fq mr mh ms mt aw mu dt"><span id="94c9" class="mv kl ht mh b fv mw mx l my mz">module.exports = {<br/>  rpc: {<br/>    host: "127.0.0.1",<br/>    port: 8081<br/>  },</span><span id="c202" class="mv kl ht mh b fv on mx l my mz">networks: {<br/>    development: {<br/>      host: "127.0.0.1",<br/>      port: 8081,<br/>      network_id: "1999",<br/>      from: "<!-- -->ACCOUNT_ADDRESS<!-- -->",<br/>      gas: 20000000<br/>    },<br/>  }<br/>}</span></pre><figure class="mn mo mp mq fq nb fe ff paragraph-image"><div class="fe ff op"><img src="../Images/5e1bb4683ee6d91d8259e356ed06409e.png" data-original-src="https://miro.medium.com/v2/resize:fit:824/format:webp/1*M_hJr3NCqyOKzVfhSOsLDw.png"/></div><figcaption class="ob oc fg fe ff od oe bd b be z ek">This is the <strong class="bd oq"><em class="or">default</em></strong> "<code class="eh me mf mg mh b">ACCOUNT_ADDRESS" that is used to deploy the smart contract or execute any transaction, unless the user specifies a "from" field in the transaction object</code></figcaption></figure><p id="23b0" class="pw-post-body-paragraph it iu ht iw b ix iy iz ja jb jc jd je lk jg jh ji lm jk jl jm lo jo jp jq jr hm dt translated"><strong class="iw hu"> <em class="iv">注:</em> </strong>此处粘贴的<code class="eh me mf mg mh b">ACCOUNT_ADDRESS</code>是1a)创建NODE-1步骤中的十六进制值。</p><p id="7b54" class="pw-post-body-paragraph it iu ht iw b ix iy iz ja jb jc jd je lk jg jh ji lm jk jl jm lo jo jp jq jr hm dt translated"><strong class="iw hu"> 4)部署智能合约</strong></p><p id="5333" class="pw-post-body-paragraph it iu ht iw b ix iy iz ja jb jc jd je lk jg jh ji lm jk jl jm lo jo jp jq jr hm dt translated">当私有以太网启动后，需要将智能合同部署到网络上。打开一个新的终端，在<code class="eh me mf mg mh b">TruffleDapp</code>目录下运行:</p><pre class="mn mo mp mq fq mr mh ms mt aw mu dt"><span id="f5d9" class="mv kl ht mh b fv mw mx l my mz">$ truffle migrate</span></pre><p id="be12" class="pw-post-body-paragraph it iu ht iw b ix iy iz ja jb jc jd je lk jg jh ji lm jk jl jm lo jo jp jq jr hm dt translated">首先迁移文件<code class="eh me mf mg mh b">1_initial_migration.js</code>，然后是<code class="eh me mf mg mh b">2_helloworld.js</code>。</p><p id="67ff" class="pw-post-body-paragraph it iu ht iw b ix iy iz ja jb jc jd je lk jg jh ji lm jk jl jm lo jo jp jq jr hm dt translated">至此，我们结束了本教程的一个主要部分，即启动一个由2个节点组成的私有以太网，并在该网络上部署我们的<code class="eh me mf mg mh b">helloworld.sol</code>智能合约。</p></div><div class="ab cl js jt hb ju" role="separator"><span class="jv bw bk jw jx jy"/><span class="jv bw bk jw jx jy"/><span class="jv bw bk jw jx"/></div><div class="hm hn ho hp hq"><p id="c7de" class="pw-post-body-paragraph it iu ht iw b ix iy iz ja jb jc jd je lk jg jh ji lm jk jl jm lo jo jp jq jr hm dt translated"><em class="iv">附:如果你喜欢这篇文章，请鼓掌10次！请在下面评论，让我知道你的想法，或者如果你想分享一些技巧。</em></p><p id="05c6" class="pw-post-body-paragraph it iu ht iw b ix iy iz ja jb jc jd je lk jg jh ji lm jk jl jm lo jo jp jq jr hm dt translated">我很快会发表更多这样有趣的文章。在 <a class="ae kj" rel="noopener" href="/@themadhackerOI"> <em class="iv">上关注我中</em> </a> <em class="iv">或在</em> <a class="ae kj" href="https://twitter.com/TheMadHacker01" rel="noopener ugc nofollow" target="_blank"> <em class="iv">上跟踪我推特</em> </a> <em class="iv">敬请关注。</em></p></div><div class="ab cl js jt hb ju" role="separator"><span class="jv bw bk jw jx jy"/><span class="jv bw bk jw jx jy"/><span class="jv bw bk jw jx"/></div><div class="hm hn ho hp hq"><h1 id="0c25" class="kk kl ht bd km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh dt translated">所有系列链接</h1><p id="c2cb" class="pw-post-body-paragraph it iu ht iw b ix li iz ja jb lj jd je lk ll jh ji lm ln jl jm lo lp jp jq jr hm dt translated">如果你想跳过某一部分，你可以参考下面的链接。请参考下面的<strong class="iw hu">目录</strong>，将一节与其对应的主题进行匹配。</p><p id="3ee1" class="pw-post-body-paragraph it iu ht iw b ix iy iz ja jb jc jd je lk jg jh ji lm jk jl jm lo jo jp jq jr hm dt translated"><a class="ae kj" rel="noopener" href="/coinmonks/dapp-on-a-private-ethereum-network-1-c8b80695e049">第一部分:第一至第三节</a></p><p id="1cf3" class="pw-post-body-paragraph it iu ht iw b ix iy iz ja jb jc jd je lk jg jh ji lm jk jl jm lo jo jp jq jr hm dt translated"><a class="ae kj" rel="noopener" href="/coinmonks/dapp-on-a-private-ethereum-network-2-a0b282586558">第二部分:第四节</a></p><p id="fc11" class="pw-post-body-paragraph it iu ht iw b ix iy iz ja jb jc jd je lk jg jh ji lm jk jl jm lo jo jp jq jr hm dt translated"><a class="ae kj" rel="noopener" href="/@themadhackerOI/how-to-build-a-dapp-on-a-private-ethereum-network-part-3-31066fedf7a1">第三部分:第五至第六节</a></p><p id="a81c" class="pw-post-body-paragraph it iu ht iw b ix iy iz ja jb jc jd je lk jg jh ji lm jk jl jm lo jo jp jq jr hm dt translated"><a class="ae kj" rel="noopener" href="/@themadhackerOI/how-to-build-a-dapp-on-a-private-ethereum-network-part-4-ea28b6de5cf8">第4部分:第七节</a></p><p id="e785" class="pw-post-body-paragraph it iu ht iw b ix iy iz ja jb jc jd je lk jg jh ji lm jk jl jm lo jo jp jq jr hm dt translated"><a class="ae kj" rel="noopener" href="/@themadhackerOI/how-to-build-a-dapp-on-a-private-ethereum-network-part-5-84177d5717be">第5部分:第八章至第九章</a></p><blockquote class="jz"><p id="d80b" class="ka kb ht bd kc kd ke kf kg kh ki jr ek translated"><a class="ae kj" href="https://coincodecap.com/?utm_source=coinmonks" rel="noopener ugc nofollow" target="_blank">在您的收件箱中直接获得最佳软件交易</a></p></blockquote><figure class="ot ou ov ow ox nb fe ff paragraph-image"><a href="https://coincodecap.com/?utm_source=coinmonks"><div class="fe ff os"><img src="../Images/7c0b3dfdcbfea594cc0ae7d4f9bf6fcb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1168/format:webp/0*OJ-qb5G6i863msBB.png"/></div></a></figure><figure class="mn mo mp mq fq nb fe ff paragraph-image"><div role="button" tabindex="0" class="og oh di oi bf oj"><div class="fe ff oy"><img src="../Images/e9dbce386c4f90837b5db529a4c87766.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5fZu_SfnNF6m_BGbXlsl-A@2x.png"/></div></div></figure></div></div>    
</body>
</html>