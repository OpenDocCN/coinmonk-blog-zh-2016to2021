<html>
<head>
<title>Decompiling Ethereum Smart Contracts</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">反编译以太坊智能合约</h1>
<blockquote>原文：<a href="https://medium.com/coinmonks/decompiling-ethereum-smart-contracts-b283ae80f8a0?source=collection_archive---------0-----------------------#2018-10-30">https://medium.com/coinmonks/decompiling-ethereum-smart-contracts-b283ae80f8a0?source=collection_archive---------0-----------------------#2018-10-30</a></blockquote><div><div class="ef hh hi hj hk hl"/><div class="hm hn ho hp hq"><div class=""/><p id="2701" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">我们非常兴奋地宣布，我们的以太坊智能合同反编译预发布可用。我们相信它将成为安全审计员、漏洞研究人员和逆向工程师检查以太坊平台上运行的不透明智能合同的首选工具。</p><p id="51d5" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated"><strong class="is hu">匆匆忙忙？</strong> <a class="ae jo" href="https://www.pnfsoftware.com/jeb/demoevm" rel="noopener ugc nofollow" target="_blank"> <strong class="is hu">下载试玩build并开始反转合约</strong> </a> <strong class="is hu">。记得在DecompiledContract节点上按TAB键来查看其类似于Solidity的源代码。</strong></p><p id="2d56" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">请继续阅读，了解反编译器的当前特性；如何使用它，了解它的输出；它当前的局限性和计划中的增加。</p><figure class="jq jr js jt fq ju fe ff paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="fe ff jp"><img src="../Images/8c7dc7fb4478c40f50f465d694f3afdc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*t1SRu2fbVciRZs1l.png"/></div></div><figcaption class="kb kc fg fe ff kd ke bd b be z ek"><a class="ae jo" href="https://etherscan.io/address/0x3DBB3E8A5B1E9DF522A441FFB8464F57798714B1" rel="noopener ugc nofollow" target="_blank">This opaque multisig wallet</a> is holding ~ USD $22 million as of 10/30/2018!</figcaption></figure><h1 id="171b" class="kf kg ht bd kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc dt translated">能力</h1><p id="2554" class="pw-post-body-paragraph iq ir ht is b it ld iv iw ix le iz ja jb lf jd je jf lg jh ji jj lh jl jm jn hm dt translated">反编译器模块提供以下特定功能:</p><ul class=""><li id="c00c" class="li lj ht is b it iu ix iy jb lk jf ll jj lm jn ln lo lp lq dt translated">反编译器将编译后的智能合约EVM代码作为输入，并将它们反编译成类似于源代码的<a class="ae jo" href="https://solidity.readthedocs.io/en/latest/index.html" rel="noopener ugc nofollow" target="_blank"> Solidity </a>。</li><li id="ff9a" class="li lj ht is b it lr ix ls jb lt jf lu jj lv jn ln lo lp lq dt translated">最初的EVM代码分析通过确定契约的公共和私有方法，包括由编译器综合生成的公共方法的实现。</li><li id="7d7c" class="li lj ht is b it lr ix ls jb lt jf lu jj lv jn ln lo lp lq dt translated">代码分析试图在不访问ABI的情况下确定方法和事件的名称以及原型。</li><li id="de1f" class="li lj ht is b it lr ix ls jb lt jf lu jj lv jn ln lo lp lq dt translated">反编译器还试图恢复各种高级构造，包括:众所周知的接口的实现，如标准令牌的ERC20、不可替换令牌的ERC721、MultiSigWallet契约等；存储变量和类型；高层次的坚固性神器和习惯用法，包括:函数可变性属性；功能支付能力状态；事件发射，包括事件名称；address.send()或address.transfer()的调用；预编译合同调用</li></ul><p id="5f48" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">除此之外，JEB后端和客户端平台还提供了以下标准功能:</p><ul class=""><li id="d696" class="li lj ht is b it iu ix iy jb lk jf ll jj lm jn ln lo lp lq dt translated">反编译器使用JEB的优化管道来产生高级别的干净代码。</li><li id="5827" class="li lj ht is b it lr ix ls jb lt jf lu jj lv jn ln lo lp lq dt translated">它使用JEB代码分析核心特性，因此允许:代码重构(例如，一致地重命名方法或字段)，注释和标注，导航(例如，交叉引用)，键入，绘图等。</li><li id="c527" class="li lj ht is b it lr ix ls jb lt jf lu jj lv jn ln lo lp lq dt translated">用户可以通过JEB API访问中级IR表示和高级AST表示。</li><li id="c5d4" class="li lj ht is b it lr ix ls jb lt jf lu jj lv jn ln lo lp lq dt translated">更一般地说，API允许高级用户编写扩展，从Python中的简单脚本到Java中的复杂插件。</li></ul><p id="0891" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">我们的以太坊模块在活跃于以太坊主网和测试网上的数千份智能合约上进行了测试。</p><h1 id="2d06" class="kf kg ht bd kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc dt translated">基本用法</h1><p id="9214" class="pw-post-body-paragraph iq ir ht is b it ld iv iw ix le iz ja jb lf jd je jf lg jh ji jj lh jl jm jn hm dt translated">通过<em class="lw">文件打开合同，打开智能合同…</em>菜单项。</p><figure class="jq jr js jt fq ju fe ff paragraph-image"><div class="fe ff lx"><img src="../Images/c50e13eed47da7567c3b7c9a8afbfd13.png" data-original-src="https://miro.medium.com/v2/resize:fit:576/format:webp/0*CM5O8_bM-FW5yoxa.png"/></div></figure><p id="00ce" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">您将有两种选择:</p><ul class=""><li id="4bfa" class="li lj ht is b it iu ix iy jb lk jf ll jj lm jn ln lo lp lq dt translated">打开已经存储在磁盘上的二进制文件。</li><li id="91f6" class="li lj ht is b it lr ix ls jb lt jf lu jj lv jn ln lo lp lq dt translated">从一个主要的以太网下载并打开合同:<em class="lw"> mainnet </em>、<em class="lw"> rinkeby </em>、<em class="lw"> ropsten </em>或<em class="lw"> kovan </em>。选择网络，提供合同20字节地址，单击下载并选择文件目的地。</li></ul><figure class="jq jr js jt fq ju fe ff paragraph-image"><div class="fe ff ly"><img src="../Images/41d13ffef07dafbedf57c0ebb2d7ae70.png" data-original-src="https://miro.medium.com/v2/resize:fit:1384/format:webp/0*gBEBs-vhUy5nVVKU.png"/></div><figcaption class="kb kc fg fe ff kd ke bd b be z ek"><em class="lz">Open a contract via the File, Open smart contract menu entry</em></figcaption></figure><p id="ef67" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">请注意，要被识别为EVM代码，文件必须:</p><ul class=""><li id="61ee" class="li lj ht is b it iu ix iy jb lk jf ll jj lm jn ln lo lp lq dt translated">要么有一个”。evm-bytecode”扩展:在这种情况下，文件可能包含二进制或十六进制编码的代码；</li><li id="31e4" class="li lj ht is b it lr ix ls jb lt jf lu jj lv jn ln lo lp lq dt translated">或者已经是一个了”。运行时“或”。bin-runtime”扩展(由solc Solidity编译器生成)，并包含十六进制编码的Solidity生成代码。</li></ul><p id="ede5" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">如果您正在打开raw文件，我们建议您附加“.evm-extension ”,以保证它们将作为evm合同代码进行处理。</p><h2 id="8638" class="ma kg ht bd kh mb mc md kl me mf mg kp jb mh mi kt jf mj mk kx jj ml mm lb mn dt translated">合同处理</h2><p id="45ac" class="pw-post-body-paragraph iq ir ht is b it ld iv iw ix le iz ja jb lf jd je jf lg jh ji jj lh jl jm jn hm dt translated">JEB将处理您的合同文件，并生成一个<em class="lw"> DecompiledContract </em>类项目来表示它:</p><figure class="jq jr js jt fq ju fe ff paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="fe ff mo"><img src="../Images/3818362eac1f323721ff653c2aaff156.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*50LW9fP2J4tUuShF.png"/></div></div><figcaption class="kb kc fg fe ff kd ke bd b be z ek"><em class="lz">The Assembly view on the right panel shows the processed code.</em></figcaption></figure><p id="9e68" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">要切换到反编译视图，在层次视图中选择“反编译合同”节点，按TAB键(或右键，<em class="lw">反编译</em>)。</p><figure class="jq jr js jt fq ju fe ff paragraph-image"><div class="fe ff mp"><img src="../Images/44e23464538eeb9b2db425142680fd61.png" data-original-src="https://miro.medium.com/v2/resize:fit:696/format:webp/0*SBI3v2BYwX9LkJjS.png"/></div><figcaption class="kb kc fg fe ff kd ke bd b be z ek"><em class="lz">Right-click on items to bring up context menus showing the principal commands and shortcuts.</em></figcaption></figure><figure class="jq jr js jt fq ju fe ff paragraph-image"><div class="fe ff mq"><img src="../Images/1d776ae85b5d2e6d032399bac67340e2.png" data-original-src="https://miro.medium.com/v2/resize:fit:900/format:webp/0*pW7PrUaAR5Kq2mS7.png"/></div><figcaption class="kb kc fg fe ff kd ke bd b be z ek">The decompiled view of a contract.</figcaption></figure><p id="33da" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">反编译后的契约以类似Solidity的代码呈现:大部分是Solidity代码，但不完全是；在整个代码中，非法的结构被用来表示反编译器不能表示的指令。示例包括:代表一些低级EVM指令、内存访问的低级语句，或者非常罕见的goto语句。不要指望一个反编译的契约会被轻易地重新编译。</p><h2 id="6eed" class="ma kg ht bd kh mb mc md kl me mf mg kp jb mh mi kt jf mj mk kx jj ml mm lb mn dt translated">代码视图</h2><p id="20dc" class="pw-post-body-paragraph iq ir ht is b it ld iv iw ix le iz ja jb lf jd je jf lg jh ji jj lh jl jm jn hm dt translated">如果您希望同时导航汇编和高级代码，可以调整视图面板，使之具有并排视图。</p><ul class=""><li id="7f9f" class="li lj ht is b it iu ix iy jb lk jf ll jj lm jn ln lo lp lq dt translated">在routine的装配视图中，按Space以可视化其控制流图。</li><li id="c92f" class="li lj ht is b it lr ix ls jb lt jf lu jj lv jn ln lo lp lq dt translated">若要在程序集和源代码之间来回导航，请按TAB键。插入符号将定位在最接近的匹配指令上。</li></ul><figure class="jq jr js jt fq ju fe ff paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="fe ff mr"><img src="../Images/803391ed225da33cc8418b4988315414.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*xvaaDhYkCsdcYPpl.png"/></div></div><figcaption class="kb kc fg fe ff kd ke bd b be z ek">Side by side views: assembly and source</figcaption></figure><h2 id="5f76" class="ma kg ht bd kh mb mc md kl me mf mg kp jb mh mi kt jf mj mk kx jj ml mm lb mn dt translated">合同信息</h2><p id="dd6c" class="pw-post-body-paragraph iq ir ht is b it ld iv iw ix le iz ja jb lf jd je jf lg jh ji jj lh jl jm jn hm dt translated">在项目浏览器面板中，双击合同节点(带有以太坊基金会官方标志的节点)，然后在打开的视图中选择描述选项卡，查看有关已处理合同的有趣信息，例如:</p><ul class=""><li id="252e" class="li lj ht is b it iu ix iy jb lk jf ll jj lm jn ln lo lp lq dt translated">检测到的编译器和/或其版本(当前支持Solidity和Vyper编译器的变体)。</li><li id="1c55" class="li lj ht is b it lr ix ls jb lt jf lu jj lv jn ln lo lp lq dt translated">检测到的例程列表(私有和公共，及其哈希)。</li><li id="847a" class="li lj ht is b it lr ix ls jb lt jf lu jj lv jn ln lo lp lq dt translated">元数据文件的群组哈希(如果有)。</li></ul><figure class="jq jr js jt fq ju fe ff paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="fe ff ms"><img src="../Images/4f0d2555e53cd1dcaeaf93c7501549bb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*YL9K3SHZ6f0YqS6t.png"/></div></div><figcaption class="kb kc fg fe ff kd ke bd b be z ek">The contract was identified as being compiled with Solidity &lt;= 0.4.21</figcaption></figure><h2 id="0cda" class="ma kg ht bd kh mb mc md kl me mf mg kp jb mh mi kt jf mj mk kx jj ml mm lb mn dt translated">命令</h2><p id="ae37" class="pw-post-body-paragraph iq ir ht is b it ld iv iw ix le iz ja jb lf jd je jf lg jh ji jj lh jl jm jn hm dt translated">常用的命令可以用来重构和注释汇编或反编译的代码。您将在<em class="lw">动作</em>和<em class="lw">本地</em>菜单中找到详尽的列表。以下是基本命令:</p><ul class=""><li id="f251" class="li lj ht is b it iu ix iy jb lk jf ll jj lm jn ln lo lp lq dt translated">使用N键重命名项(方法、变量、全局变量等)</li><li id="a9c4" class="li lj ht is b it lr ix ls jb lt jf lu jj lv jn ln lo lp lq dt translated">使用X键通过检查交叉引用来导航代码(例如，找到一个方法的所有调用方，并跳转到其中一个调用方)</li><li id="c524" class="li lj ht is b it lr ix ls jb lt jf lu jj lv jn ln lo lp lq dt translated">使用斜杠键进行注释</li><li id="7c2e" class="li lj ht is b it lr ix ls jb lt jf lu jj lv jn ln lo lp lq dt translated">如前所述，TAB键有助于在低级EVM代码和高级反编译代码之间来回导航</li></ul><p id="8413" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">我们建议阅读<a class="ae jo" href="https://www.pnfsoftware.com/jeb/manual/" rel="noopener ugc nofollow" target="_blank">用户手册</a>来了解如何使用JEB。</p><figure class="jq jr js jt fq ju fe ff paragraph-image"><div class="fe ff mt"><img src="../Images/b5f9c3a86eb2f421918a739e7695b63e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1308/format:webp/0*S-XMd656W0ydeBRK.png"/></div><figcaption class="kb kc fg fe ff kd ke bd b be z ek">Rename an item (eg, a variable) by pressing the N key</figcaption></figure><p id="0e6c" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">请记住，您可以通过使用B键来更改即时数字基数和渲染。在下面的例子中，您可以看到在<a class="ae jo" href="https://etherscan.io/address/0xdd9fd6b6f8f7ea932997992bbe67eabb3e316f3c" rel="noopener ugc nofollow" target="_blank"> bad Fomo3D </a>契约中出现了几个字符串，最初以十六进制呈现:</p><figure class="jq jr js jt fq ju fe ff paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="fe ff mu"><img src="../Images/7b9635437aac387972d93672e3acbd3b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*a0t2ojSiGq7th6p2.png"/></div></div><figcaption class="kb kc fg fe ff kd ke bd b be z ek">All immediates are rendered as hex-strings by default.</figcaption></figure><figure class="jq jr js jt fq ju fe ff paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="fe ff mv"><img src="../Images/eed3c952420951614c9e98169cf821d2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*XBXKmFiLHXP6veuk.png"/></div></div><figcaption class="kb kc fg fe ff kd ke bd b be z ek">Use the B key to cycle through base (10, 16, etc.) and rendering (number, ascii)</figcaption></figure><h1 id="0f50" class="kf kg ht bd kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc dt translated">理解反编译合同</h1><p id="abf6" class="pw-post-body-paragraph iq ir ht is b it ld iv iw ix le iz ja jb lf jd je jf lg jh ji jj lh jl jm jn hm dt translated">这一节强调了你在反编译伪可靠性代码中会遇到的习惯用法。下面的例子展示了JEB UI客户端，左侧是一个程序集，右侧是高级反编译代码。作为例子使用的合同是当前活跃的以太坊<em class="lw"> mainnet </em>的实时合同。</p><p id="7a39" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">我们还强调了当前的限制和计划增加的内容。</p><h2 id="fefd" class="ma kg ht bd kh mb mc md kl me mf mg kp jb mh mi kt jf mj mk kx jj ml mm lb mn dt translated">调度程序和公共功能</h2><p id="7313" class="pw-post-body-paragraph iq ir ht is b it ld iv iw ix le iz ja jb lf jd je jf lg jh ji jj lh jl jm jn hm dt translated">地址为0的契约的入口点函数通常是它的调度程序。它被JEB命名为start()，在大多数情况下，它包含在一个if语句中，将输入的calldata散列(前4个字节)与预先计算的散列进行比较，以确定要执行哪个例程。</p><ul class=""><li id="379e" class="li lj ht is b it iu ix iy jb lk jf ll jj lm jn ln lo lp lq dt translated">JEB试图通过使用哈希字典(目前包含超过140，000个条目)来确定公共方法名。</li><li id="f712" class="li lj ht is b it lr ix ls jb lt jf lu jj lv jn ln lo lp lq dt translated">由Solidity编译的契约通常使用合成的(编译器生成的)方法作为公共例程(使用公共以太坊ABI)和内部例程(使用编译器特定的ABI)之间的桥梁。这些例程也被标识，如果它们对应的公共方法被命名，将被赋予一个相似的名称<em class="lw"> __impl_{PUBLIC_NAME} </em>。</li></ul><p id="c0f1" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">注意/计划添加:目前，JEB并不试图处理公共例程的输入数据，并将其按摩回带有常规变量的显式原型。因此，您将看到在公共方法中对CALLDATA字节的低级访问。</p><figure class="jq jr js jt fq ju fe ff paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="fe ff mw"><img src="../Images/9e183d7fdb5292bae691ae4ee88237ef.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*HFmEYl2qnEl7_Fl3.png"/></div></div><figcaption class="kb kc fg fe ff kd ke bd b be z ek">A dispatcher.</figcaption></figure><p id="e88e" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">下面，请参见公共方法collectToken()，该方法从calldata中检索其第一个参数—一个20字节的地址。</p><figure class="jq jr js jt fq ju fe ff paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="fe ff mx"><img src="../Images/254c1a41b6f046a0098a61ad93aaa36b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*oo8k2yvGecNCYFIM.png"/></div></div><figcaption class="kb kc fg fe ff kd ke bd b be z ek">A public method reading its arguments from CALLDATA bytes.</figcaption></figure><h2 id="b3f0" class="ma kg ht bd kh mb mc md kl me mf mg kp jb mh mi kt jf mj mk kx jj ml mm lb mn dt translated">接口发现</h2><p id="2e7b" class="pw-post-body-paragraph iq ir ht is b it ld iv iw ix le iz ja jb lf jd je jf lg jh ji jj lh jl jm jn hm dt translated">在撰写本文时，可以检测到以下接口的实现:ERC20、ERC165、ERC721、ERC721TokenReceiver、ERC721Metadata、ERC721Enumerable、ERC820、ERC223、ERC777、ERC223/ERC777接口使用的TokenFallback以及通用的MultiSigWallet接口。</p><p id="5efc" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">例如，以下合同被确定为ERC20令牌实施:</p><figure class="jq jr js jt fq ju fe ff paragraph-image"><div class="fe ff my"><img src="../Images/b8ce865b063032e5d7d3e4da5b9bc708.png" data-original-src="https://miro.medium.com/v2/resize:fit:898/format:webp/0*mzDxyjyDRvy-Ye-q.png"/></div><figcaption class="kb kc fg fe ff kd ke bd b be z ek">This contract implements all methods specified by the ERC20 interface.</figcaption></figure><h2 id="5612" class="ma kg ht bd kh mb mc md kl me mf mg kp jb mh mi kt jf mj mk kx jj ml mm lb mn dt translated">功能属性</h2><p id="f6e6" class="pw-post-body-paragraph iq ir ht is b it ld iv iw ix le iz ja jb lf jd je jf lg jh ji jj lh jl jm jn hm dt translated">杰布尽全力找回:</p><ul class=""><li id="12bb" class="li lj ht is b it iu ix iy jb lk jf ll jj lm jn ln lo lp lq dt translated">低级状态可变性属性(纯、只读、读写)</li><li id="1e01" class="li lj ht is b it lr ix ls jb lt jf lu jj lv jn ln lo lp lq dt translated">为公共方法保留的高级Solidity“payable”属性</li></ul><p id="f5a8" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">显式不可支付的函数具有较低级别的合成存根，用于验证没有接收到以太网。如果情况属实，它们会恢复原状。如果JEB决定删除这个存根，这个函数将总是有一个行内注释<strong class="is hu"> /*non payable*/ </strong>，以避免任何歧义。</p><p id="7984" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">下面的契约展示了两个公共方法，一个有默认的可变性状态(不可支付)；另一个是应付的。(注意，哈希0xFF03AD56没有被解析，因此方法的名称是未知的，被设置为sub _ AF您可能还会看到对collect()的桥接函数__impl_collect()的调用，如前一节所述。</p><figure class="jq jr js jt fq ju fe ff paragraph-image"><div class="fe ff mz"><img src="../Images/8faaa337e4db3d281cb614eb5969b102.png" data-original-src="https://miro.medium.com/v2/resize:fit:1184/format:webp/0*MD9v7miu6guDrDxx.png"/></div><figcaption class="kb kc fg fe ff kd ke bd b be z ek">Two public methods, one is payable, the other is not and will revert if it receives Ether.</figcaption></figure><h2 id="a040" class="ma kg ht bd kh mb mc md kl me mf mg kp jb mh mi kt jf mj mk kx jj ml mm lb mn dt translated">存储变量</h2><p id="5864" class="pw-post-body-paragraph iq ir ht is b it ld iv iw ix le iz ja jb lf jd je jf lg jh ji jj lh jl jm jn hm dt translated">预发布的反编译器附带了一个有限的存储重建器模块。</p><ul class=""><li id="b3db" class="li lj ht is b it iu ix iy jb lk jf ll jj lm jn ln lo lp lq dt translated">大多数情况下，对原语(int8至int256，uint8至uint256)的访问是重新构造的</li><li id="4b3f" class="li lj ht is b it lr ix ls jb lt jf lu jj lv jn ln lo lp lq dt translated">提取存储字中打包的小原语(例如，包含2个uint8和1个int32的256位存储字，并在整个代码中访问，将产生3个契约变量，正如人们期望在Solidity契约中看到的那样</li></ul><figure class="jq jr js jt fq ju fe ff paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="fe ff na"><img src="../Images/ae292d6d1d42ae5746fa21e63dce25b3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*CkSs4xd5OZ8LTy-h.png"/></div></div><figcaption class="kb kc fg fe ff kd ke bd b be z ek">Four primitive storage variables were reconstructed.</figcaption></figure><p id="cc63" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">然而，目前对复杂存储变量的访问，如映射、映射的映射、结构的映射等。都没有简化。这个限制将在完整版本中解决。</p><p id="291e" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">当存储变量未被解析时，您将看到简单的“存储[…]”赋值，例如:</p><figure class="jq jr js jt fq ju fe ff paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="fe ff nb"><img src="../Images/63fe7e012a01afbac9730edbf8853830.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*u7GEVWeIOsg4wuLo.png"/></div></div><figcaption class="kb kc fg fe ff kd ke bd b be z ek">Unresolved storage assignment, here, to a mapping.</figcaption></figure><p id="a1e6" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">由于以太坊上的存储是如何设计的(uint256到uint256的键值存储)，Solidity在内部使用两个或多个间接层来计算实际的存储键。那些低级存储键取决于高级存储变量的位置。KECCAK256操作码用于计算中间密钥和最终密钥。我们将在以后的博客文章中详细介绍这一机制。</p><h2 id="507f" class="ma kg ht bd kh mb mc md kl me mf mg kp jb mh mi kt jf mj mk kx jj ml mm lb mn dt translated">预编译合同</h2><p id="8951" class="pw-post-body-paragraph iq ir ht is b it ld iv iw ix le iz ja jb lf jd je jf lg jh ji jj lh jl jm jn hm dt translated">以太坊在地址1，2，3，4定义了<a class="ae jo" href="https://github.com/ethereum/aleth/blob/master/libethereum/ChainParams.cpp#L41" rel="noopener ugc nofollow" target="_blank">四个预编译契约</a>。(其他地址(5–8)被保留用于额外的预编译合同，但这仍处于ERC阶段。)</p><p id="92eb" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">JEB识别最终将导致预编译代码执行的调用，并在反编译代码中将其标记为这样:<em class="lw"> call_{specific} </em>。</p><p id="150d" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">下面的例子显示了<a class="ae jo" href="https://etherscan.io/address/0x949a6ac29b9347b3eb9a420272a9dd7890b787a3" rel="noopener ugc nofollow" target="_blank"> 34C3 CTF契约</a>的<em class="lw"> __impl_Receive </em>(名为recovered)方法，该方法调用地址#2，这是一个预编译的契约，提供了SHA-256的快速实现。</p><figure class="jq jr js jt fq ju fe ff paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="fe ff mx"><img src="../Images/f14e9354b800baed82217d18025380fc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*h251BIqL0bl6HByC.png"/></div></div><figcaption class="kb kc fg fe ff kd ke bd b be z ek">This contract calls address 2 to calculate the SHA-256 of a binary blob.</figcaption></figure><h2 id="31cf" class="ma kg ht bd kh mb mc md kl me mf mg kp jb mh mi kt jf mj mk kx jj ml mm lb mn dt translated">以太发送()</h2><p id="2780" class="pw-post-body-paragraph iq ir ht is b it ld iv iw ix le iz ja jb lf jd je jf lg jh ji jj lh jl jm jn hm dt translated">Solidity的<em class="lw"> send </em>可以翻译成一个较低级别的调用，有一个标准的气体津贴和零参数。它主要用于通过目标协定回退函数向协定发送以太网。</p><p id="d1e4" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">注意:目前，JEB将它们呈现为send(address，amount ),而不是address.send(amount)</p><p id="b6f7" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">以下合同在mainnet上直播。它是一个简单的转发器，不存储以太网:它将收到的金额转发给另一个合同。</p><figure class="jq jr js jt fq ju fe ff paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="fe ff mw"><img src="../Images/e7b7ffd72d7766cc4a74f1fb992ffae9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*yQo3dex4p5fN6r7-.png"/></div></div><figcaption class="kb kc fg fe ff kd ke bd b be z ek">This contract makes use of address.send(…) to send Ether</figcaption></figure><h2 id="0d21" class="ma kg ht bd kh mb mc md kl me mf mg kp jb mh mi kt jf mj mk kx jj ml mm lb mn dt translated">乙醚转移()</h2><p id="4d87" class="pw-post-body-paragraph iq ir ht is b it ld iv iw ix le iz ja jb lf jd je jf lg jh ji jj lh jl jm jn hm dt translated">Solidity的transfer是send的一个更高级的变体，如果呼叫失败，它会检查并回复数据。杰布也认出了那些电话。</p><p id="6c43" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">注意:目前，JEB将它们呈现为transfer(address，amount ),而不是address.transfer(amount)</p><figure class="jq jr js jt fq ju fe ff paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="fe ff mx"><img src="../Images/e9d1407b808a057bcc533474b7a2b7ec.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*wmKIWQss2_nZHEot.png"/></div></div><figcaption class="kb kc fg fe ff kd ke bd b be z ek">This contract makes use of address.transfer(…) to send Ether</figcaption></figure><h2 id="c095" class="ma kg ht bd kh mb mc md kl me mf mg kp jb mh mi kt jf mj mk kx jj ml mm lb mn dt translated">事件发射</h2><p id="6125" class="pw-post-body-paragraph iq ir ht is b it ld iv iw ix le iz ja jb lf jd je jf lg jh ji jj lh jl jm jn hm dt translated">JEB试图部分重建LOGx (x in 1..4)操作码返回到高级实体“发出事件(…)”。通过反转事件方法原型哈希来解析事件名称。在写的时候，我们的字典包含超过20，000个词条。</p><p id="dee3" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">如果JEB不能反转LOGx指令，或者如果使用LOG0，那么将使用较低级别的log(…)调用。</p><p id="8cee" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">注意:目前不处理事件参数；因此，反编译代码中使用的<em class="lw"> emit </em>构造具有以下形式:emit Event(memory，size[，topic2[，topic3[，topic4]])。topic1始终用于存储事件原型哈希。</p><figure class="jq jr js jt fq ju fe ff paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="fe ff nc"><img src="../Images/a3ec2eeb085aa6e046c90bbbb4eef0e0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*roBUspU-XkqYHjjD.png"/></div></div><figcaption class="kb kc fg fe ff kd ke bd b be z ek">An Invocation of LOG4 reversed to an “emit Deposit(…)” event emission</figcaption></figure><h1 id="3707" class="kf kg ht bd kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc dt translated">应用程序接口</h1><p id="5b59" class="pw-post-body-paragraph iq ir ht is b it ld iv iw ix le iz ja jb lf jd je jf lg jh ji jj lh jl jm jn hm dt translated">JEB API允许复杂或重复任务的自动化。后端插件或复杂脚本可以用Python或Java编写。JEB 3.0-beta 6附带API更新允许用户查询反编译的合同代码:</p><ul class=""><li id="c885" class="li lj ht is b it iu ix iy jb lk jf ll jj lm jn ln lo lp lq dt translated">访问中间表示(IR)</li><li id="4090" class="li lj ht is b it lr ix ls jb lt jf lu jj lv jn ln lo lp lq dt translated">访问最终的类固体表示(AST)</li></ul><p id="ae02" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">API的使用超出了这里的范围。我们将在随后的博客文章或我们的公共<a class="ae jo" href="https://github.com/pnfsoftware/" rel="noopener ugc nofollow" target="_blank"> GitHub库</a>上提供例子。</p><h1 id="23f6" class="kf kg ht bd kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc dt translated">结论</h1><p id="3773" class="pw-post-body-paragraph iq ir ht is b it ld iv iw ix le iz ja jb lf jd je jf lg jh ji jj lh jl jm jn hm dt translated">如果你正在对不透明的合同进行逆向工程，给杰布一个尝试:在这里下载演示<a class="ae jo" href="https://www.pnfsoftware.com/jeb/demo" rel="noopener ugc nofollow" target="_blank"/>，并随时让我们知道你在评论区、Twitter (@jebdec)或通过电子邮件在contact@pnfsoftware.com的反馈。</p><figure class="jq jr js jt fq ju fe ff paragraph-image"><a href="http://bit.ly/2G71Sp7"><div class="fe ff nd"><img src="../Images/449450761cd76f44f9ae574333f9e9af.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fKX2mtg7p1lOs7JmosPLsA.png"/></div></a></figure><blockquote class="ne"><p id="0d8d" class="nf ng ht bd nh ni nj nk nl nm nn jn ek translated"><a class="ae jo" href="https://coincodecap.com/?utm_source=coinmonks" rel="noopener ugc nofollow" target="_blank">直接在您的收件箱中获得最佳软件交易</a></p></blockquote><figure class="np nq nr ns nt ju fe ff paragraph-image"><a href="https://coincodecap.com/?utm_source=coinmonks"><div class="fe ff no"><img src="../Images/7c0b3dfdcbfea594cc0ae7d4f9bf6fcb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1168/format:webp/0*OJ-qb5G6i863msBB.png"/></div></a></figure></div></div>    
</body>
</html>