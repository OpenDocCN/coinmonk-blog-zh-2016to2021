<html>
<head>
<title>Data structure in Ethereum | Episode 1+: Compact (Hex-prefix) encoding.</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">以太坊中的数据结构|第1集+:紧凑(十六进制前缀)编码。</h1>
<blockquote>原文：<a href="https://medium.com/coinmonks/data-structure-in-ethereum-episode-1-compact-hex-prefix-encoding-12558ae02791?source=collection_archive---------0-----------------------#2018-01-09">https://medium.com/coinmonks/data-structure-in-ethereum-episode-1-compact-hex-prefix-encoding-12558ae02791?source=collection_archive---------0-----------------------#2018-01-09</a></blockquote><div><div class="ef hh hi hj hk hl"/><div class="hm hn ho hp hq"><figure class="hs ht fm fo hu hv fe ff paragraph-image"><div role="button" tabindex="0" class="hw hx di hy bf hz"><div class="fe ff hr"><img src="../Images/066cbb6d50a0cab55005402108714e18.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*aqmFSJF03yHS8xvVACukFg.png"/></div></div><figcaption class="ic id fg fe ff ie if bd b be z ek">HP encoding in Golang.</figcaption></figure><div class=""/><p id="c4f6" class="pw-post-body-paragraph jf jg ii jh b ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc hm dt translated">在<a class="ae kd" rel="noopener" href="/@phansnt/data-structure-in-ethereum-episode-1-recursive-length-prefix-rlp-encoding-decoding-d1016832f919">第1集</a>中，我们讨论了RLP编码/解码，然而以太坊还有另一种编码，称为压缩编码或十六进制前缀(HP)编码。那么，RLP编码和惠普编码有什么区别呢？惠普编码是如何工作的？这篇文章将帮助我们得到它。</p><p id="6968" class="pw-post-body-paragraph jf jg ii jh b ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc hm dt translated">此外，我将解释一些混淆的术语，这些术语对理解这篇文章非常有帮助，也是下一集关于以太坊的特里的内容。</p></div><div class="ab cl ke kf hb kg" role="separator"><span class="kh bw bk ki kj kk"/><span class="kh bw bk ki kj kk"/><span class="kh bw bk ki kj"/></div><div class="hm hn ho hp hq"><p id="3e19" class="pw-post-body-paragraph jf jg ii jh b ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc hm dt translated"><strong class="jh ij"> <em class="kl">一些术语</em> </strong></p><blockquote class="km kn ko"><p id="61b2" class="jf jg kl jh b ji jj jk jl jm jn jo jp kp jr js jt kq jv jw jx kr jz ka kb kc hm dt translated">在我们讨论惠普编码之前，我将尝试提前介绍一些术语。然而，这部分与以太坊中的Trie有关，也许你并不熟悉。别担心，我会试着跳过这些东西，让我们用一种直觉的方式来接近它。</p></blockquote><p id="cb6f" class="pw-post-body-paragraph jf jg ii jh b ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc hm dt translated">让我们玩一个游戏。我会给你一张地图和一条路，你必须找到我暗示的动物。</p><p id="1218" class="pw-post-body-paragraph jf jg ii jh b ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc hm dt translated">路径是:3–2–3</p><figure class="ks kt ku kv fq hv"><div class="bz el l di"><div class="kw kx l"/></div><figcaption class="ic id fg fe ff ie if bd b be z ek">The map of animals</figcaption></figure><p id="7a83" class="pw-post-body-paragraph jf jg ii jh b ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc hm dt translated">为了解决这个游戏，我们一步一步地做以下工作:</p><ol class=""><li id="ebda" class="ky kz ii jh b ji jj jm jn jq la ju lb jy lc kc ld le lf lg dt translated">从根开始，路径中的第一个元素是3，这意味着我们必须得到根的元素，用数字3标记，我们可以看到这个元素的值是a。</li><li id="6238" class="ky kz ii jh b ji lh jm li jq lj ju lk jy ll kc ld le lf lg dt translated">找到节点A，路径中的下一个元素是2，所以我们得到节点A中的值是d。</li><li id="72cb" class="ky kz ii jh b ji lh jm li jq lj ju lk jy ll kc ld le lf lg dt translated">找到节点D，path中最后一个元素是3，显然我们找出的值是‘Whale’。</li></ol><p id="d180" class="pw-post-body-paragraph jf jg ii jh b ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc hm dt translated">所以，游戏的动物是鲸鱼。让我们尝试另一条路径:3–1–3–2(结果是“鸡”)。</p><p id="c1c2" class="pw-post-body-paragraph jf jg ii jh b ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc hm dt translated">通过这个游戏，我们熟悉了一些术语:</p><ul class=""><li id="d879" class="ky kz ii jh b ji jj jm jn jq la ju lb jy lc kc lm le lf lg dt translated"><strong class="jh ij">键</strong>:游戏中的根、A、B、C、D、E为键</li><li id="5389" class="ky kz ii jh b ji lh jm li jq lj ju lk jy ll kc lm le lf lg dt translated"><strong class="jh ij">节点</strong>:每行右半部分的键对应的内容。比如:<code class="eh ln lo lp lq b">{1: ‘Dog’, 2: B, 3: A}</code>。</li><li id="e64d" class="ky kz ii jh b ji lh jm li jq lj ju lk jy ll kc lm le lf lg dt translated"><strong class="jh ij">路径</strong>:路径就像游戏中的2–2–3。</li><li id="a0ac" class="ky kz ii jh b ji lh jm li jq lj ju lk jy ll kc lm le lf lg dt translated"><strong class="jh ij"> Value </strong>:你可以看到它在所有节点中都有一些元素，每个元素都是一个键值对。值是元素的右边部分，值可以是一个键或一个动物的名字。</li><li id="5956" class="ky kz ii jh b ji lh jm li jq lj ju lk jy ll kc lm le lf lg dt translated"><strong class="jh ij">半字节</strong>:4位的十六进制形式是一个半字节。比如:<code class="eh ln lo lp lq b">0x1</code>、<code class="eh ln lo lp lq b">0x4</code>、<code class="eh ln lo lp lq b">0xf</code> …</li></ul><p id="78ed" class="pw-post-body-paragraph jf jg ii jh b ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc hm dt translated"><strong class="jh ij"> <em class="kl">区分RLD和惠普的编码</em> </strong></p><p id="0ff1" class="pw-post-body-paragraph jf jg ii jh b ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc hm dt translated">区分RLP和惠普编码真的很容易，RLP用于编码/解码<strong class="jh ij">值</strong>，惠普编码用于编码/解码<strong class="jh ij">路径</strong>。</p></div><div class="ab cl ke kf hb kg" role="separator"><span class="kh bw bk ki kj kk"/><span class="kh bw bk ki kj kk"/><span class="kh bw bk ki kj"/></div><div class="hm hn ho hp hq"><p id="cec7" class="pw-post-body-paragraph jf jg ii jh b ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc hm dt translated"><strong class="jh ij"> <em class="kl">惠普编码目标</em> </strong></p><p id="9c29" class="pw-post-body-paragraph jf jg ii jh b ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc hm dt translated">在这一部分中，我们将会遇到另外两个术语<code class="eh ln lo lp lq b">leaf</code>和<code class="eh ln lo lp lq b">extension</code>，但是我们可以在第三集里模糊它们并讨论细节。</p><p id="4057" class="pw-post-body-paragraph jf jg ii jh b ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc hm dt translated"><code class="eh ln lo lp lq b">Leaf</code>和<code class="eh ln lo lp lq b">extension</code>是两种节点，但是<code class="eh ln lo lp lq b">leaf</code>的路径有<code class="eh ln lo lp lq b">terminator</code>而<code class="eh ln lo lp lq b">extension</code>没有。<code class="eh ln lo lp lq b">Terminator</code>是路径的最后一个字节，十进制的值为<code class="eh ln lo lp lq b">16</code>或十六进制的值为<code class="eh ln lo lp lq b">0x10</code>。</p><p id="0351" class="pw-post-body-paragraph jf jg ii jh b ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc hm dt translated">正如我们所见，路径可能有奇数长度，但奇数长度对机器不友好。所以我们必须将所有奇数长度的路径转换成偶数长度的路径。</p><p id="64a7" class="pw-post-body-paragraph jf jg ii jh b ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc hm dt translated">总而言之，惠普编码的目标是:</p><ol class=""><li id="66ee" class="ky kz ii jh b ji jj jm jn jq la ju lb jy lc kc ld le lf lg dt translated">不用<code class="eh ln lo lp lq b">terminator</code>区分<code class="eh ln lo lp lq b">leaf</code>和<code class="eh ln lo lp lq b">extension</code>。</li><li id="8d35" class="ky kz ii jh b ji lh jm li jq lj ju lk jy ll kc ld le lf lg dt translated">将路径转换为偶数长度。</li></ol><p id="12c3" class="pw-post-body-paragraph jf jg ii jh b ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc hm dt translated"><strong class="jh ij"> <em class="kl">惠普编码规范</em> </strong></p><p id="a811" class="pw-post-body-paragraph jf jg ii jh b ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc hm dt translated">现在，为了方便起见，我们将HP编码中输入的路径称为输入。</p><ul class=""><li id="bd49" class="ky kz ii jh b ji jj jm jn jq la ju lb jy lc kc lm le lf lg dt translated">如果输入有<code class="eh ln lo lp lq b">terminator</code>，从输入中移除<code class="eh ln lo lp lq b">terminator</code>。</li><li id="16b2" class="ky kz ii jh b ji lh jm li jq lj ju lk jy ll kc lm le lf lg dt translated">在输入中创建前缀，其值如下表所示:</li></ul><figure class="ks kt ku kv fq hv"><div class="bz el l di"><div class="kw kx l"/></div><figcaption class="ic id fg fe ff ie if bd b be z ek">Hex-prefix table</figcaption></figure><ul class=""><li id="3e43" class="ky kz ii jh b ji jj jm jn jq la ju lb jy lc kc lm le lf lg dt translated">如果前缀是<code class="eh ln lo lp lq b">0x0</code>或<code class="eh ln lo lp lq b">0x2</code>，在前缀后面加一个填充半字节<code class="eh ln lo lp lq b">0</code>，所以前缀是<code class="eh ln lo lp lq b">0x00</code>和<code class="eh ln lo lp lq b">0x20</code>。这样做的主要原因是我们试图保持路径的偶数长度属性。说服自己:)。</li><li id="dde5" class="ky kz ii jh b ji lh jm li jq lj ju lk jy ll kc lm le lf lg dt translated">给路径添加前缀。</li></ul><p id="c7a9" class="pw-post-body-paragraph jf jg ii jh b ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc hm dt translated">例如:</p><figure class="ks kt ku kv fq hv"><div class="bz el l di"><div class="kw kx l"/></div><figcaption class="ic id fg fe ff ie if bd b be z ek">Examples of HP encoding</figcaption></figure></div><div class="ab cl ke kf hb kg" role="separator"><span class="kh bw bk ki kj kk"/><span class="kh bw bk ki kj kk"/><span class="kh bw bk ki kj"/></div><div class="hm hn ho hp hq"><p id="4e15" class="pw-post-body-paragraph jf jg ii jh b ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc hm dt translated"><strong class="jh ij"> <em class="kl">结论</em> </strong></p><figure class="ks kt ku kv fq hv fe ff paragraph-image"><div class="fe ff lr"><img src="../Images/5874a428b316146a00240d54b7f14605.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*_2JFh7wKDf5pLrbNGzHGqg.jpeg"/></div></figure><p id="61dc" class="pw-post-body-paragraph jf jg ii jh b ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc hm dt translated">现在，我相信我们已经得到了在以太坊与特里战斗的所有武器。在下一集，我们将深入探讨这是我等不及要和你讨论的最激动人心的部分。</p><p id="75fe" class="pw-post-body-paragraph jf jg ii jh b ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc hm dt translated"><strong class="jh ij"> <em class="kl">参考文献</em> </strong></p><p id="77e4" class="pw-post-body-paragraph jf jg ii jh b ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc hm dt translated">维基以太坊</p><div class="hs ht fm fo hu ls"><a href="https://github.com/ethereum/wiki/wiki/Patricia-Tree#specification-compact-encoding-of-hex-sequence-with-optional-terminator" rel="noopener  ugc nofollow" target="_blank"><div class="lt ab ej"><div class="lu ab lv cl cj lw"><h2 class="bd ij fv z el lx eo ep ly er et ih dt translated">以太坊/维基</h2><div class="lz l"><h3 class="bd b fv z el lx eo ep ly er et ek translated">维基-以太坊维基-</h3></div><div class="ma l"><p class="bd b gc z el lx eo ep ly er et ek translated">github.com</p></div></div><div class="mb l"><div class="mc l md me mf mb mg ia ls"/></div></div></a></div><p id="896f" class="pw-post-body-paragraph jf jg ii jh b ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc hm dt translated">原始Golang代码上的惠普编码:</p><div class="hs ht fm fo hu ls"><a href="https://github.com/ethereum/go-ethereum/blob/master/trie/encoding.go" rel="noopener  ugc nofollow" target="_blank"><div class="lt ab ej"><div class="lu ab lv cl cj lw"><h2 class="bd ij fv z el lx eo ep ly er et ih dt translated">以太坊/围棋以太坊</h2><div class="lz l"><h3 class="bd b fv z el lx eo ep ly er et ek translated">以太坊-以太坊协议的官方go实现</h3></div><div class="ma l"><p class="bd b gc z el lx eo ep ly er et ek translated">github.com</p></div></div><div class="mb l"><div class="mh l md me mf mb mg ia ls"/></div></div></a></div><p id="c844" class="pw-post-body-paragraph jf jg ii jh b ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc hm dt translated">我的github上的HP编码和一些注释。</p><div class="hs ht fm fo hu ls"><a href="https://github.com/sontuphan/debug-geth/blob/master/trie/encoding.go" rel="noopener  ugc nofollow" target="_blank"><div class="lt ab ej"><div class="lu ab lv cl cj lw"><h2 class="bd ij fv z el lx eo ep ly er et ih dt translated">sontuphan/debug-geth</h2><div class="lz l"><h3 class="bd b fv z el lx eo ep ly er et ek translated">在GitHub上创建一个帐户，为debug-geth开发做贡献。</h3></div><div class="ma l"><p class="bd b gc z el lx eo ep ly er et ek translated">github.com</p></div></div><div class="mb l"><div class="mi l md me mf mb mg ia ls"/></div></div></a></div><blockquote class="mj"><p id="afe3" class="mk ml ii bd mm mn mo mp mq mr ms kc ek translated"><a class="ae kd" href="https://coincodecap.com/?utm_source=coinmonks" rel="noopener ugc nofollow" target="_blank">直接在您的收件箱中获得最佳软件交易</a></p></blockquote><figure class="mu mv mw mx my hv fe ff paragraph-image"><a href="https://coincodecap.com/?utm_source=coinmonks"><div class="fe ff mt"><img src="../Images/7c0b3dfdcbfea594cc0ae7d4f9bf6fcb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1168/format:webp/0*OJ-qb5G6i863msBB.png"/></div></a></figure></div></div>    
</body>
</html>