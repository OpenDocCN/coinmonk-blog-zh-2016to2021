<html>
<head>
<title>Quantifyng ‘Just-in-Time’ liquidity in Uniswap v3</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">量化Uniswap v3中的“即时”流动性</h1>
<blockquote>原文：<a href="https://medium.com/coinmonks/quantifyng-just-in-time-liquidity-in-uniswap-v3-23ac1db729c5?source=collection_archive---------2-----------------------#2021-08-10">https://medium.com/coinmonks/quantifyng-just-in-time-liquidity-in-uniswap-v3-23ac1db729c5?source=collection_archive---------2-----------------------#2021-08-10</a></blockquote><div><div class="ef hh hi hj hk hl"/><div class="hm hn ho hp hq"><div class=""/><div class=""><h2 id="a69f" class="pw-subtitle-paragraph iq hs ht bd b ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ek translated">第一部分。分析什么是JIT流动性以及JIT流动性如何影响常规LP的回报</h2></div><p id="132e" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated">一些flashbots搜索者对JIT流动性策略的利用可能会成为Uniswap v3用户的一个担忧，因为它可能会产生降低LPs回报的短期影响，并且从长期来看，如果常规流动性提供商变得不愿意提供流动性，则可能会对Uniswap v3协议的长期稳定性产生一些怀疑。在本文中，我将尝试量化这一策略的影响，并阐明这个仍然有些模糊的话题。</p><h1 id="d9e5" class="ke kf ht bd kg kh ki kj kk kl km kn ko iz kp ja kq jc kr jd ks jf kt jg ku kv dt translated">什么是“即时”流动性？</h1><p id="ea81" class="pw-post-body-paragraph ji jj ht jk b jl kw iu jn jo kx ix jq jr ky jt ju jv kz jx jy jz la kb kc kd hm dt translated">首先，为了清楚地解释这种策略是如何运作的，我将引用twitter上的一条重要线索:</p><figure class="ld le lf lg fq lh fe ff paragraph-image"><div role="button" tabindex="0" class="li lj di lk bf ll"><div class="fe ff lc"><img src="../Images/0f4d06a89841625d29285f19f68e701e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FDDtVKHotkBDW-VJJ0U_xA.png"/></div></div></figure><p id="0536" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated">这一战略对Uniswap v3行为者的主要影响可以概括为:</p><ul class=""><li id="8cb1" class="lo lp ht jk b jl jm jo jp jr lq jv lr jz ls kd lt lu lv lw dt translated"><strong class="jk hu">交易员</strong>由于流动性激增，预期价格影响减少，但在所有流动性都是JIT的极端情况下，价格发现将极其困难。</li><li id="2543" class="lo lp ht jk b jl lx jo ly jr lz jv ma jz mb kd lt lu lv lw dt translated"><strong class="jk hu">不使用这种策略的流动性提供者</strong><strong class="jk hu"/>随着应计费用的减少，预期收益减少，但非永久性损失不会。</li></ul><h2 id="5cf8" class="mc kf ht bd kg md me mf kk mg mh mi ko jr mj mk kq jv ml mm ks jz mn mo ku mp dt translated">识别“即时”流动性操作</h2><p id="4d0e" class="pw-post-body-paragraph ji jj ht jk b jl kw iu jn jo kx ix jq jr ky jt ju jv kz jx jy jz la kb kc kd hm dt translated">JIT流动性的提供者要求使用私有中继，如flashbots，以便组织将形成“三明治”的交易(在块的开始添加流动性，在互换后移除流动性)。JIT流动性发生在一个特定的区块，要求大资本集中在最狭窄的可用范围内，以稀释其余有限合伙人提供的活跃流动性。</p><p id="a65c" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated">这种操作的一个例子是块12931127中的flashbots捆绑包#2:</p><figure class="ld le lf lg fq lh fe ff paragraph-image"><div role="button" tabindex="0" class="li lj di lk bf ll"><div class="fe ff mq"><img src="../Images/86f5262647eb1c5a51800be378ef5d47.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zuDyHAG6r1r1ohf1fF0ulA.png"/></div></div></figure><p id="8384" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated">根据Uniswap的图表数据，JIT LP加 8，951，953.29 USDC 8，519.64乙醚的总美元价值约为29，824.445美元。</p><figure class="ld le lf lg fq lh fe ff paragraph-image"><div role="button" tabindex="0" class="li lj di lk bf ll"><div class="fe ff mr"><img src="../Images/08ff582e2cd89eb5af229979ac35066b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kB9CYMAllxTVGvZoRLHXOQ.png"/></div></div></figure><p id="dc59" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated">通常，这个池的活跃分笔成交点的流动性在300万美元到400万美元之间，因此这一新增量占该块可用流动性的80%到90%。</p><p id="6f1c" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated"><strong class="jk hu"> 2- </strong> <a class="ae lb" href="https://etherscan.io/tx/0xdd1f158c51b72792ded55f09147522d926a99e4fda77cf8c37592c9dbf44c0b5" rel="noopener ugc nofollow" target="_blank"> <strong class="jk hu"> JIT LP在他的捆绑包中包括有意义的掉期</strong> </a>总计58.61 ETH掉期，尽管理论上任何数量的掉期都是可行的，但大多数JIT流动性三明治只包括一个巨额掉期:</p><figure class="ld le lf lg fq lh fe ff paragraph-image"><div role="button" tabindex="0" class="li lj di lk bf ll"><div class="fe ff ms"><img src="../Images/b6461eda6284927dff07088b98cde4da.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*exZ6vxak-IjZnMWdDUYfAQ.png"/></div></div></figure><p id="96cc" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated"><strong class="jk hu"> 3- </strong> <a class="ae lb" href="https://etherscan.io/tx/0x245052a15ae6929c665f0e10c7b0817e9863546825a07f03bb9565303f7d209f" rel="noopener ugc nofollow" target="_blank"> <strong class="jk hu"> JIT LP移除</strong> </a> 8，826，855.94 <a class="ae lb" href="https://etherscan.io/token/0xa0b86991c6218b36c1d19d4a2e9eb0ce3606eb48" rel="noopener ugc nofollow" target="_blank"> USDC </a>和8，570.708 ETH的流动资金并收取0，1536 ETH的费用(从收取金额中减去移除金额计算):</p><figure class="ld le lf lg fq lh fe ff paragraph-image"><div role="button" tabindex="0" class="li lj di lk bf ll"><div class="fe ff mt"><img src="../Images/147dd43391c3933091bc9662c8533307.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SmHBoMImqdMgsC2st2MniQ.png"/></div></div></figure><p id="020b" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated">代币金额的差异接近50 ETH，因此JIT LP收取大约80%的掉期，将池LP的应计费用从0.17853 ETH(0.3%的费用)稀释到0,02223 ETH。</p><p id="40c4" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated"><strong class="jk hu"> 4- JIT LP向矿工</strong>支付0，070，856 ETH <strong class="jk hu">的贿赂/费用</strong>，以使他的包裹被开采。</p><p id="78a2" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated">并非所有的JIT操作看起来都有正的EV值，至少考虑到链上数据，然而，不管JIT流动性是否有利可图，stratetgy都通过稀释某个块的应计费用来降低定期LP回报。</p><p id="b1a1" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated">在本系列的下一章，我将尝试分析考虑搜索方的这种MEV策略的总回报。</p><h1 id="ee41" class="ke kf ht bd kg kh ki kj kk kl km kn ko iz kp ja kq jc kr jd ks jf kt jg ku kv dt translated">识别JIT流动性操作的数据模型</h1><p id="4a0a" class="pw-post-body-paragraph ji jj ht jk b jl kw iu jn jo kx ix jq jr ky jt ju jv kz jx jy jz la kb kc kd hm dt translated">为了计算这些操作摊薄的费用，我将使用Uniswap v3图表中的数据，如以下步骤所述:</p><p id="db21" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated"><strong class="jk hu"> 1查询自6月1日以来特定池的所有“mints”、“burns”</strong>(uni swap v3池合同的流动性减少事件)<strong class="jk hu">和“collects”</strong>(流动性减少加上应计费用)，查找以下参数:</p><ul class=""><li id="2779" class="lo lp ht jk b jl jm jo jp jr lq jv lr jz ls kd lt lu lv lw dt translated">区块号、交易Id、原产地EOA和支付的天然气价格</li><li id="8b0f" class="lo lp ht jk b jl lx jo ly jr lz jv ma jz mb kd lt lu lv lw dt translated">铸造、焚烧和收集的代币数量(包括兑换成美元价值的总金额)</li><li id="fb01" class="lo lp ht jk b jl lx jo ly jr lz jv ma jz mb kd lt lu lv lw dt translated">LP选择的价格范围，表示为(tickLower，tickUpper)</li></ul><p id="a4fc" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated"><strong class="jk hu"> 2 </strong>这种方法不适用于EIP-1559年后发生的JIT流动性操作。</p><p id="75a0" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated"><strong class="jk hu"> 3 </strong> <strong class="jk hu">组在同一街区</strong>发生的<strong class="jk hu">由同一EOA发起<strong class="jk hu">的造币、焚烧、收集</strong>。</strong></p><p id="abd9" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated"><strong class="jk hu"> 4将每次JIT流动性操作的应计费用</strong>计算为收集的令牌总数减去消耗的令牌总数。</p><p id="de18" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated"><strong class="jk hu"> 5 </strong>查询uniswap v3图的poolDaydata，以便<strong class="jk hu">估计池</strong>生成的总费用，并将其与JIT操作提取的费用进行比较。</p><p id="4da7" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated">我的Github中提供了一个python脚本，其中包含了用于运行该分析的代码</p><h1 id="d377" class="ke kf ht bd kg kh ki kj kk kl km kn ko iz kp ja kq jc kr jd ks jf kt jg ku kv dt translated"><strong class="ak">ETH/stables池的结果</strong></h1><p id="d183" class="pw-post-body-paragraph ji jj ht jk b jl kw iu jn jo kx ix jq jr ky jt ju jv kz jx jy jz la kb kc kd hm dt translated">上述工作流程已应用于9个资金池(瑞士联邦理工学院/USDC、瑞士联邦理工学院/戴和瑞士联邦理工学院/USDT *每个资金池3个费用等级)，但仅在其中6个资金池中观察到JIT流动性操作。下表提供了总体结果:</p><figure class="ld le lf lg fq lh fe ff paragraph-image"><div role="button" tabindex="0" class="li lj di lk bf ll"><div class="fe ff mu"><img src="../Images/3976cf047ff185d197b48c723bd49426.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6OAaejHptRJB7ODpJIA26g.png"/></div></div></figure><p id="a487" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated">考虑到不同资金池产生的总费用，JIT流动性似乎还没有占据太多份额。</p><p id="4ddc" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated">查看生成的时间序列数据，没有JIT流动性增长的清晰模式:</p><figure class="ld le lf lg fq lh fe ff paragraph-image"><div role="button" tabindex="0" class="li lj di lk bf ll"><div class="fe ff mv"><img src="../Images/9cdcd163a667de0c8361d7fe5019a518.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1pFKRN9CyWz3C_fNHvlvkA.png"/></div></div></figure><h2 id="1178" class="mc kf ht bd kg md me mf kk mg mh mi ko jr mj mk kq jv ml mm ks jz mn mo ku mp dt translated"><strong class="ak">结论:</strong></h2><ul class=""><li id="18a1" class="lo lp ht jk b jl kw jo kx jr mw jv mx jz my kd lt lu lv lw dt translated">JIT流动性不是一种广义的MEV或LP策略，因为它针对不到1%的块，并且似乎仅由一个参与者运行。</li><li id="202a" class="lo lp ht jk b jl lx jo ly jr lz jv ma jz mb kd lt lu lv lw dt translated">没有结论，是否有更多的操作空间，或者更多的搜索者应该竞争同样的机会。</li><li id="a854" class="lo lp ht jk b jl lx jo ly jr lz jv ma jz mb kd lt lu lv lw dt translated">JIT流动性并没有显著降低定期LP回报。</li><li id="652a" class="lo lp ht jk b jl lx jo ly jr lz jv ma jz mb kd lt lu lv lw dt translated">JIT流动性不是一种无风险的MEV策略，因为如果孤立地分析，可能会导致损失。</li><li id="1e23" class="lo lp ht jk b jl lx jo ly jr lz jv ma jz mb kd lt lu lv lw dt translated">显然，这些业务是由一家运营商运营的，该运营商使用<a class="ae lb" href="https://etherscan.io/address/0xa57Bd00134B2850B2a1c55860c9e9ea100fDd6CF" rel="noopener ugc nofollow" target="_blank"> 0xa57bd0013 </a> …作为代理合同，这引发了一个问题，即这种策略是否对其他MEV搜索者或做市商有积极意义，或者我们只能等待它的爆发。</li></ul><p id="cde2" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated"><strong class="jk hu">在</strong><a class="ae lb" href="https://twitter.com/JNP7771" rel="noopener ugc nofollow" target="_blank"><strong class="jk hu">Twitter</strong></a><strong class="jk hu">联系我或者加入</strong> <a class="ae lb" href="https://discord.gg/HwX5a6uSGB" rel="noopener ugc nofollow" target="_blank"> <strong class="jk hu"> LP咖啡馆</strong> </a> <strong class="jk hu">不和谐继续讨论</strong></p><p id="b1eb" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hm dt translated">在我的<a class="ae lb" href="https://github.com/JNP777/Quantifying-JIT-liquidity-Uni_v3" rel="noopener ugc nofollow" target="_blank"> github </a>上有一个回购协议，里面有所有使用过的代码</p><blockquote class="mz"><p id="4c18" class="na nb ht bd nc nd ne nf ng nh ni kd ek translated">加入<a class="ae lb" href="https://t.me/coincodecap" rel="noopener ugc nofollow" target="_blank"> Coinmonks电报频道</a>，了解加密交易和投资</p></blockquote><h2 id="7402" class="mc kf ht bd kg md nj mf kk mg nk mi ko jr nl mk kq jv nm mm ks jz nn mo ku mp dt translated">另外，阅读</h2><ul class=""><li id="3658" class="lo lp ht jk b jl kw jo kx jr mw jv mx jz my kd lt lu lv lw dt translated"><a class="ae lb" rel="noopener" href="/coinmonks/youhodler-vs-coinloan-vs-hodlnaut-b1050acde55a">尤霍德勒vs考尼洛vs霍德诺特</a> | <a class="ae lb" href="https://blog.coincodecap.com/cryptohopper-vs-haasbot" rel="noopener ugc nofollow" target="_blank"> Cryptohopper vs哈斯博特</a></li><li id="c962" class="lo lp ht jk b jl lx jo ly jr lz jv ma jz mb kd lt lu lv lw dt translated"><a class="ae lb" href="https://blog.coincodecap.com/binance-vs-kraken" rel="noopener ugc nofollow" target="_blank">币安vs北海巨妖</a> | <a class="ae lb" href="https://blog.coincodecap.com/pionex-dca-bot" rel="noopener ugc nofollow" target="_blank">美元成本平均交易机器人</a></li><li id="eae3" class="lo lp ht jk b jl lx jo ly jr lz jv ma jz mb kd lt lu lv lw dt translated"><a class="ae lb" rel="noopener" href="/coinmonks/buy-bitcoin-in-india-feb50ddfef94">如何在印度购买比特币？</a> | <a class="ae lb" rel="noopener" href="/coinmonks/wazirx-review-5c811b074f5b"> WazirX评论</a> | <a class="ae lb" href="https://blog.coincodecap.com/bitmex-review" rel="noopener ugc nofollow" target="_blank"> BitMEX评论</a></li><li id="ac2b" class="lo lp ht jk b jl lx jo ly jr lz jv ma jz mb kd lt lu lv lw dt translated"><a class="ae lb" href="https://blog.coincodecap.com/bitcoin-taproot" rel="noopener ugc nofollow" target="_blank">比特币主根</a> | <a class="ae lb" href="https://blog.coincodecap.com/bitso-review" rel="noopener ugc nofollow" target="_blank"> Bitso回顾</a> | <a class="ae lb" rel="noopener" href="/coinmonks/bitcoin-credit-card-bc8ab6f377c6">排名前6的比特币信用卡</a></li><li id="fc6b" class="lo lp ht jk b jl lx jo ly jr lz jv ma jz mb kd lt lu lv lw dt translated"><a class="ae lb" href="https://blog.coincodecap.com/buy-ripple-india" rel="noopener ugc nofollow" target="_blank">如何购买Ripple (XRP) </a> | <a class="ae lb" href="https://blog.coincodecap.com/crypto-exchange-africa" rel="noopener ugc nofollow" target="_blank">非洲最好的加密交易所</a></li><li id="cada" class="lo lp ht jk b jl lx jo ly jr lz jv ma jz mb kd lt lu lv lw dt translated"><a class="ae lb" href="https://blog.coincodecap.com/crypto-exchange-africa" rel="noopener ugc nofollow" target="_blank">非洲最佳加密交易所</a> | <a class="ae lb" href="https://blog.coincodecap.com/hoo-exchange-review" rel="noopener ugc nofollow" target="_blank">胡交易所评论</a></li><li id="edfa" class="lo lp ht jk b jl lx jo ly jr lz jv ma jz mb kd lt lu lv lw dt translated"><a class="ae lb" href="https://blog.coincodecap.com/etoro-robinhood" rel="noopener ugc nofollow" target="_blank"> eToro vs罗宾汉</a>|<a class="ae lb" href="https://blog.coincodecap.com/bybit-bityard-moonxbt" rel="noopener ugc nofollow" target="_blank">MoonXBT vs by bit vs Bityard</a></li><li id="2a41" class="lo lp ht jk b jl lx jo ly jr lz jv ma jz mb kd lt lu lv lw dt translated"><a class="ae lb" href="https://blog.coincodecap.com/stormgain-review" rel="noopener ugc nofollow" target="_blank"> Stormgain回顾</a> | <a class="ae lb" href="https://blog.coincodecap.com/bexplus-review" rel="noopener ugc nofollow" target="_blank"> Bexplus回顾</a> | <a class="ae lb" href="https://blog.coincodecap.com/binance-vs-bittrex" rel="noopener ugc nofollow" target="_blank">币安vs Bittrex </a></li></ul></div></div>    
</body>
</html>