<html>
<head>
<title>Setting Up Hyperledger Besu On Amazon Web Services Using IBFT2</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用IBFT2在Amazon Web Services上设置Hyperledger Besu</h1>
<blockquote>原文：<a href="https://medium.com/coinmonks/setting-up-hyperledger-besu-on-amazon-web-services-using-ibft2-fa8d5f3a1aa3?source=collection_archive---------1-----------------------#2020-03-29">https://medium.com/coinmonks/setting-up-hyperledger-besu-on-amazon-web-services-using-ibft2-fa8d5f3a1aa3?source=collection_archive---------1-----------------------#2020-03-29</a></blockquote><div><div class="ef hh hi hj hk hl"/><div class="hm hn ho hp hq"><div class=""/><p id="eaf3" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">这周我学习了如何在<a class="ae jo" href="https://blog.coincodecap.com/tag/blockchain/" rel="noopener ugc nofollow" target="_blank">区块链</a>中使用AWS。我将使用IBFT2共识算法创建一个私有区块链。我将在私有/公共子网中使用VPC，并创建八个t2.micro类型的EC2实例。两个实例将在私有子网中使用，其余的将在公共子网中使用。</p><h1 id="2d05" class="jp jq ht bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km dt translated">我的议程</h1><ol class=""><li id="1451" class="kn ko ht is b it kp ix kq jb kr jf ks jj kt jn ku kv kw kx dt translated">设定VPC。</li><li id="76d0" class="kn ko ht is b it ky ix kz jb la jf lb jj lc jn ku kv kw kx dt translated">创建安全组。</li><li id="f4e4" class="kn ko ht is b it ky ix kz jb la jf lb jj lc jn ku kv kw kx dt translated">在专用子网上安装bootnodes。</li><li id="9b88" class="kn ko ht is b it ky ix kz jb la jf lb jj lc jn ku kv kw kx dt translated">在公共子网上安装节点。</li><li id="5a71" class="kn ko ht is b it ky ix kz jb la jf lb jj lc jn ku kv kw kx dt translated">改进。</li><li id="ec09" class="kn ko ht is b it ky ix kz jb la jf lb jj lc jn ku kv kw kx dt translated">资源。</li></ol><h1 id="4e98" class="jp jq ht bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km dt translated">设置VPC</h1><p id="6081" class="pw-post-body-paragraph iq ir ht is b it kp iv iw ix kq iz ja jb ld jd je jf le jh ji jj lf jl jm jn hm dt translated">VPC用于部署私有区块链的隔离实例。</p><blockquote class="lg lh li"><p id="1e2d" class="iq ir lj is b it iu iv iw ix iy iz ja lk jc jd je ll jg jh ji lm jk jl jm jn hm dt translated">虚拟私有云(<strong class="is hu"> VPC </strong>)是在公共云环境中分配的按需可配置的共享计算资源池，在使用资源的不同组织之间提供一定程度的隔离。</p></blockquote><p id="568a" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">如果你不知道如何部署VPC，我推荐这篇AWS短片<a class="ae jo" href="https://docs.aws.amazon.com/AmazonECS/latest/developerguide/create-public-private-vpc.html" rel="noopener ugc nofollow" target="_blank">教程</a>。</p><p id="3f81" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">在创建实例之前，我需要初始化它们之间的通信。因此，我将为我的VPC创建一个安全组。</p><h2 id="a5c8" class="ln jq ht bd jr lo lp lq jv lr ls lt jz jb lu lv kd jf lw lx kh jj ly lz kl ma dt translated">创建安全组</h2><p id="566c" class="pw-post-body-paragraph iq ir ht is b it kp iv iw ix kq iz ja jb ld jd je jf le jh ji jj lf jl jm jn hm dt translated">安全组是实例间通信的规则列表，如端口22接受我的设备IP地址。如果你不知道如何让一个安全组检查这个<a class="ae jo" href="https://docs.aws.amazon.com/vpc/latest/userguide/VPC_SecurityGroups.html" rel="noopener ugc nofollow" target="_blank">链接</a>。对于我的情况，我将使用这些规则</p><figure class="mc md me mf fq mg fe ff paragraph-image"><div class="fe ff mb"><img src="../Images/d665164e2cfc52bfa6e01397c075b446.png" data-original-src="https://miro.medium.com/v2/resize:fit:1082/format:webp/1*fQFh7HiLsOdaRnD-KWrHkg.png"/></div><figcaption class="mj mk fg fe ff ml mm bd b be z ek">Note that IP 10.0.0.0 is for the private subnet</figcaption></figure><p id="2957" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">我在PEGASYS网站上找到了以上端口。这是besu网络需要的所有端口。不要忘记为SSH添加端口22。现在，我将创建两个实例，作为专用子网上的引导节点。</p><h2 id="b839" class="ln jq ht bd jr lo lp lq jv lr ls lt jz jb lu lv kd jf lw lx kh jj ly lz kl ma dt translated">访问私有子网</h2><p id="01d0" class="pw-post-body-paragraph iq ir ht is b it kp iv iw ix kq iz ja jb ld jd je jf le jh ji jj lf jl jm jn hm dt translated">专用子网是没有到互联网网关的路由的子网。因此，不可能SSH它的实例。为了能够在您的实例上运行命令，您可以使用<a class="ae jo" href="https://aws.amazon.com/blogs/aws/new-session-manager/" rel="noopener ugc nofollow" target="_blank"> AWS系统管理器会话管理器</a>或<a class="ae jo" href="https://docs.aws.amazon.com/systems-manager/latest/userguide/execute-remote-commands.html" rel="noopener ugc nofollow" target="_blank"> AWS系统管理器运行命令</a>，但在我看来，SSh您的实例的最快和最简单的方法是从公共子网上的另一个实例访问它，然后使用“ncat”打开端口22。这些命令将是:</p><p id="6c54" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">要为私有IP打开端口22:</p><pre class="mc md me mf fq mn mo mp mq aw mr dt"><span id="de17" class="ln jq ht mo b fv ms mt l mu mv">ncat --sh-exec "ncat PRIVATE.SUBNET.IP 22" -l 2222 &amp;</span></pre><p id="6793" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">然后，您需要将您的keypair.pem文件复制到public实例，瞧，就像您通常在本地机器上做的那样运行ssh命令。</p><pre class="mc md me mf fq mn mo mp mq aw mr dt"><span id="95fd" class="ln jq ht mo b fv ms mt l mu mv"><strong class="mo hu">ssh -i "keyname.pem" ubuntu@10.0.0.24</strong></span></pre><p id="299e" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">现在，我已经访问了实例，可以安装bootnode了。</p><p id="0008" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">我将从下载和安装Hyperledger Besu开始。然后，我将ibft2配置为共识算法。以下命令摘自官方文档和PEGASYS网站。请注意，这些命令是所有节点的标准。你可以在文章末尾找到解释它们的链接。</p><pre class="mc md me mf fq mn mo mp mq aw mr dt"><span id="1fe2" class="ln jq ht mo b fv ms mt l mu mv">sudo apt-get update &amp;&amp; sudo apt-get install openjdk-11-jdk<br/>wget <a class="ae jo" href="https://bintray.com/api/ui/download/hyperledger-org/besu-repo/besu-1.3.6.tar.gz" rel="noopener ugc nofollow" target="_blank">https://bintray.com/api/ui/download/hyperledger-org/besu-repo/besu-1.3.6.tar.gz</a><br/>sudo mkdir -p /opt/besu/<br/>sudo chown -R $USER:$USER /opt/besu/<br/>tar -C /opt/besu/ -xvf besu-1.3.6.tar.gz <br/>cd /opt/besu/<br/>touch ibftConfigFile.json</span></pre><p id="fda1" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">打开<code class="eh mw mx my mo b">ibftCongfigFile.json using nano command</code></p><pre class="mc md me mf fq mn mo mp mq aw mr dt"><span id="1cc2" class="ln jq ht mo b fv ms mt l mu mv">nano ibftConfigFile.json</span></pre><p id="80b1" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">然后写</p><pre class="mc md me mf fq mn mo mp mq aw mr dt"><span id="ff99" class="ln jq ht mo b fv ms mt l mu mv">{<br/> "genesis": {<br/>   "config": {<br/>      "chainId": 2018,<br/>      "constantinoplefixblock": 0,<br/>      "ibft2": {<br/>        "blockperiodseconds": 2,<br/>        "epochlength": 30000,<br/>        "requesttimeoutseconds": 10<br/>      }<br/>    },<br/>    "nonce": "0x0",<br/>    "timestamp": "0x58ee40ba",<br/>    "gasLimit": "0x47b760",<br/>    "difficulty": "0x1",<br/>    "mixHash": "0x63746963616c2062797a616e74696e65206661756c7420746f6c6572616e6365",<br/>    "coinbase": "0x0000000000000000000000000000000000000000",<br/>    "alloc": {<br/>       "fe3b557e8fb62b89f4916b721be55ceb828dbd73": {<br/>          "privateKey": "8f2a55949038a9610f50fb23b5883af3b4ecb3c3bb792cbcefbd1542c692be63",<br/>          "comment": "private key and this comment are ignored.  In a real chain, the private key should NOT be stored",<br/>          "balance": "0xad78ebc5ac6200000"<br/>       },<br/>       "627306090abaB3A6e1400e9345bC60c78a8BEf57": {<br/>         "privateKey": "c87509a1c067bbde78beb793e6fa76530b6382a4c0241e5e4a9ec0a0f44dc0d3",<br/>         "comment": "private key and this comment are ignored.  In a real chain, the private key should NOT be stored",<br/>         "balance": "90000000000000000000000"<br/>       },<br/>       "f17f52151EbEF6C7334FAD080c5704D77216b732": {<br/>         "privateKey": "ae6ae8e5ccbfb04590405997ee2d52d2b330726137b875053c36d94e974d162f",<br/>         "comment": "private key and this comment are ignored.  In a real chain, the private key should NOT be stored",<br/>         "balance": "90000000000000000000000"<br/>       }<br/>      }<br/> },<br/> "blockchain": {<br/>   "nodes": {<br/>     "generate": true,<br/>       "count": 4<br/>   }<br/> }<br/>}</span></pre><p id="c506" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">使用besu命令为节点生成密钥</p><pre class="mc md me mf fq mn mo mp mq aw mr dt"><span id="4fd6" class="ln jq ht mo b fv ms mt l mu mv">besu-1.3.6/bin/besu operator generate-blockchain-config --config-file=ibftConfigFile.json --to=networkFiles --private-key-file-name=key</span></pre><p id="9e0d" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">移动gensis.json文件</p><pre class="mc md me mf fq mn mo mp mq aw mr dt"><span id="1069" class="ln jq ht mo b fv ms mt l mu mv">mv networkFiles/genesis.json /opt/besu/</span></pre><p id="b2be" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">然后制作一个文件夹名数据来添加节点的公钥和私钥</p><pre class="mc md me mf fq mn mo mp mq aw mr dt"><span id="d04a" class="ln jq ht mo b fv ms mt l mu mv">mkdir keys<br/>mv networkFiles/keys/0x......./key  keys/<br/>mv networkFiles/keys/0x......./key.pub  /keys/</span></pre><p id="85fc" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">好了，就这样吧！我们已经安装了besu网络，现在节点可以使用了。</p><h2 id="8800" class="ln jq ht bd jr lo lp lq jv lr ls lt jz jb lu lv kd jf lw lx kh jj ly lz kl ma dt translated">初始化Bootnode</h2><p id="de9a" class="pw-post-body-paragraph iq ir ht is b it kp iv iw ix kq iz ja jb ld jd je jf le jh ji jj lf jl jm jn hm dt translated">Bootnode是区块链创建的第一个节点，用于帮助其他同行找到你的区块链。</p><p id="eaea" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">初始化bootnode</p><pre class="mc md me mf fq mn mo mp mq aw mr dt"><span id="ed47" class="ln jq ht mo b fv ms mt l mu mv">besu-1.3.6/bin/besu --data-path=data --genesis-file=./genesis.json --rpc-http-enabled --rpc-http-api=IBFT --rpc-http-host=0.0.0.0 --host-whitelist="*" --rpc-http-cors-origins="all"  --metrics-enabled --metrics-host=0.0.0.0 --metrics-port=9545 --p2p-host=10.0.0.24 &amp;</span></pre><p id="5716" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">(不要忘记在<code class="eh mw mx my mo b">--p2p-host</code>上添加您自己的私人地址)</p><p id="9e6b" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">您可以在文档中找到相同的命令。刚换了私有IP的p2p主机。运行此命令后，您将需要搜索此行:</p><pre class="mc md me mf fq mn mo mp mq aw mr dt"><span id="c354" class="ln jq ht mo b fv ms mt l mu mv">2020-03-28 18:21:47.836+00:00 | main | INFO  | DefaultP2PNetwork | Enode URL enode://d357bdefa4e6f6bdf99020707194823acd0f3d808ef259f47616a4154a7b4d8007b0573d6ebc02cb378f2f5f279205d2e537279a5987ef2a752733cd9cc2a5a1@10.0.0.24:30303</span></pre><p id="3481" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">其他节点将使用Enode URL与您进行连接。好了，现在我们结束了。您可以创建任意数量bootnode。在生产中通常是2个bootnodes。</p><p id="8b5a" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">然后，对于公共子网上的实例，您将重复相同的过程，除了最后一步您将使用Enode URL。</p><pre class="mc md me mf fq mn mo mp mq aw mr dt"><span id="38d4" class="ln jq ht mo b fv ms mt l mu mv">besu-1.3.6/bin/besu  --data-path=data --genesis-file=./genesis.json --node-private-key-file=/opt/besu/keys/key   --bootnodes=enode://ca6c54e4be70c38abbc2d05c4eaafcc057b9e38db33feb67a95ef37a7a5fcccde814e90573193a204502b8948336741fc5a47405a69a2a77f911245671f81c23@10.0.0.24:30303 --rpc-http-enabled --rpc-http-host=0.0.0.0 --host-whitelist="*" --rpc-http-api=ETH,NET,IBFT  --rpc-http-cors-origins="all" --metrics-enabled --metrics-host=0.0.0.0 --metrics-port=9545 --p2p-host=10.0.2.141 &amp;</span></pre><p id="40f6" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">(别忘了在<code class="eh mw mx my mo b">--p2p-host</code>上添加自己的私人地址)</p><p id="cc53" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">就是这样！现在您需要做的就是使用<code class="eh mw mx my mo b">scp</code>将‘besu’目录从第一个实例复制到其他实例。</p><pre class="mc md me mf fq mn mo mp mq aw mr dt"><span id="2700" class="ln jq ht mo b fv ms mt l mu mv">scp -i besuvalidatornode.pem -r ubuntu@10.0.0.24:/opt/besu/data /opt/besu</span></pre><p id="cc74" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">不幸的是，仅使用两个节点无法实现拜占庭容错(尽管有节点，但仍能正确运行并达成共识的能力)。你可以找到关于<a class="ae jo" href="https://besu.hyperledger.org/en/stable/Concepts/Consensus-Protocols/Comparing-PoA/" rel="noopener ugc nofollow" target="_blank"> ibft2 </a>如何工作的细节。</p><h1 id="27fa" class="jp jq ht bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km dt translated">丰富</h1><ul class=""><li id="fed0" class="kn ko ht is b it kp ix kq jb kr jf ks jj kt jn mz kv kw kx dt translated">最明显的就是增加实例的数量，或者使用比' t2.micro '更好的实例类型。</li><li id="9371" class="kn ko ht is b it ky ix kz jb la jf lb jj lc jn mz kv kw kx dt translated">使用Orion作为私有事务管理器。它生成并维护私有/公共密钥对，提供一个用于Orion节点之间通信的API，以及一个用于与以太坊客户端通信的API等等。你可以在Orion <a class="ae jo" href="https://docs.orion.pegasys.tech/en/latest/" rel="noopener ugc nofollow" target="_blank"> Orion文档</a>上找到所有细节。</li><li id="5d48" class="kn ko ht is b it ky ix kz jb la jf lb jj lc jn mz kv kw kx dt translated">或者可以在Docker上使用Besu。</li></ul><blockquote class="na"><p id="9d4c" class="nb nc ht bd nd ne nf ng nh ni nj jn ek translated"><a class="ae jo" href="https://coincodecap.com/?utm_source=coinmonks" rel="noopener ugc nofollow" target="_blank">直接在您的收件箱中获得最佳软件交易</a></p></blockquote><figure class="nl nm nn no np mg fe ff paragraph-image"><a href="https://coincodecap.com/?utm_source=coinmonks"><div class="fe ff nk"><img src="../Images/7c0b3dfdcbfea594cc0ae7d4f9bf6fcb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1168/format:webp/0*OJ-qb5G6i863msBB.png"/></div></a></figure><h2 id="fbc0" class="ln jq ht bd jr lo lp lq jv lr ls lt jz jb lu lv kd jf lw lx kh jj ly lz kl ma dt translated">在Docker上使用Besu</h2><p id="aeae" class="pw-post-body-paragraph iq ir ht is b it kp iv iw ix kq iz ja jb ld jd je jf le jh ji jj lf jl jm jn hm dt translated">您需要做的就是运行这个命令。然后在您的实例上运行带有Orion的IBFT2。</p><pre class="mc md me mf fq mn mo mp mq aw mr dt"><span id="1489" class="ln jq ht mo b fv ms mt l mu mv">./run-privacy.sh -c ibft2</span></pre><p id="c968" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">Besu样本网络容器为您提供了许多选项来运行所有类型的算法。您需要定制您的容器，以便只包含您需要的内容，并避免浪费资源。如果您运行上面的命令，它将创建4个节点:第一个节点是bootnode，其他节点依赖于它。因此，如果bootnode失败，所有其他节点都会失败。为了在<strong class="is hu">生产</strong>中使用Besu示例网络，您需要通过添加另一个bootnode并为其创建另外三个节点来修改<code class="eh mw mx my mo b">filedocker-compose_poa.yml</code>。请注意，我不必这样做，因为我出于教育目的使用了微实例，并且我自己实现了所有节点。</p><p id="0890" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">我希望我说清楚了。但是，如果你有任何问题，请随时问我。</p><h1 id="a58e" class="jp jq ht bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km dt translated">资源</h1><p id="8332" class="pw-post-body-paragraph iq ir ht is b it kp iv iw ix kq iz ja jb ld jd je jf le jh ji jj lf jl jm jn hm dt translated"><a class="ae jo" href="https://besu.hyperledger.org/en/stable/Tutorials/Private-Network/Create-IBFT-Network/" rel="noopener ugc nofollow" target="_blank"> Besu创建IBFT2网络的官方文件</a></p><p id="20c9" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated"><a class="ae jo" href="https://pegasys.tech/setting-up-hyperledger-besu-in-aws/" rel="noopener ugc nofollow" target="_blank">在Aws中设置Hyperledger Besu</a></p><p id="0576" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated"><a class="ae jo" href="https://forums.aws.amazon.com/thread.jspa?threadID=66103" rel="noopener ugc nofollow" target="_blank">亚马逊Web服务表单到SSH的私有子网</a></p><figure class="mc md me mf fq mg fe ff paragraph-image"><div role="button" tabindex="0" class="nr ns di nt bf nu"><div class="fe ff nq"><img src="../Images/e9dbce386c4f90837b5db529a4c87766.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5fZu_SfnNF6m_BGbXlsl-A@2x.png"/></div></div></figure></div></div>    
</body>
</html>