<html>
<head>
<title>Implementing Data Privatization Within Hyperledger Composer</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在Hyperledger Composer中实施数据私有化</h1>
<blockquote>原文：<a href="https://medium.com/coinmonks/implementing-data-privatization-within-hyperledger-composer-2bc99a11c344?source=collection_archive---------1-----------------------#2018-08-06">https://medium.com/coinmonks/implementing-data-privatization-within-hyperledger-composer-2bc99a11c344?source=collection_archive---------1-----------------------#2018-08-06</a></blockquote><div><div class="ef hh hi hj hk hl"/><div class="hm hn ho hp hq"><div class=""/><figure class="fi fk ir is it iu fe ff paragraph-image"><div class="fe ff iq"><img src="../Images/3f43527f96746850437a98f80bb783af.png" data-original-src="https://miro.medium.com/v2/resize:fit:1120/format:webp/1*7Y-pwoaukoWMzXhqvzgR5g.png"/></div></figure><p id="6f5a" class="pw-post-body-paragraph ix iy ht iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju hm dt translated">虽然Hyperledger区块链网络的一些最重要的功能是透明和信任，但在业务情况下，有时仍然需要数据隐私。</p><p id="9ba5" class="pw-post-body-paragraph ix iy ht iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju hm dt translated">有几种方法可以考虑数据隐私和机密性。根据您的网络架构，您可能希望使用<a class="ae jv" href="https://hyperledger-fabric.readthedocs.io/en/release-1.1/channels.html" rel="noopener ugc nofollow" target="_blank">通道</a>并最终使用<a class="ae jv" href="https://hyperledger-fabric.readthedocs.io/en/release-1.2/private-data/private-data.html" rel="noopener ugc nofollow" target="_blank">集合</a>在Hyperledger结构级别解决这个问题。在本文中，我们将使用Hyperledger Composer在业务网络设计的更高层次上解决这个问题。</p><p id="9a77" class="pw-post-body-paragraph ix iy ht iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju hm dt translated">考虑这样的情况，不同的参与者需要访问在他们的业务关系中交换/管理的部分私有化的数据。例如，在供应链管理系统中，让我们假设买方和卖方是同一组织的一部分，并且在Hyperledger Composer模型中被表示为业务网络定义中的不同参与者。在这个场景中，买方向卖方下订单购买商品。在订单中，可能会有只有卖家可以更新和查看的信息，比如批发价、支付信息、可用性、库存等。还可能存在双方都应该有权访问的公共数据，如零售价格、订单id、跟踪号、客户地址。</p><p id="b6a3" class="pw-post-body-paragraph ix iy ht iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju hm dt translated">Hyperledger Composer提供的好处之一是简单的建模来定义访问控制规则，以管理已定义的资产、参与者和事务。访问控制语法允许针对整个资产和/或交易功能定义规则。目前，无法针对资产中的特定数据字段定义规则。那么，除了在应用程序级别限制对资产数据的访问，我们如何在网络级别限制访问呢？</p><p id="74c6" class="pw-post-body-paragraph ix iy ht iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju hm dt translated">基本上，有两种不同的方法:</p><p id="e8ef" class="pw-post-body-paragraph ix iy ht iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju hm dt translated"><strong class="iz hu">方法#1 </strong>:限制对资产的完全访问(在这种情况下是<em class="jw">订单</em>)，但是提供明确的用户定义的事务函数和对那些函数的访问控制规则，允许对资产内的单个数据字段进行有限的访问。</p><figure class="jy jz ka kb fq iu fe ff paragraph-image"><div role="button" tabindex="0" class="kc kd di ke bf kf"><div class="fe ff jx"><img src="../Images/02dbcf01a24e0d6283f767ba1a8c7280.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PeihQdlMVLuaasLbYMv1KQ.png"/></div></div></figure><p id="1603" class="pw-post-body-paragraph ix iy ht iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju hm dt translated">这个例子的代码位于<a class="ae jv" href="https://github.com/annumberhocker/hlc_confidentiality_ex/tree/master/private-data-example1" rel="noopener ugc nofollow" target="_blank">这里</a>。</p><p id="be26" class="pw-post-body-paragraph ix iy ht iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju hm dt translated">注意<a class="ae jv" href="https://github.com/annumberhocker/hlc_confidentiality_ex/blob/master/private-data-example1/permissions.acl" rel="noopener ugc nofollow" target="_blank"> permissions.acl </a>文件中的规则。给予<em class="jw">订单</em>资产的唯一访问权是在<em class="jw"> CreateOrder </em>交易功能内创建它的能力:</p><figure class="jy jz ka kb fq iu fe ff paragraph-image"><div role="button" tabindex="0" class="kc kd di ke bf kf"><div class="fe ff kg"><img src="../Images/837def72bebb1f5e6745b098b0c951f9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*muSe57P0c7h8yYx0cbSH8Q.png"/></div></div></figure><p id="fa50" class="pw-post-body-paragraph ix iy ht iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju hm dt translated">因此，对<em class="jw">订单</em>资产的各个字段的访问是通过交易处理器功能进行的，例如:</p><figure class="jy jz ka kb fq iu fe ff paragraph-image"><div role="button" tabindex="0" class="kc kd di ke bf kf"><div class="fe ff kh"><img src="../Images/cf8a3bc5b99390b9e723afb1703c7935.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CHl3b2nqNzcL7l36PSc7Mg.png"/></div></div></figure><p id="a7b7" class="pw-post-body-paragraph ix iy ht iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju hm dt translated">要了解数据私有化的实际情况:</p><p id="0b8e" class="pw-post-body-paragraph ix iy ht iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju hm dt translated">1)调用在线<a class="ae jv" href="https://composer-playground.mybluemix.net/login" rel="noopener ugc nofollow" target="_blank">Hyperledger Composer Playground</a>。<br/> 2)“部署新的业务网络”<br/> 3)选择“放在这里上传或浏览”并选择<a class="ae jv" href="https://github.com/annumberhocker/hlc_confidentiality_ex/blob/master/private-data-example1/private-data-example1%400.0.1.bna" rel="noopener ugc nofollow" target="_blank">private-data-example 1 @ 0 . 0 . 1 . bna</a>。<br/> 4)“部署变更”。<br/> 5)选择“测试”标签。<br/> 6)创建一个<em class="jw">买方</em>和一个<em class="jw">卖方</em>参与者。<br/> 7)为<em class="jw">买方</em>和<em class="jw">卖方</em>创建id。为此，请参见<a class="ae jv" href="https://hyperledger.github.io/composer/latest/playground/id-cards-playground" rel="noopener ugc nofollow" target="_blank">创建商务名片</a>。<br/> 8)切换到<em class="jw">卖家</em> id。<br/> 9)作为<em class="jw">卖家</em>，提交<em class="jw"> CreateOrder </em>交易函数。<br/>注意:您需要切换回管理员id来查看新的<em class="jw">订单</em>资产，因为<em class="jw">买方</em>和<em class="jw">卖方</em>都没有实际<em class="jw">订单</em>资产的读取权限。<br/>10)<em class="jw">卖方</em>可以使用<em class="jw">更新订单价格</em>、<em class="jw">更新订单买方信息</em>和<em class="jw">更新订单卖方信息</em>交易函数来更新<em class="jw">订单</em>资产上的买方信息、卖方信息和价格。<br/> 11)切换到<em class="jw">买家</em> id，尝试一个<em class="jw"> UpdateOrderBuyerInfo </em>交易。<em class="jw">买方</em>只能更新<em class="jw">订单</em>资产的买方信息。</p><p id="1405" class="pw-post-body-paragraph ix iy ht iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju hm dt translated">这种方法的一个问题是查询无法从私有化的资产中获取信息。查询受访问控制规则的约束(见<a class="ae jv" href="https://hyperledger.github.io/composer/latest/business-network/query.html" rel="noopener ugc nofollow" target="_blank">查询</a>)，在这种情况下，不允许对私有资产进行直接访问。事件可用于获取数据，如我们在模型中所示(参见<a class="ae jv" href="https://github.com/annumberhocker/hlc_confidentiality_ex/blob/master/private-data-example1/models/org.privatedata.exampleone.cto" rel="noopener ugc nofollow" target="_blank">org . privatedata . example one . CTO</a>和<a class="ae jv" href="https://github.com/annumberhocker/hlc_confidentiality_ex/blob/master/private-data-example1/lib/logic.js" rel="noopener ugc nofollow" target="_blank"> logic.js </a>文件)。然而，一旦事件被生成，并且应用程序被设置为订阅它们(参见<a class="ae jv" href="https://hyperledger.github.io/composer/latest/applications/subscribing-to-events.html" rel="noopener ugc nofollow" target="_blank">事件</a>)，应用程序就可以获得它所知道的任何事件，从而获得对有效负载的访问。</p><p id="b14f" class="pw-post-body-paragraph ix iy ht iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju hm dt translated">在这个例子中，我们只演示了从一个<em class="jw">卖方</em>许可的交易函数中发出事件。为了便于讨论，我们将说，我们发布这些事件只是为了让<em class="jw">销售者</em>授权的应用程序功能接收这些事件并对其进行操作。</p><p id="7248" class="pw-post-body-paragraph ix iy ht iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju hm dt translated"><strong class="iz hu">方法#2 </strong>:将私有数据抽象成它自己的资产，并控制对私有数据资产本身的访问。</p><figure class="jy jz ka kb fq iu fe ff paragraph-image"><div role="button" tabindex="0" class="kc kd di ke bf kf"><div class="fe ff ki"><img src="../Images/8edbb8fff663d3c9cd140f937dab8577.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jB5X_ngArWxHIUaP2XjPGA.png"/></div></div></figure><p id="d538" class="pw-post-body-paragraph ix iy ht iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju hm dt translated">这个例子的代码位于<a class="ae jv" href="https://github.com/annumberhocker/hlc_confidentiality_ex/tree/master/private-data-example2" rel="noopener ugc nofollow" target="_blank">这里</a>。</p><p id="d7ee" class="pw-post-body-paragraph ix iy ht iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju hm dt translated">在这里，我们将<em class="jw">订单</em>资产中的私有数据分离出来，放在<a class="ae jv" href="https://github.com/annumberhocker/hlc_confidentiality_ex/blob/master/private-data-example2/models/org.privatedata.exampletwo.cto" rel="noopener ugc nofollow" target="_blank">org . privatedata . example two . CTO</a>文件中它自己的<em class="jw"> OrderSellerInfo </em>资产中:</p><figure class="jy jz ka kb fq iu fe ff paragraph-image"><div role="button" tabindex="0" class="kc kd di ke bf kf"><div class="fe ff kj"><img src="../Images/f42ffb1a0adf2e854ec8c09f1df6d5d8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CE01zh5Z1PR9TGkcUpV7dQ.png"/></div></div></figure><p id="8f69" class="pw-post-body-paragraph ix iy ht iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju hm dt translated">允许销售者访问私有数据资产的访问控制规则如下:</p><figure class="jy jz ka kb fq iu fe ff paragraph-image"><div role="button" tabindex="0" class="kc kd di ke bf kf"><div class="fe ff kk"><img src="../Images/0f71b266c058b3be3d0085350e786e35.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-mDoZtzBYWzNlB53i09pQQ.png"/></div></div></figure><p id="e351" class="pw-post-body-paragraph ix iy ht iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju hm dt translated">要查看本例中的数据私有化:</p><p id="d2e6" class="pw-post-body-paragraph ix iy ht iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju hm dt translated">1)调用在线<a class="ae jv" href="https://composer-playground.mybluemix.net/login" rel="noopener ugc nofollow" target="_blank">Hyperledger Composer Playground</a>。<br/> 2)“部署新业务网络”<br/> 3)选择“拖放到此处上传或浏览”，选择<a class="ae jv" href="https://github.com/annumberhocker/hlc_confidentiality_ex/blob/master/private-data-example2/private-data-example2%400.0.1.bna" rel="noopener ugc nofollow" target="_blank">private-data-example 2 @ 0 . 0 . 1 . bna</a><br/>4)“部署变更”。<br/> 5)选择“测试”选项卡。<br/> 6)创建一个<em class="jw">买方</em>和一个<em class="jw">卖方</em>参与者。<br/> 7)为<em class="jw">买方</em>和<em class="jw">卖方</em>创建id。为此，请参见<a class="ae jv" href="https://hyperledger.github.io/composer/latest/playground/id-cards-playground" rel="noopener ugc nofollow" target="_blank">创建商务名片</a>。8)切换到<em class="jw">卖家</em> id。<br/> 9)作为<em class="jw">卖家</em>，提交<em class="jw"> CreateOrder </em>交易功能。注意:将创建一个<em class="jw">订单</em>资产和一个<em class="jw"> OrderSellerInfo </em>资产。<em class="jw">卖家</em>可以看到两者。<br/> 10)作为<em class="jw">卖方</em>，调用<em class="jw"> CreateOrder </em>交易函数。<br/> 11)更改为<em class="jw">买方</em>身份，您将只能看到<em class="jw">订单</em>资产。<br/>12)<em class="jw">卖方</em>可以使用<em class="jw"> UpdateOrderBuyerInfo </em>和<em class="jw"> UpdateOrderSellerInfo </em>交易函数更新<em class="jw">订单</em>资产上的buyerInfo和sellerInfo。<br/>13)<em class="jw">采购员</em>只能更新<em class="jw">订单</em>资产上的采购员信息。</p><p id="fc31" class="pw-post-body-paragraph ix iy ht iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju hm dt translated">为了完成这个例子，可以将一个. qry文件添加到模型中(参见<a class="ae jv" href="https://github.com/annumberhocker/hlc_confidentiality_ex/blob/master/private-data-example2/queries.qry" rel="noopener ugc nofollow" target="_blank"> queries.qry </a>)来定义针对私有化资产的查询，并且可以添加一个事务函数来包含调用已经定义的查询的代码，以访问私有化资产数据。或者可以直接从客户端应用程序调用查询。更多信息参见<a class="ae jv" href="https://hyperledger.github.io/composer/latest/tutorials/queries" rel="noopener ugc nofollow" target="_blank">查询教程</a>和<a class="ae jv" href="https://hyperledger.github.io/composer/latest/api/client-businessnetworkconnection#buildquery" rel="noopener ugc nofollow" target="_blank">查询语言参考文档</a>。</p><p id="b9d0" class="pw-post-body-paragraph ix iy ht iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju hm dt translated">总之，Hyperledger的灵活性提供了在结构级别(参见<a class="ae jv" href="https://hyperledger-fabric.readthedocs.io/en/release-1.2/private_data_tutorial.html" rel="noopener ugc nofollow" target="_blank">教程</a>了解使用集合，1.2版中的新功能)和组合器/智能合约级别解决数据隐私需求的机制，如本文所示。快乐区块链。</p></div></div>    
</body>
</html>