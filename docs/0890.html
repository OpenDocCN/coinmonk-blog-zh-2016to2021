<html>
<head>
<title>Using the EOS Smart Contract “Data”</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用EOS智能合同“数据”</h1>
<blockquote>原文：<a href="https://medium.com/coinmonks/using-the-eos-smart-contract-data-a3244b415410?source=collection_archive---------4-----------------------#2018-06-28">https://medium.com/coinmonks/using-the-eos-smart-contract-data-a3244b415410?source=collection_archive---------4-----------------------#2018-06-28</a></blockquote><div><div class="ef hh hi hj hk hl"/><div class="hm hn ho hp hq"><div class=""/><figure class="fi fk ir is it iu fe ff paragraph-image"><div role="button" tabindex="0" class="iv iw di ix bf iy"><div class="fe ff iq"><img src="../Images/7818d530e32fb436fb16a5e040c883d7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Qr-wEjWvPMqn3Mr71fIKXw.png"/></div></div></figure><p id="e1c3" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">在本帖中，我们将讨论如何在智能合约上传输数据。智能合同数据引用了cleos帮助中的术语。</p><pre class="jz ka kb kc fq kd ke kf kg aw kh dt"><span id="46cc" class="ki kj ht ke b fv kk kl l km kn">Push a transaction with a single action<br/>Usage: cleos push action [OPTIONS] account action data</span></pre><h1 id="d2fc" class="ko kj ht bd kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk dt translated"><strong class="ak">基本结构</strong></h1><pre class="jz ka kb kc fq kd ke kf kg aw kh dt"><span id="08bf" class="ki kj ht ke b fv kk kl l km kn">#include &lt;eosiolib/eosio.hpp&gt;<br/>#include &lt;eosiolib/print.hpp&gt;</span><span id="2480" class="ki kj ht ke b fv ll kl l km kn">using namespace eosio;</span><span id="d797" class="ki kj ht ke b fv ll kl l km kn">class hiworld : public eosio::contract {<br/>  private:<br/>  <br/>  public:<br/>    using contract::contract;</span><span id="c471" class="ki kj ht ke b fv ll kl l km kn">void hi( account_name user) {<br/>        print("hi message");<br/>    }</span><span id="1403" class="ki kj ht ke b fv ll kl l km kn">void bye( account_name user ) {<br/>        print("bye message");<br/>    }<br/>};</span><span id="07cd" class="ki kj ht ke b fv ll kl l km kn">EOSIO_ABI( hiworld, (hi) (bye) )</span></pre><p id="2896" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">只需编写示例代码。</p><pre class="jz ka kb kc fq kd ke kf kg aw kh dt"><span id="7a5b" class="ki kj ht ke b fv kk kl l km kn">eosiocpp -o hiworld.wast hiworld.cpp</span><span id="5765" class="ki kj ht ke b fv ll kl l km kn">eosiocpp -g hiworld.abi hiworld.cpp</span></pre><p id="244a" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">编制</p><p id="45c2" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">如果您看到Action hi，您将能够看到“void hi ( account_name user ) {”。了解了这些，打开hiworld.abi文件。</p><pre class="jz ka kb kc fq kd ke kf kg aw kh dt"><span id="a9bb" class="ki kj ht ke b fv kk kl l km kn">{<br/>  "____comment": "This file was generated by eosio-abigen. DO NOT EDIT - 2018-06-21T08:42:39",<br/>  "version": "eosio::abi/1.0",<br/>  "types": [],<br/>  "structs": [{<br/>      "name": "hi",<br/>      "base": "",<br/>      "fields": [{<br/>          "name": "user",<br/>          "type": "name"<br/>        }<br/>      ]<br/>    },{<br/>      "name": "bye",<br/>      "base": "",<br/>      "fields": [{<br/>          "name": "user",<br/>          "type": "name"<br/>        }<br/>      ]<br/>    }<br/>  ],<br/>  "actions": [{<br/>      "name": "hi",<br/>      "type": "hi",<br/>      "ricardian_contract": ""<br/>    },{<br/>      "name": "bye",<br/>      "type": "bye",<br/>      "ricardian_contract": ""<br/>    }<br/>  ],<br/>  "tables": [],<br/>  "ricardian_clauses": [],<br/>  "error_messages": [],<br/>  "abi_extensions": []<br/>}</span></pre><p id="44be" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">打开hiworld.abi文件后，您会看到类似上面的内容。</p><p id="c664" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">从上面的“__comment”你大概可以猜到，eosio会自动创建一个abi文件。之前使用的EOS iocpp–g选项是自动创建这个abi的选项。</p><pre class="jz ka kb kc fq kd ke kf kg aw kh dt"><span id="ae54" class="ki kj ht ke b fv kk kl l km kn">"structs": [{<br/>      "name": "hi",<br/>      "base": "",<br/>      "fields": [{<br/>          "name": "user",<br/>          "type": "name"<br/>        }<br/>      ]<br/>    },{<br/>      "name": "bye",<br/>      "base": "",<br/>      "fields": [{<br/>          "name": "user",<br/>          "type": "name"<br/>        }<br/>      ]<br/>    }<br/>  ],</span></pre><p id="9747" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">如果您查看struct部分，可以看到function参数在Action函数的形状中注册为Action的数据。</p><p id="7563" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">现在，像下面这样修改源代码，并检查abi文件是如何创建的。</p><pre class="jz ka kb kc fq kd ke kf kg aw kh dt"><span id="4407" class="ki kj ht ke b fv kk kl l km kn">void hi( account_name user, uint64_t number) {<br/>        print("hi message");<br/>}</span></pre><p id="e063" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">向hiworld.cpp的hi Action函数添加参数。</p><pre class="jz ka kb kc fq kd ke kf kg aw kh dt"><span id="0869" class="ki kj ht ke b fv kk kl l km kn">eosiocpp -o hiworld.wast hiworld.cpp</span><span id="b968" class="ki kj ht ke b fv ll kl l km kn">eosiocpp -g hiworld.abi hiworld.cpp</span></pre><p id="75e9" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">编译并检查abi文件。</p><pre class="jz ka kb kc fq kd ke kf kg aw kh dt"><span id="6b2a" class="ki kj ht ke b fv kk kl l km kn">"structs": [{<br/>      "name": "hi",<br/>      "base": "",<br/>      "fields": [{<br/>          "name": "user",<br/>          "type": "name"<br/>        },{<br/>          "name": "number",<br/>          "type": "uint64"<br/>        }<br/>      ]<br/>    },{<br/>      "name": "bye",<br/>      "base": "",<br/>      "fields": [{<br/>          "name": "user",<br/>          "type": "name"<br/>        }<br/>      ]<br/>    }<br/>  ],</span></pre><p id="60ee" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">您将能够检查修改后的名称:编号，类型:uint64是否已添加。</p><pre class="jz ka kb kc fq kd ke kf kg aw kh dt"><span id="aa01" class="ki kj ht ke b fv kk kl l km kn">#cleos set contract usersc ~/sc/hiworld/</span></pre><p id="9f49" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">上传修订后的智能合同。</p><pre class="jz ka kb kc fq kd ke kf kg aw kh dt"><span id="607f" class="ki kj ht ke b fv kk kl l km kn">#cleos push action usersc hi -p usersc</span></pre><p id="f8dd" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">如果您从如下所示的语法中删除数据部分，cleos会将其过滤掉。数据是必须的。</p><figure class="jz ka kb kc fq iu fe ff paragraph-image"><div role="button" tabindex="0" class="iv iw di ix bf iy"><div class="fe ff lm"><img src="../Images/b1d57876c7afe286c9c9139ce10ac696.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XJBDdTYYHNSdB-o4NNGlNQ.png"/></div></div></figure><pre class="jz ka kb kc fq kd ke kf kg aw kh dt"><span id="46f0" class="ki kj ht ke b fv kk kl l km kn"># cleos push action usersc hi '' -p usersc</span></pre><p id="b93d" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">如果您将数据留空为''，如上所示，您将无法通过区块链审核。</p><figure class="jz ka kb kc fq iu fe ff paragraph-image"><div role="button" tabindex="0" class="iv iw di ix bf iy"><div class="fe ff lm"><img src="../Images/a315200b0d14aaf846e14f3e724f44da.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fxm6fSxWabu4OaPlnb3P_Q.png"/></div></div></figure><pre class="jz ka kb kc fq kd ke kf kg aw kh dt"><span id="df76" class="ki kj ht ke b fv kk kl l km kn"># cleos push action usersc hi '["test"]' -p usersc</span></pre><p id="c520" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">如果您声明了2个数据，但如上所示只发送了1个，</p><figure class="jz ka kb kc fq iu fe ff paragraph-image"><div role="button" tabindex="0" class="iv iw di ix bf iy"><div class="fe ff lm"><img src="../Images/0d7624c691f8cffeceb75d89a65d982e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Jlw0hOmeNRaf9xCH08IHQA.png"/></div></div></figure><p id="e17d" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">你应该会很容易成功。</p><p id="88ad" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">[Trap]如果声明2，实际上必须发送两个数据，否则会出错。但是，在上面的例子中，uint64_t类型被直接从空值解释为0。</p><pre class="jz ka kb kc fq kd ke kf kg aw kh dt"><span id="901f" class="ki kj ht ke b fv kk kl l km kn"># cleos push action usersc hi '["test","a"]' -p usersc</span></pre><p id="5c43" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">在这种情况下，如果数据类型是一个数字，但你作为一个字符执行。</p><figure class="jz ka kb kc fq iu fe ff paragraph-image"><div role="button" tabindex="0" class="iv iw di ix bf iy"><div class="fe ff lm"><img src="../Images/fa1b3837f300d7324800c7c9720463ef.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*EbTPgVDWiYjSeAuMFqPo4w.png"/></div></div></figure><p id="2b44" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">区块链检测数据类型，如果类型不同，就会出错。</p><p id="3142" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">在这篇文章中，我们回顾了智能合约动作数据，以及哪些调用是允许的。</p></div><div class="ab cl ln lo hb lp" role="separator"><span class="lq bw bk lr ls lt"/><span class="lq bw bk lr ls lt"/><span class="lq bw bk lr ls"/></div><div class="hm hn ho hp hq"><h2 id="2172" class="ki kj ht bd kp lu lv lw kt lx ly lz kx jm ma mb lb jq mc md lf ju me mf lj mg dt translated">ITAM游戏是一个透明的游戏生态系统的区块链平台</h2><p id="5d69" class="pw-post-body-paragraph jb jc ht jd b je mh jg jh ji mi jk jl jm mj jo jp jq mk js jt ju ml jw jx jy hm dt translated">订阅ITAM游戏并接收最新信息。</p><p id="4717" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">访问ITAM游戏电讯，就ITAM游戏和区块链进行交流。点击下面的链接加入！👫</p><p id="2bd0" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">网址:<strong class="jd hu"/><a class="ae mm" href="https://itam.games" rel="noopener ugc nofollow" target="_blank">https://itam . games</a><strong class="jd hu"><br/></strong>电报:<a class="ae mm" href="https://t.me/itamgames" rel="noopener ugc nofollow" target="_blank">https://t.me/itamgames</a></p></div></div>    
</body>
</html>