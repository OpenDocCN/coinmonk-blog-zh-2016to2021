<html>
<head>
<title>Get Married on the Blockchain!</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在区块链上结婚！</h1>
<blockquote>原文：<a href="https://medium.com/coinmonks/get-married-on-the-blockchain-25091f12399b?source=collection_archive---------0-----------------------#2019-03-22">https://medium.com/coinmonks/get-married-on-the-blockchain-25091f12399b?source=collection_archive---------0-----------------------#2019-03-22</a></blockquote><div><div class="ef hh hi hj hk hl"/><div class="hm hn ho hp hq"><div class=""/><p id="e8e3" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">或者区块链如何也能彻底改变我们的关系…</p><figure class="jp jq jr js fq jt fe ff paragraph-image"><div role="button" tabindex="0" class="ju jv di jw bf jx"><div class="fe ff jo"><img src="../Images/0cdfb8abee1878daa3578024c232bae8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*napNhvRdpp7dnZp8bpyxNQ.png"/></div></div><figcaption class="ka kb fg fe ff kc kd bd b be z ek">Picture from undraw.co</figcaption></figure><p id="4d3e" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">自从我听说它的那一刻起，我就一直对智能合约给我们带来的巨大可能性着迷，我觉得它们仍然被低估了。</p><p id="4bbd" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">我大约两年前开始对比特币感兴趣，但就在几个月前，我发现了以太坊区块链和可靠性。从那时起，我就无法阻止自己阅读关于这个主题的所有资料。我订阅了邮件列表，直接在我的邮箱中接收关于以太坊和Solidity的文章，我经常偷看Solidity文档，并且我阅读了无数关于这个主题的教程。</p><p id="af12" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">然而，看起来除了大公司之外，没有多少人试图以一种更“颠覆性”的方式使用以太坊区块链。大多数教程教授如何创建ERC20令牌或投票系统。我经常让自己的思绪游走，想象如果区块链取代我们的政府，我们会取得怎样的成就。智能合同可以让我们收回并重新拥有哪些任务？我就是这样产生了写结婚证智能合同的想法。毕竟，这是一件相对简单的事情:两个人想要结婚(不管是好是坏)，他们在一个机构前登记他们的结合，例如当他们需要证明他们的婚姻或者当他们想要离婚时，他们回到同一个机构。</p><p id="35d8" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">在现实生活中，婚姻是一个真正的挑战，人们往往会浪费大量的时间和金钱。智能合同可以帮助他们在几秒钟内结婚(或离婚)，只需几分钱。区块链的不变性允许确保结婚证不被更改超出其内部功能，并使其在任何时间任何地点可用。</p><p id="b24d" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">这就是在区块链庆祝婚姻的想法是如何诞生的！通过该网站，夫妇可以创建一个智能合同，该合同将以不变的方式存储他们的个人身份信息(如姓名、位置和身份证号码)，以便能够以简单的方式证明证书的所有权，他们可以毫不费力地更新婚姻状态(离婚实际上只需几秒钟和几分钟即可完成)，最后， 智能合同的设计允许夫妇使用证书以两种不同的方式存储共同资金:一个“联合账户”，配偶双方可以自由存钱和取钱；一个“储蓄账户”，在取钱之前需要配偶双方的同意。</p><p id="4442" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">我将在下面描述智能合同的代码(在这个地址处<a class="ae ke" href="https://github.com/claudebarde/GetMarriedOnTheBlockchain/blob/master/contracts/MarriageCertificateCreator.sol" rel="noopener ugc nofollow" target="_blank">可用)，一个接一个的功能，以便更好地理解它的功能，同时也接收有用的反馈:)对于初学者来说，这可能也是有用的，因为我几个月前已经详细浏览了智能合同是如何工作的。</a></p><h1 id="44af" class="kf kg ht bd kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc dt translated">结婚证工厂</h1><p id="08a6" class="pw-post-body-paragraph iq ir ht is b it ld iv iw ix le iz ja jb lf jd je jf lg jh ji jj lh jl jm jn hm dt translated">每个结婚证都是由工厂智能合同创建的，该合同负责用正确的数据设置正确的状态，并保存证书地址。按照惯例，智能合同从pragma版本开始:</p><pre class="jp jq jr js fq li lj lk ll aw lm dt"><span id="1636" class="ln kg ht lj b fv lo lp l lq lr">pragma solidity ^0.5.0;</span></pre><p id="0e27" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">与许多用第四版编写的智能合同相比，智能合同使用了最新版本的Solidity。</p><pre class="jp jq jr js fq li lj lk ll aw lm dt"><span id="aad3" class="ln kg ht lj b fv lo lp l lq lr">contract MarriageCertificateCreator {<br/>    MarriageCertificate[] public certificates;<br/>    address payable public owner;<br/>    uint public certificateFee;<br/>    string[3] public lastMarriage;</span></pre><p id="fc9f" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">这是合同声明。它创建了四个状态变量:一个<strong class="is hu">证书</strong>变量(一个包含类型为“结婚证书”的值的动态数组)，最终将包含每个创建的证书的地址；一个<strong class="is hu">所有者</strong>变量(使用智能合同的各种功能)；一个<strong class="is hu">证书</strong>变量(一个无符号整数，表示wei中的费用)；以及一个<strong class="is hu">last婚姻法</strong>变量(一个由3个字符串组成的数组，保存最后一个注册证书的名称和位置)。</p><pre class="jp jq jr js fq li lj lk ll aw lm dt"><span id="cdb9" class="ln kg ht lj b fv lo lp l lq lr">constructor() public {<br/>        owner = msg.sender;<br/>        certificateFee = 100000000000000000 wei;<br/>    }</span></pre><p id="5254" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">建造者非常直接，它保存了所有者的地址(我的),并将创建新结婚证的费用设置为0.1以太。该费用可在另一个功能中手动更新。</p><pre class="jp jq jr js fq li lj lk ll aw lm dt"><span id="eaf7" class="ln kg ht lj b fv lo lp l lq lr">event NewCertificateCreated(MarriageCertificate newCertificateAddress, uint numberOfCertificates);</span></pre><p id="1e63" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">这是智能合同中唯一的事件，它在每次创建新证书时发出，并将新合同的地址和结婚证总数返回到web3界面。</p><h2 id="e909" class="ln kg ht bd kh ls lt lu kl lv lw lx kp jb ly lz kt jf ma mb kx jj mc md lb me dt translated">createNewCertificate函数</h2><p id="dd20" class="pw-post-body-paragraph iq ir ht is b it ld iv iw ix le iz ja jb lf jd je jf lg jh ji jj lh jl jm jn hm dt translated">这是所有魔法发生的地方！下面的功能负责从web3接口接收数据，验证数据，更新合同工厂的状态，显然还负责创建新的结婚证。</p><figure class="jp jq jr js fq jt fe ff paragraph-image"><div role="button" tabindex="0" class="ju jv di jw bf jx"><div class="fe ff mf"><img src="../Images/b8cf0154b30853695f3387b0d8d815fa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pFwzLf1c1NHgBtJ419JRaQ.png"/></div></div></figure><p id="4ec3" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">您将在下面找到该功能不同部分的详细说明。</p><pre class="jp jq jr js fq li lj lk ll aw lm dt"><span id="68a0" class="ln kg ht lj b fv lo lp l lq lr">function <em class="mg">createNewCertificate</em>(<br/>        string memory <strong class="lj hu">spouse1</strong>, string memory <strong class="lj hu">spouse2</strong>, address <strong class="lj hu">spouse2address</strong>, string memory <strong class="lj hu">location</strong><br/>        ) public payable {}</span></pre><p id="55e1" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">该函数接受4个参数:</p><ol class=""><li id="dadf" class="mh mi ht is b it iu ix iy jb mj jf mk jj ml jn mm mn mo mp dt translated"><strong class="is hu"> spouse1 </strong>变量是JSON格式的JavaScript对象，包含关于第一任配偶(也是结婚证的发起人)的各种信息。出于多种原因，JSON字符串是存储在智能契约中的更好选择:它允许在将来存储不同的信息，在Solidity中比像数组或结构这样的其他结构更容易处理，更容易从web3接口获取信息(例如，如果它是一个结构，就不需要对其进行转换),并且在智能契约创建期间提供的大部分信息对其执行并不重要。</li><li id="ab2e" class="mh mi ht is b it mq ix mr jb ms jf mt jj mu jn mm mn mo mp dt translated"><strong class="is hu"> spouse2 </strong>变量也是JSON格式的JavaScript对象，保存与第二个配偶相关的信息。因为结婚证书是由一个人创建的，所以第二个参与者必须稍后验证该信息以使婚姻有效。在第二个配偶到来并批准婚姻之前，婚姻一直处于永久无效状态。</li><li id="b742" class="mh mi ht is b it mq ix mr jb ms jf mt jj mu jn mm mn mo mp dt translated"><strong class="is hu"> spouse2address </strong>变量包含必须批准婚姻的第二个配偶的地址。这两个地址将被独立存储，因为它们需要更新新创建的证书的状态。</li><li id="2b47" class="mh mi ht is b it mq ix mr jb ms jf mt jj mu jn mm mn mo mp dt translated"><strong class="is hu">位置</strong>变量是一个JSON格式的Javascript对象，包含这对夫妇在注册过程中选择的城市和国家的名称。</li></ol><pre class="jp jq jr js fq li lj lk ll aw lm dt"><span id="fa28" class="ln kg ht lj b fv lo lp l lq lr">MarriageCertificate newCertificate = new MarriageCertificate(<br/>            msg.sender,<br/>            spouse1,<br/>            spouse2,<br/>            spouse2address,<br/>            location);</span></pre><p id="3be9" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">函数体负责传递之前收到的参数，<strong class="is hu"> msg.sender </strong>是<strong class="is hu"> spouse1 </strong>的地址。请注意，无论spouse1变量中传递了什么值，创建结婚证的人都将被视为第一个配偶。<br/>另请注意，在Solidity 0.5中，当您从智能合约创建新的智能合约时，它返回的值最终是一个地址，但它将是“NameOfCreatedSmartContract”类型。知道这一点也很重要，因为我们将把这些值存储在一个数组中。</p><pre class="jp jq jr js fq li lj lk ll aw lm dt"><span id="41aa" class="ln kg ht lj b fv lo lp l lq lr">certificates.push(newCertificate);<br/>lastMarriage = [spouse1, spouse2, location];<br/>emit NewCertificateCreated(newCertificate, certificates.length);</span></pre><p id="ebb5" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">接下来的几行代码非常简单:我们将新证书的地址推送到<em class="mg"> certificates </em>数组中(根据Solidity 0.5，其值必须是“NameOfCreatedSmartContract”类型)，我们更新lastMarriage变量，因此该值总是设置为最后注册的婚姻，我们发出一个事件，该事件将被web3接口捕获。</p><h1 id="5a91" class="kf kg ht bd kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc dt translated"><strong class="ak">结婚证</strong></h1><p id="a520" class="pw-post-body-paragraph iq ir ht is b it ld iv iw ix le iz ja jb lf jd je jf lg jh ji jj lh jl jm jn hm dt translated">婚姻证书智能契约是一个非常简单的契约，因为它主要用于存储关于夫妻双方的不变信息、关于婚姻状况的可变信息以及两个独立账户中的共同资金，外加一些存取上述资金的功能。</p><figure class="jp jq jr js fq jt fe ff paragraph-image"><div role="button" tabindex="0" class="ju jv di jw bf jx"><div class="fe ff mv"><img src="../Images/9dd0136f4dfc55eba09d39e63999432a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rWlJFzpni5FxJBBah1VttA.png"/></div></div></figure><p id="e328" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">在合同创建期间设置了几个变量以及两个事件发射器:<strong class="is hu">位置</strong>、<strong class="is hu"> spouse1 </strong>和<strong class="is hu"> spouse2 </strong>将保存关于配偶和注册地的信息。应该注意的是，如果配偶必须证明他们是登记婚姻的人，那么配偶在证书创建期间提供的身份证号码在客户端是加密的，并且提供了解密密钥。<br/>T9】有效变量是由2个布尔值组成的数组，代表配偶双方选择的婚姻状态，<strong class="is hu">配偶使用地址</strong>是由两个地址组成的数组，包含配偶双方的地址，常用于<em class="mg">要求</em>功能，以确保合同状态只能由配偶双方修改。<br/>时间戳<strong class="is hu">变量保存创建时间戳，而<strong class="is hu">账户</strong>映射跟踪“联名”和“储蓄”账户中的乙醚量。<br/>配偶一方每次从储蓄账户提出取款请求时，都会创建一个<strong class="is hu">取款请求表单</strong>结构。然后，该请求被保存在<strong class="is hu">提取请求</strong>映射中。<br/>最后，<strong class="is hu">婚姻有效性</strong>事件返回<em class="mg">是有效的</em>数组，而<strong class="is hu">newwithrrawalquestfro储蓄</strong>事件返回新创建的请求。</strong></p><h2 id="2dbd" class="ln kg ht bd kh ls lt lu kl lv lw lx kp jb ly lz kt jf ma mb kx jj mc md lb me dt translated">构造函数</h2><p id="0f79" class="pw-post-body-paragraph iq ir ht is b it ld iv iw ix le iz ja jb lf jd je jf lg jh ji jj lh jl jm jn hm dt translated">构造函数非常标准:</p><figure class="jp jq jr js fq jt fe ff paragraph-image"><div role="button" tabindex="0" class="ju jv di jw bf jx"><div class="fe ff mw"><img src="../Images/32b43689709be46ad17047cc760bb6f6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wbg1Os5syxLwVgZaqCJOtw.png"/></div></div></figure><p id="d388" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">它接收关于新婚夫妇的不同信息，将其存储在之前创建的变量中，并将“联合”和“储蓄”帐户设置为0。<em class="mg">为有效</em>变量设置为<code class="eh mx my mz lj b">[true, false]</code>，因为婚姻只有在第二任配偶认可后才能有效。</p><h2 id="4551" class="ln kg ht bd kh ls lt lu kl lv lw lx kp jb ly lz kt jf ma mb kx jj mc md lb me dt translated">合同状态操纵</h2><p id="e4c5" class="pw-post-body-paragraph iq ir ht is b it ld iv iw ix le iz ja jb lf jd je jf lg jh ji jj lh jl jm jn hm dt translated">智能合同允许配偶根据自己的意愿更新婚姻状况。使用布尔运算<code class="eh mx my mz lj b">&amp;&amp;</code>运算符计算<em class="mg">中两个值之间的状态是有效的</em>数组。这意味着，要使婚姻有效，配偶双方都必须同意。简单的读取<em class="mg">中的布尔值就是有效的</em>数组，这也可以表明配偶中的哪一个同意或者不同意婚姻。</p><pre class="jp jq jr js fq li lj lk ll aw lm dt"><span id="5e56" class="ln kg ht lj b fv lo lp l lq lr">modifier onlySpouses {<br/>        require (<br/>            msg.sender == spousesAddresses[0] || msg.sender == spousesAddresses[1], "The contract status can only be changed by one of the spouses."<br/>            );<br/>        _;<br/>    }</span></pre><p id="265e" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">这个修饰符将被使用几次，并确保更新智能合同状态的人从创建智能合同时提供的两个地址中选择一个进行更新。</p><figure class="jp jq jr js fq jt fe ff paragraph-image"><div role="button" tabindex="0" class="ju jv di jw bf jx"><div class="fe ff na"><img src="../Images/04d927d2e3c431f755612ee6784c7ca5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2Efd-g8LEocKcIqVje-r3Q.png"/></div></div></figure><p id="00a9" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">当夫妻中的一方要求改变婚姻状态时，<em class="mg"> changeMarriageStatus </em>函数执行简单的布尔翻转。请注意，夫妻双方必须将<em class="mg"> isValid </em>数组中的两个值都设置为<code class="eh mx my mz lj b">true</code>才能使离婚生效。</p><p id="9451" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated"><strong class="is hu">存取款功能</strong></p><p id="8942" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">智能合同基本上是一个带代码的以太坊账户，如果不使用这个功能就太可惜了:)进一步说，结婚证分为两个不同的账户:“联名”账户和“储蓄”账户。<br/>“联合”账户是夫妻双方(或任何有以太坊地址的人)都可以发送以太网的账户，夫妻双方可以提取他们想要的金额。<br/>“储蓄”账户是一个只有配偶双方可以向其汇款的账户，为了取钱，取款人必须登记一个请求，然后由第二个配偶批准。</p><p id="1f9f" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">让我们深入研究代码:</p><figure class="jp jq jr js fq jt fe ff paragraph-image"><div role="button" tabindex="0" class="ju jv di jw bf jx"><div class="fe ff nb"><img src="../Images/04ee4cd08a9d6f74c2e22be31c2987c9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*x_gAwcDZifYAp2ounkNG3A.png"/></div></div></figure><p id="b001" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated"><strong class="is hu">存款</strong>功能允许配偶通过网络界面存款。它接受两个参数:要添加的<em class="mg">金额</em>和要增加的<em class="mg">账户名称</em>。<em class="mg">only配偶</em>修饰符确保只有两个配偶可以访问该功能。</p><p id="b345" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">作为一种安全措施，合同验证用户选择的金额也是发送的金额。stringsAreEqual函数检查bytes32变量，契约决定相应地增加联合帐户或储蓄帐户。最后一个<em class="mg">断言</em>函数用于检查无论发生什么情况，联名账户和储蓄账户的总和始终等于合同的总余额。<br/>通过智能合约功能的每一次余额变化都会发出一个<em class="mg"> LogBalance </em>事件，其中包含总余额、“联合账户”的余额和“储蓄余额”的余额。</p><figure class="jp jq jr js fq jt fe ff paragraph-image"><div role="button" tabindex="0" class="ju jv di jw bf jx"><div class="fe ff nc"><img src="../Images/d330f175bc556c3ce079f4fde06d3135.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VGNjNc1xArF_dln6aizD4g.png"/></div></div></figure><p id="6c20" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated"><strong class="is hu">撤回</strong>功能有点复杂。没有另一方的批准，任何一方都不允许从储蓄账户中取钱，这个功能必须确保不会发生这种情况。<br/>如果其中一方发送交易从储蓄账户中提取乙醚，则在合同中保存一个请求，并发布一个请求ID。第二个配偶必须使用他/她自己的帐户地址来批准请求。</p><p id="b922" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">首先，<em class="mg">only配偶</em>修饰符确保除了两个配偶之外，其他任何人都不能从合同中取钱。然后，合同会检查请求的金额是否没有超过所选帐户的余额。<br/>第一个条件验证所选帐户的名称，并检查请求的金额，以确保它没有超过帐户的余额。</p><p id="7c57" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">如果选择“联名”账户，结果很简单:从余额中扣除金额并发送给汇款人。</p><p id="501e" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">如果选择了“储蓄”账户，则合同创建一个(伪)唯一ID，添加当前时间戳、块难度和块号。因为两个请求同时出现的可能性很小，所以这就足够了。使用ID作为关键字，创建一个类型为<em class="mg">withdrawrequestfromservices</em>的新结构，并保存在<em class="mg"> withdrawRequests </em>映射中。一旦新请求保存在映射中，我们就发出一个事件来获取web界面中的请求ID。</p><p id="a065" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">最后，我们再次检查联合账户余额和储蓄账户余额是否等于总余额，如果不等于总余额，合同将恢复到之前的状态。</p><p id="7189" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">现在让我们来看一下允许配偶批准从储蓄账户提款请求并发送资金的函数。</p><figure class="jp jq jr js fq jt fe ff paragraph-image"><div role="button" tabindex="0" class="ju jv di jw bf jx"><div class="fe ff nd"><img src="../Images/90d80261a1889612bf007d892fd33c07.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*uzjst2OgNS2oPvg_m8LjLA.png"/></div></div></figure><p id="abdc" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated"><strong class="is hu">approvewithdrawrequestfromservices</strong>函数将请求ID作为参数。该功能只能由夫妻中的一方使用。契约从存储中的映射获取请求，并运行一些检查:通过检查时间戳和金额，它确保请求存在(如果没有找到请求结构，它们默认等于0)，然后它检查请求的金额是否仍然可用，以及请求是否仍然待定(批准已经批准的请求没有意义！)</p><p id="8486" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">如果请求是待定的，下一个条件确保批准请求的配偶不是创建请求的人(试图批准他们自己创建的请求的用户将触发恢复功能)。<br/>如果一切正常，请求将被标记为已批准(true)，所请求的金额将从储蓄帐户中扣除，并发送给发起请求的配偶。</p><figure class="jp jq jr js fq jt fe ff paragraph-image"><div role="button" tabindex="0" class="ju jv di jw bf jx"><div class="fe ff ne"><img src="../Images/4021d0e7329dc4db1dbeaef0fece2487.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*F6-213596pXZCC9S8g852g.png"/></div></div></figure><p id="a7e1" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated"><strong class="is hu">支付</strong>功能允许配偶使用共同账户中的钱支付各种费用，如账单。该功能会在扣除并发送请求的金额之前，检查该金额在联合帐户中是否可用。<br/>完成后，该功能将确保总余额等于联名账户余额和储蓄账户余额。<br/>最后，发出一个<em class="mg"> LogBalance </em>事件来更新用户界面。</p><p id="f34f" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">总之，值得一提的是<em class="mg">回退</em>功能:</p><figure class="jp jq jr js fq jt fe ff paragraph-image"><div role="button" tabindex="0" class="ju jv di jw bf jx"><div class="fe ff nf"><img src="../Images/0a90deb7c45b92d3d7d424bb1f020982.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nfpTWvWC6ovUZk61cZCF2A.png"/></div></div></figure><p id="6b48" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">任何直接发送到合同的乙醚将被添加到联合帐户。请注意，如果不提供42.000左右的汽油，交易将失败。</p><h1 id="1de1" class="kf kg ht bd kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc dt translated">结论</h1><p id="f817" class="pw-post-body-paragraph iq ir ht is b it ld iv iw ix le iz ja jb lf jd je jf lg jh ji jj lh jl jm jn hm dt translated">我希望这篇文章能帮助你理解智能合同的内部机制，该合同是为了在区块链登记婚姻、跟踪婚姻状况、管理婚姻预算以及简化婚姻官僚主义中的各种程序而创建的。</p><p id="c58e" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">除了这种合同的实际方面，它还被视为一种示范，展示了区块链可以在多大程度上推动我们中央集权社会的极限，并打开一个去中心化世界的大门，在这个世界中，我们都将收回为自己做决定的权力！</p><h2 id="160f" class="ln kg ht bd kh ls lt lu kl lv lw lx kp jb ly lz kt jf ma mb kx jj mc md lb me dt translated">链接:</h2><p id="b1a8" class="pw-post-body-paragraph iq ir ht is b it ld iv iw ix le iz ja jb lf jd je jf lg jh ji jj lh jl jm jn hm dt translated">你可以在 这里找到网站<a class="ae ke" href="https://www.marriageontheblock.com" rel="noopener ugc nofollow" target="_blank"> <strong class="is hu">，智能合约代码在<a class="ae ke" href="https://raw.githubusercontent.com/claudebarde/MarriageOnTheBlock/master/contracts/MarriageCertificateCreator.sol" rel="noopener ugc nofollow" target="_blank"> <strong class="is hu">这个地址</strong> </a> <strong class="is hu"> </strong>或者查看<a class="ae ke" href="https://github.com/claudebarde/MarriageOnTheBlock" rel="noopener ugc nofollow" target="_blank"> <strong class="is hu"> Github库</strong> </a>。</strong></a></p><blockquote class="ng"><p id="b751" class="nh ni ht bd nj nk nl nm nn no np jn ek translated"><a class="ae ke" href="https://coincodecap.com?utm_source=coinmonks" rel="noopener ugc nofollow" target="_blank">直接在您的收件箱中获得最佳软件交易</a></p></blockquote><figure class="nr ns nt nu nv jt fe ff paragraph-image"><a href="https://coincodecap.com?utm_source=coinmonks"><div class="fe ff nq"><img src="../Images/160ce73bd06d46c2250251e7d5969f9d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1168/format:webp/1*BoDnKUyK8p4hitHAJZ5Pdw.png"/></div></a></figure><blockquote class="ng"><p id="1de5" class="nh ni ht bd nj nk nw nx ny nz oa jn ek translated"><a class="ae ke" href="https://coincodecap.com/?utm_source=coinmonks" rel="noopener ugc nofollow" target="_blank">直接在您的收件箱中获得最佳软件交易</a></p></blockquote><figure class="nr ns nt nu nv jt fe ff paragraph-image"><a href="https://coincodecap.com/?utm_source=coinmonks"><div class="fe ff nq"><img src="../Images/7c0b3dfdcbfea594cc0ae7d4f9bf6fcb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1168/format:webp/0*OJ-qb5G6i863msBB.png"/></div></a></figure></div></div>    
</body>
</html>