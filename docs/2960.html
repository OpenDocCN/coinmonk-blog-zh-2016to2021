<html>
<head>
<title>Create a Custom Network and Deploy your own Chaincode with Hyperledger Fabric v2.1</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Hyperledger Fabric v2.1创建自定义网络并部署您自己的链码</h1>
<blockquote>原文：<a href="https://medium.com/coinmonks/create-a-custom-network-and-deploy-your-own-chaincode-with-hyperledger-fabric-v2-1-6c689cf1b7cd?source=collection_archive---------0-----------------------#2020-04-29">https://medium.com/coinmonks/create-a-custom-network-and-deploy-your-own-chaincode-with-hyperledger-fabric-v2-1-6c689cf1b7cd?source=collection_archive---------0-----------------------#2020-04-29</a></blockquote><div><div class="ef hh hi hj hk hl"/><div class="hm hn ho hp hq"><div class=""/><figure class="fi fk ir is it iu fe ff paragraph-image"><div role="button" tabindex="0" class="iv iw di ix bf iy"><div class="fe ff iq"><img src="../Images/58a1a0d7f1913df6b4cb0b01dcd2b299.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6aqAGwev7mReokiasSA_aQ.png"/></div></div></figure><p id="7769" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt jz translated"><span class="l ka kb kc bm kd ke kf kg kh di">在</span>这个故事中，我们将创建一个自定义网络，并使用Hyperledger Fabric v2.1部署一个示例链码。之后，我们将查询链码，并通过我们将创建的2个对等点与网络进行交互。</p><p id="e313" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">首先，我们需要安装这里列出的所有先决条件<a class="ae ki" href="https://hyperledger-fabric.readthedocs.io/en/release-2.0/prereqs.html" rel="noopener ugc nofollow" target="_blank"/>。如果你以前没有安装它，你可以使用下面的链接作为指南。不仅仅是安装必备软件，如果你能完成整个指南，那会很有帮助。然而，只有<em class="kj">安装先决条件</em>和<em class="kj">安装示例、二进制文件和docker映像</em>部分对于这个故事是必要的。</p><div class="kk kl fm fo km kn"><a rel="noopener follow" target="_blank" href="/@bcekici11/hyperledger-fabric-v2-1-installation-guide-prerequisites-bring-up-the-test-network-4ac658b0df64"><div class="ko ab ej"><div class="kp ab kq cl cj kr"><h2 class="bd hu fv z el ks eo ep kt er et hs dt translated">Hyperledger Fabric v2.1安装指南-先决条件和启动测试网络</h2><div class="ku l"><h3 class="bd b fv z el ks eo ep kt er et ek translated">在这个故事中，我们将在Linux机器上安装Hyperledger Fabric v2.1，然后启动测试网络并…</h3></div><div class="kv l"><p class="bd b gc z el ks eo ep kt er et ek translated">medium.com</p></div></div><div class="kw l"><div class="kx l ky kz la kw lb iz kn"/></div></div></a></div><p id="bb69" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">如果我们成功安装了先决条件、示例、二进制文件和docker映像，我们必须有一个<em class="kj"> fabric-samples </em>文件夹，并且我们可以从创建一个自定义网络开始。</p></div><div class="ab cl lc ld hb le" role="separator"><span class="lf bw bk lg lh li"/><span class="lf bw bk lg lh li"/><span class="lf bw bk lg lh"/></div><div class="hm hn ho hp hq"><h1 id="c693" class="lj lk ht bd ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg dt translated">创建一个自定义网络并启动它</h1><p id="4f2b" class="pw-post-body-paragraph jb jc ht jd b je mh jg jh ji mi jk jl jm mj jo jp jq mk js jt ju ml jw jx jy hm dt translated">我们在<em class="kj"> fabric-samples </em>文件夹下创建一个名为<code class="eh mm mn mo mp b">burakcan-network</code>的文件夹。在我们的网络中，有3个节点，包括两个组织，分别是<code class="eh mm mn mo mp b">Burakcan1</code>和<code class="eh mm mn mo mp b">Burakcan2</code>，还有一个订购者，所以我们需要生成所有的证书和密钥来证明这些节点是否真的是他们自己。我们将使用提供的<code class="eh mm mn mo mp b">cryptogen</code>工具来为我们的网络实体生成加密材料，我们在安装特定于平台的二进制文件时已经安装了该工具。它放在<em class="kj">面料-样品/箱</em>文件夹下。它使用包含网络拓扑的<code class="eh mm mn mo mp b">crypto-config.yaml</code>文件，并允许我们为组织和属于这些组织的组件生成一组证书和密钥。</p><blockquote class="mq mr ms"><p id="68c2" class="jb jc kj jd b je jf jg jh ji jj jk jl mt jn jo jp mu jr js jt mv jv jw jx jy hm dt translated">除此之外我就不多说了，但是你可以从<a class="ae ki" href="https://hyperledger-fabric.readthedocs.io/en/release-2.0/build_network.html?highlight=crypto-config.yaml#crypto-generator" rel="noopener ugc nofollow" target="_blank">这里</a>了解更多关于这个工具的信息。</p></blockquote><p id="5849" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">这就是为什么我们在<code class="eh mm mn mo mp b">burakcan-network</code>目录下创建下面的文件。我们定义了一个订购组织(<code class="eh mm mn mo mp b">OrdererOrg</code>)和两个对等组织(<code class="eh mm mn mo mp b">Burakcan1</code>和<code class="eh mm mn mo mp b">Burakcan2</code>)。组织中的每个计数值都指定了该组织中同级的数量。</p><figure class="mw mx my mz fq iu"><div class="bz el l di"><div class="na nb l"/></div></figure><p id="df5f" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">在定义了<code class="eh mm mn mo mp b">crypto-config.yaml</code>文件之后，我们在<code class="eh mm mn mo mp b">burakcan-network</code>目录下执行下面的命令通道。</p><pre class="mw mx my mz fq nc mp nd ne aw nf dt"><span id="86a8" class="ng lk ht mp b fv nh ni l nj nk">../bin/cryptogen generate --config crypto-config.yaml --output=crypto-config</span></pre><p id="83cf" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">我们应该会看到如下所示的消息。</p><figure class="mw mx my mz fq iu fe ff paragraph-image"><div role="button" tabindex="0" class="iv iw di ix bf iy"><div class="fe ff nl"><img src="../Images/3cfa8245dd9be179323117abdb73a061.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-fu9i6mufrV9j_TfuEoqIQ.png"/></div></div><figcaption class="nm nn fg fe ff no np bd b be z ek">cryptogen</figcaption></figure><p id="1880" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">然后我们将继续使用<code class="eh mm mn mo mp b">configtxgen</code>工具，它是我们在安装特定于平台的二进制文件时已经安装的，它也放在<em class="kj"> fabric-samples/bin </em>文件夹下。它提供了生成这些重要的配置工件；</p><ul class=""><li id="a531" class="nq nr ht jd b je jf ji jj jm ns jq nt ju nu jy nv nw nx ny dt translated">1 <code class="eh mm mn mo mp b">orderer genesis block</code></li><li id="07e9" class="nq nr ht jd b je nz ji oa jm ob jq oc ju od jy nv nw nx ny dt translated">1 <code class="eh mm mn mo mp b">channel configuration transaction</code></li><li id="c5dd" class="nq nr ht jd b je nz ji oa jm ob jq oc ju od jy nv nw nx ny dt translated">2 <code class="eh mm mn mo mp b">anchor peer transactions</code>(必须针对每个组织，我们有<code class="eh mm mn mo mp b">Burakcan1</code>和<code class="eh mm mn mo mp b">Burakcan2</code>组织，因此我们将生成其中的2个)</li></ul><blockquote class="mq mr ms"><p id="2714" class="jb jc kj jd b je jf jg jh ji jj jk jl mt jn jo jp mu jr js jt mv jv jw jx jy hm dt translated">你可以从<a class="ae ki" href="https://hyperledger-fabric.readthedocs.io/en/release-2.0/build_network.html?highlight=crypto-config.yaml#configuration-transaction-generator" rel="noopener ugc nofollow" target="_blank">这里</a>了解更多关于configtxgen工具的信息。</p></blockquote><p id="732a" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">它使用包含网络定义的<code class="eh mm mn mo mp b">configtx.yaml</code>文件，因此我们将在<code class="eh mm mn mo mp b">burakcan-network</code>目录下创建以下文件。</p><figure class="mw mx my mz fq iu"><div class="bz el l di"><div class="na nb l"/></div></figure><p id="a036" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">定义完<code class="eh mm mn mo mp b">configtx.yaml</code>文件后，我们依次执行以下命令，在<code class="eh mm mn mo mp b">burakcan-network</code>目录下生成我们上面提到的配置工件；</p><ul class=""><li id="b633" class="nq nr ht jd b je jf ji jj jm ns jq nt ju nu jy nv nw nx ny dt translated">生成排序生成块；</li></ul><pre class="mw mx my mz fq nc mp nd ne aw nf dt"><span id="0248" class="ng lk ht mp b fv nh ni l nj nk">../bin/configtxgen -profile OrdererGenesis -outputBlock ./channel-artifacts/genesis.block -channelID channelorderergenesis</span></pre><figure class="mw mx my mz fq iu fe ff paragraph-image"><div role="button" tabindex="0" class="iv iw di ix bf iy"><div class="fe ff oe"><img src="../Images/72a88b802a1a767a87748a6172589e32.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*C4C5RcHn_O0_sx1h3efP7w.png"/></div></div><figcaption class="nm nn fg fe ff no np bd b be z ek">orderer genesis block</figcaption></figure><ul class=""><li id="77c6" class="nq nr ht jd b je jf ji jj jm ns jq nt ju nu jy nv nw nx ny dt translated">涉及生成信道配置事务；</li></ul><pre class="mw mx my mz fq nc mp nd ne aw nf dt"><span id="a275" class="ng lk ht mp b fv nh ni l nj nk">../bin/configtxgen -profile ChannelDemo -outputCreateChannelTx ./channel-artifacts/channel.tx -channelID channeldemo</span></pre><figure class="mw mx my mz fq iu fe ff paragraph-image"><div role="button" tabindex="0" class="iv iw di ix bf iy"><div class="fe ff nl"><img src="../Images/e5a86baabf416120c0179702be29cd33.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BDt69cyxZqFDuFHIgbpMzA.png"/></div></div><figcaption class="nm nn fg fe ff no np bd b be z ek">channel configuration transaction</figcaption></figure><ul class=""><li id="9d4c" class="nq nr ht jd b je jf ji jj jm ns jq nt ju nu jy nv nw nx ny dt translated">为<code class="eh mm mn mo mp b">Burakcan1</code>生成锚点对等交易；</li></ul><pre class="mw mx my mz fq nc mp nd ne aw nf dt"><span id="9e11" class="ng lk ht mp b fv nh ni l nj nk">../bin/configtxgen -profile ChannelDemo -outputAnchorPeersUpdate ./channel-artifacts/Burakcan1Anchor.tx -channelID channeldemo -asOrg Burakcan1MSP</span></pre><figure class="mw mx my mz fq iu fe ff paragraph-image"><div role="button" tabindex="0" class="iv iw di ix bf iy"><div class="fe ff nl"><img src="../Images/8065c4fd76312b97f91fd0fb04274ab6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*InQq2Ab5dLlSsqH656LINw.png"/></div></div><figcaption class="nm nn fg fe ff no np bd b be z ek">anchor peer transaction for Burakcan1 Org</figcaption></figure><ul class=""><li id="73be" class="nq nr ht jd b je jf ji jj jm ns jq nt ju nu jy nv nw nx ny dt translated">为<code class="eh mm mn mo mp b">Burakcan2</code>生成锚点对等交易；</li></ul><pre class="mw mx my mz fq nc mp nd ne aw nf dt"><span id="17b0" class="ng lk ht mp b fv nh ni l nj nk">../bin/configtxgen -profile ChannelDemo -outputAnchorPeersUpdate ./channel-artifacts/Burakcan2Anchor.tx -channelID channeldemo -asOrg Burakcan2MSP</span></pre><figure class="mw mx my mz fq iu fe ff paragraph-image"><div role="button" tabindex="0" class="iv iw di ix bf iy"><div class="fe ff of"><img src="../Images/20dcb6664a25ba271fc6ba3d13f9f4ad.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*av1UMS2uKaID5zVRontB-Q.png"/></div></div><figcaption class="nm nn fg fe ff no np bd b be z ek">anchor peer transaction for Burakcan2 Org</figcaption></figure><p id="100a" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">然后，由于指定docker文件并定义它们的位置，我们需要在<code class="eh mm mn mo mp b">burakcan-network</code>目录下创建一些文件。我们在<code class="eh mm mn mo mp b">burakcan-network</code>目录下创建<code class="eh mm mn mo mp b">base</code>文件夹，然后在其中创建<code class="eh mm mn mo mp b">docker-compose-base.yaml</code>和<code class="eh mm mn mo mp b">peer-base.yaml</code>文件，为我们的网络建立基础。</p><figure class="mw mx my mz fq iu"><div class="bz el l di"><div class="na nb l"/></div></figure><figure class="mw mx my mz fq iu"><div class="bz el l di"><div class="na nb l"/></div></figure><p id="9c53" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">我们只需要创建一个文件。这是从<code class="eh mm mn mo mp b">docker-compose-base.yaml</code>文件扩展而来的<code class="eh mm mn mo mp b">docker-compose-cli.yaml</code>文件，它必须放在<code class="eh mm mn mo mp b">burakcan-network</code>目录的根目录下。我们将为每个组织使用一个cli容器，方法是启动网络或部署、查询和交互链代码，因此我们创建了以下文件。</p><figure class="mw mx my mz fq iu"><div class="bz el l di"><div class="na nb l"/></div></figure><p id="7bfc" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">然后设置<code class="eh mm mn mo mp b">COMPOSE_PROJECT_NAME</code>变量，因为它可能会在我们启动网络时引起问题。</p><pre class="mw mx my mz fq nc mp nd ne aw nf dt"><span id="ad0a" class="ng lk ht mp b fv nh ni l nj nk">echo COMPOSE_PROJECT_NAME=net &gt; .env</span></pre><p id="8d44" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">现在，我们可以打开我们的网络，我们应该看到类似下图的东西；</p><pre class="mw mx my mz fq nc mp nd ne aw nf dt"><span id="49e9" class="ng lk ht mp b fv nh ni l nj nk">docker-compose -f docker-compose-cli.yaml up -d</span></pre><figure class="mw mx my mz fq iu fe ff paragraph-image"><div role="button" tabindex="0" class="iv iw di ix bf iy"><div class="fe ff og"><img src="../Images/0d79d4ba6d64f1c8ff22b9e24e28e507.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*y-Xi0UpDnEPLrPIA4PR3Cg.png"/></div></div><figcaption class="nm nn fg fe ff no np bd b be z ek">bring up the network</figcaption></figure></div><div class="ab cl lc ld hb le" role="separator"><span class="lf bw bk lg lh li"/><span class="lf bw bk lg lh li"/><span class="lf bw bk lg lh"/></div><div class="hm hn ho hp hq"><h1 id="0977" class="lj lk ht bd ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg dt translated">配置和创建通道</h1><p id="c1ef" class="pw-post-body-paragraph jb jc ht jd b je mh jg jh ji mi jk jl jm mj jo jp jq mk js jt ju ml jw jx jy hm dt translated">如果您已成功启动网络，我们可以继续配置和创建我们将使用的通道。我们再打开2个终端来配置到我们的对等点的通道。</p><p id="0be3" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">我们将通过<code class="eh mm mn mo mp b">docker exec</code>命令为每个对等体分别输入CLI容器。此外，我们可以在执行该命令时或之后定义环境变量。你选择哪条路都没关系。</p><ul class=""><li id="f88a" class="nq nr ht jd b je jf ji jj jm ns jq nt ju nu jy nv nw nx ny dt translated">从一个终端向另一个终端输入以下命令<code class="eh mm mn mo mp b">Burakcan1</code></li></ul><pre class="mw mx my mz fq nc mp nd ne aw nf dt"><span id="e0bf" class="ng lk ht mp b fv nh ni l nj nk">docker exec -e "CORE_PEER_LOCALMSPID=Burakcan1MSP" -e "CORE_PEER_TLS_ROOTCERT_FILE=/opt/gopath/fabric-samples/burakcan-network/crypto-config/peerOrganizations/be1.burakcan-network.com/peers/peer0.be1.burakcan-network.com/tls/ca.crt" -e "<a class="ae ki" href="mailto:CORE_PEER_MSPCONFIGPATH=/opt/gopath/fabric-samples/burakcan-network/crypto-config/peerOrganizations/be1.burakcan-network.com/users/Admin@be1.burakcan-network.com" rel="noopener ugc nofollow" target="_blank">CORE_PEER_MSPCONFIGPATH=/opt/gopath/fabric-samples/burakcan-network/crypto-config/peerOrganizations/be1.burakcan-network.com/users/Admin@be1.burakcan-network.com</a>/msp" -e "CORE_PEER_ADDRESS=peer0.be1.burakcan-network.com:7051" -it cli bash</span></pre><figure class="mw mx my mz fq iu fe ff paragraph-image"><div class="fe ff oh"><img src="../Images/785fd4c0a4271830df446fee62d3a3ff.png" data-original-src="https://miro.medium.com/v2/resize:fit:972/format:webp/1*k4yUAAGm9tH6EDSuRsbnNA.png"/></div><figcaption class="nm nn fg fe ff no np bd b be z ek">docker exec for Burakcan1</figcaption></figure><ul class=""><li id="49b2" class="nq nr ht jd b je jf ji jj jm ns jq nt ju nu jy nv nw nx ny dt translated">从对方终端输入以下命令<code class="eh mm mn mo mp b">Burakcan2</code></li></ul><pre class="mw mx my mz fq nc mp nd ne aw nf dt"><span id="1718" class="ng lk ht mp b fv nh ni l nj nk">docker exec -e "CORE_PEER_LOCALMSPID=Burakcan2MSP" -e "CORE_PEER_TLS_ROOTCERT_FILE=/opt/gopath/fabric-samples/burakcan-network/crypto-config/peerOrganizations/be2.burakcan-network.com/peers/peer0.be2.burakcan-network.com/tls/ca.crt" -e "<a class="ae ki" href="mailto:CORE_PEER_MSPCONFIGPATH=/opt/gopath/fabric-samples/burakcan-network/crypto-config/peerOrganizations/be2.burakcan-network.com/users/Admin@be2.burakcan-network.com" rel="noopener ugc nofollow" target="_blank">CORE_PEER_MSPCONFIGPATH=/opt/gopath/fabric-samples/burakcan-network/crypto-config/peerOrganizations/be2.burakcan-network.com/users/Admin@be2.burakcan-network.com</a>/msp" -e "CORE_PEER_ADDRESS=peer0.be2.burakcan-network.com:7051" -it cli bash</span></pre><figure class="mw mx my mz fq iu fe ff paragraph-image"><div class="fe ff oi"><img src="../Images/d644ceaec369061e842b8ee1d773ef8c.png" data-original-src="https://miro.medium.com/v2/resize:fit:974/format:webp/1*5B8CeLMxx9f2RDP78KKEUQ.png"/></div><figcaption class="nm nn fg fe ff no np bd b be z ek">docker exec for Burakcan2</figcaption></figure><p id="3828" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">从这里开始，一些操作将只在一个对等体中进行，一些操作将一起进行。我们从通过以下方式在所有终端中设置<code class="eh mm mn mo mp b">ORDERER_CA</code>变量开始；</p><pre class="mw mx my mz fq nc mp nd ne aw nf dt"><span id="b968" class="ng lk ht mp b fv nh ni l nj nk">export ORDERER_CA=/opt/gopath/fabric-samples/burakcan-network/crypto-config/ordererOrganizations/burakcan-network.com/orderers/orderer.burakcan-network.com/msp/tlscacerts/tlsca.burakcan-network.com-cert.pem</span></pre><p id="3306" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">然后，我们通过以下命令创建通道。不需要在两个终端都执行；一个就够了。我们将频道名称命名为<code class="eh mm mn mo mp b">channeldemo</code>。</p><pre class="mw mx my mz fq nc mp nd ne aw nf dt"><span id="aae1" class="ng lk ht mp b fv nh ni l nj nk">peer channel create -o orderer.burakcan-network.com:7050 -c channeldemo -f /opt/gopath/fabric-samples/burakcan-network/channel-artifacts/channel.tx — tls — cafile $ORDERER_CA</span></pre><figure class="mw mx my mz fq iu fe ff paragraph-image"><div class="fe ff oj"><img src="../Images/7375d9918b76f9c0343886e27117df9b.png" data-original-src="https://miro.medium.com/v2/resize:fit:976/format:webp/1*6_5P_Dqj2mnia86Cr2qnQg.png"/></div><figcaption class="nm nn fg fe ff no np bd b be z ek">create the channel</figcaption></figure><p id="43bd" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">然后，我们分别从每个对等体加入这个通道，因此我们将在两个终端中执行以下命令，我们应该会看到下图。</p><pre class="mw mx my mz fq nc mp nd ne aw nf dt"><span id="3bc8" class="ng lk ht mp b fv nh ni l nj nk">peer channel join -b channeldemo.block --tls --cafile $ORDERER_CA</span></pre><figure class="mw mx my mz fq iu fe ff paragraph-image"><div class="fe ff ok"><img src="../Images/68125acd30b9e3c245caa9ccff6c5bc1.png" data-original-src="https://miro.medium.com/v2/resize:fit:970/format:webp/1*HwfUISRuhyVzwe9AbvEIFA.png"/></div><figcaption class="nm nn fg fe ff no np bd b be z ek">join the channel</figcaption></figure><p id="40d8" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">加入通道后，我们分别从每个对等点更新通道。</p><ul class=""><li id="21e3" class="nq nr ht jd b je jf ji jj jm ns jq nt ju nu jy nv nw nx ny dt translated">至同行<code class="eh mm mn mo mp b">Burakcan1</code></li></ul><pre class="mw mx my mz fq nc mp nd ne aw nf dt"><span id="e4c8" class="ng lk ht mp b fv nh ni l nj nk">peer channel update -o orderer.burakcan-network.com:7050 -c channeldemo -f /opt/gopath/fabric-samples/burakcan-network/channel-artifacts/Burakcan1Anchor.tx --tls --cafile $ORDERER_CA</span></pre><figure class="mw mx my mz fq iu fe ff paragraph-image"><div class="fe ff ol"><img src="../Images/6f12cd9beda36bb2d7ab093ccb59b811.png" data-original-src="https://miro.medium.com/v2/resize:fit:978/format:webp/1*359GTmkNshw77JOR6VwALw.png"/></div><figcaption class="nm nn fg fe ff no np bd b be z ek">update the channel</figcaption></figure><ul class=""><li id="c0cf" class="nq nr ht jd b je jf ji jj jm ns jq nt ju nu jy nv nw nx ny dt translated">对等式<code class="eh mm mn mo mp b">Burakcan2</code></li></ul><pre class="mw mx my mz fq nc mp nd ne aw nf dt"><span id="159b" class="ng lk ht mp b fv nh ni l nj nk">peer channel update -o orderer.burakcan-network.com:7050 -c channeldemo -f /opt/gopath/fabric-samples/burakcan-network/channel-artifacts/Burakcan2Anchor.tx --tls --cafile $ORDERER_CA</span></pre><figure class="mw mx my mz fq iu fe ff paragraph-image"><div class="fe ff oj"><img src="../Images/7acc0bb38a9f729d2d9bfb7e8ad32d1c.png" data-original-src="https://miro.medium.com/v2/resize:fit:976/format:webp/1*uI2ZnoYjrP2tEdDjctBhKw.png"/></div><figcaption class="nm nn fg fe ff no np bd b be z ek">update the channel</figcaption></figure></div><div class="ab cl lc ld hb le" role="separator"><span class="lf bw bk lg lh li"/><span class="lf bw bk lg lh li"/><span class="lf bw bk lg lh"/></div><div class="hm hn ho hp hq"><h1 id="2e07" class="lj lk ht bd ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg dt translated">定义和部署链码</h1><p id="52f4" class="pw-post-body-paragraph jb jc ht jd b je mh jg jh ji mi jk jl jm mj jo jp jq mk js jt ju ml jw jx jy hm dt translated">如果我们已经成功地完成了渠道内容，我们可以继续定义和部署链码作为新的链码生命周期，它已经随着Hyperledger Fabric v2而改变。我们不会深入了解这个新的生命周期，但是如果你愿意，你可以看看下面的故事了解更多细节。</p><div class="kk kl fm fo km kn"><a rel="noopener follow" target="_blank" href="/@bcekici11/the-chaincode-lifecycle-on-hyperledger-fabric-v2-72dffb7acf30"><div class="ko ab ej"><div class="kp ab kq cl cj kr"><h2 class="bd hu fv z el ks eo ep kt er et hs dt translated">Hyperledger Fabric v2上的链码生命周期</h2><div class="ku l"><h3 class="bd b fv z el ks eo ep kt er et ek translated">在本案例中，我们将研究如何在Hyperledger Fabric v2中运行链码生命周期流程</h3></div><div class="kv l"><p class="bd b gc z el ks eo ep kt er et ek translated">medium.com</p></div></div><div class="kw l"><div class="kx l ky kz la kw lb iz kn"/></div></div></a></div><p id="563a" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">链码可以由Go、Java或Javascript编写。在这个例子中，我们将使用Go语言来创建我们的链码。首先我们创建一个名为<code class="eh mm mn mo mp b">be_chaincode</code>的目录来保存我们的链码。</p><blockquote class="mq mr ms"><p id="ab8a" class="jb jc kj jd b je jf jg jh ji jj jk jl mt jn jo jp mu jr js jt mv jv jw jx jy hm dt translated">由于我们已经按行将<code class="eh mm mn mo mp b">docker-compose-cli.yaml</code>文件中CLI的volume部分的<code class="eh mm mn mo mp b">../chaincode</code>路径定义为<code class="eh mm mn mo mp b">/opt/gopath/src/chain</code>路径</p><p id="de5d" class="jb jc kj jd b je jf jg jh ji jj jk jl mt jn jo jp mu jr js jt mv jv jw jx jy hm dt translated">。/../chain code/:/opt/gopath/src/chain</p><p id="61f6" class="jb jc kj jd b je jf jg jh ji jj jk jl mt jn jo jp mu jr js jt mv jv jw jx jy hm dt translated">我们可以访问CLI容器中仅由<code class="eh mm mn mo mp b">/opt/gopath/src/chain</code>路径使用的目录。除了通过下面定义的方式创建链码，我们还可以直接在<code class="eh mm mn mo mp b">../chaincode/be_chaincode</code>目录下创建<code class="eh mm mn mo mp b">be.go</code>文件。</p></blockquote><pre class="mw mx my mz fq nc mp nd ne aw nf dt"><span id="4e30" class="ng lk ht mp b fv nh ni l nj nk">mkdir /opt/gopath/src/chain/be_chaincode<br/>mkdir /opt/gopath/src/chain/be_chaincode/go<br/>vi /opt/gopath/src/chain/be_chaincode/go/be.go</span></pre><p id="10bf" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">然后，我们将下面的链码复制到用上面的命令创建的名为<code class="eh mm mn mo mp b">be.go</code>的文件中。" github . com/hyperledger/fabric-contract-API-go/contract API "</p><figure class="mw mx my mz fq iu"><div class="bz el l di"><div class="na nb l"/></div></figure><p id="6638" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">在这里，我们需要得到我们写在链码和其他go依赖项中的依赖项<code class="eh mm mn mo mp b">github.com/hyperledger/fabric-contract-api-go/contractapi</code>。我们可以在任何我们想要的终端上执行它。没有必要执行两个终端。</p><pre class="mw mx my mz fq nc mp nd ne aw nf dt"><span id="9a0e" class="ng lk ht mp b fv nh ni l nj nk">go get github.com/hyperledger/fabric-chaincode-go/shim<br/>go get github.com/hyperledger/fabric-contract-api-go/contractapi</span></pre><blockquote class="mq mr ms"><p id="90a9" class="jb jc kj jd b je jf jg jh ji jj jk jl mt jn jo jp mu jr js jt mv jv jw jx jy hm dt translated">我们可以修改您目录中的go.mod和vendor文件来避开上面的命令，执行GO111MODULE命令。但是从Fabric samples下载的abstore示例下的chaincode有正确的文件，所以我们通过以下命令使用它们的go.mod和vendor文件</p></blockquote><pre class="mw mx my mz fq nc mp nd ne aw nf dt"><span id="0b0f" class="ng lk ht mp b fv nh ni l nj nk">cd /opt/gopath/src/chain/abstore/go<br/>GO111MODULE=on go mod vendor<br/>cd -</span></pre><figure class="mw mx my mz fq iu fe ff paragraph-image"><div class="fe ff om"><img src="../Images/43d14834fc54a18a9f16c31098607829.png" data-original-src="https://miro.medium.com/v2/resize:fit:1204/format:webp/1*EKjbVvj9nKAEt4xPU7JBQg.png"/></div><figcaption class="nm nn fg fe ff no np bd b be z ek">GO111MODULE</figcaption></figure><p id="620f" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">根据链码生命周期，我们通过在任何终端执行以下命令来打包链码。</p><pre class="mw mx my mz fq nc mp nd ne aw nf dt"><span id="f46e" class="ng lk ht mp b fv nh ni l nj nk">peer lifecycle chaincode package becc.tar.gz --path chain/be_chaincode/go/ --lang golang --label becc_1</span></pre><figure class="mw mx my mz fq iu fe ff paragraph-image"><div class="fe ff oj"><img src="../Images/0b694af5493747664112c474e4e41f1f.png" data-original-src="https://miro.medium.com/v2/resize:fit:976/format:webp/1*nUHozoDMfkEU1nPnNwK_2Q.png"/></div><figcaption class="nm nn fg fe ff no np bd b be z ek">package the chaincode</figcaption></figure><p id="b3a2" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">现在，我们将从所有对等机安装这个包，因此我们从所有终端执行下面的命令。</p><pre class="mw mx my mz fq nc mp nd ne aw nf dt"><span id="e76f" class="ng lk ht mp b fv nh ni l nj nk">peer lifecycle chaincode install becc.tar.gz</span></pre><figure class="mw mx my mz fq iu fe ff paragraph-image"><div class="fe ff oj"><img src="../Images/dee3b49fb168c79022114aae48f4fcaf.png" data-original-src="https://miro.medium.com/v2/resize:fit:976/format:webp/1*UMtn02nl4PulvX5P7VixiA.png"/></div><figcaption class="nm nn fg fe ff no np bd b be z ek">install the chaincode</figcaption></figure><p id="27a3" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">我们将从所有对等点查询install，因此我们从所有终端执行下面的命令，我们将获得将在接下来的步骤中使用的<code class="eh mm mn mo mp b">Package ID</code>。</p><pre class="mw mx my mz fq nc mp nd ne aw nf dt"><span id="2676" class="ng lk ht mp b fv nh ni l nj nk">peer lifecycle chaincode queryinstalled</span></pre><figure class="mw mx my mz fq iu fe ff paragraph-image"><div class="fe ff ok"><img src="../Images/94bb1aaaa49ce31354e5ab8c9f961a56.png" data-original-src="https://miro.medium.com/v2/resize:fit:970/format:webp/1*UzbjhiptMjMqgLJ06Kt4Eg.png"/></div><figcaption class="nm nn fg fe ff no np bd b be z ek">queryinstalled the chaincode</figcaption></figure><p id="b26f" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">为了方便使用，我们将<code class="eh mm mn mo mp b">Package ID</code>设置到<code class="eh mm mn mo mp b">CC_PACKAGE_ID</code>变量中。</p><pre class="mw mx my mz fq nc mp nd ne aw nf dt"><span id="0d78" class="ng lk ht mp b fv nh ni l nj nk">CC_PACKAGE_ID=becc_1:5f80a06945e5e36824c400dad9a4ccfe0040cc0551fe1bb1b95a68f892cf56c2</span></pre><p id="a811" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">我们将在chaincode包安装到我们的对等机之后批准chaincode定义，因此我们从所有终端执行以下命令。</p><pre class="mw mx my mz fq nc mp nd ne aw nf dt"><span id="a50e" class="ng lk ht mp b fv nh ni l nj nk">peer lifecycle chaincode approveformyorg -o orderer.burakcan-network.com:7050 --tls true --cafile $ORDERER_CA --channelID channeldemo --name becc --version 1 --init-required --package-id $CC_PACKAGE_ID --sequence 1 --signature-policy "OR('Burakcan1MSP.peer', 'Burakcan2MSP.peer')"</span></pre><div class="mw mx my mz fq ab cb"><figure class="on iu oo op oq or os paragraph-image"><img src="../Images/89918ce7d469e429a2d1c5585c3e8cb9.png" data-original-src="https://miro.medium.com/v2/resize:fit:974/format:webp/1*ky1H4XCo7b-048VMJyuqlQ.png"/></figure><figure class="on iu ot op oq or os paragraph-image"><img src="../Images/4fee71fa6b398696c3eee29b29535820.png" data-original-src="https://miro.medium.com/v2/resize:fit:976/format:webp/1*fe6Z565uYNC8nYpsFUlA7g.png"/><figcaption class="nm nn fg fe ff no np bd b be z ek ou di ov ow">approve the chaincode from all peers</figcaption></figure></div><p id="4408" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">在提交链代码之前，我们可以检查<code class="eh mm mn mo mp b">Burakcan1MSP</code>和<code class="eh mm mn mo mp b">Burakcan2MSP</code>是否准备好提交。这不是必须的，但是有益的。因此，我们在一个对等体中执行以下命令。</p><pre class="mw mx my mz fq nc mp nd ne aw nf dt"><span id="084e" class="ng lk ht mp b fv nh ni l nj nk">peer lifecycle chaincode checkcommitreadiness --channelID channeldemo --name becc --version 1 --sequence 1 --output json --init-required --signature-policy "OR('Burakcan1MSP.peer', 'Burakcan2MSP.peer')"</span></pre><figure class="mw mx my mz fq iu fe ff paragraph-image"><div class="fe ff oj"><img src="../Images/f1e4ec1820078c69cd0fd113e25ec72e.png" data-original-src="https://miro.medium.com/v2/resize:fit:976/format:webp/1*kKx7g1oTadcwgv0-eYZZZQ.png"/></div><figcaption class="nm nn fg fe ff no np bd b be z ek">check commit readiness</figcaption></figure><p id="0723" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">如果我们看到<code class="eh mm mn mo mp b">Burakcan1MSP</code>和<code class="eh mm mn mo mp b">Burakcan2MSP</code>已经准备好批准，我们可以提交链代码。在提交链码之前，我们将定义为<code class="eh mm mn mo mp b">peer0.be1.burakcan-network.com:7051</code>和<code class="eh mm mn mo mp b">peer0.be2.burakcan-network.com:7051</code>的每个对等体的证书路径设置到<code class="eh mm mn mo mp b">PEER_BE1_TLSROOTCERTFILES</code>和<code class="eh mm mn mo mp b">PEER_BE1_TLSROOTCERTFILES</code>变量中，以便于使用。</p><pre class="mw mx my mz fq nc mp nd ne aw nf dt"><span id="25d9" class="ng lk ht mp b fv nh ni l nj nk">PEER_BE1_TLSROOTCERTFILES=/opt/gopath/fabric-samples/burakcan-network/crypto-config/peerOrganizations/be1.burakcan-network.com/peers/peer0.be1.burakcan-network.com/tls/ca.crt<br/>PEER_BE2_TLSROOTCERTFILES=/opt/gopath/fabric-samples/burakcan-network/crypto-config/peerOrganizations/be2.burakcan-network.com/peers/peer0.be2.burakcan-network.com/tls/ca.crt</span></pre><p id="2e43" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">然后，我们在一个对等体中提交链码，我们看到它对<code class="eh mm mn mo mp b">peer0.be1.burakcan-network.com:7051</code>和<code class="eh mm mn mo mp b">peer0.be2.burakcan-network.com:7051</code>对等体有效。</p><pre class="mw mx my mz fq nc mp nd ne aw nf dt"><span id="3e56" class="ng lk ht mp b fv nh ni l nj nk">peer lifecycle chaincode commit -o orderer.burakcan-network.com:7050 --tls true --cafile $ORDERER_CA --channelID channeldemo --name becc --peerAddresses peer0.be1.burakcan-network.com:7051 --tlsRootCertFiles $PEER_BE1_TLSROOTCERTFILES --peerAddresses peer0.be2.burakcan-network.com:7051 --tlsRootCertFiles $PEER_BE2_TLSROOTCERTFILES --version 1 --sequence 1 --init-required --signature-policy "OR('Burakcan1MSP.peer', 'Burakcan2MSP.peer')"</span></pre><figure class="mw mx my mz fq iu fe ff paragraph-image"><div class="fe ff oh"><img src="../Images/4187e7c14e65fc81a90954d2716359cb.png" data-original-src="https://miro.medium.com/v2/resize:fit:972/format:webp/1*AHaIOcHuDsJGkrKJ1u_oqA.png"/></div><figcaption class="nm nn fg fe ff no np bd b be z ek">commit the chaincode</figcaption></figure><p id="4b48" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">我们可以通过下面的命令检查已经提交的链码定义。</p><pre class="mw mx my mz fq nc mp nd ne aw nf dt"><span id="be9a" class="ng lk ht mp b fv nh ni l nj nk">peer lifecycle chaincode querycommitted --channelID channeldemo --name becc</span></pre><figure class="mw mx my mz fq iu fe ff paragraph-image"><div class="fe ff oh"><img src="../Images/ce128eff558972dc6624d95a075fea17.png" data-original-src="https://miro.medium.com/v2/resize:fit:972/format:webp/1*wOEWltyvtPiDQ_GI4ykvwQ.png"/></div><figcaption class="nm nn fg fe ff no np bd b be z ek">querycommit the chaincode</figcaption></figure></div><div class="ab cl lc ld hb le" role="separator"><span class="lf bw bk lg lh li"/><span class="lf bw bk lg lh li"/><span class="lf bw bk lg lh"/></div><div class="hm hn ho hp hq"><h1 id="0693" class="lj lk ht bd ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg dt translated">查询链码并与网络交互</h1><p id="3f88" class="pw-post-body-paragraph jb jc ht jd b je mh jg jh ji mi jk jl jm mj jo jp jq mk js jt ju ml jw jx jy hm dt translated">提交链码后，如果一切正常，我们就可以查询链码并与网络交互。在使用Hyperledger Fabric v2进行查询时，我们可以使用旧的链码生命周期。</p><p id="193d" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">因为我们必须首先调用chaincode，所以我们在任何终端中使用<code class="eh mm mn mo mp b">peer chaincode invoke</code>命令并调用<code class="eh mm mn mo mp b">InitLedger</code>方法，就像你在之前定义的chaincode中看到的那样。</p><pre class="mw mx my mz fq nc mp nd ne aw nf dt"><span id="1f03" class="ng lk ht mp b fv nh ni l nj nk">peer chaincode invoke -o orderer.burakcan-network.com:7050 --tls true --cafile $ORDERER_CA -C channeldemo -n becc --peerAddresses peer0.be1.burakcan-network.com:7051 --tlsRootCertFiles $PEER_BE1_TLSROOTCERTFILES --peerAddresses peer0.be2.burakcan-network.com:7051 --tlsRootCertFiles $PEER_BE2_TLSROOTCERTFILES --isInit -c '{"function":"initLedger","Args":[]}'</span></pre><figure class="mw mx my mz fq iu fe ff paragraph-image"><div class="fe ff ok"><img src="../Images/6ee43a1d00fa3d3f307f69aae9872654.png" data-original-src="https://miro.medium.com/v2/resize:fit:970/format:webp/1*cQX9C5tzZWS1FxeLr4tsWQ.png"/></div><figcaption class="nm nn fg fe ff no np bd b be z ek">invoke the chaincode</figcaption></figure><p id="5d37" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">如果我们看到<code class="eh mm mn mo mp b">status:200</code>消息，我们可以查询我们想要的任何对等体的链码。这就是为什么我们在<code class="eh mm mn mo mp b">peer0.be1.burakcan-network.com:7051</code> peer中调用<code class="eh mm mn mo mp b">QueryAllProducts</code>方法，它将显示我们在<code class="eh mm mn mo mp b">InitLedger</code>方法中放置分类帐的所有产品。</p><pre class="mw mx my mz fq nc mp nd ne aw nf dt"><span id="b981" class="ng lk ht mp b fv nh ni l nj nk">peer chaincode query -C channeldemo -n becc -c '{"Args":["queryAllProducts"]}'</span></pre><figure class="mw mx my mz fq iu fe ff paragraph-image"><div class="fe ff oh"><img src="../Images/fe3f07cb425f5e8c2dcb3ad6fabbb1e5.png" data-original-src="https://miro.medium.com/v2/resize:fit:972/format:webp/1*v1QhFCGX4LC3OnXpmMj4oA.png"/></div><figcaption class="nm nn fg fe ff no np bd b be z ek">query all products</figcaption></figure><p id="4bc4" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">现在，我们再次调用invoke命令，因为我们想要更改产品价格，这意味着我们想要对资产进行更改。当网络成员想要转移或改变分类帐上的资产时，链码被调用。因此，我们通过在<code class="eh mm mn mo mp b">peer0.be1.burakcan-network.com:7051</code> peer中执行下面的命令来调用<code class="eh mm mn mo mp b">ChangeProductPrice</code>方法。</p><pre class="mw mx my mz fq nc mp nd ne aw nf dt"><span id="85f4" class="ng lk ht mp b fv nh ni l nj nk">peer chaincode invoke -o orderer.burakcan-network.com:7050 --tls true --cafile $ORDERER_CA -C channeldemo -n becc --peerAddresses peer0.be1.burakcan-network.com:7051 --tlsRootCertFiles $PEER_BE1_TLSROOTCERTFILES --peerAddresses peer0.be2.burakcan-network.com:7051 --tlsRootCertFiles $PEER_BE2_TLSROOTCERTFILES -c '{"function":"changeProductPrice","Args":["PRODUCT0", 350]}'</span></pre><figure class="mw mx my mz fq iu fe ff paragraph-image"><div class="fe ff oj"><img src="../Images/8231406d62249ca01a6062be6607d3f6.png" data-original-src="https://miro.medium.com/v2/resize:fit:976/format:webp/1*jfySYG1bjogmBKFWlsAVAw.png"/></div><figcaption class="nm nn fg fe ff no np bd b be z ek">change product price</figcaption></figure><p id="7865" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">如果上面的命令工作正常，我们应该看到价格为350而不是250。这就是为什么我们把<code class="eh mm mn mo mp b">peer0.be2.burakcan-network.com:7051</code>中的<code class="eh mm mn mo mp b">QueryAllProducts</code>方法叫做peer。</p><pre class="mw mx my mz fq nc mp nd ne aw nf dt"><span id="c022" class="ng lk ht mp b fv nh ni l nj nk">peer chaincode query -C channeldemo -n becc -c '{"Args":["queryAllProducts"]}'</span></pre><figure class="mw mx my mz fq iu fe ff paragraph-image"><div class="fe ff ol"><img src="../Images/4f7f014c8237a248f43713e26c2930b8.png" data-original-src="https://miro.medium.com/v2/resize:fit:978/format:webp/1*GGR7ZItaBHKBE6Ea9ni08w.png"/></div><figcaption class="nm nn fg fe ff no np bd b be z ek">query all products</figcaption></figure><p id="0193" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">是的，我们可以看到<code class="eh mm mn mo mp b">PRODUCT0</code>价格是350而不是250，所以这意味着一切正常。</p></div><div class="ab cl lc ld hb le" role="separator"><span class="lf bw bk lg lh li"/><span class="lf bw bk lg lh li"/><span class="lf bw bk lg lh"/></div><div class="hm hn ho hp hq"><h1 id="d26e" class="lj lk ht bd ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg dt translated">沿着网络</h1><p id="d848" class="pw-post-body-paragraph jb jc ht jd b je mh jg jh ji mi jk jl jm mj jo jp jq mk js jt ju ml jw jx jy hm dt translated">当我们的工作完成后，我们可以关闭我们的网络，这样我们就可以使用终端来打开网络并执行下面的命令。</p><pre class="mw mx my mz fq nc mp nd ne aw nf dt"><span id="2806" class="ng lk ht mp b fv nh ni l nj nk">docker-compose -f docker-compose-cli.yaml down</span></pre><figure class="mw mx my mz fq iu fe ff paragraph-image"><div role="button" tabindex="0" class="iv iw di ix bf iy"><div class="fe ff ox"><img src="../Images/090e226facb6d9aa4c08af957c2554df.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Zu7jOY_K8JbUP7BwEB8Lfw.png"/></div></div></figure><p id="d648" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">断开网络后，使用以下命令有利于避免可能出现的问题。</p><pre class="mw mx my mz fq nc mp nd ne aw nf dt"><span id="4041" class="ng lk ht mp b fv nh ni l nj nk">docker rm $(docker ps -aq)<br/>docker volume prune</span></pre><blockquote class="mq mr ms"><p id="52fd" class="jb jc kj jd b je jf jg jh ji jj jk jl mt jn jo jp mu jr js jt mv jv jw jx jy hm dt translated">有时我们想要升级或部署新的链码，我们可能会面临这样的错误，即“<em class="ht"/>'<em class="ht">becc '的链码定义存在，但链码未安装</em>”，尽管我们执行了对等链码生命周期安装命令。这时，我们需要删除我们为同行安装的chaincode的图像。我们可以通过执行以下命令来查看这些图像。前2个图像属于我们在<code class="eh mm mn mo mp b">peer0.be1.burakcan-network.com:7051</code>和<code class="eh mm mn mo mp b">peer0.be2.burakcan-network.com:7051</code>对等体中安装的链码。</p></blockquote><pre class="mw mx my mz fq nc mp nd ne aw nf dt"><span id="5cd5" class="ng lk ht mp b fv nh ni l nj nk">docker images</span></pre><figure class="mw mx my mz fq iu fe ff paragraph-image"><div role="button" tabindex="0" class="iv iw di ix bf iy"><div class="fe ff fg"><img src="../Images/42350be615dcbcade894dce029e5f152.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gVkNFsbZuRD7LHr7NT0giQ.png"/></div></div><figcaption class="nm nn fg fe ff no np bd b be z ek">docker images</figcaption></figure><pre class="mw mx my mz fq nc mp nd ne aw nf dt"><span id="676c" class="ng lk ht mp b fv nh ni l nj nk">docker rmi &lt;IMAGE_ID&gt;</span></pre><p id="8cef" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">我们可以通过他们的<code class="eh mm mn mo mp b">IMAGE ID</code>属性删除。您可以从上面写图像id，而不是为每个链码docker图像写<code class="eh mm mn mo mp b">&lt;IMAGE_ID&gt;</code>变量。你可以重新开始。</p><p id="6092" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">就是这样，我们有；</p><ul class=""><li id="dfc7" class="nq nr ht jd b je jf ji jj jm ns jq nt ju nu jy nv nw nx ny dt translated">安装的先决条件</li><li id="2c7a" class="nq nr ht jd b je nz ji oa jm ob jq oc ju od jy nv nw nx ny dt translated">安装的示例、二进制文件和Docker映像</li><li id="886a" class="nq nr ht jd b je nz ji oa jm ob jq oc ju od jy nv nw nx ny dt translated">提起风俗<code class="eh mm mn mo mp b">burakcan-network</code></li><li id="4221" class="nq nr ht jd b je nz ji oa jm ob jq oc ju od jy nv nw nx ny dt translated">创建了一个名为<code class="eh mm mn mo mp b">channeldemo</code>的频道</li><li id="c410" class="nq nr ht jd b je nz ji oa jm ob jq oc ju od jy nv nw nx ny dt translated">部署<code class="eh mm mn mo mp b">be.go</code>为链码<code class="eh mm mn mo mp b">becc</code></li><li id="e972" class="nq nr ht jd b je nz ji oa jm ob jq oc ju od jy nv nw nx ny dt translated">查询并调用了链码</li><li id="08b8" class="nq nr ht jd b je nz ji oa jm ob jq oc ju od jy nv nw nx ny dt translated">与自定义交互<code class="eh mm mn mo mp b">burakcan-network</code></li></ul><p id="9597" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">在这个故事里。</p><blockquote class="oy"><p id="eabb" class="oz pa ht bd pb pc pd pe pf pg ph jy ek translated"><a class="ae ki" href="https://coincodecap.com/?utm_source=coinmonks" rel="noopener ugc nofollow" target="_blank">直接在您的收件箱中获得最佳软件交易</a></p></blockquote><figure class="pj pk pl pm pn iu fe ff paragraph-image"><a href="https://coincodecap.com/?utm_source=coinmonks"><div class="fe ff pi"><img src="../Images/7c0b3dfdcbfea594cc0ae7d4f9bf6fcb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1168/format:webp/0*OJ-qb5G6i863msBB.png"/></div></a></figure></div></div>    
</body>
</html>