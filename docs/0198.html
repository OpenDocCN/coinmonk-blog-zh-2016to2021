<html>
<head>
<title>Sign an Ethereum transaction off-line</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">离线签署以太坊交易</h1>
<blockquote>原文：<a href="https://medium.com/coinmonks/sign-an-ethereum-transaction-off-line-d3e38fbda677?source=collection_archive---------0-----------------------#2018-03-30">https://medium.com/coinmonks/sign-an-ethereum-transaction-off-line-d3e38fbda677?source=collection_archive---------0-----------------------#2018-03-30</a></blockquote><div><div class="ef hh hi hj hk hl"/><div class="hm hn ho hp hq"><div class=""/><p id="1de9" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">在这篇文章中，我们将看看如何使用<a class="ae jo" href="https://github.com/ethereumjs/ethereumjs-tx" rel="noopener ugc nofollow" target="_blank">以太坊js-tx </a>和<a class="ae jo" href="https://nodejs.org/en/" rel="noopener ugc nofollow" target="_blank"> Node.js </a>对以太坊交易进行离线签名。回购可用<a class="ae jo" href="https://github.com/NFhbar/nodeJS-ETH-transaction" rel="noopener ugc nofollow" target="_blank">此处</a>。</p></div><div class="ab cl jp jq hb jr" role="separator"><span class="js bw bk jt ju jv"/><span class="js bw bk jt ju jv"/><span class="js bw bk jt ju"/></div><div class="hm hn ho hp hq"><h1 id="c089" class="jw jx ht bd jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt dt translated">设置您的本地实例</h1><p id="5c6a" class="pw-post-body-paragraph iq ir ht is b it ku iv iw ix kv iz ja jb kw jd je jf kx jh ji jj ky jl jm jn hm dt translated">将<a class="ae jo" href="https://github.com/NFhbar/nodeJS-ETH-transaction" rel="noopener ugc nofollow" target="_blank"> repo </a>克隆到您的本地机器上:</p><pre class="kz la lb lc fq ld le lf lg aw lh dt"><span id="613a" class="li jx ht le b fv lj lk l ll lm">git clone git@github.com:NFhbar/nodeJS-ETH-transaction.git</span></pre><p id="498c" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">安装它:</p><p id="2b6d" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated"><code class="eh ln lo lp le b">$ npm install</code></p><p id="426a" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">你还需要<a class="ae jo" href="http://truffleframework.com/ganache/" rel="noopener ugc nofollow" target="_blank"> Ganache </a>。</p><h1 id="73ad" class="jw jx ht bd jy jz lq kb kc kd lr kf kg kh ls kj kk kl lt kn ko kp lu kr ks kt dt translated">发送以太网</h1><p id="845b" class="pw-post-body-paragraph iq ir ht is b it ku iv iw ix kv iz ja jb kw jd je jf kx jh ji jj ky jl jm jn hm dt translated">让我们看看这是如何工作的。首先启动本地Ganache实例:</p><figure class="kz la lb lc fq lw fe ff paragraph-image"><div role="button" tabindex="0" class="lx ly di lz bf ma"><div class="fe ff lv"><img src="../Images/0787defa0dd4d13d3788626492952b53.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9Wfmj_meoPjXEmQs_1uhUg.png"/></div></div><figcaption class="md me fg fe ff mf mg bd b be z ek">First couple blocks in Ganache.</figcaption></figure><p id="6909" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">启动Ganache后，您应该会看到块开始填充。我把我的封锁时间设置为3秒，但你可以把它设置为任何你喜欢的。</p><p id="f994" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">接下来，让我们开始节点菜单，cd到您的项目文件夹，并:</p><pre class="kz la lb lc fq ld le lf lg aw lh dt"><span id="44c3" class="li jx ht le b fv lj lk l ll lm">$ npm run start</span></pre><figure class="kz la lb lc fq lw fe ff paragraph-image"><div role="button" tabindex="0" class="lx ly di lz bf ma"><div class="fe ff mh"><img src="../Images/c136af93e2e2c9e42bb3fbe07aa990f5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*eLYmiRobYeIeqswc7KNSMg.png"/></div></div><figcaption class="md me fg fe ff mf mg bd b be z ek">Node.js menu.</figcaption></figure><p id="c4ce" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">太好了！现在让我们尝试发送一个事务。按1将乙醚从一个Ganache帐户发送到另一个帐户:</p><figure class="kz la lb lc fq lw fe ff paragraph-image"><div role="button" tabindex="0" class="lx ly di lz bf ma"><div class="fe ff mi"><img src="../Images/52db6c5517aa14c71111268712aedc4f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*oqNsMMX9KJAyLNm_fjHb9A.png"/></div></div><figcaption class="md me fg fe ff mf mg bd b be z ek">Send Ether receipt.</figcaption></figure><p id="83a7" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">如果您看到此屏幕，这意味着交易已成功发送！您看到的是您的交易收据，包括块散列、交易散列、使用的气体等。</p><p id="4053" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">您还可以在Ganache中检查您的交易:</p><figure class="kz la lb lc fq lw fe ff paragraph-image"><div role="button" tabindex="0" class="lx ly di lz bf ma"><div class="fe ff mj"><img src="../Images/b60a477f1dcc7615108bee2162bb015d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wRGck17JlTHOirNKqcdXwA.png"/></div></div><figcaption class="md me fg fe ff mf mg bd b be z ek">Ganache showing tx.</figcaption></figure><p id="2faa" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">点击交易了解更多详情:</p><figure class="kz la lb lc fq lw fe ff paragraph-image"><div role="button" tabindex="0" class="lx ly di lz bf ma"><div class="fe ff mk"><img src="../Images/46d59a8c56be631fa300c48c98d77bdd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*e2gQ9nAbq4VFNI1aZIWROg.png"/></div></div><figcaption class="md me fg fe ff mf mg bd b be z ek">Ganache tx details.</figcaption></figure><p id="ffad" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">酷，让我们看看代码。</p><h1 id="b2a2" class="jw jx ht bd jy jz lq kb kc kd lr kf kg kh ls kj kk kl lt kn ko kp lu kr ks kt dt translated">离线签署交易</h1><p id="c6c5" class="pw-post-body-paragraph iq ir ht is b it ku iv iw ix kv iz ja jb kw jd je jf kx jh ji jj ky jl jm jn hm dt translated">繁重的工作由<a class="ae jo" href="https://github.com/ethereumjs/ethereumjs-tx" rel="noopener ugc nofollow" target="_blank"> ethereumjs-tx </a>完成，它允许您轻松地创建原始事务、签署它们并序列化它们。让我们复习一下逻辑。</p><p id="b601" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">首先，我们需要web3连接到本地Ganache实例:</p><pre class="kz la lb lc fq ld le lf lg aw lh dt"><span id="3b9d" class="li jx ht le b fv lj lk l ll lm">import Web3 from 'web3';</span><span id="6681" class="li jx ht le b fv ml lk l ll lm">var web3 = new Web3(new Web3.providers.HttpProvider('<a class="ae jo" href="http://127.0.0.1:7545'" rel="noopener ugc nofollow" target="_blank">http://127.0.0.1:7545'</a>));</span><span id="ac5a" class="li jx ht le b fv ml lk l ll lm">export default web3;</span></pre><p id="deb7" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">我们现在可以在任何需要的地方导入我们的web3实例。</p><p id="32cb" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">接下来，我们来看看交易是如何准备和发送的:</p><figure class="kz la lb lc fq lw"><div class="bz el l di"><div class="mm mn l"/></div></figure><p id="735f" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">有三种导入方式:</p><ul class=""><li id="f94e" class="mo mp ht is b it iu ix iy jb mq jf mr jj ms jn mt mu mv mw dt translated">web3的Ganache连接实例</li><li id="82d6" class="mo mp ht is b it mx ix my jb mz jf na jj nb jn mt mu mv mw dt translated">我们账户文件中的账户</li><li id="a31f" class="mo mp ht is b it mx ix my jb mz jf na jj nb jn mt mu mv mw dt translated">交易生成器文件来传递我们的交易数据</li></ul><p id="e256" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">然后，我们的函数获得交易所需的所有值:估计天然气、天然气价格、交易计数等。发送的数量被设置为20 eth，但是如果你愿意的话，你可以很容易地将它设置为由菜单动态接受。然后，我们构建一个事务数据结构，并将其传递给我们的事务构建器:</p><figure class="kz la lb lc fq lw"><div class="bz el l di"><div class="mm mn l"/></div></figure><p id="4d32" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">有三种导入方式:</p><ul class=""><li id="cc4c" class="mo mp ht is b it iu ix iy jb mq jf mr jj ms jn mt mu mv mw dt translated">web3的Ganache连接实例</li><li id="a115" class="mo mp ht is b it mx ix my jb mz jf na jj nb jn mt mu mv mw dt translated">来自ethereumjs-Tx的tx实例</li><li id="11a6" class="mo mp ht is b it mx ix my jb mz jf na jj nb jn mt mu mv mw dt translated">请保存我们的私钥</li></ul><p id="5504" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">我们通过以下方式获取我们的私钥:</p><pre class="kz la lb lc fq ld le lf lg aw lh dt"><span id="0e27" class="li jx ht le b fv lj lk l ll lm">var privateKey = new Buffer(process.env["PRIVATE_KEY"], "hex");</span></pre><p id="4c72" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">然后，我们使用web3 util将我们的值设置为十六进制:</p><pre class="kz la lb lc fq ld le lf lg aw lh dt"><span id="9c4a" class="li jx ht le b fv lj lk l ll lm">const nonceHex = web3.utils.toHex(nonce);<br/>const valueHex = web3.utils.toHex(value);<br/>const limitHex = web3.utils.toHex(gasLimit);<br/>const priceHex = web3.utils.toHex(gasPrice);</span></pre><p id="94d1" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">现在我们可以构建一个原始事务对象:</p><pre class="kz la lb lc fq ld le lf lg aw lh dt"><span id="8204" class="li jx ht le b fv lj lk l ll lm">switch (method) {<br/>    case 'sendEther':<br/>    rawTx = {<br/>      nonce: nonceHex,<br/>      gasPrice: priceHex,<br/>      gasLimit: limitHex,<br/>      to: toAddress,<br/>      value: valueHex<br/>    };<br/>    break;<br/>  }</span></pre><p id="6cbd" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">您可以为您喜欢执行的任何交易添加更多案例。</p><p id="1856" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">最后，我们可以签署我们的交易并将其退回发送:</p><pre class="kz la lb lc fq ld le lf lg aw lh dt"><span id="bda1" class="li jx ht le b fv lj lk l ll lm">var tx = new Tx(rawTx);<br/>tx.sign(privateKey);<br/>var serializedTx = tx.serialize();</span><span id="ca87" class="li jx ht le b fv ml lk l ll lm">return serializedTx;</span></pre><p id="6f48" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">很好，现在我们可以简单地通过web3方法发送它:</p><pre class="kz la lb lc fq ld le lf lg aw lh dt"><span id="ba55" class="li jx ht le b fv lj lk l ll lm">await web3.eth.sendSignedTransaction('0x' + rawTx.toString('hex'));</span></pre></div><div class="ab cl jp jq hb jr" role="separator"><span class="js bw bk jt ju jv"/><span class="js bw bk jt ju jv"/><span class="js bw bk jt ju"/></div><div class="hm hn ho hp hq"><p id="367f" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">就是这样！如你所见<a class="ae jo" href="https://github.com/ethereumjs/ethereumjs-tx" rel="noopener ugc nofollow" target="_blank"> ethereumjs-tx </a>是一个非常棒的小模块。</p><p id="c362" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">非常感谢你阅读这篇文章！如果你觉得这篇文章很有用<strong class="is hu">，请点击这篇文章，并确保关注我的更多常规内容</strong>，也请查看我的<a class="ae jo" href="https://github.com/NFhbar" rel="noopener ugc nofollow" target="_blank"> Github </a>，因为我定期发布示例代码和项目。如果你有任何问题，欢迎在下面回复或者给我发邮件。</p><blockquote class="nc"><p id="4a26" class="nd ne ht bd nf ng nh ni nj nk nl jn ek translated"><a class="ae jo" href="https://coincodecap.com/?utm_source=coinmonks" rel="noopener ugc nofollow" target="_blank">直接在您的收件箱中获得最佳软件交易</a></p></blockquote><figure class="nn no np nq nr lw fe ff paragraph-image"><a href="https://coincodecap.com/?utm_source=coinmonks"><div class="fe ff nm"><img src="../Images/7c0b3dfdcbfea594cc0ae7d4f9bf6fcb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1168/format:webp/0*OJ-qb5G6i863msBB.png"/></div></a></figure><p id="4dc8" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">编码快乐！</p><figure class="kz la lb lc fq lw"><div class="bz el l di"><div class="ns mn l"/></div></figure></div></div>    
</body>
</html>