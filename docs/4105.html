<html>
<head>
<title>Ethereum under the hood: Part 4 (The Trie)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">引擎盖下的以太坊:第四部分(特里)</h1>
<blockquote>原文：<a href="https://medium.com/coinmonks/ethereum-under-the-hood-part-4-the-trie-fc029e25ed04?source=collection_archive---------3-----------------------#2021-02-25">https://medium.com/coinmonks/ethereum-under-the-hood-part-4-the-trie-fc029e25ed04?source=collection_archive---------3-----------------------#2021-02-25</a></blockquote><div><div class="ef hh hi hj hk hl"/><div class="hm hn ho hp hq"><div class=""/><p id="d203" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated"><strong class="is hu">更新:语法修正</strong></p><p id="d891" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">这一集假设你已经看完了这个系列的<a class="ae jo" rel="noopener" href="/coinmonks/ethereum-under-the-hood-part-i-ver-0-1-4f2fb24b3d68">第一部</a>，第二部，<a class="ae jo" rel="noopener" href="/coinmonks/ethereum-under-the-hood-part-3-rlp-decoding-c0c07f5c0714">第三部</a>，如果你还没有看完这篇文章，请先看完。这一集的标题是“特里”，而不是“帕特里夏·默克尔·特里”(PMT)。我觉得有必要先了解一下尝试，而不是直接进入PMT。让我们开始吧:</p><p id="7749" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">我们将讨论:</p><ol class=""><li id="2eb3" class="jp jq ht is b it iu ix iy jb jr jf js jj jt jn ju jv jw jx dt translated">Trie及其应用？</li><li id="788f" class="jp jq ht is b it jy ix jz jb ka jf kb jj kc jn ju jv jw jx dt translated">对特里的更深入的研究</li><li id="49c4" class="jp jq ht is b it jy ix jz jb ka jf kb jj kc jn ju jv jw jx dt translated">以太坊与Trie的关系</li><li id="071d" class="jp jq ht is b it jy ix jz jb ka jf kb jj kc jn ju jv jw jx dt translated">一个示例实现</li><li id="d77c" class="jp jq ht is b it jy ix jz jb ka jf kb jj kc jn ju jv jw jx dt translated">接下来呢？</li></ol><p id="89e3" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated"><em class="kd">提示:我在</em> <strong class="is hu"> <em class="kd">中用粗体</em> </strong> <em class="kd">标注了一些单词，以强调重点或者引起你的注意。</em></p><h2 id="0bb3" class="ke kf ht bd kg kh ki kj kk kl km kn ko jb kp kq kr jf ks kt ku jj kv kw kx ky dt translated">Trie及其应用？：</h2><p id="5faa" class="pw-post-body-paragraph iq ir ht is b it kz iv iw ix la iz ja jb lb jd je jf lc jh ji jj ld jl jm jn hm dt translated">我们从尝试开始；有许多关于Trie的文章，请随意在维基上发表。Trie是一种数据结构，它意味着快速re <strong class="is hu"> trie </strong> val以及单词“trie”。使用trie数据结构的一个真实用例是聊天会话时的<a class="ae jo" href="https://www.youtube.com/watch?v=Wqzp0KC6DfE" rel="noopener ugc nofollow" target="_blank"> <strong class="is hu">自动完成</strong> </a>或<strong class="is hu">自动纠正</strong>功能，与下面的不完全一样:-)</p><figure class="lf lg lh li fq lj fe ff paragraph-image"><div class="fe ff le"><img src="../Images/030388b7446dc83b5f6b7bc5623f6ff1.png" data-original-src="https://miro.medium.com/v2/resize:fit:640/format:webp/1*MVnGfQxKDmaLkV1gLqrtYg.jpeg"/></div><figcaption class="lm ln fg fe ff lo lp bd b be z ek">Source:AutocorrectEpicFail.com</figcaption></figure><p id="0e76" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">对于自动填充或自动纠正，我们需要多种可能性的快速查找，存储和检索给定<strong class="is hu">前缀</strong>的值应该很快，这就是为什么Trie是这些用例的有用数据结构。</p><h2 id="fd35" class="ke kf ht bd kg kh ki kj kk kl km kn ko jb kp kq kr jf ks kt ku jj kv kw kx ky dt translated">更深入地了解尝试:</h2><p id="5a60" class="pw-post-body-paragraph iq ir ht is b it kz iv iw ix la iz ja jb lb jd je jf lc jh ji jj ld jl jm jn hm dt translated">请看下图，它将给定的<strong class="is hu">字符集</strong>映射到给定的<strong class="is hu">单词集</strong>的简化Trie数据结构中。</p><figure class="lf lg lh li fq lj fe ff paragraph-image"><div role="button" tabindex="0" class="lr ls di lt bf lu"><div class="fe ff lq"><img src="../Images/b2292bcf98099192eabd3ca9c8a980d5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FkU8dLdteF5B-8ijDdisrw.png"/></div></div><figcaption class="lm ln fg fe ff lo lp bd b be z ek">Basic Trie</figcaption></figure><p id="698f" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">在我们简化的Trie中，这些圆圈中的每一个都可以被认为是具有某些属性的<strong class="is hu">节点。</strong>在我们简化的trie中，有三种节点1)<strong class="is hu">根节点</strong>节点(绿色)2)字符节点(蓝色)3)空节点(橙色)。现在让我们回到正题，添加一些我们熟悉的以太坊的属性。</p><p id="b4fd" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">所有节点类型(蓝色、绿色、橙色)都可能具有三个基本属性之一的值:</p><ol class=""><li id="1117" class="jp jq ht is b it iu ix iy jb jr jf js jj jt jn ju jv jw jx dt translated"><strong class="is hu"> <em class="kd">一个唯一的Id。</em> </strong></li><li id="e7c2" class="jp jq ht is b it jy ix jz jb ka jf kb jj kc jn ju jv jw jx dt translated"><strong class="is hu"> <em class="kd">指向子节点和父节点的单个字符和指针。</em>T41】</strong></li><li id="42f3" class="jp jq ht is b it jy ix jz jb ka jf kb jj kc jn ju jv jw jx dt translated"><strong class="is hu"> <em class="kd">状态id。</em>T45】</strong></li></ol><p id="a6a1" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">前两个属性是不言而喻的，但是属性#3: <strong class="is hu"> <em class="kd">状态Id </em> </strong>是一个令人兴奋且必不可少的属性，可以把它看作一个时间标记，或者简单地放一个维护全局状态Id的排序系统，例如:<strong class="is hu">状态- &gt; 0 </strong>是初始状态，下一个<strong class="is hu">状态- &gt; 1 </strong>。</p><p id="4b05" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">假设我们要添加的第一个<strong class="is hu">字是<strong class="is hu">“ABBA”</strong>，我们要添加的第二个<strong class="is hu"/>字是“abs”，数据结构可能如下所示:</strong></p><p id="68f1" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated"><code class="eh lv lw lx ly b">{ word = “<strong class="is hu">abba</strong>”, <strong class="is hu">state_id = 1 </strong>}</code></p><p id="893f" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated"><code class="eh lv lw lx ly b">{ word = “<strong class="is hu">abs</strong>” , <strong class="is hu">state_id = 2 </strong>}</code></p><p id="22a2" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated"><em class="kd">谁决定什么</em> <strong class="is hu"> <em class="kd">第一个</em> </strong> <em class="kd">和第二个</em> <strong class="is hu"> <em class="kd">下一个</em> </strong> <em class="kd">是另一天的故事</em>，我们将在后面的系列中讨论这个问题，但请坚持这个想法。考虑到这一点，我们现在可以有一个简单的数据结构，如下所示。为了我们简单的尝试。我们将向简化的trie函数发送三个参数。</p><p id="da32" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">基本Trie</p><p id="6a42" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated"><em class="kd">注:如果想了解trie更多，可以看看这篇优秀的</em> <a class="ae jo" rel="noopener" href="/basecs/trying-to-understand-tries-3ec6bede0014"> <em class="kd">文章</em> </a> <em class="kd">。</em></p><h2 id="8292" class="ke kf ht bd kg kh ki kj kk kl km kn ko jb kp kq kr jf ks kt ku jj kv kw kx ky dt translated">以太坊和Trie有什么关系？：</h2><p id="7985" class="pw-post-body-paragraph iq ir ht is b it kz iv iw ix la iz ja jb lb jd je jf lc jh ji jj ld jl jm jn hm dt translated">如果你还记得前两集<a class="ae jo" rel="noopener" href="/coinmonks/ethereum-under-the-hood-part-ii-i-933411deebe1">中的RLP</a>以太坊使用<strong class="is hu"> RLP </strong>来编码/解码值，例如，编码为<strong class="is hu"> 83 </strong> 64 6f 67】和<strong class="is hu">dig</strong>的字符串<em class="kd">64 69 67】将被编码为<strong class="is hu"> 83 </strong> 64 69 67】。这种编码值搜索需要快速访问。</em></p><p id="1eff" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated"><em class="kd">注:“狗”换算成十六进制是64 6f 67。</em></p><figure class="lf lg lh li fq lj fe ff paragraph-image"><div role="button" tabindex="0" class="lr ls di lt bf lu"><div class="fe ff lz"><img src="../Images/e4ab6dc441aa646bb7893bef0107b0cb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*15187gUyVZJkfUQX1-f3wA.png"/></div></div><figcaption class="lm ln fg fe ff lo lp bd b be z ek">“dog” and “dig” depicted as our Simplified Trie</figcaption></figure><p id="ca79" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">查看上面的trie，我们可以了解数据类型，我们可以确定数据类型以及它们的数量。查看trie的左侧，数字<strong class="is hu">“83”</strong>表示RLP编码规范指定的数据类型<strong class="is hu">字符串</strong>，有两个<strong class="is hu">。</strong></p><p id="1c1c" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">有三个主要功能应用于我们简化的Trie: 1)添加2)删除3)搜索节点。查看Trie的框架代码:</p><p id="fdf5" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated"><strong class="is hu"> <em class="kd"> Trie </em>添加<em class="kd">功能骨架代码:</em> </strong></p><pre class="lf lg lh li fq ma ly mb mc aw md dt"><span id="6426" class="ke kf ht ly b fv me mf l mg mh"><em class="kd">function</em> <strong class="ly hu">trie_add</strong>(trie, word, state_id){</span><span id="84e2" class="ke kf ht ly b fv mi mf l mg mh">//traverse through trie<br/>     //add whatever character node not available in the trie<br/>     //provide parent node id to child idto the new child node.<br/>     //add 'nil' node if applicable and map it to state_id</span><span id="ff2f" class="ke kf ht ly b fv mi mf l mg mh">return status;</span><span id="a128" class="ke kf ht ly b fv mi mf l mg mh">}</span></pre><p id="51c3" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated"><strong class="is hu"> <em class="kd"> Trie </em>搜索<em class="kd">函数骨架代码:</em> </strong></p><pre class="lf lg lh li fq ma ly mb mc aw md dt"><span id="186f" class="ke kf ht ly b fv me mf l mg mh"><em class="kd">function</em> <strong class="ly hu">trie_search</strong>(trie, word){</span><span id="9aa0" class="ke kf ht ly b fv mi mf l mg mh">//Start from Root "/"<br/>     //Retrieve all child nodes from "/"<br/>     //verify if there is a match   <br/>     //repeat until match completes</span><span id="ffbe" class="ke kf ht ly b fv mi mf l mg mh">return status;</span><span id="4a50" class="ke kf ht ly b fv mi mf l mg mh">}</span></pre><p id="28a9" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">回到以太坊，如果你记得我们讨论过以太坊世界状态，它本质上是一个键值对的散列。如下图所示:</p><figure class="lf lg lh li fq lj fe ff paragraph-image"><div role="button" tabindex="0" class="lr ls di lt bf lu"><div class="fe ff mj"><img src="../Images/8f6c7e0449aa8557ceda346fb9f98227.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cALs6LQJ86o9GVR5Ao3CDg.png"/></div></div><figcaption class="lm ln fg fe ff lo lp bd b be z ek">Source: <a class="ae jo" href="https://ethereum.stackexchange.com/questions/39915/ethereum-merkle-patricia-trie-extension-node" rel="noopener ugc nofollow" target="_blank">Stack exchange</a></figcaption></figure><p id="ada7" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">想象一下那些<strong class="is hu"><em class="kd">【nil】</em></strong>充当终结符的节点有一个类似于<strong class="is hu">【45】</strong>的数字，我在这里过于简单化了，但是当你在以太坊全局状态<a class="ae jo" href="https://ethereum.github.io/yellowpaper/paper.pdf" rel="noopener ugc nofollow" target="_blank"> <strong class="is hu"> <em class="kd">上查找</em></strong></a><strong class="is hu"><em class="kd"/></strong>为关键字前缀:<strong class="is hu">【a77d】</strong>，我们得到的值:<strong class="is hu"> <em class="kd"> {1.00 ETH，0我们可以这样表达:</em></strong></p><p id="caa8" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated"><code class="eh lv lw lx ly b"><strong class="is hu"><em class="kd">[ { “a77d337”: “1.00 WEI” }, {“a77d397”: “0.12 ETH”} ]</em></strong></code></p><p id="646c" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated"><a class="ae jo" href="https://ethereum.github.io/yellowpaper/paper.pdf" rel="noopener ugc nofollow" target="_blank">黄皮书</a>将此访问定义为:</p><figure class="lf lg lh li fq lj fe ff paragraph-image"><div class="fe ff mk"><img src="../Images/32cb86b4af05c2f32fa799aa0afca747.png" data-original-src="https://miro.medium.com/v2/resize:fit:1052/format:webp/1*Tiro4hq931RuotiMTRnTuw.png"/></div><figcaption class="lm ln fg fe ff lo lp bd b be z ek">Section 4.1 From the yellow Paper, where <strong class="bd ml">a</strong> is the address, <strong class="bd ml">b</strong> is the balance</figcaption></figure><h2 id="b05e" class="ke kf ht bd kg kh ki kj kk kl km kn ko jb kp kq kr jf ks kt ku jj kv kw kx ky dt translated">一个示例实现:</h2><p id="e7a1" class="pw-post-body-paragraph iq ir ht is b it kz iv iw ix la iz ja jb lb jd je jf lc jh ji jj ld jl jm jn hm dt translated">下面是用Python编写的Trie的代码片段(感谢<a class="mm mn gr" href="https://medium.com/u/bfc1fe602830?source=post_page-----fc029e25ed04--------------------------------" rel="noopener" target="_blank"> Vijay </a>)，我鼓励你自己制作一个简单的应用程序。</p><figure class="lf lg lh li fq lj fe ff paragraph-image"><div role="button" tabindex="0" class="lr ls di lt bf lu"><div class="fe ff mo"><img src="../Images/0217cb38f2292372d19ee16d10d3a635.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*U5-ShxFx6pB_qRHBdvs0dg.png"/></div></div><figcaption class="lm ln fg fe ff lo lp bd b be z ek"><strong class="bd ml">Source: GitHub: @coolcalbeans</strong></figcaption></figure><p id="6902" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated"><strong class="is hu">输出，Github: @coolcalbeans </strong></p><p id="beef" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">让我们在这里停下来喘口气。</p><h2 id="b02f" class="ke kf ht bd kg kh ki kj kk kl km kn ko jb kp kq kr jf ks kt ku jj kv kw kx ky dt translated">下一步是什么？：</h2><p id="f94a" class="pw-post-body-paragraph iq ir ht is b it kz iv iw ix la iz ja jb lb jd je jf lc jh ji jj ld jl jm jn hm dt translated">我建议你浏览一下参考资料，了解一下如何尝试。在下一节中，我们将讨论称为<strong class="is hu"> Patrica Merkle Trie </strong>的Trie的升级版本，以及它与以太坊的关系，在此之前请继续学习。</p><h1 id="2c61" class="mp kf ht bd kg mq mr ms kk mt mu mv ko mw mx my kr mz na nb ku nc nd ne kx nf dt translated">参考资料:</h1><div class="ng nh fm fo ni nj"><a rel="noopener follow" target="_blank" href="/basecs/trying-to-understand-tries-3ec6bede0014"><div class="nk ab ej"><div class="nl ab nm cl cj nn"><h2 class="bd hu fv z el no eo ep np er et hs dt translated">试图理解尝试</h2><div class="nq l"><h3 class="bd b fv z el no eo ep np er et ek translated">在本系列的每一期中，我们都试图理解和深入挖掘我们正在…</h3></div><div class="nr l"><p class="bd b gc z el no eo ep np er et ek translated">medium.com</p></div></div><div class="ns l"><div class="nt l nu nv nw ns nx lk nj"/></div></div></a></div><div class="ng nh fm fo ni nj"><a href="https://stackoverflow.com/questions/14708134/what-is-the-difference-between-trie-and-radix-trie-data-structures#14708989" rel="noopener  ugc nofollow" target="_blank"><div class="nk ab ej"><div class="nl ab nm cl cj nn"><h2 class="bd hu fv z el no eo ep np er et hs dt translated">trie和radix trie数据结构有什么区别？</h2><div class="nq l"><h3 class="bd b fv z el no eo ep np er et ek translated">我的问题是Trie数据结构和Radix Trie是不是一回事？简而言之，没有。范畴基数三…</h3></div><div class="nr l"><p class="bd b gc z el no eo ep np er et ek translated">stackoverflow.com</p></div></div><div class="ns l"><div class="ny l nu nv nw ns nx lk nj"/></div></div></a></div><div class="ng nh fm fo ni nj"><a href="https://github.com/ethereum/wiki/wiki/Patricia-Tree#preamble-basic-radix-tries" rel="noopener  ugc nofollow" target="_blank"><div class="nk ab ej"><div class="nl ab nm cl cj nn"><h2 class="bd hu fv z el no eo ep np er et hs dt translated">以太坊/维基</h2><div class="nq l"><h3 class="bd b fv z el no eo ep np er et ek translated">维基——以太坊维基</h3></div><div class="nr l"><p class="bd b gc z el no eo ep np er et ek translated">github.com</p></div></div><div class="ns l"><div class="nz l nu nv nw ns nx lk nj"/></div></div></a></div><p id="3217" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">来源:<a class="ae jo" href="https://www.youtube.com/watch?v=sAErv97lfIM&amp;t=276s" rel="noopener ugc nofollow" target="_blank">https://www.youtube.com/watch?v=sAErv97lfIM&amp;t = 276s</a></p></div></div>    
</body>
</html>