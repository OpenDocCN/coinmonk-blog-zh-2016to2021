<html>
<head>
<title>Ethernaut Lvl 18 Recovery Walkthrough: How to retrieve lost contract addresses (in 2 ways)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Ethernaut Lvl 18恢复演练:如何检索丢失的合同地址(两种方式)</h1>
<blockquote>原文：<a href="https://medium.com/coinmonks/ethernaut-lvl-18-recovery-walkthrough-how-to-retrieve-lost-contract-addresses-in-2-ways-aba54ab167d3?source=collection_archive---------7-----------------------#2018-09-17">https://medium.com/coinmonks/ethernaut-lvl-18-recovery-walkthrough-how-to-retrieve-lost-contract-addresses-in-2-ways-aba54ab167d3?source=collection_archive---------7-----------------------#2018-09-17</a></blockquote><div><div class="ef hh hi hj hk hl"/><div class="hm hn ho hp hq"><div class=""/><div class=""><h2 id="e203" class="pw-subtitle-paragraph iq hs ht bd b ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ek translated">这是一个围绕<a class="ae ji" href="https://openzeppelin.org/" rel="noopener ugc nofollow" target="_blank"> Zeppelin </a>团队的<a class="ae ji" href="https://ethernaut.zeppelin.solutions/" rel="noopener ugc nofollow" target="_blank">智能合约安全拼图</a>的<a class="ae ji" rel="noopener" href="/@nicolezhu">深度系列</a>。我会给你直接的资源和你需要的关键概念来100%自己解决这些难题。</h2></div><p id="47d0" class="pw-post-body-paragraph jj jk ht jl b jm jn iu jo jp jq ix jr js jt ju jv jw jx jy jz ka kb kc kd ke hm dt translated">这个级别要求您检索丢失的合同地址，以重新获得剩余的0.5个醚。</p></div><div class="ab cl kf kg hb kh" role="separator"><span class="ki bw bk kj kk kl"/><span class="ki bw bk kj kk kl"/><span class="ki bw bk kj kk"/></div><div class="hm hn ho hp hq"><p id="9d19" class="pw-post-body-paragraph jj jk ht jl b jm jn iu jo jp jq ix jr js jt ju jv jw jx jy jz ka kb kc kd ke hm dt translated">Solidity开发人员丢失新创建的合同地址是一个常见的错误。这变得令人沮丧，尤其是如果你还丢失了交易收据和其他追溯你的步骤的手段。</p><p id="b150" class="pw-post-body-paragraph jj jk ht jl b jm jn iu jo jp jq ix jr js jt ju jv jw jx jy jz ka kb kc kd ke hm dt translated">这里有两种查找合同地址的方法，分别通过原始发送者信息和以太网扫描。</p><h1 id="1878" class="km kn ht bd ko kp kq kr ks kt ku kv kw iz kx ja ky jc kz jd la jf lb jg lc ld dt translated">方法1:计算合同地址</h1><p id="96aa" class="pw-post-body-paragraph jj jk ht jl b jm le iu jo jp lf ix jr js lg ju jv jw lh jy jz ka li kc kd ke hm dt translated">合同地址是确定性计算的。摘自黄皮书:</p><blockquote class="lj"><p id="8f28" class="lk ll ht bd lm ln lo lp lq lr ls ke ek translated">新账户的地址被定义为仅包含发送者和账户随机数的结构的RLP编码的Keccak散列的最右边的160位。因此，我们为新账户<code class="eh lt lu lv lw b">a ≡ B96..255 KEC RLP (s, σ[s]n − 1) </code>定义了结果地址</p></blockquote><p id="4801" class="pw-post-body-paragraph jj jk ht jl b jm lx iu jo jp ly ix jr js lz ju jv jw ma jy jz ka mb kc kd ke hm dt translated">表示该函数的一种更简单的方法是:</p><pre class="mc md me mf fq mg lw mh mi aw mj dt"><span id="f8d9" class="mk kn ht lw b fv ml mm l mn mo">address = rightmost_20_bytes(keccak(RLP(sender address, nonce)))</span></pre><p id="dfb9" class="pw-post-body-paragraph jj jk ht jl b jm jn iu jo jp jq ix jr js jt ju jv jw jx jy jz ka kb kc kd ke hm dt translated">其中:</p><ul class=""><li id="7749" class="mp mq ht jl b jm jn jp jq js mr jw ms ka mt ke mu mv mw mx dt translated"><code class="eh lt lu lv lw b">sender address</code>:是创建这个新合同的合同或钱包地址</li><li id="701e" class="mp mq ht jl b jm my jp mz js na jw nb ka nc ke mu mv mw mx dt translated"><code class="eh lt lu lv lw b">nonce</code>:是从<code class="eh lt lu lv lw b">sender address</code>发出的交易笔数，或者，<strong class="jl hu">如果发送方是工厂合同，</strong> <code class="eh lt lu lv lw b"><strong class="jl hu">nonce</strong></code> <strong class="jl hu">是该账户创建的合同笔数。</strong></li><li id="8904" class="mp mq ht jl b jm my jp mz js na jw nb ka nc ke mu mv mw mx dt translated"><code class="eh lt lu lv lw b">RLP</code>:数据结构上的编码器，默认序列化以太坊中的对象。</li><li id="ef99" class="mp mq ht jl b jm my jp mz js na jw nb ka nc ke mu mv mw mx dt translated"><code class="eh lt lu lv lw b">keccak</code>:计算任何输入的Ethereum-SHA-3 (Keccak-256)散列的加密原语。</li></ul><h2 id="f5d1" class="mk kn ht bd ko nd ne nf ks ng nh ni kw js nj nk ky jw nl nm la ka nn no lc np dt translated">重现这种混音</h2><p id="dc88" class="pw-post-body-paragraph jj jk ht jl b jm le iu jo jp lf ix jr js lg ju jv jw lh jy jz ka li kc kd ke hm dt translated">让我们计算一个由位于<code class="eh lt lu lv lw b">0x890ca422059d877085ce763187ddb12b62ab809d</code>的现有合同创建的<em class="nq">新</em>合同的地址。让我们假设这是从此地址创建的第一个契约，因此nonce(事务计数)应该是<code class="eh lt lu lv lw b">1</code>。</p><blockquote class="nr ns nt"><p id="aeaf" class="jj jk nq jl b jm jn iu jo jp jq ix jr nu jt ju jv nv jx jy jz nw kb kc kd ke hm dt translated">有趣的事实:nonce 0总是智能合约自己的创建事件</p></blockquote><ol class=""><li id="5d31" class="mp mq ht jl b jm jn jp jq js mr jw ms ka mt ke nx mv mw mx dt translated">从<a class="ae ji" href="https://github.com/ethereum/wiki/wiki/RLP" rel="noopener ugc nofollow" target="_blank">文档</a>中，20字节地址的RLP编码为:<code class="eh lt lu lv lw b">0xd6, 0x94</code>。而对于所有小于<code class="eh lt lu lv lw b">0x7f</code>的整数，它的编码只是它自己的字节值。所以1的RLP就是<code class="eh lt lu lv lw b">0x01</code>。</li><li id="6334" class="mp mq ht jl b jm my jp mz js na jw nb ka nc ke nx mv mw mx dt translated">在重新混合中，计算以下内容:</li></ol><pre class="mc md me mf fq mg lw mh mi aw mj dt"><span id="8aa8" class="mk kn ht lw b fv ml mm l mn mo">address public a = address(keccak256(0xd6, 0x94, YOUR_ADDR, 0x01));</span></pre><p id="3c81" class="pw-post-body-paragraph jj jk ht jl b jm jn iu jo jp jq ix jr js jt ju jv jw jx jy jz ka kb kc kd ke hm dt translated">3.这产生了<code class="eh lt lu lv lw b">0x048559A2982f50c268B80E14b1A98A1524295016</code>，这可能是现有契约将部署的新智能契约的第一个地址。</p><p id="e05f" class="pw-post-body-paragraph jj jk ht jl b jm jn iu jo jp jq ix jr js jt ju jv jw jx jy jz ka kb kc kd ke hm dt translated">4.要获得后续的约定地址，只需增加nonce。</p><h1 id="1b6b" class="km kn ht bd ko kp kq kr ks kt ku kv kw iz kx ja ky jc kz jd la jf lb jg lc ld dt translated"><strong class="ak">方法二:使用以太扫描</strong></h1><p id="8cc7" class="pw-post-body-paragraph jj jk ht jl b jm le iu jo jp lf ix jr js lg ju jv jw lh jy jz ka li kc kd ke hm dt translated">从创建者那里获得新契约地址的一种更快的方法是使用Etherscan。</p><figure class="mc md me mf fq nz fe ff paragraph-image"><div role="button" tabindex="0" class="oa ob di oc bf od"><div class="fe ff ny"><img src="../Images/51e2cfb3b595eddc5f74a7a7b9d4565e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QylGJv3U3Ypt_Yi3kLUiVA.png"/></div></div></figure><ol class=""><li id="d1dd" class="mp mq ht jl b jm jn jp jq js mr jw ms ka mt ke nx mv mw mx dt translated">在Etherscan中，通过地址查找您当前的合同。</li><li id="8f4e" class="mp mq ht jl b jm my jp mz js na jw nb ka nc ke nx mv mw mx dt translated">在<code class="eh lt lu lv lw b">Internal Txns</code>选项卡中，找到最新的合同创建，并点击链接进入新合同。</li><li id="356c" class="mp mq ht jl b jm my jp mz js na jw nb ka nc ke nx mv mw mx dt translated">新的合同地址现在应该显示在左上角。</li></ol><p id="b4e4" class="pw-post-body-paragraph jj jk ht jl b jm jn iu jo jp jq ix jr js jt ju jv jw jx jy jz ka kb kc kd ke hm dt translated"><em class="nq">往下读破解这一关！</em></p></div><div class="ab cl kf kg hb kh" role="separator"><span class="ki bw bk kj kk kl"/><span class="ki bw bk kj kk kl"/><span class="ki bw bk kj kk"/></div><div class="hm hn ho hp hq"><figure class="mc md me mf fq nz fe ff paragraph-image"><div role="button" tabindex="0" class="oa ob di oc bf od"><div class="fe ff og"><img src="../Images/3a8ec2df406d4e75b31f0bd27ba93546.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*t9y6WPepFNIEoEYWec8y8w.png"/></div></div></figure><h1 id="2426" class="km kn ht bd ko kp kq kr ks kt ku kv kw iz kx ja ky jc kz jd la jf lb jg lc ld dt translated">详细演练</h1><ol class=""><li id="b861" class="mp mq ht jl b jm le jp lf js oh jw oi ka oj ke nx mv mw mx dt translated">通过<code class="eh lt lu lv lw b">instance</code>获取控制台中合同创建者<strong class="jl hu"> Recovery.sol </strong>的地址</li><li id="c73f" class="mp mq ht jl b jm my jp mz js na jw nb ka nc ke nx mv mw mx dt translated">按照上述方法1或2获取新的合同地址。作为SimpleToken.sol的<code class="eh lt lu lv lw b">nonce used should be 1</code>是它的第一个合同创造。</li><li id="d8c4" class="mp mq ht jl b jm my jp mz js na jw nb ka nc ke nx mv mw mx dt translated">在Remix Injected Web3中，通过地址检索SimpleToken.sol。</li><li id="f407" class="mp mq ht jl b jm my jp mz js na jw nb ka nc ke nx mv mw mx dt translated">调用<code class="eh lt lu lv lw b">selfdestruct(YOUR_WALLET_ADDR)</code>提取剩余的0.5乙醚。正如我们在<a class="ae ji" rel="noopener" href="/coinmonks/ethernaut-lvl-7-walkthrough-how-to-selfdestruct-and-create-an-ether-blackhole-eb5bb72d2c57"> lvl 7 </a>中了解到的，自毁将在销毁该合同之前转移所有剩余资金。</li></ol></div><div class="ab cl kf kg hb kh" role="separator"><span class="ki bw bk kj kk kl"/><span class="ki bw bk kj kk kl"/><span class="ki bw bk kj kk"/></div><div class="hm hn ho hp hq"><h1 id="c35c" class="km kn ht bd ko kp ok kr ks kt ol kv kw iz om ja ky jc on jd la jf oo jg lc ld dt translated">关键安全要点</h1><ul class=""><li id="ce87" class="mp mq ht jl b jm le jp lf js oh jw oi ka oj ke mu mv mw mx dt translated"><strong class="jl hu">洗钱的可能性</strong> : <a class="ae ji" href="http://swende.se/blog/Ethereum_quirks_and_vulns.html" rel="noopener ugc nofollow" target="_blank">这篇博文</a>详细阐述了利用未来合同地址隐藏资金的可能性。本质上，你可以发送醚到一个确定的地址，但那里的合同目前不存在。这些资金实际上永远失去了，直到你决定在该地址创建一个合同，并重新获得所有权。</li><li id="94e1" class="mp mq ht jl b jm my jp mz js na jw nb ka nc ke mu mv mw mx dt translated">你在以太坊上不是匿名的:任何人都可以跟踪你当前的交易记录，也可以监控你未来的合同地址。这种交易模式可用于获得您的真实身份。</li></ul></div><div class="ab cl kf kg hb kh" role="separator"><span class="ki bw bk kj kk kl"/><span class="ki bw bk kj kk kl"/><span class="ki bw bk kj kk"/></div><div class="hm hn ho hp hq"><h1 id="fd2d" class="km kn ht bd ko kp ok kr ks kt ol kv kw iz om ja ky jc on jd la jf oo jg lc ld dt translated">更多级别</h1><div class="op oq fm fo or os"><a rel="noopener follow" target="_blank" href="/coinmonks/ethernaut-lvl-17-locked-walkthrough-how-to-properly-use-structs-in-solidity-f9900c8843e2"><div class="ot ab ej"><div class="ou ab ov cl cj ow"><h2 class="bd hu fv z el ox eo ep oy er et hs dt translated">Ethernaut Lvl 17锁定演练:如何在Solidity中正确使用结构</h2><div class="oz l"><h3 class="bd b fv z el ox eo ep oy er et ek translated">这是一个围绕齐柏林团队的智能合同安全难题的深入系列。我会给你直接的资源…</h3></div><div class="pa l"><p class="bd b gc z el ox eo ep oy er et ek translated">medium.com</p></div></div><div class="pb l"><div class="pc l pd pe pf pb pg oe os"/></div></div></a></div><div class="op oq fm fo or os"><a rel="noopener follow" target="_blank" href="/coinmonks/ethernaut-lvl-19-magicnumber-walkthrough-how-to-deploy-contracts-using-raw-assembly-opcodes-c50edb0f71a2"><div class="ot ab ej"><div class="ou ab ov cl cj ow"><h2 class="bd hu fv z el ox eo ep oy er et hs dt translated">Ethernaut Lvl 19 MagicNumber演练:如何使用原始程序集操作码部署协定</h2><div class="oz l"><h3 class="bd b fv z el ox eo ep oy er et ek translated">这是一个围绕齐柏林团队的智能合同安全难题的深入系列。我们学习关键的可靠性概念…</h3></div><div class="pa l"><p class="bd b gc z el ox eo ep oy er et ek translated">medium.com</p></div></div><div class="pb l"><div class="ph l pd pe pf pb pg oe os"/></div></div></a></div><blockquote class="lj"><p id="d14c" class="lk ll ht bd lm ln pi pj pk pl pm ke ek translated"><a class="ae ji" href="https://coincodecap.com/?utm_source=coinmonks" rel="noopener ugc nofollow" target="_blank">在您的收件箱中直接获得最佳软件交易</a></p></blockquote><figure class="po pp pq pr ps nz fe ff paragraph-image"><a href="https://coincodecap.com/?utm_source=coinmonks"><div class="fe ff pn"><img src="../Images/7c0b3dfdcbfea594cc0ae7d4f9bf6fcb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1168/format:webp/0*OJ-qb5G6i863msBB.png"/></div></a></figure></div></div>    
</body>
</html>