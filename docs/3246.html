<html>
<head>
<title>On Bitcoin transaction sizes — Part 2</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">比特币交易规模——第二部分</h1>
<blockquote>原文：<a href="https://medium.com/coinmonks/on-bitcoin-transaction-sizes-part-2-9445373d17f4?source=collection_archive---------1-----------------------#2020-08-10">https://medium.com/coinmonks/on-bitcoin-transaction-sizes-part-2-9445373d17f4?source=collection_archive---------1-----------------------#2020-08-10</a></blockquote><div><div class="ef hh hi hj hk hl"/><div class="hm hn ho hp hq"><div class=""/><p id="c076" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">作为建立分析交易吞吐量模型目标的中间步骤，之前的两篇文章调查了最常见的比特币交易类型以及尚未实现但备受期待的<a class="ae jo" rel="noopener" href="/coinmonks/on-bitcoins-schnorr-signature-algorithm-and-taproot-script-and-witness-sizes-fe4d1e6591a7">支付到主根交易类型</a>的脚本和见证大小。</p><p id="659d" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">本文基于以前的发现，调查了不同交易类型的输入、输出和见证的大小。为此，基于第一性原理的估计被导出并使用经验数据验证。这些发现被提取到<a class="ae jo" href="https://github.com/virtu/libtxsize" rel="noopener ugc nofollow" target="_blank"> <em class="jp"> libtxsize </em> </a>中，这是一个为具有任意输入、输出和见证的事务提供大小、重量和虚拟大小估计的库。</p><p id="7aaf" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">这篇文章的结构如下。首先，讨论了事务输入、输出和见证的一般格式。然后将讨论的结果与以前文章的发现相结合，得出不同交易类型的输入、输出和见证的规模估计；除了没有实证数据的Pay-to-Taproot之外，所有的估计都是使用比特币区块链的数据进行验证的。接下来，讨论了比特币交易的格式，并整合了关于输入、输出和见证大小的发现，以创建一个分析模型来估计任意比特币交易的大小。文章最后展示了<em class="jp"> libtxsize </em>，这是一个集成了所有以前的见解的库，用于自动进行事务规模估计，并提供了一个简短的总结。</p><h1 id="7f6c" class="jq jr ht bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn dt translated">事务输入、输出和见证格式</h1><p id="bef8" class="pw-post-body-paragraph iq ir ht is b it ko iv iw ix kp iz ja jb kq jd je jf kr jh ji jj ks jl jm jn hm dt translated">在下文中，讨论了输入、输出和见证的一般格式，并研究了这些格式对交易规模的影响。</p><h2 id="a7e4" class="kt jr ht bd js ku kv kw jw kx ky kz ka jb la lb ke jf lc ld ki jj le lf km lg dt translated">交易输入格式</h2><p id="e0ec" class="pw-post-body-paragraph iq ir ht is b it ko iv iw ix kp iz ja jb kq jd je jf kr jh ji jj ks jl jm jn hm dt translated">从高层次的观点来看，每个事务输入包含两个关键信息:对未用完事务输出(UTXO)的引用和满足被引用UTXO的锁定脚本的解锁脚本。</p><p id="215b" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">为了引用UTXO，输入包括一个32字节的事务散列和一个4字节的整数，前者用于标识前一个事务，后者指定输出在该事务中的位置。</p><p id="d4b6" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">解锁脚本的大小可变，将在下一节讨论。现在，注意到解锁脚本具有可变大小的事实就足够了，这使得显式编码它们的大小成为必要。这是通过使用一个<a class="ae jo" href="https://en.bitcoin.it/wiki/Protocol_documentation#Variable_length_integer" rel="noopener ugc nofollow" target="_blank">可变长度整数</a>来完成的，这是一种数据类型，设计用于在编码最大8个字节的非负整数时最小化大小。可变长度整数需要一个字节来编码从0到252的值；16位整数的三个字节；32位整数的5个字节；64位整数用9个字节。实际上，大多数解锁脚本都小于253字节，因此脚本长度的编码通常是一个字节。</p><p id="3a8b" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">最后，每个输入包含一个4字节的序列号，该序列号目前用于费用替换机制，该机制允许更新事务的费用，以增加它被包含在块中的可能性。</p><p id="04e1" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">总之，输入大小由40字节的固定部分决定，包括32字节的散列、4字节的位置和4字节的序列号；和一个可变的，包括解锁脚本及其长度的编码。</p><h2 id="af5f" class="kt jr ht bd js ku kv kw jw kx ky kz ka jb la lb ke jf lc ld ki jj le lf km lg dt translated">交易输出格式</h2><p id="a6b3" class="pw-post-body-paragraph iq ir ht is b it ko iv iw ix kp iz ja jb kq jd je jf kr jh ji jj ks jl jm jn hm dt translated">事务输出包括两条关键信息:金额和锁定脚本。</p><p id="59ec" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">与输出相关的比特币数量使用一个8字节的整数进行编码。像解锁脚本一样，锁定脚本的大小也是可变的，将在下一节中讨论。此外，输出包括一个可变长度的整数，它对锁定脚本的大小进行编码。</p><p id="2a26" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">总之，输出大小由两部分组成:8个字节的固定部分，对应于数量的编码；以及由解锁脚本及其长度编码确定的可变贡献。</p><h2 id="7700" class="kt jr ht bd js ku kv kw jw kx ky kz ka jb la lb ke jf lc ld ki jj le lf km lg dt translated">交易见证格式</h2><p id="6c9b" class="pw-post-body-paragraph iq ir ht is b it ko iv iw ix kp iz ja jb kq jd je jf kr jh ji jj ks jl jm jn hm dt translated">见证可以作为解锁输出的数据的替代存储。每个见证都包含一个可变长度的整数来指示它包含的项数。这些条目的大小是任意的，所以每个条目的长度也使用一个可变长度的整数进行编码。</p><h1 id="1266" class="jq jr ht bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn dt translated">估计不同输入、输出和见证类型的大小</h1><p id="076a" class="pw-post-body-paragraph iq ir ht is b it ko iv iw ix kp iz ja jb kq jd je jf kr jh ji jj ks jl jm jn hm dt translated">在下文中，将推导出输入、输出和见证类型(如果适用)的分析估计值，并与经验数据(如果后者可用)进行比较。请注意，锁定和解锁脚本以及见证的大小是基于以前的发现(一般情况下，参见本文<a class="ae jo" rel="noopener" href="/coinmonks/on-bitcoin-transaction-sizes-97e31bc9d816">的“结果和结论”下的表格；关于Pay-to-Taproot，参见</a><a class="ae jo" rel="noopener" href="/coinmonks/on-bitcoins-schnorr-signature-algorithm-and-taproot-script-and-witness-sizes-fe4d1e6591a7">这篇文章</a>。</p><h2 id="db19" class="kt jr ht bd js ku kv kw jw kx ky kz ka jb la lb ke jf lc ld ki jj le lf km lg dt translated">支付公钥</h2><p id="ad4c" class="pw-post-body-paragraph iq ir ht is b it ko iv iw ix kp iz ja jb kq jd je jf kr jh ji jj ks jl jm jn hm dt translated">Pay-to-Public-Key (P2PK)输出的固定大小为44个字节:8个字节对值进行编码，1个字节的可变长度整数对锁定脚本的大小进行编码，35个字节的锁定脚本。</p><p id="b38d" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">下图所示的经验数据验证了这一分析估计值，该图包含截至模块637，302的所有P2PK输出大小的直方图。除去76字节的输出，所有输出的大小都是44字节，76字节的输出是比特币早期的产物，当时公钥是使用未压缩的SEC格式编码的。(关于未压缩SEC格式的详细讨论，请参见本文中<a class="ae jo" rel="noopener" href="/coinmonks/on-bitcoin-transaction-sizes-97e31bc9d816">的“公钥编码”。)</a></p><figure class="li lj lk ll fq lm fe ff paragraph-image"><div role="button" tabindex="0" class="ln lo di lp bf lq"><div class="fe ff lh"><img src="../Images/211702b1a3fd71f3a6252b0cad466cc8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1mQgT4vxlhb38ufJ2ABwwg.png"/></div></div></figure><p id="c4ad" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">P2PK输入的平均大小约为113.5字节:40字节用于引用UTXO和序列号，一个1字节的变长整数用于编码解锁脚本的大小，72.5字节的解锁脚本。然而，请注意，使用最近推出的<a class="ae jo" href="https://github.com/bitcoin/bitcoin/pull/13666" rel="noopener ugc nofollow" target="_blank">低r优化</a>，可以为P2PK输入实现113字节的一致大小。</p><p id="4752" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">如前所述，经验数据验证了分析估计。下图显示了截至模块637，302的所有P2PK输入大小的直方图。正如所料，超过90%的输入大小为113或114字节。偏差是由ECDSA签名的DER编码引起的，这可能导致根据(随机)签名值增加或减少字节。(详见本文中<a class="ae jo" rel="noopener" href="/coinmonks/on-bitcoin-transaction-sizes-97e31bc9d816">的“签名编码”)。</a></p><figure class="li lj lk ll fq lm fe ff paragraph-image"><div role="button" tabindex="0" class="ln lo di lp bf lq"><div class="fe ff lh"><img src="../Images/a320758edd0642f06c9056be0669a792.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Lg61H6wcz5puWmkTu0jBAg.png"/></div></div></figure><h2 id="54cc" class="kt jr ht bd js ku kv kw jw kx ky kz ka jb la lb ke jf lc ld ki jj le lf km lg dt translated">付费公钥哈希</h2><p id="aa4a" class="pw-post-body-paragraph iq ir ht is b it ko iv iw ix kp iz ja jb kq jd je jf kr jh ji jj ks jl jm jn hm dt translated">Pay-to-Public-Key-Hash (P2PKH)输出的固定大小为34个字节:8个字节对值进行编码，1个字节的可变长度整数对锁定脚本的大小进行编码，25个字节的锁定脚本。</p><p id="b657" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">同样，分析估计得到经验数据的证实，如下图所示。截至块637、302的所有P2PKH输出的大小的直方图中的数据指示所有这样的输出具有34字节的大小。</p><figure class="li lj lk ll fq lm fe ff paragraph-image"><div role="button" tabindex="0" class="ln lo di lp bf lq"><div class="fe ff lh"><img src="../Images/f7fa919670817e6178450a771b74e5ae.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mft93LQdruXlOuc-rIF7AA.png"/></div></div></figure><p id="9507" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">P2PKH输入的平均大小约为147.5字节:40字节用于引用UTXO和序列号，一个1字节的变长整数用于编码解锁脚本的大小，106.5字节的解锁脚本。再次注意，使用<a class="ae jo" href="https://github.com/bitcoin/bitcoin/pull/13666" rel="noopener ugc nofollow" target="_blank">低r优化</a>，P2PKH输入可以实现147字节的一致大小。</p><p id="d736" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">这一估计得到了经验数据的支持。下图显示了截至模块637，302的所有P2PKH输入大小的直方图。正如所料，大多数输入的大小为147或148字节。和以前一样，估计值周围的偏差是DER签名编码标准引起的副作用。此外，约180字节的第二簇可以忽略，因为它是比特币早期的产物，当时P2PKH输入中的公钥是使用未压缩的SEC格式编码的。</p><figure class="li lj lk ll fq lm fe ff paragraph-image"><div role="button" tabindex="0" class="ln lo di lp bf lq"><div class="fe ff lh"><img src="../Images/3c641658306b23ec5f9a3ac4f43ebbe8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MZLFb50AixqCRhpoFaEglg.png"/></div></div></figure><h1 id="e972" class="jq jr ht bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn dt translated">裸多重签名</h1><p id="78f8" class="pw-post-body-paragraph iq ir ht is b it ko iv iw ix kp iz ja jb kq jd je jf kr jh ji jj ks jl jm jn hm dt translated">裸多重签名(multisig)输出的大小取决于<em class="jp"> n </em>，即接受的密钥集的大小。总大小由两部分组成:一个固定的12字节部分，包括8字节的量；编码锁定脚本大小的单字节可变长度整数；三个字节用于作为锁定脚本一部分的<code class="eh lt lu lv lw b">OP_m</code>、<code class="eh lt lu lv lw b">OP_n</code>和<code class="eh lt lu lv lw b">OP_CHECKMULTISIG</code>指令。此外，还有34个<em class="jp"> n </em>字节的动态贡献，因为锁定脚本中的每个公钥编码都需要一个1字节的变长整数来表示密钥的大小和33字节的密钥本身。因此，<em class="jp">m</em>-of-<em class="jp">-n</em>-multisig输出的总大小估计为12+34 <em class="jp"> n </em>字节。</p><p id="6eca" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">在下文中，该分析估计值针对2选1和3选1多信号输出进行了验证，这两种输出合计占所有多信号输出的98%以上。前者的估计值为80字节；对于后者，它是114字节。下图中的经验数据包含截至模块637，302的所有2选1和3选1多信号输出的大小直方图，支持这些估计值:2选1和3选1多信号输出的大部分大小分别为80和112字节。在每种情况下，都有比估计值大32字节的少量输出。像以前一样，这些都是可以归因于比特币早期的人工制品，当时公钥是使用未压缩的SEC格式编码的。</p><figure class="li lj lk ll fq lm fe ff paragraph-image"><div role="button" tabindex="0" class="ln lo di lp bf lq"><div class="fe ff lh"><img src="../Images/419c8263f8a1e53b1704a7548e54bfb7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ej6z5QfO5cJaEqD8lsmTCQ.png"/></div></div></figure><p id="c66e" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">multisig输入的大小取决于<em class="jp"> m </em>，解锁参考输出所需的签名数量。总大小由两个部分组成:一个固定的42字节部分，包括32字节的哈希、4字节的位置、4字节的序列号、一个用于编码解锁脚本长度的可变长度整数的字节，以及一个用于作为解锁脚本一部分的<code class="eh lt lu lv lw b">OP_0</code>指令的字节。此外，存在72.5 <em class="jp"> m </em>字节的动态贡献，因为解锁脚本中的每个签名编码包括一个1字节的可变长度整数来指示签名大小和签名本身，签名本身平均具有71.5字节的大小。因此，multisig输入的<em class="jp">m</em>-of-<em class="jp">-n</em>-的总大小估计为44+72.5 <em class="jp"> m </em>字节。</p><p id="b1fd" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">如前所述，这一分析估计值针对2选1和3选1的multisig变体进行了验证。因为对于两种变体来说<em class="jp"> m </em> =1，所以它们共享相同的114.5字节的估计值。下图中的经验数据包含截至模块637，302的所有2选1和3选1 multi SIG输出的大小直方图，支持这一估计:正如所料，所有2选1和3选1 multi SIG输出的大部分大小为114或115字节。</p><figure class="li lj lk ll fq lm fe ff paragraph-image"><div role="button" tabindex="0" class="ln lo di lp bf lq"><div class="fe ff lh"><img src="../Images/735b47f68834642feff74842b99cea68.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pgE0ylZk6_t8Z0as0Uw1LA.png"/></div></div></figure><h1 id="a881" class="jq jr ht bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn dt translated">空数据</h1><p id="1966" class="pw-post-body-paragraph iq ir ht is b it ko iv iw ix kp iz ja jb kq jd je jf kr jh ji jj ks jl jm jn hm dt translated">空数据输出的大小取决于<em class="jp"> s </em>，即输出中包含的用户有效载荷的大小。总的输出大小由两个部分组成:一个固定的10字节部分，包括8字节量，一个字节用于编码解锁脚本长度的可变长度整数，一个字节用于作为锁定脚本一部分的<code class="eh lt lu lv lw b">OP_RETURN</code>指令。此外，还有一个动态贡献，包括锁定脚本长度的编码、用户有效负载长度的编码和实际有效负载。如果有效载荷小于75字节，其长度可以在比特币脚本中显式编码，只需要一个字节；如果有效载荷大于75字节，则需要一个额外的<code class="eh lt lu lv lw b">OP_PUSHDATA1</code>指令，从而将有效载荷长度编码为两个字节的总要求增加了。因此，当包括大小高达75字节的有效载荷时，空数据输出的总估计为11+ <em class="jp"> s </em>，当包括更大的有效载荷时，为12+ <em class="jp"> s </em>。</p><p id="791f" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">这一分析估计值针对20字节和80字节的空数据输出进行了验证，这两种数据合计占所有空数据输出的90%以上。前者的估计值为31字节；对于后者，它是92字节。下图中的经验数据支持这些估计，该图包含截至块637，302的所有空数据输出的大小的直方图。</p><figure class="li lj lk ll fq lm fe ff paragraph-image"><div role="button" tabindex="0" class="ln lo di lp bf lq"><div class="fe ff lh"><img src="../Images/fb1b390c62e7a579d671ed4245ced20c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cBtE_ZOIZqya1bzre_euMQ.png"/></div></div></figure><h2 id="33c3" class="kt jr ht bd js ku kv kw jw kx ky kz ka jb la lb ke jf lc ld ki jj le lf km lg dt translated">付费脚本哈希</h2><p id="7fe9" class="pw-post-body-paragraph iq ir ht is b it ko iv iw ix kp iz ja jb kq jd je jf kr jh ji jj ks jl jm jn hm dt translated">Pay-to-Script-Hash (P2SH)输出的固定大小为32个字节:8个字节对值进行编码，1个字节的可变长度整数对锁定脚本的大小进行编码，23个字节的锁定脚本。</p><p id="9d3c" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">下图中的经验数据证实了这一分析估计，该图包含截至块637，302的所有P2SH输出的直方图，并确认所有P2SH输出的大小为32字节。</p><figure class="li lj lk ll fq lm fe ff paragraph-image"><div role="button" tabindex="0" class="ln lo di lp bf lq"><div class="fe ff lh"><img src="../Images/9d249e7b0a4cc36f498a1847c99c3986.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TAjee72e0Qinl5Gw7MbL_Q.png"/></div></div></figure><p id="e853" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">与固定大小的P2SH输出相反，P2SH输入的大小根据输入中包含的兑换脚本的类型而有很大的不同。下面讨论了最相关的赎回脚本用例。</p><h2 id="69c9" class="kt jr ht bd js ku kv kw jw kx ky kz ka jb la lb ke jf lc ld ki jj le lf km lg dt translated">付费脚本哈希多重签名</h2><p id="63a0" class="pw-post-body-paragraph iq ir ht is b it ko iv iw ix kp iz ja jb kq jd je jf kr jh ji jj ks jl jm jn hm dt translated">P2SH-multisig输入的大小取决于<em class="jp"> m </em>，满足兑换脚本所需的签名数量；以及<em class="jp"> n，</em>所接受的密钥集的大小。P2SH-multisig输入的总大小由两部分组成:固定的40字节部分，包括32字节的散列、4字节的位置和4字节的序列号；以及包括解锁脚本的大小和脚本大小的编码的可变贡献。反过来，解锁脚本由两部分组成:一个redempt脚本，它的散列与被引用的UTXO的锁定脚本中的散列相匹配，被解释为锁定脚本；和数据来满足兑换脚本。</p><p id="2275" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">赎回脚本与裸multisig锁定脚本相同，并且包括:用于<code class="eh lt lu lv lw b">OP_m</code>、<code class="eh lt lu lv lw b">OP_n</code>和<code class="eh lt lu lv lw b">OP_CHECKMULTISIG</code>脚本指令的三个字节的固定贡献；以及34个<em class="jp"> n </em>字节的动态贡献，对于redempe脚本中的每个<em class="jp"> n </em>编码的公钥，贡献一个字节的可变长度整数来编码密钥大小和33字节的密钥本身。因此，兑换脚本的贡献总共是3+34 <em class="jp"> n </em>字节。将兑换脚本推送到堆栈上的比特币脚本指令的开销取决于兑换脚本的大小:如果它小于75字节，则其长度可以使用一个字节的比特币脚本指令显式编码；如果redempt脚本大于75字节，则需要一个额外的<code class="eh lt lu lv lw b">OP_PUSHDATA1</code>指令，将贡献增加一个字节。</p><p id="681e" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">此外，解锁脚本包含满足赎回脚本的数据。该数据与裸露的multisig解锁脚本相同，并包含固定的一个字节的<code class="eh lt lu lv lw b">OP_0</code>指令部分；以及72.5 <em class="jp"> m </em>字节的动态贡献，以编码<em class="jp"> m </em> 71.5字节ECDSA签名及其长度。因此，数据的贡献是1+72.5 <em class="jp"> m </em>字节。</p><p id="eb23" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">因此，P2SH-multisig输入的总大小由固定的40字节贡献、3+34 <em class="jp"> n </em>字节的赎回脚本大小、将赎回脚本推送到堆栈上的1或2字节开销、满足1+72.5 <em class="jp"> m </em>字节赎回脚本的数据贡献以及编码解锁脚本长度的可变大小整数的贡献的总和给出。</p><p id="a27e" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">该分析估计值针对2/2和3/2的P2SH-multisig输入进行了验证，这两种输入合计占P2SH-multisig输入的90%以上。对于前者，n= <em class="jp"> 2 </em>，因此兑换脚本的大小估计为3+34 <em class="jp"> n </em> =71字节。因为见证脚本小于75个字节，所以将其压入堆栈的开销只有一个字节。而且，<em class="jp"> m </em> =2，所以满足redempt脚本的数据贡献是146字节。因此，解锁脚本的大小为218字节。因为脚本小于253字节，所以编码其大小的可变长度整数只需要一个字节。加上40字节的固定贡献，2/2 P2SH-multisig输入的估计值为259字节。</p><p id="7047" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">这一估计由下面直方图中所示的经验数据证实，该直方图包含截至块637，302的所有2/2和2/3 P2SH-multisig输入的直方图。几乎一半的2/2 P2SH-multisig输入的大小为259字节。剩余的输入或者比那个值小一个字节或者比那个值大一个字节，这个事实可以用签名平均为71.5个字节来解释:如果没有低r优化，有50%的概率生成71字节或者72字节的签名；对于两个签名，这意味着有25%的机会出现两个71字节的签名(对应于大小为258字节的输入)，有50%的机会出现一个71字节和一个72字节的签名(导致259字节的输入)，有25%的机会出现两个72字节的签名(导致260字节的输入)。</p><figure class="li lj lk ll fq lm fe ff paragraph-image"><div role="button" tabindex="0" class="ln lo di lp bf lq"><div class="fe ff lh"><img src="../Images/6e17a3e02820d6ec6c2b8b6c677687f3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*E0lS0JIwP5ikUfavCNZLUA.png"/></div></div></figure><p id="8350" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">对于2/3 P2SH-multisig输入，n=3，因此兑换脚本的大小估计为3+34 <em class="jp"> n </em> =105字节。因为见证脚本大于75个字节，所以将其压入堆栈的开销是两个字节:一个字节用于<code class="eh lt lu lv lw b">OP_PUSHDATA1</code>指令，另一个字节用于编码赎回脚本的大小。此外，<em class="jp"> m </em> =2，因此满足赎回脚本的数据贡献是146字节。因此，解锁脚本的大小为253字节。在这个实例中，脚本的大小不小于253字节，因此用可变长度整数对解锁脚本的大小进行编码需要三个字节。<br/>加上40字节的固定贡献，3选2 P2SH-multisig输入的估计值为296字节。</p><p id="79c8" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">上图所示的经验数据也验证了这一估计值:几乎一半的2/3 P2SH multisig输入的大小为296字节。和以前一样，大约25%的输入的大小比估计值大一个字节；同样，这种情况可以用25%的机会生成两个72字节的签名来解释，而估计使用的是71.5字节的两倍。另外25%的输入的大小为293字节，比估计值小3个字节。其原因是，在两个71字节签名的情况下，解锁脚本的大小仅为252字节，这意味着它的大小可以用一个字节的变长整数而不是三个字节的整数进行编码。因此，大小的组合减少是三个字节:使用两个71字节的签名而不是估计的两倍71.5字节，减少了一个字节；另外两个字节，因为只需要一个字节(而不是三个)来编码解锁脚本的大小。</p><h2 id="1ce6" class="kt jr ht bd js ku kv kw jw kx ky kz ka jb la lb ke jf lc ld ki jj le lf km lg dt translated">支付给脚本哈希支付给见证脚本哈希多重签名</h2><p id="b564" class="pw-post-body-paragraph iq ir ht is b it ko iv iw ix kp iz ja jb kq jd je jf kr jh ji jj ks jl jm jn hm dt translated">Pay-to-Script-Hash-Pay-to-Witness-Script-Hash-Multi-SIG(P2SH-P2WSH-Multi SIG)输入的固定大小为76个字节:40个字节用于引用UTXO和序列号，1个字节的可变长度整数用于编码解锁脚本的大小，35个字节的解锁脚本。</p><p id="1ce1" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">如下图所示，经验数据支持分析估计。直方图显示了截至块637，302的所有P2SH-P2WSH-multisig输入的大小，表明所有这样的输入具有76字节的大小。</p><figure class="li lj lk ll fq lm fe ff paragraph-image"><div role="button" tabindex="0" class="ln lo di lp bf lq"><div class="fe ff lh"><img src="../Images/f823a96a16c11b6373ae1486d2d6c7ed.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_02Bn2GIe791IHG7I6JMpg.png"/></div></div></figure><p id="c685" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">P2SH-P2WSH-multisig见证的大小取决于满足见证脚本所需的签名数量<em class="jp">m</em>；以及<em class="jp"> n，</em>所接受的密钥集合的大小。见证人的规模完全是动态的；贡献包括:被解释为锁定脚本的见证脚本；满足锁定脚本的数据；以及指示每个见证项的大小以及所有项的数量的可变长度整数。</p><p id="3729" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">见证脚本包含与P2SH-multisig redempte脚本相同的信息，因此它提供相同的3+34 <em class="jp"> n </em>字节。因为见证脚本是一个见证项，所以它的长度是使用变长整数编码的。</p><p id="47f1" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">解锁见证脚本的数据类似于P2SH-multisig输入中使用的数据，唯一的区别是签名是单独的见证项，其长度使用变长整数进行编码，而不是使用比特币脚本指令推送到堆栈上的脚本数据。然而，这对大小没有影响:每个<em class="jp"> m </em>签名平均贡献71.5字节，外加一个字节使用可变长度整数对其长度进行编码。此外，数据包括一个可变长度的整数，指示一个零长度的项将一个空项推送到堆栈上(类似于在比特币脚本中对数据进行编码时使用的<code class="eh lt lu lv lw b">OP_0</code>指令)。因此，数据的总贡献与P2SH-multisig输入的情况相同，为1+72.5 <em class="jp"> m </em>字节。</p><p id="27c6" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">因此，总见证大小由指示见证项数量的可变长度整数的大小、1+72.5<em class="jp">m</em>字节的数据贡献、3+34<em class="jp">n</em>字节的见证脚本贡献以及指示见证脚本大小的可变长度整数的大小给出。</p><p id="f7f4" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">该分析估计值针对2/2和3/2的P2SH-P2WSH-multisig输入进行了验证，这两种输入的总和超过P2SH-P2WSH-multisig输入的90%。对于前者，<em class="jp">m</em>=<em class="jp">n</em>=<em class="jp">2</em>，<em class="jp"> </em>所以数据和见证脚本的贡献分别为1+72.5 <em class="jp"> m </em> =146字节和3+34n=71字节。加上两个1字节的可变长度整数来指示见证项的数量(三个:两个签名和见证脚本)和见证脚本的长度，总的估计值为219字节。</p><p id="a451" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">对于3选2 P2SH-P2WSH-multisig输入，<em class="jp"> m </em> =2，<em class="jp"> n </em> =3，因此数据和见证脚本的贡献分别为1+72.5 <em class="jp"> m </em> =146字节和3+34n=105字节。同样，指示见证项数量和见证脚本长度的两个可变长度整数贡献了两个字节，因此总体估计值为253个字节。</p><p id="9b64" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">下图中显示的经验数据支持这些估计，该图包含截至块637，302的所有2/2和2/3 P2SH-P2WSH-multisig见证的直方图。对于两种multisig变体，分布的峰值与估计值匹配。如前所述，比估计值小或大一个字节的输入有25%的机会创建两个71字节的签名或两个72字节的签名，而不是使用两倍71.5字节平均值的估计值。</p><figure class="li lj lk ll fq lm fe ff paragraph-image"><div role="button" tabindex="0" class="ln lo di lp bf lq"><div class="fe ff lh"><img src="../Images/81a85521c22687424c69c287e3777686.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*OWIhBV3NnLX6q6hP77D2xw.png"/></div></div></figure><h2 id="7555" class="kt jr ht bd js ku kv kw jw kx ky kz ka jb la lb ke jf lc ld ki jj le lf km lg dt translated">支付给脚本哈希支付给见证公钥哈希</h2><p id="cf62" class="pw-post-body-paragraph iq ir ht is b it ko iv iw ix kp iz ja jb kq jd je jf kr jh ji jj ks jl jm jn hm dt translated">Pay-to-Script-Hash-Pay-to-Witness-Public-Key-Hash(P2SH-p 2 wpkh)输入具有64字节的固定大小:40字节用于引用UTXO和序列号，一个1字节的可变长度整数用于编码解锁脚本的大小，还有一个23字节的解锁脚本。</p><p id="9227" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">如下图所示，经验数据支持分析估计。该直方图包括所有P2SH-P2WPKH输入的大小，如块637，302所示，表明所有这些输入的大小为64字节。</p><figure class="li lj lk ll fq lm fe ff paragraph-image"><div role="button" tabindex="0" class="ln lo di lp bf lq"><div class="fe ff lh"><img src="../Images/df2a213a7fce3c5bf68f2260b4c01280.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rZjcrIrH36PTynT0W4gt2A.png"/></div></div></figure><p id="daca" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">P2SH-P2WPKH见证的平均大小约为107.5字节:一个一字节的变长整数，表示见证中的项数(两个:一个签名和一个公钥)；一个71.5字节的签名和一个编码其大小的1字节变长整数；一个33字节的公钥和一个编码其大小的1字节变长整数。</p><p id="cb7f" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">这一估计得到了经验数据的证实。下图所示的直方图显示了截至块637，302的所有P2SH-P2WPKH见证的大小。数据表明超过60%的所有P2SH-P2WPKH见证具有107字节的大小；其余40%的大小为108字节。偏向107字节可以用<a class="ae jo" href="https://github.com/bitcoin/bitcoin/pull/13666" rel="noopener ugc nofollow" target="_blank">低r优化</a>来解释，与估计使用的71.5字节平均值相比，它产生了71字节的签名。</p><figure class="li lj lk ll fq lm fe ff paragraph-image"><div role="button" tabindex="0" class="ln lo di lp bf lq"><div class="fe ff lh"><img src="../Images/f61ae1e86345fb72062ea622f28590f6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lviUuuYxP6L_6YKPd9wzAw.png"/></div></div></figure><h2 id="1f00" class="kt jr ht bd js ku kv kw jw kx ky kz ka jb la lb ke jf lc ld ki jj le lf km lg dt translated">支付给证人公钥散列</h2><p id="9623" class="pw-post-body-paragraph iq ir ht is b it ko iv iw ix kp iz ja jb kq jd je jf kr jh ji jj ks jl jm jn hm dt translated">pay-to-Witness-Public-Key-Hash(p 2 wpkh)输出的固定大小为31个字节:8个字节用于对值进行编码，一个1字节的可变长度整数用于对锁定脚本的大小进行编码，还有一个22字节的锁定脚本。</p><p id="d559" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">下图所示的经验数据支持这一分析估计，该数据包含截至模块637，302的所有P2WPKH输出大小的直方图。正如所料，所有观察到的输出都有31字节的大小。</p><figure class="li lj lk ll fq lm fe ff paragraph-image"><div role="button" tabindex="0" class="ln lo di lp bf lq"><div class="fe ff lh"><img src="../Images/76713ee61145ca10462ebd3254db8dc0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*e0DaGMulFBqP4eRj87oZyQ.png"/></div></div></figure><p id="c2c3" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">P2WPKH输入也有固定大小。一个32字节的事务id、一个4字节的位置、一个1字节的变长整数、一个空的解锁脚本和一个4字节的序列号的贡献导致总大小为41字节。</p><p id="755d" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">同样，这一估计得到了经验数据的证实。下图包含截至模块637，302的所有P2WPKH输入大小的直方图。数据表明它们的大小都是41字节。</p><figure class="li lj lk ll fq lm fe ff paragraph-image"><div role="button" tabindex="0" class="ln lo di lp bf lq"><div class="fe ff lh"><img src="../Images/d5b45f48ce20a92660fa024ef2a3d97d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RHzlp3WLdeHPpicnpxyohQ.png"/></div></div></figure><p id="6cf4" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">P2WPKH见证包含与P2SH-P2WPKH见证相同的数据:一个单字节的变长整数，表示见证中的项数(两个:一个签名和一个公钥)；一个71.5字节的签名和一个编码其大小的1字节变长整数；一个33字节的公钥和一个编码其大小的1字节变长整数。因此，P2WPKH见证具有与P2SH-P2WPKH见证相同的107.5字节估计值。</p><p id="11ac" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">同样，分析估计得到了经验数据的支持。下图所示的直方图显示了截至块637，302的所有P2WPKH见证的大小。数据显示大部分见证的大小为107或108字节。与P2SH-P2WPKH见证的情况一样，偏向107字节可以通过<a class="ae jo" href="https://github.com/bitcoin/bitcoin/pull/13666" rel="noopener ugc nofollow" target="_blank">低r优化</a>来解释，与用于估计的71.5字节平均值相比，低r优化允许产生71字节签名。</p><figure class="li lj lk ll fq lm fe ff paragraph-image"><div role="button" tabindex="0" class="ln lo di lp bf lq"><div class="fe ff lh"><img src="../Images/80cdcbf995de4f8ea7bdedf5c0b94fee.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2nBpjPLsGKj7N3WjR9ihpg.png"/></div></div></figure><h2 id="35a9" class="kt jr ht bd js ku kv kw jw kx ky kz ka jb la lb ke jf lc ld ki jj le lf km lg dt translated">支付给证人脚本哈希</h2><p id="618c" class="pw-post-body-paragraph iq ir ht is b it ko iv iw ix kp iz ja jb kq jd je jf kr jh ji jj ks jl jm jn hm dt translated">pay-to-Witness-Script-Hash(P2WSH)输出的固定大小为43个字节:8个字节对值进行编码，1个字节的可变长度整数对锁定脚本的大小进行编码，34个字节的锁定脚本。</p><p id="2927" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">下图中显示的经验数据支持这一分析估计，该数据包含截至块637，302的所有P2WSH输出大小的直方图。正如所料，所有观察到的输出都有43字节的大小。</p><figure class="li lj lk ll fq lm fe ff paragraph-image"><div role="button" tabindex="0" class="ln lo di lp bf lq"><div class="fe ff lh"><img src="../Images/5327b0265831a375d5fb0f3c6693dee3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XJy20XFnsPhpU2wSrg5iLw.png"/></div></div></figure><p id="a6bc" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">P2WSH输入也有固定的大小。一个32字节的事务id、一个4字节的位置、一个1字节的变长整数、一个空的解锁脚本和一个4字节的序列号的贡献导致总大小为41字节。</p><p id="452a" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">和以前一样，这一估计得到了经验数据的证实。下图包含截至块637，302的所有P2WSH输入大小的直方图。数据表明它们的大小都是41字节。</p><figure class="li lj lk ll fq lm fe ff paragraph-image"><div role="button" tabindex="0" class="ln lo di lp bf lq"><div class="fe ff lh"><img src="../Images/cbecf9b604a9f1c111cbc83a1659832e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*v7HTT25X2f8CQeCatCFwRQ.png"/></div></div></figure><p id="d090" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">P2WSH见证服务器包含与P2SH-P2WSH见证服务器相同的数据。因此，P2WSH见证的大小由以下因素给出:指示见证项数量的变长整数；1+72.5 <em class="jp"> m </em>字节数据满足见证脚本；见证脚本，贡献3+34 <em class="jp"> n </em>字节；另一个可变长度整数表示见证脚本的大小。</p><p id="379c" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">在下文中，对1对1、2对2和3对2的P2WSH-multisig见证进行了分析估计验证，这些见证合计占所有P2WSH-multisig交易的98%以上。</p><p id="5562" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">对于1-of-1 P2WSH-multisig，见证脚本是3+34 <em class="jp"> n </em> =37个字节，因此编码见证脚本大小的可变长度整数只需要一个字节。而且，满足见证脚本的数据贡献了1+72.5 <em class="jp"> m </em> =73.5字节。用于编码堆栈项目数量的可变长度整数贡献了另一个字节。因此，总估计值为112.5字节。</p><p id="cc21" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">下图中显示的经验数据支持这一估计，该数据包含所考虑的P2WSH-multisig变体的所有见证大小的直方图。对于1/1 P2WSH-multisig，观察到的112或113字节的大小与分析估计相匹配。</p><figure class="li lj lk ll fq lm fe ff paragraph-image"><div role="button" tabindex="0" class="ln lo di lp bf lq"><div class="fe ff lh"><img src="../Images/90824ac9d29a050383d4d295a3c766a7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LHAquNqJE0CsXqocByw9Hw.png"/></div></div></figure><p id="9499" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">对于2选2 P2WSH-multisig，<em class="jp"> m </em> =2，<em class="jp"> n </em> =2。因此，见证脚本是3+34 <em class="jp"> n </em> =71个字节，编码见证脚本大小的可变长度整数只需要一个字节。而且，满足见证脚本的数据贡献了1+72.5 <em class="jp"> m </em> =146字节。用于编码堆栈项目数量的可变长度整数贡献了另一个字节。因此，总估计值为219字节。</p><p id="168a" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">对于2-of-3 P2WSH-multisig，<em class="jp"> m </em> =2，<em class="jp"> n </em> =3，因此数据和见证脚本的贡献分别为1+72.5 <em class="jp"> m </em> =146字节和3+34n=105字节。同样，指示见证项数量和见证脚本长度的两个可变长度整数贡献了两个字节，因此总体估计值为253个字节。</p><p id="6f69" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">上图所示的经验数据支持2/2和3/2的估计。注意，如前所述，在3选2 P2WSH-multisig的情况下，偏向252字节可以通过<a class="ae jo" href="https://github.com/bitcoin/bitcoin/pull/13666" rel="noopener ugc nofollow" target="_blank">低r优化</a>来解释。</p><h2 id="4ff4" class="kt jr ht bd js ku kv kw jw kx ky kz ka jb la lb ke jf lc ld ki jj le lf km lg dt translated">支付给主根</h2><p id="de45" class="pw-post-body-paragraph iq ir ht is b it ko iv iw ix kp iz ja jb kq jd je jf kr jh ji jj ks jl jm jn hm dt translated">Pay-to-Taproot (P2TR)输出具有43字节的固定大小:8个字节对值进行编码，1个字节的可变长度整数对锁定脚本的大小进行编码，34个字节的锁定脚本。</p><p id="bccd" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">P2TR输入也有固定的大小。一个32字节的事务id、一个4字节的位置、一个1字节的变长整数、一个空的解锁脚本和一个4字节的序列号的贡献导致总大小为41字节。</p><p id="dc98" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">对于关键路径，P2TR见证也有固定的大小。一个指示见证项数量的1字节变长整数、另一个指示Schnorr签名长度的1字节变长整数和一个64字节Schnorr签名的贡献导致对见证的总大小的估计为66字节。</p><p id="d753" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">对于脚本路径，P2TR见证具有可变的大小。鉴于缺乏经验数据，不可能推导出常见用例的大小。此外，缺乏经验数据，以前的分析估计无法验证。</p><h1 id="7355" class="jq jr ht bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn dt translated">交易格式</h1><p id="c07f" class="pw-post-body-paragraph iq ir ht is b it ko iv iw ix kp iz ja jb kq jd je jf kr jh ji jj ks jl jm jn hm dt translated">到目前为止，已经讨论了不同输入、输出和见证类型的大小。为了对交易进行估计，需要考虑作为交易一部分的附加数据。</p><p id="80d6" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">除了输入、输出和见证，事务还包括:四字节版本；如果交易的任何输入使用见证数据，一个一字节隔离见证(SegWit)标记和一个一字节SegWit版本；两个变长整数，用于指示输入、输出的数量(见证的数量与输入的数量相同，因此两个变长整数就足够了)；和一个四字节的锁定时间字段。</p><p id="73f4" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">然后，事务大小估计由事务版本和锁时间给出的固定八字节贡献给出；指示输入数量和输入本身的可变长度整数的大小；可变长度整数的大小，表示输出和输入本身的数量。对于SegWit事务，还必须考虑见证的大小以及SegWit标记和标志的固定两字节贡献。</p><h1 id="b825" class="jq jr ht bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn dt translated">使用libtxsize自动估计事务大小</h1><p id="2419" class="pw-post-body-paragraph iq ir ht is b it ko iv iw ix kp iz ja jb kq jd je jf kr jh ji jj ks jl jm jn hm dt translated"><a class="ae jo" href="https://github.com/virtu/libtxsize" rel="noopener ugc nofollow" target="_blank"> <em class="jp"> libtxsize </em> </a>将所有以前的发现提取到一个库中，用于自动化的交易规模估计。libtxsize 是用Python编写的，包括简单的Python接口来获得输入、输出和见证大小的估计值，以及任意事务的估计值。此外，它还包括一个命令行界面供您使用；估计事务的大小就像指定所需的输入和输出类型一样简单:</p><pre class="li lj lk ll fq lx lw ly lz aw ma dt"><span id="78e8" class="kt jr ht lw b fv mb mc l md me">λ$ ./libtxsize-cli.py -i P2WPKH,P2SH-1-of-2-multisig -o P2PKH,P2TR<br/>+-------------------------+------------+-------------+-------------+<br/>| Part/Metric             |   size [B] | weight [WU] |  vsize [vB] |<br/>+-------------------------+------------+-------------+-------------+<br/>| INPUTS                  |            |             |             |<br/>| 1. P2WPKH               |         41 |         164 |          41 |<br/>| 2. P2SH-1-of-2-multisig |        186 |         744 |         186 |<br/>+-------------------------+------------+-------------+-------------+<br/>| WITNESSES               |            |             |             |<br/>| 1. P2WPKH               |        107 |         107 |       26.75 |<br/>| 2. P2SH-1-of-2-multisig |        N/A |         N/A |         N/A |<br/>+-------------------------+------------+-------------+-------------+<br/>| OUTPUTS                 |            |             |             |<br/>| 1. P2PKH                |         34 |         136 |          34 |<br/>| 2. P2TR                 |         43 |         172 |          43 |<br/>+-------------------------+------------+-------------+-------------+<br/>| INPUT DATA              |        227 |         908 |         227 |<br/>| WITNESS DATA            |        108 |         108 |        27.0 |<br/>| OUTPUT DATA             |         77 |         308 |       19.25 |<br/>| TRANSACTION OVERHEAD    |         12 |          34 |         8.5 |<br/>+-------------------------+------------+-------------+-------------+<br/>| TRANSACTION TOTAL       |        424 |        1366 |       341.5 |<br/>+-------------------------+------------+-------------+-------------+</span></pre><p id="cb17" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">除了总体事务规模估计之外，<em class="jp"> libtxsize </em>还包括事务的不同部分的信息，比如单个输入、输出和见证，以及事务开销。此外，<em class="jp"> libtxsize </em>除了大小估计之外，还包括重量和虚拟大小估计。</p><p id="94e2" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">请注意，为了使结果更加相关，估计值基于2018年推出的<a class="ae jo" href="https://github.com/bitcoin/bitcoin/pull/13666" rel="noopener ugc nofollow" target="_blank">低r优化</a>假设71字节签名大小。</p><h1 id="7f9a" class="jq jr ht bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn dt translated">结果和结论</h1><p id="2a9d" class="pw-post-body-paragraph iq ir ht is b it ko iv iw ix kp iz ja jb kq jd je jf kr jh ji jj ks jl jm jn hm dt translated">使用第一性原理分析研究了不同输入、输出和见证类型的大小。基于分析的结果，为所有相关的用例建立了评估；此外，所有的估计(除了支付到主根)都验证了使用经验数据。</p><p id="0b53" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">下表总结了这些发现，以供快速参考。它包括最相关用例的输入、输出和见证大小。请注意，估计值是基于71.5字节的ECDSA签名大小。</p><figure class="li lj lk ll fq lm fe ff paragraph-image"><div role="button" tabindex="0" class="ln lo di lp bf lq"><div class="fe ff mf"><img src="../Images/694ef75a54fb9e9aba89fab5c45e39b9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-fES5B_7rAtUdnW0oOT9ug.png"/></div></div></figure><p id="f2b9" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">此外，<a class="ae jo" href="https://github.com/virtu/libtxsize" rel="noopener ugc nofollow" target="_blank"> <em class="jp"> libtxsize </em> </a>是一个自动化事务规模估算的库。<em class="jp"> libtxsize </em>代表了本次和之前调查结果的精髓。</p><p id="f8ca" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">如果您发现本文中的信息有用，请随意投稿:<code class="eh lt lu lv lw b">16pGpaoAhzoneLdRdxPSo9xAAPhzWnP2dA</code>。如果你有科学、比特币相关的自由职业工作，<a class="ae jo" href="mailto:cato@zen.science" rel="noopener ugc nofollow" target="_blank">让我知道</a>。</p><h2 id="5967" class="kt jr ht bd js ku kv kw jw kx ky kz ka jb la lb ke jf lc ld ki jj le lf km lg dt translated">另外，阅读</h2><ul class=""><li id="02dc" class="mg mh ht is b it ko ix kp jb mi jf mj jj mk jn ml mm mn mo dt translated">最好的<a class="ae jo" rel="noopener" href="/coinmonks/crypto-trading-bot-c2ffce8acb2a">密码交易机器人</a></li><li id="b851" class="mg mh ht is b it mp ix mq jb mr jf ms jj mt jn ml mm mn mo dt translated"><a class="ae jo" rel="noopener" href="/coinmonks/top-10-crypto-copy-trading-platforms-for-beginners-d0c37c7d698c">密码本交易平台</a></li><li id="ae2d" class="mg mh ht is b it mp ix mq jb mr jf ms jj mt jn ml mm mn mo dt translated">最好的<a class="ae jo" rel="noopener" href="/coinmonks/best-crypto-tax-tool-for-my-money-72d4b430816b">加密税务软件</a></li><li id="92e4" class="mg mh ht is b it mp ix mq jb mr jf ms jj mt jn ml mm mn mo dt translated"><a class="ae jo" rel="noopener" href="/coinmonks/the-best-crypto-trading-platforms-in-2020-the-definitive-guide-updated-c72f8b874555">最佳加密交易平台</a></li><li id="d8fc" class="mg mh ht is b it mp ix mq jb mr jf ms jj mt jn ml mm mn mo dt translated">最佳<a class="ae jo" rel="noopener" href="/coinmonks/top-5-crypto-lending-platforms-in-2020-that-you-need-to-know-a1b675cec3fa">加密贷款平台</a></li><li id="4f10" class="mg mh ht is b it mp ix mq jb mr jf ms jj mt jn ml mm mn mo dt translated"><a class="ae jo" href="https://bitquery.io/blog/best-blockchain-analysis-tools-and-software" rel="noopener ugc nofollow" target="_blank">最佳区块链分析工具</a></li><li id="d432" class="mg mh ht is b it mp ix mq jb mr jf ms jj mt jn ml mm mn mo dt translated"><a class="ae jo" rel="noopener" href="/coinmonks/crypto-arbitrage-guide-how-to-make-money-as-a-beginner-62bfe5c868f6">加密套利</a>指南:新手如何赚钱</li><li id="aa54" class="mg mh ht is b it mp ix mq jb mr jf ms jj mt jn ml mm mn mo dt translated">最佳<a class="ae jo" rel="noopener" href="/coinmonks/what-are-the-best-charting-platforms-for-cryptocurrency-trading-85aade584d80">加密制图工具</a></li><li id="15e1" class="mg mh ht is b it mp ix mq jb mr jf ms jj mt jn ml mm mn mo dt translated"><a class="ae jo" rel="noopener" href="/coinmonks/ledger-vs-trezor-best-hardware-wallet-to-secure-cryptocurrency-22c7a3fd391e">莱杰vs特雷佐</a></li><li id="56fd" class="mg mh ht is b it mp ix mq jb mr jf ms jj mt jn ml mm mn mo dt translated">了解比特币最好的<a class="ae jo" rel="noopener" href="/coinmonks/what-are-the-best-books-to-learn-bitcoin-409aeb9aff4b">书籍有哪些？</a></li><li id="170f" class="mg mh ht is b it mp ix mq jb mr jf ms jj mt jn ml mm mn mo dt translated"><a class="ae jo" rel="noopener" href="/coinmonks/3commas-review-an-excellent-crypto-trading-bot-2020-1313a58bec92">3商业评论</a></li><li id="d145" class="mg mh ht is b it mp ix mq jb mr jf ms jj mt jn ml mm mn mo dt translated"><a class="ae jo" rel="noopener" href="/coinmonks/aax-exchange-review-2021-67c5ea09330c"> AAX交易所评论</a> |推荐代码、交易费用、利弊</li><li id="54f9" class="mg mh ht is b it mp ix mq jb mr jf ms jj mt jn ml mm mn mo dt translated"><a class="ae jo" rel="noopener" href="/coinmonks/deribit-review-options-fees-apis-and-testnet-2ca16c4bbdb2"> Deribit审查</a> |选项、费用、API和Testnet</li><li id="e34b" class="mg mh ht is b it mp ix mq jb mr jf ms jj mt jn ml mm mn mo dt translated"><a class="ae jo" rel="noopener" href="/coinmonks/ftx-crypto-exchange-review-53664ac1198f"> FTX密码交易所评论</a></li><li id="d0c3" class="mg mh ht is b it mp ix mq jb mr jf ms jj mt jn ml mm mn mo dt translated"><a class="ae jo" rel="noopener" href="/coinmonks/ngrave-zero-review-c465cf8307fc">n零审核</a></li><li id="1310" class="mg mh ht is b it mp ix mq jb mr jf ms jj mt jn ml mm mn mo dt translated"><a class="ae jo" rel="noopener" href="/coinmonks/bybit-exchange-review-dbd570019b71"> Bybit交换审查</a></li><li id="8b1e" class="mg mh ht is b it mp ix mq jb mr jf ms jj mt jn ml mm mn mo dt translated"><a class="ae jo" rel="noopener" href="/coinmonks/cryptohopper-vs-3commas-vs-shrimpy-a2c16095b8fe"> 3Commas vs Cryptohopper </a></li><li id="b18b" class="mg mh ht is b it mp ix mq jb mr jf ms jj mt jn ml mm mn mo dt translated">最好的比特币<a class="ae jo" rel="noopener" href="/coinmonks/the-best-cryptocurrency-hardware-wallets-of-2020-e28b1c124069?source=friends_link&amp;sk=324dd9ff8556ab578d71e7ad7658ad7c">硬件钱包</a></li><li id="e7b1" class="mg mh ht is b it mp ix mq jb mr jf ms jj mt jn ml mm mn mo dt translated">最佳<a class="ae jo" href="https://blog.coincodecap.com/best-monero-wallets" rel="noopener ugc nofollow" target="_blank"> monero钱包</a></li><li id="747f" class="mg mh ht is b it mp ix mq jb mr jf ms jj mt jn ml mm mn mo dt translated"><a class="ae jo" href="https://blog.coincodecap.com/ledger-nano-s-vs-x" rel="noopener ugc nofollow" target="_blank">莱杰nano s vs x </a></li><li id="ace6" class="mg mh ht is b it mp ix mq jb mr jf ms jj mt jn ml mm mn mo dt translated"><a class="ae jo" href="https://blog.coincodecap.com/bitsgap-3commas-quadency" rel="noopener ugc nofollow" target="_blank">bits gap vs 3 commas vs quad ency</a></li><li id="a274" class="mg mh ht is b it mp ix mq jb mr jf ms jj mt jn ml mm mn mo dt translated"><a class="ae jo" href="https://blog.coincodecap.com/ledger-nano-s-vs-trezor-one-ledger-nano-x-trezor-t" rel="noopener ugc nofollow" target="_blank">莱杰纳米S vs特雷佐1 vs特雷佐T vs莱杰纳米X </a></li><li id="44f0" class="mg mh ht is b it mp ix mq jb mr jf ms jj mt jn ml mm mn mo dt translated"><a class="ae jo" rel="noopener" href="/coinmonks/blockfi-vs-celsius-vs-hodlnaut-8a1cc8c26630">block fi vs Celsius</a>vs Hodlnaut</li><li id="52d0" class="mg mh ht is b it mp ix mq jb mr jf ms jj mt jn ml mm mn mo dt translated">Bitsgap评论——一个轻松赚钱的加密交易机器人</li><li id="92c0" class="mg mh ht is b it mp ix mq jb mr jf ms jj mt jn ml mm mn mo dt translated">为专业人士设计的加密交易机器人</li><li id="22eb" class="mg mh ht is b it mp ix mq jb mr jf ms jj mt jn ml mm mn mo dt translated"><a class="ae jo" rel="noopener" href="/coinmonks/primexbt-review-88e0815be858"> PrimeXBT审查</a> |杠杆交易、费用和交易</li><li id="62d2" class="mg mh ht is b it mp ix mq jb mr jf ms jj mt jn ml mm mn mo dt translated"><a class="ae jo" rel="noopener" href="/coinmonks/ellipal-titan-review-85e9071dd029">埃利帕尔泰坦评论</a></li><li id="1a26" class="mg mh ht is b it mp ix mq jb mr jf ms jj mt jn ml mm mn mo dt translated"><a class="ae jo" href="https://blog.coincodecap.com/secux-stone-hardware-wallet-review" rel="noopener ugc nofollow" target="_blank"> SecuX Stone评论</a></li><li id="31ff" class="mg mh ht is b it mp ix mq jb mr jf ms jj mt jn ml mm mn mo dt translated"><a class="ae jo" rel="noopener" href="/coinmonks/blockfi-review-53096053c097"> BlockFi评论</a> |从您的密码中赚取高达8.6%的利息</li></ul></div></div>    
</body>
</html>