<html>
<head>
<title>Ethereum: Land Marketplace Dapp Tutorial — Part 2— Integrate With a Web App</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">以太坊:土地市场Dapp教程—第2部分—与Web应用程序集成</h1>
<blockquote>原文：<a href="https://medium.com/coinmonks/ethereum-land-marketplace-dapp-tutorial-part-2-integrate-with-a-web-app-85db82d732cd?source=collection_archive---------2-----------------------#2018-08-01">https://medium.com/coinmonks/ethereum-land-marketplace-dapp-tutorial-part-2-integrate-with-a-web-app-85db82d732cd?source=collection_archive---------2-----------------------#2018-08-01</a></blockquote><div><div class="ef hh hi hj hk hl"/><div class="hm hn ho hp hq"><div class=""/><figure class="fi fk ir is it iu fe ff paragraph-image"><div role="button" tabindex="0" class="iv iw di ix bf iy"><div class="fe ff iq"><img src="../Images/3e9df02b98d37393c06f2a989b6c886b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TrNyPAhviAD-f1jUpBe3bA.png"/></div></div><figcaption class="jb jc fg fe ff jd je bd b be z ek">Property Website</figcaption></figure><p id="be88" class="pw-post-body-paragraph jf jg ht jh b ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc hm dt translated"><a class="ae kd" href="https://github.com/toluhi/property-developer" rel="noopener ugc nofollow" target="_blank"> GitHub回购</a></p><p id="f1fa" class="pw-post-body-paragraph jf jg ht jh b ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc hm dt translated">在本节中，我们将从一个web应用程序调用我们在本教程的第<a class="ae kd" rel="noopener" href="/@adeyemitoluhi/ethereum-land-allocation-dapp-tutorial-part-1-create-and-deploy-a-smart-contract-351bc0d62be2">部分1 </a>中开发的智能契约。</p><p id="e739" class="pw-post-body-paragraph jf jg ht jh b ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc hm dt translated">从这个<a class="ae kd" href="https://github.com/toluhi/property-developer" rel="noopener ugc nofollow" target="_blank"> GitHub repo </a>中签出web应用程序代码。您需要在计算机上安装npm。你可以在这里找到关于如何安装npm/node <a class="ae kd" href="https://www.npmjs.com/get-npm" rel="noopener ugc nofollow" target="_blank">的细节</a>。</p><h1 id="b1f2" class="ke kf ht bd kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb dt translated">安装依赖项</h1><p id="30e3" class="pw-post-body-paragraph jf jg ht jh b ji lc jk jl jm ld jo jp jq le js jt ju lf jw jx jy lg ka kb kc hm dt translated">启动终端或命令提示符，导航到您下载或签出代码的目录，然后运行<code class="eh lh li lj lk b">npm install</code>。</p><p id="3aa1" class="pw-post-body-paragraph jf jg ht jh b ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc hm dt translated">你可能会注意到的第一件事是，该网站是一个基于react/redux的应用程序。如果你不熟悉他们，不要担心。我们将只关注智能合约集成，希望很明显你需要做什么来用不同的库/框架实现类似的东西。</p><h1 id="f597" class="ke kf ht bd kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb dt translated">开放Web套接字API</h1><p id="6437" class="pw-post-body-paragraph jf jg ht jh b ji lc jk jl jm ld jo jp jq le js jt ju lf jw jx jy lg ka kb kc hm dt translated">我们需要做的下一件事是，停止geth控制台，如果它还在运行，然后用下面的命令重新启动它。</p><pre class="ll lm ln lo fq lp lk lq lr aw ls dt"><span id="2a1a" class="lt kf ht lk b fv lu lv l lw lx"><strong class="lk hu">geth</strong> —<strong class="lk hu">datadir</strong> ./datadir_new —<strong class="lk hu">networkid</strong> 2018 —<strong class="lk hu">port</strong> 30306 —<strong class="lk hu">nodiscover</strong> —<strong class="lk hu">rpc</strong> —<strong class="lk hu">rpcapi</strong> “db,personal,eth,net,web3,debug” —<strong class="lk hu">rpccorsdomain</strong>=”*” —<strong class="lk hu">rpcaddr</strong>=”localhost” —<strong class="lk hu">rpcport</strong> 8545 --<strong class="lk hu">ws</strong> --<strong class="lk hu">wsapi</strong> "db,personal,eth,net,web3,debug" --<strong class="lk hu">wsorigins</strong>="*"  --<strong class="lk hu">wsaddr</strong>="localhost" --<strong class="lk hu">wsport</strong> 8546 <strong class="lk hu">console</strong></span></pre><p id="8fc7" class="pw-post-body-paragraph jf jg ht jh b ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc hm dt translated">该命令与前一个命令的不同之处在于，它还通过web socket (port <strong class="jh hu"> 8546 </strong>)公开了geth api。</p><h1 id="4d65" class="ke kf ht bd kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb dt translated">从混音版复制ABI</h1><p id="9e7a" class="pw-post-body-paragraph jf jg ht jh b ji lc jk jl jm ld jo jp jq le js jt ju lf jw jx jy lg ka kb kc hm dt translated">按照以下步骤将ABI从混音复制到<code class="eh lh li lj lk b">src\contracts\landContract.json</code>。</p><ul class=""><li id="c700" class="ly lz ht jh b ji jj jm jn jq ma ju mb jy mc kc md me mf mg dt translated">开放式混音</li><li id="dd32" class="ly lz ht jh b ji mh jm mi jq mj ju mk jy ml kc md me mf mg dt translated">转到编译选项卡</li></ul><figure class="ll lm ln lo fq iu fe ff paragraph-image"><div class="fe ff mm"><img src="../Images/4eeccc63999364f87e0903c3ea4b5c0f.png" data-original-src="https://miro.medium.com/v2/resize:fit:658/format:webp/1*mrUsJTaByXJo3u_5Rdd21w.png"/></div><figcaption class="jb jc fg fe ff jd je bd b be z ek">Compile Tab</figcaption></figure><ul class=""><li id="8d30" class="ly lz ht jh b ji jj jm jn jq ma ju mb jy mc kc md me mf mg dt translated">单击详细信息，向下滚动到出现的模态视图，然后单击ABI旁边的复制图标。这会将ABI复制到剪贴板。</li></ul><figure class="ll lm ln lo fq iu fe ff paragraph-image"><div class="fe ff mn"><img src="../Images/cd5f2a762a644c925aef117ec70b7d62.png" data-original-src="https://miro.medium.com/v2/resize:fit:226/format:webp/1*D15wqbC59gKG3GAsPcjv1w.png"/></div><figcaption class="jb jc fg fe ff jd je bd b be z ek">ABI</figcaption></figure><ul class=""><li id="adb4" class="ly lz ht jh b ji jj jm jn jq ma ju mb jy mc kc md me mf mg dt translated">将ABI粘贴到<code class="eh lh li lj lk b">src\contracts\landContract.json</code>文件中。</li></ul><p id="6992" class="pw-post-body-paragraph jf jg ht jh b ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc hm dt translated">那么，什么是ABI，我们为什么需要它？ABI使您能够对智能合约的调用进行编码，并从交易中读取/解码数据。</p><p id="8676" class="pw-post-body-paragraph jf jg ht jh b ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc hm dt translated">如果您没有进行任何自定义更改，那么您的ABI应该与下面的landContract.json的内容相同。</p><figure class="ll lm ln lo fq iu"><div class="bz el l di"><div class="mo mp l"/></div></figure><h1 id="037a" class="ke kf ht bd kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb dt translated">连接</h1><p id="65b4" class="pw-post-body-paragraph jf jg ht jh b ji lc jk jl jm ld jo jp jq le js jt ju lf jw jx jy lg ka kb kc hm dt translated">在本节中，我们将修改<code class="eh lh li lj lk b">src\action\index.js</code>。我们需要修改的相关部分有占位符，我们将处理这些占位符。</p><figure class="ll lm ln lo fq iu"><div class="bz el l di"><div class="mo mp l"/></div></figure><p id="c99b" class="pw-post-body-paragraph jf jg ht jh b ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc hm dt translated">我们在这个文件中导入了两个关键模块，第一个是<code class="eh lh li lj lk b">web3</code>，第二个是我们之前更新的ABI文件。</p><p id="70a3" class="pw-post-body-paragraph jf jg ht jh b ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc hm dt translated">我们首先需要更新的是区块链的web套接字地址。</p><figure class="ll lm ln lo fq iu"><div class="bz el l di"><div class="mo mp l"/></div></figure><p id="e367" class="pw-post-body-paragraph jf jg ht jh b ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc hm dt translated">因为我们连接到本地运行的区块链，如果您还记得的话，我们将wsport设置为8546，将provider设置为<code class="eh lh li lj lk b">ws://localhost:8546</code>。</p><figure class="ll lm ln lo fq iu"><div class="bz el l di"><div class="mo mp l"/></div></figure><p id="0af5" class="pw-post-body-paragraph jf jg ht jh b ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc hm dt translated">要使用这个网站，用户必须用他们的地址和密码登录。为此，我们将使用个人图书馆。修改登录函数，如下所示。</p><figure class="ll lm ln lo fq iu"><div class="bz el l di"><div class="mo mp l"/></div><figcaption class="jb jc fg fe ff jd je bd b be z ek">Login</figcaption></figure><p id="b168" class="pw-post-body-paragraph jf jg ht jh b ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc hm dt translated">如果新用户使用这个网站的唯一方式是在geth控制台上创建一个帐户，这将是一个糟糕的用户体验。同样，使用个人库，我们公开了帐户创建功能。将注册功能更新为。</p><figure class="ll lm ln lo fq iu"><div class="bz el l di"><div class="mo mp l"/></div></figure><p id="a1a0" class="pw-post-body-paragraph jf jg ht jh b ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc hm dt translated">下一个功能<code class="eh lh li lj lk b">changeContractAddress</code>允许这个站点的用户改变他们正在交互的合同的实例(地址)。当这个函数成功加载一个合同时，它应该做两件主要的事情。首先，加载图及其状态的列表，以便它可以更新UI并订阅事件，以便它可以在发生更改时做出响应。这也是需要ABI的地方。将函数更新为。</p><figure class="ll lm ln lo fq iu"><div class="bz el l di"><div class="mo mp l"/></div></figure><p id="9c61" class="pw-post-body-paragraph jf jg ht jh b ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc hm dt translated">最后三个未实现的函数是buyPlot、sellPlot和takeOffMarket，希望这些函数应该做什么很明显。用这些替换3个函数。</p><figure class="ll lm ln lo fq iu"><div class="bz el l di"><div class="mo mp l"/></div></figure><p id="2e89" class="pw-post-body-paragraph jf jg ht jh b ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc hm dt translated">为了调用函数或监听契约上的事件，我们使用在<code class="eh lh li lj lk b">changeContractAddress</code>函数中创建的契约实例。</p><p id="949b" class="pw-post-body-paragraph jf jg ht jh b ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc hm dt translated">打开命令提示符/终端，导航到您的签出文件夹。然后跑<code class="eh lh li lj lk b">npm start</code>。一旦启动，从你电脑上的任何浏览器进入localhost:8080，你应该会看到下面的登陆界面。</p><figure class="ll lm ln lo fq iu fe ff paragraph-image"><div role="button" tabindex="0" class="iv iw di ix bf iy"><div class="fe ff mq"><img src="../Images/02dbbb1c16558e94651ed9a0c7aa65e0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nf52dJr74r7Q72T8xDmIQg.png"/></div></div><figcaption class="jb jc fg fe ff jd je bd b be z ek">Landing Page</figcaption></figure><p id="91eb" class="pw-post-body-paragraph jf jg ht jh b ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc hm dt translated">让我们试试登录功能。</p><ul class=""><li id="81a5" class="ly lz ht jh b ji jj jm jn jq ma ju mb jy mc kc md me mf mg dt translated">从remix中，通过选择帐户并单击下拉菜单旁边的复制按钮，复制有以太的帐户的地址。</li></ul><figure class="ll lm ln lo fq iu fe ff paragraph-image"><div class="fe ff mr"><img src="../Images/1cc3b2c79373aa1f6433d84227b22f2d.png" data-original-src="https://miro.medium.com/v2/resize:fit:880/format:webp/1*PSdeNMOmAJXGEn5Kp5hf0Q.png"/></div><figcaption class="jb jc fg fe ff jd je bd b be z ek">Account With Ether</figcaption></figure><ul class=""><li id="c723" class="ly lz ht jh b ji jj jm jn jq ma ju mb jy mc kc md me mf mg dt translated">单击登录，并在出现的模式弹出窗口中输入地址和密码。然后单击登录</li></ul><figure class="ll lm ln lo fq iu fe ff paragraph-image"><div class="fe ff ms"><img src="../Images/cee8bc0c5766e594426da33ef5ddc346.png" data-original-src="https://miro.medium.com/v2/resize:fit:972/format:webp/1*QHrpG-Gzg8ie_JCqUv9x2A.png"/></div><figcaption class="jb jc fg fe ff jd je bd b be z ek">Login</figcaption></figure><ul class=""><li id="2a8d" class="ly lz ht jh b ji jj jm jn jq ma ju mb jy mc kc md me mf mg dt translated">这将为您提供一个输入合同地址的屏幕。您可以通过单击已部署合同旁边的复制按钮从remix获取合同地址。</li></ul><figure class="ll lm ln lo fq iu fe ff paragraph-image"><div class="fe ff mt"><img src="../Images/3b7fda684d0e6c79ec2f500c56c7019c.png" data-original-src="https://miro.medium.com/v2/resize:fit:922/format:webp/1*aGUTQggIhVzvFSff8GSdaA.png"/></div><figcaption class="jb jc fg fe ff jd je bd b be z ek">Copy Contract Address</figcaption></figure><ul class=""><li id="1431" class="ly lz ht jh b ji jj jm jn jq ma ju mb jy mc kc md me mf mg dt translated">粘贴地址并按回车键</li></ul><figure class="ll lm ln lo fq iu fe ff paragraph-image"><div role="button" tabindex="0" class="iv iw di ix bf iy"><div class="fe ff mu"><img src="../Images/06bc83fbd727505db7bfcbb5eaf8caf9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WE-ALof8HByapihR4yUcRQ.png"/></div></div><figcaption class="jb jc fg fe ff jd je bd b be z ek">Enter Contract Address and Press Enter</figcaption></figure><p id="c8a4" class="pw-post-body-paragraph jf jg ht jh b ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc hm dt translated">这应该给你提供了可用的情节。</p><figure class="ll lm ln lo fq iu fe ff paragraph-image"><div role="button" tabindex="0" class="iv iw di ix bf iy"><div class="fe ff mv"><img src="../Images/12a8be7290e05ba108ba457758c1ec0d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*v5u4DQJcWxidiPKvmOZ6ig.png"/></div></div><figcaption class="jb jc fg fe ff jd je bd b be z ek">Available Plots</figcaption></figure><ul class=""><li id="4ed2" class="ly lz ht jh b ji jj jm jn jq ma ju mb jy mc kc md me mf mg dt translated">在geth控制台<code class="eh lh li lj lk b">miner.start(1)</code>上启动miner，点击购买按钮。一旦你的购买请求被挖掘出来。你会注意到“买入”按钮变成了“卖出”。你也可以从remix中验证剧情的状态。</li></ul><figure class="ll lm ln lo fq iu fe ff paragraph-image"><div role="button" tabindex="0" class="iv iw di ix bf iy"><div class="fe ff mw"><img src="../Images/546b23cfc832039093bb0714d236e396.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*t-qvDPwPnrG55nym68Ev-A.png"/></div></div><figcaption class="jb jc fg fe ff jd je bd b be z ek">After Buying</figcaption></figure><ul class=""><li id="ab89" class="ly lz ht jh b ji jj jm jn jq ma ju mb jy mc kc md me mf mg dt translated">点击出售按钮出售地块。输入一个要价，比如说12000魏，你会注意到，在你的卖出交易被挖掘后，用户界面将更新，你当前拥有的地块上的选项将改变，以将该地块从市场中移除。</li></ul><figure class="ll lm ln lo fq iu fe ff paragraph-image"><div role="button" tabindex="0" class="iv iw di ix bf iy"><div class="fe ff mx"><img src="../Images/7c8aba7e12b679327965185811ebd968.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2zdcgKTR9HhQP7JaHOfbWA.png"/></div></div><figcaption class="jb jc fg fe ff jd je bd b be z ek">Plot on Sale</figcaption></figure><p id="33f0" class="pw-post-body-paragraph jf jg ht jh b ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc hm dt translated">有趣的是，在不同的选项卡上打开localhost:8080并尝试注册，这应该会创建一个新帐户。一旦账户被创建，从你的coinbase账户转移一些乙醚到新账户(如果你已经忘记如何转移，请参见<a class="ae kd" rel="noopener" href="/coinmonks/ethereum-setting-up-a-private-blockchain-67bbb96cf4f1">这个</a>教程)。)然后尝试在账号之间买卖剧情。</p><p id="f6b0" class="pw-post-body-paragraph jf jg ht jh b ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc hm dt translated">希望这对你有用。请在下面的评论区留下任何评论或反馈。</p><p id="a89c" class="pw-post-body-paragraph jf jg ht jh b ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc hm dt translated"><a class="ae kd" href="https://github.com/toluhi/property-developer" rel="noopener ugc nofollow" target="_blank"> GitHub回购</a></p></div></div>    
</body>
</html>