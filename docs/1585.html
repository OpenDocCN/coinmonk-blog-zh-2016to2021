<html>
<head>
<title>Identifying Spammy ERC20 Transfers</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">识别垃圾ERC20传输</h1>
<blockquote>原文：<a href="https://medium.com/coinmonks/identifying-spammy-erc20-transfers-a42fb9909e05?source=collection_archive---------3-----------------------#2018-10-02">https://medium.com/coinmonks/identifying-spammy-erc20-transfers-a42fb9909e05?source=collection_archive---------3-----------------------#2018-10-02</a></blockquote><div><div class="ef hh hi hj hk hl"/><div class="hm hn ho hp hq"><div class=""/><figure class="fi fk ir is it iu fe ff paragraph-image"><div role="button" tabindex="0" class="iv iw di ix bf iy"><div class="fe ff iq"><img src="../Images/486e0d215e8e85dfe566da1e6d1af512.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HBUD-3bvuX2rqf4gebD0Vw.png"/></div></div></figure><p id="1de8" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">当你看到一笔<a class="ae jz" href="https://etherscan.io/tx/0x2249b469a16cb7754a83bb4fc394cc749328d31c229590ce57a37960d04608a1" rel="noopener ugc nofollow" target="_blank">奇怪的代币转账</a>从你的账户发出时，你可能会感到惊讶。你的第一反应是有人黑了你。</p><p id="f3be" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">在谷歌搜索了几秒钟后，您意识到这只是令牌创建者使用的一个技巧——任何契约都可以发出带有任何参数的任何事件。在这种情况下，令牌协定发出一个令牌传输，其中“from”地址是您的帐户。然后，以太扫描捕捉到这个事件，并附加到您的地址。</p><h2 id="dce3" class="ka kb ht bd kc kd ke kf kg kh ki kj kk jm kl km kn jq ko kp kq ju kr ks kt ku dt translated">用BigQuery识别ERC20传输垃圾邮件</h2><p id="deb8" class="pw-post-body-paragraph jb jc ht jd b je kv jg jh ji kw jk jl jm kx jo jp jq ky js jt ju kz jw jx jy hm dt translated">以下是返回垃圾传输的SQL:</p><pre class="la lb lc ld fq le lf lg lh aw li dt"><span id="fac3" class="ka kb ht lf b fv lj lk l ll lm">#standardSQL<br/><strong class="lf hu">with </strong>transfers_and_authorizing_transactions <strong class="lf hu">as </strong>(<br/>  <strong class="lf hu">with </strong>external_accounts <strong class="lf hu">as </strong>(<br/>    <strong class="lf hu">select distinct</strong>(from_address) <strong class="lf hu">as </strong>address<br/>    <strong class="lf hu">from </strong>`bigquery-public-data.ethereum_blockchain.transactions` <strong class="lf hu">as </strong>transactions<br/>  ),<br/>  authorizing_transactions <strong class="lf hu">as </strong>(<br/>    <strong class="lf hu">select </strong>from_address, to_address, <strong class="lf hu">min</strong>(block_number) <strong class="lf hu">as </strong>block_number<br/>    <strong class="lf hu">from </strong>`bigquery-public-data.ethereum_blockchain.transactions` <strong class="lf hu">as </strong>transactions<br/>    <strong class="lf hu">group by </strong>from_address, to_address<br/>  )<br/>  <strong class="lf hu">select </strong>token_transfers.transaction_hash <strong class="lf hu">as </strong>transaction_hash, <br/>    token_transfers.log_index <strong class="lf hu">as </strong>log_index, <br/>    authorizing_transactions.block_number <strong class="lf hu">as </strong>authorizing_block_number<br/>  <strong class="lf hu">from </strong>`bigquery-public-data.ethereum_blockchain.token_transfers` <strong class="lf hu">as </strong>token_transfers<br/>  <strong class="lf hu">join </strong>external_accounts <strong class="lf hu">on </strong>external_accounts.address = token_transfers.from_address<br/>  <strong class="lf hu">left join </strong>authorizing_transactions<br/>    <strong class="lf hu">on </strong>authorizing_transactions.from_address =  token_transfers.from_address<br/>    <strong class="lf hu">and </strong>authorizing_transactions.to_address = token_transfers.token_address<br/>    <strong class="lf hu">and </strong>authorizing_transactions.block_number &lt;= token_transfers.block_number<br/>  <strong class="lf hu">where  </strong>token_transfers.from_address != <strong class="lf hu">'0x0000000000000000000000000000000000000000'<br/></strong>)<br/><strong class="lf hu">select </strong>transaction_hash, log_index<br/><strong class="lf hu">from </strong>transfers_and_authorizing_transactions<br/><strong class="lf hu">where </strong>authorizing_block_number <strong class="lf hu">is null</strong></span></pre><p id="4965" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated"><a class="ae jz" href="https://bigquery.cloud.google.com/savedquery/305730109012:db5fb9604e5043bbab1ae7e9906f20b6" rel="noopener ugc nofollow" target="_blank">在BigQuery中运行它</a></p><p id="544b" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">该查询基于以下假设:如果有来自<strong class="jd hu">外部</strong>账户X的令牌转移，则必须满足以下条件之一:</p><ul class=""><li id="5096" class="ln lo ht jd b je jf ji jj jm lp jq lq ju lr jy ls lt lu lv dt translated">在过去的某个块中，有一个来自X的事务调用了令牌的<code class="eh lw lx ly lf b">approve()</code>方法。</li><li id="ab62" class="ln lo ht jd b je lz ji ma jm mb jq mc ju md jy ls lt lu lv dt translated">包含转账的交易来自账户x。</li></ul><p id="1b59" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">更一般地，如果存在来自外部账户X的代币转账，则X必须之前已经与代币合约交互(即，向其发送交易)。换句话说，如果X从未与令牌进行过交互，那么该转账不可能得到X的授权，一定是垃圾邮件。</p><p id="348a" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated"><a class="ae jz" href="https://bigquery.cloud.google.com/savedquery/305730109012:6ca47f9bfdc34a71ae462d1cc9b6d59c" rel="noopener ugc nofollow" target="_blank">该查询</a>返回根据转账次数排序的垃圾令牌。排名前几位的是:</p><ol class=""><li id="e283" class="ln lo ht jd b je jf ji jj jm lp jq lq ju lr jy me lt lu lv dt translated"><a class="ae jz" href="https://etherscan.io/token/0x212d95fccdf0366343350f486bda1ceafc0c2d63" rel="noopener ugc nofollow" target="_blank"> blockwell.ai KYC卡斯帕令牌</a> : <code class="eh lw lx ly lf b">424574</code></li><li id="326c" class="ln lo ht jd b je lz ji ma jm mb jq mc ju md jy me lt lu lv dt translated">tinyurl.com/nicetokens✌(◕‿-)✌:<code class="eh lw lx ly lf b">61260</code></li><li id="21fc" class="ln lo ht jd b je lz ji ma jm mb jq mc ju md jy me lt lu lv dt translated"><a class="ae jz" href="https://etherscan.io/token/0x45555629aabfea138ead1c1e5f2ac3cce2add830" rel="noopener ugc nofollow" target="_blank">糖果硬币</a> : <code class="eh lw lx ly lf b">50175</code></li><li id="7dd8" class="ln lo ht jd b je lz ji ma jm mb jq mc ju md jy me lt lu lv dt translated"><a class="ae jz" href="https://etherscan.io/token/0x225bc3affc1da39bd3cb2100c74a41c62310d1e1" rel="noopener ugc nofollow" target="_blank">埃尔科因</a> : <code class="eh lw lx ly lf b">46177</code></li></ol><p id="0d4f" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">前两个已经在Etherscan上被标记为垃圾邮件。其他的可以使用上面描述的简单试探法来标记。</p><p id="be98" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">在推特上关注我们https://twitter.com/EthereumEtl T21。</p><p id="80d9" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">另请阅读BigQuery:我们如何构建这个数据集中的<a class="ae jz" href="https://cloud.google.com/blog/products/data-analytics/ethereum-bigquery-how-we-built-dataset" rel="noopener ugc nofollow" target="_blank">以太坊。</a></p><blockquote class="mf"><p id="8875" class="mg mh ht bd mi mj mk ml mm mn mo jy ek translated"><a class="ae jz" href="https://coincodecap.com/?utm_source=coinmonks" rel="noopener ugc nofollow" target="_blank">在您的收件箱中直接获得最佳软件交易</a></p></blockquote><figure class="mq mr ms mt mu iu fe ff paragraph-image"><a href="https://coincodecap.com/?utm_source=coinmonks"><div class="fe ff mp"><img src="../Images/7c0b3dfdcbfea594cc0ae7d4f9bf6fcb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1168/format:webp/0*OJ-qb5G6i863msBB.png"/></div></a></figure></div></div>    
</body>
</html>