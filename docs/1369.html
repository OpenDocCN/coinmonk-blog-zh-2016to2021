<html>
<head>
<title>How to setup your DAPPs to not use “MetaMask” plugin but sign the transaction backend.</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何设置你的DAPPs不使用“元掩码”插件，而是签署交易后端。</h1>
<blockquote>原文：<a href="https://medium.com/coinmonks/how-to-setup-your-dapps-to-not-use-metamask-plugin-but-sign-the-transaction-backend-b8cb8808c9ae?source=collection_archive---------0-----------------------#2018-08-21">https://medium.com/coinmonks/how-to-setup-your-dapps-to-not-use-metamask-plugin-but-sign-the-transaction-backend-b8cb8808c9ae?source=collection_archive---------0-----------------------#2018-08-21</a></blockquote><div><div class="ef hh hi hj hk hl"/><div class="hm hn ho hp hq"><div class=""/><figure class="fi fk ir is it iu fe ff paragraph-image"><div class="fe ff iq"><img src="../Images/e1f48417d8dd8659efb991e679ffea8c.png" data-original-src="https://miro.medium.com/v2/resize:fit:634/format:webp/1*Ofo2jZBKg09FbZZCsjmXkQ.png"/></div><figcaption class="ix iy fg fe ff iz ja bd b be z ek">Source: Google</figcaption></figure><p id="20e5" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">我最近在生产中推出了分散式应用程序(DAPPS)。虽然这是一次有趣但具有挑战性的骑行，但积累的知识非常好。因为从头开始开发reactjs应用程序并为生产做好准备是一个非常麻烦的过程。</p><p id="712c" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">我们正处于Web 3.0时代，是的，一切都变得去中心化了，我们正在回归基础，但是用美妙的技术(区块链)来实现交易的不变性和透明性。话虽如此，采用DAPPS并不容易，因为它需要很少的插件来执行交易。所以很多DAPPs都有一个扩展(插件)来支持日常操作。但是为什么呢？</p><p id="136b" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">为什么最终用户必须担心这些插件？，他们想要的只是使用服务并获得/支付费用，不是吗？</p><p id="3c55" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">当我们开发DAPPs的时候，作为一个开发者要记住的最重要的事情是“最终用户”，在一天结束的时候，没有用户的牵引，即使你构建了超级棒的应用程序，它也只是一个废物！</p><p id="1208" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">在本文中，我将解释如何构建您的DAPPs来使用内容提供者&amp;在幕后签署交易。因此，从用户的角度来看，这就像普通的应用程序，但他们实际上是在处理分散的应用程序。</p><p id="a857" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">功劳归于这个开发者:<a class="ae jz" href="https://github.com/cmaliwal/send-ether-with-web3" rel="noopener ugc nofollow" target="_blank">点击这里</a></p><p id="38a1" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated"><strong class="jd hu">先决条件</strong></p><ol class=""><li id="6428" class="ka kb ht jd b je jf ji jj jm kc jq kd ju ke jy kf kg kh ki dt translated">运行以太坊区块链的节点(对等方)。你可以自己设置，或者从Infura免费使用。https://infura.io/T4&amp;这是完全免费的开源软件。你所需要的是建立一个项目，并获得相应网络(testnet / mainnet)的API密钥。</li><li id="77bc" class="ka kb ht jd b je kj ji kk jm kl jq km ju kn jy kf kg kh ki dt translated">Web3</li><li id="48e6" class="ka kb ht jd b je kj ji kk jm kl jq km ju kn jy kf kg kh ki dt translated">以太网</li></ol><h2 id="49f0" class="ko kp ht bd kq kr ks kt ku kv kw kx ky jm kz la lb jq lc ld le ju lf lg lh li dt translated">步骤1)导入web3 &amp; ethereumjs-tx</h2><pre class="lj lk ll lm fq ln lo lp lq aw lr dt"><span id="e828" class="ko kp ht lo b fv ls lt l lu lv">const Web3 = require('web3');<br/>const EthereumTx = require('ethereumjs-tx')</span></pre><h2 id="3509" class="ko kp ht bd kq kr ks kt ku kv kw kx ky jm kz la lb jq lc ld le ju lf lg lh li dt translated">步骤2)设置你的Infura API并将其传递给parms-in fura &amp; http provider，这里我使用的是Ropsten Network</h2><pre class="lj lk ll lm fq ln lo lp lq aw lr dt"><span id="6d37" class="ko kp ht lo b fv ls lt l lu lv">const infura = `https://ropsten.infura.io/v3/${process.env.INFURA_API_KEY}`;</span><span id="51bc" class="ko kp ht lo b fv lw lt l lu lv">const web3 = new Web3(new Web3.providers.HttpProvider(infura));</span></pre><h2 id="8caa" class="ko kp ht bd kq kr ks kt ku kv kw kx ky jm kz la lb jq lc ld le ju lf lg lh li dt translated">步骤3)设置关键变量，如帐户地址、私钥、ABI、合同地址，以备后用。</h2><pre class="lj lk ll lm fq ln lo lp lq aw lr dt"><span id="6a4d" class="ko kp ht lo b fv ls lt l lu lv">web3.eth.defaultAccount = 'xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx';</span><span id="1285" class="ko kp ht lo b fv lw lt l lu lv">var abi = process.env.ABI;</span><span id="d766" class="ko kp ht lo b fv lw lt l lu lv">var pk  = process.env.PRIVATEKEY;  // private key of your account</span><span id="a9f5" class="ko kp ht lo b fv lw lt l lu lv">var toadd = process.env.WALLET_DESTINATION;</span><span id="997b" class="ko kp ht lo b fv lw lt l lu lv">var address = 'xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx'; //Contract Address</span></pre><h2 id="6d98" class="ko kp ht bd kq kr ks kt ku kv kw kx ky jm kz la lb jq lc ld le ju lf lg lh li dt translated">步骤4)获取合同地址的Nonce值，这将有助于避免RPC错误</h2><pre class="lj lk ll lm fq ln lo lp lq aw lr dt"><span id="ec17" class="ko kp ht lo b fv ls lt l lu lv">web3.eth.getTransactionCount(web3.eth.defaultAccount, function (err, nonce) {</span><span id="aa33" class="ko kp ht lo b fv lw lt l lu lv">console.log(“nonce value is “, nonce);</span><span id="faa6" class="ko kp ht lo b fv lw lt l lu lv">const contract = new web3.eth.Contract(JSON.parse(abi), address, {</span><span id="6c5d" class="ko kp ht lo b fv lw lt l lu lv">from: web3.eth.defaultAccount ,</span><span id="51e2" class="ko kp ht lo b fv lw lt l lu lv">gas: 3000000,</span><span id="a885" class="ko kp ht lo b fv lw lt l lu lv">})</span></pre><h2 id="45f9" class="ko kp ht bd kq kr ks kt ku kv kw kx ky jm kz la lb jq lc ld le ju lf lg lh li dt translated">步骤5)设置函数ABI，这个变量基本上是从智能合约中调用您的函数。</h2><pre class="lj lk ll lm fq ln lo lp lq aw lr dt"><span id="90e4" class="ko kp ht lo b fv ls lt l lu lv">const functionAbi = contract.methods.mymethodname(args).encodeABI();</span></pre><p id="4634" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">这里-&gt; args表示方法需要的参数数量..因此，如果你有一个以上的参数，那么用“逗号”隔开</p><p id="deb6" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">mymethodname -&gt;在智能协定中表示您的方法名</p><h2 id="bf3c" class="ko kp ht bd kq kr ks kt ku kv kw kx ky jm kz la lb jq lc ld le ju lf lg lh li dt translated">步骤6)设置选项/详细信息以签署您的交易</h2><pre class="lj lk ll lm fq ln lo lp lq aw lr dt"><span id="9207" class="ko kp ht lo b fv ls lt l lu lv">var details = {</span><span id="4066" class="ko kp ht lo b fv lw lt l lu lv">"nonce": nonce,</span><span id="b5c6" class="ko kp ht lo b fv lw lt l lu lv">"gasPrice": web3.utils.toHex(web3.utils.toWei('47', 'gwei')),</span><span id="2eaa" class="ko kp ht lo b fv lw lt l lu lv">"gas": 300000,</span><span id="33eb" class="ko kp ht lo b fv lw lt l lu lv">"to": address,</span><span id="609f" class="ko kp ht lo b fv lw lt l lu lv">"value": 0,</span><span id="62d6" class="ko kp ht lo b fv lw lt l lu lv">"data": functionAbi,</span><span id="beae" class="ko kp ht lo b fv lw lt l lu lv">};</span></pre><p id="b2ba" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">这里，“47”是汽油价格。我建议你从加油站把它拉出来，这样它是自动的&amp;设置当天的价格。</p><p id="0436" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">“收件人”-&gt;您可以将其设置为合同地址或“其他钱包账户”。</p><p id="4aa1" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">“gas”-&gt;“gas limit”，您可以使用“estimateGas”方法再次将其设置为拉。目前，它是硬编码的</p><h2 id="7578" class="ko kp ht bd kq kr ks kt ku kv kw kx ky jm kz la lb jq lc ld le ju lf lg lh li dt translated">步骤7)调用EthereumTx并传递详细信息以创建事务对象</h2><pre class="lj lk ll lm fq ln lo lp lq aw lr dt"><span id="6196" class="ko kp ht lo b fv ls lt l lu lv">const transaction = new EthereumTx(details);</span></pre><h2 id="7258" class="ko kp ht bd kq kr ks kt ku kv kw kx ky jm kz la lb jq lc ld le ju lf lg lh li dt translated">步骤8)使用“发送者”帐户的私钥签署交易</h2><pre class="lj lk ll lm fq ln lo lp lq aw lr dt"><span id="7a2e" class="ko kp ht lo b fv ls lt l lu lv">transaction.sign(Buffer.from(pk, ‘hex’))</span></pre><h2 id="cee5" class="ko kp ht bd kq kr ks kt ku kv kw kx ky jm kz la lb jq lc ld le ju lf lg lh li dt translated">第9步)序列化值并将其转换成要传递的原始数据</h2><pre class="lj lk ll lm fq ln lo lp lq aw lr dt"><span id="f1c3" class="ko kp ht lo b fv ls lt l lu lv">var rawdata = ‘0x’ + transaction.serialize().toString(‘hex’);</span></pre><h2 id="513a" class="ko kp ht bd kq kr ks kt ku kv kw kx ky jm kz la lb jq lc ld le ju lf lg lh li dt translated">步骤10)最后调用sendSignedTransaction到区块链，如下所示。</h2><pre class="lj lk ll lm fq ln lo lp lq aw lr dt"><span id="f324" class="ko kp ht lo b fv ls lt l lu lv">web3.eth.sendSignedTransaction(raw)</span><span id="3644" class="ko kp ht lo b fv lw lt l lu lv">.on(‘transactionHash’, function(hash){</span><span id="0181" class="ko kp ht lo b fv lw lt l lu lv">    console.log([‘transferToStaging Trx Hash:’ + hash]);</span><span id="ee39" class="ko kp ht lo b fv lw lt l lu lv">})</span><span id="e214" class="ko kp ht lo b fv lw lt l lu lv">.on(‘receipt’, function(receipt){</span><span id="1ee9" class="ko kp ht lo b fv lw lt l lu lv">    console.log([‘transferToStaging Receipt:’, receipt]);</span><span id="a854" class="ko kp ht lo b fv lw lt l lu lv">})</span><span id="027e" class="ko kp ht lo b fv lw lt l lu lv">.on(‘error’, console.error);</span></pre><p id="76ca" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">现在，您可以在不调用元掩码的情况下调用事务了！一切都在幕后进行。用户现在不需要安装/设置元掩码插件。</p><p id="51a5" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">注意:当用户只想使用所提供的服务，并且交易仅由一个使用发送者私钥的帐户签名时，此示例有效。</p><p id="63fb" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">如果你想用各自用户的私钥签署每一笔交易，那就不一样了。</p><p id="76f3" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">检查下面的完整代码</p><pre class="lj lk ll lm fq ln lo lp lq aw lr dt"><span id="ec53" class="ko kp ht lo b fv ls lt l lu lv">instantiateContract = (args) =&gt;{</span><span id="27c8" class="ko kp ht lo b fv lw lt l lu lv">const infura = `https://ropsten.infura.io/v3/${process.env.INFURA_API_KEY}`;</span><span id="c4ac" class="ko kp ht lo b fv lw lt l lu lv">const web3 = new Web3(new Web3.providers.HttpProvider(infura));</span><span id="8a8c" class="ko kp ht lo b fv lw lt l lu lv">web3.eth.defaultAccount = process.env.ACCOUNT_ADDRESS;</span><span id="2e0a" class="ko kp ht lo b fv lw lt l lu lv">var abi = process.env.ABI;</span><span id="d28e" class="ko kp ht lo b fv lw lt l lu lv">var pk  = process.env.PRIVATEKEY;  // private key of your account</span><span id="0bc7" class="ko kp ht lo b fv lw lt l lu lv">var toadd = process.env.WALLET_DESTINATION;</span><span id="d60c" class="ko kp ht lo b fv lw lt l lu lv">var address = 'xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx'; //Contract Address</span><span id="dc18" class="ko kp ht lo b fv lw lt l lu lv">web3.eth.getTransactionCount(web3.eth.defaultAccount, function (err, nonce) {</span><span id="2647" class="ko kp ht lo b fv lw lt l lu lv">console.log(“nonce value is “, nonce);</span><span id="74d9" class="ko kp ht lo b fv lw lt l lu lv">const contract = new web3.eth.Contract(JSON.parse(abi), address, {</span><span id="fac3" class="ko kp ht lo b fv lw lt l lu lv">from: web3.eth.defaultAccount ,</span><span id="9c83" class="ko kp ht lo b fv lw lt l lu lv">gas: 3000000,</span><span id="36ca" class="ko kp ht lo b fv lw lt l lu lv">})</span><span id="514f" class="ko kp ht lo b fv lw lt l lu lv">const functionAbi = contract.methods.mymethodname(args).encodeABI();</span><span id="714f" class="ko kp ht lo b fv lw lt l lu lv">var details = {</span><span id="444a" class="ko kp ht lo b fv lw lt l lu lv">“nonce”: nonce,</span><span id="26fc" class="ko kp ht lo b fv lw lt l lu lv">“gasPrice”: web3.utils.toHex(web3.utils.toWei('47', ‘gwei’)),</span><span id="bfc5" class="ko kp ht lo b fv lw lt l lu lv">“gas”: 300000,</span><span id="878f" class="ko kp ht lo b fv lw lt l lu lv">“to”: address,</span><span id="84d7" class="ko kp ht lo b fv lw lt l lu lv">“value”: 0,</span><span id="9221" class="ko kp ht lo b fv lw lt l lu lv">“data”: functionAbi,</span><span id="ba68" class="ko kp ht lo b fv lw lt l lu lv">};</span><span id="0b2d" class="ko kp ht lo b fv lw lt l lu lv">const transaction = new EthereumTx(details);</span><span id="5152" class="ko kp ht lo b fv lw lt l lu lv">transaction.sign(Buffer.from(pk, ‘hex’) )</span><span id="08b9" class="ko kp ht lo b fv lw lt l lu lv">var rawData = ‘0x’ + transaction.serialize().toString(‘hex’);</span><span id="daef" class="ko kp ht lo b fv lw lt l lu lv">web3.eth.sendSignedTransaction(rawData)</span><span id="5e5a" class="ko kp ht lo b fv lw lt l lu lv">.on(‘transactionHash’, function(hash){</span><span id="e82e" class="ko kp ht lo b fv lw lt l lu lv">console.log([‘transferToStaging Trx Hash:’ + hash]);</span><span id="dadc" class="ko kp ht lo b fv lw lt l lu lv">})</span><span id="8f1b" class="ko kp ht lo b fv lw lt l lu lv">.on(‘receipt’, function(receipt){</span><span id="bd31" class="ko kp ht lo b fv lw lt l lu lv">console.log([‘transferToStaging Receipt:’, receipt]);</span><span id="ebfe" class="ko kp ht lo b fv lw lt l lu lv">})</span><span id="bb7b" class="ko kp ht lo b fv lw lt l lu lv">.on(‘error’, console.error);</span><span id="fe24" class="ko kp ht lo b fv lw lt l lu lv">});</span><span id="d255" class="ko kp ht lo b fv lw lt l lu lv">}</span></pre><p id="d5f1" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">注:喜欢这篇文章？给Logeswaran竖起大拇指(鼓掌)并在Linkedin上关注他</p><p id="eec3" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">如果你有其他方法让DAPPs更加用户友好，请在下面评论..</p><p id="5168" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">如果您需要任何帮助来成功设置，请联系我。</p><blockquote class="lx"><p id="880c" class="ly lz ht bd ma mb mc md me mf mg jy ek translated"><a class="ae jz" href="https://coincodecap.com/?utm_source=coinmonks" rel="noopener ugc nofollow" target="_blank">在您的收件箱中直接获得最佳软件交易</a></p></blockquote><figure class="mi mj mk ml mm iu fe ff paragraph-image"><a href="https://coincodecap.com/?utm_source=coinmonks"><div class="fe ff mh"><img src="../Images/7c0b3dfdcbfea594cc0ae7d4f9bf6fcb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1168/format:webp/0*OJ-qb5G6i863msBB.png"/></div></a></figure></div></div>    
</body>
</html>