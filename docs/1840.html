<html>
<head>
<title>My Attempt to build a GoFundMe version on the Ethereum Blockchain part 1</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">我在以太坊区块链上构建GoFundMe版本的尝试第1部分</h1>
<blockquote>原文：<a href="https://medium.com/coinmonks/my-attempt-to-build-a-gofundme-version-on-the-ethereum-blockchain-part-1-501024653138?source=collection_archive---------5-----------------------#2018-11-30">https://medium.com/coinmonks/my-attempt-to-build-a-gofundme-version-on-the-ethereum-blockchain-part-1-501024653138?source=collection_archive---------5-----------------------#2018-11-30</a></blockquote><div><div class="ef hh hi hj hk hl"/><div class="hm hn ho hp hq"><div class=""/><p id="c881" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">几个月来，我一直在学习成为一名区块链开发者，感谢Reddit、Medium、GitHub、YouTube和Udemy上的一些免费资源，我现在可以自信地说，我不再是一名初学者，但绝对不是专家。还有更多需要学习的地方，尤其是这个领域正在快速变化。</p><p id="324d" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">区块链有许多使用案例，这是一个很好的案例，有些人可能会争论为什么我们需要一个Dapp来做这件事，所以为了便于讨论，这只是为了学习。构建Dapp有很多部分，但是编写可靠性契约是一个很好的起点。现在让我们进入合同。</p><figure class="jp jq jr js fq jt fe ff paragraph-image"><div role="button" tabindex="0" class="ju jv di jw bf jx"><div class="fe ff jo"><img src="../Images/43571e605fb6adf9af09ce057732cdfe.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*g7F0h_RiQbzOh7oh"/></div></div><figcaption class="ka kb fg fe ff kc kd bd b be z ek">Photo by <a class="ae ke" href="https://unsplash.com/@rawpixel?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">rawpixel</a> on <a class="ae ke" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="0a00" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">注意:这篇文章是针对初学者的，所以我将详细介绍智能合同逻辑</p><h2 id="d6b8" class="kf kg ht bd kh ki kj kk kl km kn ko kp jb kq kr ks jf kt ku kv jj kw kx ky kz dt translated"><strong class="ak">以下是合同中的公共变量</strong></h2><p id="cba5" class="pw-post-body-paragraph iq ir ht is b it la iv iw ix lb iz ja jb lc jd je jf ld jh ji jj le jl jm jn hm dt translated"><strong class="is hu">地址公开收件人；</strong></p><p id="688f" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated"><em class="lf">这是筹款人的地址。他们将是合同的签署者。</em></p><p id="c626" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated"><strong class="is hu">字符串公共描述；</strong></p><p id="e053" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">这是对资金用途的描述，所以我们可以在区块链的募捐活动中保留这些信息。</p><p id="d286" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated"><strong class="is hu">字符串公共名；</strong></p><p id="d368" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated"><em class="lf">试图筹款的人的名字。</em></p><p id="8ffc" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated"><strong class="is hu">字符串公共姓氏；</strong></p><p id="4f0b" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated"><em class="lf">筹款人姓名。</em></p><p id="8ac4" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">注意:我知道人们可以用任何名字创建基金，但身份验证不是本合同的重点</p><p id="1e53" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated"><strong class="is hu">uit公共金额需求；</strong></p><p id="2a03" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated"><em class="lf">这是魏</em>需要筹集的资金数额。</p><p id="f40e" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated"><strong class="is hu">mapping(address =&gt;uint)public donorsAmount；</strong></p><p id="f7d9" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated"><em class="lf">这将把每个捐赠者捐赠的钱数映射到捐赠者的地址</em></p><p id="81e1" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated"><strong class="is hu"> uint公共捐助者；</strong></p><p id="b1bf" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">这是为了记录合同中捐赠者的数量。前端应用的好帮手</p><p id="cda1" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated"><strong class="is hu">uint public amount sofar；</strong></p><p id="96f7" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated"><em class="lf">这将记录到目前为止筹款活动中捐赠的金额。该合同允许接收方，即合同创建者能够随时提取资金，因此我们需要一种方法来跟踪已经捐赠给该合同的资金，以了解我们何时达到目标。</em></p><p id="378a" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated"><strong class="is hu">捐赠【公众捐赠】；</strong></p><p id="2e2d" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">我们用它来跟踪所有对此合同的捐赠。这是一个struct对象，是前端应用程序的一个很好的帮助方法，但它并不是真正需要的，因为我们已经有了donorsAmount映射。</p><p id="422a" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated"><strong class="is hu"> Bool public正在进行= true</strong></p><p id="8c46" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">这有助于我们了解募捐活动是否仍在进行。开始时设置为true。</p><h2 id="2918" class="kf kg ht bd kh ki kj kk kl km kn ko kp jb kq kr ks jf kt ku kv jj kw kx ky kz dt translated">我们将需要一些事件，将广播到区块链时，一些重要的事情发生在我们的合同。</h2><p id="4ef9" class="pw-post-body-paragraph iq ir ht is b it la iv iw ix lb iz ja jb lc jd je jf ld jh ji jj le jl jm jn hm dt translated"><strong class="is hu"> event Contract_Created(地址索引_from，地址索引_contract，string)；</strong></p><p id="fce9" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated"><em class="lf">创建合同时的事件。显示业主地址、合同地址和募捐者描述</em></p><p id="11e8" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated"><strong class="is hu">活动资金_捐赠(地址索引_from，地址索引_contract，uint _ value)；</strong></p><p id="1db9" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">捐款时的事件。显示捐赠人地址、募捐者合同地址和捐赠价值</p><p id="740c" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated"><strong class="is hu">事件目标_达成(地址索引_from，地址索引_contract，uint _ value)；</strong></p><p id="d416" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated"><em class="lf">筹款目标达成时的事件。显示收款人地址、合同地址和金额</em></p><p id="7875" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated"><strong class="is hu">事件募捐_结束(地址索引_from，地址索引_contract，uint _ value)；</strong></p><p id="25de" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated"><em class="lf">收款人/合同所有人结束筹款活动的事件。显示业主地址、合同地址和筹集金额</em></p><p id="e524" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated"><strong class="is hu">event Fund _ extracted(address indexed _ from，address indexed _contract，uint _ value)；</strong></p><p id="2989" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated"><em class="lf">收款人从募集资金合同中提款的事件。显示业主地址、合同地址和提取金额</em></p><h2 id="7806" class="kf kg ht bd kh ki kj kk kl km kn ko kp jb kq kr ks jf kt ku kv jj kw kx ky kz dt translated">我们还需要一些修改，这将有助于我们在合同中的一些限制。</h2><figure class="jp jq jr js fq jt fe ff paragraph-image"><div class="fe ff lg"><img src="../Images/e7d1c7de34105fa521abef638c7ae3e8.png" data-original-src="https://miro.medium.com/v2/resize:fit:854/format:webp/1*VqWdVCjEDi8_A6xlZc8v_w.png"/></div></figure><p id="7fa2" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated"><em class="lf">受限修改量将只允许接收方(即合同创建者)调用合同中的某些功能。</em></p><p id="d3b9" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">当目标达到时，或者当接受者决定不管目标是否达到都要结束募捐时，isLive修饰符将帮助我们结束募捐。</p><p id="09ad" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">我想在目标达成后销毁合同，但这样做会删除合同的所有信息。这样，即使筹款活动结束了，我们仍然可以获得关于这份合同的信息。</p><figure class="jp jq jr js fq jt fe ff paragraph-image"><div class="fe ff lh"><img src="../Images/7843ce11c0719dae7ace55a2f9b05909.png" data-original-src="https://miro.medium.com/v2/resize:fit:888/format:webp/1*AINL9GAfqT0oMTVKVjWswg.png"/></div></figure><p id="cf6a" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">我们正在初始化合同。使用名、姓、描述、需求金额和收件人。然后我们发出一个事件Contract_created。</p><p id="bddb" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">现在我们可以开始处理函数了</p><figure class="jp jq jr js fq jt fe ff paragraph-image"><div class="fe ff li"><img src="../Images/04ec77442d8684f85b96daa1616ef2c4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1114/format:webp/1*yoymtOfgnVRlyQARkNco6w.png"/></div></figure><p id="325a" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated"><em class="lf">捐赠函数被设置为公共函数，因此任何人都可以捐赠，isLive修饰符用于检查筹款活动是否仍在进行，我们是否有应付款，这允许契约在被调用时接受资金。</em></p><p id="570d" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">所以在这个函数中，我们将发送者的地址映射到捐赠的金额。我们随着捐赠的数量增加。增加了一个捐赠者。我们创建了一个新的捐赠，我们还没有创建这个函数。我们还发布了“捐赠基金”事件。</p><p id="b687" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">我们还添加了当我们达到目标时将结束合同的逻辑，基本上，如果我们得到了所需的金额，我们应该调用私有函数_end()，我们稍后将创建它。</p><p id="e952" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated"><strong class="is hu">我们的下一个函数是_创建捐赠</strong></p><figure class="jp jq jr js fq jt fe ff paragraph-image"><div class="fe ff lj"><img src="../Images/d97ba32a3fae841d57854c0d02b2ce52.png" data-original-src="https://miro.medium.com/v2/resize:fit:866/format:webp/1*CyShZldw4OtIYAyx8_Fs4A.png"/></div></figure><p id="2c10" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated"><em class="lf">这是一个私有函数，它获取捐赠者的地址和捐赠的金额，创建一个新的捐赠，并将其添加到我们前面声明的捐赠数组中。每当有人向募捐者捐款时，它就会被调用。</em></p><p id="7ec7" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated"><strong class="is hu">下一个函数是withdraw()。</strong></p><figure class="jp jq jr js fq jt fe ff paragraph-image"><div class="fe ff lk"><img src="../Images/eb2a2f24c328b1f39c6fe621ed197400.png" data-original-src="https://miro.medium.com/v2/resize:fit:1024/format:webp/1*jK_OmsN-BlCkQ-cjsQ6rzw.png"/></div></figure><p id="c097" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated"><em class="lf">这个函数被设置为public，它是受限制的，所以只有接收者可以调用它，并检查筹款活动是否仍在进行——当筹款活动结束时，没有必要试图提取资金。因此，在这里，我们通过调用一个助手函数getBalance(我们将在后面创建)来获得契约的余额，并将其保存到一个名为balance的uint中。我们检查余额是否不为0，然后我们发出事件Fund _ retracted。最后，我们将合同的余额转移给接收方。</em></p><p id="fb91" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated"><strong class="is hu">让我们创建getBalance函数，非常简单</strong></p><figure class="jp jq jr js fq jt fe ff paragraph-image"><div class="fe ff ll"><img src="../Images/803def5121ffe1d7bcdc8dafb45903a3.png" data-original-src="https://miro.medium.com/v2/resize:fit:740/format:webp/1*RLeOXDS8b3AZR6m0-ffw0Q.png"/></div></figure><p id="5686" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated"><em class="lf">它是公共的，设置为查看，因为它没有修改任何数据，只是读取，我们也在检查筹款活动是否是实时的，我想这是没有必要的，所以你不必在这里使用它。我们只是返回一个包含余额的单元。</em></p><p id="8137" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated"><strong class="is hu">下一个函数是end() </strong></p><figure class="jp jq jr js fq jt fe ff paragraph-image"><div class="fe ff lm"><img src="../Images/9ce6b9fd678a2629d14b46492e70af92.png" data-original-src="https://miro.medium.com/v2/resize:fit:922/format:webp/1*5ocWojjzo-gZM52Zfnfb7g.png"/></div></figure><p id="09c3" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated"><em class="lf">这是一个受限制的公共功能，即只有接收者可以调用它，并且只能在运行时调用。当接收者出于某种原因决定结束募捐时，应该调用这个函数。首先，我们将正在进行的设置为false。随后发出事件Fundraiser_Ended。然后我们把合同的余额寄给收件人。</em></p><p id="b37a" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">我们还有另一个结束函数，但是这个函数是私有的，由契约调用。还记得前面在捐赠函数中我们调用_end()的时候吗？</p><figure class="jp jq jr js fq jt fe ff paragraph-image"><div class="fe ff ln"><img src="../Images/5e26ca3e4aded5e261a0c4bcc7b2e875.png" data-original-src="https://miro.medium.com/v2/resize:fit:980/format:webp/1*At3RD_nrkOwMT09kbBcWkQ.png"/></div></figure><p id="912f" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated"><em class="lf">这里的逻辑与另一个end函数相同，只是它是私有的，并发出事件Goal_Reached。</em></p><p id="ded4" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">完整智能合同的链接在这里</p><div class="lo lp fm fo lq lr"><a href="https://github.com/Gbenro/FundMe/blob/master/ethereum/contracts/fundme.sol" rel="noopener  ugc nofollow" target="_blank"><div class="ls ab ej"><div class="lt ab lu cl cj lv"><h2 class="bd hu fv z el lw eo ep lx er et hs dt translated">Gbenro/FundMe</h2><div class="ly l"><h3 class="bd b fv z el lw eo ep lx er et ek translated">以太坊区块链上的一个GoFundMe版本。通过在…上创建帐户，为Gbenro/FundMe的发展做出贡献</h3></div><div class="lz l"><p class="bd b gc z el lw eo ep lx er et ek translated">github.com</p></div></div><div class="ma l"><div class="mb l mc md me ma mf jy lr"/></div></div></a></div><p id="0928" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">所以，伙计们，这是我们的FundMe合同的结尾，是吗？</p><p id="b5f9" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">嗯，我们肯定可以做一些事情来增加我们合同的安全性，并做一些优化来节省汽油。但是现在这样很好。</p><p id="a492" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">我的下一篇文章将是关于编译和部署的，这样我们就可以用mocha进行一些测试。</p><p id="c34f" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">在以后的文章中，我会做一个智能合同审计，我们可以看看哪些地方可以改进。</p><p id="9dd1" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">这是第二部分的链接</p><figure class="jp jq jr js fq jt fe ff paragraph-image"><a href="http://bit.ly/2G71Sp7"><div class="fe ff mg"><img src="../Images/449450761cd76f44f9ae574333f9e9af.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fKX2mtg7p1lOs7JmosPLsA.png"/></div></a><figcaption class="ka kb fg fe ff kc kd bd b be z ek"><a class="ae ke" href="http://bit.ly/2G71Sp7" rel="noopener ugc nofollow" target="_blank"><strong class="bd mh">Click to read today’s top story</strong></a></figcaption></figure></div></div>    
</body>
</html>