<html>
<head>
<title>How to check the type of the contract in Solidity — ERC165 explained</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在Solidity中检查合同类型— ERC165解释</h1>
<blockquote>原文：<a href="https://medium.com/coinmonks/how-to-check-the-type-of-the-contract-in-solidity-erc165-explained-b1f4f880d66e?source=collection_archive---------4-----------------------#2021-11-28">https://medium.com/coinmonks/how-to-check-the-type-of-the-contract-in-solidity-erc165-explained-b1f4f880d66e?source=collection_archive---------4-----------------------#2021-11-28</a></blockquote><div><div class="ef hh hi hj hk hl"/><div class="hm hn ho hp hq"><div class=""/><figure class="fi fk ir is it iu fe ff paragraph-image"><div role="button" tabindex="0" class="iv iw di ix bf iy"><div class="fe ff iq"><img src="../Images/e4a9e377a3b388d8c697cb1837e8f31d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-1VD0SANNsqpwH6r2xOafg.jpeg"/></div></div></figure><p id="8637" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">坚固没有<code class="eh jz ka kb kc b">typeof</code>或<code class="eh jz ka kb kc b">isinstance</code>的概念。给定一个合同地址，你不能发现这是否是一个特定的合同。但是如果合同已经实现了<code class="eh jz ka kb kc b">ERC165</code>标准，就有办法做到这一点。</p><p id="0661" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated"><code class="eh jz ka kb kc b">ERC165</code>标准只有一种方法</p><pre class="kd ke kf kg fq kh kc ki kj aw kk dt"><span id="e33e" class="kl km ht kc b fv kn ko l kp kq"><strong class="kc hu">function</strong> supportsInterface(interfaceId) <strong class="kc hu">public</strong> <strong class="kc hu">view</strong> <strong class="kc hu">returns</strong> (<strong class="kc hu">bool</strong>);</span></pre><p id="3e00" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">该方法将接口id作为参数，并检查协定是否支持该接口。这是什么意思？Solidity有一个名为<code class="eh jz ka kb kc b">type</code>的内置方法，它返回接口的唯一id。您将在此处提供的接口属于您想要签入另一个协定的协定类型。</p><pre class="kd ke kf kg fq kh kc ki kj aw kk dt"><span id="a504" class="kl km ht kc b fv kn ko l kp kq"><strong class="kc hu">type</strong>(MyInterface).interfaceId</span></pre><p id="f035" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">OpenZepplin已经创建了一个名为<code class="eh jz ka kb kc b">ERC165Storage</code>的实用契约，它实现了<code class="eh jz ka kb kc b">ERC165</code>标准，并且有一个方法可以用来定义契约支持哪些接口。</p><pre class="kd ke kf kg fq kh kc ki kj aw kk dt"><span id="4210" class="kl km ht kc b fv kn ko l kp kq"><strong class="kc hu">function</strong> _registerInterface(<strong class="kc hu">bytes4</strong> interfaceId) <strong class="kc hu">internal</strong>;</span></pre><p id="074c" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">可以向该方法提供一个接口id，协定将保存该接口id。如果向同一个接口查询支持，它将返回true。</p><p id="ab3c" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">OpenZepplin已经创建了<code class="eh jz ka kb kc b">ERC165Checker</code>来调用某个地址上的<code class="eh jz ka kb kc b">supportsInterface</code>。</p><pre class="kd ke kf kg fq kh kc ki kj aw kk dt"><span id="1d11" class="kl km ht kc b fv kn ko l kp kq"><strong class="kc hu">function</strong> supportsInterface(<strong class="kc hu">address</strong> account, <strong class="kc hu">bytes4</strong> interfaceId) <strong class="kc hu">internal</strong> <strong class="kc hu">view</strong> <strong class="kc hu">returns</strong> (<strong class="kc hu">bool</strong>);</span></pre><p id="1583" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">这个方法在地址上调用<code class="eh jz ka kb kc b">supportsInterface</code>来检查地址是否支持给定的<code class="eh jz ka kb kc b">interfaceId</code>。</p><p id="f5c7" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">这个怎么用？当您想要检查给定地址是否属于特定合同时，这很有用。但是你应该事先知道给定的地址已经实现了<code class="eh jz ka kb kc b">ERC165</code>。这里有一个你将如何使用它的例子。</p><p id="3ba0" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">下面的契约继承了<code class="eh jz ka kb kc b">ERC165</code>并在构造函数中调用了<code class="eh jz ka kb kc b">_registerInterface</code>方法。</p><pre class="kd ke kf kg fq kh kc ki kj aw kk dt"><span id="b85d" class="kl km ht kc b fv kn ko l kp kq"><strong class="kc hu">contract</strong> Sum <strong class="kc hu">is</strong> ERC165Storage, ISum {</span><span id="af9c" class="kl km ht kc b fv kr ko l kp kq">	<strong class="kc hu">constructor</strong> {<br/>		_registerInterface(<strong class="kc hu">type</strong>(ISum).interfaceId);<br/>	}</span><span id="4c04" class="kl km ht kc b fv kr ko l kp kq">	<strong class="kc hu">function</strong> sum(<strong class="kc hu">uint256</strong> a, <strong class="kc hu">uint256</strong> b) <strong class="kc hu">public</strong> <strong class="kc hu">override</strong> <strong class="kc hu">returns</strong> (<strong class="kc hu">uint256</strong>) {<br/>		<strong class="kc hu">return</strong> a <strong class="kc hu">+</strong> b;<br/>	}</span><span id="445e" class="kl km ht kc b fv kr ko l kp kq">}</span></pre><p id="d2f6" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">下面的合同想要检查给定的地址是否属于特定的合同类型。</p><pre class="kd ke kf kg fq kh kc ki kj aw kk dt"><span id="0287" class="kl km ht kc b fv kn ko l kp kq"><strong class="kc hu">contract</strong> Checker <strong class="kc hu">is</strong> ERC165Checker {<br/>	<br/>    <strong class="kc hu">function</strong> sumOrZero(<strong class="kc hu">address</strong> _add, <strong class="kc hu">uint256</strong> a, <strong class="kc hu">uint256</strong> b) <strong class="kc hu">public</strong> <strong class="kc hu">view</strong> <strong class="kc hu">returns</strong> (<strong class="kc hu">uint256</strong>) {<br/>        <strong class="kc hu">uint256</strong> answer;<br/>	<strong class="kc hu">if</strong> (supportsInterface(_add, <strong class="kc hu">type</strong>(ISum).interfaceId){<br/>	    answer <strong class="kc hu">=</strong> ISum(_add).sum(a, b);<br/>	}<br/>	<strong class="kc hu">return</strong> answer;<br/>    }<br/>}</span></pre><p id="d322" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">当您想要限制可以提供给函数的契约类型时，这很有用。您希望允许的每个合同都需要实现<code class="eh jz ka kb kc b">ERC165</code>。</p><blockquote class="ks"><p id="293c" class="kt ku ht bd kv kw kx ky kz la lb jy ek translated">加入Coinmonks <a class="ae lc" href="https://t.me/coincodecap" rel="noopener ugc nofollow" target="_blank">电报频道</a>和<a class="ae lc" href="https://www.youtube.com/c/coinmonks/videos" rel="noopener ugc nofollow" target="_blank"> Youtube频道</a>了解加密交易和投资</p></blockquote></div></div>    
</body>
</html>