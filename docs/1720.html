<html>
<head>
<title>⚡Lightning network: how to explore the topology</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">⚡Lightning网络:如何探索拓扑</h1>
<blockquote>原文：<a href="https://medium.com/coinmonks/lightning-network-how-to-explore-the-topology-32f234f4287f?source=collection_archive---------5-----------------------#2018-10-28">https://medium.com/coinmonks/lightning-network-how-to-explore-the-topology-32f234f4287f?source=collection_archive---------5-----------------------#2018-10-28</a></blockquote><div><div class="ef hh hi hj hk hl"/><div class="hm hn ho hp hq"><div class=""/><h1 id="6439" class="iq ir ht bd is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn dt translated">从LND提取拓扑数据</h1><p id="ee8b" class="pw-post-body-paragraph jo jp ht jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl hm dt translated">在之前的故事中，我描述了我如何在家里安装了一个比特币闪电网络节点，在一个便宜的树莓Pi3上运行LND。</p><p id="b7b0" class="pw-post-body-paragraph jo jp ht jq b jr kn jt ju jv ko jx jy jz kp kb kc kd kq kf kg kh kr kj kk kl hm dt translated">lncli提供了一个有用的命令来导出网络拓扑。我们可以简单地运行:</p><pre class="ks kt ku kv fq kw kx ky kz aw la dt"><span id="af0f" class="lb ir ht kx b fv lc ld l le lf">$ lncli describegraph &gt; /tmp/describegraph.json</span></pre><p id="1f1a" class="pw-post-body-paragraph jo jp ht jq b jr kn jt ju jv ko jx jy jz kp kb kc kd kq kf kg kh kr kj kk kl hm dt translated">以获得包含从当前lnd节点看到的闪电网络拓扑的json。</p><p id="ecc1" class="pw-post-body-paragraph jo jp ht jq b jr kn jt ju jv ko jx jy jz kp kb kc kd kq kf kg kh kr kj kk kl hm dt translated">describegraph.json的格式非常简单，不言自明:</p><pre class="ks kt ku kv fq kw kx ky kz aw la dt"><span id="7611" class="lb ir ht kx b fv lc ld l le lf">{<br/>    "nodes": [<br/>        {<br/>            "last_update": 1539310922,<br/>            "pub_key": "02004c625d622245606a1ea2c1c69cfb4516b703b47945a3647713c05fe4aaeb1c",<br/>            "alias": "LivingRoomOfSatoshi.com (LND) 2",<br/>            "addresses": [<br/>                {<br/>                    "network": "tcp",<br/>                    "addr": "172.81.178.151:9735"<br/>                }<br/>            ],<br/>            "color": "#3399ff"<br/>        },<br/> ...<br/> ...<br/> ],<br/> "edges": [<br/>        {<br/>            "channel_id": "595923207643922432",<br/>            "chan_point": "dd0d25aadec1ff27a7215834bb3660cb2d0c5c030f3a8a27096e243313648ae2:0",<br/>            "last_update": 1540314360,<br/>            "node1_pub": "02cdf83ef8e45908b1092125d25c68dcec7751ca8d39f557775cd842e5bc127469",<br/>            "node2_pub": "032c4b954f0f171b694b5e8e8323589e54196b48cf2efc27692513a360cb11d76f",<br/>            "capacity": "500000",<br/>            "node1_policy": {<br/>                "time_lock_delta": 144,<br/>                "min_htlc": "1000",<br/>                "fee_base_msat": "1000",<br/>                "fee_rate_milli_msat": "1",<br/>                "disabled": false<br/>            },<br/>            "node2_policy": {<br/>                "time_lock_delta": 144,<br/>                "min_htlc": "1000",<br/>                "fee_base_msat": "1000",<br/>                "fee_rate_milli_msat": "1",<br/>                "disabled": false<br/>            }<br/>        },<br/>...<br/>...<br/>      ]<br/>}</span></pre><p id="8a64" class="pw-post-body-paragraph jo jp ht jq b jr kn jt ju jv ko jx jy jz kp kb kc kd kq kf kg kh kr kj kk kl hm dt translated">然后，我们可以快速计算节点和通道的数量:</p><pre class="ks kt ku kv fq kw kx ky kz aw la dt"><span id="db60" class="lb ir ht kx b fv lc ld l le lf">$ cat /tmp/describegraph.json | grep “pub_key” | wc -l<br/>877</span><span id="8da8" class="lb ir ht kx b fv lg ld l le lf">$ cat /tmp/describegraph.json | grep “channel_id” | wc -l<br/>2796</span></pre><h1 id="275d" class="iq ir ht bd is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn dt translated">在Neo4j中导入拓扑数据</h1><h2 id="1e36" class="lb ir ht bd is lh li lj iw lk ll lm ja jz ln lo je kd lp lq ji kh lr ls jm lt dt translated">安装<strong class="ak"> Neo4jDesktop </strong></h2><p id="f910" class="pw-post-body-paragraph jo jp ht jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl hm dt translated">在探索网络拓扑时，什么比图形数据库更好？让我们从<a class="ae km" href="https://neo4j.com/product/" rel="noopener ugc nofollow" target="_blank">https://neo4j.com/product/</a>下载<strong class="jq hu"> Neo4jDesktop </strong>并旋转数据库以导入我们的describegraph.json</p><p id="6e1d" class="pw-post-body-paragraph jo jp ht jq b jr kn jt ju jv ko jx jy jz kp kb kc kd kq kf kg kh kr kj kk kl hm dt translated">我们现在可以在Neo4jDesktop中创建新图形，只需点击<strong class="jq hu">添加图形→创建本地图形</strong>，设置图形名称和密码，然后点击<strong class="jq hu">创建</strong>。</p><p id="550c" class="pw-post-body-paragraph jo jp ht jq b jr kn jt ju jv ko jx jy jz kp kb kc kd kq kf kg kh kr kj kk kl hm dt translated">然后我们需要在Neo4j桌面安装<strong class="jq hu"> APOC </strong>库(“Cypher上的牛逼程序”):进入<strong class="jq hu">管理</strong>屏幕和<strong class="jq hu">插件</strong>标签。现在点击APOC盒中的<strong class="jq hu">安装</strong>按钮就完成了。</p><p id="7c20" class="pw-post-body-paragraph jo jp ht jq b jr kn jt ju jv ko jx jy jz kp kb kc kd kq kf kg kh kr kj kk kl hm dt translated">因为我们需要导入一个本地文件，所以我们需要更改默认配置:转到<strong class="jq hu">管理</strong>屏幕和<strong class="jq hu">设置</strong>选项卡并添加这一行:</p><pre class="ks kt ku kv fq kw kx ky kz aw la dt"><span id="a25f" class="lb ir ht kx b fv lc ld l le lf">apoc.import.file.enabled=true </span></pre><p id="dfbf" class="pw-post-body-paragraph jo jp ht jq b jr kn jt ju jv ko jx jy jz kp kb kc kd kq kf kg kh kr kj kk kl hm dt translated">现在点击<strong class="jq hu">打开浏览器</strong>，准备开始或探索闪电网络。</p><h2 id="1cf1" class="lb ir ht bd is lh li lj iw lk ll lm ja jz ln lo je kd lp lq ji kh lr ls jm lt dt translated">导入网络数据</h2><p id="8fc4" class="pw-post-body-paragraph jo jp ht jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl hm dt translated">现在是时候将describegraph文件导入我们的图形数据库了。我们可以使用APOC库提供的过程<code class="eh lu lv lw kx b">load.json</code>来加载json文件，然后遍历边，为我们在列表中找到的每个边创建2个<code class="eh lu lv lw kx b">Node</code>对象，通过关系<code class="eh lu lv lw kx b">LINKED</code>连接。然后我们可以向每个节点对象添加一个字段<code class="eh lu lv lw kx b">alias</code>，以便更好地识别它们。</p><pre class="ks kt ku kv fq kw kx ky kz aw la dt"><span id="2e17" class="lb ir ht kx b fv lc ld l le lf">CALL apoc.load.json(“file:///full/path/to/describegraph.json”) YIELD value AS data<br/>UNWIND data.edges as edge<br/>MERGE (n1:Node {id:edge.node1_pub} )<br/>MERGE (n2:Node {id:edge.node2_pub} )<br/>CREATE (n1)-[:LINKED {capacity:edge.capacity}]-&gt;(n2)</span><span id="4a9c" class="lb ir ht kx b fv lg ld l le lf">CALL apoc.load.json(“file:///full/path/to/describegraph.json”) YIELD value AS data<br/>UNWIND data.nodes as node<br/>MERGE (n:Node {id:node.pub_key} )<br/>SET n.alias = node.alias</span></pre><p id="8646" class="pw-post-body-paragraph jo jp ht jq b jr kn jt ju jv ko jx jy jz kp kb kc kd kq kf kg kh kr kj kk kl hm dt translated">最后，我们可以在字段<code class="eh lu lv lw kx b">alias</code>上添加一个索引来加快查询速度。</p><pre class="ks kt ku kv fq kw kx ky kz aw la dt"><span id="6f6b" class="lb ir ht kx b fv lc ld l le lf">CREATE INDEX ON :Node(alias)</span></pre><h1 id="9f6b" class="iq ir ht bd is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn dt translated">探索拓扑</h1><p id="9753" class="pw-post-body-paragraph jo jp ht jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl hm dt translated">我们现在准备使用Neo4j强大的查询引擎来发现一些关于网络的有趣事实。</p><h2 id="bc60" class="lb ir ht bd is lh li lj iw lk ll lm ja jz ln lo je kd lp lq ji kh lr ls jm lt dt translated">节点和通道的数量</h2><p id="4d43" class="pw-post-body-paragraph jo jp ht jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl hm dt translated">首先，我们来看看我们知道多少节点和通道。这是一个简单的查询，我们需要计算所有的<code class="eh lu lv lw kx b">Nodes</code>对象，然后计算图中出现的所有关系<code class="eh lu lv lw kx b">LINKED</code>:</p><pre class="ks kt ku kv fq kw kx ky kz aw la dt"><span id="bb89" class="lb ir ht kx b fv lc ld l le lf">MATCH (n:Node) RETURN COUNT(*)</span><span id="e284" class="lb ir ht kx b fv lg ld l le lf">COUNT(*) 877</span><span id="942a" class="lb ir ht kx b fv lg ld l le lf">MATCH (n)-[r:LINKED]-&gt;() RETURN COUNT(r)</span><span id="ab77" class="lb ir ht kx b fv lg ld l le lf">COUNT(r)2796</span></pre><p id="234a" class="pw-post-body-paragraph jo jp ht jq b jr kn jt ju jv ko jx jy jz kp kb kc kd kq kf kg kh kr kj kk kl hm dt translated">通过这些查询获得的数字与我们之前直接在<code class="eh lu lv lw kx b">describegraph.json</code>文件上执行的“grep”中获得的数字相匹配，我们可以非常确信导入过程运行顺利。</p><p id="4b5c" class="pw-post-body-paragraph jo jp ht jq b jr kn jt ju jv ko jx jy jz kp kb kc kd kq kf kg kh kr kj kk kl hm dt translated">根据https://1ml.com/,<a class="ae km" href="https://1ml.com/" rel="noopener ugc nofollow" target="_blank">的说法</a>目前我们在闪电网络中有超过3000个节点和超过12000个通道。因此，即使在运行了近6周后，我的节点对网络中存在的节点和通道的了解还不到1/3和1/4。</p><p id="c3e8" class="pw-post-body-paragraph jo jp ht jq b jr kn jt ju jv ko jx jy jz kp kb kc kd kq kf kg kh kr kj kk kl hm dt translated">这并不奇怪:<strong class="jq hu">网状路由是计算机科学中尚未解决的问题</strong>。</p><h2 id="11ae" class="lb ir ht bd is lh li lj iw lk ll lm ja jz ln lo je kd lp lq ji kh lr ls jm lt dt translated">最长最短路径</h2><p id="bae0" class="pw-post-body-paragraph jo jp ht jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl hm dt translated">网络中最长的最短路径被定义为节点之间的最大距离或网络直径。Neo4j是一个面向图形的数据库，所以它提供了一个现成的<code class="eh lu lv lw kx b">shortestpath</code>函数。我们可以很容易地找到所有最短的路径，并得到最长的路径:</p><pre class="ks kt ku kv fq kw kx ky kz aw la dt"><span id="a7f2" class="lb ir ht kx b fv lc ld l le lf">MATCH (n1:Node), (n2:Node), route = shortestpath((n1)-[:LINKED*]-(n2))<br/>WHERE id(n1) &lt; id(n2)<br/>RETURN route<br/>ORDER BY LENGTH(route) DESC<br/>LIMIT 1</span></pre><figure class="ks kt ku kv fq ly fe ff paragraph-image"><div role="button" tabindex="0" class="lz ma di mb bf mc"><div class="fe ff lx"><img src="../Images/b1f3181f1dee9667c2bcf8d34edc0d92.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*T6-C6W9LHG2ppdhwqIzxEA.png"/></div></div><figcaption class="mf mg fg fe ff mh mi bd b be z ek">The longest shortest path, according to the topology of the Lightning network as seen from my node.</figcaption></figure><p id="ce61" class="pw-post-body-paragraph jo jp ht jq b jr kn jt ju jv ko jx jy jz kp kb kc kd kq kf kg kh kr kj kk kl hm dt translated">所以，根据我对网络的看法，最远的节点在8跳之外。</p><h2 id="ed11" class="lb ir ht bd is lh li lj iw lk ll lm ja jz ln lo je kd lp lq ji kh lr ls jm lt dt translated">最远的节点</h2><p id="98ff" class="pw-post-body-paragraph jo jp ht jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl hm dt translated">我们还可以从一个给定的节点中找到距离最远的节点，例如，这里是距离我家节点最远的5个节点，别名为<strong class="jq hu"> SLL </strong>。</p><pre class="ks kt ku kv fq kw kx ky kz aw la dt"><span id="2eac" class="lb ir ht kx b fv lc ld l le lf">MATCH (n1:Node), (n2:Node),<br/> route = shortestpath((n1)-[:LINKED*]-(n2))<br/>WHERE id(n1) &lt; id(n2) AND n1.alias = 'SLL'<br/>RETURN route<br/>ORDER BY LENGTH(route) DESC<br/>LIMIT 5</span></pre><figure class="ks kt ku kv fq ly fe ff paragraph-image"><div role="button" tabindex="0" class="lz ma di mb bf mc"><div class="fe ff mj"><img src="../Images/9309e051830e08e51451b8c4ee970e98.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*85Vws8gC_jtBtzJUx8REMg.png"/></div></div><figcaption class="mf mg fg fe ff mh mi bd b be z ek">The shortest paths to the 5 most distant nodes from mine</figcaption></figure><h2 id="b777" class="lb ir ht bd is lh li lj iw lk ll lm ja jz ln lo je kd lp lq ji kh lr ls jm lt dt translated">十大枢纽</h2><p id="e525" class="pw-post-body-paragraph jo jp ht jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl hm dt translated">让我们找到直接连接节点最多的节点(不是通道……)</p><pre class="ks kt ku kv fq kw kx ky kz aw la dt"><span id="fa0f" class="lb ir ht kx b fv lc ld l le lf">MATCH (n1:Node)-[:LINKED]-(n2:Node)<br/>RETURN n2.alias, SIZE(COLLECT(n1)) as connected<br/>ORDER BY connected DESC<br/>LIMIT 10</span></pre><figure class="ks kt ku kv fq ly fe ff paragraph-image"><div role="button" tabindex="0" class="lz ma di mb bf mc"><div class="fe ff mk"><img src="../Images/f3b64a63dd369aa02d81a3a13daeab89.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*t_1-3HS3kqhD9YZpzd0QKA.png"/></div></div></figure><p id="a26c" class="pw-post-body-paragraph jo jp ht jq b jr kn jt ju jv ko jx jy jz kp kb kc kd kq kf kg kh kr kj kk kl hm dt translated">获胜者是节点<strong class="jq hu"> tady je slushovo </strong>，有169个节点直接链接。</p><h2 id="f493" class="lb ir ht bd is lh li lj iw lk ll lm ja jz ln lo je kd lp lq ji kh lr ls jm lt dt translated">三角形计数</h2><p id="fbba" class="pw-post-body-paragraph jo jp ht jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl hm dt translated">我们可以运行的一个有趣的查询是每个节点所属的三角形的计数:</p><pre class="ks kt ku kv fq kw kx ky kz aw la dt"><span id="44c6" class="lb ir ht kx b fv lc ld l le lf">CALL algo.triangleCount.stream(‘Node’,’LINKED’,{concurrency:4})<br/>YIELD nodeId, triangles, coefficient<br/>RETURN algo.getNodeById(nodeId).alias AS alias, triangles, coefficient<br/>ORDER BY triangles DESC</span></pre><figure class="ks kt ku kv fq ly fe ff paragraph-image"><div role="button" tabindex="0" class="lz ma di mb bf mc"><div class="fe ff ml"><img src="../Images/a9e5fbaf1585122f8c75a2f26d6b4aaf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Oz215GSNuMYSALV7WAwGPQ.png"/></div></div></figure><p id="8692" class="pw-post-body-paragraph jo jp ht jq b jr kn jt ju jv ko jx jy jz kp kb kc kd kq kf kg kh kr kj kk kl hm dt translated"><strong class="jq hu">聚类系数</strong>是其邻居也连通的可能性。你可以在维基百科页面<a class="ae km" href="https://en.wikipedia.org/wiki/Clustering_coefficient" rel="noopener ugc nofollow" target="_blank">https://en.wikipedia.org/wiki/Clustering_coefficient</a>找到更多细节，但简单来说:如果连接到节点a的每个邻居都连接到该邻居内的每个其他节点，则节点a的聚类系数为1，如果没有连接到该节点的节点连接到与其连接的任何其他节点，则聚类系数为0。</p><p id="3ac3" class="pw-post-body-paragraph jo jp ht jq b jr kn jt ju jv ko jx jy jz kp kb kc kd kq kf kg kh kr kj kk kl hm dt translated">按三角形数量排列的前10个节点似乎具有小于10%的局部聚类系数</p><p id="b4ec" class="pw-post-body-paragraph jo jp ht jq b jr kn jt ju jv ko jx jy jz kp kb kc kd kq kf kg kh kr kj kk kl hm dt translated">在完美的tia中</p><p id="417c" class="pw-post-body-paragraph jo jp ht jq b jr kn jt ju jv ko jx jy jz kp kb kc kd kq kf kg kh kr kj kk kl hm dt translated">我们还可以计算网络<strong class="jq hu">的平均聚类系数。</strong></p><pre class="ks kt ku kv fq kw kx ky kz aw la dt"><span id="f35c" class="lb ir ht kx b fv lc ld l le lf">CALL algo.triangleCount(‘Node’, ‘LINKED’,<br/> {concurrency:4, write:true, writeProperty:’triangles’,clusteringCoefficientProperty:’coefficient’})<br/>YIELD nodeCount, triangleCount, averageClusteringCoefficient;</span></pre><figure class="ks kt ku kv fq ly fe ff paragraph-image"><div role="button" tabindex="0" class="lz ma di mb bf mc"><div class="fe ff mm"><img src="../Images/fb268907cce10b6e2357eaa54bc629de.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4CSVYB-VXfSttzVdSCvGjQ.png"/></div></div></figure><p id="f311" class="pw-post-body-paragraph jo jp ht jq b jr kn jt ju jv ko jx jy jz kp kb kc kd kq kf kg kh kr kj kk kl hm dt translated">所以，我的节点知道网络中总共有877个节点，在2045个三角形中网格化，局部聚集系数的平均值约为0.123。</p><h1 id="f270" class="iq ir ht bd is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn dt translated">结论</h1><p id="ba81" class="pw-post-body-paragraph jo jp ht jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl hm dt translated">我希望您在发现闪电网络拓扑的一些有趣事实时感到有趣。</p><p id="662f" class="pw-post-body-paragraph jo jp ht jq b jr kn jt ju jv ko jx jy jz kp kb kc kd kq kf kg kh kr kj kk kl hm dt translated">请随意建议运行更多有趣的查询:)</p></div><div class="ab cl mn mo hb mp" role="separator"><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms"/></div><div class="hm hn ho hp hq"><pre class="ks kt ku kv fq kw kx ky kz aw la dt"><span id="74d0" class="lb ir ht kx b fv lc ld l le lf"><em class="mu">Feel free to connect my Lightning Network node:<br/>&gt;$ lncli connect </em>039401f72bc0d40efb58b01de15527a2a5ae1943d7c29067b725a1467a93c7e66f@2.238.144.76:9735</span></pre><blockquote class="mv"><p id="47e2" class="mw mx ht bd my mz na nb nc nd ne kl ek translated">阅读下一篇:<a class="ae km" rel="noopener" href="/coinmonks/why-lightning-network-makes-no-sense-39ca172f50d1?source=your_stories_page---------------------------">为什么⚡Lightning Network⚡毫无意义😱</a></p><p id="13b4" class="mw mx ht bd my mz nf ng nh ni nj kl ek translated"><a class="ae km" href="https://coincodecap.com/?utm_source=coinmonks" rel="noopener ugc nofollow" target="_blank">在您的收件箱中直接获得最佳软件交易</a></p></blockquote><figure class="nl nm nn no np ly fe ff paragraph-image"><a href="https://coincodecap.com/?utm_source=coinmonks"><div class="fe ff nk"><img src="../Images/7c0b3dfdcbfea594cc0ae7d4f9bf6fcb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1168/format:webp/0*OJ-qb5G6i863msBB.png"/></div></a></figure></div></div>    
</body>
</html>