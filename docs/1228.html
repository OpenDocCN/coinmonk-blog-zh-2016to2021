<html>
<head>
<title>How to Make a Survey with an EOS Smart Contract (2)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何使用EOS智能合同进行调查(2)</h1>
<blockquote>原文：<a href="https://medium.com/coinmonks/how-to-make-a-survey-with-a-smart-contract-2-b1fe0d83a358?source=collection_archive---------8-----------------------#2018-08-03">https://medium.com/coinmonks/how-to-make-a-survey-with-a-smart-contract-2-b1fe0d83a358?source=collection_archive---------8-----------------------#2018-08-03</a></blockquote><div><div class="ef hh hi hj hk hl"/><div class="hm hn ho hp hq"><div class=""/><div class=""><h2 id="dd07" class="pw-subtitle-paragraph iq hs ht bd b ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ek translated">使用智能合同进行抽样调查。</h2></div><figure class="jj jk jl jm fq jn fe ff paragraph-image"><div role="button" tabindex="0" class="jo jp di jq bf jr"><div class="fe ff ji"><img src="../Images/21c938a108d372867e1b53fd52fd7537.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KNa-6I77jfVpIIVkUrXibA.png"/></div></div></figure><p id="fd08" class="pw-post-body-paragraph ju jv ht jw b jx jy iu jz ka kb ix kc kd ke kf kg kh ki kj kk kl km kn ko kp hm dt translated">继续如何做调查(1)，我将从解释第三部分开始。</p><p id="f511" class="pw-post-body-paragraph ju jv ht jw b jx jy iu jz ka kb ix kc kd ke kf kg kh ki kj kk kl km kn ko kp hm dt translated">配置存储第三个结果的表。</p><pre class="jj jk jl jm fq kq kr ks kt aw ku dt"><span id="f59b" class="kv kw ht kr b fv kx ky l kz la">/// <a class="ae lb" href="http://twitter.com/abi" rel="noopener ugc nofollow" target="_blank">@abi</a> table surveyresult i64<br/>    struct surveyresult<br/>    {<br/>      account_name owner;<br/>      uint64_t no1count;<br/>      uint64_t no2count;<br/>      uint64_t no3count;<br/>      uint64_t no4count;</span><span id="e9de" class="kv kw ht kr b fv lc ky l kz la">uint64_t primary_key() const {return owner;}</span><span id="498a" class="kv kw ht kr b fv lc ky l kz la">EOSLIB_SERIALIZE(surveycon,(owner)(no1count)(no2count)(no3count)(no4count))<br/>    };<br/>    typedef multi_index&lt;N(surveyresult),surveyresult&gt; _result;</span></pre><p id="09e4" class="pw-post-body-paragraph ju jv ht jw b jx jy iu jz ka kb ix kc kd ke kf kg kh ki kj kk kl km kn ko kp hm dt translated">根据设置为主键的所有者，声明一个表，其中调查的第1个累积响应数为第1个计数，其余按第2个计数、第3个计数、第4个计数的顺序排列。</p><p id="bd48" class="pw-post-body-paragraph ju jv ht jw b jx jy iu jz ka kb ix kc kd ke kf kg kh ki kj kk kl km kn ko kp hm dt translated">现在，添加现有的添加操作功能，以便在用户调用添加操作时修改结果表。</p><pre class="jj jk jl jm fq kq kr ks kt aw ku dt"><span id="8bda" class="kv kw ht kr b fv kx ky l kz la">auto iter=result.find(_self);<br/>      if(iter!=result.end())<br/>      {<br/>        result.modify(iter,_self,[&amp;](auto&amp; surveyresult)<br/>        {<br/>          surveyresult.no1count = (selnum==1)?iter-&gt;no1count+1:iter-&gt;no1count;<br/>          surveyresult.no2count = (selnum==2)?iter-&gt;no2count+1:iter-&gt;no2count;<br/>          surveyresult.no3count = (selnum==3)?iter-&gt;no3count+1:iter-&gt;no3count;<br/>          surveyresult.no4count = (selnum==4)?iter-&gt;no4count+1:iter-&gt;no4count;<br/>        });<br/>      }<br/>      else<br/>      {<br/>        result.emplace(_self,[&amp;](auto&amp; surveyresult)<br/>        {<br/>          surveyresult.owner = _self;<br/>          surveyresult.no1count = (selnum==1)?1:0;<br/>          surveyresult.no2count = (selnum==2)?1:0;<br/>          surveyresult.no3count = (selnum==3)?1:0;<br/>          surveyresult.no4count = (selnum==4)?1:0;<br/>        });<br/>      }</span></pre><p id="cc5d" class="pw-post-body-paragraph ju jv ht jw b jx jy iu jz ka kb ix kc kd ke kf kg kh ki kj kk kl km kn ko kp hm dt translated">在现有add action函数的返回之上编写源代码的添加；。源代码可能看起来很多，但是如果没有结果表，那么就放置。如果有结果表，那么修改。在放置的情况下，根据selnum将初始值初始化为1或0，sel num是选定的响应方。在修改的情况下，根据selnum加1修改现有值，sel num是选择的responder。</p><p id="8f5b" class="pw-post-body-paragraph ju jv ht jw b jx jy iu jz ka kb ix kc kd ke kf kg kh ki kj kk kl km kn ko kp hm dt translated">最后，查看结果的操作。这个动作并不是必需的，因为在真实情况下，我们可以直接从eos.js或rpc通信中查看结果表。</p><pre class="jj jk jl jm fq kq kr ks kt aw ku dt"><span id="b887" class="kv kw ht kr b fv kx ky l kz la">void result()<br/>    {<br/>      _result result(_self,_self);<br/>      uint64_t no1;<br/>      uint64_t no2;<br/>      uint64_t no3;<br/>      uint64_t no4;</span><span id="c5c4" class="kv kw ht kr b fv lc ky l kz la">auto iter=result.find(_self);<br/>      if(iter!=result.end())<br/>      {<br/>        no1=iter-&gt;no1count;<br/>        no2=iter-&gt;no2count;<br/>        no3=iter-&gt;no3count;<br/>        no4=iter-&gt;no4count;<br/>      }<br/>      print("no1 : ",no1," no2 : ",no2," no3 : ",no3," no4 : ",no4);</span><span id="ec4e" class="kv kw ht kr b fv lc ky l kz la">return;<br/>    }</span></pre><p id="a35c" class="pw-post-body-paragraph ju jv ht jw b jx jy iu jz ka kb ix kc kd ke kf kg kh ki kj kk kl km kn ko kp hm dt translated">调用结果表的数据并打印。这个动作没有任何异常。</p><p id="2807" class="pw-post-body-paragraph ju jv ht jw b jx jy iu jz ka kb ix kc kd ke kf kg kh ki kj kk kl km kn ko kp hm dt translated">现在编译并部署源代码进行测试。文章末尾附有完整的源代码。因为这篇文章的源代码不检查表的重复数据，所以建议按顺序进行。为了解决测试期间的数据问题，我们添加了一个delall操作来删除所有表的信息，你可以在帖子底部的整个源代码中看到这一点。</p><p id="3207" class="pw-post-body-paragraph ju jv ht jw b jx jy iu jz ka kb ix kc kd ke kf kg kh ki kj kk kl km kn ko kp hm dt translated">首先，写调查报告。</p><figure class="jj jk jl jm fq jn fe ff paragraph-image"><div role="button" tabindex="0" class="jo jp di jq bf jr"><div class="fe ff ld"><img src="../Images/e439561c211437fa7e08c3b7e9eb3728.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Vlba2Qthiz5RA2OYukiybQ.png"/></div></div></figure><p id="5d8d" class="pw-post-body-paragraph ju jv ht jw b jx jy iu jz ka kb ix kc kd ke kf kg kh ki kj kk kl km kn ko kp hm dt translated">该调查已注册。我已经检查了surveycon表以确认数据。</p><p id="89d5" class="pw-post-body-paragraph ju jv ht jw b jx jy iu jz ka kb ix kc kd ke kf kg kh ki kj kk kl km kn ko kp hm dt translated">在用户1的许可下，选择数字4。</p><figure class="jj jk jl jm fq jn fe ff paragraph-image"><div role="button" tabindex="0" class="jo jp di jq bf jr"><div class="fe ff ld"><img src="../Images/da95377fc188cb9ac941aa1ceba02c8b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*oIqYUag6xv-o6Xoyutp-sQ.png"/></div></div></figure><p id="177f" class="pw-post-body-paragraph ju jv ht jw b jx jy iu jz ka kb ix kc kd ke kf kg kh ki kj kk kl km kn ko kp hm dt translated">如果您选择了重复的帐户，或者帐户不是指定给操作的帐户，将会出现错误。</p><p id="ba10" class="pw-post-body-paragraph ju jv ht jw b jx jy iu jz ka kb ix kc kd ke kf kg kh ki kj kk kl km kn ko kp hm dt translated">在用户2的许可下，选择数字4。</p><figure class="jj jk jl jm fq jn fe ff paragraph-image"><div role="button" tabindex="0" class="jo jp di jq bf jr"><div class="fe ff ld"><img src="../Images/d9cc0a4ecc75f1ea4efb1417959dd29f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GSOPr4tGnTmBIRb5LWjhmw.png"/></div></div></figure><p id="5573" class="pw-post-body-paragraph ju jv ht jw b jx jy iu jz ka kb ix kc kd ke kf kg kh ki kj kk kl km kn ko kp hm dt translated">选择之后，我检查了surveydetail表，以检查为每个客户选择了什么。</p><p id="4f89" class="pw-post-body-paragraph ju jv ht jw b jx jy iu jz ka kb ix kc kd ke kf kg kh ki kj kk kl km kn ko kp hm dt translated">最后打印结果。</p><figure class="jj jk jl jm fq jn fe ff paragraph-image"><div role="button" tabindex="0" class="jo jp di jq bf jr"><div class="fe ff le"><img src="../Images/8cc58e12d0a836cdca0140120fc6ba20.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pog0fTTRsnNCCHS7_NP0Qw.png"/></div></div></figure><p id="d68a" class="pw-post-body-paragraph ju jv ht jw b jx jy iu jz ka kb ix kc kd ke kf kg kh ki kj kk kl km kn ko kp hm dt translated">我已经搜索了surveyresult表来检查打印结果。</p><p id="fb1a" class="pw-post-body-paragraph ju jv ht jw b jx jy iu jz ka kb ix kc kd ke kf kg kh ki kj kk kl km kn ko kp hm dt translated">下面是带有delall操作的完整源代码，它从表中删除信息以使测试更容易。</p><figure class="jj jk jl jm fq jn"><div class="bz el l di"><div class="lf lg l"/></div></figure><p id="a8d3" class="pw-post-body-paragraph ju jv ht jw b jx jy iu jz ka kb ix kc kd ke kf kg kh ki kj kk kl km kn ko kp hm dt translated">这篇文章的源代码不应该用于实际用途，因为它是作为一个例子，因此为了使代码更容易理解，许多代码被省略和简化了。实际的代码应该在安全性、成本和速度方面进行适当的设计和实现。感谢您的关注。</p></div><div class="ab cl lh li hb lj" role="separator"><span class="lk bw bk ll lm ln"/><span class="lk bw bk ll lm ln"/><span class="lk bw bk ll lm"/></div><div class="hm hn ho hp hq"><h2 id="8925" class="kv kw ht bd lo lp lq lr ls lt lu lv lw kd lx ly lz kh ma mb mc kl md me mf mg dt translated">ITAM游戏是一个透明的游戏生态系统的区块链平台</h2><p id="5d69" class="pw-post-body-paragraph ju jv ht jw b jx mh iu jz ka mi ix kc kd mj kf kg kh mk kj kk kl ml kn ko kp hm dt translated">订阅ITAM游戏并接收最新信息。</p><p id="4717" class="pw-post-body-paragraph ju jv ht jw b jx jy iu jz ka kb ix kc kd ke kf kg kh ki kj kk kl km kn ko kp hm dt translated">访问ITAM游戏电讯，就ITAM游戏和区块链进行交流。点击下面的链接加入！👫</p><p id="9423" class="pw-post-body-paragraph ju jv ht jw b jx jy iu jz ka kb ix kc kd ke kf kg kh ki kj kk kl km kn ko kp hm dt translated">网址:<strong class="jw hu"/><a class="ae lb" href="https://itam.games" rel="noopener ugc nofollow" target="_blank">https://itam . games</a><strong class="jw hu"><br/></strong>电报:<a class="ae lb" href="https://t.me/itamgames" rel="noopener ugc nofollow" target="_blank">https://t.me/itamgames</a></p></div></div>    
</body>
</html>