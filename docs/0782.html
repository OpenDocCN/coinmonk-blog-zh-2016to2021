<html>
<head>
<title>Set up IPFS node on the server</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在服务器上设置IPFS节点</h1>
<blockquote>原文：<a href="https://medium.com/coinmonks/set-up-ipfs-node-on-the-server-20e111b434d6?source=collection_archive---------2-----------------------#2018-06-17">https://medium.com/coinmonks/set-up-ipfs-node-on-the-server-20e111b434d6?source=collection_archive---------2-----------------------#2018-06-17</a></blockquote><div><div class="ef hh hi hj hk hl"/><div class="hm hn ho hp hq"><div class=""/><figure class="fi fk ir is it iu fe ff paragraph-image"><div role="button" tabindex="0" class="iv iw di ix bf iy"><div class="fe ff iq"><img src="../Images/e1dbb52e9ce1327c54dcfad562b09810.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*09K53ye7pG-Cnuy3Me17jg.png"/></div></div></figure><p id="62ce" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">IPFS(星际文件系统)是建立对等网络的协议，基于资源的内容而不是像HTTP中那样基于物理位置来寻址资源。IPFS给了我们一些区块链的保证，比如分散化和不可更改的存储，而价格只是你必须支付的交易费的一小部分。参与IPFS网络是免费的。</p><p id="b2e4" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">了解IPFS的关键是，一旦你添加了文件，网络就不会存储它们。将文件添加到IPFS不会将它们上传到任何地方，而只是意味着您将它们添加到您在节点上托管的本地存储库中。除非其他对等方有兴趣在他们的节点上托管您的内容，否则一旦您关闭您的节点，您添加的文件将无法为其他人所用，直到您重新联机。缓存机制缓解了这个问题，因为对获取内容感兴趣的对等点会将内容保存在缓存中。积极的垃圾收集器会快速移除未使用的文件。您不应该依赖缓存来保持文件在线。</p><p id="ed4b" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">为了可靠地与其他对等方共享文件并使用IPFS来托管网页等，您需要设置一台服务器，而不依赖于您的个人设备连接。</p><h1 id="78a2" class="jz ka ht bd kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw dt translated">安装和设置IPFS</h1><p id="4db5" class="pw-post-body-paragraph jb jc ht jd b je kx jg jh ji ky jk jl jm kz jo jp jq la js jt ju lb jw jx jy hm dt translated">我将使用AWS EC2使用默认的VPC在Amazon Linux 2上启动我的服务器。t2.micro实例在免费层不会花费您一分钱，对于IPFS节点和一些web服务来说已经足够好了。</p><p id="a67a" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">安装戈朗和IPFS。</p><pre class="lc ld le lf fq lg lh li lj aw lk dt"><span id="e119" class="ll ka ht lh b fv lm ln l lo lp">$ yum update -y<br/>$ yum install -y golang<br/><br/>$ wget https://dist.ipfs.io/go-ipfs/v0.4.15/go-ipfs_v0.4.15_linux-amd64.tar.gz</span><span id="3c31" class="ll ka ht lh b fv lq ln l lo lp">$ tar -xvf go-ipfs_v0.4.15_linux-amd64.tar.gz<br/>./go-ipfs/install</span></pre><p id="ebe9" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">如果安装失败，您可以手动将可执行文件移动到您的bin路径。</p><pre class="lc ld le lf fq lg lh li lj aw lk dt"><span id="a714" class="ll ka ht lh b fv lm ln l lo lp">$ mv ./go-ipfs/ipfs /usr/local/bin</span></pre><p id="3f43" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">初始化本地IPFS配置并添加您的第一个文件。</p><pre class="lc ld le lf fq lg lh li lj aw lk dt"><span id="855b" class="ll ka ht lh b fv lm ln l lo lp">&gt; ipfs init<br/>echo "&lt;h1&gt;Michal&lt;/h1&gt;" &gt; index.html</span><span id="ca58" class="ll ka ht lh b fv lq ln l lo lp">&gt; ipfs add index.html<br/>added Qma1PYYMwbgR3GBscmBV7Zx8YgWdhBUAY6z27TznhrBet9 index.html</span><span id="3cbc" class="ll ka ht lh b fv lq ln l lo lp">&gt; ipfs cat Qma1PYYMwbgR3GBscmBV7Zx8YgWdhBUAY6z27TznhrBet9<br/>&lt;h1&gt;Michal&lt;/h1&gt;</span></pre><p id="1385" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">恭喜你！您刚刚向IPFS存储库中添加了一个文件。虽然您可以获取它，但它只能在本地工作。要加入网络，您应该运行IPFS守护进程。</p><p id="1b97" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">如果你的防火墙没有阻止连接，那么你应该能够从远程节点获取你的文件或者使用像<code class="eh lr ls lt lh b"><a class="ae lu" href="https://ipfs.io/ipfs/." rel="noopener ugc nofollow" target="_blank">https://ipfs.io/ipfs/</a></code> <a class="ae lu" href="https://ipfs.io/ipfs/." rel="noopener ugc nofollow" target="_blank">这样的公共网关。</a></p><h1 id="4729" class="jz ka ht bd kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw dt translated">启动时运行IPFS守护程序</h1><p id="ef3e" class="pw-post-body-paragraph jb jc ht jd b je kx jg jh ji ky jk jl jm kz jo jp jq la js jt ju lb jw jx jy hm dt translated">最好将IPFS守护进程作为服务启动，而不是终端附加进程。让我们定义一个负责运行IPFS守护进程服务的简单单元文件。</p><pre class="lc ld le lf fq lg lh li lj aw lk dt"><span id="6a7d" class="ll ka ht lh b fv lm ln l lo lp">$ vi /etc/systemd/system/ipfs.service</span></pre><p id="b74a" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">复制和粘贴单位文件定义。</p><pre class="lc ld le lf fq lg lh li lj aw lk dt"><span id="dcd1" class="ll ka ht lh b fv lm ln l lo lp">[Unit]<br/>Description=IPFS Daemon<br/>After=syslog.target network.target remote-fs.target nss-lookup.target<br/><br/>[Service]<br/>Type=simple<br/>ExecStart=/usr/local/bin/ipfs daemon --enable-namesys-pubsub<br/>User=ec2-user<br/><br/>[Install]<br/>WantedBy=multi-user.target</span></pre><p id="6c24" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">使用<code class="eh lr ls lt lh b">--enable-namesys-pubsub</code>运行守护进程受益于几乎即时的IPNS更新。IPNS是IPFS命名系统，允许可变的网址。编辑单元文件后，重新加载守护程序，使服务能够在引导时启动，并启动服务。</p><pre class="lc ld le lf fq lg lh li lj aw lk dt"><span id="07c1" class="ll ka ht lh b fv lm ln l lo lp">sudo systemctl daemon-reload<br/>sudo systemctl enable ipfs<br/>sudo systemctl start ipfs</span></pre><p id="1acb" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">现在，您可以重新启动您的实例，并确保IPFS是否已恢复运行。</p><pre class="lc ld le lf fq lg lh li lj aw lk dt"><span id="197d" class="ll ka ht lh b fv lm ln l lo lp">sudo systemctl status ipfs</span></pre><h1 id="b319" class="jz ka ht bd kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw dt translated">使网关可公开访问</h1><p id="1391" class="pw-post-body-paragraph jb jc ht jd b je kx jg jh ji ky jk jl jm kz jo jp jq la js jt ju lb jw jx jy hm dt translated">如果您愿意，可以公开访问您的IPFS网关。更改网关配置以侦听所有可用的IP地址。</p><p id="7b75" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">在<code class="eh lr ls lt lh b">~/.ipfs/config</code>改变</p><pre class="lc ld le lf fq lg lh li lj aw lk dt"><span id="2a6a" class="ll ka ht lh b fv lm ln l lo lp">"Gateway": "/ip4/127.0.0.1/tcp/8080"</span></pre><p id="bfb0" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">到</p><pre class="lc ld le lf fq lg lh li lj aw lk dt"><span id="bfea" class="ll ka ht lh b fv lm ln l lo lp">"Gateway": "/ip4/0.0.0.0/tcp/8080"</span></pre><h1 id="6132" class="jz ka ht bd kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw dt translated">结论</h1><p id="5e7b" class="pw-post-body-paragraph jb jc ht jd b je kx jg jh ji ky jk jl jm kz jo jp jq la js jt ju lb jw jx jy hm dt translated">我在EC2上运行IPFS节点已经有一段时间了，我没有遇到任何大的问题。您可以使用<code class="eh lr ls lt lh b">scp</code>通过ssh将文件复制到您的远程服务器。对于编程访问，您可以使您的IPFS网关可写，并使用<a class="ae lu" href="https://ipfs.io/docs/api/" rel="noopener ugc nofollow" target="_blank"> IPFS HTTP API </a>。IPFS有很多有创意的用例！</p></div><div class="ab cl lv lw hb lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="hm hn ho hp hq"><p id="a094" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated"><em class="mc">原载于2018年6月17日</em><a class="ae lu" href="https://michalzalecki.com/set-up-ipfs-node-on-the-server/" rel="noopener ugc nofollow" target="_blank"><em class="mc">michalzalecki.com</em></a><em class="mc">。</em></p></div></div>    
</body>
</html>