<html>
<head>
<title>RSK: Bitcoin smart contracts (EN)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">RSK:比特币智能合约(EN)</h1>
<blockquote>原文：<a href="https://medium.com/coinmonks/rsk-bitcoin-smart-contracts-en-5b474ce87cd6?source=collection_archive---------6-----------------------#2018-07-04">https://medium.com/coinmonks/rsk-bitcoin-smart-contracts-en-5b474ce87cd6?source=collection_archive---------6-----------------------#2018-07-04</a></blockquote><div><div class="ef hh hi hj hk hl"/><div class="hm hn ho hp hq"><div class=""/><p id="af9b" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">比特币允许智能合约。智能合约的一些例子是multisig wallet和HTLC(两者都被闪电网络使用)。比特币的杀手级应用是数字货币。因此，它的语言(脚本)是有限的(<a class="ae jo" href="https://en.wikipedia.org/wiki/Turing_completeness" rel="noopener ugc nofollow" target="_blank">图灵不完整的</a>)和更安全的，因为它允许在他们的合同上出现编程错误的可能性更小。</p><p id="d0a8" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">由于认为需要一个专注于作为构建去中心化应用程序(除了仅用于金融交易之外)的平台的区块链，Vitalik Buterin创建了以太坊平台。</p><figure class="jp jq jr js fq jt fe ff paragraph-image"><div class="ab fr cl ju"><img src="../Images/11a738fbb15ce35bbb51f27adbe1442b.png" data-original-src="https://miro.medium.com/v2/format:webp/1*y-YEiv4A0yxQYANf22Em3A.png"/></div></figure><p id="9748" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">根茎是一个对比特币的生态系统执行智能合约(图灵完成)的项目。这是一个侧链，使用SBTC(智能BTC)作为货币，可与比特币(双向挂钩)1: 1兑换。这种货币之间的转换是通过RSK联盟完成的，该联盟主要由受尊敬的社区成员组成(例如:Xapo、Bitpay、Jaxx、BitGo、OKCoin、Zeppelin等)。</p><p id="c2aa" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">每当有BTC转移到RSK网络时，这些BTC会卡在联盟钱包中，相同数量的SBTCs会转移到您的RSK钱包中(反之亦然)。</p><p id="bff8" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">该解决方案的一个有趣的特点是，它与以太坊虚拟机(EVM)兼容，其合同也是用Solidity编写的。</p><p id="b664" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">RSK主网已经开始运行，但暂时不对预先批准的参与者(白名单)开放。<br/>在本帖中，我们将运行一个RSK测试网络节点，执行智能合同部署并进行一些交易。</p><p id="821f" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated"><strong class="is hu"> <em class="jx">观察:</em> </strong> <em class="jx">我用的是全新的Ubuntu 16.04 (Xenial)安装。</em></p><pre class="jp jq jr js fq jy jz ka kb aw kc dt"><span id="fcb3" class="kd ke ht jz b fv kf kg l kh ki">$ sudo add-apt-repository ppa:rsksmart/rskj<br/>$ sudo apt-get update<br/>$ sudo apt-get install rskj</span></pre><p id="851a" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">确保为testnet网络配置了您的节点。链接/etc/rsk/node.conf应该指向/etc/rsk/testnet.conf文件。</p><pre class="jp jq jr js fq jy jz ka kb aw kc dt"><span id="6c2e" class="kd ke ht jz b fv kf kg l kh ki">$ ls /etc/rsk/node.conf -l<br/>lrwxrwxrwx 1 root root 21 Jul 3 17:57 /etc/rsk/node.conf -&gt; /etc/rsk/testnet.conf</span></pre><p id="a99d" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">要运行RSK节点，请使用:</p><pre class="jp jq jr js fq jy jz ka kb aw kc dt"><span id="492d" class="kd ke ht jz b fv kf kg l kh ki">$ sudo service rsk start</span></pre><p id="7bb7" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">节点正在同步，现在安装<a class="ae jo" href="https://github.com/rsksmart/utilities" rel="noopener ugc nofollow" target="_blank"> rsk-utilities </a>项目。它将允许访问节点抛出控制台。如果你没有，安装NPM和NodeJs，因为两者都是必要的。</p><pre class="jp jq jr js fq jy jz ka kb aw kc dt"><span id="b408" class="kd ke ht jz b fv kf kg l kh ki">$ sudo apt-get install npm<br/>$ curl -sL https://deb.nodesource.com/setup_8.x | sudo -E bash -<br/>$ sudo apt-get install -y nodejs</span><span id="c0a3" class="kd ke ht jz b fv kj kg l kh ki">$ mkdir ~/rsk-utils<br/>$ cd ~/srk-utils<br/>$ wget <a class="ae jo" href="https://github.com/rsksmart/utilities/archive/master.zip" rel="noopener ugc nofollow" target="_blank">https://github.com/rsksmart/utilities/archive/master.zip</a><br/>$ unzip master.zip<br/>$ cd utilities-master/console<br/>$ npm install</span></pre><p id="cab7" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">现在使用控制台访问节点:</p><pre class="jp jq jr js fq jy jz ka kb aw kc dt"><span id="4757" class="kd ke ht jz b fv kf kg l kh ki">$ node ~/rsk-utils/utilities-master/console/console.js<br/>RSK &gt; web3.eth.syncing<br/><strong class="jz hu">{ startingBlock: 0, currentBlock: 48527, highestBlock: 52416 }</strong></span></pre><p id="4010" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">Console.js是一个使用以太坊web3.js的包装器，所以RSK控制台非常类似于以太坊客户端的控制台(例如geth)。</p><p id="e92b" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">现在，您应该等待节点同步。要检查最后一个程序块，使用<a class="ae jo" href="https://explorer.testnet.rsk.co" rel="noopener ugc nofollow" target="_blank"> rsk testnet explorer </a>。</p><p id="16e9" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">当区块链更新时，命令<strong class="is hu"> web3.eth.syncing </strong>将返回false，命令<strong class="is hu"> web3.eth.blockNumber </strong>将返回与explorer中的最新块相同的块。</p><p id="f317" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">使用最新的节点，创建两个帐户，以便在它们之间进行交易。</p><pre class="jp jq jr js fq jy jz ka kb aw kc dt"><span id="2ccf" class="kd ke ht jz b fv kf kg l kh ki"><strong class="jz hu">$ java -cp /usr/share/rsk/rsk.jar co.rsk.GenNodeKeyId</strong><br/>{<br/> "privateKey": "1ec575c11c227059b6c438f22773261f5876cdea60e83b607467e68ee1f2e6ff",<br/> "publicKey": "0490894e27b5663954aa5f595417ac6ea447a577f7ec58534c789fefb1d2920e995ca366912887a6fcfdd9694d94743d6eb7d6355c14aa5f70c534ef31628e2737",<br/> "publicKeyCompressed": "0390894e27b5663954aa5f595417ac6ea447a577f7ec58534c789fefb1d2920e99",<br/> "address": "54aaa49f761dc048df63e81378054bcad2604230",<br/> "nodeId": "90894e27b5663954aa5f595417ac6ea447a577f7ec58534c789fefb1d2920e995ca366912887a6fcfdd9694d94743d6eb7d6355c14aa5f70c534ef31628e2737"<br/>}<br/><strong class="jz hu">$ java -cp /usr/share/rsk/rsk.jar co.rsk.GenNodeKeyId</strong><br/>{<br/> "privateKey": "3489806ce2af94a6c227fe35de457242fc92f71a211b0b966970fab8d191d9cc",<br/> "publicKey": "0412e7a4d0420f636ff114414395a77c157a6116fab9887488b6e40ee6cd5551df4d48fb7ae44e705c13a3bb7d102039a79427dcd31ec77a0553e3d712ba7d396b",<br/> "publicKeyCompressed": "0312e7a4d0420f636ff114414395a77c157a6116fab9887488b6e40ee6cd5551df",<br/> "address": "9c46863dda60dd78aa628330347167caf0ba0dfc",<br/> "nodeId": "12e7a4d0420f636ff114414395a77c157a6116fab9887488b6e40ee6cd5551df4d48fb7ae44e705c13a3bb7d102039a79427dcd31ec77a0553e3d712ba7d396b"<br/>}</span></pre><p id="2317" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">现在，您需要在RSK配置文件中添加帐户，并启用节点的wallet功能，默认情况下该功能是禁用的。在配置文件(/etc/rsk/node.conf)中查找wallet部分，并添加以下行:</p><pre class="jp jq jr js fq jy jz ka kb aw kc dt"><span id="2031" class="kd ke ht jz b fv kf kg l kh ki">$ sudo vi /etc/rsk/node.conf</span><span id="6b4a" class="kd ke ht jz b fv kj kg l kh ki">wallet {<br/> <strong class="jz hu">enabled = true</strong><br/> accounts = [<br/> <strong class="jz hu">{<br/> privateKey = "1ec575c11c227059b6c438f22773261f5876cdea60e83b607467e68ee1f2e6ff",<br/> publicKey = "0490894e27b5663954aa5f595417ac6ea447a577f7ec58534c789fefb1d2920e995ca366912887a6fcfdd9694d94743d6eb7d6355c14aa5f70c534ef31628e2737",<br/> address = "54aaa49f761dc048df63e81378054bcad2604230"<br/> },<br/> {<br/> privateKey = "3489806ce2af94a6c227fe35de457242fc92f71a211b0b966970fab8d191d9cc",<br/> publicKey = "0412e7a4d0420f636ff114414395a77c157a6116fab9887488b6e40ee6cd5551df4d48fb7ae44e705c13a3bb7d102039a79427dcd31ec77a0553e3d712ba7d396b",<br/> address = "9c46863dda60dd78aa628330347167caf0ba0dfc"</strong></span><span id="4895" class="kd ke ht jz b fv kj kg l kh ki"><strong class="jz hu">}</strong><br/>    ]<br/>}</span><span id="1011" class="kd ke ht jz b fv kj kg l kh ki">$ sudo service rsk restart</span></pre><p id="6f11" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">现在，您将需要一些智能BTC来测试转让和智能合同。我们可以通过该项目为testnet提供的<a class="ae jo" href="https://faucet.testnet.rsk.co" rel="noopener ugc nofollow" target="_blank">水龙头</a>得到它们。</p><p id="610f" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">几秒钟后，您的账户将会有余额:</p><pre class="jp jq jr js fq jy jz ka kb aw kc dt"><span id="4e3a" class="kd ke ht jz b fv kf kg l kh ki">RSK &gt; web3.fromWei(web3.eth.getBalance(web3.eth.accounts[0]), 'ether').toString();<br/><strong class="jz hu">0.001</strong></span></pre><p id="26df" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">现在，在账户之间进行交易:</p><pre class="jp jq jr js fq jy jz ka kb aw kc dt"><span id="e6d0" class="kd ke ht jz b fv kf kg l kh ki">RSK &gt; web3.eth.sendTransaction({from: web3.eth.accounts[0], to: web3.eth.accounts[1], value: web3.toWei('0.0001','ether')});<br/><strong class="jz hu">0xffc7aac1d83d3ffd1c516e62058bd48cc3df530e24ee216c6474850d2e4f91d1</strong></span></pre><p id="ccb3" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">检查余额:</p><pre class="jp jq jr js fq jy jz ka kb aw kc dt"><span id="a024" class="kd ke ht jz b fv kf kg l kh ki">RSK &gt; ana = web3.eth.accounts[0];<br/><strong class="jz hu">0x54aaa49f761dc048df63e81378054bcad2604230</strong><br/>RSK &gt; bob = web3.eth.accounts[1];<br/>0x9c46863dda60dd78aa628330347167caf0ba0dfc<br/>RSK &gt; web3.fromWei(web3.eth.getBalance(ana), 'ether').toString();<br/><strong class="jz hu">0.0009</strong><br/>RSK &gt; web3.fromWei(web3.eth.getBalance(bob), 'ether').toString();<br/><strong class="jz hu">0.0001</strong></span></pre><p id="d475" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">用<a class="ae jo" rel="noopener" href="/@marcelomorgado/openzeppelin-biblioteca-solidity-9416f3f629f5"> OpenZeppelin </a>库创建一个<a class="ae jo" rel="noopener" href="/@marcelomorgado/utilizando-truffle-para-desenvolvimento-de-smart-contracts-deb7332ee201">松露</a>项目:</p><pre class="jp jq jr js fq jy jz ka kb aw kc dt"><span id="618d" class="kd ke ht jz b fv kf kg l kh ki">$ mkdir ~/rsk_erc20<br/>$ cd ~/rsk_erc20<br/>$ truffle init<br/>$ vi truffle.js</span><span id="4997" class="kd ke ht jz b fv kj kg l kh ki">module.exports = {<br/>  networks: {<br/>    rsk: {<br/>      from: "<strong class="jz hu">0x54aaa49f761dc048df63e81378054bcad2604230</strong>",<br/>      gasPrice: 1,<br/>      gas: <!-- -->6732000,<br/>      host: "localhost",<br/>      port: 4444,<br/>      network_id: "*" // Match any network id<br/>    }<br/>  }<br/>};</span><span id="3403" class="kd ke ht jz b fv kj kg l kh ki">$ npm init -y<br/>$ npm install -E openzeppelin-solidity</span></pre><p id="571b" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated"><strong class="is hu"> <em class="jx">观察:</em> </strong> <em class="jx">用您之前创建的地址替换地址。</em></p><p id="c580" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">然后创建一个标准合同ERC20:</p><pre class="jp jq jr js fq jy jz ka kb aw kc dt"><span id="c856" class="kd ke ht jz b fv kf kg l kh ki">$ vi contracts/RSKToken.sol</span><span id="4405" class="kd ke ht jz b fv kj kg l kh ki">pragma solidity ^0.4.23;</span><span id="421b" class="kd ke ht jz b fv kj kg l kh ki">import 'openzeppelin-solidity/contracts/token/ERC20/BasicToken.sol';</span><span id="513a" class="kd ke ht jz b fv kj kg l kh ki">contract RSKToken is BasicToken {<br/> <br/> string public constant name = "RSKToken";<br/> string public constant symbol = "RSKT";<br/> uint8 public constant decimals = 18;<br/> <br/> constructor() public {<br/>   totalSupply_ = 100 * (10 ** uint256(decimals));<br/>   balances[msg.sender] = totalSupply_;<br/> }<br/>}</span></pre><p id="eb7e" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">在RSK网络上部署合同:</p><pre class="jp jq jr js fq jy jz ka kb aw kc dt"><span id="0571" class="kd ke ht jz b fv kf kg l kh ki">$ sed s/Migrations/RSKToken/g migrations/1_initial_migration.js &gt; migrations/2_rsktoken.js<br/>$ truffle compile<br/>$ truffle migrate --network rsk</span></pre><p id="4194" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">随着合同的实施，可以在账户之间进行代币转移:</p><pre class="jp jq jr js fq jy jz ka kb aw kc dt"><span id="b557" class="kd ke ht jz b fv kf kg l kh ki">$ truffle console --network rsk<br/>truffle(rsk)&gt; RSKToken.deployed().then(function(c) { erc20 = c });<br/>truffle(rsk)&gt; ana = web3.eth.accounts[0];<br/><strong class="jz hu">'0x54aaa49f761dc048df63e81378054bcad2604230'</strong><br/>truffle(rsk)&gt; bob = web3.eth.accounts[1];<br/><strong class="jz hu">'0x9c46863dda60dd78aa628330347167caf0ba0dfc'</strong><br/>truffle(rsk)&gt; erc20.balanceOf(ana).then(function(a){ return web3.fromWei(a.toString(),'ether'); });<br/><strong class="jz hu">'100'</strong><br/>truffle(rsk)&gt; erc20.balanceOf(bob).then(function(b){ return web3.fromWei(b.toString(),'ether'); });<br/><strong class="jz hu">'0'<br/></strong>truffle(rsk)&gt; erc20.transfer(bob, web3.toWei(10,'ether'), {from: ana})<br/><strong class="jz hu">{ tx: '0x65f68dc534ece096d5ce00aa4c78d823b812aa71e14924405ec5fc42076eded5',<br/> receipt: <br/> { transactionHash: '0x65f68dc534ece096d5ce00aa4c78d823b812aa71e14924405ec5fc42076eded5',<br/> transactionIndex: 0,<br/> blockHash: '0x991422cea4de1c0a72493cdbc3161b09163253ac8df05bf946829297aab59077',<br/> blockNumber: 627946,<br/> cumulativeGasUsed: 51801,<br/> gasUsed: 51801,<br/> contractAddress: null,<br/> logs: [ [Object] ],<br/> from: '0x54aaa49f761dc048df63e81378054bcad2604230',<br/> to: '0x6ab06a95fdbc0855b9bcc4bafbc37aec7b070d2d',<br/> root: '0x01',<br/> status: '0x01' },<br/> logs: <br/> [ { logIndex: 0,<br/> blockNumber: 627946,<br/> blockHash: '0x991422cea4de1c0a72493cdbc3161b09163253ac8df05bf946829297aab59077',<br/> transactionHash: '0x65f68dc534ece096d5ce00aa4c78d823b812aa71e14924405ec5fc42076eded5',<br/> transactionIndex: 0,<br/> address: '0x6ab06a95fdbc0855b9bcc4bafbc37aec7b070d2d',<br/> event: 'Transfer',<br/> args: [Object] } ] }<br/></strong>truffle(rsk)&gt; erc20.balanceOf(ana).then(function(a){ return web3.fromWei(a.toString(),'ether'); });<br/><strong class="jz hu">'90'</strong><br/>truffle(rsk)&gt; erc20.balanceOf(bob).then(function(b){ return web3.fromWei(b.toString(),'ether'); });<br/><strong class="jz hu">'10'</strong></span></pre><p id="7056" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">准备好了。ERC20令牌成功转移到RSK网络！</p><h1 id="0e5b" class="kk ke ht bd kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg dt translated">结论</h1><p id="3d1a" class="pw-post-body-paragraph iq ir ht is b it lh iv iw ix li iz ja jb lj jd je jf lk jh ji jj ll jl jm jn hm dt translated">在这篇文章中，我展示了如何运行RSK节点sidechain，它将使用比特币执行智能合约。因为它与EVM兼容，所以它在运行为以太坊编写的代码方面有很大的优势。</p><p id="7ae3" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">正如闪电网络，其重点是通过引入新的层/网络来实现微交易的即时大规模执行，RSK是一种通过不同的协议实现智能合同执行的解决方案。</p></div></div>    
</body>
</html>