<html>
<head>
<title>Cxxl Cxts &amp; GHXSTS Airdrop — Dev blog</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Cxxl Cxts &amp; GHXSTS Airdrop —开发博客</h1>
<blockquote>原文：<a href="https://medium.com/coinmonks/cxxl-cxts-ghxsts-airdrop-dev-blog-b99f15cb52ee?source=collection_archive---------0-----------------------#2021-07-25">https://medium.com/coinmonks/cxxl-cxts-ghxsts-airdrop-dev-blog-b99f15cb52ee?source=collection_archive---------0-----------------------#2021-07-25</a></blockquote><div><div class="ef hh hi hj hk hl"/><div class="hm hn ho hp hq"><div class=""/><div class=""><h2 id="af54" class="pw-subtitle-paragraph iq hs ht bd b ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ek translated">比我想象的要难。</h2></div><figure class="jk jl jm jn fq jo fe ff paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="fe ff jj"><img src="../Images/38fce2d2e6fd66c1c3e9120a747ca5a1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*eTbSyyxNdHEoR8HC-x8sKQ.png"/></div></div></figure><h2 id="c3b7" class="jv jw ht bd jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks dt translated">目录</h2><ul class=""><li id="d486" class="kt ku ht kv b kw kx ky kz kg la kk lb ko lc ld le lf lg lh dt translated"><a class="ae li" href="#28af" rel="noopener ugc nofollow">为什么我们的夏季下降适得其反？</a></li><li id="be25" class="kt ku ht kv b kw lj ky lk kg ll kk lm ko ln ld le lf lg lh dt translated"><a class="ae li" href="#cfa8" rel="noopener ugc nofollow"> GHXST空投计划</a></li><li id="9291" class="kt ku ht kv b kw lj ky lk kg ll kk lm ko ln ld le lf lg lh dt translated"><a class="ae li" href="#cf79" rel="noopener ugc nofollow">抓拍酷猫</a></li><li id="aef3" class="kt ku ht kv b kw lj ky lk kg ll kk lm ko ln ld le lf lg lh dt translated"><a class="ae li" href="#7b91" rel="noopener ugc nofollow">快照GHXST </a></li><li id="56e7" class="kt ku ht kv b kw lj ky lk kg ll kk lm ko ln ld le lf lg lh dt translated"><a class="ae li" href="#3b51" rel="noopener ugc nofollow">分销方法</a></li><li id="298c" class="kt ku ht kv b kw lj ky lk kg ll kk lm ko ln ld le lf lg lh dt translated"><a class="ae li" href="#de56" rel="noopener ugc nofollow">为什么我们没有使用现有的服务？</a></li><li id="ac6f" class="kt ku ht kv b kw lj ky lk kg ll kk lm ko ln ld le lf lg lh dt translated"><a class="ae li" href="#85a5" rel="noopener ugc nofollow">让空投开始吧！</a></li><li id="189b" class="kt ku ht kv b kw lj ky lk kg ll kk lm ko ln ld le lf lg lh dt translated"><a class="ae li" href="#7a00" rel="noopener ugc nofollow">双重编码错误修复</a></li><li id="5049" class="kt ku ht kv b kw lj ky lk kg ll kk lm ko ln ld le lf lg lh dt translated"><a class="ae li" href="#b17b" rel="noopener ugc nofollow">继续下降… </a></li><li id="d2ab" class="kt ku ht kv b kw lj ky lk kg ll kk lm ko ln ld le lf lg lh dt translated"><a class="ae li" href="#cd33" rel="noopener ugc nofollow">清理重复——隐藏的错误</a></li><li id="8772" class="kt ku ht kv b kw lj ky lk kg ll kk lm ko ln ld le lf lg lh dt translated"><a class="ae li" href="#664e" rel="noopener ugc nofollow">参考文献</a></li><li id="9004" class="kt ku ht kv b kw lj ky lk kg ll kk lm ko ln ld le lf lg lh dt translated"><a class="ae li" href="#a6cb" rel="noopener ugc nofollow">去哪里找我们</a></li></ul></div><div class="ab cl lo lp hb lq" role="separator"><span class="lr bw bk ls lt lu"/><span class="lr bw bk ls lt lu"/><span class="lr bw bk ls lt"/></div><div class="hm hn ho hp hq"><p id="43cb" class="pw-post-body-paragraph lv lw ht kv b kw lx iu ly ky lz ix ma kg mb mc md kk me mf mg ko mh mi mj ld hm dt translated">公平的警告，这篇文章很快就会变得代码过多。</p><p id="afdb" class="pw-post-body-paragraph lv lw ht kv b kw lx iu ly ky lz ix ma kg mb mc md kk me mf mg ko mh mi mj ld hm dt translated">与GHXST合作是一件大事。他在NFT圈子里是一个如此重要的名字，我们知道我们必须做一些特别的事情。</p><p id="c6cb" class="pw-post-body-paragraph lv lw ht kv b kw lx iu ly ky lz ix ma kg mb mc md kk me mf mg ko mh mi mj ld hm dt translated">在GHXST投放前一周，我们决定推出一个有趣、惊喜的夏季主题限量版系列，共计300枚代币——结果适得其反，但为什么呢？</p><h1 id="28af" class="mk jw ht bd jx ml mm mn kb mo mp mq kf iz mr ja kj jc ms jd kn jf mt jg kr mu dt translated">为什么我们的夏季下降适得其反？</h1><p id="1cdf" class="pw-post-body-paragraph lv lw ht kv b kw kx iu ly ky kz ix ma kg mv mc md kk mw mf mg ko mx mi mj ld hm dt translated">我认为简单的答案是新的物品被空投弄糊涂了，然后总会有人对他们没有得到300个空投物品中的一个感到愤怒。</p><p id="83f2" class="pw-post-body-paragraph lv lw ht kv b kw lx iu ly ky lz ix ma kg mb mc md kk me mf mg ko mh mi mj ld hm dt translated">从新的角度来看，我完全理解这种困惑。NFTs和crypto充斥着行话。对于这群人来说，困惑是我们的错，因为我们没有通过解释空投来让他们做好准备。</p><p id="785b" class="pw-post-body-paragraph lv lw ht kv b kw lx iu ly ky lz ix ma kg mb mc md kk me mf mg ko mh mi mj ld hm dt translated">当你把新的飞毛腿和理解空投但本质上对没有得到免费的钱感到愤怒的人联系在一起时，它创造了一个自我延续的回音室。</p><p id="7ba4" class="pw-post-body-paragraph lv lw ht kv b kw lx iu ly ky lz ix ma kg mb mc md kk me mf mg ko mh mi mj ld hm dt translated">我们想要一种道歉的方式，让每个人都体验一下空投行动。</p><h1 id="cfa8" class="mk jw ht bd jx ml mm mn kb mo mp mq kf iz mr ja kj jc ms jd kn jf mt jg kr mu dt translated">GHXST空投计划</h1><p id="e44a" class="pw-post-body-paragraph lv lw ht kv b kw kx iu ly ky kz ix ma kg mv mc md kk mw mf mg ko mx mi mj ld hm dt translated">GHXST收藏者会知道他的收藏是有限的。他没有一件藏品的规模能与3300只酷猫的持有者相提并论。因此，当GHXST建议我们向每位时尚弄潮儿和GHXST持有者赠送一台Cxxl Cxt -1时，我感到非常震惊。</p><p id="6dd1" class="pw-post-body-paragraph lv lw ht kv b kw lx iu ly ky lz ix ma kg mb mc md kk me mf mg ko mh mi mj ld hm dt translated">大力支持GHXST获得❤奖</p><p id="5cf6" class="pw-post-body-paragraph lv lw ht kv b kw lx iu ly ky lz ix ma kg mb mc md kk me mf mg ko mh mi mj ld hm dt translated">就这样，我们有了一个最终的计划——给每个持有时尚弄潮儿或任何GHXST系列物品的人。</p><p id="65dd" class="pw-post-body-paragraph lv lw ht kv b kw lx iu ly ky lz ix ma kg mb mc md kk me mf mg ko mh mi mj ld hm dt translated">似乎很简单。</p><p id="37d3" class="pw-post-body-paragraph lv lw ht kv b kw lx iu ly ky lz ix ma kg mb mc md kk me mf mg ko mh mi mj ld hm dt translated">我错了。</p><h1 id="cf79" class="mk jw ht bd jx ml mm mn kb mo mp mq kf iz mr ja kj jc ms jd kn jf mt jg kr mu dt translated">抓拍酷猫</h1><p id="92b6" class="pw-post-body-paragraph lv lw ht kv b kw kx iu ly ky kz ix ma kg mv mc md kk mw mf mg ko mx mi mj ld hm dt translated">给酷猫拍张快照很容易。在eth上有许多记录良好的方法可以做到这一点。我们选择了一个非常简单的解决方案，在调用它时拍摄快照:</p><figure class="jk jl jm jn fq jo"><div class="bz el l di"><div class="my mz l"/></div></figure><p id="36f3" class="pw-post-body-paragraph lv lw ht kv b kw lx iu ly ky lz ix ma kg mb mc md kk me mf mg ko mh mi mj ld hm dt translated">第一步——获取总人口<br/> 我们简单地调用我们的契约，并要求它返回totalSupply()，这是已经铸造的酷猫的数量。</p><pre class="jk jl jm jn fq na nb nc nd aw ne dt"><span id="9e1c" class="jv jw ht nb b fv nf ng l nh ni">const totalSupply = await this.contract.methods.totalSupply().call();</span></pre><p id="2fb5" class="pw-post-body-paragraph lv lw ht kv b kw lx iu ly ky lz ix ma kg mb mc md kk me mf mg ko mh mi mj ld hm dt translated"><strong class="kv hu">步骤2 —迭代实时令牌和日志所有者<br/> </strong>我们循环遍历总人口，对于每个令牌，我们要求我们的合同返回当前所有者。</p><p id="7a9c" class="pw-post-body-paragraph lv lw ht kv b kw lx iu ly ky lz ix ma kg mb mc md kk me mf mg ko mh mi mj ld hm dt translated">然后主人的地址作为一个键被添加到一个对象中，我们跟踪一个给定的主人有多少只猫。</p><p id="0913" class="pw-post-body-paragraph lv lw ht kv b kw lx iu ly ky lz ix ma kg mb mc md kk me mf mg ko mh mi mj ld hm dt translated">需要注意的是，使用地址作为对象中的键相当于重复地址过滤器。然而，尽管这是真的，但你们中眼尖的人可能已经发现了一个我很久都没有发现的错误(稍后会有更多的介绍)。</p><pre class="jk jl jm jn fq na nb nc nd aw ne dt"><span id="8521" class="jv jw ht nb b fv nf ng l nh ni">const holder = {};<br/>  for(let i = 0; i &lt; totalSupply; i++){<br/>    const ownerAddress = await this.contract.methods.ownerOf(i).call();<br/>    if(!holder[ownerAddress]){<br/>      holder[ownerAddress] = 1;<br/>    } else {<br/>      holder[ownerAddress]++;<br/>    }<br/>  }</span></pre><p id="3ca0" class="pw-post-body-paragraph lv lw ht kv b kw lx iu ly ky lz ix ma kg mb mc md kk me mf mg ko mh mi mj ld hm dt translated"><strong class="kv hu">第三步—保存快照<br/> </strong>这里不多说了，标准fs用法保存JSON到文件。</p><pre class="jk jl jm jn fq na nb nc nd aw ne dt"><span id="969e" class="jv jw ht nb b fv nf ng l nh ni"><strong class="nb hu"><em class="nj">fs</em></strong>.writeFile('holders.json', <strong class="nb hu"><em class="nj">JSON</em></strong>.stringify(holder),{ flag: 'wx' },function (err) {<br/>    if (err) return <strong class="nb hu"><em class="nj">console</em></strong>.log(err);<br/>  });</span></pre><h1 id="7b91" class="mk jw ht bd jx ml mm mn kb mo mp mq kf iz mr ja kj jc ms jd kn jf mt jg kr mu dt translated">快照GHXST</h1><p id="4709" class="pw-post-body-paragraph lv lw ht kv b kw kx iu ly ky kz ix ma kg mv mc md kk mw mf mg ko mx mi mj ld hm dt translated">那么，从哪里开始呢？</p><p id="230f" class="pw-post-body-paragraph lv lw ht kv b kw lx iu ly ky lz ix ma kg mb mc md kk me mf mg ko mh mi mj ld hm dt translated">Opensea的某些方面对我来说仍然陌生，我天真地认为他们的API将是我收集所有者列表所需要的全部——事实证明，不是那么多。</p><h2 id="e408" class="jv jw ht bd jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks dt translated">正在收集所有项目id</h2><p id="a4bd" class="pw-post-body-paragraph lv lw ht kv b kw kx iu ly ky kz ix ma kg mv mc md kk mw mf mg ko mx mi mj ld hm dt translated">第一个障碍是收集每个GHXST集合中所有项目的列表:</p><p id="21fc" class="pw-post-body-paragraph lv lw ht kv b kw lx iu ly ky lz ix ma kg mb mc md kk me mf mg ko mh mi mj ld hm dt translated"><strong class="kv hu">ghx STS</strong>:<a class="ae li" href="https://opensea.io/collection/ghxsts" rel="noopener ugc nofollow" target="_blank">https://opensea.io/collection/ghxsts</a></p><p id="be17" class="pw-post-body-paragraph lv lw ht kv b kw lx iu ly ky lz ix ma kg mb mc md kk me mf mg ko mh mi mj ld hm dt translated"><strong class="kv hu">PxinGxng:</strong>T15】https://opensea.io/collection/pxin-gxng</p><p id="2a28" class="pw-post-body-paragraph lv lw ht kv b kw lx iu ly ky lz ix ma kg mb mc md kk me mf mg ko mh mi mj ld hm dt translated"><strong class="kv hu"> Ghxst文化:</strong><a class="ae li" href="https://opensea.io/collection/ghxsts-cxlture" rel="noopener ugc nofollow" target="_blank">https://opensea.io/collection/ghxsts-cxlture</a></p><p id="ac83" class="pw-post-body-paragraph lv lw ht kv b kw lx iu ly ky lz ix ma kg mb mc md kk me mf mg ko mh mi mj ld hm dt translated">【https://opensea.io/collection/cxllabs】cxl labs:T23</p><p id="adc4" class="pw-post-body-paragraph lv lw ht kv b kw lx iu ly ky lz ix ma kg mb mc md kk me mf mg ko mh mi mj ld hm dt translated">为了实现这一点，我们使用了部分<a class="ae li" href="https://docs.opensea.io/reference" rel="noopener ugc nofollow" target="_blank"> Opensea API </a></p><figure class="jk jl jm jn fq jo"><div class="bz el l di"><div class="my mz l"/></div></figure><p id="51b0" class="pw-post-body-paragraph lv lw ht kv b kw lx iu ly ky lz ix ma kg mb mc md kk me mf mg ko mh mi mj ld hm dt translated"><strong class="kv hu">第一步—分页</strong> <br/> Opensea一次只允许检索50个结果，有些GHXST集合可以容纳250+个条目，所以我们需要一些分页来遍历所有内容。</p><pre class="jk jl jm jn fq na nb nc nd aw ne dt"><span id="092d" class="jv jw ht nb b fv nf ng l nh ni">const totalTokens = 50;<br/>const pages = <strong class="nb hu"><em class="nj">Math</em></strong>.ceil(totalTokens/50);</span></pre><p id="605f" class="pw-post-body-paragraph lv lw ht kv b kw lx iu ly ky lz ix ma kg mb mc md kk me mf mg ko mh mi mj ld hm dt translated">你可以看到这里我们已经放弃了一个神奇的数字50。这个数字因我们收集数据的集合而异。如果我们看到一个系列有250多件，我们相应地改变价值。</p><figure class="jk jl jm jn fq jo fe ff paragraph-image"><div class="fe ff nk"><img src="../Images/c3e00d23b5e7451ff6b95a7124df4276.png" data-original-src="https://miro.medium.com/v2/resize:fit:718/format:webp/1*7P9VOwOEsJjCv2wl5rtI5w.png"/></div><figcaption class="nl nm fg fe ff nn no bd b be z ek"><a class="ae li" href="https://opensea.io/assets/ghxsts?search[resultModel]=ASSETS" rel="noopener ugc nofollow" target="_blank">https://opensea.io/assets/ghxsts?search[resultModel]=ASSETS</a></figcaption></figure><p id="b958" class="pw-post-body-paragraph lv lw ht kv b kw lx iu ly ky lz ix ma kg mb mc md kk me mf mg ko mh mi mj ld hm dt translated">然后我们遍历页面并调用Opensea，请求集合中所有项目的列表。</p><pre class="jk jl jm jn fq na nb nc nd aw ne dt"><span id="6af0" class="jv jw ht nb b fv nf ng l nh ni">for(let i = 0; i &lt; pages; i++) {<br/><br/>  offSet = i * 50;<br/><br/>  const response = await fetch(`https://api.opensea.io/api/v1/assets?order_direction=desc&amp;offset=${offSet}&amp;limit=50&amp;collection=cxllabs`);<br/>  const listOfTokens = await response.json();</span></pre><p id="c1fc" class="pw-post-body-paragraph lv lw ht kv b kw lx iu ly ky lz ix ma kg mb mc md kk me mf mg ko mh mi mj ld hm dt translated">请注意，在上面的截图中，我们正在查询<strong class="kv hu"> Cxllabs </strong>集合。这个值需要根据您想要查询的集合而改变。</p><p id="a30b" class="pw-post-body-paragraph lv lw ht kv b kw lx iu ly ky lz ix ma kg mb mc md kk me mf mg ko mh mi mj ld hm dt translated"><strong class="kv hu">第二步——把我的头砸在桌子上<br/> </strong>既然我们已经能够抓取一个系列中的所有物品，你可能会认为抓取每一件物品的持有者列表会很容易——不，绝对不会。</p><p id="f308" class="pw-post-body-paragraph lv lw ht kv b kw lx iu ly ky lz ix ma kg mb mc md kk me mf mg ko mh mi mj ld hm dt translated">除非我非常愚蠢(很有可能)，否则我看不到Opensea API中允许我们向所有者查询集合中某个项目的任何内容。如果你知道一条路，请告诉我。当然我不再需要它了，但我还是想知道。</p><p id="48f3" class="pw-post-body-paragraph lv lw ht kv b kw lx iu ly ky lz ix ma kg mb mc md kk me mf mg ko mh mi mj ld hm dt translated">为了解决这个问题，我们开始在Etherscan周围嗅来嗅去，但是收集只是大规模Openseas合同的一部分。我们需要更好的方法。</p><p id="8d05" class="pw-post-body-paragraph lv lw ht kv b kw lx iu ly ky lz ix ma kg mb mc md kk me mf mg ko mh mi mj ld hm dt translated">幸运的是，<a class="ae li" href="https://twitter.com/Lynqoid" rel="noopener ugc nofollow" target="_blank"> Lynqoid </a>很擅长寻找有用的API，他找到了这个小宝贝，<a class="ae li" href="https://moralis.io/" rel="noopener ugc nofollow" target="_blank">https://moralis.io/</a>。我肯定会在❤的很多事情上使用这项服务</p><pre class="jk jl jm jn fq na nb nc nd aw ne dt"><span id="1a2e" class="jv jw ht nb b fv nf ng l nh ni">const url = `https://deep-index.moralis.io/api/nft/contract/0x495f947276749ce646f68ac8c248420045cb7b5e/token/${asset.token_id}/owners?chain=eth&amp;chain_name=mainnet&amp;format=decimal&amp;order=name.DESC`;<br/>const header = { method: 'GET', headers: {<br/>    'X-API-Key': <strong class="nb hu"><em class="nj">process</em></strong>.env.MORALIS_APIKEY<br/>  }}<br/>const r2 = await fetch(url, header);<br/>const l2 = await r2.json();</span></pre><p id="b546" class="pw-post-body-paragraph lv lw ht kv b kw lx iu ly ky lz ix ma kg mb mc md kk me mf mg ko mh mi mj ld hm dt translated">我知道，这些代码看起来有点吓人，但没关系。我们只是要求API服务返回给定令牌id“$ { asset . token _ id }”的所有所有者，这在大量的Opensea合同“0x 495 f 947276749 ce 646 f 68 AC 8c 248420045 CB 7 b 5 e”中可以找到。</p><p id="152d" class="pw-post-body-paragraph lv lw ht kv b kw lx iu ly ky lz ix ma kg mb mc md kk me mf mg ko mh mi mj ld hm dt translated">要查找某个项目的令牌，您只需单击该项目，您就可以在URL中看到它:<br/><a class="ae li" href="https://opensea.io/assets/0x495f947276749ce646f68ac8c248420045cb7b5e/80494307024529346018053650490912529916739680814770830097664395582100905918465" rel="noopener ugc nofollow" target="_blank">https://open sea . io/assets/0x 495 f 947276749 ce 646 f 68 AC 8 c 248420045 cb7b5e/8049430702452934601805365049012529916739680814777</a></p><p id="080f" class="pw-post-body-paragraph lv lw ht kv b kw lx iu ly ky lz ix ma kg mb mc md kk me mf mg ko mh mi mj ld hm dt translated">这分为以下几个部分:</p><ul class=""><li id="1374" class="kt ku ht kv b kw lx ky lz kg np kk nq ko nr ld le lf lg lh dt translated"><a class="ae li" href="https://openseas.io/assets" rel="noopener ugc nofollow" target="_blank">https://openseas.io/assets</a>=网站，这个我们可以忽略</li><li id="131c" class="kt ku ht kv b kw lj ky lk kg ll kk lm ko ln ld le lf lg lh dt translated"><a class="ae li" href="https://opensea.io/assets/0x495f947276749ce646f68ac8c248420045cb7b5e/80494307024529346018053650490912529916739680814770830097664395582100905918465" rel="noopener ugc nofollow" target="_blank">0x 495 f 947276749 ce 646 f 68 ac8c 248420045 cb7b5e</a>= open sea合同地址</li><li id="a880" class="kt ku ht kv b kw lj ky lk kg ll kk lm ko ln ld le lf lg lh dt translated"><a class="ae li" href="https://opensea.io/assets/0x495f947276749ce646f68ac8c248420045cb7b5e/80494307024529346018053650490912529916739680814770830097664395582100905918465" rel="noopener ugc nofollow" target="_blank">80494307024529346018053650490912529916739680814770830097664395582100905918465</a>=令牌id</li></ul><p id="d14b" class="pw-post-body-paragraph lv lw ht kv b kw lx iu ly ky lz ix ma kg mb mc md kk me mf mg ko mh mi mj ld hm dt translated">我们将API键作为一个头来传递，嘿，很快，我们就有了一个持有人列表。</p><p id="475a" class="pw-post-body-paragraph lv lw ht kv b kw lx iu ly ky lz ix ma kg mb mc md kk me mf mg ko mh mi mj ld hm dt translated"><strong class="kv hu">步骤3 —过滤持有人<br/></strong>GHXST有许多项目，我们需要为所有GHXST集合的所有持有人拍摄快照。因为我们的计划是选择独特的钱包，而不是每个项目，所以我们必须过滤掉重复的钱包。</p><pre class="jk jl jm jn fq na nb nc nd aw ne dt"><span id="bb22" class="jv jw ht nb b fv nf ng l nh ni">// iterate through results<br/>for(const result of l2.result){<br/>  if(!holderAddresses[result.owner_of]){<br/>    holderAddresses[result.owner_of] = 1;<br/>  }else{<br/>    holderAddresses[result.owner_of] ++;<br/>  }<br/>}</span></pre><p id="667a" class="pw-post-body-paragraph lv lw ht kv b kw lx iu ly ky lz ix ma kg mb mc md kk me mf mg ko mh mi mj ld hm dt translated">这段代码可能看起来很熟悉。我们在过滤酷猫的时候也用过。</p><p id="f6f7" class="pw-post-body-paragraph lv lw ht kv b kw lx iu ly ky lz ix ma kg mb mc md kk me mf mg ko mh mi mj ld hm dt translated"><strong class="kv hu">步骤4——保存并检查<br/> </strong>一旦所有的所有者都被过滤掉，我们需要保存他们。</p><pre class="jk jl jm jn fq na nb nc nd aw ne dt"><span id="9318" class="jv jw ht nb b fv nf ng l nh ni"><strong class="nb hu"><em class="nj">console</em></strong>.log('total GY tokens:', totalGYTokens);<br/><strong class="nb hu"><em class="nj">console</em></strong>.log('total owned:', totalOwned);<br/><strong class="nb hu"><em class="nj">console</em></strong>.log('total holders', <strong class="nb hu"><em class="nj">Object</em></strong>.keys(holderAddresses).length);<br/><br/><strong class="nb hu"><em class="nj">fs</em></strong>.writeFile('cxllabsHolders.json', <strong class="nb hu"><em class="nj">JSON</em></strong>.stringify(holderAddresses),{ flag: 'wx' },function (err) {<br/>  if (err) return <strong class="nb hu"><em class="nj">console</em></strong>.log(err);<br/>});</span></pre><p id="0de0" class="pw-post-body-paragraph lv lw ht kv b kw lx iu ly ky lz ix ma kg mb mc md kk me mf mg ko mh mi mj ld hm dt translated">我们还输出一些控制台检查。这使我们能够将快照值与Opensea上显示的值进行比较。请将此视为安全检查，以确保我们的计数匹配。</p><figure class="jk jl jm jn fq jo fe ff paragraph-image"><div class="fe ff ns"><img src="../Images/707be4ef4937219daa03f4c7f207b24e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1224/format:webp/1*YliIg6qVvcXQwtOKltAtuw.png"/></div></figure><p id="1735" class="pw-post-body-paragraph lv lw ht kv b kw lx iu ly ky lz ix ma kg mb mc md kk me mf mg ko mh mi mj ld hm dt translated"><strong class="kv hu">第5步—为所有集合重复快照<br/> </strong>我们只需改变一些变量，依次指向每个集合，然后启动快照。</p><p id="8084" class="pw-post-body-paragraph lv lw ht kv b kw lx iu ly ky lz ix ma kg mb mc md kk me mf mg ko mh mi mj ld hm dt translated">最终结果是一个JSON文件，包含每个集合的所有持有者。</p><h1 id="3b51" class="mk jw ht bd jx ml mm mn kb mo mp mq kf iz mr ja kj jc ms jd kn jf mt jg kr mu dt translated">分配方法</h1><p id="48ef" class="pw-post-body-paragraph lv lw ht kv b kw kx iu ly ky kz ix ma kg mv mc md kk mw mf mg ko mx mi mj ld hm dt translated">最初的计划是花整整一周时间创建一个自动空投系统。七天可以让我们有足够的时间来构建、测试、测试、测试。</p><p id="782f" class="pw-post-body-paragraph lv lw ht kv b kw lx iu ly ky lz ix ma kg mb mc md kk me mf mg ko mh mi mj ld hm dt translated">由于各种原因，时间表发生了变化。</p><p id="e069" class="pw-post-body-paragraph lv lw ht kv b kw lx iu ly ky lz ix ma kg mb mc md kk me mf mg ko mh mi mj ld hm dt translated">现在我们只有不到两天的时间来建造它——啊啊啊！！！！</p><p id="8709" class="pw-post-body-paragraph lv lw ht kv b kw lx iu ly ky lz ix ma kg mb mc md kk me mf mg ko mh mi mj ld hm dt translated">抱歉，我们不会分享airdropper代码，因为它仍然是WIP，目前正在进行大规模升级。</p><h2 id="2671" class="jv jw ht bd jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks dt translated">最初的计划</h2><p id="be4d" class="pw-post-body-paragraph lv lw ht kv b kw kx iu ly ky kz ix ma kg mv mc md kk mw mf mg ko mx mi mj ld hm dt translated">在理想情况下，我们应该添加快照列表，点击一个绿色的“GO”按钮，所有令牌都将被空投下来，不会出现任何问题。</p><h2 id="8073" class="jv jw ht bd jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks dt translated">残酷现实</h2><p id="a378" class="pw-post-body-paragraph lv lw ht kv b kw kx iu ly ky kz ix ma kg mv mc md kk mw mf mg ko mx mi mj ld hm dt translated">通过web3或ether传递大量交易显然会出现一些错误:</p><ul class=""><li id="5116" class="kt ku ht kv b kw lx ky lz kg np kk nq ko nr ld le lf lg lh dt translated">超时设定</li><li id="25f8" class="kt ku ht kv b kw lj ky lk kg ll kk lm ko ln ld le lf lg lh dt translated">404s</li><li id="703b" class="kt ku ht kv b kw lj ky lk kg ll kk lm ko ln ld le lf lg lh dt translated">一般事务失败</li><li id="3860" class="kt ku ht kv b kw lj ky lk kg ll kk lm ko ln ld le lf lg lh dt translated">谁知道还有什么</li></ul><p id="c286" class="pw-post-body-paragraph lv lw ht kv b kw lx iu ly ky lz ix ma kg mb mc md kk me mf mg ko mh mi mj ld hm dt translated">我想创建一个健壮的系统，跟踪每笔交易的成功或失败，并将数据存储在不同地址的数据库中。很简单，只有很少的活动部分，但是需要测试，错误处理有时会比你预期的要长——队列计划b。</p><h2 id="243e" class="jv jw ht bd jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks dt translated">计划B——半自动下降系统</h2><p id="23fa" class="pw-post-body-paragraph lv lw ht kv b kw kx iu ly ky kz ix ma kg mv mc md kk mw mf mg ko mx mi mj ld hm dt translated">人类非常擅长处理错误，当然我们会疲劳和犯错，但在如此短的开发时间内，我们的劣等大脑就是答案。</p><p id="24e3" class="pw-post-body-paragraph lv lw ht kv b kw lx iu ly ky lz ix ma kg mb mc md kk me mf mg ko mh mi mj ld hm dt translated">我们创建了一个简单的React应用程序，允许团队成员连接到metamask并填写一个简单的表单，我们在其中放入10个地址，点击一个大的“GO”按钮并处理这10个地址。</p><p id="5525" class="pw-post-body-paragraph lv lw ht kv b kw lx iu ly ky lz ix ma kg mb mc md kk me mf mg ko mh mi mj ld hm dt translated">是的，我们确实以10个为一组处理了所有3500多个Cxxl Cxts。</p><p id="7566" class="pw-post-body-paragraph lv lw ht kv b kw lx iu ly ky lz ix ma kg mb mc md kk me mf mg ko mh mi mj ld hm dt translated">我们使用10个地址的块来简化错误处理。所有的区块都列在一个巨大的谷歌文档表中，并细分为选项卡，每个团队成员都有一个选项卡。如果在阻塞期间发生错误，我们将不得不手动检查我们在Opensea上的个人活动，以验证我们上次成功的交易。这将允许我们修剪该块，刷新应用程序，并粘贴在该块的剩余地址。</p><p id="117e" class="pw-post-body-paragraph lv lw ht kv b kw lx iu ly ky lz ix ma kg mb mc md kk me mf mg ko mh mi mj ld hm dt translated">低技术，我知道，但它工作得很好。</p><h1 id="de56" class="mk jw ht bd jx ml mm mn kb mo mp mq kf iz mr ja kj jc ms jd kn jf mt jg kr mu dt translated">为什么我们没有使用现有的服务？</h1><p id="66c4" class="pw-post-body-paragraph lv lw ht kv b kw kx iu ly ky kz ix ma kg mv mc md kk mw mf mg ko mx mi mj ld hm dt translated">我们发现的大多数服务，或者人们与我们分享的服务，都是围绕ETH的，我们选择了POLY (MATIC)以降低费用。</p><p id="71b4" class="pw-post-body-paragraph lv lw ht kv b kw lx iu ly ky lz ix ma kg mb mc md kk me mf mg ko mh mi mj ld hm dt translated">确实存在一些MATIC解决方案，但即使在与它们的所有者交谈后，我们得到的结果也是极不一致的。事实上，三分之一的测试液都失败了，所以我们不可能使用它们。</p><p id="c7a8" class="pw-post-body-paragraph lv lw ht kv b kw lx iu ly ky lz ix ma kg mb mc md kk me mf mg ko mh mi mj ld hm dt translated">一家相当大的公司确实提供投递服务，但它背后有一堵“联系我们”的墙，我相信我们仍在等待突破那堵墙。</p><h1 id="85a5" class="mk jw ht bd jx ml mm mn kb mo mp mq kf iz mr ja kj jc ms jd kn jf mt jg kr mu dt translated">让空投开始！</h1><p id="059c" class="pw-post-body-paragraph lv lw ht kv b kw kx iu ly ky kz ix ma kg mv mc md kk mw mf mg ko mx mi mj ld hm dt translated">我们进行了5分钟，一切都很顺利，至少我们是这么认为的。然后<a class="ae li" href="https://twitter.com/Grampa_Bacon" rel="noopener ugc nofollow" target="_blank"> Adam </a>掉落到我的DMs里，让我知道有两个人刚刚收到了双掉落。</p><p id="8c5c" class="pw-post-body-paragraph lv lw ht kv b kw lx iu ly ky lz ix ma kg mb mc md kk me mf mg ko mh mi mj ld hm dt translated">我们停止下降，回到那个代码。</p><h1 id="7a00" class="mk jw ht bd jx ml mm mn kb mo mp mq kf iz mr ja kj jc ms jd kn jf mt jg kr mu dt translated">双重编码错误修复</h1><p id="eeef" class="pw-post-body-paragraph lv lw ht kv b kw kx iu ly ky kz ix ma kg mv mc md kk mw mf mg ko mx mi mj ld hm dt translated">疲惫不堪，而且非常清楚成千上万的人在等待他们的-1 CXXL CXT被丢弃，团队滑入黑暗中。</p><p id="a831" class="pw-post-body-paragraph lv lw ht kv b kw lx iu ly ky lz ix ma kg mb mc md kk me mf mg ko mh mi mj ld hm dt translated">我们很快意识到了这个错误(稍后解释),并开始着手解决问题。</p><h2 id="3176" class="jv jw ht bd jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks dt translated">不同语言的并行编码</h2><p id="26b1" class="pw-post-body-paragraph lv lw ht kv b kw kx iu ly ky kz ix ma kg mv mc md kk mw mf mg ko mx mi mj ld hm dt translated">知道我们非常累并且可能会出错，我们决定Adam用Python编写解决方案，Tom用javascript编写解决方案。彼此独立。</p><p id="997f" class="pw-post-body-paragraph lv lw ht kv b kw lx iu ly ky lz ix ma kg mb mc md kk me mf mg ko mh mi mj ld hm dt translated">计划是，每个编码员会产生一个非常不同的解决方案，但最终结果需要是相同的，然后我们才会有信心继续进行。</p><p id="0638" class="pw-post-body-paragraph lv lw ht kv b kw lx iu ly ky lz ix ma kg mb mc md kk me mf mg ko mh mi mj ld hm dt translated">在代码修复期间，团队的其他成员验证任何错误，并向编码人员提供所有成功丢弃的列表。</p><p id="faf7" class="pw-post-body-paragraph lv lw ht kv b kw lx iu ly ky lz ix ma kg mb mc md kk me mf mg ko mh mi mj ld hm dt translated">从空投列表中修剪成功空投的列表，并且使用并行编码方法最终处理结果列表。大约一个小时后，Tom和Adam创建了两个独立的方法，令人惊讶地产生了两个相同的列表(甚至连地址排序都一样)——找到了一个解决方案。</p><h1 id="b17b" class="mk jw ht bd jx ml mm mn kb mo mp mq kf iz mr ja kj jc ms jd kn jf mt jg kr mu dt translated">继续下降…</h1><h2 id="66e3" class="jv jw ht bd jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks dt translated">人为错误和失误</h2><p id="4521" class="pw-post-body-paragraph lv lw ht kv b kw kx iu ly ky kz ix ma kg mv mc md kk mw mf mg ko mx mi mj ld hm dt translated">如果我不完全诚实地告诉你错误是由我造成的，那我就是在伤害你。</p><p id="fa53" class="pw-post-body-paragraph lv lw ht kv b kw lx iu ly ky lz ix ma kg mb mc md kk me mf mg ko mh mi mj ld hm dt translated">即使在代码修复后，我还是非常累，并且不小心将猫发送到10个地址的同一个街区，两次。</p><p id="eafb" class="pw-post-body-paragraph lv lw ht kv b kw lx iu ly ky lz ix ma kg mb mc md kk me mf mg ko mh mi mj ld hm dt translated">其他人到处都会犯一些小错误，但总的来说，我们的错误率非常低。</p><h1 id="cd33" class="mk jw ht bd jx ml mm mn kb mo mp mq kf iz mr ja kj jc ms jd kn jf mt jg kr mu dt translated">清除重复项—隐藏的错误</h1><p id="ffa5" class="pw-post-body-paragraph lv lw ht kv b kw kx iu ly ky kz ix ma kg mv mc md kk mw mf mg ko mx mi mj ld hm dt translated">如您所料，所有集合中都有重复的地址，我们需要将它们过滤掉:</p><figure class="jk jl jm jn fq jo"><div class="bz el l di"><div class="my mz l"/></div></figure><p id="52b2" class="pw-post-body-paragraph lv lw ht kv b kw lx iu ly ky lz ix ma kg mb mc md kk me mf mg ko mh mi mj ld hm dt translated"><strong class="kv hu">第一步——收集地址<br/> </strong>抓取所有奇异的快照并保存到一个变量中。然后，所有变量都被放入一个数组中。</p><p id="a393" class="pw-post-body-paragraph lv lw ht kv b kw lx iu ly ky lz ix ma kg mb mc md kk me mf mg ko mh mi mj ld hm dt translated"><strong class="kv hu">第2步——合并和过滤<br/> </strong>我们迭代数组和数组中的每个JSON。像我们在整个过程中所做的那样过滤所有的地址</p><p id="e715" class="pw-post-body-paragraph lv lw ht kv b kw lx iu ly ky lz ix ma kg mb mc md kk me mf mg ko mh mi mj ld hm dt translated"><strong class="kv hu">步骤3 —保存最终快照<br/> </strong>标准fs方法保存文件。</p><h2 id="82d8" class="jv jw ht bd jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks dt translated">错误</h2><p id="b8c7" class="pw-post-body-paragraph lv lw ht kv b kw kx iu ly ky kz ix ma kg mv mc md kk mw mf mg ko mx mi mj ld hm dt translated">我相信你们中的一些人已经知道发生了什么，但是对于那些没有注意到的人，这里有一个简短的分析。</p><p id="178a" class="pw-post-body-paragraph lv lw ht kv b kw lx iu ly ky lz ix ma kg mb mc md kk me mf mg ko mh mi mj ld hm dt translated">使用地址作为对象中的键是过滤重复项的一种非常简单的方法。这是事实，直到不同的快照方法以稍微不同的格式返回相同的地址。我们忘了解释这种差异。</p><blockquote class="nt nu nv"><p id="4383" class="lv lw nj kv b kw lx iu ly ky lz ix ma nw mb mc md nx me mf mg ny mh mi mj ld hm dt translated">考虑以下:<br/>T1】0 C5 A8 d 47 a 2129d 95 f1 DCF 0 f 49 a4 B3 daea 50 fa 78 b 4<br/>0 C5 A8 d 47 a 2129d 95 f1 DCF 0 f 49 a4 B3 daea 50 fa 78 b 4</p></blockquote><p id="c667" class="pw-post-body-paragraph lv lw ht kv b kw lx iu ly ky lz ix ma kg mb mc md kk me mf mg ko mh mi mj ld hm dt translated">相同的地址，两个都可以，但是一个是大写字母，一个是小写字母。两者都将在跟踪对象中创建一个惟一的键条目:(</p><p id="d30c" class="pw-post-body-paragraph lv lw ht kv b kw lx iu ly ky lz ix ma kg mb mc md kk me mf mg ko mh mi mj ld hm dt translated">最终结果是同一个地址有多个条目，这意味着当快照被处理为丢弃时，违规的地址将得到两次丢弃。</p><h2 id="b267" class="jv jw ht bd jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks dt translated">解决方案</h2><p id="3a45" class="pw-post-body-paragraph lv lw ht kv b kw kx iu ly ky kz ix ma kg mv mc md kk mw mf mg ko mx mi mj ld hm dt translated">解决方案非常简单。在上面的代码中，我们简单地将其改为:</p><pre class="jk jl jm jn fq na nb nc nd aw ne dt"><span id="9acc" class="jv jw ht nb b fv nf ng l nh ni">for(const obj of arr) {<br/>  const keys = <strong class="nb hu"><em class="nj">Object</em></strong>.keys(obj);<br/>  for (let key of keys) {<br/>    key = key.toLowerCase();<br/>    if (!allHolders[key]) {<br/>      allHolders[key] = 1;<br/>    } else {<br/>      allHolders[key]++;<br/>    }<br/>  }<br/>}</span></pre><p id="e92c" class="pw-post-body-paragraph lv lw ht kv b kw lx iu ly ky lz ix ma kg mb mc md kk me mf mg ko mh mi mj ld hm dt translated">请注意，我们只是添加了一个将所有键规范化为小写的方法。</p><p id="08ad" class="pw-post-body-paragraph lv lw ht kv b kw lx iu ly ky lz ix ma kg mb mc md kk me mf mg ko mh mi mj ld hm dt translated">在理想的情况下，我们应该在拍摄快照时就这样做。但是由于每个快照都需要一段时间，尤其是酷猫快照，我们选择在合并阶段对地址进行规范化。</p><h2 id="f11a" class="jv jw ht bd jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks dt translated">为什么修复花了我们一个小时？</h2><p id="d965" class="pw-post-body-paragraph lv lw ht kv b kw kx iu ly ky kz ix ma kg mv mc md kk mw mf mg ko mx mi mj ld hm dt translated">一旦我们发现问题，我们需要:</p><ul class=""><li id="e159" class="kt ku ht kv b kw lx ky lz kg np kk nq ko nr ld le lf lg lh dt translated">过滤掉所有重复的地址</li><li id="7acc" class="kt ku ht kv b kw lj ky lk kg ll kk lm ko ln ld le lf lg lh dt translated">清理地址块——一旦我们注意到错误，我们就中途停止。这些需要清理</li><li id="cece" class="kt ku ht kv b kw lj ky lk kg ll kk lm ko ln ld le lf lg lh dt translated">过滤掉已经成功空投的地址</li><li id="68ca" class="kt ku ht kv b kw lj ky lk kg ll kk lm ko ln ld le lf lg lh dt translated">重建组合快照列表</li><li id="d345" class="kt ku ht kv b kw lj ky lk kg ll kk lm ko ln ld le lf lg lh dt translated">将汤姆的结果与亚当的结果进行比较</li><li id="f237" class="kt ku ht kv b kw lj ky lk kg ll kk lm ko ln ld le lf lg lh dt translated">检查，复查，三次检查所有的东西</li></ul><p id="7f31" class="pw-post-body-paragraph lv lw ht kv b kw lx iu ly ky lz ix ma kg mb mc md kk me mf mg ko mh mi mj ld hm dt translated">我们需要非常彻底，我们讨厌任何人错过他们的-1 CXXL CXT。</p><h1 id="664e" class="mk jw ht bd jx ml mm mn kb mo mp mq kf iz mr ja kj jc ms jd kn jf mt jg kr mu dt translated">参考</h1><p id="7a16" class="pw-post-body-paragraph lv lw ht kv b kw kx iu ly ky kz ix ma kg mv mc md kk mw mf mg ko mx mi mj ld hm dt translated">当然，我们包括了一些回复:</p><p id="2590" class="pw-post-body-paragraph lv lw ht kv b kw lx iu ly ky lz ix ma kg mb mc md kk me mf mg ko mh mi mj ld hm dt translated">【https://github.com/CoolCatsNFTPublic/CoolCatsSimpleSnapShot T4】</p><p id="2536" class="pw-post-body-paragraph lv lw ht kv b kw lx iu ly ky lz ix ma kg mb mc md kk me mf mg ko mh mi mj ld hm dt translated"><a class="ae li" href="https://github.com/CoolCatsNFTPublic/CoolCatsOpenseaCollectionSnapshotting" rel="noopener ugc nofollow" target="_blank">https://github . com/coolcatsnftppublic/CoolCatsOpenseaCollectionSnapshotting</a></p><h1 id="a6cb" class="mk jw ht bd jx ml mm mn kb mo mp mq kf iz mr ja kj jc ms jd kn jf mt jg kr mu dt translated">在哪里可以找到我们:</h1><p id="2851" class="pw-post-body-paragraph lv lw ht kv b kw kx iu ly ky kz ix ma kg mv mc md kk mw mf mg ko mx mi mj ld hm dt translated">推特:<a class="ae li" href="https://twitter.com/xtremetom" rel="noopener ugc nofollow" target="_blank">https://twitter.com/xtremetom</a></p><p id="1020" class="pw-post-body-paragraph lv lw ht kv b kw lx iu ly ky lz ix ma kg mb mc md kk me mf mg ko mh mi mj ld hm dt translated">酷猫战队:<a class="ae li" href="https://twitter.com/coolcatsnft" rel="noopener ugc nofollow" target="_blank">https://twitter.com/coolcatsnft</a></p><p id="b3b5" class="pw-post-body-paragraph lv lw ht kv b kw lx iu ly ky lz ix ma kg mb mc md kk me mf mg ko mh mi mj ld hm dt translated">酷猫不和:<a class="ae li" href="https://t.co/xE2y1NFkKG?amp=1" rel="noopener ugc nofollow" target="_blank">discord.gg/coolcatsnft</a></p><p id="c803" class="pw-post-body-paragraph lv lw ht kv b kw lx iu ly ky lz ix ma kg mb mc md kk me mf mg ko mh mi mj ld hm dt translated"><strong class="kv hu">注:</strong>我觉得这么说很傻，但我想节省人们的时间。我不能在其他项目上帮忙。我很高兴与人交谈，我只是不能投入任何时间来实际编码你的项目——抱歉。</p><div class="nz oa fm fo ob oc"><a href="https://blog.coincodecap.com/best-hardware-wallet-bitcoin" rel="noopener  ugc nofollow" target="_blank"><div class="od ab ej"><div class="oe ab of cl cj og"><h2 class="bd hu fv z el oh eo ep oi er et hs dt translated">存储比特币的最佳加密硬件钱包[2021]</h2><div class="oj l"><h3 class="bd b fv z el oh eo ep oi er et ek translated">保管您的数字资产很容易，但找到正确的存储方式却是一项繁琐的任务。在线钱包有一个风险…</h3></div><div class="ok l"><p class="bd b gc z el oh eo ep oi er et ek translated">blog.coincodecap.com</p></div></div><div class="ol l"><div class="om l on oo op ol oq jt oc"/></div></div></a></div></div></div>    
</body>
</html>