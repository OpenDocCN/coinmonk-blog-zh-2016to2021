<html>
<head>
<title>How to spend all funds from a Lightning Channel</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何花光闪电通道的所有资金</h1>
<blockquote>原文：<a href="https://medium.com/coinmonks/how-to-spend-all-funds-from-a-lightning-channel-44eded09a6dc?source=collection_archive---------5-----------------------#2018-07-26">https://medium.com/coinmonks/how-to-spend-all-funds-from-a-lightning-channel-44eded09a6dc?source=collection_archive---------5-----------------------#2018-07-26</a></blockquote><div><div class="ef hh hi hj hk hl"/><div class="hm hn ho hp hq"><div class=""/><div class=""><h2 id="8dae" class="pw-subtitle-paragraph iq hs ht bd b ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ek translated">该协议建议总是保持一些保留，但是如果各方相互信任，则可能没有必要</h2></div><figure class="jj jk jl jm fq jn fe ff paragraph-image"><div role="button" tabindex="0" class="jo jp di jq bf jr"><div class="fe ff ji"><img src="../Images/a51cb90cc180bfebbfe89734badb048b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*sTWKOBCmNTlXn2dFdtXvQA.jpeg"/></div></div></figure><h2 id="babd" class="ju jv ht bd jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr dt translated">为什么不能花光所有的资金？</h2><p id="b5e6" class="pw-post-body-paragraph ks kt ht ku b kv kw iu kx ky kz ix la kf lb lc ld kj le lf lg kn lh li lj lk hm dt translated"><a class="ae ll" href="https://github.com/lightningnetwork/lightning-rfc/blob/master/02-peer-protocol.md#the-open_channel-message" rel="noopener ugc nofollow" target="_blank">闪电网络规范将</a> <code class="eh lm ln lo lp b">channel_reserve_satoshis</code>定义为另一个节点作为直接支付要保留的最小金额。还建议预留值为渠道总值的<a class="ae ll" href="https://github.com/lightningnetwork/lightning-rfc/blob/master/02-peer-protocol.md#rationale" rel="noopener ugc nofollow" target="_blank"> 1%。“最初，这一储备可能无法满足，因为只有一方有资金；但该协议确保在满足这一储备方面始终有进展，一旦满足，就保持下去。”</a></p><p id="10b5" class="pw-post-body-paragraph ks kt ht ku b kv lq iu kx ky lr ix la kf ls lc ld kj lt lf lg kn lu li lj lk hm dt translated">这一储备作为防范可能的盗窃企图的保险。如果一个对等体试图通过广播旧的信道状态来欺骗，其交易对手可以提交<a class="ae ll" href="https://github.com/lightningnetwork/lightning-rfc/blob/master/00-introduction.md" rel="noopener ugc nofollow" target="_blank">惩罚交易</a>。该事务从行为不当的节点拿走通道上的所有资金作为惩罚。并且<code class="eh lm ln lo lp b">channel_reserve_satoshis</code>确保每个对等体倾向于在信道上有一些保留，至少1%。这样，在博弈论中，每个参与者都有诚实行为的动机。因为如果试图作弊，每个人都会有所损失。</p><p id="9936" class="pw-post-body-paragraph ks kt ht ku b kv lq iu kx ky lr ix la kf ls lc ld kj lt lf lg kn lu li lj lk hm dt translated">虽然这可能有点奇怪，但它是有逻辑的。但在某些情况下，这种矜持可能会比较讨厌。</p><p id="0bc7" class="pw-post-body-paragraph ks kt ht ku b kv lq iu kx ky lr ix la kf ls lc ld kj lt lf lg kn lu li lj lk hm dt translated">当我第一次测试闪电支付时，我只是从一个对等点向另一个对等点发送了1 satoshi。当我意识到我不能把同一个聪送回去时，我很惊讶。因为即使对等体在频道上已经有1个satoshi，它也低于<code class="eh lm ln lo lp b">channel_reserve_satoshis</code>限制，可消费金额仍然为零。</p><p id="92ac" class="pw-post-body-paragraph ks kt ht ku b kv lq iu kx ky lr ix la kf ls lc ld kj lt lf lg kn lu li lj lk hm dt translated">为了演示，除了我的主节点之外，我将启动另一个闪电节点<a class="ae ll" rel="noopener" href="/coinmonks/my-lightning-node-setup-with-c-lightning-45bbb9993c0">。然后我会资助他们之间的一个通道，送1个satoshi。然后检查是否因为储备限制而无法使用。之后，我在对等体的数据库上重写<code class="eh lm ln lo lp b">channel_reserve_satoshis</code>，并将那个satoshi发送回去。</a></p><h1 id="44aa" class="lv jv ht bd jw lw lx ly ka lz ma mb ke iz mc ja ki jc md jd km jf me jg kq mf dt translated">技术细节</h1><figure class="jj jk jl jm fq jn fe ff paragraph-image"><div role="button" tabindex="0" class="jo jp di jq bf jr"><div class="fe ff ji"><img src="../Images/16699e413a4e4850b83017ce524493c3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kQFGsRLNI8iwTxd_ZjuZhg.jpeg"/></div></div></figure><h2 id="e544" class="ju jv ht bd jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr dt translated">第一步:测试节点设置</h2><figure class="jj jk jl jm fq jn"><div class="bz el l di"><div class="mg mh l"/></div></figure><h2 id="6bc9" class="ju jv ht bd jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr dt translated">第二步:向测试节点发送付款</h2><figure class="jj jk jl jm fq jn"><div class="bz el l di"><div class="mg mh l"/></div></figure><h2 id="a2fb" class="ju jv ht bd jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr dt translated">第三步:重新配置信道预留</h2><figure class="jj jk jl jm fq jn"><div class="bz el l di"><div class="mg mh l"/></div></figure><h2 id="c3ce" class="ju jv ht bd jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr dt translated">第四步:把聪放回去</h2><figure class="jj jk jl jm fq jn"><div class="bz el l di"><div class="mg mh l"/></div></figure><h1 id="ba9b" class="lv jv ht bd jw lw lx ly ka lz ma mb ke iz mc ja ki jc md jd km jf me jg kq mf dt translated">结束语</h1><p id="f6e9" class="pw-post-body-paragraph ks kt ht ku b kv kw iu kx ky kz ix la kf lb lc ld kj le lf lg kn lh li lj lk hm dt translated">闪电网络仍处于测试阶段，它可能包含一些错误。</p><p id="f466" class="pw-post-body-paragraph ks kt ht ku b kv lq iu kx ky lr ix la kf ls lc ld kj lt lf lg kn lu li lj lk hm dt translated">我上面描述的绝对不是一个常见的用例，没有经过大量的测试。也许这根本不是一个用例。我认为为此重新配置一个对等体本身是不够的。同伴们可能想强迫他们的伙伴保留一些储备。一个同行可能应该请求其交易对手的许可来使用所有资金。</p><p id="94ad" class="pw-post-body-paragraph ks kt ht ku b kv lq iu kx ky lr ix la kf ls lc ld kj lt lf lg kn lu li lj lk hm dt translated">我只在c-lightning v0.6实现之间测试了这一点。其他版本的行为可能有所不同。</p><p id="3829" class="pw-post-body-paragraph ks kt ht ku b kv lq iu kx ky lr ix la kf ls lc ld kj lt lf lg kn lu li lj lk hm dt translated">耐心点！不计后果！</p></div></div>    
</body>
</html>