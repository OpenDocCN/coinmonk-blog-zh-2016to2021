<html>
<head>
<title>How to Use Table Information on EOS Smart Contracts</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在EOS智能合同中使用表格信息</h1>
<blockquote>原文：<a href="https://medium.com/coinmonks/how-to-use-table-information-on-eos-smart-contracts-de68f7231b62?source=collection_archive---------2-----------------------#2018-07-16">https://medium.com/coinmonks/how-to-use-table-information-on-eos-smart-contracts-de68f7231b62?source=collection_archive---------2-----------------------#2018-07-16</a></blockquote><div><div class="ef hh hi hj hk hl"/><div class="hm hn ho hp hq"><div class=""/><figure class="fi fk ir is it iu fe ff paragraph-image"><div role="button" tabindex="0" class="iv iw di ix bf iy"><div class="fe ff iq"><img src="../Images/fb3aaf9fb229a633edb985b4449b7320.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9Z5-ytrkVCkYshQ9HisatQ.png"/></div></div></figure><p id="1ced" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">在表中存储和处理信息的基本操作通常被称为“CRUD”，代表“创建”、“读取”、“更新”和“删除”。在<a class="ae jz" rel="noopener" href="/coinmonks/using-table-on-eos-smart-contract-291f98312b80"> <strong class="jd hu">上一篇</strong> </a>中，我们讨论了“创建”部分，所以我们将在这篇文章中讨论“读取”、“更新”和“删除”部分。一般来说，您需要为每个函数配置单独的表，但是我们将只使用上一个示例中的<em class="ka"> ttab </em>表，这样我们就可以用最少的配置轻松地处理内容。</p><pre class="kb kc kd ke fq kf kg kh ki aw kj dt"><span id="387b" class="kk kl ht kg b fv km kn l ko kp">            auto iter=ttabs.find(user);<br/>            if(iter==ttabs.end())<br/>            {<br/>                print("need insert\t"); <br/>                ttabs.emplace(_self,[&amp;](auto&amp; ttab)<br/>                {<br/>                    ttab.to = user;<br/>                });<br/>            }<br/>            else<br/>            {<br/>                uint64_t getuser;<br/>                getuser=iter-&gt;to;<br/>                print("data already exist ",name{getuser}," \t");<br/>            }</span></pre><p id="d029" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">在前一个示例中，在action hi部分的else中添加了一个代码。在上面代码的第一行中搜索传递给action hi的用户名，如果没有检索到数据(意味着上面的代码为真)，则创建新数据。如果有检索到的数据，将该数据行的to字段。(else语句上面的两行)。除此之外，还有get()函数作为持久性api，但是在你理解了这篇文章的整个流程之后，最好通过逐个扩展来了解它们。</p><p id="05bd" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">如果您编译并上传合同，则按如下方式执行。</p><pre class="kb kc kd ke fq kf kg kh ki aw kj dt"><span id="0dab" class="kk kl ht kg b fv km kn l ko kp">#cleos push action usersc hi ‘[“testuser”]’ -p usersc</span></pre><figure class="kb kc kd ke fq iu fe ff paragraph-image"><div class="ab fr cl kq"><img src="../Images/5f069bebad6be4d30edfdc5ba322b8e2.png" data-original-src="https://miro.medium.com/v2/format:webp/1*M_bHxN8ADL4FDC597F6-LQ.png"/></div></figure><p id="d6d2" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">因为testuser在上面的表中，所以要打印的是表中的testuser，而不是动作数据中传递的数据。</p><p id="46e3" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">若要删除数据，请添加一个操作。</p><pre class="kb kc kd ke fq kf kg kh ki aw kj dt"><span id="0c6f" class="kk kl ht kg b fv km kn l ko kp">void del(account_name user)<br/>{</span><span id="b3d9" class="kk kl ht kg b fv kr kn l ko kp">}</span></pre><p id="bbc6" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">该方法与前面示例中添加动作的方法相同。因为我们需要需要删除的用户名，所以获取一个帐户名作为参数。为了方便起见，我们将不检查从动作数据接收的用户名是否有效。</p><pre class="kb kc kd ke fq kf kg kh ki aw kj dt"><span id="3e3a" class="kk kl ht kg b fv km kn l ko kp">void del(account_name user)<br/>{<br/>    _ttab ttabs(_self,_self);<br/>    auto iter=ttabs.find(user);<br/>    if(iter!=ttabs.end())<br/>    {<br/>        ttabs.erase(iter);<br/>    }<br/>}</span></pre><p id="90ac" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">实现删除操作。</p><p id="4977" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">类似于我们使用<em class="ka"> create </em>所做的，为第一行和第二行创建一个表的<em class="ka"> multi_index </em>实例，找到接收到的用户信息，并将其分配给迭代器。</p><p id="6ad9" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">如果<em class="ka">的结果在第三行找到</em>的“if(iter！=ttabs.end())"不是最后一个，意味着有数据通过动作传递，</p><p id="cacb" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">用“ttabs.erase(iter)”删除数据。使用multi_index实例的erase()函数，通过传递要删除的迭代器来删除表中的信息。</p><p id="cd42" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">如果在编译和运行合同之前查看该表，</p><pre class="kb kc kd ke fq kf kg kh ki aw kj dt"><span id="7a52" class="kk kl ht kg b fv km kn l ko kp"># cleos get table usersc usersc ttab</span></pre><figure class="kb kc kd ke fq iu fe ff paragraph-image"><div class="ab fr cl kq"><img src="../Images/628e7c8c3d6aa65f532331665a41de0e.png" data-original-src="https://miro.medium.com/v2/format:webp/1*3nDjFCdfXzXHniQ1wh1QMQ.png"/></div></figure><p id="1c4a" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">您可以看到表中存在testuser。</p><pre class="kb kc kd ke fq kf kg kh ki aw kj dt"><span id="8b4f" class="kk kl ht kg b fv km kn l ko kp"># cleos push action usersc del ‘[“testuser”]’ -p usersc</span></pre><p id="86f1" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">尝试运行协定并删除testuser。</p><figure class="kb kc kd ke fq iu fe ff paragraph-image"><div class="ab fr cl kq"><img src="../Images/497e31d9e3d829d48105568fbcd44b66.png" data-original-src="https://miro.medium.com/v2/format:webp/1*dFUmAe2id20CN4skhUr93g.png"/></div></figure><p id="7c86" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">因为没有用于调试的打印语句，所以它结束时没有任何打印。</p><figure class="kb kc kd ke fq iu fe ff paragraph-image"><div class="ab fr cl kq"><img src="../Images/83010ac2f2febbd1c9734be376463b58.png" data-original-src="https://miro.medium.com/v2/format:webp/1*8QOaRYrMG6XRPuQniNn-Gw.png"/></div></figure><p id="c36f" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">修改数据需要修改表。这是因为当前配置的表仅由一个字段组成，而该字段由一个主键组成，因此不能修改。</p><pre class="kb kc kd ke fq kf kg kh ki aw kj dt"><span id="3ab0" class="kk kl ht kg b fv km kn l ko kp">/// <a class="ae jz" href="http://twitter.com/abi" rel="noopener ugc nofollow" target="_blank">@abi</a> table edittab i64<br/>struct edittab<br/>{<br/>    account_name to;<br/>    string tstr;<br/>    uint64_t primary_key() const {return to;}</span><span id="0344" class="kk kl ht kg b fv kr kn l ko kp">EOSLIB_SERIALIZE(edittab,(to)(tstr))<br/>};</span><span id="b49d" class="kk kl ht kg b fv kr kn l ko kp">typedef multi_index&lt;N(edittab),edittab&gt; _etab;</span></pre><p id="b36d" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">在上面创建的表信息下创建新的表信息。新表是一个名为<em class="ka"> edittab </em>的表，它具有字符串信息<em class="ka"> tstr </em>，并以账户信息<em class="ka">到</em>作为主键。因为我们将创建的表中没有任何信息，所以修改可以创建数据行的<em class="ka"> hi动作</em>。</p><pre class="kb kc kd ke fq kf kg kh ki aw kj dt"><span id="a1f0" class="kk kl ht kg b fv km kn l ko kp">void hi(account_name user)<br/>{<br/>    _etab etabs(_self,_self);<br/>            <br/>    auto iter=etabs.find(user);<br/>    if(iter==etabs.end())<br/>    {<br/>        print("need insert\t"); <br/>        etabs.emplace(_self,[&amp;](auto&amp; edittab)<br/>        {<br/>            edittab.to = user;<br/>            edittab.tstr = "test";<br/>        });<br/>    }<br/>    else<br/>    {<br/>        uint64_t getuser;<br/>        getuser=iter-&gt;to;<br/>        print("data already exist ",name{getuser}," \t");<br/>    }<br/>    print("hello, world : ", name{user});<br/>}</span></pre><p id="b538" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">只有上一个示例中的表的引用变量名发生了变化，如果表中没有接收到作为操作数据的帐户信息，则将“test”字符串保存在帐户信息和tstr部分中。</p><pre class="kb kc kd ke fq kf kg kh ki aw kj dt"><span id="5099" class="kk kl ht kg b fv km kn l ko kp">void edit(account_name org)<br/>{<br/>    _etab etabs(_self,_self);<br/>    auto iter=etabs.find(org);<br/>    if(iter!=etabs.end())<br/>    {<br/>        etabs.modify(iter,_self,[&amp;](auto&amp; a)<br/>        {<br/>            a.tstr="tested";<br/>        });<br/>    }<br/>}</span></pre><p id="657b" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">现在添加<em class="ka">编辑</em>动作。到检索给定帐户信息为止，编辑操作与上面的其他示例相同。如果找到相同的帐户，使用<em class="ka">修改</em>功能将字符串“test”修改为“tested”。</p><p id="048e" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">接下来，编译并上传合同。</p><p id="8390" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">由于当前表格的<em class="ka">编辑选项卡</em>没有任何信息，</p><pre class="kb kc kd ke fq kf kg kh ki aw kj dt"><span id="925f" class="kk kl ht kg b fv km kn l ko kp"># cleos push action usersc hi ‘[“a”]’ -p usersc</span></pre><p id="d6bf" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">使用hi操作插入表格。</p><figure class="kb kc kd ke fq iu fe ff paragraph-image"><div class="ab fr cl kq"><img src="../Images/a39d859045da764bf452f3dd83766c39.png" data-original-src="https://miro.medium.com/v2/format:webp/1*eN4v4h3s67R-h-XuwpkUGQ.png"/></div></figure><pre class="kb kc kd ke fq kf kg kh ki aw kj dt"><span id="cc67" class="kk kl ht kg b fv km kn l ko kp"># cleos get table usersc usersc edittab</span></pre><p id="ad1c" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">使用上面的命令来检查表格。</p><figure class="kb kc kd ke fq iu fe ff paragraph-image"><div class="ab fr cl kq"><img src="../Images/02b4dff700bde26f67102b4219b2e871.png" data-original-src="https://miro.medium.com/v2/format:webp/1*uklBeS92pbtBdmeUx2TRuw.png"/></div></figure><p id="1ae4" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">请注意，“a”用户包含字符串“test”。</p><pre class="kb kc kd ke fq kf kg kh ki aw kj dt"><span id="9867" class="kk kl ht kg b fv km kn l ko kp"># cleos push action usersc edit ‘[“a”]’ -p usersc</span></pre><p id="9b49" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">调用编辑操作进行修改。</p><pre class="kb kc kd ke fq kf kg kh ki aw kj dt"><span id="a8b3" class="kk kl ht kg b fv km kn l ko kp"># cleos get table usersc usersc edittab</span></pre><p id="7bcd" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">使用上面的命令来检查表格。</p><figure class="kb kc kd ke fq iu fe ff paragraph-image"><div class="ab fr cl kq"><img src="../Images/0ca42c3cc1f2d87f3c5f1471c660281f.png" data-original-src="https://miro.medium.com/v2/format:webp/1*IzMHtlsiM-O5jSKLNcwpDA.png"/></div></figure><p id="dc85" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">您可以看到表中的信息已经更改。</p><p id="1ee9" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">这使得在EOS中通过CRUD处理信息成为可能。虽然这是一个简单的例子，但是如果你现在看看官方文件的其他例子，就会比以前更容易理解。</p><p id="dc2c" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">尽管在修改时表的设计有一点小问题，尽管这个例子没有完全清楚地展示一个契约如何被用来使用多个表，我们仍然继续进行。</p><p id="6d65" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">下面是我们在这篇文章中使用的代码。</p><pre class="kb kc kd ke fq kf kg kh ki aw kj dt"><span id="fb82" class="kk kl ht kg b fv km kn l ko kp">#include &lt;eosiolib/eosio.hpp&gt;<br/>#include &lt;eosiolib/print.hpp&gt;</span><span id="aa6f" class="kk kl ht kg b fv kr kn l ko kp">using namespace eosio;<br/>using namespace std;</span><span id="761b" class="kk kl ht kg b fv kr kn l ko kp">class hello : public eosio::contract <br/>{<br/>    public:<br/>        using contract::contract;</span><span id="a159" class="kk kl ht kg b fv kr kn l ko kp">/// <a class="ae jz" href="http://twitter.com/abi" rel="noopener ugc nofollow" target="_blank">@abi</a> table ttab i64<br/>        struct ttab<br/>        {<br/>            account_name to;<br/>            uint64_t primary_key() const {return to;}</span><span id="2a9d" class="kk kl ht kg b fv kr kn l ko kp">EOSLIB_SERIALIZE(ttab,(to))<br/>        };</span><span id="cdf6" class="kk kl ht kg b fv kr kn l ko kp">typedef multi_index&lt;N(ttab),ttab&gt; _ttab;</span><span id="b23f" class="kk kl ht kg b fv kr kn l ko kp">/// <a class="ae jz" href="http://twitter.com/abi" rel="noopener ugc nofollow" target="_blank">@abi</a> table edittab i64<br/>        struct edittab<br/>        {<br/>            account_name to;<br/>            string tstr;<br/>            uint64_t primary_key() const {return to;}</span><span id="5532" class="kk kl ht kg b fv kr kn l ko kp">EOSLIB_SERIALIZE(edittab,(to)(tstr))<br/>        };</span><span id="1401" class="kk kl ht kg b fv kr kn l ko kp">typedef multi_index&lt;N(edittab),edittab&gt; _etab;</span><span id="ccef" class="kk kl ht kg b fv kr kn l ko kp">/// <a class="ae jz" href="http://twitter.com/abi" rel="noopener ugc nofollow" target="_blank">@abi</a> action<br/>        void hi(account_name user)<br/>        {<br/>             _etab etabs(_self,_self);<br/>            <br/>            auto iter=etabs.find(user);<br/>            if(iter==etabs.end())<br/>            {<br/>                print("need insert\t"); <br/>                etabs.emplace(_self,[&amp;](auto&amp; edittab)<br/>                {<br/>                    edittab.to = user;<br/>                    edittab.tstr = "test";<br/>                });<br/>            }<br/>            else<br/>            {<br/>                uint64_t getuser;<br/>                getuser=iter-&gt;to;<br/>                print("data already exist ",name{getuser}," \t");<br/>            }<br/>            print("hello, world : ", name{user}, " 10");<br/>        }</span><span id="10aa" class="kk kl ht kg b fv kr kn l ko kp">void del(account_name user)<br/>        {<br/>            _etab etabs(_self,_self);<br/>            auto iter=etabs.find(user);<br/>            if(iter!=etabs.end())<br/>            {<br/>                etabs.erase(iter);<br/>            }<br/>        }</span><span id="5e32" class="kk kl ht kg b fv kr kn l ko kp">void edit(account_name org)<br/>        {<br/>             _etab etabs(_self,_self);<br/>            auto iter=etabs.find(org);<br/>            if(iter!=etabs.end())<br/>            {<br/>                etabs.modify(iter,_self,[&amp;](auto&amp; a)<br/>                {<br/>                    a.tstr="tested";<br/>                });<br/>            }<br/>        }<br/>};</span><span id="f3ea" class="kk kl ht kg b fv kr kn l ko kp">EOSIO_ABI(hello,(hi)(del)(edit))</span></pre><p id="2edf" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">继上一篇文章之后，我们讨论了如何使用智能合同的表格信息。</p></div><div class="ab cl ks kt hb ku" role="separator"><span class="kv bw bk kw kx ky"/><span class="kv bw bk kw kx ky"/><span class="kv bw bk kw kx"/></div><div class="hm hn ho hp hq"><h2 id="139e" class="kk kl ht bd kz la lb lc ld le lf lg lh jm li lj lk jq ll lm ln ju lo lp lq lr dt translated">ITAM游戏是一个透明的游戏生态系统的区块链平台</h2><p id="5d69" class="pw-post-body-paragraph jb jc ht jd b je ls jg jh ji lt jk jl jm lu jo jp jq lv js jt ju lw jw jx jy hm dt translated">订阅ITAM游戏并接收最新信息。</p><p id="4717" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">访问ITAM游戏电讯，就ITAM游戏和区块链进行交流。点击下面的链接加入！👫</p><p id="1e2d" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">网址:<strong class="jd hu"/><a class="ae jz" href="https://itam.games" rel="noopener ugc nofollow" target="_blank">https://itam . games</a><strong class="jd hu"><br/></strong>电报:【https://t.me/itamgames】T21</p></div></div>    
</body>
</html>