<html>
<head>
<title>Play Rock Paper Scissors Using the ESP2866</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用ESP2866玩石头剪刀布</h1>
<blockquote>原文：<a href="https://medium.com/coinmonks/play-rock-paper-scissors-using-the-esp2866-5304cc4b6488?source=collection_archive---------12-----------------------#2018-07-04">https://medium.com/coinmonks/play-rock-paper-scissors-using-the-esp2866-5304cc4b6488?source=collection_archive---------12-----------------------#2018-07-04</a></blockquote><div><div class="ef hh hi hj hk hl"/><div class="hm hn ho hp hq"><div class=""/><figure class="fi fk ir is it iu fe ff paragraph-image"><div role="button" tabindex="0" class="iv iw di ix bf iy"><div class="fe ff iq"><img src="../Images/9e8bbab6421a73dc8fcf45ea30c0f1e9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*CtoUAxqGUbzzzc9W.png"/></div></div></figure><p id="1ad9" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">在本教程中，我们将使用ESP8266、Wia仪表板和Github构建一个在线石头、剪子、布游戏。</p><h1 id="d730" class="jz ka ht bd kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw dt translated">你需要什么</h1><ul class=""><li id="d8d6" class="kx ky ht jd b je kz ji la jm lb jq lc ju ld jy le lf lg lh dt translated">2个ESP8266</li><li id="5e61" class="kx ky ht jd b je li ji lj jm lk jq ll ju lm jy le lf lg lh dt translated">2根微型USB转USB电缆</li></ul><p id="7acd" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">开始之前，您必须有一个Wia帐户。<a class="ae ln" href="https://dashboard.wia.io/login" rel="noopener ugc nofollow" target="_blank">您可以在这里创建一个</a>。</p><p id="810d" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">如果您还没有使用Arduino设置您的ESP8266，您需要先这样做。本教程将告诉你如何去做。</p><h1 id="e8e1" class="jz ka ht bd kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw dt translated">入门指南</h1><p id="ab90" class="pw-post-body-paragraph jb jc ht jd b je kz jg jh ji la jk jl jm lo jo jp jq lp js jt ju lq jw jx jy hm dt translated">首先，将USB电缆连接到其中一个ESP8266，并将其插入您的计算机或笔记本电脑。</p><p id="fe85" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">打开Arduino IDE。你可以在这里下载的最新版本。在Arduino IDE中，创建一个新的草图并另存为<code class="eh lr ls lt lu b">playerOne.ino</code>。创建第二个草图，将其命名为<code class="eh lr ls lt lu b">playerTwo.ino</code>。</p><p id="fece" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">接下来，导航到Wia仪表板，创建一个新的<code class="eh lr ls lt lu b">space</code>和<code class="eh lr ls lt lu b">add device</code>。给它起个类似“playerOne”的名字。</p><figure class="lw lx ly lz fq iu fe ff paragraph-image"><div role="button" tabindex="0" class="iv iw di ix bf iy"><div class="fe ff lv"><img src="../Images/e8f02530326e802cb2a6e8ce10738650.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*c7XDqeResYFk26Q2.png"/></div></div></figure><p id="74cb" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">添加设备后，导航至页面左侧的<code class="eh lr ls lt lu b">Devices</code>选项卡。选择您的设备，然后导航至<code class="eh lr ls lt lu b">configuration</code>选项卡。您将看到您的设备ID以及您的<code class="eh lr ls lt lu b">device_secret_key</code>。稍后您将需要设备密钥。</p><h1 id="71a2" class="jz ka ht bd kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw dt translated">代码</h1><p id="2739" class="pw-post-body-paragraph jb jc ht jd b je kz jg jh ji la jk jl jm lo jo jp jq lp js jt ju lq jw jx jy hm dt translated">将以下代码复制并粘贴到名为playerOne.ino的Arduino草图中。</p><pre class="lw lx ly lz fq ma lu mb mc aw md dt"><span id="9f06" class="me ka ht lu b fv mf mg l mh mi">#<strong class="lu hu">include</strong> &lt;Arduino.h&gt;<br/>#<strong class="lu hu">include</strong> &lt;ESP8266WiFi.h&gt;<br/>#<strong class="lu hu">include</strong> &lt;ESP8266WiFiMulti.h&gt;<br/>#<strong class="lu hu">include</strong> &lt;ESP8266HTTPClient.h&gt;</span><span id="1684" class="me ka ht lu b fv mj mg l mh mi">#<strong class="lu hu">define</strong> USE_SERIAL Serial</span><span id="239a" class="me ka ht lu b fv mj mg l mh mi">ESP8266WiFiMulti WiFiMulti;</span><span id="1f41" class="me ka ht lu b fv mj mg l mh mi"><strong class="lu hu">const</strong> <strong class="lu hu">char</strong>* ssid     = "name-of-your-Wifi";<br/><strong class="lu hu">const</strong> <strong class="lu hu">char</strong>* password = "your-Wifi-Password";</span><span id="5d59" class="me ka ht lu b fv mj mg l mh mi">// get this from the wia dashboard. it should start with `d_sk`</span><span id="8cb2" class="me ka ht lu b fv mj mg l mh mi"><strong class="lu hu">const</strong> <strong class="lu hu">char</strong>* device_secret_key = "your-device-secret-key";</span><span id="3715" class="me ka ht lu b fv mj mg l mh mi">boolean buttonState = HIGH;<br/>boolean buttonDown = false;</span><span id="e111" class="me ka ht lu b fv mj mg l mh mi"><strong class="lu hu">void</strong> <strong class="lu hu">setup</strong>() {<br/>  // put your setup code here, to run once:<br/>  pinMode(0, INPUT);<br/>  Serial.begin(115200);<br/>  <strong class="lu hu">while</strong> (!Serial) {<br/>    ; // wait for serial port to connect. Needed for native USB port only<br/>  }<br/>  WiFi.mode(WIFI_STA);<br/>  WiFiMulti.addAP(ssid, password);<br/>}</span><span id="a5b9" class="me ka ht lu b fv mj mg l mh mi"><strong class="lu hu">void</strong> <strong class="lu hu">loop</strong>() {<br/>  // put your main code here, to run repeatedly:<br/>  buttonState = digitalRead(0);<br/>  // check if the pushbutton is pressed.<br/>  // if it is, the buttonState is LOW:<br/>  <strong class="lu hu">if</strong> (buttonState == LOW) {<br/>    <strong class="lu hu">if</strong> (buttonDown == false) {<br/>      Serial.println("Button Pushed");<br/>      buttonDown = true;<br/>      postToWia();<br/>      delay(750);<br/>    }<br/>  } <strong class="lu hu">else</strong> {<br/>    buttonDown = false;<br/>  }<br/>}</span><span id="f6b2" class="me ka ht lu b fv mj mg l mh mi"><strong class="lu hu">void</strong> <strong class="lu hu">postToWia</strong>() {<br/>  // wait for WiFi connection<br/>  <strong class="lu hu">if</strong>((WiFiMulti.run() == WL_CONNECTED)) {<br/>    HTTPClient http;<br/>    USE_SERIAL.print("[HTTP] begin...\n");<br/>    // configure wia rest api<br/>    http.begin("http://api.wia.io/v1/events");<br/>    USE_SERIAL.print("[HTTP] POST...\n");</span><span id="75ed" class="me ka ht lu b fv mj mg l mh mi">    // set authorization token<br/>    http.addHeader("Authorization", "Bearer " + String(device_secret_key));<br/>    // set content-type to json<br/>    http.addHeader("Content-Type", "application/json");<br/>    // start connection and send HTTP headers. replace name and data values with your own.<br/>    <strong class="lu hu">int</strong> httpCode = http.POST("{\"name\":\"buttonPress\"}");<br/>    // httpCode will be negative on error<br/>   <br/>    <strong class="lu hu">if</strong>(httpCode &gt; 0) {<br/>        // HTTP header has been send and Server response header has been handled<br/>        USE_SERIAL.printf("[HTTP] POST... code: %d\n", httpCode);<br/>        // file found at server<br/>        <strong class="lu hu">if</strong>(httpCode == HTTP_CODE_OK) {<br/>            String payload = http.getString();<br/>            USE_SERIAL.println(payload);<br/>        }<br/>    } <strong class="lu hu">else</strong> {<br/>        USE_SERIAL.printf("[HTTP] POST... failed, error: %s\n", http.errorToString(httpCode).c_str());<br/>    }<br/>    http.end();<br/>  }<br/>}</span></pre><p id="fbea" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">更改以下值:</p><ul class=""><li id="84c1" class="kx ky ht jd b je jf ji jj jm mk jq ml ju mm jy le lf lg lh dt translated"><code class="eh lr ls lt lu b">name-of-your-WiFi</code>到您的WiFi的名称。这必须是您的电脑正在使用的同一个WiFi网络。</li><li id="82a3" class="kx ky ht jd b je li ji lj jm lk jq ll ju lm jy le lf lg lh dt translated"><code class="eh lr ls lt lu b">your-WiFi-password</code>输入您的WiFi网络密码</li><li id="19d7" class="kx ky ht jd b je li ji lj jm lk jq ll ju lm jy le lf lg lh dt translated"><code class="eh lr ls lt lu b">you-device-secret-key</code>您的设备密钥，可在Wia仪表盘的<code class="eh lr ls lt lu b">Devices &gt; Configuration</code>下找到</li></ul><p id="105f" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">点击Arduino IDE中的<code class="eh lr ls lt lu b">upload</code>将代码上传至您的设备。然后，将您的设备放在一边。记住这个设备是<code class="eh lr ls lt lu b">playerOne</code>并且包含playerOne代码。</p><p id="9abf" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">将第二台设备连接到您的计算机，并将其添加到您在Wia仪表板中的共享空间。这个设备将有一个完全不同的<code class="eh lr ls lt lu b">device-secret-key</code>。从配置选项卡中收集密钥。将之前的代码复制并粘贴到Arduino文件<code class="eh lr ls lt lu b">playerTwo.ino</code>中，但更改<code class="eh lr ls lt lu b">device-secret-key</code>以匹配第二个设备。</p><p id="e04b" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">将文件<code class="eh lr ls lt lu b">playerTwo.ino</code>中的代码上传到您的第二个设备上。</p><h1 id="83e9" class="jz ka ht bd kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw dt translated">Wia流程</h1><p id="c478" class="pw-post-body-paragraph jb jc ht jd b je kz jg jh ji la jk jl jm lo jo jp jq lp js jt ju lq jw jx jy hm dt translated">现在，在您的Wia仪表板中，单击左侧边栏中的<code class="eh lr ls lt lu b">Flows</code>。创建一个新的流程，随便你怎么命名。</p><p id="8a7d" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">从trigger选项卡中拖动一个<code class="eh lr ls lt lu b">Event</code>，并将其命名为buttonPress。选择两个设备。</p><figure class="lw lx ly lz fq iu fe ff paragraph-image"><div role="button" tabindex="0" class="iv iw di ix bf iy"><div class="fe ff mn"><img src="../Images/f7a0eee382a503b54b4f9de6354261ef.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*4S9UfZ7Riy_uojgK.png"/></div></div></figure><p id="baa3" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">在<code class="eh lr ls lt lu b">logic</code>选项卡中，拖动一个<code class="eh lr ls lt lu b">run-function</code>节点。将黄点从<code class="eh lr ls lt lu b">Event</code>节点拖到<code class="eh lr ls lt lu b">run-function</code>节点。在框中，复制并粘贴以下代码:</p><pre class="lw lx ly lz fq ma lu mb mc aw md dt"><span id="6a2a" class="me ka ht lu b fv mf mg l mh mi"><strong class="lu hu">var</strong> items = [<br/>    '🗿',<br/>    '📜',<br/>    '✂'<br/>];</span><span id="2dae" class="me ka ht lu b fv mj mg l mh mi"><strong class="lu hu">var</strong> item = items[Math.floor(Math.random()*items.length)];<br/>output.body.data = item;</span></pre><p id="e340" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">您的屏幕应该是这样的:</p><figure class="lw lx ly lz fq iu fe ff paragraph-image"><div role="button" tabindex="0" class="iv iw di ix bf iy"><div class="fe ff mo"><img src="../Images/b33d7c82eb64056ad63d53ef3d45d710.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*8gLsXYur13oW2NP6.png"/></div></div></figure><p id="c866" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">点击<code class="eh lr ls lt lu b">Update</code>。<br/>然后，在<code class="eh lr ls lt lu b">action</code>选项卡中，拖动一个<code class="eh lr ls lt lu b">event</code>并将其命名为<code class="eh lr ls lt lu b">emoji</code>。要连接节点，请拖动橙色的点。您的屏幕应该是这样的:</p><figure class="lw lx ly lz fq iu fe ff paragraph-image"><div role="button" tabindex="0" class="iv iw di ix bf iy"><div class="fe ff mp"><img src="../Images/27ce5ac064000f6f1d6ab9f194cc7864.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*v3fj5geF9hMgSvpj.png"/></div></div></figure><p id="f2d9" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">接下来，导航至<code class="eh lr ls lt lu b">Devices &gt; playerOne</code>。这将带您进入设备的概览页面。在右上角，点击<code class="eh lr ls lt lu b">add a widget</code>。标题写<code class="eh lr ls lt lu b">emoji</code>，事件写<code class="eh lr ls lt lu b">emoji</code>。然后，导航回侧边栏上的<code class="eh lr ls lt lu b">Devices</code>，选择您的设备进行<code class="eh lr ls lt lu b">playerTwo</code>。创建一个新的小部件，为标题编写<code class="eh lr ls lt lu b">emoji</code>，为事件编写<code class="eh lr ls lt lu b">emoji</code>。</p><figure class="lw lx ly lz fq iu fe ff paragraph-image"><div role="button" tabindex="0" class="iv iw di ix bf iy"><div class="fe ff mq"><img src="../Images/8825bc19209531f221831939256ad05d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*QIj4T3HvNsw3EFZ8.png"/></div></div></figure><p id="9513" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">将两个设备都插入电脑。按下两个装置上的<code class="eh lr ls lt lu b">flash</code>按钮。你的小工具将显示设备是选择石头、布还是剪刀。</p><p id="a830" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">然而，在两个设备之间导航并不是玩游戏的有效方式。所以，我们必须制作一个网页，同时向我们展示每个玩家的选择结果。</p><p id="c920" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">为此，我们将使用Github。你可以在这里创建一个账户。</p><h1 id="0fef" class="jz ka ht bd kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw dt translated">网页</h1><p id="6805" class="pw-post-body-paragraph jb jc ht jd b je kz jg jh ji la jk jl jm lo jo jp jq lp js jt ju lq jw jx jy hm dt translated">首先登录Github。创建一个新的存储库，并将其命名为your-github-username.github.io。</p><p id="ff87" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">创建存储库后，将其打开。点击<code class="eh lr ls lt lu b">create new file</code>。将下面的代码复制粘贴到一个名为<code class="eh lr ls lt lu b">index.html</code>的文件中。文件<strong class="jd hu">必须</strong>命名为index.html。</p><pre class="lw lx ly lz fq ma lu mb mc aw md dt"><span id="05fa" class="me ka ht lu b fv mf mg l mh mi">&lt;!DOCTYPE html&gt;<br/>&lt;<strong class="lu hu">html</strong>&gt;<br/>  &lt;<strong class="lu hu">head</strong>&gt;<br/>    &lt;<strong class="lu hu">meta</strong> charset="UTF-8"&gt;<br/>    &lt;<strong class="lu hu">title</strong>&gt;Wia Game&lt;/<strong class="lu hu">title</strong>&gt;<br/>  &lt;/<strong class="lu hu">head</strong>&gt;<br/>  &lt;<strong class="lu hu">body</strong>&gt;<br/>    &lt;<strong class="lu hu">h1</strong>&gt;Wia Rock Paper Scissors&lt;/<strong class="lu hu">h1</strong>&gt;<br/>  &lt;/<strong class="lu hu">body</strong>&gt;<br/>&lt;/<strong class="lu hu">html</strong>&gt;</span></pre><p id="16b4" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">这是HTML样板文件。为了实时查看我们的游戏更新，我们需要嵌入来自Wia的小部件。回到Wia仪表板，导航到两个播放器设备之一。在概览中，您可以看到您的小部件。单击小部件右上角带箭头的框。选择设置<code class="eh lr ls lt lu b">anyone can view this widget</code>。复制代码以嵌入小部件。代码以&lt; iframe &gt;开始，以&lt; /iframe &gt;结束。</p><p id="adbc" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">回到GitHub，编辑<code class="eh lr ls lt lu b">index.html</code>文件。将小部件代码粘贴在标题<code class="eh lr ls lt lu b">&lt;h1&gt;Wia Rock Paper Scissors&lt;/h1&gt;</code>下。</p><p id="a438" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">对另一台设备的小部件重复此操作。现在，您的HTML文件应该如下所示:</p><pre class="lw lx ly lz fq ma lu mb mc aw md dt"><span id="625a" class="me ka ht lu b fv mf mg l mh mi">&lt;!DOCTYPE html&gt;<br/>&lt;<strong class="lu hu">html</strong>&gt;<br/>  &lt;<strong class="lu hu">head</strong>&gt;<br/>    &lt;<strong class="lu hu">meta</strong> charset="UTF-8"&gt;<br/>    &lt;<strong class="lu hu">title</strong>&gt;Wia Game&lt;/<strong class="lu hu">title</strong>&gt;<br/>  &lt;/<strong class="lu hu">head</strong>&gt;<br/>  &lt;<strong class="lu hu">body</strong>&gt;<br/>    &lt;<strong class="lu hu">h1</strong>&gt;Wia Rock Paper Scissors&lt;/<strong class="lu hu">h1</strong>&gt;<br/>    &lt;<strong class="lu hu">iframe</strong>&gt; YOUR WIDGET &lt;/<strong class="lu hu">iframe</strong>&gt;<br/>    &lt;<strong class="lu hu">iframe</strong>&gt; YOUR SECOND WIDGET &lt;/<strong class="lu hu">iframe</strong>&gt;<br/>  &lt;/<strong class="lu hu">body</strong>&gt;<br/>  &lt;/<strong class="lu hu">html</strong>&gt;</span></pre><p id="af96" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">要查看您的新网页，请导航至<code class="eh lr ls lt lu b"><a class="ae ln" href="https://your-github-username.github.io/" rel="noopener ugc nofollow" target="_blank">https://your-github-username.github.io/</a></code></p><p id="cc3f" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">这就是你的游戏！</p></div></div>    
</body>
</html>