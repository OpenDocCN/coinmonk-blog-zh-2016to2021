<html>
<head>
<title>Operational Transformations as an algorithm for automatic conflict resolution</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">作为自动冲突解决算法的运算变换</h1>
<blockquote>原文：<a href="https://medium.com/coinmonks/operational-transformations-as-an-algorithm-for-automatic-conflict-resolution-3bf8920ea447?source=collection_archive---------1-----------------------#2018-07-18">https://medium.com/coinmonks/operational-transformations-as-an-algorithm-for-automatic-conflict-resolution-3bf8920ea447?source=collection_archive---------1-----------------------#2018-07-18</a></blockquote><div><div class="ef hh hi hj hk hl"/><div class="hm hn ho hp hq"><div class=""/><figure class="fi fk ir is it iu fe ff paragraph-image"><div role="button" tabindex="0" class="iv iw di ix bf iy"><div class="fe ff iq"><img src="../Images/1f9ec1836f2cf38375508291f860c1bd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WugogUgUvQj1dOcL-T7A7A.jpeg"/></div></div></figure></div><div class="ab cl jb jc hb jd" role="separator"><span class="je bw bk jf jg jh"/><span class="je bw bk jf jg jh"/><span class="je bw bk jf jg"/></div><div class="hm hn ho hp hq"><h1 id="8f5e" class="ji jj ht bd jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf dt translated">1.介绍</h1><p id="8fd4" class="pw-post-body-paragraph kg kh ht ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld hm dt translated">具有多个引导节点的分布式系统中的自动冲突解决算法是一个非常有趣的研究领域。在这个领域有不同的方法和算法，它们都有自己的权衡，在本文中，我们将重点介绍Operational Transformation技术，该技术旨在解决协作编辑应用程序(如Google Docs或Etherpad)中的冲突。</p><p id="cd45" class="pw-post-body-paragraph kg kh ht ki b kj le kl km kn lf kp kq kr lg kt ku kv lh kx ky kz li lb lc ld hm dt translated">从开发的角度来看，协作编辑是一项很难解决的任务，因为客户几乎可以同时对文本的相同部分进行修改。为了模仿即时响应，每个客户端都必须维护自己的文档本地副本，否则客户端将不得不等到他们的更改与其他客户端同步，这可能会花费大量的时间。因此，协作编辑中的主要问题是确保本地副本之间的<em class="lj">一致性</em>，即所有副本都必须<em class="lj">收敛</em>到文档的相同、正确版本(请注意，我们不能要求所有副本在某个时间点都具有文档的相同副本，因为编辑过程可能是无止境的)。</p><h2 id="16b3" class="lk jj ht bd jk ll lm ln jo lo lp lq js kr lr ls jw kv lt lu ka kz lv lw ke lx dt translated">1.1谷歌文档的第一版</h2><p id="e2cb" class="pw-post-body-paragraph kg kh ht ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld hm dt translated">谷歌文档的第一个版本(以及其他类似的应用程序)使用了文档版本的比较。假设我们有两个客户——爱丽丝和鲍勃，他们的文档是同步的。当服务器收到Alice的更改时，它会计算她的版本和它的版本之间的差异，并尝试合并它们。然后，服务器将合并后的版本发送给鲍勃。如果Bob有自己的未发送更改，他会尝试将收到的服务器版本与自己的合并。重复这个过程。</p><p id="0596" class="pw-post-body-paragraph kg kh ht ki b kj le kl km kn lf kp kq kr lg kt ku kv lh kx ky kz li lb lc ld hm dt translated">通常，这种方法不会很好地工作。例如，假设爱丽丝、鲍勃和服务器从同步的文档“快速棕色狐狸”开始。</p><figure class="lz ma mb mc fq iu fe ff paragraph-image"><div role="button" tabindex="0" class="iv iw di ix bf iy"><div class="fe ff ly"><img src="../Images/04fa370f28763fa2ee610812c9c1c970.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4EUfGIIaP6NqIFF-5c_cJQ.png"/></div></div></figure><p id="3994" class="pw-post-body-paragraph kg kh ht ki b kj le kl km kn lf kp kq kr lg kt ku kv lh kx ky kz li lb lc ld hm dt translated">爱丽丝用粗体字表示“棕色狐狸”，同时鲍勃把“狐狸”改为“狗”。Alice的更改首先到达服务器，它应用并进一步将更改发送给Bob。合并的正确结果应该是“快速的<strong class="ki hu">棕色狗”</strong>，但是合并算法没有足够的信息来执行正确的合并。从他们的角度看“麻利的<strong class="ki hu">褐狐</strong>犬”、“麻利的<strong class="ki hu">褐</strong>犬”、“麻利的<strong class="ki hu">褐</strong>犬<strong class="ki hu">狐</strong>都是正确有效的结果。(在git中的这种情况下，您会有合并冲突，并且您必须手动合并)。因此，这就是主要问题——我们不能依靠这种方法进行合并。</p><h2 id="7bf5" class="lk jj ht bd jk ll lm ln jo lo lp lq js kr lr ls jw kv lt lu ka kz lv lw ke lx dt translated">1.2最新谷歌文档版本</h2><p id="d238" class="pw-post-body-paragraph kg kh ht ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld hm dt translated">最新的谷歌文档版本遵循另一种方法——将文档存储为一系列操作，并按顺序应用它们(这里的顺序是指<a class="ae md" href="https://en.wikipedia.org/wiki/Total_order" rel="noopener ugc nofollow" target="_blank">总顺序</a>)，而不是比较文档的版本。</p><p id="30c4" class="pw-post-body-paragraph kg kh ht ki b kj le kl km kn lf kp kq kr lg kt ku kv lh kx ky kz li lb lc ld hm dt translated">好的，现在我们需要理解<strong class="ki hu">何时</strong>应用变更——我们需要<em class="lj">合作协议</em>。在谷歌文档中，所有操作都可以归结为3种可能的类型:</p><ul class=""><li id="c44f" class="me mf ht ki b kj le kn lf kr mg kv mh kz mi ld mj mk ml mm dt translated">插入文本</li><li id="368e" class="me mf ht ki b kj mn kn mo kr mp kv mq kz mr ld mj mk ml mm dt translated">删除文本</li><li id="351a" class="me mf ht ki b kj mn kn mo kr mp kv mq kz mr ld mj mk ml mm dt translated">应用样式</li></ul><p id="5a07" class="pw-post-body-paragraph kg kh ht ki b kj le kl km kn lf kp kq kr lg kt ku kv lh kx ky kz li lb lc ld hm dt translated">当您编辑文档时，所有的更改都以这三种类型之一附加到变更日志中，并且当您打开文档时，变更日志会从某个点重放。</p><p id="8ce6" class="pw-post-body-paragraph kg kh ht ki b kj le kl km kn lf kp kq kr lg kt ku kv lh kx ky kz li lb lc ld hm dt translated">(有OT支持的第一个(公共)谷歌项目是Google Wave，其可能的操作集要丰富得多)</p><h2 id="35f9" class="lk jj ht bd jk ll lm ln jo lo lp lq js kr lr ls jw kv lt lu ka kz lv lw ke lx dt translated">1.3示例</h2><p id="0ce2" class="pw-post-body-paragraph kg kh ht ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld hm dt translated">让爱丽丝和鲍勃从一个同步的文档“生命2017”开始。</p><p id="a509" class="pw-post-body-paragraph kg kh ht ki b kj le kl km kn lf kp kq kr lg kt ku kv lh kx ky kz li lb lc ld hm dt translated">Alice将2017年更改为2018年，这实际上创建了两个操作:</p><figure class="lz ma mb mc fq iu fe ff paragraph-image"><div class="fe ff ms"><img src="../Images/2b3f9956fac88503f594a2606e0d70af.png" data-original-src="https://miro.medium.com/v2/resize:fit:1300/format:webp/1*iCijf5TLS_J1O6fG2WyBPA.png"/></div></figure><p id="4dbb" class="pw-post-body-paragraph kg kh ht ki b kj le kl km kn lf kp kq kr lg kt ku kv lh kx ky kz li lb lc ld hm dt translated">同时，Bob将文本更改为“2017年疯狂生活”:</p><figure class="lz ma mb mc fq iu fe ff paragraph-image"><div role="button" tabindex="0" class="iv iw di ix bf iy"><div class="fe ff mt"><img src="../Images/29563585d743803a587e7d0f996b6a6c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*sEYQSYhBbN4af3170YSXYA.png"/></div></div></figure><p id="65fb" class="pw-post-body-paragraph kg kh ht ki b kj le kl km kn lf kp kq kr lg kt ku kv lh kx ky kz li lb lc ld hm dt translated">如果Bob在收到Alice的删除操作时只是应用了它，那么他得到了一个不正确的文档(数字7应该被删除了):</p><figure class="lz ma mb mc fq iu fe ff paragraph-image"><div role="button" tabindex="0" class="iv iw di ix bf iy"><div class="fe ff mu"><img src="../Images/d3c0251c21ab6758b3be6dffadf9e27d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_tFzPFx3HOJLGDCsiNh1Qw.png"/></div></div></figure><p id="f2d7" class="pw-post-body-paragraph kg kh ht ki b kj le kl km kn lf kp kq kr lg kt ku kv lh kx ky kz li lb lc ld hm dt translated">Bob需要将删除操作转换为相应的本地更改，以获得文档的正确状态:</p><figure class="lz ma mb mc fq iu fe ff paragraph-image"><div role="button" tabindex="0" class="iv iw di ix bf iy"><div class="fe ff mv"><img src="../Images/10f2de85b7bd70c863572f6398434dbf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*AV8lESOJQJ4kkrxaszMY6Q.png"/></div></div></figure><figure class="lz ma mb mc fq iu fe ff paragraph-image"><div role="button" tabindex="0" class="iv iw di ix bf iy"><div class="fe ff mw"><img src="../Images/0d4c77a6aef55f99a073b9f0ffc9d08d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BLGt84jccv_fsUZIStqBmw.png"/></div></div></figure><p id="bc68" class="pw-post-body-paragraph kg kh ht ki b kj le kl km kn lf kp kq kr lg kt ku kv lh kx ky kz li lb lc ld hm dt translated">现在它是完美的。</p><p id="1226" class="pw-post-body-paragraph kg kh ht ki b kj le kl km kn lf kp kq kr lg kt ku kv lh kx ky kz li lb lc ld hm dt translated">为了使它更正式，让我们考虑以下示例:</p><figure class="lz ma mb mc fq iu fe ff paragraph-image"><div role="button" tabindex="0" class="iv iw di ix bf iy"><div class="fe ff mx"><img src="../Images/38e73ab9138b4306b077b124735a5348.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wl7dBOXFv6AuKNVpUDcKWg.png"/></div></div></figure><p id="40a9" class="pw-post-body-paragraph kg kh ht ki b kj le kl km kn lf kp kq kr lg kt ku kv lh kx ky kz li lb lc ld hm dt translated">然后</p><figure class="lz ma mb mc fq iu fe ff paragraph-image"><div role="button" tabindex="0" class="iv iw di ix bf iy"><div class="fe ff my"><img src="../Images/e901f5fd77ca8b4531a2510809f2e507.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pmB7gNDy6C8exEqtdk_wAQ.png"/></div></div></figure><p id="c805" class="pw-post-body-paragraph kg kh ht ki b kj le kl km kn lf kp kq kr lg kt ku kv lh kx ky kz li lb lc ld hm dt translated">瞧。描述的算法是运算变换。</p><h1 id="e5a0" class="ji jj ht bd jk jl mz jn jo jp na jr js jt nb jv jw jx nc jz ka kb nd kd ke kf dt translated">2.运营转型</h1><h2 id="e20a" class="lk jj ht bd jk ll lm ln jo lo lp lq js kr lr ls jw kv lt lu ka kz lv lw ke lx dt translated">2.1一致性模型</h2><p id="695d" class="pw-post-body-paragraph kg kh ht ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld hm dt translated">很少有<em class="lj">一致性模型</em>能够为OT提供一致性。让我们考虑其中之一——CCI模型。</p><p id="e4d5" class="pw-post-body-paragraph kg kh ht ki b kj le kl km kn lf kp kq kr lg kt ku kv lh kx ky kz li lb lc ld hm dt translated">CCI模型由以下属性组成:</p><ol class=""><li id="2415" class="me mf ht ki b kj le kn lf kr mg kv mh kz mi ld ne mk ml mm dt translated">聚合:在执行所有操作后，同一文档的所有副本必须相同</li></ol><figure class="lz ma mb mc fq iu fe ff paragraph-image"><div role="button" tabindex="0" class="iv iw di ix bf iy"><div class="fe ff nf"><img src="../Images/f3624702fa87e8873e7f55b994c40604.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*sJwiV_Fq3AXYF21m5d_qbg.png"/></div></div></figure><p id="4864" class="pw-post-body-paragraph kg kh ht ki b kj le kl km kn lf kp kq kr lg kt ku kv lh kx ky kz li lb lc ld hm dt translated">Alice和Bob从同一个文档开始，然后进行局部更改，副本会发生分歧(因此实现了高响应性)。收敛属性要求Alice和Bob在收到彼此的更改后看到相同的文档。</p><p id="d6d7" class="pw-post-body-paragraph kg kh ht ki b kj le kl km kn lf kp kq kr lg kt ku kv lh kx ky kz li lb lc ld hm dt translated">2.意图保存:确保对任何文档状态执行一个操作的效果与该操作的<em class="lj">意图</em>相同。操作意图被定义为其执行对创建的副本的影响。<br/>举一个违反该属性的例子:</p><figure class="lz ma mb mc fq iu fe ff paragraph-image"><div role="button" tabindex="0" class="iv iw di ix bf iy"><div class="fe ff nf"><img src="../Images/6221caf401644481758a7fdd9a9cb7c4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gniXNp-3jSn80W5hAyKFXA.png"/></div></div></figure><p id="23da" class="pw-post-body-paragraph kg kh ht ki b kj le kl km kn lf kp kq kr lg kt ku kv lh kx ky kz li lb lc ld hm dt translated">Alice和Bob从相同的文档状态开始，然后进行本地更改。Alice操作的目的是在位置1插入“12”，Bob操作的目的是删除“CD”。同步后，鲍勃的意图被违背了。我们也可以观察到复制品有分歧，但这并不是对意图保护属性的要求。练习:这个例子中正确的最终状态是什么？</p><p id="5611" class="pw-post-body-paragraph kg kh ht ki b kj le kl km kn lf kp kq kr lg kt ku kv lh kx ky kz li lb lc ld hm dt translated">3.因果关系保持:在协作过程中，操作必须按照其自然因果顺序执行(基于<a class="ae md" href="https://en.wikipedia.org/wiki/Happened-before%22" rel="noopener ugc nofollow" target="_blank">发生-之前</a>的关系)。<br/>让我们考虑这个属性被侵犯的例子:</p><figure class="lz ma mb mc fq iu fe ff paragraph-image"><div role="button" tabindex="0" class="iv iw di ix bf iy"><div class="fe ff ng"><img src="../Images/454794f44c73625585485670ad381ac8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UyAkY9pQKv1FJDQQYYHdYQ.png"/></div></div></figure><p id="12f8" class="pw-post-body-paragraph kg kh ht ki b kj le kl km kn lf kp kq kr lg kt ku kv lh kx ky kz li lb lc ld hm dt translated">爱丽丝、鲍勃、特工史密斯从同一个文档状态开始。Alice完成她的更改并将其发送给其他客户。Bob首先收到它，并纠正了打字错误，然后将此更改发送给其他客户端。由于网络延迟，特工史密斯首先收到鲍勃的操作，即删除一个在他的复制品中尚不存在的符号。</p><p id="02c9" class="pw-post-body-paragraph kg kh ht ki b kj le kl km kn lf kp kq kr lg kt ku kv lh kx ky kz li lb lc ld hm dt translated">OT不能保证这个特性，所以可以使用其他算法，如<a class="ae md" href="https://en.wikipedia.org/wiki/Vector_clock" rel="noopener ugc nofollow" target="_blank">矢量时钟</a>。</p><h2 id="21f4" class="lk jj ht bd jk ll lm ln jo lo lp lq js kr lr ls jw kv lt lu ka kz lv lw ke lx dt translated">2.2加班设计</h2><p id="8efc" class="pw-post-body-paragraph kg kh ht ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld hm dt translated">OT设计策略之一是将其分为3个部分:</p><figure class="lz ma mb mc fq iu fe ff paragraph-image"><div role="button" tabindex="0" class="iv iw di ix bf iy"><div class="fe ff nh"><img src="../Images/78e1e7592516a70a71248e86293ce304.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KDmHx3XEqGDx5OMxChNwYw.png"/></div></div></figure><ol class=""><li id="c8b8" class="me mf ht ki b kj le kn lf kr mg kv mh kz mi ld ne mk ml mm dt translated">转换控制算法:负责确定操作(转换目标)何时准备好进行转换，应该对哪些操作(转换引用)进行转换，以及应该以什么顺序执行转换</li><li id="5fa2" class="me mf ht ki b kj mn kn mo kr mp kv mq kz mr ld ne mk ml mm dt translated">转换函数:负责根据引用操作的影响对目标操作执行实际的转换</li><li id="1aae" class="me mf ht ki b kj mn kn mo kr mp kv mq kz mr ld ne mk ml mm dt translated">属性和条件:定义转换控制算法和函数之间的关系，作为OT算法正确性的要求</li></ol><h2 id="3ee3" class="lk jj ht bd jk ll lm ln jo lo lp lq js kr lr ls jw kv lt lu ka kz lv lw ke lx dt translated">2.3转换功能</h2><p id="3ec5" class="pw-post-body-paragraph kg kh ht ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld hm dt translated">转换函数可以分为两种类型:</p><ul class=""><li id="df83" class="me mf ht ki b kj le kn lf kr mg kv mh kz mi ld mj mk ml mm dt translated">包含/正向转换:在Ob之前转换操作Oa，以便包含Ob的效果(例如，两次插入)</li><li id="4983" class="me mf ht ki b kj mn kn mo kr mp kv mq kz mr ld mj mk ml mm dt translated">排除/反向转换:在Ob之前转换操作Oa，以便排除Ob的影响(例如删除后插入)</li></ul><p id="f93d" class="pw-post-body-paragraph kg kh ht ki b kj le kl km kn lf kp kq kr lg kt ku kv lh kx ky kz li lb lc ld hm dt translated">下面是一个处理字符变化的变换函数示例:</p><figure class="lz ma mb mc fq iu"><div class="bz el l di"><div class="ni nj l"/></div></figure><h1 id="d628" class="ji jj ht bd jk jl mz jn jo jp na jr js jt nb jv jw jx nc jz ka kb nd kd ke kf dt translated">3.Google Docs中的协作协议</h1><p id="1ec0" class="pw-post-body-paragraph kg kh ht ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld hm dt translated">让我们更详细地考虑一下Google Docs协作协议是如何工作的。</p><p id="8960" class="pw-post-body-paragraph kg kh ht ki b kj le kl km kn lf kp kq kr lg kt ku kv lh kx ky kz li lb lc ld hm dt translated">每个客户端维护以下信息:</p><ul class=""><li id="ce62" class="me mf ht ki b kj le kn lf kr mg kv mh kz mi ld mj mk ml mm dt translated">上次同步修订(id)</li><li id="0237" class="me mf ht ki b kj mn kn mo kr mp kv mq kz mr ld mj mk ml mm dt translated">尚未发送到服务器的所有本地更改(挂起的更改)</li><li id="dd13" class="me mf ht ki b kj mn kn mo kr mp kv mq kz mr ld mj mk ml mm dt translated">所有发送到服务器但尚未被确认的本地更改(已发送的更改)</li><li id="163b" class="me mf ht ki b kj mn kn mo kr mp kv mq kz mr ld mj mk ml mm dt translated">用户可见的当前文档状态</li></ul><p id="f441" class="pw-post-body-paragraph kg kh ht ki b kj le kl km kn lf kp kq kr lg kt ku kv lh kx ky kz li lb lc ld hm dt translated">服务器维护以下信息:</p><ul class=""><li id="e0dc" class="me mf ht ki b kj le kn lf kr mg kv mh kz mi ld mj mk ml mm dt translated">所有已接收但尚未处理的更改(待定更改)的列表</li><li id="3afa" class="me mf ht ki b kj mn kn mo kr mp kv mq kz mr ld mj mk ml mm dt translated">所有已处理更改的日志(修订日志)</li><li id="a7b2" class="me mf ht ki b kj mn kn mo kr mp kv mq kz mr ld mj mk ml mm dt translated">上次处理更改时的文档状态</li></ul><p id="a520" class="pw-post-body-paragraph kg kh ht ki b kj le kl km kn lf kp kq kr lg kt ku kv lh kx ky kz li lb lc ld hm dt translated">假设我们有Alice、Server、Bob，他们从一个同步的空文档开始。</p><p id="e9c8" class="pw-post-body-paragraph kg kh ht ki b kj le kl km kn lf kp kq kr lg kt ku kv lh kx ky kz li lb lc ld hm dt translated">爱丽丝键入“你好”:</p><figure class="lz ma mb mc fq iu fe ff paragraph-image"><div role="button" tabindex="0" class="iv iw di ix bf iy"><div class="fe ff nk"><img src="../Images/44e7bf8d1eadbb75594e3698b508c58f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8BXqfOAbcIB7gn6nMqo6kw.png"/></div></div></figure><p id="0fbb" class="pw-post-body-paragraph kg kh ht ki b kj le kl km kn lf kp kq kr lg kt ku kv lh kx ky kz li lb lc ld hm dt translated">她的更改被添加到待定更改列表中，然后被发送到服务器并移到已发送的更改列表中。</p><p id="6fa6" class="pw-post-body-paragraph kg kh ht ki b kj le kl km kn lf kp kq kr lg kt ku kv lh kx ky kz li lb lc ld hm dt translated">与此同时，爱丽丝正在打字，她添加了“世界”。与此同时，鲍勃打出了“！”在他的空文档中(他没有收到Alice的更改):</p><figure class="lz ma mb mc fq iu fe ff paragraph-image"><div role="button" tabindex="0" class="iv iw di ix bf iy"><div class="fe ff nk"><img src="../Images/037b3cefaa7768d3c71d4d8d556f0d96.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3UXzjN5tAlmefA6FamDtPQ.png"/></div></div></figure><p id="b3dc" class="pw-post-body-paragraph kg kh ht ki b kj le kl km kn lf kp kq kr lg kt ku kv lh kx ky kz li lb lc ld hm dt translated">Alice的{Insert ' World，@5}被添加到待定更改中，但它未被发送，因为她的第一个更改尚未被确认，并且<strong class="ki hu">我们一次仅发送一个更改</strong>。还要注意，服务器已经处理了Alice的第一个更改，并将其移动到修订日志中。然后，它向Alice发送确认，并将她的更改传播给Bob:</p><figure class="lz ma mb mc fq iu fe ff paragraph-image"><div role="button" tabindex="0" class="iv iw di ix bf iy"><div class="fe ff nl"><img src="../Images/6da44793e01fd2e18f0f2d34e181be06.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Bj0WRLkfMkQTIg3SXXNxDg.png"/></div></div></figure><p id="173a" class="pw-post-body-paragraph kg kh ht ki b kj le kl km kn lf kp kq kr lg kt ku kv lh kx ky kz li lb lc ld hm dt translated">Bob接收到变更，并对其应用转换函数，结果，其未决变更中的索引从0移动到5。请注意，爱丽丝和鲍勃都将他们上次同步的修订更新为^ 1。Alice最终从已发送的更改中删除了她的第一个更改。</p><p id="c22e" class="pw-post-body-paragraph kg kh ht ki b kj le kl km kn lf kp kq kr lg kt ku kv lh kx ky kz li lb lc ld hm dt translated">接下来，Alice和Bob都将他们未发送的更改发送到服务器:</p><figure class="lz ma mb mc fq iu fe ff paragraph-image"><div role="button" tabindex="0" class="iv iw di ix bf iy"><div class="fe ff nl"><img src="../Images/81198639b3a4405a559522b2f8ccac70.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*c9UY0TqETUT6EyUYQKEbxg.png"/></div></div></figure><p id="10a2" class="pw-post-body-paragraph kg kh ht ki b kj le kl km kn lf kp kq kr lg kt ku kv lh kx ky kz li lb lc ld hm dt translated">服务器首先接收到Alice的更改，因此它对其进行处理，并向Alice发送确认，然后将其传播给Bob。Bob必须再次应用变换函数，并将他的局部改变转移到索引11。</p><p id="382e" class="pw-post-body-paragraph kg kh ht ki b kj le kl km kn lf kp kq kr lg kt ku kv lh kx ky kz li lb lc ld hm dt translated">接下来是一个重要的时刻。服务器开始处理Bob的更改，但是因为Bob的修订id已经过时(2对实际3)，所以服务器根据Bob还不知道的所有更改转换他的更改，并将其保存为修订3。</p><figure class="lz ma mb mc fq iu fe ff paragraph-image"><div role="button" tabindex="0" class="iv iw di ix bf iy"><div class="fe ff nk"><img src="../Images/31a211a23305c830cb082c605431e0a0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LcyVuX-wGLH_o3Q3XFi3bA.jpeg"/></div></div></figure><p id="a76c" class="pw-post-body-paragraph kg kh ht ki b kj le kl km kn lf kp kq kr lg kt ku kv lh kx ky kz li lb lc ld hm dt translated">对于Alice来说，该过程现在已经完成，Bob仍然需要接收转换后的更改并发送确认。</p><h1 id="b14e" class="ji jj ht bd jk jl mz jn jo jp na jr js jt nb jv jw jx nc jz ka kb nd kd ke kf dt translated">4.以太垫</h1><p id="91f2" class="pw-post-body-paragraph kg kh ht ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld hm dt translated">让我们来看看另一个使用OT技术的协同编辑应用程序——http://etherpad.org<a class="ae md" href="http://etherpad.org" rel="noopener ugc nofollow" target="_blank"/></p><p id="4df7" class="pw-post-body-paragraph kg kh ht ki b kj le kl km kn lf kp kq kr lg kt ku kv lh kx ky kz li lb lc ld hm dt translated">Etherpad使用稍微不同的转换函数——它以下面的格式将变更作为<em class="lj">变更集</em>发送到服务器:</p><p id="5a98" class="pw-post-body-paragraph kg kh ht ki b kj le kl km kn lf kp kq kr lg kt ku kv lh kx ky kz li lb lc ld hm dt translated">(p1 -&gt; p2)[c_1，c_2，…]，</p><p id="e83d" class="pw-post-body-paragraph kg kh ht ki b kj le kl km kn lf kp kq kr lg kt ku kv lh kx ky kz li lb lc ld hm dt translated">其中:</p><ul class=""><li id="5c27" class="me mf ht ki b kj le kn lf kr mg kv mh kz mi ld mj mk ml mm dt translated">p1 —变更前的文件长度</li><li id="e740" class="me mf ht ki b kj mn kn mo kr mp kv mq kz mr ld mj mk ml mm dt translated">p2 —更改后的文档长度</li><li id="3fd1" class="me mf ht ki b kj mn kn mo kr mp kv mq kz mr ld mj mk ml mm dt translated">c_i —文档的定义:<br/>如果c_i —数字或数字范围，则表示保留了<em class="lj">字符的索引，或者<br/>如果c_i —字符或字符串，则表示插入</em></li></ul><p id="0caa" class="pw-post-body-paragraph kg kh ht ki b kj le kl km kn lf kp kq kr lg kt ku kv lh kx ky kz li lb lc ld hm dt translated">示例:</p><ul class=""><li id="a978" class="me mf ht ki b kj le kn lf kr mg kv mh kz mi ld mj mk ml mm dt translated">" "+ (0 -&gt; 5)["Hello"] = "Hello "</li><li id="d9b1" class="me mf ht ki b kj mn kn mo kr mp kv mq kz mr ld mj mk ml mm dt translated">" Hllo World" + (10 -&gt; 14)[0，' e '，1–9，"！！!"] =“你好世界！！!"</li></ul><p id="659e" class="pw-post-body-paragraph kg kh ht ki b kj le kl km kn lf kp kq kr lg kt ku kv lh kx ky kz li lb lc ld hm dt translated">文档由应用于空文档的这种变更集的时间序列形成。</p><p id="10d2" class="pw-post-body-paragraph kg kh ht ki b kj le kl km kn lf kp kq kr lg kt ku kv lh kx ky kz li lb lc ld hm dt translated">我们可以注意到，服务器不能只应用来自客户端的更改(尽管在Google Docs中是可能的)，因为文档的长度可能不同，例如，如果客户端A和B从相同的长度为n的文档X开始，并且分别执行以下更改集:</p><p id="1504" class="pw-post-body-paragraph kg kh ht ki b kj le kl km kn lf kp kq kr lg kt ku kv lh kx ky kz li lb lc ld hm dt translated">答:(n -&gt; n_a)[…]，</p><p id="db4d" class="pw-post-body-paragraph kg kh ht ki b kj le kl km kn lf kp kq kr lg kt ku kv lh kx ky kz li lb lc ld hm dt translated">B: (n -&gt; n_b)[…]</p><p id="befa" class="pw-post-body-paragraph kg kh ht ki b kj le kl km kn lf kp kq kr lg kt ku kv lh kx ky kz li lb lc ld hm dt translated">那么B(A(X))是不可能的，因为B需要长度为n的文档，但它在A之后的长度为n_a。为了解决这个问题，etherpad引入了所谓的<em class="lj"> merge </em>函数，该函数采用将<strong class="ki hu">应用于同一文档状态</strong>的2个变更集，并计算新的单个变更集。要求</p><figure class="lz ma mb mc fq iu fe ff paragraph-image"><div class="fe ff nm"><img src="../Images/29c9545236c833a1085488cc8cb14ad8.png" data-original-src="https://miro.medium.com/v2/resize:fit:900/format:webp/1*wA2dxxrvha6Nlgiy9GfY_A.png"/></div></figure><p id="c57b" class="pw-post-body-paragraph kg kh ht ki b kj le kl km kn lf kp kq kr lg kt ku kv lh kx ky kz li lb lc ld hm dt translated">当客户端A从客户端B接收改变时，计算m(A，B)不是非常有用，因为m(A，B)适用于状态X，但是A处于状态A(X)。相反，我们应该这样计算A '和B '</p><figure class="lz ma mb mc fq iu fe ff paragraph-image"><div role="button" tabindex="0" class="iv iw di ix bf iy"><div class="fe ff nn"><img src="../Images/7409a14ab0d175f01195de6e7f1141c1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*sC3JLMNUyiMwWXzbJK7EeA.png"/></div></div></figure><p id="68b4" class="pw-post-body-paragraph kg kh ht ki b kj le kl km kn lf kp kq kr lg kt ku kv lh kx ky kz li lb lc ld hm dt translated">为了简单起见，让我们定义一个<em class="lj">跟随</em>函数<em class="lj"> f </em>:</p><figure class="lz ma mb mc fq iu fe ff paragraph-image"><div role="button" tabindex="0" class="iv iw di ix bf iy"><div class="fe ff no"><img src="../Images/359d5795b6625bd83a66839637297c69.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZciC8AQVnABiIK_md6lgiA.png"/></div></div></figure><p id="2849" class="pw-post-body-paragraph kg kh ht ki b kj le kl km kn lf kp kq kr lg kt ku kv lh kx ky kz li lb lc ld hm dt translated">这是通过以下算法建立的(对于f(A，B)):</p><ul class=""><li id="ae86" class="me mf ht ki b kj le kn lf kr mg kv mh kz mi ld mj mk ml mm dt translated">中的插入成为保留字符</li><li id="f164" class="me mf ht ki b kj mn kn mo kr mp kv mq kz mr ld mj mk ml mm dt translated">B中的插入成为插入</li><li id="c62f" class="me mf ht ki b kj mn kn mo kr mp kv mq kz mr ld mj mk ml mm dt translated">保留A和B中所有保留的字符</li></ul><h2 id="a987" class="lk jj ht bd jk ll lm ln jo lo lp lq js kr lr ls jw kv lt lu ka kz lv lw ke lx dt translated">例子</h2><figure class="lz ma mb mc fq iu fe ff paragraph-image"><div role="button" tabindex="0" class="iv iw di ix bf iy"><div class="fe ff np"><img src="../Images/3a927c1447c7fcc06c86f9da4bb38936.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Fiq13Z01D-xG6h934LaPvQ.png"/></div></div></figure><p id="2252" class="pw-post-body-paragraph kg kh ht ki b kj le kl km kn lf kp kq kr lg kt ku kv lh kx ky kz li lb lc ld hm dt translated">然后</p><figure class="lz ma mb mc fq iu fe ff paragraph-image"><div role="button" tabindex="0" class="iv iw di ix bf iy"><div class="fe ff nq"><img src="../Images/d8c2d93380b6278eeddd5c2dad906dbd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BFY8zJarSyvfJ2jk19g7kA.png"/></div></div></figure><p id="099e" class="pw-post-body-paragraph kg kh ht ki b kj le kl km kn lf kp kq kr lg kt ku kv lh kx ky kz li lb lc ld hm dt translated">现在试着计算合并后的最终状态m(A，B)(X)。</p><h1 id="a670" class="ji jj ht bd jk jl mz jn jo jp na jr js jt nb jv jw jx nc jz ka kb nd kd ke kf dt translated">5.OT批判</h1><ul class=""><li id="60fb" class="me mf ht ki b kj kk kn ko kr nr kv ns kz nt ld mj mk ml mm dt translated">所有文档更改必须在一组操作中保存</li><li id="bb67" class="me mf ht ki b kj mn kn mo kr mp kv mq kz mr ld mj mk ml mm dt translated">OT的实现可能是一项非常复杂的任务，引用维基百科:<br/>同样，Joseph Gentle是前Google Wave工程师，也是该分享的作者。JS library写道，“不幸的是，实现OT糟透了。有一百万种算法有不同的权衡，大部分困在学术论文中。正确实现这些算法非常困难和耗时。[……]Wave花了2年时间来编写，如果我们今天重写它，那么第二次编写几乎需要同样长的时间。”</li></ul><h1 id="1910" class="ji jj ht bd jk jl mz jn jo jp na jr js jt nb jv jw jx nc jz ka kb nd kd ke kf dt translated">6.参考</h1><ul class=""><li id="3d7f" class="me mf ht ki b kj kk kn ko kr nr kv ns kz nt ld mj mk ml mm dt translated"><a class="ae md" href="https://www.lri.fr/~mbl/ENS/CSCW/2012/papers/Ellis-SIGMOD89.pdf" rel="noopener ugc nofollow" target="_blank">群件系统中的并发控制</a></li><li id="41b6" class="me mf ht ki b kj mn kn mo kr mp kv mq kz mr ld mj mk ml mm dt translated"><a class="ae md" href="https://drive.googleblog.com/2010/09/whats-different-about-new-google-docs_21.html" rel="noopener ugc nofollow" target="_blank">新的谷歌文档有什么不同:一起工作，甚至分开工作</a></li><li id="2e5e" class="me mf ht ki b kj mn kn mo kr mp kv mq kz mr ld mj mk ml mm dt translated"><a class="ae md" href="https://drive.googleblog.com/2010/09/whats-different-about-new-google-docs_22.html" rel="noopener ugc nofollow" target="_blank">新的谷歌文档有什么不同:冲突解决</a></li><li id="9bf6" class="me mf ht ki b kj mn kn mo kr mp kv mq kz mr ld mj mk ml mm dt translated"><a class="ae md" href="http://www.codecommit.com/blog/java/understanding-and-applying-operational-transformation" rel="noopener ugc nofollow" target="_blank">理解并应用操作转换</a></li><li id="e292" class="me mf ht ki b kj mn kn mo kr mp kv mq kz mr ld mj mk ml mm dt translated"><a class="ae md" href="https://en.wikipedia.org/wiki/Operational_transformation" rel="noopener ugc nofollow" target="_blank">维基百科:运营转型</a></li><li id="d9c1" class="me mf ht ki b kj mn kn mo kr mp kv mq kz mr ld mj mk ml mm dt translated"><a class="ae md" href="https://dl.acm.org/citation.cfm?id=215706" rel="noopener ugc nofollow" target="_blank">Jupiter协作系统中的高延迟、低带宽窗口</a></li><li id="db07" class="me mf ht ki b kj mn kn mo kr mp kv mq kz mr ld mj mk ml mm dt translated"><a class="ae md" href="https://drive.googleblog.com/2010/09/whats-different-about-new-google-docs.html" rel="noopener ugc nofollow" target="_blank">新的谷歌文档有什么不同:让协作更快捷</a></li><li id="10cb" class="me mf ht ki b kj mn kn mo kr mp kv mq kz mr ld mj mk ml mm dt translated"><a class="ae md" href="http://citeseerx.ist.psu.edu/viewdoc/download?doi=10.1.1.53.933&amp;rep=rep1&amp;type=pdf" rel="noopener ugc nofollow" target="_blank">实时群组编辑器中的操作转换:问题、算法和成果</a></li><li id="cae3" class="me mf ht ki b kj mn kn mo kr mp kv mq kz mr ld mj mk ml mm dt translated"><a class="ae md" href="https://github.com/ether/etherpad-lite/blob/develop/doc/easysync/easysync-full-description.pdf" rel="noopener ugc nofollow" target="_blank">以太网垫和EasySync技术手册</a></li><li id="9a1d" class="me mf ht ki b kj mn kn mo kr mp kv mq kz mr ld mj mk ml mm dt translated"><a class="ae md" href="https://www.youtube.com/watch?v=84zqbXUQIHc" rel="noopener ugc nofollow" target="_blank"> Google TechTalks:设计实时协作编辑系统的问题和经验</a></li><li id="3159" class="me mf ht ki b kj mn kn mo kr mp kv mq kz mr ld mj mk ml mm dt translated"><a class="ae md" href="http://www3.ntu.edu.sg/home/czsun/projects/otfaq/" rel="noopener ugc nofollow" target="_blank">运营转型常见问答</a></li></ul><blockquote class="nu"><p id="2a6a" class="nv nw ht bd nx ny nz oa ob oc od ld ek translated">加入Coinmonks <a class="ae md" href="https://t.me/coincodecap" rel="noopener ugc nofollow" target="_blank">电报频道</a>和<a class="ae md" href="https://www.youtube.com/c/coinmonks/videos" rel="noopener ugc nofollow" target="_blank"> Youtube频道</a>获取每日<a class="ae md" href="http://coincodecap.com/" rel="noopener ugc nofollow" target="_blank">加密新闻</a></p></blockquote><h2 id="15d6" class="lk jj ht bd jk ll oe ln jo lo of lq js kr og ls jw kv oh lu ka kz oi lw ke lx dt translated">另外，阅读</h2><ul class=""><li id="20fb" class="me mf ht ki b kj kk kn ko kr nr kv ns kz nt ld mj mk ml mm dt translated"><a class="ae md" rel="noopener" href="/coinmonks/top-10-crypto-copy-trading-platforms-for-beginners-d0c37c7d698c">复制交易</a> | <a class="ae md" rel="noopener" href="/coinmonks/crypto-tax-software-ed4b4810e338">加密税务软件</a></li><li id="723e" class="me mf ht ki b kj mn kn mo kr mp kv mq kz mr ld mj mk ml mm dt translated"><a class="ae md" href="https://coincodecap.com/grid-trading" rel="noopener ugc nofollow" target="_blank">网格交易</a> | <a class="ae md" rel="noopener" href="/coinmonks/the-best-cryptocurrency-hardware-wallets-of-2020-e28b1c124069">加密硬件钱包</a></li><li id="874f" class="me mf ht ki b kj mn kn mo kr mp kv mq kz mr ld mj mk ml mm dt translated"><a class="ae md" href="http://Top 4 Telegram Channels for Crypto Traders" rel="noopener ugc nofollow" target="_blank">密码电报信号</a> | <a class="ae md" rel="noopener" href="/coinmonks/crypto-trading-bot-c2ffce8acb2a">密码交易机器人</a></li><li id="f33b" class="me mf ht ki b kj mn kn mo kr mp kv mq kz mr ld mj mk ml mm dt translated"><a class="ae md" rel="noopener" href="/coinmonks/crypto-exchange-dd2f9d6f3769">最佳加密交易所</a> | <a class="ae md" rel="noopener" href="/coinmonks/bitcoin-exchange-in-india-7f1fe79715c9">印度最佳加密交易所</a></li><li id="47a8" class="me mf ht ki b kj mn kn mo kr mp kv mq kz mr ld mj mk ml mm dt translated">开发人员的最佳加密API</li><li id="b359" class="me mf ht ki b kj mn kn mo kr mp kv mq kz mr ld mj mk ml mm dt translated">最佳<a class="ae md" rel="noopener" href="/coinmonks/top-5-crypto-lending-platforms-in-2020-that-you-need-to-know-a1b675cec3fa">密码借贷平台</a></li><li id="9487" class="me mf ht ki b kj mn kn mo kr mp kv mq kz mr ld mj mk ml mm dt translated"><a class="ae md" rel="noopener" href="/coinmonks/leveraged-token-3f5257808b22">杠杆代币</a>终极指南</li></ul></div></div>    
</body>
</html>