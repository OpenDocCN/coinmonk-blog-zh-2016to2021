<html>
<head>
<title>Build A Simple And Unstoppable Decentralized Web Application (DAPP)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">构建一个简单且不可阻挡的分散式Web应用程序(DAPP)</h1>
<blockquote>原文：<a href="https://medium.com/coinmonks/build-a-simple-and-unstoppable-decentralized-web-application-dapp-aa8d08e35f9c?source=collection_archive---------1-----------------------#2018-05-15">https://medium.com/coinmonks/build-a-simple-and-unstoppable-decentralized-web-application-dapp-aa8d08e35f9c?source=collection_archive---------1-----------------------#2018-05-15</a></blockquote><div><div class="ef hh hi hj hk hl"/><div class="hm hn ho hp hq"><div class=""/><p id="609f" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">在阅读本文之前，您首先需要能够<a class="ae jo" rel="noopener" href="/coinmonks/test-a-smart-contract-with-truffle-3eb8e1929370">使用Truffle </a>来玩和测试智能合约。</p><p id="e901" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">分散式应用程序是一个不可阻挡的应用程序，因为它由成千上万的计算机保护着。这是一个抵制审查的应用程序。它将颠覆整个世界。在本文中，我将向您展示如何在web平台中构建一个简单的分散式应用程序。</p><figure class="jq jr js jt fq ju fe ff paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="fe ff jp"><img src="../Images/d23002c5375168b5e9855320c4e659cc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DfH64UE4X1f6Q8IWWdj4kQ.jpeg"/></div></div><figcaption class="kb kc fg fe ff kd ke bd b be z ek">Unstoppable application. Photo by Rohit Rao (Unsplash)</figcaption></figure><p id="ba06" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">智能合约不同于分散式应用程序(dapp)。智能合约存在于区块链。dapp是在区块链上与智能合约交互的应用程序(通常在web上)。在上一篇文章中，您在Truffle控制台中玩并测试了智能合约。dapp和你在Truffle控制台上输入的命令在同一层。它们与智能合约进行交互。</p><blockquote class="kf"><p id="f353" class="kg kh ht bd ki kj kk kl km kn ko jn ek translated"><a class="ae jo" href="https://coincodecap.com/category/blockchain-node-and-api" rel="noopener ugc nofollow" target="_blank">发现并回顾最好的以太坊开发工具</a></p></blockquote><p id="10f5" class="pw-post-body-paragraph iq ir ht is b it kp iv iw ix kq iz ja jb kr jd je jf ks jh ji jj kt jl jm jn hm dt translated">如果智能合约是这样的。</p><pre class="jq jr js jt fq ku kv kw kx aw ky dt"><span id="c2d3" class="kz la ht kv b fv lb lc l ld le">pragma solidity ^0.4.19;</span><span id="4590" class="kz la ht kv b fv lf lc l ld le">contract Auction {<br/>  uint public number;</span><span id="ef12" class="kz la ht kv b fv lf lc l ld le">  function constructor() public {<br/>    number = 1;<br/>  }<br/>}</span></pre><p id="70db" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">你可以像这样在Truffle develop控制台中与智能合约进行交互。</p><pre class="jq jr js jt fq ku kv kw kx aw ky dt"><span id="3ff5" class="kz la ht kv b fv lb lc l ld le">truffle(develop)&gt; Auction.at(“0x345ca3e014aaf5dca488057592ee47305d9b3e10”).number();</span></pre><p id="26e9" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">web dapp会是这样的。</p><pre class="jq jr js jt fq ku kv kw kx aw ky dt"><span id="a050" class="kz la ht kv b fv lb lc l ld le">&lt;html&gt;</span><span id="01ab" class="kz la ht kv b fv lf lc l ld le">&lt;head&gt;</span><span id="3390" class="kz la ht kv b fv lf lc l ld le">&lt;script src=”https://cdn.jsdelivr.net/gh/ethereum/web3.js/dist/web3.min.js"&gt;&lt;/script&gt;</span><span id="8b30" class="kz la ht kv b fv lf lc l ld le">&lt;script type=”text/javascript”&gt;</span><span id="d7c5" class="kz la ht kv b fv lf lc l ld le">var Web3 = require(‘web3’);</span><span id="fd3b" class="kz la ht kv b fv lf lc l ld le">var web3 = new Web3(window.web3.currentProvider);</span><span id="8867" class="kz la ht kv b fv lf lc l ld le">const address = ‘0x345ca3e014aaf5dca488057592ee47305d9b3e10’;</span><span id="c577" class="kz la ht kv b fv lf lc l ld le">const abi = [</span><span id="ff83" class="kz la ht kv b fv lf lc l ld le">//omitted for brevity</span><span id="070c" class="kz la ht kv b fv lf lc l ld le">];</span><span id="9e57" class="kz la ht kv b fv lf lc l ld le">var contract = web3.eth.contract(abi);</span><span id="804b" class="kz la ht kv b fv lf lc l ld le">var auction = contract.at(address);</span><span id="b30f" class="kz la ht kv b fv lf lc l ld le">auction.number.call(function(e, r) {</span><span id="71b6" class="kz la ht kv b fv lf lc l ld le">console.log(r);</span><span id="574a" class="kz la ht kv b fv lf lc l ld le">});</span><span id="c56c" class="kz la ht kv b fv lf lc l ld le">&lt;/script&gt;</span><span id="ac3a" class="kz la ht kv b fv lf lc l ld le">&lt;/head&gt;</span><span id="fc4f" class="kz la ht kv b fv lf lc l ld le">&lt;body&gt;</span><span id="a313" class="kz la ht kv b fv lf lc l ld le">&lt;/body&gt;</span><span id="b9a1" class="kz la ht kv b fv lf lc l ld le">&lt;/html&gt;</span></pre><p id="c5e2" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">所以请记住，dapp是一个你与生活在区块链的智能合约互动的地方。通常它是一个web应用程序。但它可以是移动应用程序，甚至可以是控制台应用程序。</p><h1 id="539d" class="lg la ht bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc dt translated">元掩码</h1><p id="9249" class="pw-post-body-paragraph iq ir ht is b it md iv iw ix me iz ja jb mf jd je jf mg jh ji jj mh jl jm jn hm dt translated">要使用web分散式应用程序，用户需要做额外的工作。这就像为了能够在网络上使用Flash应用程序，用户需要安装Flash插件。要使用web分散式应用程序，用户需要安装Metamask。别担心，这个步骤比安装Flash插件简单多了。</p><p id="0018" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">进入<a class="ae jo" href="https://metamask.io" rel="noopener ugc nofollow" target="_blank"> Metamask </a>网站。所以在这个例子中，我使用了Firefox浏览器。根据您使用的浏览器进行调整。如果您使用Chrome浏览器，请单击Chrome链接。如果您使用Opera浏览器，请单击Opera链接。</p><figure class="jq jr js jt fq ju fe ff paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="fe ff mi"><img src="../Images/efbb2c134f2cc7ab5383f80d794d1d88.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KBVGlw5-JM-ysMi9JXik_g.png"/></div></div><figcaption class="kb kc fg fe ff kd ke bd b be z ek">Metamask website</figcaption></figure><p id="f191" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">如果你使用不同的浏览器，你的将会不同。如果您使用Firefox，请点按“添加到Firefox”按钮。</p><figure class="jq jr js jt fq ju fe ff paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="fe ff mj"><img src="../Images/9df85c0d99b5438a6f0e0b1330bf1623.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*eaE4oVn92_WOS2bV5BpD8g.png"/></div></div><figcaption class="kb kc fg fe ff kd ke bd b be z ek">Firefox Metamask plugin webpage</figcaption></figure><p id="01fd" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">您将收到确认信息。点击“添加”按钮进行确认。</p><figure class="jq jr js jt fq ju fe ff paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="fe ff mj"><img src="../Images/bd66402e7d6917bfdc2b9277dc290a83.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*sj_RfBNVD_41-yLUF_HQXA.png"/></div></div><figcaption class="kb kc fg fe ff kd ke bd b be z ek">Confirmation before installing Metamask plugin</figcaption></figure><figure class="jq jr js jt fq ju fe ff paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="fe ff mj"><img src="../Images/ae0892cd39eb9261e41a5faa20e6c450.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_BK4loJvNaWox1bcu6A-0w.png"/></div></div><figcaption class="kb kc fg fe ff kd ke bd b be z ek">A successful webpage launched after installing Metamask plugin</figcaption></figure><p id="dbc6" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">要开始使用Metamask插件，请单击右上角的小狐狸图标。首先，你会收到隐私声明。基本上，它告诉你使用后退出元掩码插件。点击“接受”按钮。</p><figure class="jq jr js jt fq ju fe ff paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="fe ff mj"><img src="../Images/054f519b539fec8780a6bacb7c43a20e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gVdSE8sfq7ftobK8xAjSlQ.png"/></div></div><figcaption class="kb kc fg fe ff kd ke bd b be z ek">Privacy notice</figcaption></figure><p id="10c2" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">然后你会看到Metamask登录界面。这些密码字段不是通用的。不要把它当成解锁你的Dropbox或Gmail账户的密码。这些密码字段仅适用于本地。您在这里输入的内容在其他机器甚至其他浏览器上都无法运行。如果您想从其他机器或其他浏览器重用元掩码帐户，请使用种子短语或私钥。种子短语或私钥有点类似于Gmail或Dropbox服务的用户名和密码。如果您在两个字段中都键入密码，然后单击“创建”按钮，元掩码会为您创建一个“帐户”。它会为你生成种子短语，所以你可以在其他地方使用这个帐户。</p><figure class="jq jr js jt fq ju fe ff paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="fe ff mj"><img src="../Images/2cf4ef94f2f32269bf8ab6fc0a41d69b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XwzxqjSE4GTNAURWZwiSYw.png"/></div></div><figcaption class="kb kc fg fe ff kd ke bd b be z ek">Metamask login screen</figcaption></figure><p id="f925" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">如果您创建一个新帐户而不是导入一个，您将得到一个名为“Account 1”的帐户，其余额为0。现在，你在主网络中，那里有“真正的钱”。如果你在币安或比特币基地买以太坊，硬币会留在这里。但是我们希望在本地网络中与智能合约进行交互。所以点击“主网络”选择框。你有几个选择。单击自定义RPC。</p><figure class="jq jr js jt fq ju fe ff paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="fe ff mk"><img src="../Images/9634fb43654ab89fa6ac0b34594d439c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pr8TmxHSk9JO6ja46bqEow.png"/></div></div><figcaption class="kb kc fg fe ff kd ke bd b be z ek">A few networks of Ethereum</figcaption></figure><p id="a3f3" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">但首先你需要启动当地的区块链网络。打开控制台。去<a class="ae jo" rel="noopener" href="/coinmonks/test-a-smart-contract-with-truffle-3eb8e1929370">你的块菌项目目录</a>，你在我之前的文章中工作过，然后运行<em class="ml">块菌开发</em>。然后打开一个新的控制台。转到您的松露项目目录，然后运行<em class="ml">松露迁移</em>将您的智能合同启动到这个本地区块链网络。默认情况下，truffle develop将在端口9545上启动本地区块链网络。所以在这里，选择“自定义RPC”后，在“新RPC URL”字段中键入<a class="ae jo" href="http://localhost:9545" rel="noopener ugc nofollow" target="_blank"> http://localhost:9545 </a>。然后点击“保存”按钮。最后，选择这个网络。</p><figure class="jq jr js jt fq ju fe ff paragraph-image"><div class="fe ff mm"><img src="../Images/044b871b88b5a55522d1a5f799285af7.png" data-original-src="https://miro.medium.com/v2/resize:fit:720/format:webp/1*K_uQjXgv66V8VHRfFLu2fA.png"/></div><figcaption class="kb kc fg fe ff kd ke bd b be z ek">Private blockchain network setting</figcaption></figure><p id="d500" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">你的余额中还有0乙醚。现在，我们需要导入运行<em class="ml"> truffle develop </em>的控制台中显示的私钥。</p><figure class="jq jr js jt fq ju fe ff paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="fe ff mj"><img src="../Images/bb3d5b62b5044c7c2153006ac767d6e3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-KV9QF2FodsZ9FFNhNBgQA.png"/></div></div><figcaption class="kb kc fg fe ff kd ke bd b be z ek">Private keys in private blockchain network</figcaption></figure><p id="41ae" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">在我们的例子中，我们需要三个独立的帐户:经理、卖方和投标人。你可以有第二个投标人，所以你需要四个账户。</p><p id="0de2" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">单击元掩码屏幕中的用户图标。然后点击“导入账户”。然后在点击“导入”之前粘贴私钥。</p><figure class="jq jr js jt fq ju fe ff paragraph-image"><div class="fe ff mn"><img src="../Images/f122c48c49b01fecfd7199497eef16c9.png" data-original-src="https://miro.medium.com/v2/resize:fit:724/format:webp/1*E2-tYs_BkQR_Ei0IB1eDpw.png"/></div><figcaption class="kb kc fg fe ff kd ke bd b be z ek">Click user icon</figcaption></figure><figure class="jq jr js jt fq ju fe ff paragraph-image"><div class="fe ff mm"><img src="../Images/468a85ccd04e9a4f62c0411d0dd4d788.png" data-original-src="https://miro.medium.com/v2/resize:fit:720/format:webp/1*f7TOcIdnxrC-usNnHM87Og.png"/></div><figcaption class="kb kc fg fe ff kd ke bd b be z ek">Import account</figcaption></figure><figure class="jq jr js jt fq ju fe ff paragraph-image"><div class="fe ff mm"><img src="../Images/15506c4e3e7e85a2b87380f72fb83bbc.png" data-original-src="https://miro.medium.com/v2/resize:fit:720/format:webp/1*OccuKcFTl-ah-QFrQMHAsw.png"/></div><figcaption class="kb kc fg fe ff kd ke bd b be z ek">Paste private key</figcaption></figure><p id="2399" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">这样做三到四次(一次给经理，一次给卖方，一两次给投标人)。</p><p id="d5fb" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">您已经完成了元掩码设置。现在是时候设置dapp项目了。</p><h1 id="7247" class="lg la ht bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc dt translated">反应</h1><p id="8119" class="pw-post-body-paragraph iq ir ht is b it md iv iw ix me iz ja jb mf jd je jf mg jh ji jj mh jl jm jn hm dt translated">React不是编写dapp的必要条件。可以用Angular或者vanilla JS。我试过用香草JS，很痛苦。所以我选择用React来写这个dapp。这种体验变得更加易于管理。如果你没有React的经验，我会一路讲解。</p><p id="704f" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">基本上，React是一个流行的Javascript框架，它使得Javascript应用程序中的状态管理变得更容易管理。安装create-react-app cli应用程序。</p><pre class="jq jr js jt fq ku kv kw kx aw ky dt"><span id="f6c3" class="kz la ht kv b fv lb lc l ld le">npm install -g create-react-app</span></pre><p id="749c" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">如果您使用的是MacOS或Linux，请将<em class="ml"> sudo添加到</em>中。但是现在，如果你愿意，你可以避免安装并使用<em class="ml"> npx </em>来运行create-react-app cli应用程序。</p><p id="5405" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">创建一个新的反应应用程序。您可以将这个项目放在您的块菌项目目录或其他地方。</p><pre class="jq jr js jt fq ku kv kw kx aw ky dt"><span id="965c" class="kz la ht kv b fv lb lc l ld le">create-react-app auction_dapp</span></pre><p id="0e7d" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">或者如果你使用npx</p><pre class="jq jr js jt fq ku kv kw kx aw ky dt"><span id="259d" class="kz la ht kv b fv lb lc l ld le">npx create-react-app auction_dapp</span></pre><p id="b235" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">反应应用程序基本上是一个节点应用程序。有node_modules目录，一个package.json文件。如果您运行这个React应用程序，您会看到的索引文件位于公共目录中，名为<em class="ml">index.html</em>。</p><p id="6834" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">让我们运行应用程序，看看它是什么样子。在反应项目目录中运行该程序。</p><pre class="jq jr js jt fq ku kv kw kx aw ky dt"><span id="eed3" class="kz la ht kv b fv lb lc l ld le">npm start</span></pre><figure class="jq jr js jt fq ju fe ff paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="fe ff mj"><img src="../Images/6f67fcdb6798c970fdd3949545e4f9b3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FDFwffyR5HR1LGnhlfb0Gg.png"/></div></div><figcaption class="kb kc fg fe ff kd ke bd b be z ek">React default page</figcaption></figure><p id="4eb0" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">打开<em class="ml"> public/index.html </em>。在身体标签内，您会看到:</p><pre class="jq jr js jt fq ku kv kw kx aw ky dt"><span id="9d53" class="kz la ht kv b fv lb lc l ld le">&lt;div id=”root”&gt;&lt;/div&gt;</span></pre><p id="c37f" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">它是一个空元素。那么，这个酷的标志和文字(欢迎反应)是从哪里来的呢？打开<em class="ml"> src/index.js </em>。您会看到:</p><pre class="jq jr js jt fq ku kv kw kx aw ky dt"><span id="188f" class="kz la ht kv b fv lb lc l ld le">import React from ‘react’;<br/>import ReactDOM from ‘react-dom’;<br/>import ‘./index.css’;<br/>import App from ‘./App’;<br/>import registerServiceWorker from ‘./registerServiceWorker’;</span><span id="dafa" class="kz la ht kv b fv lf lc l ld le">ReactDOM.render(&lt;App /&gt;, document.getElementById(‘root’));<br/>registerServiceWorker();</span></pre><p id="9cf7" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">您是否看到了<em class="ml">文档. getelementbyid(‘root’)</em>部分？它将App渲染为根标签内的<em class="ml"> &lt; App / &gt; </em>所示。那么，这个应用程序组件来自哪里呢？打开<em class="ml"> src/App.js </em>。</p><pre class="jq jr js jt fq ku kv kw kx aw ky dt"><span id="07ef" class="kz la ht kv b fv lb lc l ld le">import React, { Component } from ‘react’;<br/>import logo from ‘./logo.svg’;<br/>import ‘./App.css’;</span><span id="f2a1" class="kz la ht kv b fv lf lc l ld le">class App extends Component {<br/>  render() {<br/>    return (<br/>      &lt;div className=”App”&gt;<br/>        &lt;header className=”App-header”&gt;<br/>          &lt;img src={logo} className=”App-logo” alt=”logo” /&gt;<br/>          &lt;h1 className=”App-title”&gt;Welcome to React&lt;/h1&gt;<br/>        &lt;/header&gt;<br/>        &lt;p className=”App-intro”&gt;<br/>          To get started, edit &lt;code&gt;src/App.js&lt;/code&gt; and save to reload.<br/>        &lt;/p&gt;<br/>      &lt;/div&gt;<br/>    );<br/>  }<br/>}</span><span id="1e57" class="kz la ht kv b fv lf lc l ld le">export default App;</span></pre><p id="e191" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">看看渲染方法。它返回带有类“App”的div标签。这就是酷的标志和文字“欢迎反应”的来源。</p><p id="429f" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">因此，React使用某些方法来管理Javascript中的状态并呈现html。</p><h1 id="53cd" class="lg la ht bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc dt translated">Web3.js</h1><p id="959d" class="pw-post-body-paragraph iq ir ht is b it md iv iw ix me iz ja jb mf jd je jf mg jh ji jj mh jl jm jn hm dt translated">为了与智能合同交互，Javascript应用程序需要Web3.js库。安装它。</p><pre class="jq jr js jt fq ku kv kw kx aw ky dt"><span id="c3af" class="kz la ht kv b fv lb lc l ld le">npm install --save web3@1.0.0-beta.34</span></pre><p id="e257" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">创建<em class="ml"> src/web3.js </em>并填写此内容。</p><pre class="jq jr js jt fq ku kv kw kx aw ky dt"><span id="d200" class="kz la ht kv b fv lb lc l ld le">import Web3 from ‘web3’;</span><span id="a6ed" class="kz la ht kv b fv lf lc l ld le">const web3 = new Web3(window.web3.currentProvider);</span><span id="c896" class="kz la ht kv b fv lf lc l ld le">export default web3;</span></pre><p id="633d" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated"><em class="ml">窗口. web3.currentProvider </em>指元掩码。它告诉Javascript应用程序使用元掩码中的web3提供程序。如果您创建一个控制台dapp，您将使用不同的提供程序。</p><p id="a739" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">创建<em class="ml"> src/auction.js </em>并填写此内容。</p><pre class="jq jr js jt fq ku kv kw kx aw ky dt"><span id="380b" class="kz la ht kv b fv lb lc l ld le">import web3 from ‘./web3’;</span><span id="e0c4" class="kz la ht kv b fv lf lc l ld le">const address = ‘0x345ca3e014aaf5dca488057592ee47305d9b3e10’;</span><span id="efb2" class="kz la ht kv b fv lf lc l ld le">const abi = [</span><span id="89a0" class="kz la ht kv b fv lf lc l ld le">{</span><span id="e1a8" class="kz la ht kv b fv lf lc l ld le">“constant”: true,</span><span id="862c" class="kz la ht kv b fv lf lc l ld le">“inputs”: [],</span><span id="b7ad" class="kz la ht kv b fv lf lc l ld le">“name”: “seller”,</span><span id="6bdf" class="kz la ht kv b fv lf lc l ld le">“outputs”: [</span><span id="8d43" class="kz la ht kv b fv lf lc l ld le">{</span><span id="7ddb" class="kz la ht kv b fv lf lc l ld le">“name”: “”,</span><span id="af8d" class="kz la ht kv b fv lf lc l ld le">“type”: “address”</span><span id="d13e" class="kz la ht kv b fv lf lc l ld le">}</span><span id="ac22" class="kz la ht kv b fv lf lc l ld le">],</span><span id="5e1b" class="kz la ht kv b fv lf lc l ld le">“payable”: false,</span><span id="5765" class="kz la ht kv b fv lf lc l ld le">“stateMutability”: “view”,</span><span id="c62b" class="kz la ht kv b fv lf lc l ld le">“type”: “function”</span><span id="6906" class="kz la ht kv b fv lf lc l ld le">},</span><span id="20a7" class="kz la ht kv b fv lf lc l ld le">{</span><span id="a2fa" class="kz la ht kv b fv lf lc l ld le">“constant”: true,</span><span id="7550" class="kz la ht kv b fv lf lc l ld le">“inputs”: [],</span><span id="b0b3" class="kz la ht kv b fv lf lc l ld le">“name”: “manager”,</span><span id="49ce" class="kz la ht kv b fv lf lc l ld le">“outputs”: [</span><span id="3ad8" class="kz la ht kv b fv lf lc l ld le">{</span><span id="6fa3" class="kz la ht kv b fv lf lc l ld le">“name”: “”,</span><span id="dc32" class="kz la ht kv b fv lf lc l ld le">“type”: “address”</span><span id="9505" class="kz la ht kv b fv lf lc l ld le">}</span><span id="d2cb" class="kz la ht kv b fv lf lc l ld le">],</span><span id="4575" class="kz la ht kv b fv lf lc l ld le">“payable”: false,</span><span id="984b" class="kz la ht kv b fv lf lc l ld le">“stateMutability”: “view”,</span><span id="7062" class="kz la ht kv b fv lf lc l ld le">“type”: “function”</span><span id="b2c9" class="kz la ht kv b fv lf lc l ld le">},</span><span id="b661" class="kz la ht kv b fv lf lc l ld le">{</span><span id="e1ea" class="kz la ht kv b fv lf lc l ld le">“constant”: true,</span><span id="67b0" class="kz la ht kv b fv lf lc l ld le">“inputs”: [],</span><span id="0639" class="kz la ht kv b fv lf lc l ld le">“name”: “latestBid”,</span><span id="15fc" class="kz la ht kv b fv lf lc l ld le">“outputs”: [</span><span id="0494" class="kz la ht kv b fv lf lc l ld le">{</span><span id="0f9d" class="kz la ht kv b fv lf lc l ld le">“name”: “”,</span><span id="92af" class="kz la ht kv b fv lf lc l ld le">“type”: “uint256”</span><span id="e30a" class="kz la ht kv b fv lf lc l ld le">}</span><span id="4e34" class="kz la ht kv b fv lf lc l ld le">],</span><span id="56e1" class="kz la ht kv b fv lf lc l ld le">“payable”: false,</span><span id="b8e0" class="kz la ht kv b fv lf lc l ld le">“stateMutability”: “view”,</span><span id="7a60" class="kz la ht kv b fv lf lc l ld le">“type”: “function”</span><span id="3ea0" class="kz la ht kv b fv lf lc l ld le">},</span><span id="9311" class="kz la ht kv b fv lf lc l ld le">{</span><span id="b4f0" class="kz la ht kv b fv lf lc l ld le">“constant”: true,</span><span id="0ba4" class="kz la ht kv b fv lf lc l ld le">“inputs”: [],</span><span id="e6b7" class="kz la ht kv b fv lf lc l ld le">“name”: “latestBidder”,</span><span id="9df1" class="kz la ht kv b fv lf lc l ld le">“outputs”: [</span><span id="7fd4" class="kz la ht kv b fv lf lc l ld le">{</span><span id="cb6e" class="kz la ht kv b fv lf lc l ld le">“name”: “”,</span><span id="309b" class="kz la ht kv b fv lf lc l ld le">“type”: “address”</span><span id="4796" class="kz la ht kv b fv lf lc l ld le">}</span><span id="5a8b" class="kz la ht kv b fv lf lc l ld le">],</span><span id="59cb" class="kz la ht kv b fv lf lc l ld le">“payable”: false,</span><span id="9a4b" class="kz la ht kv b fv lf lc l ld le">“stateMutability”: “view”,</span><span id="4002" class="kz la ht kv b fv lf lc l ld le">“type”: “function”</span><span id="20ad" class="kz la ht kv b fv lf lc l ld le">},</span><span id="e828" class="kz la ht kv b fv lf lc l ld le">{</span><span id="ba71" class="kz la ht kv b fv lf lc l ld le">“inputs”: [],</span><span id="a37f" class="kz la ht kv b fv lf lc l ld le">“payable”: false,</span><span id="be5b" class="kz la ht kv b fv lf lc l ld le">“stateMutability”: “nonpayable”,</span><span id="bd69" class="kz la ht kv b fv lf lc l ld le">“type”: “constructor”</span><span id="23f6" class="kz la ht kv b fv lf lc l ld le">},</span><span id="ab1c" class="kz la ht kv b fv lf lc l ld le">{</span><span id="10be" class="kz la ht kv b fv lf lc l ld le">“constant”: false,</span><span id="0cbb" class="kz la ht kv b fv lf lc l ld le">“inputs”: [</span><span id="d586" class="kz la ht kv b fv lf lc l ld le">{</span><span id="943a" class="kz la ht kv b fv lf lc l ld le">“name”: “bid”,</span><span id="b0ab" class="kz la ht kv b fv lf lc l ld le">“type”: “uint256”</span><span id="0d24" class="kz la ht kv b fv lf lc l ld le">}</span><span id="ca88" class="kz la ht kv b fv lf lc l ld le">],</span><span id="2b64" class="kz la ht kv b fv lf lc l ld le">“name”: “auction”,</span><span id="6359" class="kz la ht kv b fv lf lc l ld le">“outputs”: [],</span><span id="6721" class="kz la ht kv b fv lf lc l ld le">“payable”: false,</span><span id="194e" class="kz la ht kv b fv lf lc l ld le">“stateMutability”: “nonpayable”,</span><span id="f48b" class="kz la ht kv b fv lf lc l ld le">“type”: “function”</span><span id="7243" class="kz la ht kv b fv lf lc l ld le">},</span><span id="332a" class="kz la ht kv b fv lf lc l ld le">{</span><span id="9f08" class="kz la ht kv b fv lf lc l ld le">“constant”: false,</span><span id="a28c" class="kz la ht kv b fv lf lc l ld le">“inputs”: [],</span><span id="cf66" class="kz la ht kv b fv lf lc l ld le">“name”: “bid”,</span><span id="6b4a" class="kz la ht kv b fv lf lc l ld le">“outputs”: [],</span><span id="f05f" class="kz la ht kv b fv lf lc l ld le">“payable”: true,</span><span id="89cb" class="kz la ht kv b fv lf lc l ld le">“stateMutability”: “payable”,</span><span id="d71a" class="kz la ht kv b fv lf lc l ld le">“type”: “function”</span><span id="243e" class="kz la ht kv b fv lf lc l ld le">},</span><span id="78df" class="kz la ht kv b fv lf lc l ld le">{</span><span id="3a37" class="kz la ht kv b fv lf lc l ld le">“constant”: false,</span><span id="8c15" class="kz la ht kv b fv lf lc l ld le">“inputs”: [],</span><span id="7d3d" class="kz la ht kv b fv lf lc l ld le">“name”: “finishAuction”,</span><span id="52c3" class="kz la ht kv b fv lf lc l ld le">“outputs”: [],</span><span id="c16e" class="kz la ht kv b fv lf lc l ld le">“payable”: false,</span><span id="c410" class="kz la ht kv b fv lf lc l ld le">“stateMutability”: “nonpayable”,</span><span id="34da" class="kz la ht kv b fv lf lc l ld le">“type”: “function”</span><span id="c8d3" class="kz la ht kv b fv lf lc l ld le">}</span><span id="e925" class="kz la ht kv b fv lf lc l ld le">];</span><span id="dc35" class="kz la ht kv b fv lf lc l ld le">export default new web3.eth.Contract(abi, address);</span></pre><p id="d422" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">本声明中的地址:</p><pre class="jq jr js jt fq ku kv kw kx aw ky dt"><span id="7671" class="kz la ht kv b fv lb lc l ld le">const address = ‘0x345ca3e014aaf5dca488057592ee47305d9b3e10’;</span></pre><p id="8ca4" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">来自<em class="ml">块菌迁徙</em>的输出。</p><pre class="jq jr js jt fq ku kv kw kx aw ky dt"><span id="fac8" class="kz la ht kv b fv lb lc l ld le">$ truffle migrate<br/>Using network ‘development’.</span><span id="8046" class="kz la ht kv b fv lf lc l ld le">Running migration: 1_initial_migration.js<br/> Replacing Migrations…<br/> … 0x3a8f8c4379f1d7269b9d931a088984f4ccfeec797bbb6e128582e2915c8f3ea1<br/> Migrations: 0x8cdaf0cd259887258bc13a92c0a6da92698644c0<br/>Saving successful migration to network…<br/> … 0xd7bc86d31bee32fa3988f1c1eabce403a1b5d570340a3a9cdba53a472ee8c956<br/>Saving artifacts…<br/>Running migration: 2_deploy_contracts.js<br/> Replacing Auction…<br/> … 0xf0b10908aeb415b8b13fe60aeed8ade6769679572a44cf679b5616e38670329d<br/> Auction: 0x345ca3e014aaf5dca488057592ee47305d9b3e10<br/>Saving artifacts…</span></pre><p id="0e42" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">检查第二行最后一行。</p><p id="0acd" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">abi值是一组对象，来自<a class="ae jo" rel="noopener" href="/coinmonks/test-a-smart-contract-with-truffle-3eb8e1929370">块菌项目</a>中的<em class="ml">构建/合同/拍卖. json </em>文件。我们关心的价值来自abi密钥。</p><pre class="jq jr js jt fq ku kv kw kx aw ky dt"><span id="1094" class="kz la ht kv b fv lb lc l ld le">{</span><span id="ddc0" class="kz la ht kv b fv lf lc l ld le">“contractName”: “Auction”,</span><span id="432f" class="kz la ht kv b fv lf lc l ld le">“abi”: [</span><span id="1d2d" class="kz la ht kv b fv lf lc l ld le">{</span><span id="484d" class="kz la ht kv b fv lf lc l ld le">“constant”: true,</span><span id="95b5" class="kz la ht kv b fv lf lc l ld le">“inputs”: [],</span><span id="0817" class="kz la ht kv b fv lf lc l ld le">“name”: “seller”,</span><span id="01e0" class="kz la ht kv b fv lf lc l ld le">“outputs”: [</span><span id="093e" class="kz la ht kv b fv lf lc l ld le">{</span><span id="f9a2" class="kz la ht kv b fv lf lc l ld le">“name”: “”,</span><span id="54cc" class="kz la ht kv b fv lf lc l ld le">“type”: “address”</span><span id="62e0" class="kz la ht kv b fv lf lc l ld le">}</span><span id="cf78" class="kz la ht kv b fv lf lc l ld le">],</span><span id="c546" class="kz la ht kv b fv lf lc l ld le">“payable”: false,</span><span id="131a" class="kz la ht kv b fv lf lc l ld le">“stateMutability”: “view”,</span><span id="63a4" class="kz la ht kv b fv lf lc l ld le">“type”: “function”</span><span id="3e2a" class="kz la ht kv b fv lf lc l ld le">},</span><span id="4df3" class="kz la ht kv b fv lf lc l ld le">… //omitted for brevity</span></pre><p id="4206" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">在此声明中:</p><pre class="jq jr js jt fq ku kv kw kx aw ky dt"><span id="5d58" class="kz la ht kv b fv lb lc l ld le">export default new web3.eth.Contract(abi, address);</span></pre><p id="82ad" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">我们与我们的拍卖合同连接，拍卖合同位于abi变量中定义了接口的特定地址。</p><h1 id="d63c" class="lg la ht bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc dt translated">Dapp</h1><p id="f195" class="pw-post-body-paragraph iq ir ht is b it md iv iw ix me iz ja jb mf jd je jf mg jh ji jj mh jl jm jn hm dt translated">打开<em class="ml"> src/App.js </em>。擦除所有内容。开始写这些句子。</p><pre class="jq jr js jt fq ku kv kw kx aw ky dt"><span id="796f" class="kz la ht kv b fv lb lc l ld le">import React, { Component } from ‘react’;</span><span id="0833" class="kz la ht kv b fv lf lc l ld le">import web3 from ‘./web3’;</span><span id="d3e4" class="kz la ht kv b fv lf lc l ld le">import auction from ‘./auction’;</span></pre><p id="d1a5" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">除了我们之前创建的web3对象和拍卖对象之外，我们还从反应库中导入了反应和组件。</p><p id="db38" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">继续创建应用程序类。</p><pre class="jq jr js jt fq ku kv kw kx aw ky dt"><span id="2f0e" class="kz la ht kv b fv lb lc l ld le">class App extends Component {</span><span id="a7e8" class="kz la ht kv b fv lf lc l ld le">  state = {</span><span id="a3d7" class="kz la ht kv b fv lf lc l ld le">    manager: ‘’,</span><span id="5674" class="kz la ht kv b fv lf lc l ld le">    latestBid: ‘’,</span><span id="14d8" class="kz la ht kv b fv lf lc l ld le">    latestBidder: ‘’,</span><span id="f175" class="kz la ht kv b fv lf lc l ld le">    seller: ‘’,</span><span id="e6b9" class="kz la ht kv b fv lf lc l ld le">    balance: ‘’,</span><span id="2210" class="kz la ht kv b fv lf lc l ld le">    auctionValue: ‘’,</span><span id="4f44" class="kz la ht kv b fv lf lc l ld le">    bidValue: ‘’,</span><span id="be1c" class="kz la ht kv b fv lf lc l ld le">    closingRemark: ‘’</span><span id="e7cc" class="kz la ht kv b fv lf lc l ld le">  };</span></pre><p id="3440" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated"><em class="ml">状态</em>在反应中有特殊的位置。请记住我说的“反应”可以帮助您管理Javascript应用程序中的状态。我是认真的。“反应”之所以如此受欢迎，主要是因为它有助于您进行州管理。有了<em class="ml">状态</em>，您就不用再这样做了:</p><pre class="jq jr js jt fq ku kv kw kx aw ky dt"><span id="7176" class="kz la ht kv b fv lb lc l ld le">$(“#box”).html(“You win!!!!”);</span></pre><p id="e973" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">或者</p><pre class="jq jr js jt fq ku kv kw kx aw ky dt"><span id="9555" class="kz la ht kv b fv lb lc l ld le">document.getElementById(“box”).innerHTML = “You win!!!!”;</span></pre><p id="934d" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">通过“反应”，您只需如下设置:</p><pre class="jq jr js jt fq ku kv kw kx aw ky dt"><span id="62c1" class="kz la ht kv b fv lb lc l ld le">&lt;div id=”box”&gt;{this.state.boxMessage}&lt;/div&gt;</span></pre><p id="afec" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">然后在其他地方设置状态:</p><pre class="jq jr js jt fq ku kv kw kx aw ky dt"><span id="db96" class="kz la ht kv b fv lb lc l ld le">this.setState({boxMessage: “You win!!!!”});</span></pre><p id="cf44" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">瞧啊。就是这样。id为“box”的div将自动更新其内部HTML。</p><p id="b9e2" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">我们从react库中导入的组件就是我们呈现到html中的内容。通常我们创建一个继承自组件的类，该组件具有<em class="ml">状态</em>属性。这个<em class="ml">状态</em>是一个对象(在其他语言的通用语中称为hash/dictionary)。</p><p id="175b" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">我们继续吧。添加这些行。</p><pre class="jq jr js jt fq ku kv kw kx aw ky dt"><span id="2f89" class="kz la ht kv b fv lb lc l ld le">async componentDidMount() {</span><span id="4836" class="kz la ht kv b fv lf lc l ld le">  const manager = await auction.methods.manager().call();</span><span id="58bc" class="kz la ht kv b fv lf lc l ld le">  const latestBid = await auction.methods.latestBid().call();</span><span id="355c" class="kz la ht kv b fv lf lc l ld le">  const latestBidder = await auction.methods.latestBidder().call();</span><span id="8110" class="kz la ht kv b fv lf lc l ld le">  const seller = await auction.methods.seller().call();</span><span id="a7c3" class="kz la ht kv b fv lf lc l ld le">  const balance = await web3.eth.getBalance(auction.options.address);</span><span id="4422" class="kz la ht kv b fv lf lc l ld le">  this.setState({ manager, latestBid, latestBidder, seller, balance });</span><span id="ef51" class="kz la ht kv b fv lf lc l ld le">}</span></pre><p id="ec4c" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">在类内部，有一些方法。<em class="ml">组件卸载</em>方法是一种特殊的方法。此方法在呈现组件之前执行。但是方法名前面的<em class="ml"> async </em>是什么？在这个方法中，你会多次看到<em class="ml">等待</em>关键字。</p><p id="7608" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">在这条线上</p><pre class="jq jr js jt fq ku kv kw kx aw ky dt"><span id="988a" class="kz la ht kv b fv lb lc l ld le">const manager = await auction.methods.manager().call();</span></pre><p id="c532" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">我们在智能合约中称<em class="ml">经理为</em>物业。我们阻塞调用，直到我们得到结果。在我们的例子中，区块链网络位于本地，这没有任何区别。但是，当您与住在主网络或Rinkeby网络中的远程智能联系人进行交互时，该方法的执行需要时间。该方法可能需要几分钟才能完成。这就是API设计者将与智能合约交互的方法标记为异步方法的原因。如果该方法是异步的，则用回调函数调用它。所以在方法执行之后，它只是直接把控制权返回给你。您可以做其他事情，如果方法已经完成(智能契约返回结果)，它将执行您在执行方法的同时发送的回调。但是在我们的例子中，为了使事情更简单，我们强制异步与<em class="ml"> await </em>关键字同步。<em class="ml"> await </em>基本上告诉异步方法，“我不在乎你执行方法多长时间。我不在乎复试。我会在这里等到你把结果发给我”。在编写dapp时，这是一个糟糕的做法，因为它会使应用程序没有响应。但出于教育目的，这是可以的。</p><p id="7ea0" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">这一行:</p><pre class="jq jr js jt fq ku kv kw kx aw ky dt"><span id="3bea" class="kz la ht kv b fv lb lc l ld le">const balance = await web3.eth.getBalance(auction.options.address);</span></pre><p id="7594" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">意味着智能合约有多少钱。在以太坊中，不仅“人”可以有钱，智能合约也可以。</p><p id="35ee" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">这一行:</p><pre class="jq jr js jt fq ku kv kw kx aw ky dt"><span id="f442" class="kz la ht kv b fv lb lc l ld le">this.setState({ manager, latestBid, latestBidder, seller, balance });</span></pre><p id="8c74" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">告诉组件更新它的状态。订阅该状态的任何部分都会更新其内部内容。</p><p id="1f57" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">让我们继续。添加这些行。</p><pre class="jq jr js jt fq ku kv kw kx aw ky dt"><span id="b6ad" class="kz la ht kv b fv lb lc l ld le">onAuctionSubmit = async (event) =&gt; {</span><span id="6eff" class="kz la ht kv b fv lf lc l ld le">  event.preventDefault();</span><span id="c9c9" class="kz la ht kv b fv lf lc l ld le">  const accounts = await web3.eth.getAccounts();</span><span id="754f" class="kz la ht kv b fv lf lc l ld le">  await auction.methods.auction(this.state.auctionValue).send({</span><span id="7a77" class="kz la ht kv b fv lf lc l ld le">    from: accounts[0]</span><span id="9ff8" class="kz la ht kv b fv lf lc l ld le">  });</span><span id="8f27" class="kz la ht kv b fv lf lc l ld le">  this.setState({ seller: accounts[0] });</span><span id="8ef0" class="kz la ht kv b fv lf lc l ld le">}</span></pre><p id="ca43" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">这是声明方法的不同方式。以这种方式声明方法的优点和缺点超出了本文的范围。此方法将附加到按钮上。当我们点击按钮执行这个方法时，它将发送事件参数。通过这个事件参数，我们可以停止提交按钮的默认操作(更改页面)，方法是:</p><pre class="jq jr js jt fq ku kv kw kx aw ky dt"><span id="cf0f" class="kz la ht kv b fv lb lc l ld le">event.preventDefault();</span></pre><p id="c32b" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">然后我们得到元掩码中使用的帐户:</p><pre class="jq jr js jt fq ku kv kw kx aw ky dt"><span id="b77e" class="kz la ht kv b fv lb lc l ld le">const accounts = await web3.eth.getAccounts();</span></pre><p id="2b91" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">然后我们执行智能合约的方法:</p><pre class="jq jr js jt fq ku kv kw kx aw ky dt"><span id="b6bf" class="kz la ht kv b fv lb lc l ld le">await auction.methods.auction(this.state.auctionValue).send({</span><span id="2a79" class="kz la ht kv b fv lf lc l ld le">from: accounts[0]</span><span id="6fda" class="kz la ht kv b fv lf lc l ld le">});</span></pre><p id="1591" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">请记住，如果我们执行方法来读取智能契约的属性，它不会产生成本，我们使用<em class="ml">调用</em>。但是，如果我们执行该方法来更新将由世界上所有矿工确认的智能合同的状态，这将导致成本，我们使用<em class="ml">发送</em>。</p><p id="6bff" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">我们继续吧。添加这些行。</p><pre class="jq jr js jt fq ku kv kw kx aw ky dt"><span id="4737" class="kz la ht kv b fv lb lc l ld le">onBidSubmit = async (event) =&gt; {</span><span id="baf8" class="kz la ht kv b fv lf lc l ld le">  event.preventDefault();</span><span id="05bd" class="kz la ht kv b fv lf lc l ld le">  const accounts = await web3.eth.getAccounts();</span><span id="df4d" class="kz la ht kv b fv lf lc l ld le">  const weiAmount = web3.utils.toWei(this.state.bidValue, ‘ether’);</span><span id="8a37" class="kz la ht kv b fv lf lc l ld le">  await auction.methods.bid().send({</span><span id="e426" class="kz la ht kv b fv lf lc l ld le">    from: accounts[0],</span><span id="21fb" class="kz la ht kv b fv lf lc l ld le">    value: weiAmount</span><span id="3bb0" class="kz la ht kv b fv lf lc l ld le">  });</span><span id="7d4d" class="kz la ht kv b fv lf lc l ld le">  this.setState({ latestBid: weiAmount, balance: weiAmount, latestBidder: accounts[0] });</span><span id="9642" class="kz la ht kv b fv lf lc l ld le">}</span></pre><p id="bcc0" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">看看这条线。</p><pre class="jq jr js jt fq ku kv kw kx aw ky dt"><span id="204d" class="kz la ht kv b fv lb lc l ld le">const weiAmount = web3.utils.toWei(this.state.bidValue, ‘ether’);</span></pre><p id="14f0" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">这就是你如何把以太翻译成魏。记住1乙醚是100000000000000000魏。这一行基本上是美化版的:</p><pre class="jq jr js jt fq ku kv kw kx aw ky dt"><span id="adc9" class="kz la ht kv b fv lb lc l ld le">const weiAmount = this.state.bidValue * 1000000000000000000;</span></pre><p id="77eb" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">这一行是你如何把钱(乙醚)送到智能合同。这些钱必须是wei，所以这就是为什么您将ether(您将在网页上的表单中键入)转换为wei(智能合约接受它)。人们对以太的熟悉程度超过了魏，这就是为什么在网页中你使用以太货币而不是魏。这是为了UX的目的。</p><pre class="jq jr js jt fq ku kv kw kx aw ky dt"><span id="98f0" class="kz la ht kv b fv lb lc l ld le">await auction.methods.bid().send({</span><span id="7c31" class="kz la ht kv b fv lf lc l ld le">  from: accounts[0],</span><span id="3c12" class="kz la ht kv b fv lf lc l ld le">  value: weiAmount</span><span id="43ec" class="kz la ht kv b fv lf lc l ld le">});</span></pre><p id="e8f4" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">让我们继续我们的旅程。添加这些行。</p><pre class="jq jr js jt fq ku kv kw kx aw ky dt"><span id="7beb" class="kz la ht kv b fv lb lc l ld le">onFinishSubmit = async (event) =&gt; {</span><span id="4c6b" class="kz la ht kv b fv lf lc l ld le">  event.preventDefault();</span><span id="b3b1" class="kz la ht kv b fv lf lc l ld le">  const accounts = await web3.eth.getAccounts();</span><span id="a237" class="kz la ht kv b fv lf lc l ld le">    await auction.methods.finishAuction().send({</span><span id="b446" class="kz la ht kv b fv lf lc l ld le">    from: accounts[0]</span><span id="cfde" class="kz la ht kv b fv lf lc l ld le">  });</span><span id="b710" class="kz la ht kv b fv lf lc l ld le">  this.setState({ closingRemark: ‘Auction has been closed.’ })</span><span id="1535" class="kz la ht kv b fv lf lc l ld le">}</span></pre><p id="e5f2" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">这和我们看到的差不多。我们继续吧。添加这些行。</p><pre class="jq jr js jt fq ku kv kw kx aw ky dt"><span id="8eab" class="kz la ht kv b fv lb lc l ld le">render() {</span><span id="b4f9" class="kz la ht kv b fv lf lc l ld le">  return (</span><span id="083c" class="kz la ht kv b fv lf lc l ld le">    &lt;div&gt;</span><span id="7320" class="kz la ht kv b fv lf lc l ld le">      &lt;h2&gt;Auction Contract&lt;/h2&gt;</span><span id="c958" class="kz la ht kv b fv lf lc l ld le">      &lt;p&gt;This contract is managed by {this.state.manager}.&lt;/p&gt;</span><span id="22b4" class="kz la ht kv b fv lf lc l ld le">      &lt;p&gt;The seller is {this.state.seller}.&lt;/p&gt;</span><span id="b8eb" class="kz la ht kv b fv lf lc l ld le">      &lt;p&gt;The lattest bidder is {this.state.latestBidder}.&lt;/p&gt;</span><span id="9e19" class="kz la ht kv b fv lf lc l ld le">      &lt;p&gt;The lattest bid is {web3.utils.fromWei(this.state.latestBid, ‘ether’)} ether.&lt;/p&gt;</span><span id="574b" class="kz la ht kv b fv lf lc l ld le">      &lt;p&gt;The balance in the contract is {web3.utils.fromWei(this.state.balance, ‘ether’)} ether.&lt;/p&gt;</span><span id="7780" class="kz la ht kv b fv lf lc l ld le">      &lt;hr /&gt;</span><span id="fce2" class="kz la ht kv b fv lf lc l ld le">      &lt;h4&gt;Auction by seller&lt;/h4&gt;</span><span id="eba7" class="kz la ht kv b fv lf lc l ld le">      &lt;div&gt;</span><span id="abaa" class="kz la ht kv b fv lf lc l ld le">        &lt;label&gt;Auction limit&lt;/label&gt;</span><span id="0ef9" class="kz la ht kv b fv lf lc l ld le">        &lt;input</span><span id="2444" class="kz la ht kv b fv lf lc l ld le">value={this.state.auctionValue}</span><span id="849d" class="kz la ht kv b fv lf lc l ld le">onChange={event =&gt; this.setState({ auctionValue: event.target.value })}</span><span id="3cf5" class="kz la ht kv b fv lf lc l ld le">        /&gt;</span><span id="f4ef" class="kz la ht kv b fv lf lc l ld le">      &lt;/div&gt;</span><span id="edeb" class="kz la ht kv b fv lf lc l ld le">      &lt;button onClick={this.onAuctionSubmit}&gt;Auction&lt;/button&gt;</span><span id="3f17" class="kz la ht kv b fv lf lc l ld le">      &lt;hr /&gt;</span><span id="ed40" class="kz la ht kv b fv lf lc l ld le">      &lt;h4&gt;Bidding Form&lt;/h4&gt;</span><span id="a04f" class="kz la ht kv b fv lf lc l ld le">      &lt;div&gt;</span><span id="1099" class="kz la ht kv b fv lf lc l ld le">        &lt;label&gt;Bidding amount&lt;/label&gt;</span><span id="fc7d" class="kz la ht kv b fv lf lc l ld le">        &lt;input</span><span id="aa7c" class="kz la ht kv b fv lf lc l ld le">value={this.state.bidValue}</span><span id="86a9" class="kz la ht kv b fv lf lc l ld le">onChange={event =&gt; this.setState({ bidValue: event.target.value })}</span><span id="a12e" class="kz la ht kv b fv lf lc l ld le">        /&gt;</span><span id="2774" class="kz la ht kv b fv lf lc l ld le">     &lt;/div&gt;</span><span id="a1da" class="kz la ht kv b fv lf lc l ld le">     &lt;button onClick={this.onBidSubmit}&gt;Bid&lt;/button&gt;</span><span id="81e9" class="kz la ht kv b fv lf lc l ld le">     &lt;hr /&gt;</span><span id="0b17" class="kz la ht kv b fv lf lc l ld le">     &lt;h4&gt;Closing Auction&lt;/h4&gt;</span><span id="a50c" class="kz la ht kv b fv lf lc l ld le">     &lt;button onClick={this.onFinishSubmit}&gt;Close Auction&lt;/button&gt;</span><span id="5595" class="kz la ht kv b fv lf lc l ld le">     &lt;p&gt;{this.state.closingRemark}&lt;/p&gt;</span><span id="4c98" class="kz la ht kv b fv lf lc l ld le">   &lt;/div&gt;</span><span id="8dbe" class="kz la ht kv b fv lf lc l ld le">  );</span><span id="3f00" class="kz la ht kv b fv lf lc l ld le"> }</span><span id="aa03" class="kz la ht kv b fv lf lc l ld le">}</span><span id="f4d3" class="kz la ht kv b fv lf lc l ld le">export default App;</span></pre><p id="7375" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">当您将组件呈现为html时，它会调用render方法来完成这项工作。</p><p id="f733" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">看看这条线。</p><pre class="jq jr js jt fq ku kv kw kx aw ky dt"><span id="ee3b" class="kz la ht kv b fv lb lc l ld le">&lt;p&gt;This contract is managed by {this.state.manager}.&lt;/p&gt;</span></pre><p id="a711" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">该行订阅组件中状态的最新变化。</p><p id="48d2" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">这一行:</p><pre class="jq jr js jt fq ku kv kw kx aw ky dt"><span id="8791" class="kz la ht kv b fv lb lc l ld le">&lt;input</span><span id="b57f" class="kz la ht kv b fv lf lc l ld le">value={this.state.auctionValue}</span><span id="4ff8" class="kz la ht kv b fv lf lc l ld le">onChange={event =&gt; this.setState({ auctionValue: event.target.value })}</span><span id="e075" class="kz la ht kv b fv lf lc l ld le">/&gt;</span></pre><p id="1443" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">是我们如何从网页中的表单更新React组件中的状态。当我们在网页中键入文本字段时，它触发了<em class="ml"> onChange </em>回调，该回调将更新<em class="ml"> App </em>组件中的状态。</p><p id="3cde" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">看看这条线。</p><pre class="jq jr js jt fq ku kv kw kx aw ky dt"><span id="3032" class="kz la ht kv b fv lb lc l ld le">&lt;button onClick={this.onAuctionSubmit}&gt;Auction&lt;/button&gt;</span></pre><p id="ab74" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">这是您如何通过单击网页上的按钮来调用应用程序组件内的方法。</p><p id="03a0" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">现在，确保您已经运行了专用区块链网络，部署了智能合同，并运行了React项目。如果你忘了怎么做，这里有一些提醒。</p><p id="6b34" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">通过在<a class="ae jo" rel="noopener" href="/coinmonks/test-a-smart-contract-with-truffle-3eb8e1929370"> Truffle项目</a>中执行这个命令来运行私有区块链网络。</p><pre class="jq jr js jt fq ku kv kw kx aw ky dt"><span id="1415" class="kz la ht kv b fv lb lc l ld le">truffle develop</span></pre><p id="3c87" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">通过在<a class="ae jo" rel="noopener" href="/coinmonks/test-a-smart-contract-with-truffle-3eb8e1929370"> Truffle项目</a>中执行这个命令来部署智能契约。</p><pre class="jq jr js jt fq ku kv kw kx aw ky dt"><span id="18a7" class="kz la ht kv b fv lb lc l ld le">truffle migrate</span></pre><p id="cd02" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">通过在React项目中执行以下命令来运行React项目。</p><pre class="jq jr js jt fq ku kv kw kx aw ky dt"><span id="9ae0" class="kz la ht kv b fv lb lc l ld le">npm start</span></pre><p id="e86b" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">使用带有元掩码插件的浏览器访问localhost:3000。</p><figure class="jq jr js jt fq ju fe ff paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="fe ff mj"><img src="../Images/32b38c58c3545d846b73ee29db8e0d13.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-pI8RmoNxhKulQ33YfyGdA.png"/></div></div><figcaption class="kb kc fg fe ff kd ke bd b be z ek">Auction web dapp</figcaption></figure><p id="0d53" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">将Metamask中的帐户更改为卖家。</p><figure class="jq jr js jt fq ju fe ff paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="fe ff mo"><img src="../Images/a75564cb1d838586cd21e88eddd1de99.png" data-original-src="https://miro.medium.com/v2/resize:fit:722/format:webp/1*-rWSwDXXlI12k3sfAfHhmA.png"/></div></div><figcaption class="kb kc fg fe ff kd ke bd b be z ek">Seller account</figcaption></figure><p id="119e" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">在“拍卖限额”字段填写2或您喜欢的任何金额。然后按下“拍卖”按钮。</p><figure class="jq jr js jt fq ju fe ff paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="fe ff mj"><img src="../Images/fe276354a08dbffe5dc5596dd674e929.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nWwvULso4jZNblAt_-JvPQ.png"/></div></div><figcaption class="kb kc fg fe ff kd ke bd b be z ek">Auctin limit by seller</figcaption></figure><p id="865e" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">你会看到一个Metamask弹出屏幕来确认操作，因为你尝试采取的操作会产生开销，尽管开销很小。点击“提交”按钮。</p><figure class="jq jr js jt fq ju fe ff paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="fe ff mk"><img src="../Images/1ba2e400805acf7a7027c70b1ee41e93.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JJCMfrIlAQ_P-t3ruL6zaA.png"/></div></div><figcaption class="kb kc fg fe ff kd ke bd b be z ek">Metamask popup screen</figcaption></figure><p id="9657" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">你会看到页面更新它的卖家。</p><figure class="jq jr js jt fq ju fe ff paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="fe ff mj"><img src="../Images/bad900d268dfdb49e6bc46f3bdac4758.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*sV8gZMWU8YLITJBUixY6Tw.png"/></div></div><figcaption class="kb kc fg fe ff kd ke bd b be z ek">The seller information is updated.</figcaption></figure><p id="e650" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">你也可以从Truffle develop控制台查看卖家信息。</p><pre class="jq jr js jt fq ku kv kw kx aw ky dt"><span id="1b09" class="kz la ht kv b fv lb lc l ld le">truffle(develop)&gt; Auction.at(“0x345ca3e014aaf5dca488057592ee47305d9b3e10”).seller();<br/>‘0x2191ef87e392377ec08e7c08eb105ef5448eced5’</span></pre><p id="1eb7" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">你的卖家地址可能不同。最重要的是要检查的地址必须与网页上的地址相同。</p><p id="53ba" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">现在把你的Metamask账户改成bidder。</p><figure class="jq jr js jt fq ju fe ff paragraph-image"><div class="fe ff mn"><img src="../Images/be462c0f605c5073a05720d415afe69b.png" data-original-src="https://miro.medium.com/v2/resize:fit:724/format:webp/1*55WpwRkzcGL562O6UEqQLg.png"/></div><figcaption class="kb kc fg fe ff kd ke bd b be z ek">Bidder account</figcaption></figure><p id="0887" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">填写“出价金额”字段(任何大于2的金额)，然后按“出价”按钮。</p><figure class="jq jr js jt fq ju fe ff paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="fe ff mj"><img src="../Images/3265185777d7cef8dd7de11a73ccb8c3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-cSof_AmykFJuclk7aKEJw.png"/></div></div><figcaption class="kb kc fg fe ff kd ke bd b be z ek">Bid amount</figcaption></figure><p id="3efe" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">你会看到一个Metamask弹出窗口，要求你确认付款。这一次，你将发送金额加上小额费用。我的情况是4.001乙醚。点击“提交”按钮。</p><figure class="jq jr js jt fq ju fe ff paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="fe ff mk"><img src="../Images/6f2c9f20037977cf3e934fd4a2a3bd19.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*c2LRaW1qwmCDOt8GibkadA.png"/></div></div><figcaption class="kb kc fg fe ff kd ke bd b be z ek">Send the payment to the smart contract</figcaption></figure><p id="f4cc" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">网页将更新其关于投标和投标人的信息。如果你查一下投标人账户的余额，已经不是100 eth了。在我的例子中，它是95.999 eth，因为我向智能合约发送了4.001 ether。</p><figure class="jq jr js jt fq ju fe ff paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="fe ff mj"><img src="../Images/a4827f6912acbd73c6a12a0732759d71.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-QyDBIEeUcvmZP3-L-VedQ.png"/></div></div><figcaption class="kb kc fg fe ff kd ke bd b be z ek">The bidder balance changed</figcaption></figure><p id="17c0" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">现在，让我们完成这次拍卖。你需要成为经理。将元掩码中的帐户更改为manager。</p><figure class="jq jr js jt fq ju fe ff paragraph-image"><div class="fe ff mn"><img src="../Images/5843bc52c727a80b04123950cace35a4.png" data-original-src="https://miro.medium.com/v2/resize:fit:724/format:webp/1*gQAfyW_bmn1qNeiZSW9OOg.png"/></div><figcaption class="kb kc fg fe ff kd ke bd b be z ek">Manager account</figcaption></figure><p id="674e" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">点击“结束拍卖”按钮。</p><figure class="jq jr js jt fq ju fe ff paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="fe ff mj"><img src="../Images/4ed5e3a0515151a87a5e12a0ba968584.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*uf3_AIMw7XsXib_kjKoanw.png"/></div></div><figcaption class="kb kc fg fe ff kd ke bd b be z ek">Close auction smart contract</figcaption></figure><figure class="jq jr js jt fq ju fe ff paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="fe ff mj"><img src="../Images/79b23b49b4619b7c85c8a02d4c186734.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LziT1TPgtmGHomL93hFLZQ.png"/></div></div><figcaption class="kb kc fg fe ff kd ke bd b be z ek">Confirm the closing auction action</figcaption></figure><figure class="jq jr js jt fq ju fe ff paragraph-image"><div class="fe ff mp"><img src="../Images/ab55fd337681148da534d810afc72acc.png" data-original-src="https://miro.medium.com/v2/resize:fit:618/format:webp/1*Big9fwwOV3vSpkCom2tXOA.png"/></div><figcaption class="kb kc fg fe ff kd ke bd b be z ek">Auction has been closed</figcaption></figure><p id="ff33" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">要检查智能合同是否已最终确定，请检查卖方余额。它将增加投标人发送的金额。在我的情况下，它几乎是4以太。</p><figure class="jq jr js jt fq ju fe ff paragraph-image"><div class="fe ff mm"><img src="../Images/e3f50001ff90428c181440b8b4faf5d7.png" data-original-src="https://miro.medium.com/v2/resize:fit:720/format:webp/1*92Aytuo3nVVeIuWKKweaYA.png"/></div><figcaption class="kb kc fg fe ff kd ke bd b be z ek">The seller received money from the smart contract</figcaption></figure><p id="1e5f" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">因此，您已经构建了一个简单的web分散式应用程序。恭喜你！！！这个例子当然有bug。例如，关闭拍卖后，网页中的余额不会更新。我们仍然没有使用回调(我们使用<em class="ml"> await </em>来调用异步方法，这在编写dapp时是一大禁忌)。所有这些都将在以后的文章中讨论。</p><p id="1dc0" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">如果您得到错误“tx没有正确的nonce。”，尝试使用不同的帐户作为卖家或买家。</p><p id="340c" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">这是<em class="ml"> src/App.js </em>的完整源代码。</p><pre class="jq jr js jt fq ku kv kw kx aw ky dt"><span id="f14c" class="kz la ht kv b fv lb lc l ld le">import React, { Component } from ‘react’;</span><span id="2365" class="kz la ht kv b fv lf lc l ld le">import web3 from ‘./web3’;</span><span id="9963" class="kz la ht kv b fv lf lc l ld le">import auction from ‘./auction’;</span><span id="7326" class="kz la ht kv b fv lf lc l ld le">class App extends Component {</span><span id="7f0b" class="kz la ht kv b fv lf lc l ld le">state = {</span><span id="b38d" class="kz la ht kv b fv lf lc l ld le">manager: ‘’,</span><span id="2516" class="kz la ht kv b fv lf lc l ld le">latestBid: ‘’,</span><span id="7114" class="kz la ht kv b fv lf lc l ld le">latestBidder: ‘’,</span><span id="251c" class="kz la ht kv b fv lf lc l ld le">seller: ‘’,</span><span id="16f0" class="kz la ht kv b fv lf lc l ld le">balance: ‘’,</span><span id="9c04" class="kz la ht kv b fv lf lc l ld le">auctionValue: ‘’,</span><span id="cad9" class="kz la ht kv b fv lf lc l ld le">bidValue: ‘’,</span><span id="76e7" class="kz la ht kv b fv lf lc l ld le">closingRemark: ‘’</span><span id="c422" class="kz la ht kv b fv lf lc l ld le">};</span><span id="a56f" class="kz la ht kv b fv lf lc l ld le">async componentDidMount() {</span><span id="2ff3" class="kz la ht kv b fv lf lc l ld le">const manager = await auction.methods.manager().call();</span><span id="9d01" class="kz la ht kv b fv lf lc l ld le">const latestBid = await auction.methods.latestBid().call();</span><span id="e995" class="kz la ht kv b fv lf lc l ld le">const latestBidder = await auction.methods.latestBidder().call();</span><span id="f403" class="kz la ht kv b fv lf lc l ld le">const seller = await auction.methods.seller().call();</span><span id="64ee" class="kz la ht kv b fv lf lc l ld le">const balance = await web3.eth.getBalance(auction.options.address);</span><span id="1ff0" class="kz la ht kv b fv lf lc l ld le">this.setState({ manager, latestBid, latestBidder, seller, balance });</span><span id="abb7" class="kz la ht kv b fv lf lc l ld le">}</span><span id="80f7" class="kz la ht kv b fv lf lc l ld le">onAuctionSubmit = async (event) =&gt; {</span><span id="ad23" class="kz la ht kv b fv lf lc l ld le">event.preventDefault();</span><span id="5bd8" class="kz la ht kv b fv lf lc l ld le">const accounts = await web3.eth.getAccounts();</span><span id="cbc0" class="kz la ht kv b fv lf lc l ld le">await auction.methods.auction(this.state.auctionValue).send({</span><span id="75d7" class="kz la ht kv b fv lf lc l ld le">from: accounts[0]</span><span id="9116" class="kz la ht kv b fv lf lc l ld le">});</span><span id="329e" class="kz la ht kv b fv lf lc l ld le">this.setState({ seller: accounts[0] });</span><span id="7da9" class="kz la ht kv b fv lf lc l ld le">}</span><span id="bd3e" class="kz la ht kv b fv lf lc l ld le">onBidSubmit = async (event) =&gt; {</span><span id="e565" class="kz la ht kv b fv lf lc l ld le">event.preventDefault();</span><span id="b4f5" class="kz la ht kv b fv lf lc l ld le">const accounts = await web3.eth.getAccounts();</span><span id="ba83" class="kz la ht kv b fv lf lc l ld le">const weiAmount = web3.utils.toWei(this.state.bidValue, ‘ether’);</span><span id="7a18" class="kz la ht kv b fv lf lc l ld le">await auction.methods.bid().send({</span><span id="f323" class="kz la ht kv b fv lf lc l ld le">from: accounts[0],</span><span id="6683" class="kz la ht kv b fv lf lc l ld le">value: weiAmount</span><span id="d0e1" class="kz la ht kv b fv lf lc l ld le">});</span><span id="5fad" class="kz la ht kv b fv lf lc l ld le">this.setState({ latestBid: weiAmount, balance: weiAmount, latestBidder: accounts[0] });</span><span id="4224" class="kz la ht kv b fv lf lc l ld le">}</span><span id="16af" class="kz la ht kv b fv lf lc l ld le">onFinishSubmit = async (event) =&gt; {</span><span id="18ac" class="kz la ht kv b fv lf lc l ld le">event.preventDefault();</span><span id="2df2" class="kz la ht kv b fv lf lc l ld le">const accounts = await web3.eth.getAccounts();</span><span id="d38b" class="kz la ht kv b fv lf lc l ld le">await auction.methods.finishAuction().send({</span><span id="4c71" class="kz la ht kv b fv lf lc l ld le">from: accounts[0]</span><span id="c962" class="kz la ht kv b fv lf lc l ld le">});</span><span id="c9aa" class="kz la ht kv b fv lf lc l ld le">this.setState({ closingRemark: ‘Auction has been closed.’ })</span><span id="3f28" class="kz la ht kv b fv lf lc l ld le">}</span><span id="6e14" class="kz la ht kv b fv lf lc l ld le">render() {</span><span id="62f9" class="kz la ht kv b fv lf lc l ld le">return (</span><span id="6ff7" class="kz la ht kv b fv lf lc l ld le">&lt;div&gt;</span><span id="6cd3" class="kz la ht kv b fv lf lc l ld le">&lt;h2&gt;Auction Contract&lt;/h2&gt;</span><span id="06e8" class="kz la ht kv b fv lf lc l ld le">&lt;p&gt;This contract is managed by {this.state.manager}.&lt;/p&gt;</span><span id="5a7e" class="kz la ht kv b fv lf lc l ld le">&lt;p&gt;The seller is {this.state.seller}.&lt;/p&gt;</span><span id="6056" class="kz la ht kv b fv lf lc l ld le">&lt;p&gt;The lattest bidder is {this.state.latestBidder}.&lt;/p&gt;</span><span id="0507" class="kz la ht kv b fv lf lc l ld le">&lt;p&gt;The lattest bid is {web3.utils.fromWei(this.state.latestBid, ‘ether’)} ether.&lt;/p&gt;</span><span id="7bc8" class="kz la ht kv b fv lf lc l ld le">&lt;p&gt;The balance in the contract is {web3.utils.fromWei(this.state.balance, ‘ether’)} ether.&lt;/p&gt;</span><span id="e5b4" class="kz la ht kv b fv lf lc l ld le">&lt;hr /&gt;</span><span id="8700" class="kz la ht kv b fv lf lc l ld le">&lt;h4&gt;Auction by seller&lt;/h4&gt;</span><span id="7e61" class="kz la ht kv b fv lf lc l ld le">&lt;div&gt;</span><span id="bd7c" class="kz la ht kv b fv lf lc l ld le">&lt;label&gt;Auction limit&lt;/label&gt;</span><span id="0696" class="kz la ht kv b fv lf lc l ld le">&lt;input</span><span id="f19e" class="kz la ht kv b fv lf lc l ld le">value={this.state.auctionValue}</span><span id="025d" class="kz la ht kv b fv lf lc l ld le">onChange={event =&gt; this.setState({ auctionValue: event.target.value })}</span><span id="91c0" class="kz la ht kv b fv lf lc l ld le">/&gt;</span><span id="13a4" class="kz la ht kv b fv lf lc l ld le">&lt;/div&gt;</span><span id="af21" class="kz la ht kv b fv lf lc l ld le">&lt;button onClick={this.onAuctionSubmit}&gt;Auction&lt;/button&gt;</span><span id="3c1a" class="kz la ht kv b fv lf lc l ld le">&lt;hr /&gt;</span><span id="d262" class="kz la ht kv b fv lf lc l ld le">&lt;h4&gt;Bidding Form&lt;/h4&gt;</span><span id="c520" class="kz la ht kv b fv lf lc l ld le">&lt;div&gt;</span><span id="8317" class="kz la ht kv b fv lf lc l ld le">&lt;label&gt;Bidding amount&lt;/label&gt;</span><span id="a1f3" class="kz la ht kv b fv lf lc l ld le">&lt;input</span><span id="a987" class="kz la ht kv b fv lf lc l ld le">value={this.state.bidValue}</span><span id="bb6a" class="kz la ht kv b fv lf lc l ld le">onChange={event =&gt; this.setState({ bidValue: event.target.value })}</span><span id="c8fd" class="kz la ht kv b fv lf lc l ld le">/&gt;</span><span id="f309" class="kz la ht kv b fv lf lc l ld le">&lt;/div&gt;</span><span id="cef3" class="kz la ht kv b fv lf lc l ld le">&lt;button onClick={this.onBidSubmit}&gt;Bid&lt;/button&gt;</span><span id="3ec5" class="kz la ht kv b fv lf lc l ld le">&lt;hr /&gt;</span><span id="1295" class="kz la ht kv b fv lf lc l ld le">&lt;h4&gt;Closing Auction&lt;/h4&gt;</span><span id="8c28" class="kz la ht kv b fv lf lc l ld le">&lt;button onClick={this.onFinishSubmit}&gt;Close Auction&lt;/button&gt;</span><span id="5985" class="kz la ht kv b fv lf lc l ld le">&lt;p&gt;{this.state.closingRemark}&lt;/p&gt;</span><span id="8d05" class="kz la ht kv b fv lf lc l ld le">&lt;/div&gt;</span><span id="a17a" class="kz la ht kv b fv lf lc l ld le">);</span><span id="a734" class="kz la ht kv b fv lf lc l ld le">}</span><span id="9b79" class="kz la ht kv b fv lf lc l ld le">}</span><span id="da2d" class="kz la ht kv b fv lf lc l ld le">export default App;</span></pre><blockquote class="kf"><p id="b43d" class="kg kh ht bd ki kj mq mr ms mt mu jn ek translated">加入Coinmonks <a class="ae jo" href="https://t.me/coincodecap" rel="noopener ugc nofollow" target="_blank">电报频道</a>和<a class="ae jo" href="https://www.youtube.com/c/coinmonks/videos" rel="noopener ugc nofollow" target="_blank"> Youtube频道</a>获取每日<a class="ae jo" href="http://coincodecap.com/" rel="noopener ugc nofollow" target="_blank">加密新闻</a></p></blockquote><h2 id="15d6" class="kz la ht bd lh mv mw mx ll my mz na lp jb nb nc lt jf nd ne lx jj nf ng mb nh dt translated">另外，阅读</h2><ul class=""><li id="20fb" class="ni nj ht is b it md ix me jb nk jf nl jj nm jn nn no np nq dt translated"><a class="ae jo" rel="noopener" href="/coinmonks/top-10-crypto-copy-trading-platforms-for-beginners-d0c37c7d698c">复制交易</a> | <a class="ae jo" rel="noopener" href="/coinmonks/crypto-tax-software-ed4b4810e338">加密税务软件</a></li><li id="723e" class="ni nj ht is b it nr ix ns jb nt jf nu jj nv jn nn no np nq dt translated"><a class="ae jo" href="https://coincodecap.com/grid-trading" rel="noopener ugc nofollow" target="_blank">网格交易</a> | <a class="ae jo" rel="noopener" href="/coinmonks/the-best-cryptocurrency-hardware-wallets-of-2020-e28b1c124069">加密硬件钱包</a></li><li id="874f" class="ni nj ht is b it nr ix ns jb nt jf nu jj nv jn nn no np nq dt translated"><a class="ae jo" href="http://Top 4 Telegram Channels for Crypto Traders" rel="noopener ugc nofollow" target="_blank">密码电报信号</a> | <a class="ae jo" rel="noopener" href="/coinmonks/crypto-trading-bot-c2ffce8acb2a">密码交易机器人</a></li><li id="7cdf" class="ni nj ht is b it nr ix ns jb nt jf nu jj nv jn nn no np nq dt translated"><a class="ae jo" href="https://coincodecap.com/koinly-review" rel="noopener ugc nofollow" target="_blank">ko only回顾</a> | <a class="ae jo" href="https://coincodecap.com/binaryx-review" rel="noopener ugc nofollow" target="_blank"> Binaryx回顾</a>|<a class="ae jo" href="https://coincodecap.com/hodlnaut-vs-cakedefi-vs-celsius" rel="noopener ugc nofollow" target="_blank">Hodlnaut vs CakeDefi</a></li><li id="15d9" class="ni nj ht is b it nr ix ns jb nt jf nu jj nv jn nn no np nq dt translated"><a class="ae jo" href="https://coincodecap.com/bybit-binance-moonxbt" rel="noopener ugc nofollow" target="_blank"> MoonXBT vs Bybit vs币安</a> | <a class="ae jo" rel="noopener" href="/coinmonks/hardware-wallets-dfa1211730c6">硬件钱包</a></li><li id="5802" class="ni nj ht is b it nr ix ns jb nt jf nu jj nv jn nn no np nq dt translated"><a class="ae jo" href="https://coincodecap.com/huobi-trading-bot" rel="noopener ugc nofollow" target="_blank">火币交易机器人</a> | <a class="ae jo" href="https://coincodecap.com/buy-ada-cardano" rel="noopener ugc nofollow" target="_blank">如何购买ADA </a> | <a class="ae jo" href="https://coincodecap.com/geco-one-review" rel="noopener ugc nofollow" target="_blank"> Geco？一次回顾</a></li><li id="ecd3" class="ni nj ht is b it nr ix ns jb nt jf nu jj nv jn nn no np nq dt translated"><a class="ae jo" href="https://coincodecap.com/binance-vs-bitstamp" rel="noopener ugc nofollow" target="_blank">币安vs Bitstamp </a> | <a class="ae jo" href="https://coincodecap.com/bitpanda-coinbase-coinsbit" rel="noopener ugc nofollow" target="_blank">比特熊猫vs比特币基地vs Coinsbit </a></li><li id="5711" class="ni nj ht is b it nr ix ns jb nt jf nu jj nv jn nn no np nq dt translated"><a class="ae jo" href="https://coincodecap.com/buy-ripple-india" rel="noopener ugc nofollow" target="_blank">如何购买Ripple (XRP) </a> | <a class="ae jo" href="https://coincodecap.com/crypto-exchange-africa" rel="noopener ugc nofollow" target="_blank">非洲最好的加密交易所</a></li><li id="f33b" class="ni nj ht is b it nr ix ns jb nt jf nu jj nv jn nn no np nq dt translated"><a class="ae jo" rel="noopener" href="/coinmonks/crypto-exchange-dd2f9d6f3769">最佳加密交易所</a> | <a class="ae jo" rel="noopener" href="/coinmonks/bitcoin-exchange-in-india-7f1fe79715c9">印度最佳加密交易所</a></li><li id="47a8" class="ni nj ht is b it nr ix ns jb nt jf nu jj nv jn nn no np nq dt translated">开发人员的最佳加密API</li><li id="b359" class="ni nj ht is b it nr ix ns jb nt jf nu jj nv jn nn no np nq dt translated">最佳<a class="ae jo" rel="noopener" href="/coinmonks/top-5-crypto-lending-platforms-in-2020-that-you-need-to-know-a1b675cec3fa">密码借贷平台</a></li><li id="9487" class="ni nj ht is b it nr ix ns jb nt jf nu jj nv jn nn no np nq dt translated">杠杆代币的终极指南</li></ul></div></div>    
</body>
</html>