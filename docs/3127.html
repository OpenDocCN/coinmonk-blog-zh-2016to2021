<html>
<head>
<title>Querying data in an Ethereum Blockchain</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在以太坊区块链中查询数据</h1>
<blockquote>原文：<a href="https://medium.com/coinmonks/querying-data-in-an-ethereum-blockchain-86289d3fc385?source=collection_archive---------0-----------------------#2020-07-06">https://medium.com/coinmonks/querying-data-in-an-ethereum-blockchain-86289d3fc385?source=collection_archive---------0-----------------------#2020-07-06</a></blockquote><div><div class="ef hh hi hj hk hl"/><div class="hm hn ho hp hq"><h2 id="a2fe" class="hr hs ht bd b gc hu hv hw hx hy hz ek ia translated" aria-label="kicker paragraph">以太坊区块链内部</h2><div class=""/><div class=""><h2 id="351b" class="pw-subtitle-paragraph iz ic ht bd b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq ek translated">使用智能合约读取/写入以太坊区块链</h2></div><figure class="js jt ju jv fq jw fe ff paragraph-image"><div role="button" tabindex="0" class="jx jy di jz bf ka"><div class="fe ff jr"><img src="../Images/fc6aa2f5f23374097c6b955a0471659e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*A3UAmyPVyrzhlvRJnd3rNA.jpeg"/></div></div></figure><p id="7377" class="pw-post-body-paragraph kd ke ht kf b kg kh jd ki kj kk jg kl km kn ko kp kq kr ks kt ku kv kw kx ky hm dt translated">您可能已经听说过以太坊是一个区块链公共网络，交易价值数十亿美元。但是你可能没有意识到以太坊代码库也被世界各地的组织用来建立商业区块链网络。这些私人以太坊区块链网络通常是许可的，尽管它们与公共以太坊主网分离，但它们可以选择访问主网上的数据。以太坊区块链技术的这种适应需要很好地理解使用智能合约的读写方式。</p><blockquote class="kz la lb"><p id="05a0" class="kd ke lc kf b kg kh jd ki kj kk jg kl ld kn ko kp le kr ks kt lf kv kw kx ky hm dt translated">尝试Bitquery graph QL<a class="ae lg" href="https://bitquery.io/products/ethereum-api" rel="noopener ugc nofollow" target="_blank">API查询以太坊区块链</a>。</p></blockquote><h2 id="b4fd" class="lh li ht bd lj lk ll lm ln lo lp lq lr km ls lt lu kq lv lw lx ku ly lz ma hz dt translated">固态</h2><p id="274c" class="pw-post-body-paragraph kd ke ht kf b kg mb jd ki kj mc jg kl km md ko kp kq me ks kt ku mf kw kx ky hm dt translated">以太坊智能合约大多是用一种新设计的高级图灵-完全编程语言Solidity开发的。可靠性越来越受欢迎，因为它是专门为满足以太坊交易的要求而设计的。这些程序被编译成以太坊虚拟机(EVM)字节码，这是一种基于堆栈的低级语言，然后部署在以太坊区块链网络上，在所有以太坊节点上运行。例如，下面的清单显示了用Solidity编程语言编写的智能契约。程序的第一行声明了这个智能契约中使用的Solidity的版本。该程序包含一个构造函数来创建一个契约实例，以及函数。</p><figure class="js jt ju jv fq jw fe ff paragraph-image"><div class="fe ff mg"><img src="../Images/a49ab2b01396453212df55512a8bc812.png" data-original-src="https://miro.medium.com/v2/resize:fit:1042/format:webp/1*84oIH_rSz67lo3dP29Kecw.png"/></div><figcaption class="mh mi fg fe ff mj mk bd b be z ek">Solidity Smart Contract</figcaption></figure><h2 id="7f53" class="lh li ht bd lj lk ll lm ln lo lp lq lr km ls lt lu kq lv lw lx ku ly lz ma hz dt translated">固态数据</h2><p id="66ca" class="pw-post-body-paragraph kd ke ht kf b kg mb jd ki kj mc jg kl km md ko kp kq me ks kt ku mf kw kx ky hm dt translated">可以说，Solidity就像其他编程语言一样，只是在运行代码和处理数据方面有所不同。有趣的是，Solidity只处理EVM或区块链网络中的数据，其存储方式也很特别。固体中的变量主要有两种:状态变量和局部变量。状态变量负责通过将值保存在区块链上的<a class="ae lg" href="https://www.dummies.com/personal-finance/the-structure-of-blockchains/" rel="noopener ugc nofollow" target="_blank">块中来存储智能合约的状态。这些变量类似于其他编程语言中的全局变量，因为它们在<code class="eh ml mm mn mo b">contract</code>部分中定义，并且在智能契约中的任何地方都可用。和其他编程语言的局部变量一样，Solidity中的局部变量是在函数内部定义的。这些变量仅在定义它们的函数执行期间保存它们的值。</a></p><h2 id="6510" class="lh li ht bd lj lk ll lm ln lo lp lq lr km ls lt lu kq lv lw lx ku ly lz ma hz dt translated">以太坊区块链中的数据存储</h2><blockquote class="kz la lb"><p id="84b8" class="kd ke lc kf b kg kh jd ki kj kk jg kl ld kn ko kp le kr ks kt lf kv kw kx ky hm dt translated">以太坊实现了一个trie数据结构来管理临时和永久数据。以太坊区块链中的三类trie数据结构是<strong class="kf id">状态Trie、存储Trie和事务Trie。</strong></p></blockquote><p id="46d0" class="pw-post-body-paragraph kd ke ht kf b kg kh jd ki kj kk jg kl km kn ko kp kq kr ks kt ku kv kw kx ky hm dt translated">挖掘并确认的交易被记录在交易trie中。像上面提到的本地变量和帐户地址这样的临时数据被存储在状态trie中，在状态trie中它不断地改变和更新，从而更新整个以太坊区块链的状态。</p><h2 id="55eb" class="lh li ht bd lj lk ll lm ln lo lp lq lr km ls lt lu kq lv lw lx ku ly lz ma hz dt translated"><strong class="ak">状态trie </strong></h2><p id="af7c" class="pw-post-body-paragraph kd ke ht kf b kg mb jd ki kj mc jg kl km md ko kp kq me ks kt ku mf kw kx ky hm dt translated">以太坊中有一个不断更新的全局状态trie。它包含一个键-值对，其中键是以太坊帐户的地址，值是以太坊网络上帐户的随机数、余额、存储根的递归长度前缀(RLP)编码值。</p><h2 id="ec73" class="lh li ht bd lj lk ll lm ln lo lp lq lr km ls lt lu kq lv lw lx ku ly lz ma hz dt translated"><strong class="ak">存储trie </strong></h2><p id="7358" class="pw-post-body-paragraph kd ke ht kf b kg mb jd ki kj mc jg kl km md ko kp kq me ks kt ku mf kw kx ky hm dt translated">存储trie是存储所有合同数据的地方。每个以太坊账号都有自己的存储trie。存储trie的根节点的256位散列作为<strong class="kf id"> storageRoot </strong>值存储在全局状态trie中。</p><h2 id="15d9" class="lh li ht bd lj lk ll lm ln lo lp lq lr km ls lt lu kq lv lw lx ku ly lz ma hz dt translated"><strong class="ak">交易trie </strong></h2><p id="6c2f" class="pw-post-body-paragraph kd ke ht kf b kg mb jd ki kj mc jg kl km md ko kp kq me ks kt ku mf kw kx ky hm dt translated">事务trie中特定事务的路径是通过事务在块中所处位置的索引(的RLP编码)。挖掘的块从不更新；事务在块中的位置永远不会改变。这意味着，一旦在块的事务trie中找到一个事务，就可以反复返回到相同的路径来检索相同的结果。</p><h2 id="eb11" class="lh li ht bd lj lk ll lm ln lo lp lq lr km ls lt lu kq lv lw lx ku ly lz ma hz dt translated">Geth和LevelDB访问以太坊区块链元数据</h2><p id="8ad9" class="pw-post-body-paragraph kd ke ht kf b kg mb jd ki kj mc jg kl km md ko kp kq me ks kt ku mf kw kx ky hm dt translated">Go Ethereum是以太坊协议的三个原始实现之一(另两个是C++和Python)。它是用Go编写的，是完全开源的，可以作为一个名为Geth的独立客户端获得。Geth下载完整的以太坊区块链，并用某个数据库对其进行索引，以实现高效的数据查找和检索或存储状态。Geth使用LevelDB，因为LevelDB是在GO中实现的，具有键-值对，并包括现代数据存储(即磁盘上的多个层，在后台组织)</p><p id="c6e7" class="pw-post-body-paragraph kd ke ht kf b kg kh jd ki kj kk jg kl km kn ko kp kq kr ks kt ku kv kw kx ky hm dt translated">但是，使用LevelDB也有一些限制:</p><ul class=""><li id="298d" class="mp mq ht kf b kg kh kj kk km mr kq ms ku mt ky mu mv mw mx dt translated">以太坊使用的散列是均匀随机分布的标识符。LevelDB在磁盘上“按字母顺序”组织键，因此，访问与散列相关的值是非常昂贵的。</li><li id="405f" class="mp mq ht kf b kg my kj mz km na kq nb ku nc ky mu mv mw mx dt translated">只要LevelDB的大部分内容能够放入内存，它就能很好地执行，但是随着磁盘空间的增加，性能会下降。</li><li id="095e" class="mp mq ht kf b kg my kj mz km na kq nb ku nc ky mu mv mw mx dt translated">查询LevelDB会返回编码的结果，因为以太坊在与LevelDB交互时使用了“修改的Merkle Patricia Trie”实现。</li></ul><p id="c4e8" class="pw-post-body-paragraph kd ke ht kf b kg kh jd ki kj kk jg kl km kn ko kp kq kr ks kt ku kv kw kx ky hm dt translated">然而，要访问以太坊区块链上存储的数据，也有一些现有的工具。如果数据与交易相关联，<a class="ae lg" href="https://etherscan.io/" rel="noopener ugc nofollow" target="_blank">以太坊(ETH)区块链浏览器</a>可用于查看数据。如果数据存储在某些智能合约中，智能合约的接口可用于读取数据。要将一些数据写入以太坊区块链，无论是将一些以太发送到嵌入数据的地址，还是与以太坊区块链上的智能合约进行交互，都可以实现为您写入数据。</p><h2 id="dd61" class="lh li ht bd lj lk ll lm ln lo lp lq lr km ls lt lu kq lv lw lx ku ly lz ma hz dt translated">Web3.js访问以太坊区块链上的事件数据</h2><p id="2a6c" class="pw-post-body-paragraph kd ke ht kf b kg mb jd ki kj mc jg kl km md ko kp kq me ks kt ku mf kw kx ky hm dt translated"><a class="ae lg" href="https://web3js.readthedocs.io/" rel="noopener ugc nofollow" target="_blank"> Web3.js </a>可用于有效地查询和监听以太坊区块链上的合约事件，从而实现当满足特定标准时触发的动作规范。</p><p id="3a8a" class="pw-post-body-paragraph kd ke ht kf b kg kh jd ki kj kk jg kl km kn ko kp kq kr ks kt ku kv kw kx ky hm dt translated">可以通过以下方式使用即将到来的事件的事件侦听器来指定当事件发出时将发生的回调，</p><ul class=""><li id="6329" class="mp mq ht kf b kg kh kj kk km mr kq ms ku mt ky mu mv mw mx dt translated">对于任何事件，<code class="eh ml mm mn mo b">contract.events.allEvents()</code>可以用来为所有事件指定一个回调。</li></ul><pre class="js jt ju jv fq nd mo ne nf aw ng dt"><span id="7e27" class="lh li ht mo b fv nh ni l nj nk">contract.events.allEvents()<br/>.on('data', (event) =&gt; {<br/>	console.log(event);<br/>})<br/>.on('error', console.error);</span></pre><ul class=""><li id="241d" class="mp mq ht kf b kg kh kj kk km mr kq ms ku mt ky mu mv mw mx dt translated">对于特定的事件，<code class="eh ml mm mn mo b">contract.events.EventName()</code>可以用来指定特定事件类型的动作。例如，<code class="eh ml mm mn mo b">Transfer</code>:</li></ul><pre class="js jt ju jv fq nd mo ne nf aw ng dt"><span id="ed92" class="lh li ht mo b fv nh ni l nj nk">contract.events.Transfer()<br/>.on('data', (event) =&gt; {<br/>	console.log(event);<br/>})<br/>.on('error', console.error);</span></pre><p id="bd80" class="pw-post-body-paragraph kd ke ht kf b kg kh jd ki kj kk jg kl km kn ko kp kq kr ks kt ku kv kw kx ky hm dt translated">上述事件侦听器的输出返回有价值的数据，下表详细描述了这些数据。</p><figure class="js jt ju jv fq jw fe ff paragraph-image"><div role="button" tabindex="0" class="jx jy di jz bf ka"><div class="fe ff nl"><img src="../Images/b8b2f39cd86ec0d91ff273d380ee702c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ifLtA_8SuotHw01akkeUIA.png"/></div></div><figcaption class="mh mi fg fe ff mj mk bd b be z ek">Event listener Data Output Taxonomy by <a class="ae lg" href="https://www.pauric.blog/" rel="noopener ugc nofollow" target="_blank">https://www.pauric.blog/</a></figcaption></figure><h2 id="83c7" class="lh li ht bd lj lk ll lm ln lo lp lq lr km ls lt lu kq lv lw lx ku ly lz ma hz dt translated">结论</h2><p id="c44a" class="pw-post-body-paragraph kd ke ht kf b kg mb jd ki kj mc jg kl km md ko kp kq me ks kt ku mf kw kx ky hm dt translated">以太坊区块链的功能相当简单，不同尝试中永久和临时数据的不同存储空间确保了数据的安全和数据的易于管理。因此，能够安全轻松地访问以太坊区块链上存储的数据。</p><blockquote class="nm"><p id="3224" class="nn no ht bd np nq nr ns nt nu nv ky ek translated">加入Coinmonks <a class="ae lg" href="https://t.me/coincodecap" rel="noopener ugc nofollow" target="_blank">电报频道</a>和<a class="ae lg" href="https://www.youtube.com/c/coinmonks/videos" rel="noopener ugc nofollow" target="_blank"> Youtube频道</a>获取每日<a class="ae lg" href="http://coincodecap.com/" rel="noopener ugc nofollow" target="_blank">加密新闻</a></p></blockquote><h2 id="6516" class="lh li ht bd lj lk nw lm ln lo nx lq lr km ny lt lu kq nz lw lx ku oa lz ma hz dt translated">另外，阅读</h2><ul class=""><li id="20fb" class="mp mq ht kf b kg mb kj mc km ob kq oc ku od ky mu mv mw mx dt translated"><a class="ae lg" rel="noopener" href="/coinmonks/top-10-crypto-copy-trading-platforms-for-beginners-d0c37c7d698c">复制交易</a> | <a class="ae lg" rel="noopener" href="/coinmonks/crypto-tax-software-ed4b4810e338">加密税务软件</a></li><li id="723e" class="mp mq ht kf b kg my kj mz km na kq nb ku nc ky mu mv mw mx dt translated"><a class="ae lg" href="https://coincodecap.com/grid-trading" rel="noopener ugc nofollow" target="_blank">网格交易</a> | <a class="ae lg" rel="noopener" href="/coinmonks/the-best-cryptocurrency-hardware-wallets-of-2020-e28b1c124069">加密硬件钱包</a></li><li id="874f" class="mp mq ht kf b kg my kj mz km na kq nb ku nc ky mu mv mw mx dt translated"><a class="ae lg" rel="noopener" href="/coinmonks/crypto-exchange-dd2f9d6f3769">最佳加密交易所</a> | <a class="ae lg" rel="noopener" href="/coinmonks/bitcoin-exchange-in-india-7f1fe79715c9">印度最佳加密交易所</a></li><li id="cae0" class="mp mq ht kf b kg my kj mz km na kq nb ku nc ky mu mv mw mx dt translated"><a class="ae lg" rel="noopener" href="/coinmonks/top-3-telegram-channels-for-crypto-traders-in-2021-8385f4411ff4">密码电报信号</a> | <a class="ae lg" rel="noopener" href="/coinmonks/crypto-trading-bot-c2ffce8acb2a">密码交易机器人</a></li><li id="47a8" class="mp mq ht kf b kg my kj mz km na kq nb ku nc ky mu mv mw mx dt translated"><a class="ae lg" rel="noopener" href="/coinmonks/best-crypto-apis-for-developers-5efe3a597a9f">开发者最佳加密API</a></li><li id="b359" class="mp mq ht kf b kg my kj mz km na kq nb ku nc ky mu mv mw mx dt translated">最佳<a class="ae lg" rel="noopener" href="/coinmonks/top-5-crypto-lending-platforms-in-2020-that-you-need-to-know-a1b675cec3fa">密码借贷平台</a></li><li id="e199" class="mp mq ht kf b kg my kj mz km na kq nb ku nc ky mu mv mw mx dt translated"><a class="ae lg" href="https://coincodecap.com/smithbot-review" rel="noopener ugc nofollow" target="_blank"> SmithBot评论</a> | <a class="ae lg" href="https://coincodecap.com/free-open-source-trading-bots" rel="noopener ugc nofollow" target="_blank"> 4款最佳免费开源交易机器人</a></li><li id="a24d" class="mp mq ht kf b kg my kj mz km na kq nb ku nc ky mu mv mw mx dt translated"><a class="ae lg" rel="noopener" href="/coinmonks/coinbase-bots-ac6359e897f3">比特币基地僵尸工具</a> | <a class="ae lg" rel="noopener" href="/coinmonks/ascendex-review-53e829cf75fa"> AscendEX审查</a> | <a class="ae lg" rel="noopener" href="/coinmonks/okex-trading-bots-234920f61e60"> OKEx交易僵尸工具</a></li><li id="2bd3" class="mp mq ht kf b kg my kj mz km na kq nb ku nc ky mu mv mw mx dt translated"><a class="ae lg" rel="noopener" href="/coinmonks/buy-bitcoin-in-india-feb50ddfef94">如何在印度购买比特币？</a> | <a class="ae lg" rel="noopener" href="/coinmonks/wazirx-review-5c811b074f5b">瓦济克斯评论</a></li><li id="01c7" class="mp mq ht kf b kg my kj mz km na kq nb ku nc ky mu mv mw mx dt translated"><a class="ae lg" rel="noopener" href="/coinmonks/crypto-trading-bot-c2ffce8acb2a">加密交易机器人</a> | <a class="ae lg" href="https://coincodecap.com/probit-review" rel="noopener ugc nofollow" target="_blank"> Probit审查</a></li><li id="d929" class="mp mq ht kf b kg my kj mz km na kq nb ku nc ky mu mv mw mx dt translated"><a class="ae lg" rel="noopener" href="/coinmonks/cryptohopper-alternatives-d67287b16d27">隐翅虫替代品</a> | <a class="ae lg" rel="noopener" href="/coinmonks/hitbtc-review-c5143c5d53c2"> HitBTC审查</a></li><li id="9a66" class="mp mq ht kf b kg my kj mz km na kq nb ku nc ky mu mv mw mx dt translated"><a class="ae lg" href="https://coincodecap.com/cbet-casino-review" rel="noopener ugc nofollow" target="_blank"> CBET评论</a> | <a class="ae lg" href="https://coincodecap.com/kucoin-vs-coinbase" rel="noopener ugc nofollow" target="_blank">库科恩vs比特币基地</a></li><li id="810e" class="mp mq ht kf b kg my kj mz km na kq nb ku nc ky mu mv mw mx dt translated"><a class="ae lg" href="https://coincodecap.com/fold-app-review" rel="noopener ugc nofollow" target="_blank">折叠App审核</a> | <a class="ae lg" rel="noopener" href="/coinmonks/kucoin-trading-bot-automate-your-trades-8cf0ca2138e0"> Kucoin交易机器人</a></li><li id="3c98" class="mp mq ht kf b kg my kj mz km na kq nb ku nc ky mu mv mw mx dt translated"><a class="ae lg" rel="noopener" href="/coinmonks/free-crypto-signals-48b25e61a8da">免费加密信号</a> | <a class="ae lg" rel="noopener" href="/coinmonks/crypto-trading-bot-c2ffce8acb2a">加密交易机器人</a></li><li id="9487" class="mp mq ht kf b kg my kj mz km na kq nb ku nc ky mu mv mw mx dt translated"><a class="ae lg" rel="noopener" href="/coinmonks/leveraged-token-3f5257808b22">杠杆代币终极指南</a></li></ul></div></div>    
</body>
</html>