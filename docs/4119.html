<html>
<head>
<title>Hyperledger Fabric v2.X Monitoring Using Prometheus</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Hyperledger Fabric v2。x使用Prometheus进行监控</h1>
<blockquote>原文：<a href="https://medium.com/coinmonks/hyperledger-fabric-v2-x-monitoring-using-prometheus-974e433073f5?source=collection_archive---------1-----------------------#2021-02-28">https://medium.com/coinmonks/hyperledger-fabric-v2-x-monitoring-using-prometheus-974e433073f5?source=collection_archive---------1-----------------------#2021-02-28</a></blockquote><div><div class="ef hh hi hj hk hl"/><div class="hm hn ho hp hq"><div class=""/><figure class="fi fk ir is it iu fe ff paragraph-image"><div role="button" tabindex="0" class="iv iw di ix bf iy"><div class="fe ff iq"><img src="../Images/7c3f9eff3de8ae41879afe132da22ef0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4UuJjpsZXjNxoLpxuD0MkA.png"/></div></div></figure><h1 id="5661" class="jb jc ht bd jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy dt translated">1.概观</h1><p id="40c4" class="pw-post-body-paragraph jz ka ht kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw hm dt translated">在本文中，我们将了解如何为我们的hyperledger结构网络设置监控。在我之前的一篇文章中，我们看到了如何<a class="ae kx" rel="noopener" href="/coinmonks/integrating-hyperledger-explorer-with-hyperledger-fabric-network-v2-2-9a70e4c5311">将Hyperledger explorer与Hyperledger Fabric network </a>集成。我们将使用普罗米修斯和格拉夫纳进行监控。<strong class="kb hu"> Prometheus </strong>是由SoundCloud开发的开源时序数据库，作为Prometheus监控系统的存储层。<strong class="kb hu"> Grafana </strong>是针对每个数据库的开源分析&amp;监控解决方案。当连接到支持的数据源时，它为web提供图表、图形和警报。</p><blockquote class="ky kz la"><p id="8b42" class="jz ka lb kb b kc lc ke kf kg ld ki kj le lf km kn lg lh kq kr li lj ku kv kw hm dt translated"><em class="ht">另外，请查看我的</em> <a class="ae kx" href="http://bit.ly/hlf-multihost-deployment" rel="noopener ugc nofollow" target="_blank"> <em class="ht">课程，了解多主机</em> </a>上的Hyperledger Fabric部署</p></blockquote><h1 id="d8cc" class="jb jc ht bd jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy dt translated">2.普罗米修斯构型</h1><p id="de8d" class="pw-post-body-paragraph jz ka ht kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw hm dt translated">要运行prometheus实例，我们需要用您的配置文件来运行它。配置文件允许我们设置用于抓取的作业和目标。</p><figure class="ll lm ln lo fq iu fe ff paragraph-image"><div role="button" tabindex="0" class="iv iw di ix bf iy"><div class="fe ff lk"><img src="../Images/27838f7f0902f26f19f9118cb2cb033c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*q3DJjty9yW5DW2C_ehzOaw.png"/></div></div></figure><p id="8416" class="pw-post-body-paragraph jz ka ht kb b kc lc ke kf kg ld ki kj kk lf km kn ko lh kq kr ks lj ku kv kw hm dt translated"><code class="eh lp lq lr ls b">global</code>部分描述并覆盖一些默认值。<code class="eh lp lq lr ls b">rule_files</code>部分列出了Prometheus需要加载和处理的所有规则文件(记录或警报规则)。<code class="eh lp lq lr ls b">scrape_configs</code>部分描述了Prometheus需要处理的任务。在我们的例子中，我们有一个名为<code class="eh lp lq lr ls b">prometheus</code>、<code class="eh lp lq lr ls b">orderer</code>、<code class="eh lp lq lr ls b">peer0_org1</code>、<code class="eh lp lq lr ls b">peer0_org2</code>的任务，带有一些配置项，包括<code class="eh lp lq lr ls b">target_groups</code>子部分。</p><h1 id="e0c6" class="jb jc ht bd jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy dt translated">3.格拉夫纳构型</h1><p id="8db7" class="pw-post-body-paragraph jz ka ht kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw hm dt translated">配置为代码是将系统配置存储为一组受版本控制的、人类可读的配置文件，而不是存储在数据库中的实践。Grafana通过<em class="lb">供应</em>支持代码配置。当前支持资源调配的资源有:</p><ul class=""><li id="99e9" class="lt lu ht kb b kc lc kg ld kk lv ko lw ks lx kw ly lz ma mb dt translated"><a class="ae kx" href="https://grafana.com/docs/grafana/latest/administration/provisioning/#dashboards" rel="noopener ugc nofollow" target="_blank">仪表盘</a></li><li id="042b" class="lt lu ht kb b kc mc kg md kk me ko mf ks mg kw ly lz ma mb dt translated"><a class="ae kx" href="https://grafana.com/docs/grafana/latest/administration/provisioning/#datasources" rel="noopener ugc nofollow" target="_blank">数据来源</a></li><li id="a84f" class="lt lu ht kb b kc mc kg md kk me ko mf ks mg kw ly lz ma mb dt translated"><a class="ae kx" href="https://grafana.com/docs/grafana/latest/administration/provisioning/#alert-notification-channels" rel="noopener ugc nofollow" target="_blank">预警通知渠道</a></li></ul><p id="4a8d" class="pw-post-body-paragraph jz ka ht kb b kc lc ke kf kg ld ki kj kk lf km kn ko lh kq kr ks lj ku kv kw hm dt translated">预配目录采用以下结构:</p><figure class="ll lm ln lo fq iu fe ff paragraph-image"><div class="fe ff mh"><img src="../Images/2841b8763456652edc0c25a123ce69ec.png" data-original-src="https://miro.medium.com/v2/resize:fit:890/format:webp/1*Ogrr9Aa2Ck2WbJTp7QZTHw.png"/></div></figure><p id="7856" class="pw-post-body-paragraph jz ka ht kb b kc lc ke kf kg ld ki kj kk lf km kn ko lh kq kr ks lj ku kv kw hm dt translated">我们的数据源文件如下所示</p><figure class="ll lm ln lo fq iu fe ff paragraph-image"><div role="button" tabindex="0" class="iv iw di ix bf iy"><div class="fe ff mi"><img src="../Images/7c0380f2966ed81f8d4efdd3bb934de7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2yevX44Ewpx83Orp6Y3nIw.png"/></div></div></figure><p id="3088" class="pw-post-body-paragraph jz ka ht kb b kc lc ke kf kg ld ki kj kk lf km kn ko lh kq kr ks lj ku kv kw hm dt translated">我们的仪表板文件如下所示</p><figure class="ll lm ln lo fq iu fe ff paragraph-image"><div role="button" tabindex="0" class="iv iw di ix bf iy"><div class="fe ff mi"><img src="../Images/5322d232433886d02948659cda3f5913.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bbpo6Lnhq1bvyoIJi-FsnA.png"/></div></div></figure><h1 id="57a6" class="jb jc ht bd jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy dt translated"><strong class="ak"> 4。对等方的配置</strong></h1><p id="8c04" class="pw-post-body-paragraph jz ka ht kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw hm dt translated">在对等体的配置中，我们需要添加两个环境变量<code class="eh lp lq lr ls b">CORE_OPERATIONS_LISTENADDRESS</code>和<code class="eh lp lq lr ls b">CORE_METRICS_PROVIDER</code></p><figure class="ll lm ln lo fq iu fe ff paragraph-image"><div role="button" tabindex="0" class="iv iw di ix bf iy"><div class="fe ff mj"><img src="../Images/e7f00f1dfd9847abb3da43db38260591.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*A72A16HYLwMJZVMbEuEeiw.png"/></div></div></figure><figure class="ll lm ln lo fq iu fe ff paragraph-image"><div role="button" tabindex="0" class="iv iw di ix bf iy"><div class="fe ff mk"><img src="../Images/450fc805aa6dc3be70490d2c0cd778c3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3B9zR7kee5IYD-pGL0OWGw.png"/></div></div></figure><h1 id="9aba" class="jb jc ht bd jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy dt translated">5.订购者配置</h1><p id="750f" class="pw-post-body-paragraph jz ka ht kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw hm dt translated">在订购者配置中，我们需要添加两个环境变量<code class="eh lp lq lr ls b">ORDERER_OPERATIONS_LISTENADDRESS</code>和<code class="eh lp lq lr ls b">ORDERER_METRICS_PROVIDER</code></p><figure class="ll lm ln lo fq iu fe ff paragraph-image"><div role="button" tabindex="0" class="iv iw di ix bf iy"><div class="fe ff ml"><img src="../Images/bc653679edf078c15cf7ee5da3f7f9b6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qTlwhT0Ts4my-CGXGhGYuQ.png"/></div></div></figure><h1 id="dad1" class="jb jc ht bd jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy dt translated">6.设置</h1><ol class=""><li id="8c55" class="lt lu ht kb b kc kd kg kh kk mm ko mn ks mo kw mp lz ma mb dt translated">克隆存储库</li></ol><pre class="ll lm ln lo fq mq ls mr ms aw mt dt"><span id="994d" class="mu jc ht ls b fv mv mw l mx my">git clone <a class="ae kx" href="https://github.com/adityajoshi12/fabric-samples-advance-topics" rel="noopener ugc nofollow" target="_blank">https://github.com/adityajoshi12/fabric-samples-advance-topics</a>.git<br/>cd <a class="ae kx" href="https://github.com/adityajoshi12/fabric-samples-advance-topics" rel="noopener ugc nofollow" target="_blank">fabric-samples-advance-topics</a></span></pre><p id="49cc" class="pw-post-body-paragraph jz ka ht kb b kc lc ke kf kg ld ki kj kk lf km kn ko lh kq kr ks lj ku kv kw hm dt translated">2.导航到<code class="eh lp lq lr ls b">monitoring and logging</code>目录</p><pre class="ll lm ln lo fq mq ls mr ms aw mt dt"><span id="0662" class="mu jc ht ls b fv mv mw l mx my">cd test-network/moniter\ and\ logging/monitering</span></pre><p id="f964" class="pw-post-body-paragraph jz ka ht kb b kc lc ke kf kg ld ki kj kk lf km kn ko lh kq kr ks lj ku kv kw hm dt translated">3.启动普罗米修斯和格拉夫纳服务。</p><pre class="ll lm ln lo fq mq ls mr ms aw mt dt"><span id="bbb6" class="mu jc ht ls b fv mv mw l mx my">docker-compose up</span></pre><p id="6486" class="pw-post-body-paragraph jz ka ht kb b kc lc ke kf kg ld ki kj kk lf km kn ko lh kq kr ks lj ku kv kw hm dt translated">4.现在，我们可以启动结构网络了</p><pre class="ll lm ln lo fq mq ls mr ms aw mt dt"><span id="efee" class="mu jc ht ls b fv mv mw l mx my">cd ../..<br/>./network.sh up createChannel -ca -c mychannel  -i 2.2</span></pre><p id="e595" class="pw-post-body-paragraph jz ka ht kb b kc lc ke kf kg ld ki kj kk lf km kn ko lh kq kr ks lj ku kv kw hm dt translated">5.一旦网络启动，访问浏览器上的<code class="eh lp lq lr ls b"><a class="ae kx" href="http://localhost:3000" rel="noopener ugc nofollow" target="_blank">http://localhost:3000</a></code>，您就可以看到grafana仪表盘。</p><p id="9cac" class="pw-post-body-paragraph jz ka ht kb b kc lc ke kf kg ld ki kj kk lf km kn ko lh kq kr ks lj ku kv kw hm dt translated">grafana的用户名和密码是<em class="lb"> admin/admin </em></p><h1 id="deb6" class="jb jc ht bd jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy dt translated">7.摘要</h1><p id="88e1" class="pw-post-body-paragraph jz ka ht kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw hm dt translated">在本文中，我们了解了如何在hyperledger结构网络上启用指标，并设置Prometheus和grafana进行监控。源代码可以在<a class="ae kx" href="http://bit.ly/hlf-advance" rel="noopener ugc nofollow" target="_blank">这里找到</a></p><p id="4067" class="pw-post-body-paragraph jz ka ht kb b kc lc ke kf kg ld ki kj kk lf km kn ko lh kq kr ks lj ku kv kw hm dt translated">如果你觉得这篇文章很有帮助，请点击拍手按钮，并跟随我阅读更多这样的信息丰富的文章。</p><p id="3c3a" class="pw-post-body-paragraph jz ka ht kb b kc lc ke kf kg ld ki kj kk lf km kn ko lh kq kr ks lj ku kv kw hm dt translated">你可以在<a class="ae kx" href="https://linkedin.com/in/adityajoshi12" rel="noopener ugc nofollow" target="_blank"> Linkedin </a>上找到我或者在<a class="ae kx" href="https://github.com/adityajoshi12" rel="noopener ugc nofollow" target="_blank"> GitHub </a>上跟踪我？如果这对你来说太社交化了，如果你想和我讨论技术，就给adityaprakashjoshi1@gmail.com发封邮件。</p><figure class="ll lm ln lo fq iu fe ff paragraph-image"><div role="button" tabindex="0" class="iv iw di ix bf iy"><div class="fe ff mz"><img src="../Images/f93d3d57affbd958de9662e627e3aeab.png" data-original-src="https://miro.medium.com/v2/resize:fit:292/0*vgG_GfcSI65SKCKw.gif"/></div></div></figure></div></div>    
</body>
</html>