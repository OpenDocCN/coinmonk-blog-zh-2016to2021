<html>
<head>
<title>Creating &amp; Deploying a Smart Contract using Truffle framework &amp; Ganache-CLI — Part 2</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Truffle框架&amp; Ganache-CLI创建和部署智能合约—第2部分</h1>
<blockquote>原文：<a href="https://medium.com/coinmonks/creating-deploying-a-smart-contract-using-truffle-framework-ganache-cli-part-2-f2dcf400fbde?source=collection_archive---------1-----------------------#2019-05-16">https://medium.com/coinmonks/creating-deploying-a-smart-contract-using-truffle-framework-ganache-cli-part-2-f2dcf400fbde?source=collection_archive---------1-----------------------#2019-05-16</a></blockquote><div><div class="ef hh hi hj hk hl"/><div class="hm hn ho hp hq"><div class=""/><p id="7540" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">在<a class="ae jo" rel="noopener" href="/@itsromiljain/get-started-with-building-ethereum-dapps-and-smart-contracts-d86b9f7bd1c">第1部分</a>中，我们使用web3js和ganache-cli创建并部署了一个智能合约。在本节中，我们将使用Truffle框架和Ganache-CLI部署相同的契约。Truffle framework使许多事情变得简单，并隐藏了样板代码。所以让我们开始—</p><figure class="jq jr js jt fq ju fe ff paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="fe ff jp"><img src="../Images/a0573ca3a9f8bb4b621833fce6b79ef9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*82A3uvAKYw-RTo99FyfxyQ.png"/></div></div><figcaption class="kb kc fg fe ff kd ke bd b be z ek">Ethereum’ Smart Contract using Truffle Framework &amp; Ganache-CLI</figcaption></figure><h2 id="f65c" class="kf kg ht bd kh ki kj kk kl km kn ko kp jb kq kr ks jf kt ku kv jj kw kx ky kz dt translated">使用Truffle框架和Ganache-CLI进行部署</h2><p id="bc65" class="pw-post-body-paragraph iq ir ht is b it la iv iw ix lb iz ja jb lc jd je jf ld jh ji jj le jl jm jn hm dt translated">首先，我们需要安装松露。让我们在全球范围内安装松露。</p><pre class="jq jr js jt fq lf lg lh li aw lj dt"><span id="fb84" class="kf kg ht lg b fv lk ll l lm ln">$ npm install -g truffle</span></pre><p id="53e9" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">在同一个终端窗口中，创建一个新的项目/文件夹“ethereumdapp”并运行下面的命令。</p><pre class="jq jr js jt fq lf lg lh li aw lj dt"><span id="3344" class="kf kg ht lg b fv lk ll l lm ln">$ truffle unbox webpack</span><span id="049d" class="kf kg ht lg b fv lo ll l lm ln">or</span><span id="c4e4" class="kf kg ht lg b fv lo ll l lm ln">$ truffle init</span></pre><p id="71f0" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">如果使用第一个命令，你会在命令行中看到下面的内容</p><pre class="jq jr js jt fq lf lg lh li aw lj dt"><span id="ee21" class="kf kg ht lg b fv lk ll l lm ln">$ Downloading...</span><span id="319b" class="kf kg ht lg b fv lo ll l lm ln">Unpacking...</span><span id="d62f" class="kf kg ht lg b fv lo ll l lm ln">Setting up...</span><span id="d449" class="kf kg ht lg b fv lo ll l lm ln">Unbox successful. Sweet!</span><span id="b044" class="kf kg ht lg b fv lo ll l lm ln">Commands:</span><span id="fd61" class="kf kg ht lg b fv lo ll l lm ln">Compile:              truffle compile</span><span id="796a" class="kf kg ht lg b fv lo ll l lm ln">Migrate:              truffle migrate</span><span id="363c" class="kf kg ht lg b fv lo ll l lm ln">Test contracts:       truffle test</span><span id="c429" class="kf kg ht lg b fv lo ll l lm ln">Run linter:           npm run lint</span><span id="9951" class="kf kg ht lg b fv lo ll l lm ln">Run dev server:       npm run dev</span><span id="f2ee" class="kf kg ht lg b fv lo ll l lm ln">Build for production: npm run build</span></pre><p id="3e05" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">这将建立完整的项目。您可以看到在contracts文件夹下又创建了几个合同。另外，在迁移文件夹下创建了<em class="lp"> 1_initial_migration.js </em>和<em class="lp"> 2_deploy_contracts.js </em>。除此之外，还有<em class="lp"> truffle-config.js </em>创建。我们应该取消network下的development部分的注释，以连接到Ganache，如下所示。</p><figure class="jq jr js jt fq ju fe ff paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="fe ff lq"><img src="../Images/8f8880ffcc125c6d24861dc6220e8037.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mkUUqWh25XiiwCMAaaPJog.png"/></div></div></figure><p id="a730" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">设置完成后，将之前创建的<a class="ae jo" href="https://github.com/itsromiljain/EthereumDappMedium/blob/master/contracts/NotarizeDocument.sol" rel="noopener ugc nofollow" target="_blank">公证文档. sol </a>文件复制到“合同”文件夹中。我们可以删除' convert lib . sol '&amp;' meta coin . sol '，因为这些对我们没有用。</p><p id="a1b5" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">接下来，打开文件夹“migrations ”,在名为“2_deploy_contracts.js”的文件中，只需添加下面的代码行，删除其余的代码行并保存。</p><figure class="jq jr js jt fq ju"><div class="bz el l di"><div class="lr ls l"/></div></figure><p id="cf6a" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">迁移只是帮助我们将合同部署到区块链的脚本。</p><p id="67a5" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">让我们编译所有的契约，并迁移部署它们。</p><pre class="jq jr js jt fq lf lg lh li aw lj dt"><span id="81e4" class="kf kg ht lg b fv lk ll l lm ln">$ truffle compile</span><span id="f0a9" class="kf kg ht lg b fv lo ll l lm ln">$ truffle migrate --network development<br/>or<br/>$ truffle migrate</span></pre><p id="2c22" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">部署合同后，您可以看到在ganache控制台中创建了数据块。记录合同地址以与之交互。在这种情况下，它是0 xc 0 a 80 b 11 DAE 06421 Fe 2 ad 2f 5a 1554 c 871 f 72383d</p><pre class="jq jr js jt fq lf lg lh li aw lj dt"><span id="742c" class="kf kg ht lg b fv lk ll l lm ln">Compiling your contracts...<br/>===========================<br/>&gt; Everything is up to date, there is nothing to compile.</span><span id="979a" class="kf kg ht lg b fv lo ll l lm ln">Starting migrations...<br/>======================<br/>&gt; Network name:    'development'<br/>&gt; Network id:      1557978469538<br/>&gt; Block gas limit: 0x6691b7</span><span id="7295" class="kf kg ht lg b fv lo ll l lm ln">1_initial_migration.js<br/>======================</span><span id="1522" class="kf kg ht lg b fv lo ll l lm ln">Deploying 'Migrations'<br/>   ----------------------<br/>   &gt; transaction hash:    0x9e9d9d02b09913c18b5973c20ebd25386b647bc7e837a2d2a1486fd125ebd3e7<br/>   &gt; Blocks: 0            Seconds: 0<br/>   &gt; contract address:    0x7B64768252203353c47DE3a35F157E7d1Be1C182<br/>   &gt; block number:        1<br/>   &gt; block timestamp:     1557979380<br/>   &gt; account:             0xce599E446B1a8FEA3905df54224ebCACCbb03D41<br/>   &gt; balance:             99.99430312<br/>   &gt; gas used:            284844<br/>   &gt; gas price:           20 gwei<br/>   &gt; value sent:          0 ETH<br/>   &gt; total cost:          0.00569688 ETH</span><span id="e507" class="kf kg ht lg b fv lo ll l lm ln">&gt; Saving migration to chain.<br/>   &gt; Saving artifacts<br/>   -------------------------------------<br/>   &gt; Total cost:          0.00569688 ETH</span><span id="8a24" class="kf kg ht lg b fv lo ll l lm ln">2_deploy_contracts.js<br/>=====================</span><span id="9caa" class="kf kg ht lg b fv lo ll l lm ln">Deploying 'NotarizedDocument'<br/>   -----------------------------<br/>   &gt; transaction hash:    0x720404200b6882e65552d5e108b31b93f0427484ebbd056fd33565a1fe10a5f9<br/>   &gt; Blocks: 0            Seconds: 0<br/>   &gt; contract address:    0x2cD3d3090b4C62840B7B46E5237Fe8E951De78b2<br/>   &gt; block number:        3<br/>   &gt; block timestamp:     1557979380<br/>   &gt; account:             0xce599E446B1a8FEA3905df54224ebCACCbb03D41<br/>   &gt; balance:             99.98727016<br/>   &gt; gas used:            309614<br/>   &gt; gas price:           20 gwei<br/>   &gt; value sent:          0 ETH<br/>   &gt; total cost:          0.00619228 ETH</span><span id="7f70" class="kf kg ht lg b fv lo ll l lm ln">&gt; Saving migration to chain.<br/>   &gt; Saving artifacts<br/>   -------------------------------------<br/>   &gt; Total cost:          0.00619228 ETH</span><span id="5814" class="kf kg ht lg b fv lo ll l lm ln">Summary<br/>=======<br/>&gt; Total deployments:   2<br/>&gt; Final cost:          0.01188916 ETH</span></pre><p id="aa45" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">一般情况下，truffle会将合同部署到ganache提供的第一个帐户。要与合同互动，让我们去truffle控制台，一个接一个地键入下面的命令，并在另一个窗口中检查ganache控制台。</p><pre class="jq jr js jt fq lf lg lh li aw lj dt"><span id="9d21" class="kf kg ht lg b fv lk ll l lm ln">$ truffle console</span><span id="7af7" class="kf kg ht lg b fv lo ll l lm ln">truffle(development)&gt; NotarizedDocument.deployed()</span><span id="eca3" class="kf kg ht lg b fv lo ll l lm ln">truffle(development)&gt; let notarizedDocInstance = await NotarizedDocument.deployed()</span><span id="5089" class="kf kg ht lg b fv lo ll l lm ln">Or </span><span id="a174" class="kf kg ht lg b fv lo ll l lm ln">truffle(development)&gt; NotarizedDocument.deployed().then(instance =&gt; {notarizedDocInstance = instance})</span></pre><p id="2372" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">当您获得实例时，让我们调用公证文档契约的第一个方法，并传递一些字符串值。</p><pre class="jq jr js jt fq lf lg lh li aw lj dt"><span id="35b1" class="kf kg ht lg b fv lk ll l lm ln">truffle(development)&gt; notarizedDocInstance.notarize("Hello Romil!!")</span></pre><p id="3037" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">当您在truffle控制台中运行这个程序时，您可以看到在ganache控制台和下面的truffle控制台中创建了另一个块。</p><pre class="jq jr js jt fq lf lg lh li aw lj dt"><span id="0e5e" class="kf kg ht lg b fv lk ll l lm ln">{ tx:  '0x6da9b7c2509118233f564c86786d4c7e9206523d9bcecc3e80ec22b9edcef58e',<br/>  receipt:<br/>   { transactionHash:      '0x6da9b7c2509118233f564c86786d4c7e9206523d9bcecc3e80ec22b9edcef58e',<br/>     transactionIndex: 0,<br/>     blockHash:      '0xcc169d76a0098aa7b859ae1d6d6ed67920a6d15d0281c26ae0507446b6b16bee',<br/>     blockNumber: 5,<br/>     from: '0xce599e446b1a8fea3905df54224ebcaccbb03d41',<br/>     to: '0x2cd3d3090b4c62840b7b46e5237fe8e951de78b2',<br/>     gasUsed: 45005,<br/>     cumulativeGasUsed: 45005,<br/>     contractAddress: null,<br/>     logs: [],<br/>     status: true,<br/>     logsBloom:'',<br/>     v: '0x1c',<br/>     r:'',<br/>     s:'',<br/>     rawLogs: [] },<br/>  logs: [] }</span></pre><p id="ff80" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">若要检查此文档是否已创建，请调用协定的checkDocument方法。</p><pre class="jq jr js jt fq lf lg lh li aw lj dt"><span id="f5a8" class="kf kg ht lg b fv lk ll l lm ln">truffle(development)&gt; instance.checkDocument("Hello Romil!!")</span></pre><p id="e9a7" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">这将使控制台中的<em class="lp">返回true </em>。</p><p id="3759" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">现在是你玩松露框架的时候了。毫无疑问，Truffle通过隐藏大量的执行过程使事情变得简单，我们可以使用web3js看到这一点。完整的代码可以在<a class="ae jo" href="https://github.com/itsromiljain/ethereumdapps/tree/master/notarized" rel="noopener ugc nofollow" target="_blank">这里</a>找到。</p><p id="8ad3" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">因此，让我们创建更多的契约，并在通过主网络部署之前，通过ganache部署它们。是时候建造了</p></div><div class="ab cl lt lu hb lv" role="separator"><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly"/></div><div class="hm hn ho hp hq"><p id="5bb7" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated"><em class="lp">请分享您的想法、反馈、评论和澄清。这将有助于我随机应变。</em></p><p id="fcf6" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated"><em class="lp">如果你喜欢这篇文章，你可以帮我把它推荐到❤下面</em></p><p id="ba3c" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated"><em class="lp">关注我</em><a class="ae jo" href="https://www.linkedin.com/in/romiljain" rel="noopener ugc nofollow" target="_blank"><em class="lp">Linkedin</em></a><em class="lp">和</em> <a class="ae jo" href="https://twitter.com/itsromiljain" rel="noopener ugc nofollow" target="_blank"> <em class="lp"> Twitter </em> </a></p><blockquote class="ma"><p id="a903" class="mb mc ht bd md me mf mg mh mi mj jn ek translated"><a class="ae jo" href="https://coincodecap.com/?utm_source=coinmonks" rel="noopener ugc nofollow" target="_blank">直接在您的收件箱中获得最佳软件交易</a></p></blockquote><figure class="ml mm mn mo mp ju fe ff paragraph-image"><a href="https://coincodecap.com/?utm_source=coinmonks"><div class="fe ff mk"><img src="../Images/7c0b3dfdcbfea594cc0ae7d4f9bf6fcb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1168/format:webp/0*OJ-qb5G6i863msBB.png"/></div></a></figure></div></div>    
</body>
</html>