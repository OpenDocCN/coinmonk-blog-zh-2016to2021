<html>
<head>
<title>Detecting Metamask account or network change in Javascript using Web3 1.0.0</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Web3 1.0.0检测Javascript中的元掩码帐户或网络更改</h1>
<blockquote>原文：<a href="https://medium.com/coinmonks/detecting-metamask-account-or-network-change-in-javascript-using-web3-1-0-0-18433e99df5a?source=collection_archive---------0-----------------------#2018-05-21">https://medium.com/coinmonks/detecting-metamask-account-or-network-change-in-javascript-using-web3-1-0-0-18433e99df5a?source=collection_archive---------0-----------------------#2018-05-21</a></blockquote><div><div class="ef hh hi hj hk hl"/><div class="hm hn ho hp hq"><div class=""/><figure class="fi fk ir is it iu fe ff paragraph-image"><div role="button" tabindex="0" class="iv iw di ix bf iy"><div class="fe ff iq"><img src="../Images/b47e6ffe50892a3abc921943f64aff1b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*quWMG6kX8QulgBVIiOa0Hw.jpeg"/></div></div></figure><p id="15fb" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">开发dApps的一个常见问题是检测用户打算使用元掩码中的哪个帐户。在撰写本文时，即使是Metamask也建议每100毫秒轮询一次。<a class="ae jz" href="https://github.com/MetaMask/faq/blob/master/DEVELOPERS.md#ear-listening-for-selected-account-changes" rel="noopener ugc nofollow" target="_blank"> (Eww) </a></p><pre class="ka kb kc kd fq ke kf kg kh aw ki dt"><span id="6f4d" class="kj kk ht kf b fv kl km l kn ko">//Not a fun pattern to have to use</span><span id="e6ee" class="kj kk ht kf b fv kp km l kn ko">var account = web3.eth.accounts[0];<br/>var accountInterval = setInterval(function() {<br/>  if (web3.eth.accounts[0] !== account) {<br/>    account = web3.eth.accounts[0];<br/>    updateInterface();<br/>  }<br/>}, 100);</span></pre><p id="b129" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">相反，由web3 1.0.0中的元掩码提供程序公开的publicConfigStore发出“更新”事件。连接到它就像:</p><pre class="ka kb kc kd fq ke kf kg kh aw ki dt"><span id="43be" class="kj kk ht kf b fv kl km l kn ko">web3.currentProvider.publicConfigStore.on('update', callback);</span></pre><p id="9db1" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">将使用包含键的对象调用您的回调:{selectedAddress，networkVersion}。您可以使用它来轻松地监听地址或网络变化，并相应地更新您的UI。</p><blockquote class="kq"><p id="5b07" class="kr ks ht bd kt ku kv kw kx ky kz jy ek translated"><a class="ae jz" href="https://coincodecap.com" rel="noopener ugc nofollow" target="_blank">发现并回顾最佳区块链软件</a></p></blockquote><p id="de0a" class="pw-post-body-paragraph jb jc ht jd b je la jg jh ji lb jk jl jm lc jo jp jq ld js jt ju le jw jx jy hm dt translated">这里需要注意的是，由于上面Github上的链接自述文件建议了轮询方法，publicConfigStore在本文撰写时是一个不稳定的特性。就像现在crypto中的其他东西一样，你可以自行决定使用！</p></div><div class="ab cl lf lg hb lh" role="separator"><span class="li bw bk lj lk ll"/><span class="li bw bk lj lk ll"/><span class="li bw bk lj lk"/></div><div class="hm hn ho hp hq"><p id="a9fd" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">和我一起做梦:<a class="ae jz" href="http://www.dream.associates" rel="noopener ugc nofollow" target="_blank"> www.dream.associates </a></p></div></div>    
</body>
</html>