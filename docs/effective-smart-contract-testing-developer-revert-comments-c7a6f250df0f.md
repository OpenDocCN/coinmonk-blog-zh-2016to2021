# æœ‰æ•ˆçš„æ™ºèƒ½åˆçº¦æµ‹è¯•:å¼€å‘è€…å›žå¤è¯„è®º

> åŽŸæ–‡ï¼š<https://medium.com/coinmonks/effective-smart-contract-testing-developer-revert-comments-c7a6f250df0f?source=collection_archive---------3----------------------->

## æ°”ä½“æ•ˆçŽ‡ï¼Œæœ‰é’ˆå¯¹æ€§çš„æ¢å¤æµ‹è¯•ï¼Ÿå¦‚ä½•è®©ä½ çš„[å¸ƒæœ—å°¼](https://github.com/iamdefinitelyahuman/brownie)ä¹Ÿèƒ½åƒä¸‹åŽ»ï¼

![](img/03654e2db806e11459a75e25b3726ac6.png)

æµ‹è¯•æ™ºèƒ½å¥‘çº¦çš„ä¸€ä¸ªå¥½æ–¹æ³•æ˜¯ä¸ºå‡½æ•°çš„æ¯ä¸ªåˆ†æ”¯ç¼–å†™ä¸€ä¸ªæµ‹è¯•ã€‚è€ƒè™‘ä¸‹é¢çš„ä¾‹å­:

æµ‹è¯•`adminTransfer`æ—¶è¦è€ƒè™‘å››ä¸ªåˆ†æ”¯:

1.  æˆåŠŸè½¬ç§»ï¼Œæ ¸å®žä½™é¢å·²æ­£ç¡®è°ƒæ•´ã€‚
2.  å› ä¸ºå‘¼å«è€…ä¸æ˜¯æ‰€æœ‰è€…è€Œå¤±è´¥çš„è½¬ç§»ã€‚
3.  ç”±äºŽæŽ¥æ”¶æ–¹ä¸è¢«å…è®¸è€Œå¤±è´¥çš„ä¸€ç§ä¼ è¾“ã€‚
4.  å› æ±‡æ¬¾äººä½™é¢ä¸è¶³è€Œå¤±è´¥çš„è½¬è´¦ã€‚

å¯¹äºŽç»™å®šçš„ä»£ç ï¼Œå¯¹å¤±è´¥è·¯å¾„çš„æµ‹è¯•æ•ˆæžœæœ‰é™ã€‚ä¾‹å¦‚ï¼Œè€ƒè™‘ä»¥ä¸‹æµ‹è¯•:

æµ‹è¯•é€šè¿‡äº†ï¼Œä½†æ˜¯æˆ‘ä»¬ä¸èƒ½ç¡®å®šç”±äºŽä½™é¢ä¸è¶³è€Œå‘ç”Ÿäº†å›žå¤ã€‚æœ‰å¯èƒ½`accounts[2]`ä¸è¢«å…è®¸æŽ¥æ”¶ä»¤ç‰Œï¼Œæˆ‘ä»¬æœ‰ä¸€ä¸ªé”™è¯¯è¡Œä¸ºäº§ç”Ÿæ­£ç¡®ç»“æžœçš„ä¾‹å­ã€‚çŽ°åœ¨ï¼Œå‡è®¾æˆ‘ä»¬åŽæ¥å¯¹å¥‘çº¦æ‰§è¡Œäº†é‡æž„ï¼Œå¹¶ä¸”æ„å¤–åœ°åˆ é™¤äº†å¯¹è¶³å¤Ÿä½™é¢çš„æ£€æŸ¥ã€‚å› ä¸ºæˆ‘ä»¬å®žé™…ä¸Šå¹¶æ²¡æœ‰æµ‹è¯•æˆ‘ä»¬è®¤ä¸ºæ­£åœ¨æµ‹è¯•çš„ä¸œè¥¿ï¼Œæ‰€ä»¥è¿™ä¸ªæµ‹è¯•ä»ç„¶é€šè¿‡äº†ï¼Œå¹¶ä¸”æˆ‘ä»¬åœ¨ä»£ç ä¸­ç•™ä¸‹äº†ä¸€ä¸ªç›¸å½“å¤§çš„æœªè¢«å‘çŽ°çš„ bugã€‚

# æ¢å¤å­—ç¬¦ä¸²æ•‘æ´ï¼

å¹¸è¿çš„æ˜¯ï¼Œæœ‰ä¸€ä¸ªè§£å†³æ–¹æ¡ˆ:æˆ‘ä»¬å¯ä»¥åœ¨ require è¯­å¥ä¸­æ·»åŠ é”™è¯¯å­—ç¬¦ä¸²ï¼Œå¹¶å°†å®ƒä»¬åŒ…å«åœ¨æµ‹è¯•ä¸­ã€‚ä»¥ä¸‹æ˜¯æˆ‘ä»¬æ›´æ–°åŽçš„ä»£ç :

çŽ°åœ¨ï¼Œæˆ‘ä»¬æ›´æ–°æˆ‘ä»¬çš„æµ‹è¯•ï¼Œä¸“é—¨é’ˆå¯¹é¢„æœŸçš„é”™è¯¯å­—ç¬¦ä¸²:

çŽ°åœ¨ï¼Œæˆ‘ä»¬æµ‹è¯•é€šè¿‡çš„å”¯ä¸€æ–¹æ³•æ˜¯ï¼Œå¦‚æžœå¯¹`adminTransfer`çš„è°ƒç”¨è¿”å›žâ€œä½™é¢ä¸è¶³â€é”™è¯¯å­—ç¬¦ä¸²ã€‚é‡æž„å§ï¼Œæœ‹å‹ä»¬ï¼Œæˆ‘ä»¬çš„æµ‹è¯•ç”¨ä¾‹æ˜¯å¯é çš„ã€‚

ä¸å¹¸çš„æ˜¯ï¼Œä½¿ç”¨é”™è¯¯å­—ç¬¦ä¸²æ˜¯æœ‰ä»£ä»·çš„ã€‚**æ¯ä¸€ä¸ªé”™è¯¯å­—ç¬¦ä¸²éƒ½ä¼šç»™åˆåŒéƒ¨ç½²æˆæœ¬**å¢žåŠ è‡³å°‘ 20ï¼Œ000 gasï¼Œå¹¶ä¸”åœ¨æ‰§è¡Œè¯¥åŠŸèƒ½æ—¶ä¼šå¢žåŠ äº¤æ˜“æˆæœ¬ã€‚ç”±äºŽ[å¥‘çº¦å¤§å°çš„é™åˆ¶](https://github.com/ethereum/EIPs/issues/170)ï¼Œä¸ºæ¯ä¸ª`require`å’Œ`revert`è¯­å¥åŒ…å«ä¸€ä¸ªé”™è¯¯å­—ç¬¦ä¸²é€šå¸¸æ˜¯ä¸åˆ‡å®žé™…çš„ï¼Œæœ‰æ—¶ç”šè‡³æ˜¯ä¸å¯èƒ½çš„ã€‚

æ‰€ä»¥æˆ‘ä»¬é¢ä¸´ä¸€ä¸ªè‰°éš¾çš„å†³å®šã€‚æ›´å¥½çš„æµ‹è¯•ç”¨ä¾‹ï¼Œè¿˜æ˜¯æ›´é«˜æ•ˆçš„ä»£ç ï¼Ÿ

# å¼€å‘è€…å›žå¤è¯„è®ºæ‹¯æ•‘ä¸–ç•Œï¼

å¥½æ¶ˆæ¯æ˜¯:æˆ‘ä»¬å®žé™…ä¸Šä¸éœ€è¦åšè¿™ä¸ªå†³å®šðŸ˜„ [Brownie](https://github.com/iamdefinitelyahuman/brownie) å…è®¸æˆ‘ä»¬å°†æ¢å¤å­—ç¬¦ä¸²ä½œä¸ºæºä»£ç æ³¨é‡Šï¼è¿™äº›é”™è¯¯å­—ç¬¦ä¸²ä¸åŒ…å«åœ¨ç¼–è¯‘çš„å­—èŠ‚ç ä¸­ï¼Œä½†æ˜¯åœ¨è¿è¡Œæµ‹è¯•æ—¶ä»ç„¶å¯ä»¥è®¿é—®ã€‚è¿™æ˜¯ä¸¤å…¨å…¶ç¾Žçš„æ–¹æ³•â€” **æ‚¨å¯ä»¥ç¼–å†™é’ˆå¯¹ç‰¹å®š** `**require**` **æˆ–** `**revert**` **è¯­å¥çš„æµ‹è¯•ï¼Œè€Œä¸ä¼šå½±å“æ‚¨çš„å¥‘çº¦**çš„æ•ˆçŽ‡ã€‚

æŸ¥çœ‹æˆ‘ä»¬çš„ç¤ºä¾‹ä»£ç ï¼Œæ›´æ–°åŽå¯ä»¥åˆ©ç”¨å¼€å‘äººå‘˜å›žå¤æ³¨é‡Š:

å’Œæ›´æ–°çš„æµ‹è¯•ç”¨ä¾‹:

ä½¿ç”¨å¼€å‘äººå‘˜å›žå¤æ³¨é‡Šå¾ˆç®€å•ã€‚åœ¨åŒ…å«æ½œåœ¨æ¢å¤çš„ä¸€è¡Œä»£ç çš„æœ«å°¾ï¼Œæ·»åŠ ä¸€ä¸ªä»¥ Solidity ä¸­çš„`// dev:`æˆ– Vyper ä¸­çš„`# dev:`å¼€å¤´çš„æ³¨é‡Šã€‚å¸ƒæœ—å°¼æ£€æµ‹åˆ°è¿™äº›è¯„è®ºï¼Œç„¶åŽè‡ªåŠ¨å®Œæˆå‰©ä¸‹çš„*ã€‚å°±è¿™ä¹ˆç®€å•ï¼*

# *è¦äº†è§£æ›´å¤šä¿¡æ¯â€¦*

*æŸ¥çœ‹ Brownie [æ–‡æ¡£](https://eth-brownie.readthedocs.io/en/stable/index.html)ä»¥äº†è§£æ›´å¤šå…³äºŽ[developer revert comments](https://eth-brownie.readthedocs.io/en/stable/tests-pytest-intro.html#developer-revert-comments)çš„ä¿¡æ¯ï¼Œæˆ–è€…æ›´ä¸€èˆ¬çš„å…³äºŽ[åœ¨ Python ä¸­æµ‹è¯•æ™ºèƒ½åˆçº¦](https://eth-brownie.readthedocs.io/en/stable/tests-pytest-intro.html)çš„ä¿¡æ¯ã€‚*

*ä½ ä¹Ÿå¯ä»¥åŠ å…¥ Brownie Gitter é¢‘é“ï¼Œå‘å…¶ä»–ä½¿ç”¨ Brownie è¿›è¡Œæµ‹è¯•çš„å¼€å‘è€…æé—®æˆ–äº¤æµã€‚å¹¶ä¸”ï¼Œä¸€å¦‚æ—¢å¾€ï¼Œéšæ—¶å¯ä»¥é€šè¿‡[ç”µå­é‚®ä»¶](mailto:ben@hauser.id)æˆ–[ç”µæŠ¥](https://t.me/iamdefinitelyahuman)ç›´æŽ¥è”ç³»æˆ‘ã€‚æˆ‘å¾ˆæƒ³æ”¶åˆ°ä½ çš„æ¥ä¿¡ã€‚*

> *[ç›´æŽ¥åœ¨æ‚¨çš„æ”¶ä»¶ç®±ä¸­èŽ·å¾—æœ€ä½³è½¯ä»¶äº¤æ˜“](https://coincodecap.com/?utm_source=coinmonks)*

*[![](img/7c0b3dfdcbfea594cc0ae7d4f9bf6fcb.png)](https://coincodecap.com/?utm_source=coinmonks)**[![](img/e9dbce386c4f90837b5db529a4c87766.png)](https://coincodecap.com)*