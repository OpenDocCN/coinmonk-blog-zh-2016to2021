# ä»¥å¤ªåŠä¸­çš„æ•°æ®ç»“æ„|ç¬¬ 4 é›†:æ·±å…¥ç¤ºä¾‹ã€‚

> åŸæ–‡ï¼š<https://medium.com/coinmonks/data-structure-in-ethereum-episode-4-diving-by-examples-f6a4cbd8c329?source=collection_archive---------0----------------------->

![](img/dfb09102e89ea5f24781c17d4cd5922f.png)

Image source: [**pxhere.com**](https://pxhere.com/en/photo/674690)

ä»ç¬¬ä¸€é›†åˆ°è¿™é‡Œä¼¼ä¹æ˜¯ä¸€ä¸ªæ¼«é•¿çš„æ—…ç¨‹ï¼Œæˆ‘ä»¬å·²ç»å¾—åˆ°äº†æˆ‘ä»¬éœ€è¦çš„ä¸€åˆ‡ï¼Œè¿™ä¸€æ¬¡ï¼Œè¿™å°†æ˜¯æœ€åä¸€æ¬¡è®©ä¸€åˆ‡éƒ½æ¸…æ¥šä»¥å¤ªåŠæ•°æ®åœ¨å®è·µä¸­æ˜¯å¦‚ä½•ç»„ç»‡çš„ã€‚

> åœ¨æˆ‘çœ‹æ¥ï¼Œç”¨ä¾‹å­ç»ƒä¹ æ˜¯å¤„ç†å’Œæ·±å…¥ä»»ä½•é—®é¢˜çš„æœ€å¥½æ–¹æ³•ã€‚é€šè¿‡åˆ›å»ºä¸€ä¸ªä¾‹å­ï¼Œæˆ‘çœŸå¿ƒå¸Œæœ›å®ƒèƒ½å¸®åŠ©ä½ æ¸…æ¥šåœ°ç†è§£ä»¥å¤ªåŠä¸­çš„æ•°æ®ç»“æ„ã€‚

å¦‚æœä¸æƒ³å¼„è„è‡ªå·±çš„æ‰‹ï¼Œå¯ä»¥å…‹éš†æˆ‘çš„ git(å¼€å‘åˆ†æ”¯)æ›´æ–¹ä¾¿ã€‚

[](https://github.com/sontuphan/Trie/tree/develop) [## æ¾å›¾æ½˜/ç‰¹é‡Œ

### åœ¨ GitHub ä¸Šåˆ›å»ºä¸€ä¸ªå¸æˆ·ï¼Œä¸º Trie å¼€å‘åšå‡ºè´¡çŒ®ã€‚

github.com](https://github.com/sontuphan/Trie/tree/develop) 

ä¸€äº›è§„æ ¼:

1.  å®Œæ•´èŠ‚ç‚¹:Geth
2.  ç½‘ç»œ:Ropsten testnet
3.  ç¼–ç¨‹è¯­è¨€:Javascript/NodeJS
4.  ç ”ç©¶ä¸»é¢˜:state trie (stateRoot)

![](img/4c4510c72745465850326871aae8669d.png)

What we have to do.

***Geth***

é€šè¿‡è¿™ä¸ªé“¾æ¥ï¼Œä½ å°†çŸ¥é“å¦‚ä½•åœ¨ä½ çš„è®¡ç®—æœºä¸Šè®¾ç½® geth ä¸ºä¸€ä¸ªå®Œæ•´çš„èŠ‚ç‚¹ã€‚

[](https://github.com/ethereum/go-ethereum/wiki/geth) [## ä»¥å¤ªåŠ/å›´æ£‹ä»¥å¤ªåŠ

### ä»¥å¤ªåŠ-ä»¥å¤ªåŠåè®®çš„å®˜æ–¹ go å®ç°

github.com](https://github.com/ethereum/go-ethereum/wiki/geth) 

è¦å¯åŠ¨ Ropsten testnet çš„å®Œå…¨åŒæ­¥æ¨¡å¼å¹¶æ‰“å¼€ RPCï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤:

```
geth --testnet --datadir "~/Library/Ethereum/ropsten" --rpc --rpcapi "eth,net,personal,web3" --rpcaddr "0.0.0.0" --rpccorsdomain "*" --ws --wsapi "eth,net,personal,web3" --wsorigins "0.0.0.0"
```

è¯·è®°ä½ï¼Œæ‚¨åº”è¯¥åœ¨`--datadir`æ ‡å¿—ä¹‹åæ›´æ”¹å‚æ•°ï¼Œä»¥ä¾¿æ‚¨å¯ä»¥ä½¿ç”¨ã€‚

å› ä¸ºæˆ‘ä»¬åœ¨å®Œå…¨åŒæ­¥æ¨¡å¼ä¸‹è¿è¡Œ gethï¼Œè¿™æ„å‘³ç€ geth éœ€è¦æ—¶é—´(ç›¸å½“é•¿ğŸ˜‚åœ¨æˆ‘çš„æƒ…å†µä¸‹ï¼Œå¤§çº¦ 3 å¤©)æ¥åŒæ­¥æ•´ä¸ªåŒºå—é“¾æ•°æ®ã€‚å½“ä½ çœ‹åˆ°è¿™æ ·çš„æ—¥å¿—ï¼Œæˆ‘å¾ˆç¡®å®šå®ƒå®Œæˆäº†ã€‚

![](img/e723d33e9339be65176880eb2fa901b7.png)

Full sync.

***Web3 â€”æµ‹è¯• geth***

è¯·å‚è€ƒç½‘ç«™ 3 çš„é“¾æ¥:

[](https://github.com/ethereum/wiki/wiki/JavaScript-API) [## ä»¥å¤ªåŠ/ç»´åŸº

### ç»´åŸº-ä»¥å¤ªåŠç»´åŸº-

github.com](https://github.com/ethereum/wiki/wiki/JavaScript-API) 

é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦åˆ›å»ºä¸€ä¸ª nodeJS é¡¹ç›®ï¼Œç„¶åå®‰è£… web3 åŒ…ã€‚

å°è¯•è¿è¡Œ`getStateRoot`åŠŸèƒ½ï¼Œå…¶ä¸­`blockNumber`æ˜¯ Ropsten ä¸Šå‡ ä¹æœ€æ–°çš„å—å·ã€‚æˆ‘ä»¬é¿å…è·å–æœ€æ–°çš„ï¼Œå› ä¸ºè¿™å°†å¯¼è‡´å»¶è¿ŸåŒæ­¥çš„é£é™©ï¼Œæ‰€ä»¥æ¥è¿‘æœ€æ–°çš„å—å·æ˜¯ä¸€ä¸ªæ˜æ™ºçš„é€‰æ‹©ã€‚æˆ‘çš„é€‰æ‹©æ˜¯`2596315`åœ¨ä½ è¯»è¿™ç¯‡æ–‡ç« çš„é‚£ä¸€åˆ»å¯èƒ½å°±ä¸ä¸€æ ·äº†ã€‚å°å¿ƒç‚¹ã€‚

æˆ‘è·‘`getStateRoot(2596315)`çš„ç»“æœ:

```
stateRoot: 0x1a63facb2a82966504a643f7c6cce28ddb47ea056b02009975c665bdada64c81
```

> æ­¤æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥ç¡®ä¿å®Œæ•´èŠ‚ç‚¹èƒ½å¤Ÿå®Œç¾åœ°å·¥ä½œã€‚

***levelDB***

[](https://github.com/google/leveldb) [## è°·æ­Œ/leveldb

### leveldb æ˜¯ä¸€ä¸ªç”± Google ç¼–å†™çš„å¿«é€Ÿé”®å€¼å­˜å‚¨åº“ï¼Œå®ƒæä¾›äº†ä» stringâ€¦

github.com](https://github.com/google/leveldb) 

å…³äº levelDBï¼Œæˆ‘ä»¬éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå®ƒä¸€æ¬¡åªå…è®¸ä¸€ä¸ªè¿æ¥ã€‚å› æ­¤ï¼Œæˆ‘ä»¬éœ€è¦åœ¨å®Œå…¨åŒæ­¥ååœæ­¢ gethï¼Œä»¥ä¾¿è¿›è¡Œåç»­æ­¥éª¤ã€‚

ä¸ºäº†é€šè¿‡ NodeJS åˆ›å»ºè¿æ¥ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ä¸¤ä¸ªåŒ…`levelup`å’Œ`leveldown`ã€‚æ‰€ä»¥è¯·å®‰è£…`levelup`ã€`leveldown`å’Œ`path`æ¨¡å—ã€‚

[](https://github.com/Level/levelup) [## æ°´å¹³/æ°´å¹³æå‡

### level upâ€”â€”ä¸€ä¸ª node.js åŒ…è£…å™¨ï¼Œç”¨äºå…¼å®¹æŠ½è±¡çº§åˆ«é™ä½çš„å­˜å‚¨

github.com](https://github.com/Level/levelup) 

åˆ›å»ºè¿æ¥:

Create a connection to levelDB.

åœ¨è¿™é‡Œï¼Œæˆ‘å°è¯•ç”¨æŒ‡å‘æˆ‘çš„ chaindata æ–‡ä»¶å¤¹çš„ç‰¹å®šè·¯å¾„è¿æ¥åˆ°æˆ‘çš„ levelDB(è¿™ä¸ªè·¯å¾„å–å†³äºæˆ‘ä»¬å¯åŠ¨ geth æ—¶çš„é…ç½®)ã€‚ç„¶åï¼Œæˆ‘å°†å®ƒå…¨çƒåŒ–ä»¥å¤‡åç”¨ã€‚

***å…ˆæ½œå…¥æ•°æ®åº“***

> åœ¨ Web3 â€” Testing geth éƒ¨åˆ†ï¼Œæˆ‘å¾—åˆ°äº†å—å·ä¸º 2596315 çš„ stateRootã€‚å› ä¸ºæˆ‘ä»¬ç”¨äº† web3ï¼Œæ‰€ä»¥ç»“æœè‚¯å®šæ˜¯æ­£ç¡®çš„ã€‚

ç°åœ¨ï¼Œæˆ‘ä»¬é€šè¿‡åœ¨ä¸ç‰¹å®šå—å·å¯¹åº”çš„å—å¤´ä¸­è·å– stateRoot æ¥å‘å‡ºè­¦å‘Šï¼Œç„¶åæˆ‘ä»¬å°†å®ƒä¸ Web3 ä¸­çš„å…ˆå‰ç»“æœè¿›è¡Œæ¯”è¾ƒâ€”æµ‹è¯• geth éƒ¨åˆ†ã€‚

è¯·å…ˆå®‰è£…`ethereumjs-block`æ¨¡å—ï¼Œæˆ‘ä»¬éœ€è¦å®ƒæ¥è§£æå—æ•°æ®ã€‚

![](img/e2836c29b5b0d356c87773c8d6985345.png)

Warn-up steps.

æºä»£ç :

**å…³äº`utils`åº“ï¼Œè¯·çœ‹ä¸€ä¸‹æˆ‘çš„å›è´­è·å–æºä»£ç ã€‚è·¯å¾„æ˜¯`./libs/utils`ã€‚

ç¬¬ä¸€æ­¥ï¼Œæˆ‘ä»¬éœ€è¦åœ¨`2596315`çš„å·¦è¾¹å¡«å……ä¸€ä¸ªæ•°å­—`0`ï¼Œè¿™æ ·æ€»é•¿åº¦å°±æ˜¯ 16ï¼Œæ³¨æ„æˆ‘ä»¬åšçš„æ‰€æœ‰äº‹æƒ…éƒ½æ˜¯åå…­è¿›åˆ¶çš„ã€‚

`hexBlockNumber = 00 00 00 00 00 27 9d db`

åœ¨ geth ä¸­ï¼Œä»–ä»¬ç”¨`h`åšå‰ç¼€ï¼Œç”¨`n`åšåç¼€ã€‚

```
prefix = 68
suffix = 6e
```

ç„¶åï¼Œæˆ‘ä»¬æŠŠå®ƒä»¬æŒ‰é¡ºåºè¿æ¥èµ·æ¥ã€‚

```
keyString = prefix + hexBlockNumber + suffix = 68 00 00 00 00 00 27 9d db 6e
```

ç»“æœå¦‚ä¸‹:

![](img/05e247304d5589134c9925160718a4b3.png)

Warn-up results.

æ­£å¦‚æˆ‘ä»¬æ‰€è§ï¼Œæœ€ç»ˆç»“æœä¸ web3 éƒ¨åˆ†çš„ç»“æœç›¸åŒã€‚

> æ­å–œä½ ï¼ï¼ï¼æˆ‘ä»¬ç¬¬ä¸€æ¬¡æ½œå…¥çœŸæ­£çš„*ğŸ’©*

**å˜æ·±*å˜æ·±*å˜æ·±**

æˆ‘ä»¬å°†ä½¿ç”¨`merkle-patricia-tree`å’Œ`rlp`æ¨¡å—ï¼Œè®©æˆ‘ä»¬å®‰è£…å®ƒã€‚

ç°åœ¨ï¼Œæˆ‘ä»¬å¼€å§‹åˆ›å»ºä¸€ä¸ª`trie`åº“ï¼Œå®ƒä½¿ç”¨ä»¥å¤ªåŠåœ°å€æ¥è§£æä¿å­˜åœ¨çŠ¶æ€ trie ä¸­çš„å…¨éƒ¨ä¿¡æ¯ã€‚

é’ˆå¯¹`getInfoByAddress`å‡½æ•°ï¼Œæˆ‘ä»¬ä½¿ç”¨`merkle-patricia-tree`åˆ›å»ºå¸¦æœ‰`root`è¾“å…¥çš„ trieï¼Œç„¶åé€šè¿‡è¿™ä¸ª trie å¾—åˆ°ä¸€ä¸ªåœ°å€çš„æ•°æ®ã€‚è¯·è®°ä½ï¼Œæ‰€æœ‰æ•°æ®åœ¨ä¿å­˜ä¸‹æ¥ä¹‹å‰éƒ½æ˜¯ç”±`rlp`ç¼–ç çš„ï¼Œä¸ºäº†è¯»å‡ºè¿™äº›æ•°æ®ï¼Œæˆ‘ä»¬éœ€è¦å¯¹å®ƒä»¬è¿›è¡Œè§£ç ã€‚

è¿™æ˜¯ä¸€ä¸ªå®Œæ•´çš„ä¾‹å­:

ç»“æœæ˜¯:

![](img/6c3a7a6f0778ba0d36acad89b0b49a90.png)

The final result.

ä¸€ä¸ªåœ°å€æ•°æ®åŒ…å« 4 ä¸ªä¿¡æ¯ã€‚å®ƒä»¬ä¾æ¬¡æ˜¯ nonceã€balanceã€storageRoot å’Œ codeHashã€‚

> [ç›´æ¥åœ¨æ‚¨çš„æ”¶ä»¶ç®±ä¸­è·å¾—æœ€ä½³è½¯ä»¶äº¤æ˜“](https://coincodecap.com/?utm_source=coinmonks)

[![](img/7c0b3dfdcbfea594cc0ae7d4f9bf6fcb.png)](https://coincodecap.com/?utm_source=coinmonks)

***ç»“è®º***

è¿™ä¸æ˜¯è¿™ä¸ªç³»åˆ—çš„ç»“æŸï¼Œæˆ‘ä»¬å°†æœ‰ä¸€äº›å…³äºä¿®å‰ªæ ‘ã€‚ä½†æ˜¯ä¹Ÿè®¸å°†æ¥ä¼šè¢«åˆ†äº«ï¼Œå› ä¸ºæˆ‘å¯¹å®ƒçš„äº†è§£è¿˜ä¸å¤šã€‚

![](img/7212f518e32ef787d8ba0f9f7b2e27f9.png)

ğŸ˜±

> å¬åˆ°è¿™é‡Œå¯èƒ½ä¼šéš¾è¿‡:))

***å‚è€ƒæ–‡çŒ®***

[](https://ethereum.stackexchange.com/questions/28976/leveldb-in-geth-key-and-values) [## Gethã€key å’Œå€¼ä¸­çš„ LevelDB

### å½“è§£æ levelDB æˆ– RocksDB æ—¶(å–å†³äºæ‚¨ä½¿ç”¨çš„å®¢æˆ·ç«¯),æœ‰å­—ç¬¦ä¸²å€¼â€¦

ethereum.stackexchange.com](https://ethereum.stackexchange.com/questions/28976/leveldb-in-geth-key-and-values) [](https://wanderer.github.io/ethereum/nodejs/code/2014/05/21/using-ethereums-tries-with-node/) [## ç”¨ Node.js æ¢ç´¢ä»¥å¤ªåŠçš„çŠ¶æ€ trie

### æ¼«æ¸¸è€…åˆå null_radix åœ¨è¿™é‡Œå†™ä¸œè¥¿ã€‚ä¸»è¦æ˜¯å…³äºç¼–ç¨‹

æ¼«æ¸¸è€…. github.io](https://wanderer.github.io/ethereum/nodejs/code/2014/05/21/using-ethereums-tries-with-node/)