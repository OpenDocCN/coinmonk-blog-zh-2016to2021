<html>
<head>
<title>Deploy an Efficient-Address Contract: A Walkthrough</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">部署高效地址协定:演练</h1>
<blockquote>原文：<a href="https://medium.com/coinmonks/deploy-an-efficient-address-contract-a-walkthrough-cb4be4ffbc70?source=collection_archive---------0-----------------------#2019-01-15">https://medium.com/coinmonks/deploy-an-efficient-address-contract-a-walkthrough-cb4be4ffbc70?source=collection_archive---------0-----------------------#2019-01-15</a></blockquote><div><div class="ef hh hi hj hk hl"/><div class="hm hn ho hp hq"><div class=""/><figure class="fi fk ir is it iu fe ff paragraph-image"><div role="button" tabindex="0" class="iv iw di ix bf iy"><div class="fe ff iq"><img src="../Images/87775bbfa0ba3676e2b279e30f51621c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Hb8oMYD0bHTmWCcV5ljZ-Q.jpeg"/></div></div><figcaption class="jb jc fg fe ff jd je bd b be z ek">Because gas can get expensive!</figcaption></figure><p id="e437" class="pw-post-body-paragraph jf jg ht jh b ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc hm dt translated">你可能听说过节能以太坊合同地址应该是一个东西。如果不太麻烦的话，也许你甚至想在下一份合同中使用它。很可能，你根本不知道我在说什么。如果你属于后一类，我鼓励你<a class="ae kd" rel="noopener" href="/@0age/on-efficient-ethereum-addresses-3fef0596e263">看看最后一个帖子</a>中所有可怕的细节——尽管之后你<em class="ke">仍然</em>可能不知道我到底在说什么。这里是它的要点:<strong class="jh hu">具有额外零字节的地址通常使用</strong>花费更少的汽油，并且有一种<strong class="jh hu">更有效的方法来创建驻留在这些地址的契约</strong>。</p><p id="4625" class="pw-post-body-paragraph jf jg ht jh b ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc hm dt translated">与其重复所有你可能想要使用一个有节能地址的合同的理由，不如让我们开始工作，学习如何部署你的下一个有节能地址的合同。根据您的特定使用情形、您的计算能力、您的技术敏锐度以及您的关系状态，您有六种选择:</p><ol class=""><li id="82e2" class="kf kg ht jh b ji jj jm jn jq kh ju ki jy kj kc kk kl km kn dt translated">以通常的方式将协定部署到一个低效的地址。<em class="ke">(哈欠…) </em></li><li id="7b6a" class="kf kg ht jh b ji ko jm kp jq kq ju kr jy ks kc kk kl km kn dt translated">通过CREATE以传统方式将合同部署到一个高效的地址。</li><li id="93c7" class="kf kg ht jh b ji ko jm kp jq kq ju kr jy ks kc kk kl km kn dt translated">使用<strong class="jh hu"> CREATE2和一个工厂契约</strong> <em class="ke">(比如巧妙命名的</em> <code class="eh kt ku kv kw b"><a class="ae kd" href="https://github.com/0age/Pr000xy/blob/master/contracts/Create2Factory.sol" rel="noopener ugc nofollow" target="_blank">Create2Factory</a></code> <em class="ke"> ) </em>将契约部署到一个高效的地址。</li><li id="3df4" class="kf kg ht jh b ji ko jm kp jq kq ju kr jy ks kc kk kl km kn dt translated"><strong class="jh hu">将一个</strong> <a class="ae kd" href="https://github.com/zeppelinos/zos/blob/master/packages/lib/contracts/upgradeability/AdminUpgradeabilityProxy.sol" rel="noopener ugc nofollow" target="_blank"> <strong class="jh hu">可升级的透明代理</strong> </a>部署到一个高效的地址，并使用 <code class="eh kt ku kv kw b"><a class="ae kd" href="https://github.com/0age/Pr000xy/blob/master/contracts/Pr000xy.sol" rel="noopener ugc nofollow" target="_blank"><strong class="jh hu">Pr000xy</strong></a></code>将您的契约设置为实现<strong class="jh hu">。</strong></li><li id="42c4" class="kf kg ht jh b ji ko jm kp jq kq ju kr jy ks kc kk kl km kn dt translated">从朋友那里得到一些 <code class="eh kt ku kv kw b"><strong class="jh hu">Pr000xy</strong></code> <strong class="jh hu">令牌</strong>，用它们来申请一个可升级的透明代理，跳过这个过程中比较棘手的部分。</li><li id="49d7" class="kf kg ht jh b ji ko jm kp jq kq ju kr jy ks kc kk kl km kn dt translated">记住这是你的周年纪念日，放下你正在做的一切，开始写一首十四行诗和烤纸杯蛋糕。</li></ol><p id="2918" class="pw-post-body-paragraph jf jg ht jh b ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc hm dt translated">当谈到选项1和6时，你只能靠自己，所以我们将把注意力集中在选项2到5上。如果您还不习惯于部署智能合约和/或与智能合约直接交互，那么您可能不是接下来大部分内容的目标受众。让我们开始吧。</p><h1 id="ae80" class="kx ky ht bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu dt translated">OG方法</h1><p id="c408" class="pw-post-body-paragraph jf jg ht jh b ji lv jk jl jm lw jo jp jq lx js jt ju ly jw jx jy lz ka kb kc hm dt translated">自从地址出现以来，虚名地址就一直存在。他们更“令人难忘”或更“幸运”，在一个充斥着大肆宣传的江湖骗子和堕落赌徒的加密货币空间里，这两种特质都是可取的。以太坊名称服务着手解决“令人难忘”的部分，但仍然需要解决“幸运”的部分。出于这个原因，<a class="ae kd" href="https://github.com/Arachnid/vaniteth" rel="noopener ugc nofollow" target="_blank">消失了</a>创建了<em class="ke">(嗯，实际原因是为了帮助使ENS注册地址</em> <strong class="jh hu"> <em class="ke">本身</em> </strong> <em class="ke">容易记忆，但是我离题了)</em>。简而言之，方法如下:</p><ul class=""><li id="b3e8" class="kf kg ht jh b ji jj jm jn jq kh ju ki jy kj kc ma kl km kn dt translated">使用一些可靠的熵源生成私钥，并导出相关的地址。</li><li id="3b7a" class="kf kg ht jh b ji ko jm kp jq kq ju kr jy ks kc ma kl km kn dt translated">在第一次执行多达<em class="ke"> N </em>个事务后确定契约部署地址，其中<em class="ke"> N </em>是您愿意使用的最高nonce。</li><li id="0099" class="kf kg ht jh b ji ko jm kp jq kq ju kr jy ks kc ma kl km kn dt translated">重复此操作，直到找到符合您要求的地址。</li><li id="e1ab" class="kf kg ht jh b ji ko jm kp jq kq ju kr jy ks kc ma kl km kn dt translated">为该地址提供资金，并进行足够的虚拟交易，以将随机数发送到适当的地点。</li><li id="607e" class="kf kg ht jh b ji ko jm kp jq kq ju kr jy ks kc ma kl km kn dt translated">最后，部署合同，享受你完成的技术壮举。</li></ul><p id="bad6" class="pw-post-body-paragraph jf jg ht jh b ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc hm dt translated">这种方法可以完成工作，并且在使用大值的<em class="ke"> N </em>时会更快，但是有几个很大的缺点:</p><ul class=""><li id="f9c3" class="kf kg ht jh b ji jj jm jn jq kh ju ki jy kj kc ma kl km kn dt translated">在部署合同时，你必须<strong class="jh hu">格外小心，以获得恰到好处的随机数<em class="ke"/></strong>，最终<strong class="jh hu">浪费时间和精力</strong>，因为你必须为地址提供资金，并进行一系列交易来增加随机数。</li><li id="a4c5" class="kf kg ht jh b ji ko jm kp jq kq ju kr jy ks kc ma kl km kn dt translated">你必须<strong class="jh hu">生成大量的私有密钥</strong>，这降低了你遍历候选对象的速度，并且需要一个好的熵源，除非你想被黑客攻击。</li><li id="4493" class="kf kg ht jh b ji ko jm kp jq kq ju kr jy ks kc ma kl km kn dt translated">即使你有很好的熵，如果有人在你的机器上安装了键盘记录器或者在采矿软件中安装了后门，或者可以通过其他方式窃取私钥，他们就可以窃取你的硬币和/或把nonce推得太高，以至于你无法将合同部署到正确的地址，那么你仍然有可能被黑客攻击。<em class="ke">(我还应该提到</em> <a class="ae kd" href="https://en.bitcoin.it/wiki/Split-key_vanity_address" rel="noopener ugc nofollow" target="_blank"> <em class="ke">分割密钥地址派生</em> </a> <em class="ke">可以用来防御这种情况——但是，请记住，契约没有私钥，所以您仍然需要为地址提供资金，增加nonce，并部署契约。)</em></li></ul><p id="e8d5" class="pw-post-body-paragraph jf jg ht jh b ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc hm dt translated">所以，如果你有耐心，怀旧，伟大的op-sec，和一个洞在你的口袋里，然后这个有你的名字在它上面！好消息是已经有高性能的库支持这个选项——看看<a class="ae kd" href="https://github.com/johguse/profanity" rel="noopener ugc nofollow" target="_blank"> profanity </a>或<a class="ae kd" href="https://github.com/Limeth/ethaddrgen" rel="noopener ugc nofollow" target="_blank"> ethaddrgen </a>就知道了。</p><h1 id="0f0c" class="kx ky ht bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu dt translated">新来的人</h1><p id="a8b2" class="pw-post-body-paragraph jf jg ht jh b ji lv jk jl jm lw jo jp jq lx js jt ju ly jw jx jy lz ka kb kc hm dt translated">随着君士坦丁堡<em class="ke">(现在在Ropsten上直播，预定在mainnet上7，280，000块)</em>的出现，有了一种新的部署契约的方式:<a class="ae kd" href="https://eips.ethereum.org/EIPS/eip-1014" rel="noopener ugc nofollow" target="_blank"> CREATE2 </a>。在确定契约部署地址时，它不使用调用者的地址和随机数作为输入，而是使用<strong class="jh hu">调用契约的地址</strong>、一个<strong class="jh hu"> 32字节salt </strong>和正在部署的契约的<strong class="jh hu">初始化代码</strong>。与旧的现状相比，这有几个优点，因为它与虚荣心地址有关:</p><ul class=""><li id="fa08" class="kf kg ht jh b ji jj jm jn jq kh ju ki jy kj kc ma kl km kn dt translated">不需要生成新的密钥对，甚至不需要安全熵，因为salt可以递增<em class="ke">(只要小心避免冲突，就不会重复检查相同的salt) </em>。这提高了您遍历候选对象的速度，并防止由于缺乏高级加密和安全随机数生成知识而被黑客攻击。</li><li id="7ce5" class="kf kg ht jh b ji ko jm kp jq kq ju kr jy ks kc ma kl km kn dt translated">你不需要为一个新的、潜在的pwned地址出资，也不需要浪费你的精力和理智:只要从你已经控制的账户发送一笔交易就可以了。</li><li id="6c58" class="kf kg ht jh b ji ko jm kp jq kq ju kr jy ks kc ma kl km kn dt translated"><strong class="jh hu">攻击面以<em class="ke">的方式</em>向下</strong>，你可信赖的私人密钥安然无恙地放在你的硬件钱包里——如果你愿意，你甚至可以从另一份已经存在的合同中将其踢开。(你用的是硬件钱包吧？)</li></ul><p id="aec9" class="pw-post-body-paragraph jf jg ht jh b ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc hm dt translated">这一切都很好，但有一个重要的警告<em class="ke">(总是有警告，该死！)</em>牢记在心。除了在事务中省略<code class="eh kt ku kv kw b">to</code>字段并将初始化代码作为调用数据，您还需要通过一个<strong class="jh hu"> <em class="ke">工厂契约</em> </strong>来为您调用CREATE2。工厂合同最好对它将接受什么salt和来自谁有一些访问控制，否则你将容易受到抢先运行的攻击:当你提交salt时，监视事务池的人可以看到并抢先你一步。解决这个问题的一个好方法是让工厂契约<strong class="jh hu">使用</strong> <code class="eh kt ku kv kw b"><strong class="jh hu">msg.sender</strong></code> <strong class="jh hu">作为salt </strong>的前20个字节，剩下最后12个字节可用于查找所需的契约地址<em class="ke">(这仍然留给2⁹⁶或每个调用者大约79000万亿个可能性)</em>。</p><p id="6a58" class="pw-post-body-paragraph jf jg ht jh b ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc hm dt translated">让我们看看使用<code class="eh kt ku kv kw b">Create2Factory</code>部署基本契约的步骤:</p><ul class=""><li id="489f" class="kf kg ht jh b ji jj jm jn jq kh ju ki jy kj kc ma kl km kn dt translated"><strong class="jh hu">获取您想要部署的契约的初始化代码</strong>，然后<strong class="jh hu">计算它的32字节keccak-256哈希</strong>。</li><li id="7874" class="kf kg ht jh b ji ko jm kp jq kq ju kr jy ks kc ma kl km kn dt translated"><strong class="jh hu">在给定<strong class="jh hu">初始化代码散列</strong>和<strong class="jh hu"> salt </strong>的情况下，确定<code class="eh kt ku kv kw b">Create2Factory</code>将把合同部署到的地址</strong>，并使用新的salt重复上述操作，直到找到符合您的规范的地址。</li><li id="330c" class="kf kg ht jh b ji ko jm kp jq kq ju kr jy ks kc ma kl km kn dt translated"><strong class="jh hu">通过调用<code class="eh kt ku kv kw b">Create2Factory</code>并提供<strong class="jh hu"> salt </strong>和<strong class="jh hu">契约初始化代码</strong>作为参数来部署契约</strong>，记住<strong class="jh hu">从salt开头编码的地址调用它。</strong></li></ul><p id="4949" class="pw-post-body-paragraph jf jg ht jh b ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc hm dt translated">相比之下很简单，是吧？这里有一种方法可以找到一个salt，我们可以在Ropsten 上给<code class="eh kt ku kv kw b"><a class="ae kd" href="https://ropsten.etherscan.io/address/0xa779284f095ef2ebb8ee26cd8384e49c57b26996" rel="noopener ugc nofollow" target="_blank">Create2Factory</a></code> <a class="ae kd" href="https://ropsten.etherscan.io/address/0xa779284f095ef2ebb8ee26cd8384e49c57b26996" rel="noopener ugc nofollow" target="_blank">它将导致一个具有有效地址的契约。它使用了不起眼的<code class="eh kt ku kv kw b"><a class="ae kd" href="https://github.com/0age/create2crunch" rel="noopener ugc nofollow" target="_blank"><strong class="jh hu">create2crunch</strong></a></code>地址矿工连同德高望重的</a><a class="ae kd" href="https://github.com/trufflesuite/truffle" rel="noopener ugc nofollow" target="_blank">松露</a> &amp; <a class="ae kd" href="https://github.com/ethereum/web3.js/tree/1.0" rel="noopener ugc nofollow" target="_blank"> Web3.js v1.0 </a>库<em class="ke">(安装</em> <a class="ae kd" href="https://rustup.rs/" rel="noopener ugc nofollow" target="_blank"> <em class="ke">锈v1.31.1 </em> </a> <em class="ke">，</em> <a class="ae kd" href="https://nodejs.org/en/download/" rel="noopener ugc nofollow" target="_blank"> <em class="ke">节点v.11.4.0 </em> </a> <em class="ke">，以及</em> <a class="ae kd" href="https://yarnpkg.com/lang/en/docs/install" rel="noopener ugc nofollow" target="_blank"> <em class="ke">纱</em> </a> 【T31)</p><pre class="mb mc md me fq mf kw mg mh aw mi dt"><span id="c1dc" class="mj ky ht kw b fv mk ml l mm mn">### Set up new project from scratch and install stuff.  [¬°-°]¬ ###<br/>$ yarn global add truffle  # install truffle if you need to<br/>$ mkdir myFirstEfficientAddress &amp;&amp; cd myFirstEfficientAddress<br/>$ truffle init<br/>$ yarn init  # fill in the fields (or don't, I'm not your mother)<br/>$ yarn add web3@1.0.0-beta.37</span><span id="0620" class="mj ky ht kw b fv mo ml l mm mn">### Behold: the example contract source code!  ⊹╰(⌣ʟ⌣)╯⊹ ###<br/>$ cat &gt;./contracts/ExampleContract.sol &lt;&lt;EOL<br/>pragma solidity ^0.5.0;<br/>contract ExampleContract {<br/>  function exampleFunction() public pure returns (bool) {<br/>    return true;<br/>  }<br/>}<br/>EOL</span><span id="8f14" class="mj ky ht kw b fv mo ml l mm mn">### Compile time!  ᕕ(⌐■_■)ᕗ ♪♬  ###<br/>$ truffle compile</span><span id="6874" class="mj ky ht kw b fv mo ml l mm mn">### Create a little script for hashing init code.  ._.)/\(._. ###<br/>$ cat &gt;./getInitCodeHash.js &lt;&lt;EOL<br/>var Web3 = require('web3')<br/>const artifact = require('./build/contracts/ExampleContract.json')<br/>const initCodeHash = Web3.utils.keccak256(artifact.bytecode)<br/>console.log(initCodeHash)<br/>EOL</span><span id="d025" class="mj ky ht kw b fv mo ml l mm mn">### Let's get the init code itself while we're at it.  ƪ(ړײ)‎ƪ ###<br/>$ cat &gt;./getInitCode.js &lt;&lt;EOL<br/>const artifact = require('./build/contracts/ExampleContract.json')<br/>console.log(artifact.bytecode)<br/>EOL</span><span id="2e7a" class="mj ky ht kw b fv mo ml l mm mn">### Assign all the various arguments.  ᕕ( ᐛ )ᕗ ###<br/>$ export FACTORY="0xa779284f095ef2eBb8ee26cd8384e49C57b26996"<br/>$ export CALLER="&lt;YOUR_ROPSTEN_ADDRESS_OF_CHOICE_GOES_HERE&gt;"<br/>$ export INIT_CODE=`node getInitCode.js`<br/>$ export INIT_CODE_HASH=`node getInitCodeHash.js`</span><span id="3794" class="mj ky ht kw b fv mo ml l mm mn">### Install create2crunch and get crunching!  ༼つಠ益ಠ༽つ ─=≡ΣO)) ###<br/>$ git clone <a class="ae kd" href="https://github.com/0age/create2crunch.git" rel="noopener ugc nofollow" target="_blank">https://github.com/0age/create2crunch.git</a><br/>$ cd create2crunch<br/>$ cargo run --release $FACTORY $CALLER $INIT_CODE_HASH  # then ^c</span><span id="1055" class="mj ky ht kw b fv mo ml l mm mn">### Once you find one, go grab it. Hurray!  (๑•̀ㅂ•́)ง✧ ###<br/>$ export SALT=`head -1 efficient_addresses.txt | cut -c1-66`</span><span id="a839" class="mj ky ht kw b fv mo ml l mm mn">### You'll need these for the deployment step.  (っˆڡˆς) ###<br/>$ echo salt: $SALT<br/>$ echo init code: $INIT_CODE<br/>$ echo init code hash: $INIT_CODE_HASH</span></pre><p id="6613" class="pw-post-body-paragraph jf jg ht jh b ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc hm dt translated"><em class="ke">作为题外话，如果你感觉特别有野心，作为</em> <code class="eh kt ku kv kw b">create2crunch</code> <em class="ke">的一部分，还有一个实验性的GPU选项。试试看！</em></p><p id="3cc7" class="pw-post-body-paragraph jf jg ht jh b ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc hm dt translated">手里拿着盐，是时候让奇迹发生了。有很多方法可以做到这一点，但我们将保持简单:<a class="ae kd" href="https://www.myetherwallet.com/#contracts" rel="noopener ugc nofollow" target="_blank">前往MyEtherWallet (Ropsten版本)</a>的合同部分，并进入<code class="eh kt ku kv kw b">Create2Factory</code>合同地址:</p><pre class="mb mc md me fq mf kw mg mh aw mi dt"><span id="e834" class="mj ky ht kw b fv mk ml l mm mn">0xa779284f095ef2eBb8ee26cd8384e49C57b26996</span></pre><p id="430a" class="pw-post-body-paragraph jf jg ht jh b ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc hm dt translated">以及合同ABI:</p><pre class="mb mc md me fq mf kw mg mh aw mi dt"><span id="7309" class="mj ky ht kw b fv mk ml l mm mn">[{"constant":false,"inputs":[{"name":"salt","type":"bytes32"},{"name":"initializationCode","type":"bytes"}],"name":"callCreate2","outputs":[{"name":"deploymentAddress","type":"address"}],"payable":true,"stateMutability":"payable","type":"function"},{"constant":true,"inputs":[{"name":"salt","type":"bytes32"},{"name":"initCodeHash","type":"bytes32"}],"name":"findCreate2Address","outputs":[{"name":"deploymentAddress","type":"address"}],"payable":false,"stateMutability":"view","type":"function"}]</span></pre><p id="2770" class="pw-post-body-paragraph jf jg ht jh b ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc hm dt translated">从这里开始，您可能想要通过调用<code class="eh kt ku kv kw b">findCreate2Address</code>视图函数，传入salt和init代码散列来验证您是否得到了正确的地址。<strong class="jh hu">确保salt的前20个字节与您的地址</strong>匹配。一旦您满意了，使用<code class="eh kt ku kv kw b">callCreate2</code>在有效地址部署契约，传入salt和契约初始化代码，并确保您将gas限制设置得足够高<em class="ke">(这是Ropsten —全力以赴，挥金如土)</em>。就是这样！打电话给新合同上的<code class="eh kt ku kv kw b">exampleFunction</code>并拿回那个甜蜜的、甜蜜的真布尔的奖励点。</p><h1 id="0939" class="kx ky ht bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu dt translated">团队球员团结起来！</h1><p id="b509" class="pw-post-body-paragraph jf jg ht jh b ji lv jk jl jm lw jo jp jq lx js jt ju ly jw jx jy lz ka kb kc hm dt translated"><code class="eh kt ku kv kw b">Create2Factory</code>方法很棒，只要你有一个特定的、独特的合同要部署，并且愿意做所有必要的跑腿工作，自己为它找到一个有效的地址。但是，正如我祖父喜欢说的，“人多力量大。”<em class="ke">(如果他能超越“我在新闻上不断听到的‘比特币’是怎么回事”的范畴，我肯定他会喜欢这个类比。)</em>如果一群有效地址搜索者都选定了一个<strong class="jh hu">共享工厂契约</strong>、<strong class="jh hu">初始化代码块</strong>、<strong class="jh hu"> </strong>和<strong class="jh hu">每个有效地址的相对值</strong>，他们就可以利用我们在上一篇文章中讨论的一大堆好东西，其中最主要的是<strong class="jh hu">在他们努力达到有效地址天堂的过程中利用所有找到的</strong>有效契约地址的能力。</p><p id="f72d" class="pw-post-body-paragraph jf jg ht jh b ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc hm dt translated"><code class="eh kt ku kv kw b">Pr000xy</code>通过使用<strong class="jh hu">可升级的透明代理</strong> <em class="ke">(在</em><a class="ae kd" href="https://zeppelinos.org/" rel="noopener ugc nofollow" target="_blank"><em class="ke">ZeppelinOS</em></a><em class="ke">中使用的那些——你应该用</em> <a class="ae kd" href="https://docs.zeppelinos.org/docs/deploying.html" rel="noopener ugc nofollow" target="_blank"> <em class="ke">和</em> </a> <code class="eh kt ku kv kw b"><a class="ae kd" href="https://docs.zeppelinos.org/docs/deploying.html" rel="noopener ugc nofollow" target="_blank">zos</a></code> <em class="ke">一起玩玩，如果你还没有的话，那里的工具非常整洁。每个人都部署同一个版本，然后，一旦它已经被部署，他们就可以通过将它指向具有所有期望逻辑的实现契约来设置它。它还在<code class="eh kt ku kv kw b">Pr000xy</code>令牌中为每个契约地址赋予一个值，这赋予了一些受欢迎的<strong class="jh hu">可替换性</strong>。另外，您现在有一份可以升级的合同！当然，如果你有“代码就是法律”的话，你可以随时放弃这种能力笔记本外壳上的标签。)</em></p><p id="5b2a" class="pw-post-body-paragraph jf jg ht jh b ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc hm dt translated">请注意，在使用可升级的透明代理时，有一些额外的问题需要考虑。举几个例子:你只能从管理帐户调用管理方法<em class="ke">(改变管理或实现)</em>，你不能从管理帐户调用逻辑契约，你必须用初始化函数替换构造函数并记住调用它们，你必须小心不要在升级时无意中重用存储槽，以及如果逻辑契约遇到<code class="eh kt ku kv kw b">selfdestruct</code>时你的代理的吐司。</p><p id="9be4" class="pw-post-body-paragraph jf jg ht jh b ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc hm dt translated"><em class="ke">为了详细说明最后一点，在处理通过</em> <code class="eh kt ku kv kw b">CREATE2</code> <em class="ke">部署的合同时，有一种微妙的情况需要注意(更多上下文参见</em> <a class="ae kd" href="https://gitter.im/ethereum/AllCoreDevs?at=5c5ca1c9f04ef00644f86b5f" rel="noopener ugc nofollow" target="_blank"> <em class="ke">本讨论</em></a><em class="ke">)</em><strong class="jh hu"><em class="ke">如果合同是</em> </strong> <code class="eh kt ku kv kw b"><strong class="jh hu">selfdestruct</strong></code> <strong class="jh hu"> <em class="ke"> ed，那么它可以被重新部署！</em> </strong> <em class="ke">这意味着，如果有人最终破坏了您最初通过</em> <code class="eh kt ku kv kw b">Pr000xy</code> <em class="ke">创建的合同，您可以再次部署它并获得两次相同的奖励。此外，在与任何具有</em> <code class="eh kt ku kv kw b">selfdestruct</code> <em class="ke">操作码的</em> <code class="eh kt ku kv kw b">CREATE2</code> <em class="ke">派生契约或可能导致它们</em> <code class="eh kt ku kv kw b">selfdestruct</code> <em class="ke">的</em> <code class="eh kt ku kv kw b">delegatecall</code> <em class="ke">派生契约进行交互时，要非常小心。显然，可升级代理属于后一类，</em> <strong class="jh hu"> <em class="ke"> </em> </strong> <em class="ke">因此</em> <strong class="jh hu"> <em class="ke">考虑对合同的升级管理员</em> </strong> <em class="ke">设置适当的治理和其他控制。</em></p><p id="b8e3" class="pw-post-body-paragraph jf jg ht jh b ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc hm dt translated">记住这一点，让我们继续一个例子，从<code class="eh kt ku kv kw b"><a class="ae kd" href="https://github.com/0age/Pr000xy" rel="noopener ugc nofollow" target="_blank">Pr000xy</a></code> <a class="ae kd" href="https://github.com/0age/Pr000xy" rel="noopener ugc nofollow" target="_blank"> Github repo </a>开始工作，并使用提供的地址挖掘器<em class="ke"> ( </em> <code class="eh kt ku kv kw b">create2crunch</code> <em class="ke">)具有更好的性能，但我们在这里处于“测试模式”，您已经知道如何使用它了</em>:</p><pre class="mb mc md me fq mf kw mg mh aw mi dt"><span id="366b" class="mj ky ht kw b fv mk ml l mm mn">### Pr000xy supplies the init code, so just supply the caller. ###<br/>$ export CALLER="&lt;YOUR_ROPSTEN_ADDRESS_OF_CHOICE_GOES_HERE&gt;"</span><span id="fd2f" class="mj ky ht kw b fv mo ml l mm mn">### Pull down the repo, install dependencies, &amp; build contracts. ###<br/>$ git clone <a class="ae kd" href="https://github.com/0age/Pr000xy.git" rel="noopener ugc nofollow" target="_blank">https://github.com/0age/Pr000xy.git</a><br/>$ cd Pr000xy<br/>$ yarn install<br/>$ yarn build</span><span id="04bd" class="mj ky ht kw b fv mo ml l mm mn">### Mine until you're satisfied &amp; get salt - it's all you need. ###<br/>$ yarn mine $CALLER  ## then ^c<br/>$ export SALT=`head -1 valuableProxies.txt | cut -c1-66`<br/>$ echo salt: $SALT</span></pre><p id="ca12" class="pw-post-body-paragraph jf jg ht jh b ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc hm dt translated">然后，我们进行与之前相同的练习:在MyEtherWallet (Ropsten版本)的<a class="ae kd" href="https://www.myetherwallet.com/#contracts" rel="noopener ugc nofollow" target="_blank">合同部分，提供<code class="eh kt ku kv kw b">Pr000xy</code>合同地址:</a></p><pre class="mb mc md me fq mf kw mg mh aw mi dt"><span id="46dd" class="mj ky ht kw b fv mk ml l mm mn">0x000000009a9fc3ac5280bA0D3eA852E57DD2ac1b</span></pre><p id="5d12" class="pw-post-body-paragraph jf jg ht jh b ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc hm dt translated">以及合同ABI <em class="ke">(我知道，这里有很多</em><strong class="jh hu"><em class="ke"/></strong><em class="ke">——我们可以改天再谈)</em>:</p><pre class="mb mc md me fq mf kw mg mh aw mi dt"><span id="6cff" class="mj ky ht kw b fv mk ml l mm mn">[{"constant":true,"inputs":[],"name":"name","outputs":[{"name":"","type":"string"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[{"name":"spender","type":"address"},{"name":"value","type":"uint256"}],"name":"approve","outputs":[{"name":"","type":"bool"}],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[],"name":"initialized","outputs":[{"name":"","type":"bool"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"totalSupply","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[{"name":"from","type":"address"},{"name":"to","type":"address"},{"name":"value","type":"uint256"}],"name":"transferFrom","outputs":[{"name":"","type":"bool"}],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[],"name":"decimals","outputs":[{"name":"","type":"uint8"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[{"name":"spender","type":"address"},{"name":"addedValue","type":"uint256"}],"name":"increaseAllowance","outputs":[{"name":"","type":"bool"}],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[{"name":"owner","type":"address"}],"name":"balanceOf","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"symbol","outputs":[{"name":"","type":"string"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[{"name":"spender","type":"address"},{"name":"subtractedValue","type":"uint256"}],"name":"decreaseAllowance","outputs":[{"name":"","type":"bool"}],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":false,"inputs":[{"name":"to","type":"address"},{"name":"value","type":"uint256"}],"name":"transfer","outputs":[{"name":"","type":"bool"}],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[{"name":"owner","type":"address"},{"name":"spender","type":"address"}],"name":"allowance","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"inputs":[{"name":"rewardsRegistry","type":"address"},{"name":"proxyInitCode","type":"bytes"}],"payable":false,"stateMutability":"nonpayable","type":"constructor"},{"anonymous":false,"inputs":[{"indexed":true,"name":"creator","type":"address"},{"indexed":true,"name":"value","type":"uint256"},{"indexed":false,"name":"proxy","type":"address"}],"name":"ProxyCreated","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"name":"claimant","type":"address"},{"indexed":true,"name":"value","type":"uint256"},{"indexed":false,"name":"proxy","type":"address"}],"name":"ProxyClaimed","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"name":"creator","type":"address"},{"indexed":false,"name":"proxy","type":"address"}],"name":"ProxyCreatedAndClaimed","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"name":"offerID","type":"uint256"},{"indexed":true,"name":"offerer","type":"address"},{"indexed":false,"name":"reward","type":"uint256"}],"name":"OfferCreated","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"name":"offerID","type":"uint256"},{"indexed":true,"name":"offerer","type":"address"},{"indexed":true,"name":"submitter","type":"address"},{"indexed":false,"name":"reward","type":"uint256"}],"name":"OfferFulfilled","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"name":"offerID","type":"uint256"},{"indexed":true,"name":"offerer","type":"address"},{"indexed":false,"name":"expiration","type":"uint256"}],"name":"OfferSetToExpire","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"name":"from","type":"address"},{"indexed":true,"name":"to","type":"address"},{"indexed":false,"name":"value","type":"uint256"}],"name":"Transfer","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"name":"owner","type":"address"},{"indexed":true,"name":"spender","type":"address"},{"indexed":false,"name":"value","type":"uint256"}],"name":"Approval","type":"event"},{"constant":false,"inputs":[],"name":"initialize","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":false,"inputs":[{"name":"salt","type":"bytes32"}],"name":"createProxy","outputs":[{"name":"proxy","type":"address"}],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":false,"inputs":[{"name":"proxy","type":"address"},{"name":"owner","type":"address"},{"name":"implementation","type":"address"},{"name":"data","type":"bytes"}],"name":"claimProxy","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":false,"inputs":[{"name":"leadingZeroBytes","type":"uint256"},{"name":"totalZeroBytes","type":"uint256"},{"name":"owner","type":"address"},{"name":"implementation","type":"address"},{"name":"data","type":"bytes"}],"name":"claimLatestProxy","outputs":[{"name":"proxy","type":"address"}],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":false,"inputs":[{"name":"searchSpace","type":"bytes20"},{"name":"target","type":"address"},{"name":"recipient","type":"address"}],"name":"makeOffer","outputs":[{"name":"offerID","type":"uint256"}],"payable":true,"stateMutability":"payable","type":"function"},{"constant":false,"inputs":[{"name":"proxy","type":"address"},{"name":"offerID","type":"uint256"}],"name":"matchOffer","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":false,"inputs":[{"name":"salt","type":"bytes32"},{"name":"offerID","type":"uint256"}],"name":"createAndMatch","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":false,"inputs":[{"name":"salt","type":"bytes32"},{"name":"owner","type":"address"},{"name":"implementation","type":"address"},{"name":"data","type":"bytes"}],"name":"createAndClaim","outputs":[{"name":"proxy","type":"address"}],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":false,"inputs":[{"name":"salts","type":"bytes32[]"}],"name":"batchCreate","outputs":[{"name":"proxies","type":"address[]"}],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":false,"inputs":[],"name":"batchCreateEfficient_H6KNX6","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":false,"inputs":[{"name":"salts","type":"bytes32[]"},{"name":"offerIDs","type":"uint256[]"}],"name":"batchCreateAndMatch","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":false,"inputs":[{"name":"offerID","type":"uint256"}],"name":"scheduleOfferExpiration","outputs":[{"name":"expiration","type":"uint256"}],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":false,"inputs":[{"name":"offerID","type":"uint256"}],"name":"cancelOffer","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[{"name":"salt","type":"bytes32"}],"name":"findProxyCreationAddress","outputs":[{"name":"proxy","type":"address"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[{"name":"proxy","type":"address"},{"name":"offerID","type":"uint256"}],"name":"matchesOffer","outputs":[{"name":"hasMatch","type":"bool"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[{"name":"account","type":"address"}],"name":"getZeroBytes","outputs":[{"name":"leadingZeroBytes","type":"uint256"},{"name":"totalZeroBytes","type":"uint256"}],"payable":false,"stateMutability":"pure","type":"function"},{"constant":true,"inputs":[{"name":"leadingZeroBytes","type":"uint256"},{"name":"totalZeroBytes","type":"uint256"}],"name":"getValue","outputs":[{"name":"value","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[{"name":"proxy","type":"address"}],"name":"getReward","outputs":[{"name":"value","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[{"name":"leadingZeroBytes","type":"uint256"},{"name":"totalZeroBytes","type":"uint256"}],"name":"countProxiesAt","outputs":[{"name":"totalPertinentProxies","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[{"name":"leadingZeroBytes","type":"uint256"},{"name":"totalZeroBytes","type":"uint256"},{"name":"index","type":"uint256"}],"name":"getProxyAt","outputs":[{"name":"proxy","type":"address"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"countOffers","outputs":[{"name":"totalOffers","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[{"name":"index","type":"uint256"}],"name":"getOfferID","outputs":[{"name":"offerID","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[{"name":"offerID","type":"uint256"}],"name":"getOffer","outputs":[{"name":"amount","type":"uint256"},{"name":"expiration","type":"uint256"},{"name":"searchSpace","type":"bytes20"},{"name":"target","type":"address"},{"name":"offerer","type":"address"},{"name":"recipient","type":"address"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"getInitialProxyImplementation","outputs":[{"name":"implementation","type":"address"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"getProxyInitializationCode","outputs":[{"name":"initializationCode","type":"bytes"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"getProxyInitializationCodeHash","outputs":[{"name":"initializationCodeHash","type":"bytes32"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[{"name":"proxy","type":"address"}],"name":"isAdmin","outputs":[{"name":"admin","type":"bool"}],"payable":false,"stateMutability":"view","type":"function"}]</span></pre><p id="ea39" class="pw-post-body-paragraph jf jg ht jh b ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc hm dt translated">然后，使用<code class="eh kt ku kv kw b">findProxyCreationAddress</code>检查盐。从这里，你可以用你的盐通过<code class="eh kt ku kv kw b">createProxy</code>铸造一些<code class="eh kt ku kv kw b">Pr000xy</code>代币，或者你可以马上用<code class="eh kt ku kv kw b">createAndClaim</code>为自己设置透明代理。我会为前者分配大约700，000 gas，在后一种情况下，我会为逻辑契约上的<code class="eh kt ku kv kw b">initialize</code>函数添加更多的<em class="ke">来说明<em class="ke"> </em>。(开个玩笑，我知道你写的是简洁、模块化的合同。)</em>从这里开始，数字世界就是你的了！</p><h1 id="9222" class="kx ky ht bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu dt translated">我的就是你的</h1><p id="fcc0" class="pw-post-body-paragraph jf jg ht jh b ji lv jk jl jm lw jo jp jq lx js jt ju ly jw jx jy lz ka kb kc hm dt translated">如果你想跳过整个地址挖掘的折磨，你总是可以拿起一些<code class="eh kt ku kv kw b">Pr000xy</code>令牌并烧掉它们，以获得一个已经创建好的透明代理。</p><p id="9f67" class="pw-post-body-paragraph jf jg ht jh b ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc hm dt translated">首先，让我说清楚:如果<code class="eh kt ku kv kw b">Pr000xy</code>在mainnet上上线，<strong class="jh hu">不要从任何人那里购买</strong> <code class="eh kt ku kv kw b"><strong class="jh hu">Pr000xy</strong></code> <strong class="jh hu">令牌，除非你确实需要一个具有有效地址的可升级的透明代理，并打算尽快得到它！</strong>更好的是，<strong class="jh hu">我建议根本不要购买它们</strong>——它们是高度实验性的、<strong class="jh hu">高度通货紧缩的</strong>象征，没有组织支持它们和<strong class="jh hu">没有权利、股息或任何形式的利润预期</strong>。<em class="ke"> (IANAL，但如果声称对加密货币拥有权威的众多监管机构之一对这个小实验感兴趣，我非常希望避免任何戏剧性事件，所以请原谅我的公司语言。)</em></p><p id="0058" class="pw-post-body-paragraph jf jg ht jh b ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc hm dt translated">话虽如此，以下是如何做到的(目前在Ropsten上):</p><ul class=""><li id="836b" class="kf kg ht jh b ji jj jm jn jq kh ju ki jy kj kc ma kl km kn dt translated">获取一些测试令牌。如果你想要我寄一些给你，请联系我——你可以在网上找到我。)</li><li id="90cd" class="kf kg ht jh b ji ko jm kp jq kq ju kr jy ks kc ma kl km kn dt translated">在MyEtherWallet (Ropsten版本)的<a class="ae kd" href="https://www.myetherwallet.com/#contracts" rel="noopener ugc nofollow" target="_blank">合同部分填写<code class="eh kt ku kv kw b">Pr000xy’s</code>地址<code class="eh kt ku kv kw b">0x000000009a9fc3ac5280bA0D3eA852E57DD2ac1b</code>以及合同ABI <em class="ke">(这是您必须滚动才能到达这里的又大又丑的代码块)</em>。</a></li><li id="f9b4" class="kf kg ht jh b ji ko jm kp jq kq ju kr jy ks kc ma kl km kn dt translated"><strong class="jh hu">通过<code class="eh kt ku kv kw b">getValue</code>计算出你能负担得起的</strong>代理有多“罕见”,以检查前导零字节和总零字节的各种组合的特定值，或者<code class="eh kt ku kv kw b">getReward</code>查看任意地址是如何赋值的。<em class="ke">(记住一个零字节实际上“看起来”像一对零。)</em></li><li id="3692" class="kf kg ht jh b ji ko jm kp jq kq ju kr jy ks kc ma kl km kn dt translated"><strong class="jh hu">通过首先调用<code class="eh kt ku kv kw b">countProxiesAt</code>来检查具有您想要的前导字节数和总零字节数的代理是否可用，从而找到可用的代理</strong>。</li><li id="a97c" class="kf kg ht jh b ji ko jm kp jq kq ju kr jy ks kc ma kl km kn dt translated">如果有一个可用的代理，<strong class="jh hu">通过调用<code class="eh kt ku kv kw b">claimLatestProxy</code>来声明最新的可用代理</strong>，使用相同的参数表示前导字节和总零字节。您可以部署一个逻辑契约，并在您声明它时设置好所有东西，或者您可以将<code class="eh kt ku kv kw b">owner</code>和<code class="eh kt ku kv kw b">implementation</code>参数保留为空地址，将<code class="eh kt ku kv kw b">data</code>参数保留为空，以便将所有权分配给您声明它的地址，并在事后处理所有设置。</li></ul></div><div class="ab cl mp mq hb mr" role="separator"><span class="ms bw bk mt mu mv"/><span class="ms bw bk mt mu mv"/><span class="ms bw bk mt mu"/></div><div class="hm hn ho hp hq"><p id="6bc9" class="pw-post-body-paragraph jf jg ht jh b ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc hm dt translated">现在你知道了——你知道如何部署那些地址已经减少了几磅的合同。如果你想参与进来，就开始摆弄<code class="eh kt ku kv kw b">Create2Factory</code><code class="eh kt ku kv kw b">Pr000xy</code><em class="ke">(并且不要羞于在</em> <a class="ae kd" href="https://t.me/joinchat/AAAAAEgfYEufIMuqEXFNQA" rel="noopener ugc nofollow" target="_blank"> <em class="ke">电报频道</em> </a> <em class="ke"> ) </em>。现在，向前迈进，努力让你的合同在未来更有效率！</p><blockquote class="mw"><p id="c3e3" class="mx my ht bd mz na nb nc nd ne nf kc ek translated"><a class="ae kd" href="https://coincodecap.com/?utm_source=coinmonks" rel="noopener ugc nofollow" target="_blank">直接在您的收件箱中获得最佳软件交易</a></p></blockquote><figure class="nh ni nj nk nl iu fe ff paragraph-image"><a href="https://coincodecap.com/?utm_source=coinmonks"><div class="fe ff ng"><img src="../Images/7c0b3dfdcbfea594cc0ae7d4f9bf6fcb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1168/format:webp/0*OJ-qb5G6i863msBB.png"/></div></a></figure></div></div>    
</body>
</html>