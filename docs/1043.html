<html>
<head>
<title>MuJoCo Tutorial on MIT’s Underactuated Robotics in C++— Part 0</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">麻省理工学院欠驱动机器人的MuJoCo教程—第0部分</h1>
<blockquote>原文：<a href="https://medium.com/coinmonks/mujoco-tutorial-on-mits-underactuated-robotics-in-c-part-0-2cbd259f6adc?source=collection_archive---------1-----------------------#2018-07-15">https://medium.com/coinmonks/mujoco-tutorial-on-mits-underactuated-robotics-in-c-part-0-2cbd259f6adc?source=collection_archive---------1-----------------------#2018-07-15</a></blockquote><div><div class="ef hh hi hj hk hl"/><div class="hm hn ho hp hq"><div class=""/><figure class="fi fk ir is it iu fe ff paragraph-image"><div role="button" tabindex="0" class="iv iw di ix bf iy"><div class="fe ff iq"><img src="../Images/9ccdc52af66af12dcf3dfc095c6feea7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*-6N7M0FDB_xiEvfGRCGOxw.gif"/></div></div></figure><p id="23bc" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">2019年10月更新:我已经在我的网页<a class="ae jz" href="https://atabakd.github.io/blog/2019/MuJoCo-1/" rel="noopener ugc nofollow" target="_blank">这里</a>发布了第二个模块。</p><p id="deed" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">我想开始学习<a class="ae jz" href="http://www.mujoco.org/" rel="noopener ugc nofollow" target="_blank"> MuJoCo </a>已经有一段时间了，在他们宣布<a class="ae jz" href="https://www.roboti.us/agreement/PersonalStudentSLA.pdf" rel="noopener ugc nofollow" target="_blank">对学生免费发放许可证</a>后，我真的没有借口了。另外，我本人是一个Python爱好者，但我认为让机器人专家了解C和C++是公平的，最后，自从<a class="ae jz" href="https://www.edx.org/course/underactuated-robotics-mitx-6-832x-0" rel="noopener ugc nofollow" target="_blank">麻省理工学院edx </a>的欠驱动机器人(U-AR)课程以来，我一直想尝试一下。</p><p id="5086" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">所以我就想，为什么不把这三个都混在一起，跟着<a class="ae jz" href="https://www.youtube.com/channel/UChfUOAhz7ynELF-s_1LPpWg/videos" rel="noopener ugc nofollow" target="_blank"> 2018版Russ Tedrake的惊艳课程</a>学C++的MuJoCo。</p><p id="3bb1" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">问题是我找不到任何有用的关于如何开始使用MuJoCo的教程。它有<a class="ae jz" href="http://www.mujoco.org/book/index.html" rel="noopener ugc nofollow" target="_blank">丰富的文档</a>，良好的<a class="ae jz" href="http://www.mujoco.org/book/programming.html#Sample" rel="noopener ugc nofollow" target="_blank">样本代码</a>，托多洛夫教授在<a class="ae jz" href="http://www.mujoco.org/forum/index.php" rel="noopener ugc nofollow" target="_blank">论坛</a>上也非常有帮助，但是，我仍然在努力寻找一个合适的起点。</p><p id="9f65" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">因此，尽管我不是这三个科目中任何一个科目的专家，但我通常很擅长自己摸索，我决定记录我自己的学习曲线，希望它能帮助其他人开始使用MuJoCo。我的计划是实现我在MuJoCo的U-AR中学到的不同的控制器，但是第一个模块仅仅是关于模拟环境的。这里是<a class="ae jz" href="https://github.com/atabakd/MuJoCo-Tutorials.git" rel="noopener ugc nofollow" target="_blank"> GitHub库</a>，事不宜迟，我们开始吧。</p></div><div class="ab cl ka kb hb kc" role="separator"><span class="kd bw bk ke kf kg"/><span class="kd bw bk ke kf kg"/><span class="kd bw bk ke kf"/></div><div class="hm hn ho hp hq"><h1 id="ac09" class="kh ki ht bd kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le dt translated">模拟倒立摆</h1><p id="284c" class="pw-post-body-paragraph jb jc ht jd b je lf jg jh ji lg jk jl jm lh jo jp jq li js jt ju lj jw jx jy hm dt translated">MuJoCo中的建模是通过一个名为MJCF的XML格式文件完成的。<a class="ae jz" href="http://mujoco.org/book/modeling.html#Introduction" rel="noopener ugc nofollow" target="_blank">根据文档</a>，广泛使用的统一机器人描述格式(URDF)文件也是允许的，但不鼓励使用。这是倒立摆的点质量近似模型。</p><figure class="lk ll lm ln fq iu"><div class="bz el l di"><div class="lo lp l"/></div></figure><p id="0a00" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">大多数选项和标志都是不言自明的。地面和横梁上的位置通过肌腱连接在一起，这让人想起了我使用的原始MJCF，它模拟了类似于球和横梁的东西。完整免责声明<a class="ae jz" href="https://github.com/atabakd/MuJoCo-Tutorials/blob/master/models/invertedPendulum.xml" rel="noopener ugc nofollow" target="_blank">此处</a>。如果你用MuJoCo下载的simulate应用程序加载这个模型，它应该是这样的:</p><figure class="lk ll lm ln fq iu fe ff paragraph-image"><div role="button" tabindex="0" class="iv iw di ix bf iy"><div class="fe ff iq"><img src="../Images/e54dfe124bdb98b9ac3d251c8441acbe.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*oEw-A_pKs_e9gPJPuz5fkA.png"/></div></div></figure><p id="a03b" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">您可能看不到RGB帧轴，但它在这里不太相关。以下是模型的主要组成部分:</p><pre class="lk ll lm ln fq lq lr ls lt aw lu dt"><span id="02d2" class="lv ki ht lr b fv lw lx l ly lz">&lt;body name="beam" pos="0 0 .5"&gt;<br/>  &lt;geom name="rod" type="cylinder" pos="0 0 0.0" size=".01 .1" density="100"/&gt;<br/>  &lt;geom pos="0 0 -.1" type="capsule" size=".01 .2" euler="1.57 0 0"/&gt;<br/>  &lt;joint name="pivot" pos="0 0 -0.1" axis="0 1 0" limited="false" damping=".05"/&gt;<br/>  &lt;site name="rBeam" pos="0 -.2 -.1"/&gt;<br/>  &lt;site name="lBeam" pos="0 .2 -.1"/&gt;<br/>  &lt;body name="ballbody" pos="0 0 0.1"&gt;<br/>    &lt;geom name="ballgeom" type="sphere" size=".05"/&gt;<br/>  &lt;/body&gt;<br/>&lt;/body&gt;</span></pre><p id="bc2a" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">每个关节，例如<code class="eh ma mb mc lr b">"pivot"</code>在一个物体和它的父物体之间增加一个自由度，或者在本例中为<code class="eh ma mb mc lr b">worldbody</code>。这是一个<code class="eh ma mb mc lr b">hinge</code>类型的关节，增加了沿y轴(绿色)的旋转自由度，从这个角度来看，顺时针运动增加了角度。<code class="eh ma mb mc lr b">euler</code>属性定义了几何图形的起始方向。</p><p id="657c" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">一些几何体和几何体有名字，这在MuJoCo中是不鼓励的，因为你可以加载几个MJCFs，如果一些几何体或几何体有确切的名字，MuJoCo会报错冲突。但是，我认为它们对于教程是有用的。</p><p id="5b14" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">默认情况下，MuJoCo中的每个geom都有水的密度，大约是<a class="ae jz" href="https://en.wikipedia.org/wiki/Density#Water" rel="noopener ugc nofollow" target="_blank">1000</a>。因此，我降低了连接球和枢轴到<code class="eh ma mb mc lr b">100</code>的杆的密度，以更好地近似点质量公式。</p><p id="227a" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">最后，我添加了一个<code class="eh ma mb mc lr b">motor</code>致动器，它在所需的关节处产生一个力，该关节的角度将由编码器<code class="eh ma mb mc lr b">sensor</code>读取。</p><h1 id="ad49" class="kh ki ht bd kj kk md km kn ko me kq kr ks mf ku kv kw mg ky kz la mh lc ld le dt translated">PD控制器</h1><p id="57b8" class="pw-post-body-paragraph jb jc ht jd b je lf jg jh ji lg jk jl jm lh jo jp jq li js jt ju lj jw jx jy hm dt translated">当你和一个真正的机器人打交道时，有无数的事情你应该考虑。通常，传感器会定期且很可能异步报告测量结果，每个传感器都有非线性噪声模型。然后是一个控制环路，很可能以固定的频率，使用最新的测量值更新控制器的信号。</p><p id="7a04" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">这些测量是如此不可靠，以至于经常需要某种状态估计(我最喜欢的，<a class="ae jz" href="https://towardsdatascience.com/the-unscented-kalman-filter-anything-ekf-can-do-i-can-do-it-better-ce7c773cf88d" rel="noopener" target="_blank">无迹滤波器</a>)来从中获得一些有意义的东西。在本模块中，我将实现传感器噪声和定期控制环路更新，但在未来的模块中我将忽略它们，因为它们会稀释我们的控制汁。</p><p id="eca1" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">要安装控制器，只需设置模型的控件回调即可:</p><pre class="lk ll lm ln fq lq lr ls lt aw lu dt"><span id="1afe" class="lv ki ht lr b fv lw lx l ly lz">mjcb_control = mycontroller;</span></pre><p id="bbf8" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">每当您执行<code class="eh ma mb mc lr b">mj_step(m,d);</code>时，函数<code class="eh ma mb mc lr b">mycontroller</code>都会被调用，但是，为了模拟一个控制循环，我人为地只周期性地更新控制信号，这是一个简单的PD:</p><pre class="lk ll lm ln fq lq lr ls lt aw lu dt"><span id="4c33" class="lv ki ht lr b fv lw lx l ly lz"><strong class="lr hu">if </strong>(d-&gt;time - last_update &gt; 1.0/ctrl_update_freq)<br/>{<br/>    mjtNum vel = (d-&gt;sensordata[0] - position_history)/(d-&gt;time-previous_time);<br/>    ctrl = 3.5*(-vel-10.0*d-&gt;sensordata[0]);<br/>    last_update = d-&gt;time;<br/>    position_history = d-&gt;sensordata[0];<br/>    previous_time = d-&gt;time;<br/>}<br/>d-&gt;ctrl[0] = ctrl;</span></pre><p id="f8bf" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">请注意，我忽略了所有适当的过滤器，以获得正确的速度！这可能是估计速度的最差方法，因为通过对噪声信号求导，会增加噪声的影响，如果稍微改变MJCF文件中传感器噪声模型的标准偏差，控制器就会失效。然而，对于较小的噪声值，ta-da:</p><figure class="lk ll lm ln fq iu fe ff paragraph-image"><div role="button" tabindex="0" class="iv iw di ix bf iy"><div class="fe ff mi"><img src="../Images/f926901eae894e743ad5a75cc9be1215.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*A73_QqmDm3puXsBv4FldGg.gif"/></div></div></figure><p id="366b" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">这个简单的PD工作得很好，并带有一点控制工程的直觉(比训练一个神经网络少得多😝)你可以调整参数，简单来说速度系数通常通过减慢你的系统来控制振荡。在没有干扰的情况下(例如风，如果你正在控制四旋翼飞行器)，通常不需要积分器。</p><p id="98ef" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">这种简单是福也是祸。太棒了，因为你甚至不需要知道你的模型！几次尝试和错误，它工作得很好。对动态系统建模是困难的。<a class="ae jz" href="https://youtu.be/BkekflWqXrE?t=1h22m20s" rel="noopener ugc nofollow" target="_blank">不仅仅是买尺子的问题</a>！它需要动态系统专业知识和耗时费力的工作。</p><p id="c1de" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">另一方面，这个控制器没有利用动力学的优点。如果我设置更严格的控制限制，它不会理解通过对状态的相反符号施加力来将能量输入系统，并做一个摆动。</p><p id="00dc" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">不幸的是，我们的下一任总监LQR也是如此愚蠢😉但是我们很快就会接触到更智能的控制器。</p><p id="ceec" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">在那之前，敬请期待。</p></div></div>    
</body>
</html>