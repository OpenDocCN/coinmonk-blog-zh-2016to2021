<html>
<head>
<title>Develop Alexa Custom Skill with AWS Lambda to Control IoT Device</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用AWS Lambda开发Alexa自定义技能以控制物联网设备</h1>
<blockquote>原文：<a href="https://medium.com/coinmonks/alexa-custom-skill-with-aws-lambda-to-control-iot-device-68f37beac3fb?source=collection_archive---------0-----------------------#2018-06-30">https://medium.com/coinmonks/alexa-custom-skill-with-aws-lambda-to-control-iot-device-68f37beac3fb?source=collection_archive---------0-----------------------#2018-06-30</a></blockquote><div><div class="ef hh hi hj hk hl"/><div class="hm hn ho hp hq"><div class=""/><figure class="fi fk ir is it iu fe ff paragraph-image"><div class="fe ff iq"><img src="../Images/d50cf5946034d9ec7cd9ea4fb6bc20f2.png" data-original-src="https://miro.medium.com/v2/resize:fit:960/format:webp/1*lMk3neiWVUtRmexC79XZ5w.png"/></div><figcaption class="ix iy fg fe ff iz ja bd b be z ek">Figure 1 : Amazon Echo Dot</figcaption></figure><p id="f767" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">如果你在家里或办公室有任何智能物联网设备，并尝试用Alexa控制它们，你可能会想它到底是如何工作的。在本指南中，您将了解如何使用AWS Lambda构建自定义Alexa技能来控制您的智能设备。你将能够通过Alexa打开/关闭特定的灯。</p><p id="4429" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">虽然这些小工具毫无疑问很受欢迎，但最近关于人工智能语音助手的报告表明，一旦好奇心消失，人们就看不到它们有多大价值。亚马逊开放Alexa添加定制技能的能力是我们见过的语音生态系统的最大进步之一。亚马逊Alexa是由亚马逊创建的虚拟助手，它能够进行语音交互，制作待办事项列表，播放音乐，设置闹钟，播放有声读物，流媒体播客，并提供交通，体育，气候和其他实时信息，如新闻。Amazon为Alexa提供了两种不同的方式来与您的自定义逻辑接口。它要么作为AWS Lambda函数执行，要么要求你拥有自己的web服务器。这两种方法都需要大量的引导和代码来实现最简单的Alexa技能。</p><p id="d54f" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">更重要的是，作为一名开发人员，Alexa开辟了一条非凡的道路，以建立定制能力，并将语音转换为机器命令，我们可以执行许多任务，如控制物联网设备。这篇文章专注于构建Alexa自定义技能的有序实现，将它与AWS Lambda功能相结合，并向物联网设备发送命令。在这里，我建立了一个清晰的Alexa技能工具包教程，你可能会真正发现有价值的自定义技能。</p><p id="5a61" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated"><strong class="jd hu">用例</strong></p><p id="63a9" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">在这个示例应用程序中，我们试图控制连接到NodeMCU控制器的3盏灯(红色、绿色和橙色led)。在这篇文章中，我们不关注如何对NodeMCU模块进行编程，NodeMCU模块连接到一个状态服务器，在那里它可以获得其引脚状态并相应地更新GPIO值。</p><p id="2150" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated"><strong class="jd hu">方案设计</strong></p><figure class="ka kb kc kd fq iu fe ff paragraph-image"><div class="fe ff jz"><img src="../Images/9ef53d478d02c4526957d377414b5492.png" data-original-src="https://miro.medium.com/v2/resize:fit:1260/format:webp/0*9jvHKAeKwh5nUPS8.png"/></div><figcaption class="ix iy fg fe ff iz ja bd b be z ek">Figure 2 : Solution Design</figcaption></figure><p id="954f" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">在这篇文章中，我们将重点关注如何调用Alexa自定义技能以及与AWS Lambda函数的集成。</p><p id="41e1" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated"><strong class="jd hu">打造自定义Alexa技能</strong></p><p id="354a" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">首先你需要登录你的<a class="ae ke" href="https://developer.amazon.com/" rel="noopener ugc nofollow" target="_blank">亚马逊开发者门户</a>。如果您没有帐户，可以免费创建一个。导航到Alexa →您的Alexa控制台→技能</p><p id="4b3f" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">您可以使用“创建技能”按钮来创建新技能。您需要输入技能名称并选择首选语言。选择“自定义”选项卡并创建技能。</p><figure class="ka kb kc kd fq iu fe ff paragraph-image"><div class="fe ff jz"><img src="../Images/b4cb486a49961e7db72dbbc671f4044c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1260/format:webp/0*ex6gRpnPPbHoBB6F.png"/></div><figcaption class="ix iy fg fe ff iz ja bd b be z ek">Figure 3 : Create Skill</figcaption></figure><p id="51d7" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">然后，您将被导航到技能页面。</p><figure class="ka kb kc kd fq iu fe ff paragraph-image"><div class="fe ff kf"><img src="../Images/19184b39584630f1f480bedf385d1be1.png" data-original-src="https://miro.medium.com/v2/resize:fit:618/format:webp/0*eQgZ8cOGumv3qkug.png"/></div><figcaption class="ix iy fg fe ff iz ja bd b be z ek">Figure 4 : Skill options</figcaption></figure><p id="d577" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">一个Alexa自定义技能包含以下主要特征。</p><p id="1a56" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated"><strong class="jd hu">调用:</strong>这是用户应该提供的命令，以便启动自定义技能。</p><p id="efb0" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated"><strong class="jd hu">意图:</strong>意图是你应该在技能范围内提供的触发不同事件的单独命令。</p><p id="b302" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated"><strong class="jd hu"> Slots : </strong> Slots可以被标识为参数，在这里你可以传递不同的值。</p><p id="771b" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">终点:你应该整合新技能的地方。有两个选项，分别是ARN和HTTPS。在本教程中，我们将使用自动气象站are选项。</p><p id="5579" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">默认情况下，您可以看到已经创建了3个意向，如AMAZON。亚马逊CencelIntent。让我们创建一个新的自定义意图。</p><p id="5137" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated"><strong class="jd hu">调用</strong></p><p id="9947" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">导航到调用选项卡，您可以在技能调用名称部分提供启动自定义技能所需的命令。</p><figure class="ka kb kc kd fq iu fe ff paragraph-image"><div class="fe ff jz"><img src="../Images/2182d5262ed3b6ca39bcb28dc150599f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1260/format:webp/0*vpmqxHeiJSqMy6Jq.png"/></div><figcaption class="ix iy fg fe ff iz ja bd b be z ek">Figure 5 : Invocation</figcaption></figure><p id="4d05" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated"><strong class="jd hu">创建新意图</strong></p><p id="84fe" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">您可以使用“添加意图”按钮创建新的意图。</p><figure class="ka kb kc kd fq iu fe ff paragraph-image"><div class="fe ff kg"><img src="../Images/a6a3bf48e9017174a220fe72676f6321.png" data-original-src="https://miro.medium.com/v2/resize:fit:630/format:webp/0*nm7rwMsyiypTovTt.png"/></div><figcaption class="ix iy fg fe ff iz ja bd b be z ek">Figure 6 : Create new Intent</figcaption></figure><p id="ced8" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">您需要为您的意图取一个合适的名称，并创建自定义意图。接下来，我们需要为此目的提供示例话语。话语代表用户为实现这一意图而提供的实际语音命令。例如，我们可以指定“打开红灯”。</p><figure class="ka kb kc kd fq iu fe ff paragraph-image"><div class="fe ff kh"><img src="../Images/66c3a9b0560f0fd634589e56c185a657.png" data-original-src="https://miro.medium.com/v2/resize:fit:1110/format:webp/0*pq0KZB-qPRE4awif.png"/></div><figcaption class="ix iy fg fe ff iz ja bd b be z ek">Figure 7 : Utterances</figcaption></figure><p id="03c4" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">但是如果我们继续这样下去，我们将面临一个小问题。因为我们有3盏灯，所以我们需要维护6种状态。我们需要创建6个不同的意图来控制我们的3盏灯。这是低效且难以维护的。我们可以使用插槽来解决这个问题，并将灯光状态和灯光颜色作为参数传递给我们的意图。</p><figure class="ka kb kc kd fq iu fe ff paragraph-image"><div class="fe ff ki"><img src="../Images/7e56f5e98681b0ae5817b426a4d321a5.png" data-original-src="https://miro.medium.com/v2/resize:fit:934/format:webp/0*CGfS09OqH3PSeuIP.png"/></div><figcaption class="ix iy fg fe ff iz ja bd b be z ek">Figure 8 : Create new slot</figcaption></figure><p id="dd0f" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">在话语部分，您可以在花括号中指定所需的位置。在这个实例中，该工具会要求您使用lightstatus创建一个新的插槽。我们还需要给浅色添加一个槽。</p><p id="da00" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">现在你可以看到技能工具为我们的话语增加了两个位置，如上图所示。接下来，我们需要为新创建的插槽选择插槽类型。您可以从插槽类型下拉列表中选择Amazon内置插槽类型。对于浅色插槽，我可以使用亚马逊。颜色类型。但是lightstatus插槽没有预定义的插槽类型。因此，我们需要为此创建自定义插槽类型。</p><p id="84dc" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">您可以使用“添加”按钮在“插槽类型”部分创建自定义插槽类型。</p><figure class="ka kb kc kd fq iu fe ff paragraph-image"><div class="fe ff kg"><img src="../Images/b1c6bd5c8c48a67b101befad253154ee.png" data-original-src="https://miro.medium.com/v2/resize:fit:630/format:webp/0*p5jBvY62ITovqal9.png"/></div><figcaption class="ix iy fg fe ff iz ja bd b be z ek">Figure 9 : Create custom slot type</figcaption></figure><figure class="ka kb kc kd fq iu fe ff paragraph-image"><div class="fe ff jz"><img src="../Images/2f2e551e3e9142c8b08b3d4b2283d856.png" data-original-src="https://miro.medium.com/v2/resize:fit:1260/format:webp/0*65QLk7-26J639Xgk.png"/></div><figcaption class="ix iy fg fe ff iz ja bd b be z ek">Figure 10 : Custom slots</figcaption></figure><p id="ee9c" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">然后，我们可以返回目的，为lightstatus插槽选择新创建的插槽类型。</p><p id="cbb7" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">现在我们完成了我们的意图，使用这一个意图，我们可以在我们的光中控制所有的状态。</p><p id="d481" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">下一步，我们需要建立lambda函数，需要与这项技能相结合。</p><p id="7f7d" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated"><strong class="jd hu">开发Lambda函数</strong></p><p id="f07f" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">首先，您需要登录到<a class="ae ke" href="https://aws.amazon.com/" rel="noopener ugc nofollow" target="_blank"> AWS控制台。如果您没有帐户，可以免费创建。</a></p><p id="ce6d" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">在AWS服务搜索栏中搜索“Lambda”。您可以使用“创建函数”按钮创建函数。</p><figure class="ka kb kc kd fq iu fe ff paragraph-image"><div class="fe ff jz"><img src="../Images/67d692bd1a9ce994d9a65c13401433e1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1260/format:webp/0*ZcSRJUV96RjVKii-.png"/></div><figcaption class="ix iy fg fe ff iz ja bd b be z ek">Figure 11 : Crete AWS Lambda function</figcaption></figure><p id="c247" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">我正在使用NodeJs的作者从零开始选项。如果没有现有角色，请选择创建自定义角色或从模板创建新角色。AWS将为您创建一个默认角色。</p><p id="cd25" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">这将创建index.js默认文件，并为您提供一个默认的js代码。</p><p id="9487" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">首先我要创建如下的助手函数。</p><pre class="ka kb kc kd fq kj kk kl km aw kn dt"><span id="5b71" class="ko kp ht kk b fv kq kr l ks kt">// These are the helper functions <br/><strong class="kk hu">function</strong> buildSpeechletResponse(title, output, repromptText, shouldEndSession) {<br/>    <strong class="kk hu">return</strong> {<br/>        outputSpeech: {<br/>            type: 'PlainText',<br/>            text: output,<br/>        },<br/>        card: {<br/>            type: 'Simple',<br/>            title: `SessionSpeechlet - ${title}`,<br/>            content: `SessionSpeechlet - ${output}`,<br/>        },<br/>        reprompt: {<br/>            outputSpeech: {<br/>                type: 'PlainText',<br/>                text: repromptText,<br/>            },<br/>        },<br/>        shouldEndSession,<br/>    };<br/>}<br/><strong class="kk hu">function</strong> buildResponse(sessionAttributes, speechletResponse) {<br/>    <strong class="kk hu">return</strong> {<br/>        version: '1.0',<br/>        sessionAttributes,<br/>        response: speechletResponse,<br/>    };<br/>}</span></pre><p id="8931" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">这些助手功能建立了语音响应，需要在执行一些命令时传递回Alexa自定义技能。</p><p id="8b60" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">接下来是支持会话开始和技能启动的功能。</p><pre class="ka kb kc kd fq kj kk kl km aw kn dt"><span id="6d59" class="ko kp ht kk b fv kq kr l ks kt"><strong class="kk hu">function</strong> onSessionStarted(sessionStartedRequest, session) {<br/>    console.log(`onSessionStarted requestId=${sessionStartedRequest.requestId}, sessionId=${session.sessionId}`);<br/>}<br/><br/><strong class="kk hu">function</strong> onLaunch(launchRequest, session, callback) {<br/>    console.log(`onLaunch requestId=${launchRequest.requestId}, sessionId=${session.sessionId}`);<br/>// Dispatch to your skill's launch.<br/>    getWelcomeResponse(callback);<br/>}<br/><br/><strong class="kk hu">function</strong> getWelcomeResponse(callback) {<br/>    <strong class="kk hu">const</strong> sessionAttributes = {};<br/>    <strong class="kk hu">const</strong> cardTitle = 'Welcome';<br/>    <strong class="kk hu">const</strong> speechOutput = 'Welcome to the light demo ' ;<br/>   <br/>    <strong class="kk hu">const</strong> repromptText = 'You can say: what switch to control ' ;<br/>    <strong class="kk hu">const</strong> shouldEndSession = <strong class="kk hu">false</strong>;<br/>callback(sessionAttributes,<br/>        buildSpeechletResponse(cardTitle, speechOutput, repromptText, shouldEndSession));<br/>}</span></pre><p id="578f" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">在这里，您可以指定欢迎信息和重新提示信息，如果用户没有给任何语音输入。回调函数使用我们之前构建的助手函数。一旦用户使用正确的调用短语调用技能，lambda就会为定制技能的当前实例创建一个会话。</p><p id="7afe" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">接下来，我们需要在SessionEnded事件上指定会话结束请求，如下所示。</p><pre class="ka kb kc kd fq kj kk kl km aw kn dt"><span id="af54" class="ko kp ht kk b fv kq kr l ks kt"><strong class="kk hu">function</strong> handleSessionEndRequest(callback) {<br/>    <strong class="kk hu">const</strong> cardTitle = 'Session Ended';<br/>    <strong class="kk hu">const</strong> speechOutput = 'Thank you for using light control , have a great day!';<br/>    <strong class="kk hu">const</strong> shouldEndSession = <strong class="kk hu">true</strong>;<br/>callback({}, buildSpeechletResponse(cardTitle, speechOutput, <strong class="kk hu">null</strong>, shouldEndSession));<br/>}<br/><br/><br/><strong class="kk hu">function</strong> onSessionEnded(sessionEndedRequest, session) {<br/>    console.log(`onSessionEnded requestId=${sessionEndedRequest.requestId}, sessionId=${session.sessionId}`);<br/>    // Add cleanup logic here<br/>}</span></pre><p id="62f3" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">最重要的功能是意图处理器。这就是我们将Alexa自定义技能的意图映射到Lambda函数中的地方。</p><pre class="ka kb kc kd fq kj kk kl km aw kn dt"><span id="b968" class="ko kp ht kk b fv kq kr l ks kt"><strong class="kk hu">function</strong> onIntent(intentRequest, session, callback) {<br/>    console.log(`onIntent requestId=${intentRequest.requestId}, sessionId=${session.sessionId}`);<br/><strong class="kk hu">const</strong> intent = intentRequest.intent;<br/>    <strong class="kk hu">const</strong> intentName = intentRequest.intent.name;<br/>// Dispatch to your skill's intent handlers<br/>    <strong class="kk hu">if</strong> (intentName === 'AMAZON.HelpIntent') {<br/>        getWelcomeResponse(callback);<br/>    } <strong class="kk hu">else</strong> <strong class="kk hu">if</strong> (intentName === 'AMAZON.StopIntent') {<br/>        handleSessionEndRequest(callback);<br/>    } <strong class="kk hu">else</strong> <strong class="kk hu">if</strong> (intentName === 'lightcontrol') {<br/>        <strong class="kk hu">var</strong> color = intent.slots.color.value;<br/>        <strong class="kk hu">var</strong> lightstatus = intent.slots.lightstatus.value;<br/>        lights(callback,color,lightstatus);<br/>    }<br/>}</span></pre><p id="a377" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">你可以看到我们正在处理我们在自定义技能中创建的光控意图。我们使用intent.slots属性检索插槽值，并将它们分配给局部变量。</p><p id="7d92" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">接下来，我们需要构建lights函数，我们将在这里与我们的物联网服务器进行交互，如下所示。</p><pre class="ka kb kc kd fq kj kk kl km aw kn dt"><span id="2f7f" class="ko kp ht kk b fv kq kr l ks kt"><strong class="kk hu">function</strong> lights(callback,color,lightstatus) {<br/>    <br/>   <strong class="kk hu">var</strong> _switch = "";<br/>   <strong class="kk hu">var</strong> _status = "";<br/>   <br/>   <strong class="kk hu">if</strong>(color == "red")<br/>        _switch = "V1";<br/>   <strong class="kk hu">else</strong> <strong class="kk hu">if</strong>(color == "green")<br/>        _switch = "V2";<br/>   <strong class="kk hu">else</strong> <strong class="kk hu">if</strong>(color == "orange")<br/>        _switch = "V0";<br/>   <strong class="kk hu">else</strong><br/>        _switch = "error";<br/>        <br/>    <strong class="kk hu">if</strong>(lightstatus == "on")<br/>        _status = "1";<br/>    <strong class="kk hu">else</strong> <strong class="kk hu">if</strong>(lightstatus == "off")<br/>        _status = "0";<br/>    <br/>   <strong class="kk hu">var</strong> endpoint = "http://&lt;myip&gt;:8080/&lt;myport&gt;/update/"+_switch+"?value="+_status;<br/>            <strong class="kk hu">var</strong> status ="offline";<br/>            <strong class="kk hu">var</strong> body = "";<br/>            http.get(endpoint, (response) =&gt; {<br/>              console.log("Got response: " + response.statusCode)<br/>              response.on('data', (chunk) =&gt; { body += chunk })<br/>              response.on('end', () =&gt; {<br/>              })<br/>            });<br/>   <br/>    <strong class="kk hu">const</strong> sessionAttributes = {};<br/>    <br/>    //Get card title from data<br/>    <strong class="kk hu">const</strong> cardTitle = 'device status';<br/>    <br/>    //Get output from data<br/>    <strong class="kk hu">const</strong> speechOutput = 'The  ' + color + '  light is turned '+ lightstatus;<br/>    <strong class="kk hu">const</strong> repromptText = '' ;<br/>    <strong class="kk hu">const</strong> shouldEndSession = <strong class="kk hu">false</strong>;<br/>callback(sessionAttributes,<br/>        buildSpeechletResponse(cardTitle, speechOutput, repromptText, shouldEndSession));<br/>}</span></pre><p id="293c" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">为了控制我的物联网设备，我实现了一个基于java的状态服务器，它可以与REST API集成。首先，该函数基于我们从intent获得的slot值构建所需的端点值。然后，它调用物联网状态服务器并提供所需的值。监听状态服务器的物联网设备将相应地更新其GPIO值。</p><p id="9436" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">你可以在这个<a class="ae ke" href="https://github.com/priyalwalpita/alexa_lambda" rel="noopener ugc nofollow" target="_blank"> git repo </a>中找到完整的源代码。</p><p id="6126" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated"><strong class="jd hu">测试拉姆达函数</strong></p><p id="8db4" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">你可以通过使用内置测试框架来测试你的Lambda函数。转到配置测试事件并配置新的测试事件。</p><figure class="ka kb kc kd fq iu fe ff paragraph-image"><div class="fe ff jz"><img src="../Images/6190353f6c79a8b4910948db0b896001.png" data-original-src="https://miro.medium.com/v2/resize:fit:1260/format:webp/0*CZUXdcQBWGh3ndHo.png"/></div><figcaption class="ix iy fg fe ff iz ja bd b be z ek">Figure 12 : Function test script</figcaption></figure><p id="a1b7" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">lightcontrol intent的测试脚本应该如下所示。我们需要在测试脚本中为我们的插槽指定样本值。</p><pre class="ka kb kc kd fq kj kk kl km aw kn dt"><span id="f354" class="ko kp ht kk b fv kq kr l ks kt">{<br/>  "session": {<br/>    "new": <strong class="kk hu">false</strong>,<br/>    "sessionId": "amzn1.echo-api.session.[unique-value-here]",<br/>    "attributes": {},<br/>    "user": {<br/>      "userId": "amzn1.ask.account.[unique-value-here]"<br/>    },<br/>    "application": {<br/>      "applicationId": "amzn1.ask.skill.[unique-value-here]"<br/>    }<br/>  },<br/>  "version": "1.0",<br/>  "request": {<br/>    "locale": "en-US",<br/>    "timestamp": "2016-10-27T21:06:28Z",<br/>    "type": "IntentRequest",<br/>    "requestId": "amzn1.echo-api.request.[unique-value-here]",<br/>    "intent": {<br/>      "slots": {<br/>        "color": {<br/>          "name": "color",<br/>          "value": "red"<br/>        },<br/>        "lightstatus": {<br/>          "name": "lightstatus",<br/>          "value": "on"<br/>        }<br/>      },<br/>      "name": "lightcontrol"<br/>    }<br/>  },<br/>  "context": {<br/>    "AudioPlayer": {<br/>      "playerActivity": "IDLE"<br/>    },<br/>    "System": {<br/>      "device": {<br/>        "supportedInterfaces": {<br/>          "AudioPlayer": {}<br/>        }<br/>      },<br/>      "application": {<br/>        "applicationId": "amzn1.ask.skill.[unique-value-here]"<br/>      },<br/>      "user": {<br/>        "userId": "amzn1.ask.account.[unique-value-here]"<br/>      }<br/>    }<br/>  }<br/>}</span></pre><p id="2a31" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">您可以在执行结果窗口中获得如下测试结果和状态。</p><figure class="ka kb kc kd fq iu fe ff paragraph-image"><div class="fe ff jz"><img src="../Images/158440a9343afb17d7ad44b1d416bc47.png" data-original-src="https://miro.medium.com/v2/resize:fit:1260/format:webp/0*h6m9E8dg0ZIvA-w2.png"/></div><figcaption class="ix iy fg fe ff iz ja bd b be z ek">Figure 13 : Test results</figcaption></figure><p id="9d61" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">太好了！现在我们的测试已经通过，作为下一步，我们需要链接Lambda函数和Alexa自定义技能，我们已经开发出来。</p><p id="5a08" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated"><strong class="jd hu">链接Lambda函数和自定义技能</strong></p><p id="8fce" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">要链接Lambda函数和Alexa自定义技能，请将Lambda函数的ARN值复制到剪贴板。</p><figure class="ka kb kc kd fq iu fe ff paragraph-image"><div class="fe ff ku"><img src="../Images/b187157358d517965ab8b930e42f5022.png" data-original-src="https://miro.medium.com/v2/resize:fit:1034/format:webp/0*FrQP-qHgQz0SCBLk.png"/></div><figcaption class="ix iy fg fe ff iz ja bd b be z ek">Figure 14 : Copy the ARN value</figcaption></figure><p id="596f" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">转到您的自定义技能，选择“端点”选项卡，然后选择“AWS Lambda ARN”。在“默认区域”部分输入ARN值，如下所示。</p><figure class="ka kb kc kd fq iu fe ff paragraph-image"><div class="fe ff jz"><img src="../Images/76347d4db30a361921d6548fc7d2b6a6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1260/format:webp/0*oWrA_RQN7bjVVOCR.png"/></div><figcaption class="ix iy fg fe ff iz ja bd b be z ek">Figure 15 : Config the ARN in the custom skill</figcaption></figure><p id="41db" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">接下来，您需要复制技能Id并输入Lambda函数，如下所述。</p><p id="1aa2" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">在灯光控制功能中，添加触发器“Alexa技能包”。</p><figure class="ka kb kc kd fq iu fe ff paragraph-image"><div class="fe ff jz"><img src="../Images/e756672de1e3ad6572456748027a4ad1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1260/format:webp/0*5pVHtiKB-bup6kMN.png"/></div><figcaption class="ix iy fg fe ff iz ja bd b be z ek">Figure 16 : Add the custom skill to Lambda function</figcaption></figure><p id="3e36" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">转到Alexa技能工具包的配置部分，添加您的自定义技能的技能ID。</p><figure class="ka kb kc kd fq iu fe ff paragraph-image"><div class="fe ff jz"><img src="../Images/19784f1cb2cd088e0479ba12b5d50097.png" data-original-src="https://miro.medium.com/v2/resize:fit:1260/format:webp/0*BbwmwMnKtZPNpY-L.png"/></div><figcaption class="ix iy fg fe ff iz ja bd b be z ek">Figure 17 : Config the Skill Id</figcaption></figure><p id="7188" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">保存Lambda函数和自定义技能。</p><p id="9a9b" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">接下来，使用构建模型按钮构建自定义技能。</p><p id="5b1c" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">恭喜你！现在我们有了一个正确配置的自定义技能。接下来我们需要测试自定义技能本身！</p><p id="cf83" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated"><strong class="jd hu">测试Alexa自定义技能</strong></p><p id="6488" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">为了测试这项自定义技能，请导航到控制台顶部的测试选项卡。启用此技能的测试。</p><figure class="ka kb kc kd fq iu fe ff paragraph-image"><div class="fe ff jz"><img src="../Images/7ac058ea56a1ea8ef9773cc510320a06.png" data-original-src="https://miro.medium.com/v2/resize:fit:1260/format:webp/0*YIknxczWw_hpf8jp.png"/></div><figcaption class="ix iy fg fe ff iz ja bd b be z ek">Figure 18 : Custom skill’s testing console</figcaption></figure><p id="165b" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">有两种方法可以测试我们的技能。</p><ol class=""><li id="6c92" class="kv kw ht jd b je jf ji jj jm kx jq ky ju kz jy la lb lc ld dt translated">通过声音</li><li id="ea1e" class="kv kw ht jd b je le ji lf jm lg jq lh ju li jy la lb lc ld dt translated">2.通过文本</li></ol><p id="9fdf" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">只需输入您为自己的技能指定的调用名称。除了语音输出，控制台还会为特定的测试输出JSON输入和输出。</p><figure class="ka kb kc kd fq iu fe ff paragraph-image"><div class="fe ff jz"><img src="../Images/83613e76baa197b4f77a276ffb9ed9f2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1260/format:webp/0*61p1cKcvTuaJBwhN.png"/></div><figcaption class="ix iy fg fe ff iz ja bd b be z ek">Figure 19 : Testing the invocation</figcaption></figure><p id="79fa" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">接下来，你也可以测试你的意图。</p><figure class="ka kb kc kd fq iu fe ff paragraph-image"><div class="fe ff jz"><img src="../Images/4ccc10b99c694d608fa8387d54e6c18c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1260/format:webp/0*FUhMlU20qIcSirMX.png"/></div><figcaption class="ix iy fg fe ff iz ja bd b be z ek">Figure 20 : Test the invocation</figcaption></figure><p id="fb55" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">恭喜你们。</p><p id="0cdc" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">你做到了！</p><p id="1251" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">如果你拥有亚马逊Echo Dot或亚马逊Alexa，这是一个用自己的声音测试你技能的好时机！:)</p><p id="8b98" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated"><strong class="jd hu">总结</strong></p><p id="9825" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">正如我们所看到的，为Amazon Echo平台构建一个定制技能相当简单。Alexa服务抽象掉了开发人员在使用语音界面时面临的无数传统复杂性，因为它管理着框架的高级语音识别和文本到语音方面。</p><p id="ad2f" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">开发人员可以利用AWS Lambda、其他AWS托管选择(如Elastic Beanstalk或EC2)来运行和自动扩展他们技能的后端原理，或者在Alexa平台可以通过SSL加密HTTP请求到达的任何地方运行和处理代码。</p><p id="8384" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">如果您有兴趣进一步探索这个示例技能的代码，这是一个很好的机会。亚马逊还为Alexa开发者提供了大量的教程和参考资料，以及创建交互模型、Lambda函数和示例话语的演练。</p><blockquote class="lj"><p id="7044" class="lk ll ht bd lm ln lo lp lq lr ls jy ek translated">加入Coinmonks <a class="ae ke" href="https://t.me/coincodecap" rel="noopener ugc nofollow" target="_blank">电报频道</a>和<a class="ae ke" href="https://www.youtube.com/c/coinmonks/videos" rel="noopener ugc nofollow" target="_blank"> Youtube频道</a>获取每日<a class="ae ke" href="http://coincodecap.com/" rel="noopener ugc nofollow" target="_blank">加密新闻</a></p></blockquote><h2 id="15d6" class="ko kp ht bd lt lu lv lw lx ly lz ma mb jm mc md me jq mf mg mh ju mi mj mk ml dt translated">另外，阅读</h2><ul class=""><li id="20fb" class="kv kw ht jd b je mm ji mn jm mo jq mp ju mq jy mr lb lc ld dt translated"><a class="ae ke" rel="noopener" href="/coinmonks/top-10-crypto-copy-trading-platforms-for-beginners-d0c37c7d698c">复制交易</a> | <a class="ae ke" rel="noopener" href="/coinmonks/crypto-tax-software-ed4b4810e338">加密税务软件</a></li><li id="723e" class="kv kw ht jd b je le ji lf jm lg jq lh ju li jy mr lb lc ld dt translated"><a class="ae ke" href="https://coincodecap.com/grid-trading" rel="noopener ugc nofollow" target="_blank">网格交易</a> | <a class="ae ke" rel="noopener" href="/coinmonks/the-best-cryptocurrency-hardware-wallets-of-2020-e28b1c124069">加密硬件钱包</a></li><li id="874f" class="kv kw ht jd b je le ji lf jm lg jq lh ju li jy mr lb lc ld dt translated"><a class="ae ke" href="http://Top 4 Telegram Channels for Crypto Traders" rel="noopener ugc nofollow" target="_blank">密码电报信号</a> | <a class="ae ke" rel="noopener" href="/coinmonks/crypto-trading-bot-c2ffce8acb2a">密码交易机器人</a></li><li id="f33b" class="kv kw ht jd b je le ji lf jm lg jq lh ju li jy mr lb lc ld dt translated"><a class="ae ke" rel="noopener" href="/coinmonks/crypto-exchange-dd2f9d6f3769">最佳加密交易所</a> | <a class="ae ke" rel="noopener" href="/coinmonks/bitcoin-exchange-in-india-7f1fe79715c9">印度最佳加密交易所</a></li><li id="47a8" class="kv kw ht jd b je le ji lf jm lg jq lh ju li jy mr lb lc ld dt translated"><a class="ae ke" rel="noopener" href="/coinmonks/best-crypto-apis-for-developers-5efe3a597a9f">面向开发人员的最佳加密API</a></li><li id="b359" class="kv kw ht jd b je le ji lf jm lg jq lh ju li jy mr lb lc ld dt translated">最佳<a class="ae ke" rel="noopener" href="/coinmonks/top-5-crypto-lending-platforms-in-2020-that-you-need-to-know-a1b675cec3fa">密码借贷平台</a></li><li id="3c98" class="kv kw ht jd b je le ji lf jm lg jq lh ju li jy mr lb lc ld dt translated"><a class="ae ke" rel="noopener" href="/coinmonks/free-crypto-signals-48b25e61a8da">免费加密信号</a> | <a class="ae ke" rel="noopener" href="/coinmonks/crypto-trading-bot-c2ffce8acb2a">加密交易机器人</a></li><li id="9d6f" class="kv kw ht jd b je le ji lf jm lg jq lh ju li jy mr lb lc ld dt translated">杠杆代币的终极指南</li></ul></div></div>    
</body>
</html>