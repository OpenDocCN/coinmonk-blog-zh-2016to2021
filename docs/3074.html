<html>
<head>
<title>On Bitcoin script and witness sizes</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">关于比特币脚本和见证大小</h1>
<blockquote>原文：<a href="https://medium.com/coinmonks/on-bitcoin-transaction-sizes-97e31bc9d816?source=collection_archive---------0-----------------------#2020-06-14">https://medium.com/coinmonks/on-bitcoin-transaction-sizes-97e31bc9d816?source=collection_archive---------0-----------------------#2020-06-14</a></blockquote><div><div class="ef hh hi hj hk hl"/><div class="hm hn ho hp hq"><div class=""/><p id="22d8" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">下面的调查处理不同事务类型的脚本和见证的大小要求。通过对第一性原理和经验数据的分析，为脚本和证人建立了一组估计。这些估计值可以作为定量模型的输入，这些模型的预测可能有助于使未来的区块规模讨论更加客观。</p><p id="42fe" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">这篇文章的结构如下。下一节包含对相关术语的简要讨论。以下两节重点介绍比特币中使用的公钥和签名的编码。然后对所有的比特币交易输出类型进行单独详细的讨论。最后，结果部分总结了调查结果。</p><h1 id="c790" class="jo jp ht bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl dt translated">术语</h1><p id="5695" class="pw-post-body-paragraph iq ir ht is b it km iv iw ix kn iz ja jb ko jd je jf kp jh ji jj kq jl jm jn hm dt translated">为了避免误解和进行理性的讨论，需要对关键术语进行简要的定义。特别是，区分<em class="kr">交易类型</em>和<em class="kr">交易输出类型</em>是有帮助的，因为这两个术语有时会被混淆，这会导致混淆。</p><p id="c190" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated"><em class="kr">事务类型</em>定义了事务可以拥有的两个属性。第一个属性与新硬币的创造有关:每个块恰好包含一个<em class="kr"> coinbase </em>事务，由矿工用来生成新硬币；该组中的所有其他交易使用先前存在的硬币，并且是<em class="kr">非硬币基础</em>交易。第二个属性涉及比特币的隔离见证(segwit)升级:当一个或多个交易的输入与见证数据相关联时，整个交易被视为一个<em class="kr"> segwit </em>交易；否则，该交易被视为<em class="kr">非segwit </em>交易。</p><p id="3498" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">另一方面，<em class="kr">事务输出类型</em>定义了事务输出的类型。每个输出都包含一个锁定脚本，该脚本设置锁定在输出中的硬币可以使用的条件，输出的类型由输出中使用的脚本类型决定:例如，当输出的脚本指定需要公钥来解锁硬币时，输出的类型是Pay-to-Public-Key (P2PK)。</p><p id="bed0" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">花费产出的过程有时被称为交易，因此花费P2PK产出成为P2PK交易。然而，这意味着术语<em class="kr">交易</em>现在有两种不同的含义:一方面，它指的是比特币的交易数据结构；另一方面是花费产出的行为。按照这个术语，单个事务(第一个含义)可以包含多个事务(第二个含义)，这可能会引起混淆。</p><p id="0972" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">总之，可以确定的是，只有coinbase和segwit交易指的是真正的<em class="kr">交易类型</em>，而所有其他交易类型实际上指的是一个输入花费一个具有特定<em class="kr">交易输出类型</em>的输出。</p><h1 id="c71a" class="jo jp ht bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl dt translated">公钥的编码</h1><p id="5243" class="pw-post-body-paragraph iq ir ht is b it km iv iw ix kn iz ja jb ko jd je jf kp jh ji jj kq jl jm jn hm dt translated"><a class="ae ks" href="https://blog.coincodecap.com/a-candid-explanation-of-bitcoin/" rel="noopener ugc nofollow" target="_blank">比特币</a>使用椭圆曲线加密技术，公钥对应于椭圆曲线上点的<em class="kr"> x </em> -和<em class="kr">y</em>-坐标。比特币使用的椭圆曲线<em class="kr"> secp256k1 </em>，在效率加密标准(SEC)中定义，使用256位数字来表示曲线上点的<em class="kr"> x </em> -和<em class="kr">y</em>-坐标。</p><p id="9b2a" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">除了为不同的椭圆曲线建立参数外，sec还定义了公钥编码标准。本来比特币只支持<em class="kr">未压缩</em> SEC格式。在这种格式中，公钥由一个单字节的幻数表示，该幻数表示所使用的sec编码的种类(在这种情况下，是未压缩的)以及密钥的两个32字节的<em class="kr"> x </em>和<em class="kr"> y </em>坐标的编码。因此，未压缩的SEC格式总共使用65个字节。</p><p id="8f0c" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">一段时间后，<em class="kr">压缩</em>秒格式的支持被添加到<a class="ae ks" href="https://blog.coincodecap.com/a-candid-explanation-of-bitcoin/" rel="noopener ugc nofollow" target="_blank">比特币</a>中。通过利用公钥的<em class="kr"> y </em>坐标(除了它的符号)可以从公钥的<em class="kr"> x </em>坐标导出的事实，压缩格式显著减小了公钥的编码大小。因此，当使用压缩的SEC格式时，不是编码公钥的<em class="kr"> x </em>和<em class="kr"> y </em>坐标，而是仅编码其<em class="kr"> x </em>坐标。关于<em class="kr"> y </em>坐标符号的模糊性通过使用两个不同的单字节幻数作为SEC前缀来解决:一个表示压缩的SEC格式，具有正的<em class="kr"> y </em>坐标；另一个为负<em class="kr"> y </em>坐标。通过去掉<em class="kr"> y </em>坐标，编码的大小可以减少32个字节。因此，使用压缩格式，仅使用33个字节就可以对公共密钥进行编码。</p><figure class="ku kv kw kx fq ky fe ff paragraph-image"><div role="button" tabindex="0" class="kz la di lb bf lc"><div class="fe ff kt"><img src="../Images/b9a54d1f64570b9a7465f774dd93ce93.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_U6UqVtsN8LgY233ayXJVg.png"/></div></div></figure><p id="fe34" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">上图显示了P2PK、P2PKH和P2WSH事务中未压缩和压缩编码的份额。经验数据显示，多年来，比特币中未压缩密钥的使用稳步下降。事实上，在最近的过去，使用未压缩密钥的交易份额非常低，以至于为了实用的目的，今天的编码公钥的大小可以被假定为33字节。</p><h1 id="17d6" class="jo jp ht bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl dt translated">签名编码</h1><p id="91e3" class="pw-post-body-paragraph iq ir ht is b it km iv iw ix kn iz ja jb ko jd je jf kp jh ji jj kq jl jm jn hm dt translated">比特币的签名编码遵循区分编码规则(DER)。一个签名由两个256位的数字组成，<em class="kr"> r </em>和<em class="kr"> s </em>。用DER编码时，每个数字都有两个字节作为前缀:一个用来编码数据类型，是整数；另一个以字节表示数字的长度。</p><p id="d6d7" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">接下来是对<em class="kr"> r </em>和<em class="kr"> s </em>的值进行编码。尽管这些值是256位值，但它们的编码并不总是32字节。例如，DER使用有符号整数的事实对编码的大小有影响:有符号整数使用数字的二进制表示的最高位来区分正值和负值，因此最高位被设置的<em class="kr"> r </em>和<em class="kr"> s </em>的值将被解释为负数。为了防止这种情况，在设置了最高位的情况下，会在前面加上一个零字节:这使值保持不变，但强制最高位不设置。设置了最高位并要求补零的<em class="kr"> r </em>和<em class="kr"> s </em>的值也称为<em class="kr">高</em>值，而没有设置最高位且不要求补零的值称为<em class="kr">低</em>值。</p><p id="1596" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">自比特币核心版本0 . 11 . 1(2015年10月)起，“低<em class="kr"> s </em>规则强制仅中继具有低s值的交易，这意味着s的编码将具有至多32字节的大小；只有矿工可以绕过这一限制，将具有高<em class="kr"> s </em>值的签名包含在块中。对于<em class="kr"> r </em>来说，这个限制是不存在的。假设值是均匀分布的，签名应该有一半时间包含高值。因此，平均而言，其编码大小为32.5字节。</p><p id="f5e4" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">用两个字节表示每个值的数据类型和长度，到目前为止，平均大小为:r<em class="kr">r</em>34.5字节，s<em class="kr">s</em>34字节，或者两者都是68.5字节。要获得有效的DER签名，还需要两个字节:一个字节表示编码保存多个值，另一个字节表示编码的总长度。一个完整的DER签名由这两个字节组成，后面是之前讨论过的<em class="kr"> r </em>和<em class="kr"> s </em>值的编码。因此DER签名的平均大小是70.5字节。最后需要指出的是，比特币支持多种签名类型。为了区分这两者，指示签名类型的字节被附加到DER签名。因此，编码签名的平均大小为71.5字节。</p><p id="7de8" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">为了完成对签名大小的分析，还需要讨论两个方面。第一个问题是签名的<em class="kr"> r </em>和<em class="kr"> s </em>值是随机的。如果随机256位数字的二进制表示具有8个或其前导位被设置为零，则该数字可以使用少于32个字节来编码。第二个方面涉及签名大小的优化，该优化由于以下事实而成为可能:<em class="kr"> r </em>和<em class="kr"> s </em>值的生成涉及随机输入:一些实现丢弃具有高值的签名；相反，它们选择新的随机输入并导出新的<em class="kr"> r </em>和<em class="kr"> s </em>值，直到发现低<em class="kr"> r </em>值。加上由强制用于标准事务的low-s值，生成的签名的大小最多为71个字节。</p><figure class="ku kv kw kx fq ky fe ff paragraph-image"><div role="button" tabindex="0" class="kz la di lb bf lc"><div class="fe ff kt"><img src="../Images/a671933eb2f2f3d2cd7f4985ad088856.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-KdZ1ZepG5R4xl8lswOmYA.png"/></div></div></figure><p id="9cb3" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">为了量化影响签名大小的不同因素的总体影响，需要对经验数据进行分析。上面的直方图显示了在区块626，267之前的两年中，比特币区块链中不同签名大小的出现。正如所料，大部分签名的大小为71或72字节。稍微偏向71字节可以归功于前面讨论的low-r<em class="kr">优化。此外，可以观察到少量的70字节签名。这可以归因于前面讨论的在<em class="kr"> r </em>和<em class="kr"> s </em>值的二进制表示中前导零比特的出现。事实上，甚至有只有69或68字节的签名；然而，这种情况很少发生，因此在直方图中看不到。根据经验数据，平均签名大小为71.46字节，这与之前分析估计的71.5字节相匹配。因此，出于实际目的，今天的签名的大小可以假设为71.5字节。</em></p><h1 id="1676" class="jo jp ht bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl dt translated">支付公钥</h1><p id="dd0d" class="pw-post-body-paragraph iq ir ht is b it km iv iw ix kn iz ja jb ko jd je jf kp jh ji jj kq jl jm jn hm dt translated">Pay-to-Public-Key (P2PK)输出的锁定脚本格式为<code class="eh lf lg lh li b">&lt;len&gt; &lt;pubkey&gt; OP_CHECKSIG</code>，其中<code class="eh lf lg lh li b">&lt;len&gt;</code>为后续公钥的长度，以字节为单位；<code class="eh lf lg lh li b">&lt;pubkey&gt;</code>，一个sec编码的公钥；以及<code class="eh lf lg lh li b">OP_CHECKSIG</code>，用于签名验证的比特币脚本指令。</p><p id="11ae" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">公钥和比特币脚本指令的长度编码各需要一个字节。先前确定的公钥估计值为33字节。因此，P2PK输出的锁定脚本大小估计为35字节。</p><p id="d519" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">P2PK输出的解锁脚本格式为<code class="eh lf lg lh li b">&lt;len&gt; &lt;sig&gt;</code>，其中<code class="eh lf lg lh li b">&lt;len&gt;</code>为后续签名的大小，单位为字节；以及<code class="eh lf lg lh li b">&lt;sig&gt;</code>，一个DER编码的签名。</p><p id="bceb" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">签名长度的编码需要一个字节，而先前建立的签名大小的估计值是71.5字节。因此，P2PK解锁脚本的估计值为72.5字节。</p><p id="2fc4" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">P2PK脚本的总体贡献由锁定和解锁脚本的大小之和给出。前者的大小为35字节；后者72.5字节。因此，P2PK脚本的估计值为107.5字节。</p><figure class="ku kv kw kx fq ky fe ff paragraph-image"><div role="button" tabindex="0" class="kz la di lb bf lc"><div class="fe ff kt"><img src="../Images/58efee8cd16dbf5ea224a688a253beb8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ThR8za0p7kV61YFzgoaTig.png"/></div></div></figure><p id="ad17" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">上图所示的经验数据证实了该估计的有效性，该图显示了截至块626、267的所有消耗的P2PK输出的P2PK脚本大小的直方图。正如所料，大部分事务的脚本大小为107和108字节(由于low- <em class="kr"> r </em>优化，稍微偏向于107字节)。以141字节为中心的第二簇大小对应于使用<em class="kr">未压缩</em>公钥的事务。请注意，直方图包括来自所有 P2PK交易的<em class="kr">数据。第二个簇只是比特币早期的产物，当时未压缩的密钥更常见，因此它的存在对今天P2PK交易中脚本的107.5字节估计值的有效性没有影响。</em></p><h1 id="827f" class="jo jp ht bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl dt translated">付费公钥哈希</h1><p id="7bf5" class="pw-post-body-paragraph iq ir ht is b it km iv iw ix kn iz ja jb ko jd je jf kp jh ji jj kq jl jm jn hm dt translated">Pay-to-Public-Key-Hash (P2PKH)输出的locking-script格式为<code class="eh lf lg lh li b">OP_DUP OP_HASH160 0x14 &lt;hash&gt; OP_EQUALVERIFY OP_CHECKSIG</code>，其中<code class="eh lf lg lh li b">OP_DUP</code>为复制栈顶项的比特币脚本指令；<code class="eh lf lg lh li b">OP_HASH160</code>，将HASH-160函数应用于栈顶项的比特币脚本指令；<code class="eh lf lg lh li b">0x14</code>，以下20字节hash的长度，以字节为单位(采用十六进制表示)；<code class="eh lf lg lh li b">&lt;hash&gt;</code>，一个20字节的HASH-160公钥；<code class="eh lf lg lh li b">OP_EQUALVERIFY</code>，两个栈顶项不同时，使交易无效的比特币脚本指令；以及<code class="eh lf lg lh li b">OP_CHECKSIG</code>，验证签名的比特币脚本指令。</p><p id="ef75" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">四个比特币脚本指令和散列长度的编码各需要一个字节。加上20字节的散列，这意味着锁定脚本的大小为25字节</p><p id="72e2" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">P2PKH输出的解锁脚本格式为<code class="eh lf lg lh li b">&lt;len&gt; &lt;sig&gt; &lt;len&gt; &lt;pubkey&gt;</code>，其中<code class="eh lf lg lh li b">&lt;len&gt;</code>为后续签名的大小，单位为字节；<code class="eh lf lg lh li b">&lt;sig&gt;</code>，一个DER编码的签名，使用私钥创建，下一个在锁定脚本中出现的公钥就是从该私钥导出的；<code class="eh lf lg lh li b">&lt;len&gt;</code>，以下公钥的大小，以字节为单位；以及<code class="eh lf lg lh li b">&lt;pubkey&gt;</code>，SEC编码的公钥，锁定脚本中使用的HASH-160就是从这个公钥派生出来的。</p><p id="8fd7" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">签名和公钥的长度编码各需要一个字节。加上先前建立的分别为71.5和33字节的签名和公钥的估计，这导致了106.5字节的解锁脚本大小估计。</p><p id="f9f0" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">P2PKH脚本的总贡献是锁定和解锁脚本大小的总和，分别为25和106.5字节。因此，P2PKH脚本的估计值为131.5字节。</p><figure class="ku kv kw kx fq ky fe ff paragraph-image"><div role="button" tabindex="0" class="kz la di lb bf lc"><div class="fe ff kt"><img src="../Images/93b1ee737ec43565d0df0a4d51ebc53b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*L--tapVHIDe4P9FXcoyahA.png"/></div></div></figure><p id="5f53" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">和以前一样，这一估计的有效性得到了经验数据的证实。上图包含一个直方图，显示了截至块626，267的所有P2PKH事务的组合脚本大小。正如所料，大部分事务的脚本大小为131和132字节。大约164字节的第二簇对应于使用<em class="kr">未压缩</em>公钥的事务。请注意，直方图包括了所有的P2PKH交易，所以第二个聚类也是比特币早期的产物，当时未压缩密钥更为普遍。因此，第二个群集不会降低对今天的P2PKH事务的组合脚本大小的131.5字节估计的有效性。</p><h1 id="af16" class="jo jp ht bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl dt translated">裸多重签名</h1><p id="7476" class="pw-post-body-paragraph iq ir ht is b it km iv iw ix kn iz ja jb ko jd je jf kp jh ji jj kq jl jm jn hm dt translated">裸多签名(multisig)输出的锁定脚本格式是<code class="eh lf lg lh li b">OP_m &lt;len&gt; &lt;pubkey1&gt; ... &lt;len&gt; &lt;pubkeyn&gt; OP_n OP_CHECKMULTISIG</code>，用<code class="eh lf lg lh li b">OP_m</code>指定<em class="kr"> m </em>，花费输出所需的签名数；<code class="eh lf lg lh li b">&lt;len&gt;</code>，后续编码密钥的长度，以字节为单位；<code class="eh lf lg lh li b">&lt;pubkey1&gt; ... &lt;pubkeyn&gt;</code>，n个<em class="kr">秒编码的公钥列表；<code class="eh lf lg lh li b">OP_n</code>，编码<em class="kr"> n </em>，公钥的个数；以及<code class="eh lf lg lh li b">OP_CHECKMULTISIG</code>，多签名验证的比特币脚本指令。</em></p><p id="df0a" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">与P2PK和P2PKH输出类型不同，在P2PK和P2PKH输出类型中，锁定脚本的大小是固定的，而multisig的锁定脚本的大小取决于脚本中使用的公钥的数量。为了更好地了解最流行的multisig用例以及相应的锁定脚本大小，需要对经验数据进行分析。</p><figure class="ku kv kw kx fq ky fe ff paragraph-image"><div role="button" tabindex="0" class="kz la di lb bf lc"><div class="fe ff lj"><img src="../Images/e04ffd59b73eff038243560a32ffa61e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jKp9HxjHrzhQRdTwcx2eYA.png"/></div></div></figure><p id="f882" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">上表显示了截至模块626、267的不同裸multisig输出类型的计数、频率和锁定脚本大小(及其频率)。数据显示，2选1和3选1是迄今为止最受欢迎的裸multisig变体，合计占所有multisig输出的98%以上。因此，在下文中，重点将放在对这些特定变量的估计上。</p><p id="6f61" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">此外，数据显示了向最小输出大小的强烈趋势:在最后一列中，每行的第一个条目表示所有公钥都使用压缩SEC格式编码的情况；对于每种类型，这是最常见的编码。对于最后一列中的任何特定行，将一个条目向右移动对应于以未压缩而不是压缩的SEC格式表示的多一个公钥，这对应于锁定脚本的大小增加了32个字节。进一步的分析揭示了来自最近过去的multisig输出对所有压缩的键具有更强的偏好；使用一个或多个未压缩公钥的输出比例很小，这是由于比特币早期的输出经常使用未压缩的密钥。</p><p id="31e2" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">总结一下关于锁定脚本大小的讨论，可以确定2选1和3选1的multisig输出是两个最重要的用例；今天，它们的大小估计分别是71和105字节。</p><p id="80a5" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">multisig输出的解锁脚本格式为<code class="eh lf lg lh li b">&lt;OP_0&gt; &lt;len&gt; &lt;sig1&gt; ... &lt;len&gt; &lt;sigm&gt;</code>，带有<code class="eh lf lg lh li b">OP_0</code>，这是一个虚拟的比特币脚本指令，用于解决<code class="eh lf lg lh li b">OP_CHECKMULTISIG</code>实现中的一个bug<code class="eh lf lg lh li b">&lt;len&gt;</code>，以下签名的长度，以字节为单位；和<code class="eh lf lg lh li b">&lt;sig1&gt; ... &lt;sig1&gt;</code>，m个<em class="kr">DER编码签名的列表。</em></p><p id="ca46" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">与锁定脚本的情况一样，multisig输出的解锁脚本大小是不固定的；在解锁脚本的情况下，大小取决于签名的数量。伪脚本指令<code class="eh lf lg lh li b">OP_0</code>总是贡献1个字节；每个签名长度编码贡献另一个字节；并且每个签名还有71.5字节。在两个最流行的用例中(1-of-2和1-of-3 multisig)，必须在解锁脚本中提供一个签名。因此，两种变体的解锁脚本大小的估计是73.5字节。</p><p id="73d7" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">multisig脚本总大小的估计值是锁定和解锁脚本大小的总和。对于1-of-2 multisig事务，相应的脚本贡献71和73.5字节，导致脚本大小估计为144.5字节；对于1/3变体，贡献为105和73.5字节，产生178.5字节的脚本估计值。</p><figure class="ku kv kw kx fq ky fe ff paragraph-image"><div role="button" tabindex="0" class="kz la di lb bf lc"><div class="fe ff kt"><img src="../Images/f49670b06134cb0bba91cd7cb85e6564.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*p0fleFqRDcmn9-igyhJjdQ.png"/></div></div></figure><p id="27e7" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">像往常一样，这些估计得到了经验数据的支持。上图包含截至块626，267的所有2选1和3选1 multisig交易的组合脚本大小的直方图。对于1-of-2 multisig，可以观察到少量脚本大小为176和177字节的事务，这对应于使用未压缩公钥的事务。和以前一样，这个由比特币早期的旧交易造成的假象并不影响对今天交易的估计。正如预期的那样，大多数1/2 multisig事务的脚本大小符合144.5字节的估计值，大小为144或145字节。在1/3 multisig的情况下，大多数事务的脚本大小与178.5字节的估计一致，大小为178或179字节。</p><h1 id="ef50" class="jo jp ht bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl dt translated">付费脚本哈希</h1><p id="5217" class="pw-post-body-paragraph iq ir ht is b it km iv iw ix kn iz ja jb ko jd je jf kp jh ji jj kq jl jm jn hm dt translated">Pay-to-Script-Hash (P2SH)输出的锁定脚本格式为<code class="eh lf lg lh li b">OP_HASH160 0x14 &lt;hash&gt; OP_EQUAL</code>，其中<code class="eh lf lg lh li b">OP_HASH160</code>是将HASH-160函数应用于栈顶项目的比特币脚本指令；<code class="eh lf lg lh li b">0x14</code>，以下20字节哈希的长度以字节表示(采用十六进制表示)；<code class="eh lf lg lh li b">&lt;hash&gt;</code>，一个20字节的HASH-160的rename脚本锁定输出；以及<code class="eh lf lg lh li b">OP_EQUAL</code>，判断两个栈顶项目是否相等的比特币脚本指令。</p><p id="c470" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">每个比特币脚本指令贡献一个字节，哈希长度的编码也是如此。加上20字节的散列，总的锁定脚本大小是23字节。</p><p id="be2a" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">P2SH输出的解锁脚本格式为<code class="eh lf lg lh li b">&lt;data&gt; &lt;len&gt; &lt;redeem script&gt;</code>，带有<code class="eh lf lg lh li b">&lt;data&gt;</code>，一些数据满足赎回脚本设置的条件；<code class="eh lf lg lh li b">&lt;len&gt;</code>，以下赎回脚本的长度；以及<code class="eh lf lg lh li b">&lt;redeem&gt;</code>，将被解释为锁定脚本的赎回脚本。</p><p id="aef1" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">理论上，赎回凭证可以设置任意的消费条件，这意味着赎回凭证的大小是可变的；同样，根据兑现脚本中规定的条件，兑现脚本的数据也有很大不同。鉴于此，估计P2SH解锁脚本的大小似乎不切实际。然而，如下图中的数据所示，在实践中，大多数兑换脚本仅分为三类。在块626，267之前的一年中，所有赎回凭证的69.3%是P2SH-支付给见证人-公钥-哈希(P2SH-P2WPKH)类型；P2SH-Pay-to-Witness-Script-Hash-multisig(P2SH-P2WSH-multisig)类型的21.1%；P2SH-multisig型占9.2%。考虑到只有0.4%的rename脚本不属于前面的任何类别，关注最相关用例的估计而忽略其余的似乎是可以接受的。</p><figure class="ku kv kw kx fq ky fe ff paragraph-image"><div role="button" tabindex="0" class="kz la di lb bf lc"><div class="fe ff kt"><img src="../Images/af72ab69b74ca7a32f7b583937e0ad14.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*06B_esPBH1HEINtbCmcHJQ.png"/></div></div></figure><h2 id="4bc6" class="lk jp ht bd jq ll lm ln ju lo lp lq jy jb lr ls kc jf lt lu kg jj lv lw kk lx dt translated">支付给脚本哈希支付给见证公钥哈希</h2><p id="f261" class="pw-post-body-paragraph iq ir ht is b it km iv iw ix kn iz ja jb ko jd je jf kp jh ji jj kq jl jm jn hm dt translated">对于P2SH-P2WPKH最流行的用例，redempt脚本是<code class="eh lf lg lh li b">OP_0 0x14 &lt;hash&gt;</code>，带<code class="eh lf lg lh li b">OP_0</code>，一个比特币脚本指令，用来表示见证程序的版本；<code class="eh lf lg lh li b">0x14</code>，以下20字节哈希的长度以字节表示(采用十六进制表示)；以及<code class="eh lf lg lh li b">&lt;hash&gt;</code>，公钥的20字节HASH-160。见证程序的版本和哈希长度的编码各贡献一个字节。加上20字节的散列，这导致了22字节的redempt-script大小。由于解锁脚本还包括长度为22字节的赎回脚本的字节编码，因此解锁脚本的总大小为23字节。</p><p id="e735" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">P2WPKH的见证格式为<code class="eh lf lg lh li b">0x02 &lt;len&gt; &lt;sig&gt; &lt;len&gt; &lt;pubkey&gt;</code>，格式为<code class="eh lf lg lh li b">0x02</code>，见证脚本中包含的项数(P2WPKH为两个:签名和对应的公钥)；<code class="eh lf lg lh li b">&lt;len&gt;</code>，以下签名的大小以字节为单位；<code class="eh lf lg lh li b">&lt;sig&gt;</code>，使用私钥创建的DER编码的签名，在锁定脚本中接下来呈现的公钥是从该私钥导出的；<code class="eh lf lg lh li b">&lt;len&gt;</code>，以下公钥的大小，以字节为单位；以及<code class="eh lf lg lh li b">&lt;pubkey&gt;</code>，从其导出在兑换脚本中使用的HASH-160的公钥。见证的平均大小由指示见证脚本中项的数量的字节、指示签名和公钥长度的两个字节、71.5字节的平均签名大小和33字节的公钥大小给出。因此，P2WPKH的见证大小估计为107.5字节。</p><h2 id="581a" class="lk jp ht bd jq ll lm ln ju lo lp lq jy jb lr ls kc jf lt lu kg jj lv lw kk lx dt translated">支付给脚本哈希支付给见证脚本哈希多重签名</h2><p id="bf2b" class="pw-post-body-paragraph iq ir ht is b it km iv iw ix kn iz ja jb ko jd je jf kp jh ji jj kq jl jm jn hm dt translated">对于P2SH-P2WSH-multisig，兑换脚本为<code class="eh lf lg lh li b">OP_0 0x20 &lt;hash&gt;</code>，其中<code class="eh lf lg lh li b">OP_0</code>为比特币脚本指令，用于表示见证程序的版本；<code class="eh lf lg lh li b">0x20</code>，以下32字节哈希的长度以字节表示(采用十六进制表示)；和<code class="eh lf lg lh li b">&lt;hash&gt;</code>，锁定输出的见证脚本的32字节SHA-256散列。见证程序的版本和哈希长度的编码各贡献一个字节。加上32字节的散列，这导致了34字节的redempt-script大小。除了兑换脚本之外，解锁脚本还包含兑换脚本长度的编码，它贡献了一个字节。因此，解锁脚本的总大小为35字节。</p><p id="558a" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">P2SH-P2WSH-multisig输出的见证是<code class="eh lf lg lh li b">&lt;nitems&gt; &lt;data&gt; &lt;len&gt; &lt;witness script&gt;</code>，其中<code class="eh lf lg lh li b">&lt;nitems&gt;</code>是见证中包含的项目数；<code class="eh lf lg lh li b">&lt;data&gt;</code>，一些数据满足见证脚本设置的条件；<code class="eh lf lg lh li b">&lt;len&gt;</code>，以下见证脚本的长度；以及<code class="eh lf lg lh li b">&lt;witness script&gt;</code>，将被解释为锁定脚本的见证脚本。</p><p id="6c3d" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">经验数据显示，2-of-2和2-of-3 multisig变体占所有P2SH-P2WSH-multisig交易的90%以上，因此见证规模估计侧重于这两种情况。</p><p id="065d" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">在2-of-2 multisig的情况下，见证脚本大小对应于2-of-2 multisig的锁定脚本大小，即<code class="eh lf lg lh li b">OP_2 &lt;len&gt; &lt;pubkey1&gt; &lt;len&gt; &lt;pubkey2&gt; OP_2 OP_CHECKMULTISIG</code>。三个比特币脚本指令各贡献一个字节；公钥长度的两种编码也各贡献一个字节；最后，每个公钥贡献33个字节。因此，见证脚本大小估计为71字节。为了满足见证脚本，必须在见证中提供两个71.5字节的签名和每个签名长度的编码，并附带一个<code class="eh lf lg lh li b">OP_0</code>，总计146字节。最后，见证中的项数和见证脚本的长度的编码各贡献一个字节。因此，见证的总大小估计为219字节。</p><p id="624f" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">在2-of-3 multisig的情况下，必须在见证脚本中提供额外的33字节公钥和密钥长度编码，因此见证脚本的大小从71字节增加到105字节。如前所述，花费基金需要两个签名，因此见证人的大小保持为146字节。给定见证中项目数的编码和见证脚本的长度各一个字节，146字节的<code class="eh lf lg lh li b">&lt;data&gt;</code>部分和105字节的见证脚本本身，见证大小的总估计值为253字节。</p><h2 id="5c63" class="lk jp ht bd jq ll lm ln ju lo lp lq jy jb lr ls kc jf lt lu kg jj lv lw kk lx dt translated">付费脚本哈希多重签名</h2><p id="7439" class="pw-post-body-paragraph iq ir ht is b it km iv iw ix kn iz ja jb ko jd je jf kp jh ji jj kq jl jm jn hm dt translated">正如P2SH-P2WPKH-multisig的情况一样，对于P2SH-multisig，2-of-2和2-of-3用例占所有事务的90%以上，因此锁定脚本大小估计将仅针对这两种情况给出。</p><p id="c767" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">对于2-of-2 P2SH-multisig，redempte脚本是一个2-of-2 multisig锁定脚本，其大小估计值先前被确定为71字节。为了满足redempt脚本，必须在见证中提供两个71.5字节的签名和每个签名长度的编码，并附带一个<code class="eh lf lg lh li b">OP_0</code>，总计146字节。因此，总解锁脚本大小对应于146字节签名部分、71字节赎回脚本和用于赎回脚本长度编码的字节的总和。因此，相应的解锁脚本大小估计为218字节。</p><p id="0a94" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">对于2-of-3 P2SH-multisig，redempte脚本是一个2-of-3 multisig锁定脚本，其大小估计值先前被确定为105字节。由于兑换脚本已经变得大于75字节，因此需要两个字节来编码其大小(参见此处的<code class="eh lf lg lh li b">OP_PUSHDATA1</code><a class="ae ks" href="https://en.bitcoin.it/wiki/Script#Constants" rel="noopener ugc nofollow" target="_blank"/>)。所有其他贡献保持不变，因此3选2 P2SH-multisig的锁定脚本大小对应于146字节的<code class="eh lf lg lh li b">&lt;data&gt;</code>部分、105字节的兑换脚本和编码兑换脚本大小所需的两个字节的总和。因此，相应的解锁脚本估计值为253字节。</p><p id="43d4" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">对于前面讨论的事务类型，组合的脚本大小由锁定和解锁脚本大小的总和给出。但是，在嵌套Segwit事务(即P2SH-P2WPKH和P2SH-P2WSH)的情况下，在确定脚本和见证的总体贡献时，必须包括见证的大小。</p><p id="867d" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">因此，P2SH-P2WPKH事务的脚本和见证大小估计考虑了23字节的锁定脚本大小、23字节的解锁脚本大小和107.5字节的见证大小。因此，P2SH-P2WPKH事务的相应估计值为153.5字节。</p><p id="e10f" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">对于P2SH-P2WSH-multisig事务，锁定和解锁脚本大小分别为23和35字节。对于2-of-2，见证大小是219字节；对于2/3，它是253字节。因此，2/2和2/3 P2SH-P2WSH-multisig事务的组合脚本和见证大小估计值分别为277和311字节。</p><p id="a42c" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">对于P2SH-multisig交易，锁定脚本大小为23字节。2-of-2 P2SH-multisig的解锁脚本大小为218字节；对于2/3，它是253字节。因此，2/2和2/3 P2SH-multisig事务的组合脚本估计值分别为241和276字节。</p><figure class="ku kv kw kx fq ky fe ff paragraph-image"><div role="button" tabindex="0" class="kz la di lb bf lc"><div class="fe ff kt"><img src="../Images/f3dba520100522295b18d5581659f9a9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wDtGKrzm_TDwjtuNp9s7bQ.png"/></div></div></figure><p id="e458" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">所有的估计都有经验数据支持。上图包含截至块626、267的所有P2SH事务的组合脚本(和见证)大小的直方图。从左到右，第一簇对应于153.5字节的P2SH-P2WPKH估计；241字节的2-of-2 P2SH-multisig估计的下一个；第三个是276字节的2/3 P2SH-multisig估计值；第四个与第三个稍微重叠，是277字节的2-of-2 P2SH-P2WSH-multisig估计；最后，第五个是311字节的2/3 P2SH-P2WSH-multisig估计值。</p><h1 id="c67d" class="jo jp ht bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl dt translated">空数据</h1><p id="bb40" class="pw-post-body-paragraph iq ir ht is b it km iv iw ix kn iz ja jb ko jd je jf kp jh ji jj kq jl jm jn hm dt translated">空数据输出的锁定脚本格式为<code class="eh lf lg lh li b">OP_RETURN &lt;len&gt; &lt;data&gt; ... &lt;len&gt; &lt;data&gt;</code>，其中<code class="eh lf lg lh li b">OP_RETURN</code>是表示空数据输出类型的比特币脚本指令；<code class="eh lf lg lh li b">&lt;len&gt;</code>，以下数据项的长度；而<code class="eh lf lg lh li b">&lt;data&gt;</code>，任意数据。</p><p id="7083" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">比特币脚本指令贡献一个字节。如果数据最多为75字节，则数据长度的编码贡献一个字节，如果数据大于75字节，则贡献两个字节。在比特币核心0.11中，数据部分的大小限制从40字节增加到80字节。因此，锁定脚本的总大小介于1个字节(只有<code class="eh lf lg lh li b">OP_RETURN</code>，没有数据)和83个字节(<code class="eh lf lg lh li b">OP_RETURN</code>，2个字节编码数据长度，80个字节数据)之间。鉴于这一广泛的范围，有必要对经验数据进行分析，以得出对锁定脚本大小的有意义的估计。</p><figure class="ku kv kw kx fq ky fe ff paragraph-image"><div role="button" tabindex="0" class="kz la di lb bf lc"><div class="fe ff kt"><img src="../Images/df2bc6b00c2c7eb38b9a1694aeb46c28.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2BfB0_EIZA1x8dEto23rAA.png"/></div></div></figure><p id="1cb0" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">上图包含了截至块626，267的所有空数据输出的锁定脚本大小的直方图。该数据揭示了两个主要的用例，它们合起来占所有空数据输出的90%以上。22字节处的第一个峰值对应于20字节的数据大小，这可能是在空数据输出中记录HASH-160或RIPEMD-160散列的实例。第二个峰值为83字节，表示数据大小为80字节，这是空数据输出的上限。这些实例可能对应于这样的用例:大量数据被分成多个空数据输出，每个输出存储尽可能多的数据。直方图中的数据表明批量数据用例稍微更受欢迎。基于这个经验数据，锁定脚本大小的估计值是53.6字节。</p><p id="65f2" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">空数据输出被设计成不可描述的，所以估计解锁脚本的大小是没有意义的。此外，因为不可能有空数据事务，所以给出事务大小估计值同样没有意义。</p><h1 id="19d1" class="jo jp ht bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl dt translated">支付给证人公钥散列</h1><p id="6013" class="pw-post-body-paragraph iq ir ht is b it km iv iw ix kn iz ja jb ko jd je jf kp jh ji jj kq jl jm jn hm dt translated">Pay-to-Witness-Public-Key-Hash(p 2 wpkh)输出的锁定脚本格式为<code class="eh lf lg lh li b">OP_0 0x14 &lt;hash&gt;</code>，其中<code class="eh lf lg lh li b">OP_0</code>为比特币脚本指令，用于表示见证程序的版本；<code class="eh lf lg lh li b">0x14</code>，以下20字节哈希的长度以字节表示(采用十六进制表示)；以及<code class="eh lf lg lh li b">&lt;hash&gt;</code>，公钥的20字节HASH-160。</p><p id="b3cc" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">P2WPKH输出的锁定脚本大小始终为22个字节:20个字节的哈希，以及比特币脚本指令和哈希长度编码各一个字节。</p><p id="d53a" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">一个P2WPKH输出的见证是<code class="eh lf lg lh li b">0x02 &lt;len&gt; &lt;sig&gt; &lt;len&gt; &lt;pubkey&gt;</code>，其中<code class="eh lf lg lh li b">0x02</code>，见证脚本中包含的项数(在P2WPKH的情况下是两个:签名和对应的公钥)；<code class="eh lf lg lh li b">&lt;len&gt;</code>，以下签名的大小以字节为单位；<code class="eh lf lg lh li b">&lt;sig&gt;</code>，使用私钥创建的签名，下一个在见证中呈现的公钥是从该私钥导出的；<code class="eh lf lg lh li b">&lt;len&gt;</code>，以下公钥的大小，以字节为单位；以及<code class="eh lf lg lh li b">&lt;pubkey&gt;</code>，从中导出锁定脚本中使用的HASH-160的公钥。</p><p id="f4ba" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">见证中的项数以及签名和公钥的长度的编码各占一个字节。加上71.5字节的签名和33字节的公钥，这导致107.5字节的见证大小估计。</p><p id="e829" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">P2WPKH事务的脚本和见证的总贡献是锁定脚本和见证大小的总和，分别为22和107.5字节。因此，P2WPKH事务的脚本和见证估计值为129.5字节。</p><figure class="ku kv kw kx fq ky fe ff paragraph-image"><div role="button" tabindex="0" class="kz la di lb bf lc"><div class="fe ff kt"><img src="../Images/fa4ab3a4577afa93a1d6898d7a5c88c2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4vPr4HRp3xL-X485z6pKpQ.png"/></div></div></figure><p id="2a7e" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">经验数据证实了129.5字节的估计值:上图包含了截至块626，267的所有P2WPKH事务的组合脚本和见证大小的直方图，显示了超过99%的事务具有129或130字节的组合脚本和见证大小。</p><h1 id="31f7" class="jo jp ht bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl dt translated">支付给证人脚本哈希</h1><p id="ab08" class="pw-post-body-paragraph iq ir ht is b it km iv iw ix kn iz ja jb ko jd je jf kp jh ji jj kq jl jm jn hm dt translated">Pay-to-Witness-Script-Hash(P2WSH)输出的locking-script格式为<code class="eh lf lg lh li b">OP_0 0x20 &lt;hash&gt;</code>，其中<code class="eh lf lg lh li b">OP_0</code>为比特币脚本指令，用于表示见证程序的版本；<code class="eh lf lg lh li b">0x20</code>，以下32字节哈希的长度以字节表示(采用十六进制表示)；和<code class="eh lf lg lh li b">&lt;hash&gt;</code>，锁定输出的见证脚本的32字节SHA-256散列。</p><p id="699e" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">P2WSH输出的锁定脚本大小始终是34个字节:32个字节的哈希，以及用于比特币脚本指令和哈希长度编码的各一个字节。</p><p id="870a" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">P2WSH输入的一般见证格式为<code class="eh lf lg lh li b">&lt;nitems&gt; &lt;data&gt; &lt;len&gt; &lt;witness script&gt;</code>，带<code class="eh lf lg lh li b">&lt;nitems&gt;</code>，见证包含的项数；<code class="eh lf lg lh li b">&lt;data&gt;</code>，一些数据满足见证脚本设置的条件；<code class="eh lf lg lh li b">&lt;len&gt;</code>，以下见证脚本的长度；<code class="eh lf lg lh li b">&lt;witness script&gt;</code>，将被解释为锁定脚本的见证脚本。</p><p id="75be" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">理论上，见证脚本可以设置任意的花费条件，这意味着见证脚本的大小是可变的；同样，根据见证脚本中规定的条件，履行见证脚本的数据也有很大不同。有鉴于此，估计P2WSH见证人的规模似乎不切实际。然而，如下图中的数据所示，在实践中，大多数见证脚本都规定了多重签名支出条件。</p><figure class="ku kv kw kx fq ky fe ff paragraph-image"><div role="button" tabindex="0" class="kz la di lb bf lc"><div class="fe ff kt"><img src="../Images/62dd08bab2f059aa27d2e9f502ab95d5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*s5B44xIvwMeag5sq2qKSRw.png"/></div></div></figure><p id="405e" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">此外，只有三种用例占所有P2WSH-multisig交易的98%以上，即1对1 (20%)、2对2 (17%)和3对2(62%)multisig变体。考虑到这一点，关注这些相关用例的估计而忽略其余的似乎是可以接受的。</p><p id="582d" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">对于1-of-1 P2WSH-multisig，见证脚本对应于1-of-1 multisig锁定脚本，即<code class="eh lf lg lh li b">OP_1 &lt;len&gt; &lt;pubkey&gt; OP_1 OP_CHECKMULTISIG</code>。三个比特币脚本指令各贡献一个字节，公钥长度的编码也是如此，而公钥本身贡献33个字节。因此，见证脚本大小估计为37字节。为了满足见证脚本，必须提供一个71.5字节的签名和一个带有<code class="eh lf lg lh li b">OP_0</code>的签名长度编码，因此<code class="eh lf lg lh li b">data</code>部分的总贡献是73.5字节。最后，见证中的项数和见证脚本的长度的编码各贡献一个字节。因此，相应的见证大小估计值为112.5字节。</p><p id="0c69" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">对于2-of-2 P2WSH-multisig，见证脚本包含第二个公钥和密钥长度的编码，因此见证脚本大小增加了34个字节，达到71个字节。为了满足见证，需要第二个71.5字节的签名和签名长度的编码，将<code class="eh lf lg lh li b">data</code>部分的贡献增加72.5字节，达到146字节。见证中的项数和见证脚本的长度的编码的剩余贡献为两个字节，因此相应的见证大小估计值为219个字节。</p><p id="88df" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">对于2-of-3 P2WSH-multisig，见证脚本包含第三个公钥和密钥长度的编码，因此见证脚本的大小又增加了34个字节，达到105个字节。所有其他贡献仍然存在，因此相应的见证大小估计值为253字节。</p><p id="b604" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">对于所有P2WSH-multisig变体，总的脚本和见证贡献由锁定脚本和见证大小的总和给出。前者总是34字节。后者112.5字节用于1-of-1；219字节用于2选2；和253字节用于3个P2WSH-multisig中的2个。因此，对于1-of-1，组合的脚本和见证大小估计为146.5字节；253字节用于2选2；和287字节用于3个P2WSH-multisig中的2个。</p><figure class="ku kv kw kx fq ky fe ff paragraph-image"><div role="button" tabindex="0" class="kz la di lb bf lc"><div class="fe ff kt"><img src="../Images/babeab15d336d264efd74a643501ec00.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*W7oz3KLcj8aSLLcQheBfIg.png"/></div></div></figure><p id="337a" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">经验数据支持所有这些估计。上图包含截至块626，267的所有P2WSH事务的组合脚本和见证大小的直方图。从左到右，第一簇对应于146.5字节的1/1 P2WSH-multisig估计；第二个是253字节的2/2 P2WSH-multisig估计值；最后，第三个是287字节的2/3 P2WSH-multisig估计值。</p><h1 id="8f7a" class="jo jp ht bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl dt translated">结果和结论</h1><p id="ee9d" class="pw-post-body-paragraph iq ir ht is b it km iv iw ix kn iz ja jb ko jd je jf kp jh ji jj kq jl jm jn hm dt translated">使用第一性原理分析和经验数据，调查了所有交易输出类型的脚本和见证的大小(截至2020年5月)。基于分析的结果，为所有相关的用例建立了评估；此外，所有的估计都是用经验数据验证的。下表总结了调查结果。它显示了所有相关用例的锁定脚本、解锁脚本和见证大小；还显示了以字节为单位的组合脚本(和见证)大小、以重量单位(WU)为单位的总重量以及以vbytes为单位的虚拟大小(vsize)。</p><figure class="ku kv kw kx fq ky fe ff paragraph-image"><div role="button" tabindex="0" class="kz la di lb bf lc"><div class="fe ff ly"><img src="../Images/0f3348db0ea2838e2b619747b6d9cda7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Rl3On0KDHU6dEbot_2Etlw.png"/></div></div></figure><p id="2a60" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">这张表代表了上一次调查的主要结果。它旨在作为开发定量模型的起点，这些模型的预测可能会为未来关于比特币各种改进的讨论提供一些客观性。</p><p id="538a" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">如果您发现本文中的信息有用，请随意投稿:<code class="eh lf lg lh li b">16pGpaoAhzoneLdRdxPSo9xAAPhzWnP2dA</code>。如果你有科学、比特币相关的自由职业者工作，<a class="ae ks" href="mailto:cato@zen.science" rel="noopener ugc nofollow" target="_blank">让我知道</a>。</p><blockquote class="lz"><p id="502f" class="ma mb ht bd mc md me mf mg mh mi jn ek translated"><a class="ae ks" href="https://coincodecap.com/?utm_source=coinmonks" rel="noopener ugc nofollow" target="_blank">在您的收件箱中直接获得最佳软件交易</a></p></blockquote><figure class="mk ml mm mn mo ky fe ff paragraph-image"><a href="https://coincodecap.com/?utm_source=coinmonks"><div class="fe ff mj"><img src="../Images/7c0b3dfdcbfea594cc0ae7d4f9bf6fcb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1168/format:webp/0*OJ-qb5G6i863msBB.png"/></div></a></figure></div></div>    
</body>
</html>