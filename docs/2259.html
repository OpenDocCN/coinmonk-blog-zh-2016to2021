<html>
<head>
<title>Perfect Forward Secrecy in Turms Anonymous Message Transport</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Turms匿名消息传输中的完美前向保密</h1>
<blockquote>原文：<a href="https://medium.com/coinmonks/perfect-forward-secrecy-in-turms-anonymous-message-transport-f770527992bd?source=collection_archive---------1-----------------------#2019-06-12">https://medium.com/coinmonks/perfect-forward-secrecy-in-turms-anonymous-message-transport-f770527992bd?source=collection_archive---------1-----------------------#2019-06-12</a></blockquote><div><div class="ef hh hi hj hk hl"/><div class="hm hn ho hp hq"><div class=""/><p id="8cb4" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">Turms AMT(匿名消息传输)是一个对等消息系统，用于在以太坊地址之间发送加密消息(参见<a class="ae jo" rel="noopener" href="/@alejandrodiaz_71295/introducing-turms-anonymous-message-transport-2e40b31dbdc2?source=friends_link&amp;sk=1cdec02ea57b2fd0bb66d5e711d0a256">介绍Turms匿名消息传输</a>)。</p><p id="b9fe" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">在未加密的公共区块链上发送加密信息是一项挑战。因此，在本文中，我将解释我们是如何在Turms AMT中做到这一点的。</p><figure class="jq jr js jt fq ju fe ff paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="fe ff jp"><img src="../Images/77c2a47cd58a2cfd635306d4e922d77f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-IE3iiP4UWsoy5OgAxjd8w.jpeg"/></div></div></figure><p id="2f20" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">我们在Turms AMT中有以下加密目标:</p><ul class=""><li id="6630" class="kb kc ht is b it iu ix iy jb kd jf ke jj kf jn kg kh ki kj dt translated">发送者和接收者都应该能够用同一个密钥解密消息——一个只有他们才能导出的密钥。</li><li id="7d30" class="kb kc ht is b it kk ix kl jb km jf kn jj ko jn kg kh ki kj dt translated">密钥导出必须不需要“握手”；也就是说，即使一方离线，它也需要工作。</li><li id="d8fc" class="kb kc ht is b it kk ix kl jb km jf kn jj ko jn kg kh ki kj dt translated">加密技术应该包含“完美的前向保密”；也就是说，解密一条消息的密钥应该不能解密任何未来的消息。</li><li id="a042" class="kb kc ht is b it kk ix kl jb km jf kn jj ko jn kg kh ki kj dt translated">加密的信息应该是无法被现代最先进的硬件破解的。</li></ul><h2 id="1773" class="kp kq ht bd kr ks kt ku kv kw kx ky kz jb la lb lc jf ld le lf jj lg lh li lj dt translated">完美前向保密</h2><p id="f39e" class="pw-post-body-paragraph iq ir ht is b it lk iv iw ix ll iz ja jb lm jd je jf ln jh ji jj lo jl jm jn hm dt translated"><em class="lp">完美的前向保密</em>是指解密密钥随着每条消息而变化——因此，即使一条消息的解密密钥被泄露，也只是有助于解密一条消息(而不是整个消息线程)。这对Turms AMT特别有用:我们想象人们会使用Turms AMT在区块链上存储重要信息，如可执行的合同或金融义务；而且，在某些时候，人们可能希望向第三方透露其中一条消息的内容，例如证明发送了什么。完美的前向保密将使共享一条消息的加密密钥成为可能，同时仍然保持所有其他消息的安全——即使是来自同一个Turms帐户的消息。</p><h2 id="e087" class="kp kq ht bd kr ks kt ku kv kw kx ky kz jb la lb lc jf ld le lf jj lg lh li lj dt translated">一口</h2><p id="8d8d" class="pw-post-body-paragraph iq ir ht is b it lk iv iw ix ll iz ja jb lm jd je jf ln jh ji jj lo jl jm jn hm dt translated">为了实现我们的加密目标，我们决定在发送方和接收方之间使用一种Diffie-Hellman-Merkle密钥交换来生成PMK(成对主密钥)；然后将随机数(随每条消息更新的值)与PMK一起散列以生成PTK(成对临时密钥)，该用于AES加密每条消息。</p><p id="ad29" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">真拗口！</p><p id="bc68" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">我保证我会在接下来的段落中更简单地分解它。</p><h2 id="f678" class="kp kq ht bd kr ks kt ku kv kw kx ky kz jb la lb lc jf ld le lf jj lg lh li lj dt translated">基本加密概念</h2><p id="8b72" class="pw-post-body-paragraph iq ir ht is b it lk iv iw ix ll iz ja jb lm jd je jf ln jh ji jj lo jl jm jn hm dt translated">在加密通信中，使用加密密钥将<em class="lp">明文</em>消息编码成只能使用解密密钥解码的<em class="lp">密文</em>消息。有许多不同的编码/解码算法，称为密码。但是广义地说，密码可以分为对称密码和非对称密码，对称密码意味着加密密钥和解密密钥相同，非对称密码意味着两个密钥不同。在不对称加密的情况下，通信的每一方实际上都有一个<em class="lp">密钥对</em>；也就是两个一起工作的密钥，一个公钥，一个私钥。用公钥加密的消息只能用私钥解密，反之亦然。加密通道的每一端共享其公钥，另一端使用该公钥在发送消息之前对消息进行加密。在接收到加密的消息时，每一方都使用其从不共享的私钥来解密消息。</p><h2 id="1df0" class="kp kq ht bd kr ks kt ku kv kw kx ky kz jb la lb lc jf ld le lf jj lg lh li lj dt translated">密钥分发问题</h2><p id="a2d4" class="pw-post-body-paragraph iq ir ht is b it lk iv iw ix ll iz ja jb lm jd je jf ln jh ji jj lo jl jm jn hm dt translated">对于没有适当解密密钥的邪恶窃听者来说，加密密码不足以使对话变得不透明。还有一个额外的问题，称为“密钥分发问题”，即如何将解密密钥以无法被第三方截获的方式发送给消息的预期接收方。当使用非对称加密时，密钥分发问题不是这样一个问题——每一方只给出它的公共加密密钥。因此，假设您知道公钥确实属于另一个端点，您可以加密消息，因为只有相应私钥的持有者才能解密密文。</p><p id="5070" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">但是当使用对称加密时，加密消息的密钥与解密消息的密钥相同。在这种情况下，有一个非常现实的问题，即让端点同意使用什么密钥，以防止可能监视密钥协商的第三方得知密钥。这个问题就好比我想给你寄一个宝贝，但是不信任邮递员。我可以把宝藏锁在一个盒子里；但是我怎样才能把锁的钥匙寄给你，这样邮递员就不能复制它了？</p><h2 id="ecb6" class="kp kq ht bd kr ks kt ku kv kw kx ky kz jb la lb lc jf ld le lf jj lg lh li lj dt translated">迪菲-赫尔曼-梅克尔密钥交换</h2><p id="5515" class="pw-post-body-paragraph iq ir ht is b it lk iv iw ix ll iz ja jb lm jd je jf ln jh ji jj lo jl jm jn hm dt translated">Diffie-Hellman-Merkle密钥交换是一个协商私有密钥的聪明系统，这样即使一个邪恶的第三方能够观察整个协商(因为它是在公共区块链上)，他们仍然不能获得协商的对称密钥！Diffie-Hellman协议依赖于一个数学单向函数:</p><pre class="jq jr js jt fq lq lr ls lt aw lu dt"><span id="1988" class="kp kq ht lr b fv lv lw l lx ly">f(g,s,p) = g^s % p</span></pre><p id="3857" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">上式中hat为幂运算子，百分比为<em class="lp">模</em>运算子；也就是说，公式的意思是“将<code class="eh lz ma mb lr b"><strong class="is hu">g</strong></code>升至<code class="eh lz ma mb lr b"><strong class="is hu">s</strong></code>的幂，然后除以<code class="eh lz ma mb lr b"><strong class="is hu">p</strong></code>得到<em class="lp">的余数</em>。</p><p id="be09" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">在这种情况下，我们称该函数为单向函数，因为即使您知道<code class="eh lz ma mb lr b"><strong class="is hu">g</strong></code>和<code class="eh lz ma mb lr b"><strong class="is hu">p</strong></code>，也知道结果<code class="eh lz ma mb lr b">(<strong class="is hu">g</strong>^<strong class="is hu">s</strong> % <strong class="is hu">p</strong>)</code>，仍然不可能得出<code class="eh lz ma mb lr b"><strong class="is hu">s</strong></code>。原因是现代计算机中的乘幂和除法运算速度非常快，即使是对于疯狂的大数字也是如此。但是知道除法的<em class="lp">余数</em>并不能告诉你被除数是多少，即使你知道除数；检查<em class="lp">每个可能的</em>除数<code class="eh lz ma mb lr b">(<strong class="is hu">g</strong>^<strong class="is hu">s</strong>)</code>会非常耗时。例如，将<code class="eh lz ma mb lr b"><strong class="is hu">g</strong></code>设为2、<code class="eh lz ma mb lr b"><strong class="is hu">s</strong></code>设为秘密数、<code class="eh lz ma mb lr b"><strong class="is hu">p</strong></code>设为已知素数。<code class="eh lz ma mb lr b"><strong class="is hu">s</strong></code>和<code class="eh lz ma mb lr b"><strong class="is hu">p</strong></code>都是2048位，非常大。但是<code class="eh lz ma mb lr b"><strong class="is hu">s</strong></code>是一个2048位的数字，<code class="eh lz ma mb lr b"><strong class="is hu">g</strong>^<strong class="is hu">s</strong></code>是超级大的(为了比较，考虑宇宙中只有大约2个⁵⁶原子)。</p><h2 id="5edd" class="kp kq ht bd kr ks kt ku kv kw kx ky kz jb la lb lc jf ld le lf jj lg lh li lj dt translated">密钥推导</h2><p id="8d35" class="pw-post-body-paragraph iq ir ht is b it lk iv iw ix ll iz ja jb lm jd je jf ln jh ji jj lo jl jm jn hm dt translated">在Diffie-Hellman-Merkle密钥交换中，<strong class="is hu"> s </strong>是永不泄露的秘密。但它不是加密密钥。每一方(a方和b方)都有自己的秘密，<code class="eh lz ma mb lr b"><strong class="is hu">s</strong></code>——我们称之为<code class="eh lz ma mb lr b"><strong class="is hu">sa</strong></code>和<code class="eh lz ma mb lr b"><strong class="is hu">sb</strong></code>。并且每一方使用它们的秘密和预定义的值<code class="eh lz ma mb lr b"><strong class="is hu">g</strong></code>和<code class="eh lz ma mb lr b"><strong class="is hu">p</strong></code>计算它们自己的<em class="lp">公共</em>密钥、<code class="eh lz ma mb lr b"><strong class="is hu">fa</strong></code>和<code class="eh lz ma mb lr b"><strong class="is hu">fb</strong></code>，如下所示:</p><pre class="jq jr js jt fq lq lr ls lt aw lu dt"><span id="906b" class="kp kq ht lr b fv lv lw l lx ly">fa = (g^sa) % p<br/>fb = (g^sb) % p</span></pre><p id="324b" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">每一方都公开宣布他们的公钥(<code class="eh lz ma mb lr b"><strong class="is hu">fa</strong></code>和<code class="eh lz ma mb lr b"><strong class="is hu">fb</strong></code>)，<em class="lp"/>！为了计算只有双方知道的私钥，每一方使用相同的单向函数，但是这次用另一方公布的公钥替换<code class="eh lz ma mb lr b"><strong class="is hu">g</strong></code>:</p><pre class="jq jr js jt fq lq lr ls lt aw lu dt"><span id="3e74" class="kp kq ht lr b fv lv lw l lx ly">key(a) = (fb^sa)%p = ([(g^sb)%p] ^ sa) % p<br/>key(b) = (fa^sb)%p = ([(g^sa)%p] ^ sb) % p</span></pre><p id="ac50" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">因为模块数学的一个奇妙的定理，原来<code class="eh lz ma mb lr b">key(a)</code>会等于<code class="eh lz ma mb lr b">key(b)</code>。也就是说，交换取幂运算的顺序不会改变最终结果。</p><h2 id="b6c2" class="kp kq ht bd kr ks kt ku kv kw kx ky kz jb la lb lc jf ld le lf jj lg lh li lj dt translated">Turms AMT中的Diffie-Hellman-Merkle密钥交换</h2><p id="6082" class="pw-post-body-paragraph iq ir ht is b it lk iv iw ix ll iz ja jb lm jd je jf ln jh ji jj lo jl jm jn hm dt translated">我们首先生成一个超级私有<em class="lp">密钥——加密密钥</em>。这是一个256位的对称密钥，它永远不会保存在你的计算机上，也不会被传送到任何地方，传送给任何人。这是从您每次启动Turms AMT时生成的Keccak签名中导出的密钥。</p><figure class="jq jr js jt fq ju fe ff paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="fe ff mc"><img src="../Images/d596c59d5f78a6d57cb034da66bf893a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*i6NlL9vEG0C7Wc2mb3cDTA.png"/></div></div></figure><p id="c4d3" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">请注意，没有人有能力生成您的超级私有密钥-加密密钥。要做到这一点，他们需要能够伪造你的凯克卡签名——如果他们能做到这一点，那么整个以太坊区块链的安全就可能受到威胁——所以重点是:<em class="lp">他们不能</em>。</p><p id="e8e1" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">但是256位不足以创建一个面向未来的、安全的Diffie-Hellman秘密。因此，当您向Turms匿名消息传输注册您的以太坊地址时，我们会生成一个随机的2048位Diffie-Hellman秘密，<code class="eh lz ma mb lr b"><strong class="is hu">s</strong></code>。我们使用超级密钥-加密密钥来加密该秘密，并将加密的秘密存储在区块链上。此外，当您注册您的Turms AMT账户时，我们会生成一个Diffie Hellman公钥<code class="eh lz ma mb lr b">(<strong class="is hu">g</strong>^<strong class="is hu">s</strong>) % <strong class="is hu">p</strong></code>，并将其存储在Turms AMT智能合约的区块链(未加密)中。</p><p id="6fea" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">每当您启动Turms AMT时，我们会从区块链中读取您的加密秘密，并使用您的超级密钥-加密密钥对其进行解密。这就是你如何得到<code class="eh lz ma mb lr b"><strong class="is hu">s</strong></code>。</p><p id="2be1" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">当您想要加密或解密发往/来自另一个地址的消息时，您首先计算一个PMK(成对主密钥)，该密钥对于您的地址和另一个地址的组合是唯一的。您使用Diffie-Hellman技术进行计算:您有自己的Diffie-Hellman秘密<code class="eh lz ma mb lr b"><strong class="is hu">s</strong></code>和另一方的Diffie-Hellman公钥，它们存储在Turms AMT智能契约中。所以现在你和另一边都计算同一个密钥，也就是PMK；但是你们都不会用PMK加密或解密任何东西——当然也不会把它发到任何地方或保存起来。</p><p id="415f" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">相反，您使用PMK来计算PTK(成对瞬时密钥)，它仅用于加密/解密单个消息。您通过创建PMK和您的以太坊地址、另一端的以太坊地址以及从发送端发送的消息数量的散列来计算PTK。对于收到的每条消息，你们都计算相同的PTK，它可用于加密和解密一条消息。这就是我们如何实现“完美的前向保密”——即使用于加密一条消息的PTK以某种方式被黑客攻击，或者被故意泄露——仍然不可能解密在相同的两方之间发送的任何其他消息。</p><h2 id="57f6" class="kp kq ht bd kr ks kt ku kv kw kx ky kz jb la lb lc jf ld le lf jj lg lh li lj dt translated">限制</h2><p id="1edb" class="pw-post-body-paragraph iq ir ht is b it lk iv iw ix ll iz ja jb lm jd je jf ln jh ji jj lo jl jm jn hm dt translated">在严格的完美前向保密中，发送方和接收方有必要为每个“会话”使用新的值<code class="eh lz ma mb lr b"><strong class="is hu">p</strong></code>和<code class="eh lz ma mb lr b"><strong class="is hu">g</strong></code>。但这在Turms AMT中不可行，因为发送方和接收方之间没有握手。这种严格的完美前向保密的额外安全性只有在有多个“会话”的情况下才有意义，因为它保护一个会话，即使暴露了不同会话的PMK。Turms AMT实施的<em class="lp">完美前向保密协议</em>仅在不同消息的<em class="lp"> PTK </em>被暴露时保护该消息。这与能够在不损害任何其他信息的情况下暴露个人信息的PTK的预期目标是一致的。这种限制强调了保持您的Ethereum私钥安全的重要性。</p><h2 id="9a2e" class="kp kq ht bd kr ks kt ku kv kw kx ky kz jb la lb lc jf ld le lf jj lg lh li lj dt translated">摘要</h2><p id="85ed" class="pw-post-body-paragraph iq ir ht is b it lk iv iw ix ll iz ja jb lm jd je jf ln jh ji jj lo jl jm jn hm dt translated">Turms AMT允许您在以太网地址之间发送加密消息。它现在在ipfs上发布:<br/><a class="ae jo" href="https://cloudflare-ipfs.com/ipns/messagetransport.turmsanonymous.io/" rel="noopener ugc nofollow" target="_blank">https://cloudflare-ipfs . com/ipns/message transport . turmsanonymous . io/</a><br/>或<br/><a class="ae jo" href="https://ipfs.io/ipns/messagetransport.turmsanonymous.io/" rel="noopener ugc nofollow" target="_blank">https://ipfs.io/ipns/messagetransport.turmsanonymous.io/</a><br/>请讲，给我发个信息——我的以太网地址是imontoya.eth，我很乐意听到你的消息！</p><p id="06c6" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">Alejandro Diaz</p><blockquote class="md"><p id="c860" class="me mf ht bd mg mh mi mj mk ml mm jn ek translated"><a class="ae jo" href="https://coincodecap.com/?utm_source=coinmonks" rel="noopener ugc nofollow" target="_blank">直接在您的收件箱中获取最佳软件交易</a></p></blockquote><figure class="mo mp mq mr ms ju fe ff paragraph-image"><a href="https://coincodecap.com/?utm_source=coinmonks"><div class="fe ff mn"><img src="../Images/7c0b3dfdcbfea594cc0ae7d4f9bf6fcb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1168/format:webp/0*OJ-qb5G6i863msBB.png"/></div></a></figure></div></div>    
</body>
</html>