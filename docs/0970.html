<html>
<head>
<title>Building an Epaper Badge with a Raspberry PI Zero</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用树莓PI零构建Epaper徽章</h1>
<blockquote>原文：<a href="https://medium.com/coinmonks/building-an-epaper-badge-with-a-raspberry-pi-zero-e4b98b3311c3?source=collection_archive---------1-----------------------#2018-07-08">https://medium.com/coinmonks/building-an-epaper-badge-with-a-raspberry-pi-zero-e4b98b3311c3?source=collection_archive---------1-----------------------#2018-07-08</a></blockquote><div><div class="ef hh hi hj hk hl"/><div class="hm hn ho hp hq"><div class=""/><figure class="fi fk ir is it iu fe ff paragraph-image"><div role="button" tabindex="0" class="iv iw di ix bf iy"><div class="fe ff iq"><img src="../Images/42d95c9ca6e062b656a618b8cf21bfeb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*J6wp-VIGFjR9EnLuyuux5Q.jpeg"/></div></div></figure><p id="c5b2" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">在过去的几年里，我一直想为Defcon制作一个电子徽章，今年我终于做到了。不幸的是，在构建过程中，我没有保留实际的日志，所以这将在关键部分丢失图像。这个概述假设读者有焊接、python、linux和raspberry pi的经验。</p></div><div class="ab cl jz ka hb kb" role="separator"><span class="kc bw bk kd ke kf"/><span class="kc bw bk kd ke kf"/><span class="kc bw bk kd ke"/></div><div class="hm hn ho hp hq"><h1 id="3654" class="kg kh ht bd ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld dt translated"><strong class="ak">零件清单</strong></h1><ul class=""><li id="0f45" class="le lf ht jd b je lg ji lh jm li jq lj ju lk jy ll lm ln lo dt translated">树莓派零，我用了一个零W，一个标准的零也可以。<a class="ae lp" href="https://www.amazon.com/Raspberry-Zero-v1-3-Development-Board/dp/B01L3IU6XS" rel="noopener ugc nofollow" target="_blank">https://www . Amazon . com/Raspberry-Zero-v1-3-Development-Board/DP/b 01 L3 iu6xs</a></li><li id="3a82" class="le lf ht jd b je lq ji lr jm ls jq lt ju lu jy ll lm ln lo dt translated">树莓皮零头引脚，或购买一个树莓皮零套件来与这些。<a class="ae lp" href="https://www.amazon.com/Break-away-2x20-pin-Strip-Header-Raspberry/dp/B0756KM7CY" rel="noopener ugc nofollow" target="_blank">https://www . Amazon . com/Break-away-2x 20-pin-Strip-Header-Raspberry/DP/b 0756km 7 cy</a></li><li id="ff6e" class="le lf ht jd b je lq ji lr jm ls jq lt ju lu jy ll lm ln lo dt translated">Waveshare 3彩色E-Ink显示器，还有其他类似的显示器，我不知道它们与我编写的python代码配合得如何。<a class="ae lp" href="https://www.amazon.com/gp/product/B07DH6HLCK" rel="noopener ugc nofollow" target="_blank">https://www.amazon.com/gp/product/B07DH6HLCK</a></li><li id="5351" class="le lf ht jd b je lq ji lr jm ls jq lt ju lu jy ll lm ln lo dt translated">皮莫尔尼按钮垫，<a class="ae lp" href="https://shop.pimoroni.com/products/button-shim" rel="noopener ugc nofollow" target="_blank">https://shop.pimoroni.com/products/button-shim</a></li><li id="3846" class="le lf ht jd b je lq ji lr jm ls jq lt ju lu jy ll lm ln lo dt translated"><a class="ae lp" href="https://www.amazon.com/gp/product/B01KTG03M4" rel="noopener ugc nofollow" target="_blank">树莓派零案，</a>https://www.amazon.com/gp/product/B01KTG03M4</li><li id="7078" class="le lf ht jd b je lq ji lr jm ls jq lt ju lu jy ll lm ln lo dt translated">自粘皮带夹，<a class="ae lp" href="https://www.amazon.com/gp/product/B00HUV8FWW" rel="noopener ugc nofollow" target="_blank">https://www.amazon.com/gp/product/B00HUV8FWW</a></li></ul><h1 id="ed9d" class="kg kh ht bd ki kj lv kl km kn lw kp kq kr lx kt ku kv ly kx ky kz lz lb lc ld dt translated">其他零件和工具</h1><ul class=""><li id="58f5" class="le lf ht jd b je lg ji lh jm li jq lj ju lk jy ll lm ln lo dt translated">烙铁</li><li id="c66e" class="le lf ht jd b je lq ji lr jm ls jq lt ju lu jy ll lm ln lo dt translated">焊接辅助手</li><li id="220c" class="le lf ht jd b je lq ji lr jm ls jq lt ju lu jy ll lm ln lo dt translated">焊料</li><li id="c594" class="le lf ht jd b je lq ji lr jm ls jq lt ju lu jy ll lm ln lo dt translated">USB微型电缆</li><li id="d0d7" class="le lf ht jd b je lq ji lr jm ls jq lt ju lu jy ll lm ln lo dt translated">USB电池</li><li id="261a" class="le lf ht jd b je lq ji lr jm ls jq lt ju lu jy ll lm ln lo dt translated">MicroSD卡</li><li id="8512" class="le lf ht jd b je lq ji lr jm ls jq lt ju lu jy ll lm ln lo dt translated">向MicroSD卡写入的一些方法</li></ul></div><div class="ab cl jz ka hb kb" role="separator"><span class="kc bw bk kd ke kf"/><span class="kc bw bk kd ke kf"/><span class="kc bw bk kd ke"/></div><div class="hm hn ho hp hq"><h1 id="38c3" class="kg kh ht bd ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld dt translated">安装接头销</h1><p id="1772" class="pw-post-body-paragraph jb jc ht jd b je lg jg jh ji lh jk jl jm ma jo jp jq mb js jt ju mc jw jx jy hm dt translated">Pi零点通常没有安装接头引脚，因此第一步是焊接引脚。</p><h1 id="212b" class="kg kh ht bd ki kj lv kl km kn lw kp kq kr lx kt ku kv ly kx ky kz lz lb lc ld dt translated">安装按钮垫片</h1><p id="f1be" class="pw-post-body-paragraph jb jc ht jd b je lg jg jh ji lh jk jl jm ma jo jp jq mb js jt ju mc jw jx jy hm dt translated">现在，随着引脚安装，翻转Pi和焊接按钮垫片上。请务必保持针的顶部清洁，因为E-Ink屏幕需要在此之上。</p><h1 id="9770" class="kg kh ht bd ki kj lv kl km kn lw kp kq kr lx kt ku kv ly kx ky kz lz lb lc ld dt translated">安装树莓Pi零机箱</h1><p id="9d9f" class="pw-post-body-paragraph jb jc ht jd b je lg jg jh ji lh jk jl jm ma jo jp jq mb js jt ju mc jw jx jy hm dt translated">只安装下半部分的情况下，屏幕将不适合与上半部分安装。</p><h1 id="bb9d" class="kg kh ht bd ki kj lv kl km kn lw kp kq kr lx kt ku kv ly kx ky kz lz lb lc ld dt translated">安装电子输入屏幕</h1><p id="63e0" class="pw-post-body-paragraph jb jc ht jd b je lg jg jh ji lh jk jl jm ma jo jp jq mb js jt ju mc jw jx jy hm dt translated">拿起屏幕，放在标题引脚上，按下。</p><h1 id="1834" class="kg kh ht bd ki kj lv kl km kn lw kp kq kr lx kt ku kv ly kx ky kz lz lb lc ld dt translated">下载并安装Raspbian</h1><p id="a12f" class="pw-post-body-paragraph jb jc ht jd b je lg jg jh ji lh jk jl jm ma jo jp jq mb js jt ju mc jw jx jy hm dt translated">下载最新版的Raspbian，还有其他的发行版，应该都一样好用，我选Raspbian。此外，由于我使用了零I设置wifi和ssh进行远程访问。</p><h1 id="94b4" class="kg kh ht bd ki kj lv kl km kn lw kp kq kr lx kt ku kv ly kx ky kz lz lb lc ld dt translated">下载Waveshare依赖项</h1><p id="b59f" class="pw-post-body-paragraph jb jc ht jd b je lg jg jh ji lh jk jl jm ma jo jp jq mb js jt ju mc jw jx jy hm dt translated">基于<a class="ae lp" href="https://www.waveshare.com/wiki/Pioneer600#Libraries_Installation_for_RPi" rel="noopener ugc nofollow" target="_blank">https://www . wave share . com/wiki/pioneer 600 # Libraries _ Installation _ for _ RPi</a>首先安装必要的软件包，在最新版本的raspbian下，他们提到的所有库都可以在os repository的软件包中找到。</p><pre class="md me mf mg fq mh mi mj mk aw ml dt"><span id="8c3b" class="mm kh ht mi b fv mn mo l mp mq">sudo apt-get update &amp;&amp; sudo apt-get install python-dev python-smbus python-serial python-imaging python-rpi.gpio wiringpi python-spidev fonts-freefont-ttf</span></pre><h1 id="7088" class="kg kh ht bd ki kj lv kl km kn lw kp kq kr lx kt ku kv ly kx ky kz lz lb lc ld dt translated">下载按钮依赖项</h1><p id="900e" class="pw-post-body-paragraph jb jc ht jd b je lg jg jh ji lh jk jl jm ma jo jp jq mb js jt ju mc jw jx jy hm dt translated">皮莫罗尼的团队让这一步变得非常非常简单，运行以下代码</p><pre class="md me mf mg fq mh mi mj mk aw ml dt"><span id="ff6c" class="mm kh ht mi b fv mn mo l mp mq">curl <a class="ae lp" href="https://get.pimoroni.com/buttonshim" rel="noopener ugc nofollow" target="_blank">https://get.pimoroni.com/buttonshim</a> | bash</span></pre><p id="1257" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">这将安装提供装饰的python buttonshim库</p><h1 id="ab9c" class="kg kh ht bd ki kj lv kl km kn lw kp kq kr lx kt ku kv ly kx ky kz lz lb lc ld dt translated">启用接口</h1><p id="eeed" class="pw-post-body-paragraph jb jc ht jd b je lg jg jh ji lh jk jl jm ma jo jp jq mb js jt ju mc jw jx jy hm dt translated">运行raspi-config命令，选择接口选项，然后启用SPI I2C串行</p><p id="542f" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">然后重启你的Pi</p><h1 id="5259" class="kg kh ht bd ki kj lv kl km kn lw kp kq kr lx kt ku kv ly kx ky kz lz lb lc ld dt translated">测试硬件</h1><p id="79e2" class="pw-post-body-paragraph jb jc ht jd b je lg jg jh ji lh jk jl jm ma jo jp jq mb js jt ju mc jw jx jy hm dt translated">首先查看屏幕，从<a class="ae lp" href="https://www.waveshare.com/wiki/File:2.13inch-e-paper-hat-b-code.7z" rel="noopener ugc nofollow" target="_blank">https://www . waveshare . com/wiki/File:2.13 inch-e-paper-hat-b-code . 7z</a>下载wave share演示</p><p id="ab44" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">解压缩档案，导航到raspberry pi演示，运行演示，如果一切正常，屏幕应该会循环显示一些图像</p><p id="b35d" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">接下来检查buttonshim，从<a class="ae lp" href="https://github.com/pimoroni/button-shim/blob/master/examples/rainbow.py" rel="noopener ugc nofollow" target="_blank">https://github . com/pimoroni/button-shim/blob/master/examples/rainbow . py</a>下载演示代码</p><p id="05d3" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">运行它，按几个按钮，看着led改变颜色。</p><h1 id="62b5" class="kg kh ht bd ki kj lv kl km kn lw kp kq kr lx kt ku kv ly kx ky kz lz lb lc ld dt translated">安装徽章代码</h1><p id="5228" class="pw-post-body-paragraph jb jc ht jd b je lg jg jh ji lh jk jl jm ma jo jp jq mb js jt ju mc jw jx jy hm dt translated">假设所有硬件都按预期运行，是时候编写自己的徽章代码，或者安装我编写的代码了。</p><p id="b08a" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">将<a class="ae lp" href="https://github.com/jheise/ebadge/blob/master/badge.py" rel="noopener ugc nofollow" target="_blank">https://github.com/jheise/ebadge/blob/master/badge.py</a>下载到epaper屏幕演示代码所在的目录中，有许多库不能在系统范围内访问，这是利用它们的最快方法。</p><p id="324e" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">下一次运行“sudo mkdir-p/var/badge/images ”,/ var/badge是存储徽章所有数据的位置。使用您选择的文本编辑器open/var/badge/smooths . txt，这是一个制表符分隔的文件，包含徽章上显示的所有文本，需要按如下方式书写行:</p><p id="52c7" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">"不服从<tab>【比例|静态|任意】<tab>【居中|静态|任意】"</tab></tab></p><p id="20f7" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">在上面的例子中，第一个字段是要显示的标语；下一个字段确定文本是应该缩放、不缩放还是随机选择；最后一个字段决定文本是应该居中、总是左对齐还是随机选择。此外，可以通过将字符串中的第一个字符设为“#”来注释掉行。</p><p id="9987" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">一旦标语准备好了，是时候添加一些图像了，屏幕上的图像必须是分辨率为104 x 212的位图形式，图像也必须只使用黑白，因为图像可以作为翻转像素的遮罩。脚本中的图像加载功能将只加载黑白图像，但是屏幕完全能够加载两个单独的位图，它们匹配在一起形成一个三色图像。将您制作的任何图像放在/var/badge/images中</p><p id="e82d" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">给脚本一个快速的测试运行，确保至少一个口号和一个图像加载后再继续。</p><h1 id="7a57" class="kg kh ht bd ki kj lv kl km kn lw kp kq kr lx kt ku kv ly kx ky kz lz lb lc ld dt translated">启动时启动徽章脚本</h1><p id="a1d1" class="pw-post-body-paragraph jb jc ht jd b je lg jg jh ji lh jk jl jm ma jo jp jq mb js jt ju mc jw jx jy hm dt translated">有很多方法可以处理这个问题，我使用这个方法是因为我对处理init脚本或systemd或raspbian在启动时使用的任何方法都不感兴趣</p><p id="5b87" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">首先将python目录从您下载badge脚本的演示中移走，将/var/badge与其余文件一起移走</p><p id="f5d9" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">使用您最喜欢的文本编辑器打开/home/pi/launcher.sh，编写以下代码</p><pre class="md me mf mg fq mh mi mj mk aw ml dt"><span id="cff5" class="mm kh ht mi b fv mn mo l mp mq">#!/bin/sh<br/>echo "Launcher starting..."<br/>cd /<br/>cd /var/badge/python<br/>echo "sleeping for 20 seconds while spi interface comes up"<br/>sleep 20<br/>/usr/bin/python badge.py<br/>cd /</span></pre><p id="6485" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">使脚本可执行，然后使用以下命令将其添加到root的crontab中</p><pre class="md me mf mg fq mh mi mj mk aw ml dt"><span id="1a50" class="mm kh ht mi b fv mn mo l mp mq">@reboot sh /home/pi/launcher.sh &gt; /home/pi/logs 2&gt;&amp;1</span></pre><p id="d184" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">现在重新启动，看看它是否工作。</p></div><div class="ab cl jz ka hb kb" role="separator"><span class="kc bw bk kd ke kf"/><span class="kc bw bk kd ke kf"/><span class="kc bw bk kd ke"/></div><div class="hm hn ho hp hq"><h1 id="d06a" class="kg kh ht bd ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld dt translated">加分:使用Pi Zero的USB小工具模式</h1><p id="6878" class="pw-post-body-paragraph jb jc ht jd b je lg jg jh ji lh jk jl jm ma jo jp jq mb js jt ju mc jw jx jy hm dt translated">到目前为止，徽章应该已经通电，并在没有人类交互的情况下更改文本和图像，但当你想更改标语或添加图像时，你要么需要网络连接，要么将sd卡弹出并直接写入。幸运的是，raspberry pi zero还可以充当大容量存储设备，通过这种设置，你只需要将徽章插入计算机，然后通过usb编辑任何代码、文本或图像。这些说明改编自<a class="ae lp" href="https://www.raspberrypi.org/magpi/pi-zero-w-smart-usb-flash-drive/" rel="noopener ugc nofollow" target="_blank">https://www . raspberrypi . org/magpi/pi-zero-w-smart-USB-flash-drive/</a></p><p id="16bd" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">首先将/var/badge移动到/var/badge.bak，新的分区将被挂载到/var/badge。</p><p id="7945" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">接下来，我们需要为新部件分配一些空间，在其上放置一个文件系统，并创建挂载点</p><pre class="md me mf mg fq mh mi mj mk aw ml dt"><span id="5458" class="mm kh ht mi b fv mn mo l mp mq">sudo dd of=/var/badgefs.bin if=/dev/zero bs=1M count=2048<br/>sudo mkdosfs /var/badgefs.bin -F 32 -I<br/>sudo mkdir /var/badge</span></pre><p id="b6f1" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">现在用您喜欢的文本编辑器在/etc/fstab中创建条目</p><pre class="md me mf mg fq mh mi mj mk aw ml dt"><span id="1c34" class="mm kh ht mi b fv mn mo l mp mq">/var/badgefs.bin /var/badge vfat users,umask=000 0 2</span></pre><p id="04bc" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">将分区装回，并将/var/badge.bak的内容复制到新版本中</p><pre class="md me mf mg fq mh mi mj mk aw ml dt"><span id="79b2" class="mm kh ht mi b fv mn mo l mp mq">sudo mount /var/badge<br/>cp -r /var/badge.bak/* /var/badge</span></pre><p id="665f" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">要真正打开USB大容量存储功能，需要启用几个不同的模块。</p><p id="cc4e" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">首先启用USB覆盖驱动，用你喜欢的文本编辑器打开/boot/config.txt，在底部添加</p><pre class="md me mf mg fq mh mi mj mk aw ml dt"><span id="5fb0" class="mm kh ht mi b fv mn mo l mp mq">dtoverlay=dwc2</span></pre><p id="85ce" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">然后打开/etc/modules，在底部添加以下内容</p><pre class="md me mf mg fq mh mi mj mk aw ml dt"><span id="2c16" class="mm kh ht mi b fv mn mo l mp mq">dwc2</span></pre><p id="06a7" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">现在，为了使分区在USB上可用，将这一行添加到/etc/rc.local中，这一行需要在文件末尾的<code class="eh mr ms mt mi b">exit 0</code>之上</p><pre class="md me mf mg fq mh mi mj mk aw ml dt"><span id="9b24" class="mm kh ht mi b fv mn mo l mp mq">modprobe g_mass_storage file=/var/badgefs.bin removable=1 ro=0 stall=0</span></pre><p id="fbb9" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">现在将pi直接插入计算机，看看它是否可以安装。我只在Ubuntu 18.04桌面版和MacOS上测试过，我不确定在Windows下是否会有问题</p></div></div>    
</body>
</html>