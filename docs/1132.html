<html>
<head>
<title>Ethereum DAPP (REST API) on AWS Lambda using Node.JS, Web3 Beta and Infura</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用节点的AWS Lambda上的以太坊DAPP (REST API)。JS、Web3 Beta和Infura</h1>
<blockquote>原文：<a href="https://medium.com/coinmonks/deploying-ethereum-dapp-rest-api-on-aws-lambda-using-node-js-web3-beta-and-infura-513cc92a9de5?source=collection_archive---------1-----------------------#2018-07-25">https://medium.com/coinmonks/deploying-ethereum-dapp-rest-api-on-aws-lambda-using-node-js-web3-beta-and-infura-513cc92a9de5?source=collection_archive---------1-----------------------#2018-07-25</a></blockquote><div><div class="ef hh hi hj hk hl"/><div class="hm hn ho hp hq"><div class=""/><p id="854b" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">代币是一种新的在线支付方式，将成为金融科技公司的未来。</p><p id="b5e5" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">在这篇文章中，我将展示如何构建简单的DAPP来发送令牌到不同的钱包。</p><h1 id="cf20" class="jo jp ht bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl dt translated">先决条件</h1><p id="b43b" class="pw-post-body-paragraph iq ir ht is b it km iv iw ix kn iz ja jb ko jd je jf kp jh ji jj kq jl jm jn hm dt translated">A.Visual Studio代码—<a class="ae kr" href="https://code.visualstudio.com/" rel="noopener ugc nofollow" target="_blank">https://code.visualstudio.com/</a></p><p id="99eb" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">B.节点。JS(v 8.10)——<a class="ae kr" href="https://nodejs.org/en/" rel="noopener ugc nofollow" target="_blank">https://nodejs.org/en/</a></p><p id="80d1" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">C.Metamask —请点击此链接了解如何安装(<a class="ae kr" rel="noopener" href="/@followcoin/how-to-install-metamask-88cbdabc1d28">https://medium . com/@ follow coin/how-to-install-meta mask-88 CBD abc1 d 28</a>)</p><p id="2e3d" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">D.AWS帐户—创建AWS帐户<a class="ae kr" href="https://aws.amazon.com/" rel="noopener ugc nofollow" target="_blank">(https://aws.amazon.com/</a>)。我们需要IAM(创建API密钥，确保使用基于up文档的自定义策略)</p><p id="ba6d" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">E.APEX Up——按照本文件(<a class="ae kr" href="https://up.docs.apex.sh/" rel="noopener ugc nofollow" target="_blank">https://up.docs.apex.sh/</a>)安装Up命令。要了解更多关于使用Up命令的信息，请点击此链接。(<a class="ae kr" href="https://medium.freecodecamp.org/up-b3db1ca930ee" rel="noopener ugc nofollow" target="_blank">https://medium.freecodecamp.org/up-b3db1ca930ee</a>)。</p><h1 id="b146" class="jo jp ht bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl dt translated">启动项目工作环境</h1><p id="a2ba" class="pw-post-body-paragraph iq ir ht is b it km iv iw ix kn iz ja jb ko jd je jf kp jh ji jj kq jl jm jn hm dt translated">打开Visual Studio代码，然后打开要创建DAPP的文件夹。然后，创建类似下图的文件夹:</p><figure class="kt ku kv kw fq kx fe ff paragraph-image"><div class="fe ff ks"><img src="../Images/1ffa9a0e38fe0eab35c7dd173e613750.png" data-original-src="https://miro.medium.com/v2/resize:fit:1108/format:webp/1*L4ETmCCaynudkroMBphQDQ.png"/></div></figure><p id="6d77" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">按<code class="eh la lb lc ld b">Ctrl + `</code>(反勾)显示终端窗口。然后，运行下面的命令来创建<code class="eh la lb lc ld b">package.json</code>。</p><pre class="kt ku kv kw fq le ld lf lg aw lh dt"><span id="17ef" class="li jp ht ld b fv lj lk l ll lm">npm init</span></pre><p id="4229" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">然后，按照向导初始化您的package.json，应该会看到类似下面的内容:</p><figure class="kt ku kv kw fq kx fe ff paragraph-image"><div class="fe ff ln"><img src="../Images/269793b4d0e6984f02353d4376d59092.png" data-original-src="https://miro.medium.com/v2/resize:fit:1382/format:webp/1*FFVhqc5IV-v7EPsYidg8pA.png"/></div></figure><p id="2a70" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">确保<code class="eh la lb lc ld b">entry point</code>是<code class="eh la lb lc ld b">app.js</code>。之后，您应该会看到类似的下图:</p><pre class="kt ku kv kw fq le ld lf lg aw lh dt"><span id="3f8c" class="li jp ht ld b fv lj lk l ll lm">{<br/>  "name": "web3betainfuralambda",<br/>  "version": "1.0.0",<br/>  "description": "Sample DAPP to be deployed in Lambda.",<br/>  "main": "app.js",<br/>  "directories": {<br/>    "lib": "lib"<br/>  },<br/>  "scripts": {<br/>    "test": "node ./node_modules/cucumber/bin/cucumber-js",<br/>    "start": "node app"<br/>  },<br/>  "repository": {<br/>    "type": "git",<br/>    "url": "git+<a class="ae kr" href="https://github.com/abcamitan/web3BetaInfuraLambda.git" rel="noopener ugc nofollow" target="_blank">https://github.com/abcamitan/web3BetaInfuraLambda.git</a>"<br/>  },<br/>  "keywords": [<br/>    "Node.JS",<br/>    "Web3",<br/>    "Lambda",<br/>    "Infura",<br/>    "Ethereum"<br/>  ],<br/>  "author": "Aries Camitan",<br/>  "license": "MIT",<br/>  "bugs": {<br/>    "url": "<a class="ae kr" href="https://github.com/abcamitan/web3BetaInfuraLambda/issues" rel="noopener ugc nofollow" target="_blank">https://github.com/abcamitan/web3BetaInfuraLambda/issues</a>"<br/>  },<br/>  "homepage": "<a class="ae kr" href="https://github.com/abcamitan/web3BetaInfuraLambda#readme" rel="noopener ugc nofollow" target="_blank">https://github.com/abcamitan/web3BetaInfuraLambda#readme</a>"<br/>}</span></pre><h1 id="544e" class="jo jp ht bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl dt translated">创建智能合同</h1><p id="bf5a" class="pw-post-body-paragraph iq ir ht is b it km iv iw ix kn iz ja jb ko jd je jf kp jh ji jj kq jl jm jn hm dt translated">首先，我们需要创建合同并部署到Rinkeby network。</p><p id="4ce3" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">下面是一个关于如何创建智能合同以及如何部署到以太网的很好的教程，从那篇文章中我复制了智能合同代码。</p><div class="lo lp fm fo lq lr"><a href="https://medium.freecodecamp.org/how-to-write-and-deploy-your-first-smart-contract-341d5e2ffb35" rel="noopener  ugc nofollow" target="_blank"><div class="ls ab ej"><div class="lt ab lu cl cj lv"><h2 class="bd hu fv z el lw eo ep lx er et hs dt translated">如何编写和部署您的第一份智能合同</h2><div class="ly l"><h3 class="bd b fv z el lw eo ep lx er et ek translated">自从以太坊在2015年年中的出现为加密领域增光添彩以来，这项革命性的发明由…</h3></div><div class="lz l"><p class="bd b gc z el lw eo ep lx er et ek translated">medium.freecodecamp.org</p></div></div><div class="ma l"><div class="mb l mc md me ma mf ky lr"/></div></div></a></div><p id="435b" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">转到<code class="eh la lb lc ld b"><a class="ae kr" href="https://remix.ethereum.org" rel="noopener ugc nofollow" target="_blank">https://remix.ethereum.org</a></code> <a class="ae kr" href="https://remix.ethereum.org" rel="noopener ugc nofollow" target="_blank">，</a>然后复制并编译下面的智能合同代码。</p><pre class="kt ku kv kw fq le ld lf lg aw lh dt"><span id="bc4a" class="li jp ht ld b fv lj lk l ll lm">pragma solidity ^0.4.21; //tells that the source code is written for Solidity version 0.4.21 or anything newer that does not break functionality</span><span id="ac06" class="li jp ht ld b fv mg lk l ll lm">contract aexToken {<br/> // The keyword “public” makes those variables readable from outside.<br/> <br/> address public minter;<br/> <br/> // Events allow light clients to react on changes efficiently.<br/> mapping (address =&gt; uint) public balances;<br/> <br/> // This is the constructor whose code is run only when the contract is created<br/> event Sent(address from, address to, uint amount);<br/> <br/> constructor() public {<br/> <br/> minter = msg.sender;<br/> <br/> }<br/> <br/> function mint(address receiver, uint amount) public {<br/> <br/> if(msg.sender != minter) return;<br/> balances[receiver]+=amount;<br/> <br/> }<br/> <br/> function send(address receiver, uint amount) public {<br/> if(balances[msg.sender] &lt; amount) return;<br/> balances[msg.sender]-=amount;<br/> balances[receiver]+=amount;<br/> emit Sent(msg.sender, receiver, amount);<br/> <br/> }<br/>}</span></pre><figure class="kt ku kv kw fq kx fe ff paragraph-image"><div role="button" tabindex="0" class="mi mj di mk bf ml"><div class="fe ff mh"><img src="../Images/703d8768c8a1a868a91d55b54ae51b4e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4aMIEuTHPCe0almHdyR6fA.png"/></div></div></figure><p id="cb91" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">然后，我们需要获得编译后的契约的输出，这是json格式的ABI。要获取，点击<em class="mm">详情</em>按钮。</p><figure class="kt ku kv kw fq kx fe ff paragraph-image"><div role="button" tabindex="0" class="mi mj di mk bf ml"><div class="fe ff mh"><img src="../Images/ba13459490174fb4aa9b4f08526126f4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*krTgP42z19ElCz_d-lsAfQ.png"/></div></div></figure><p id="1f51" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">然后，寻找ABI，然后点击<em class="mm">复制</em>按钮。</p><figure class="kt ku kv kw fq kx fe ff paragraph-image"><div role="button" tabindex="0" class="mi mj di mk bf ml"><div class="fe ff mn"><img src="../Images/137319de0da2d1e9e73c2fa8f73dd72d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*AGU7Chv1VwwBTQ_SsdpRjA.png"/></div></div></figure><p id="fed2" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">之后，将其粘贴到<code class="eh la lb lc ld b">abi.json</code> <em class="mm"> </em>文件中，然后保存。</p><figure class="kt ku kv kw fq kx fe ff paragraph-image"><div role="button" tabindex="0" class="mi mj di mk bf ml"><div class="fe ff mo"><img src="../Images/b8920acb3efd2000da15d13844eebe6a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*29wnedpej_8Mt3RdETHHFA.png"/></div></div></figure><h1 id="34d4" class="jo jp ht bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl dt translated">将合同部署到Rinkeby测试网络</h1><p id="3dfd" class="pw-post-body-paragraph iq ir ht is b it km iv iw ix kn iz ja jb ko jd je jf kp jh ji jj kq jl jm jn hm dt translated">我假设你已经安装了超能面具，而且你的钱包里有乙醚。</p><p id="d929" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">要部署已编译的智能合同，请转到<em class="mm">运行</em>选项卡，然后单击<em class="mm">部署</em>按钮。</p><figure class="kt ku kv kw fq kx fe ff paragraph-image"><div role="button" tabindex="0" class="mi mj di mk bf ml"><div class="fe ff mp"><img src="../Images/dc42cdf34d770dee70c208200339dc33.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Na_iCnMxkGmHkLE4lGdJEg.png"/></div></div></figure><p id="35eb" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">将弹出元掩码确认窗口。然后，点击<em class="mm">确认</em>按钮，按照向导进行操作，直到部署完成。</p><figure class="kt ku kv kw fq kx fe ff paragraph-image"><div role="button" tabindex="0" class="mi mj di mk bf ml"><div class="fe ff mq"><img src="../Images/8e00055db868f966ed1969a958772e0d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*c-m_mvKronvy1G3Mg06Dtw.png"/></div></div></figure><p id="757e" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">在元掩码中确认事务后，单击该事务。</p><figure class="kt ku kv kw fq kx fe ff paragraph-image"><div class="fe ff mr"><img src="../Images/695cc6455a21b64895507bafbdd899a4.png" data-original-src="https://miro.medium.com/v2/resize:fit:914/format:webp/1*YZWqzU1X5-ihBrrcg_Eq4A.png"/></div></figure><p id="c5a9" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">您将在etherscan交易详情中看到您的合同已成功创建。现在，我们需要复制合同地址并保存在某个地方以备后用。</p><figure class="kt ku kv kw fq kx fe ff paragraph-image"><div role="button" tabindex="0" class="mi mj di mk bf ml"><div class="fe ff ms"><img src="../Images/5f52f3e3837b32e5f7de1c165d778e17.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZIxNNAFhdVxYcdkXy9GB3g.png"/></div></div></figure><h1 id="31e3" class="jo jp ht bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl dt translated">从Infura获取API密钥</h1><p id="f35c" class="pw-post-body-paragraph iq ir ht is b it km iv iw ix kn iz ja jb ko jd je jf kp jh ji jj kq jl jm jn hm dt translated">如果您没有Infura帐户，请立即前往<code class="eh la lb lc ld b"><a class="ae kr" href="https://infura.io/" rel="noopener ugc nofollow" target="_blank">https://infura.io/</a></code>注册。之后，登录你的邮箱，验证你的Infura账号。然后，点击<em class="mm">了解INFURA如何工作</em>按钮并进入向导过程或选择<em class="mm">跳过</em>。</p><figure class="kt ku kv kw fq kx fe ff paragraph-image"><div class="fe ff mt"><img src="../Images/5b657c34996d13c9c7e2243866cc1cbc.png" data-original-src="https://miro.medium.com/v2/resize:fit:950/format:webp/1*bNfruJlzo2Yhk0Kd3TZ-wA.png"/></div></figure><p id="4b8f" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">按下<em class="mm"> OK，我们走</em>按钮。</p><figure class="kt ku kv kw fq kx fe ff paragraph-image"><div class="fe ff mu"><img src="../Images/44affa49ddc686718789d843ec64e8c0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1248/format:webp/1*sMPW4jLjYUFtcv0TJVOYhw.png"/></div></figure><p id="6650" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">然后，点击<em class="mm">创建新项目</em>。</p><figure class="kt ku kv kw fq kx fe ff paragraph-image"><div class="fe ff mv"><img src="../Images/1f1ba72118d8417087719c880252f325.png" data-original-src="https://miro.medium.com/v2/resize:fit:1362/format:webp/1*u96NYHAIOAWNMMjxBbxSQw.png"/></div></figure><p id="366b" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">接下来，给你的项目命名，然后点击<em class="mm">创建项目</em>按钮。</p><figure class="kt ku kv kw fq kx fe ff paragraph-image"><div class="fe ff mw"><img src="../Images/048d36a5173f5b3951f3945ed1475ae4.png" data-original-src="https://miro.medium.com/v2/resize:fit:976/format:webp/1*krzs44PwmrsXCs22bnnf2Q.png"/></div></figure><p id="232c" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">然后，在端点下选择RINKEBY。然后，给出您之前在智能合约部署中保留的合约地址。最后，点击<em class="mm">添加</em>按钮。</p><figure class="kt ku kv kw fq kx fe ff paragraph-image"><div role="button" tabindex="0" class="mi mj di mk bf ml"><div class="fe ff mx"><img src="../Images/d5f7cc513db9b9c81c84c1a99c75cdd7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Bwyjgk_ihQmJueSrDFmpOA.png"/></div></div></figure><p id="a5fb" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">然后，复制端点并保存在某个地方，我们将在稍后创建DAPP时使用它。</p><figure class="kt ku kv kw fq kx fe ff paragraph-image"><div role="button" tabindex="0" class="mi mj di mk bf ml"><div class="fe ff my"><img src="../Images/45e5eca3d0c3eb1a4aa3a73caf9fbcd0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NKRJIFxd8zdqydGccEH5oA.png"/></div></div></figure><h1 id="0995" class="jo jp ht bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl dt translated">创建DAPP应用程序</h1><p id="f2d1" class="pw-post-body-paragraph iq ir ht is b it km iv iw ix kn iz ja jb ko jd je jf kp jh ji jj kq jl jm jn hm dt translated">在我们开始编码之前，请注意我不会在这篇文章中涉及任何安全问题。我让您决定如何保护您的代码和服务器。</p><p id="01b1" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">首先，我们需要运行下面的命令来安装所有需要的节点模块。</p><pre class="kt ku kv kw fq le ld lf lg aw lh dt"><span id="9726" class="li jp ht ld b fv lj lk l ll lm">npm install -save express body-parser cjson web3</span></pre><p id="d58d" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">通过创建<em class="mm"> app.js </em>文件来创建应用程序的主入口点。在下面输入代码并保存。</p><pre class="kt ku kv kw fq le ld lf lg aw lh dt"><span id="e386" class="li jp ht ld b fv lj lk l ll lm">const express = require('express')<br/>const bodyParser = require('body-parser')<br/>const fs = require('fs')<br/>const path = require('path')</span><span id="d65d" class="li jp ht ld b fv mg lk l ll lm">var app = express()</span><span id="cf5d" class="li jp ht ld b fv mg lk l ll lm">// Defining the port number. <br/>// It is important to set to process.env.PORT <br/>// since Lambda will define the PORT explicitly<br/>const PORT = process.env.PORT || 8080</span><span id="fc7c" class="li jp ht ld b fv mg lk l ll lm">// Supporting every type of body content type<br/>app.use(bodyParser.json())<br/>app.use(bodyParser.urlencoded({ extended: true }))</span><span id="bd7c" class="li jp ht ld b fv mg lk l ll lm">//Use below codes to automatically add your routing files (endpoints)<br/>var routes = fs.readdirSync(path.join(__dirname, '/route'))<br/>routes.forEach(routesFile =&gt; {<br/>    if (routesFile.match(/\.js$/)) {<br/>        var route = require(path.join(__dirname, '/route/', routesFile))<br/>        route(app)<br/>    }<br/>})</span><span id="8a09" class="li jp ht ld b fv mg lk l ll lm">// show the running port on console<br/>app.listen(PORT, function() {<br/>    console.log('server started on port ', PORT)<br/>})</span></pre><p id="6601" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">接下来，我们需要创建我们的路由或端点。如果还没有创建<code class="eh la lb lc ld b">route </code>文件夹，请现在创建。然后，在该文件夹中创建<code class="eh la lb lc ld b">token-route.js</code>文件，输入下面的代码并保存。</p><pre class="kt ku kv kw fq le ld lf lg aw lh dt"><span id="4dee" class="li jp ht ld b fv lj lk l ll lm">const token = require('../lib/token')<br/>function init(app) {<br/> const path = '/token'<br/> <br/> // endpoint to create token to given address<br/> app.post(path+'/mintToken', token.mint)<br/> <br/> // endpoint to transfer token from Contract<br/> // there's must be existing token inside the contract to send token<br/> // otherwise, 0 token to send to give address<br/> app.post(path+'/sendToken', token.send)<br/> <br/> // check the balance of ether and token from given address<br/> app.get(path+'/getBalance', token.balance)<br/>}<br/>module.exports = init;</span></pre><p id="7d6d" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">现在，我们将创建调用智能合约方法的功能。首先，检查<code class="eh la lb lc ld b">lib </code>文件夹是否已经存在，如果没有创建文件夹。然后，在<code class="eh la lb lc ld b">lib </code>文件夹中创建一个名为<code class="eh la lb lc ld b">token.js</code>的新文件，并复制下面的代码:</p><pre class="kt ku kv kw fq le ld lf lg aw lh dt"><span id="f2b9" class="li jp ht ld b fv lj lk l ll lm">const Web3 = require('web3')<br/>const path = require('path')<br/>const cjson = require('cjson')<br/>const TX = require('ethereumjs-tx')</span><span id="5c20" class="li jp ht ld b fv mg lk l ll lm">// contract details<br/>const provider = <a class="ae kr" href="https://rinkeby.infura.io/v3/49489982b438407ea553d0ac3dc0671b'" rel="noopener ugc nofollow" target="_blank">'https://rinkeby.infura.io/v3/49489982b438407ea553d0ac3dc0671b'</a><br/>const contractAddress = '0xff8298ae7364d0e79a502dec7d53bc19dfd6ba5f'<br/>const privateKey = new Buffer('01b83f2972df3f5f7894c3425300cd66f4617b0da748dbb25159ccd0d4568455', 'hex')<br/>const defaultAccount = '0x5fe168a1256d574cef13bc5f4e00c021183f4dbe'<br/>const etherscanLink = <a class="ae kr" href="https://rinkeby.etherscan.io/tx/'" rel="noopener ugc nofollow" target="_blank">'https://rinkeby.etherscan.io/tx/'</a></span><span id="1bf2" class="li jp ht ld b fv mg lk l ll lm">// initiate the web3<br/>const web3 = new Web3(provider)</span><span id="c6c9" class="li jp ht ld b fv mg lk l ll lm">// initiate the contract with null value<br/>var contract = null;</span><span id="1775" class="li jp ht ld b fv mg lk l ll lm">// convert Wei to Eth<br/>function convertWeiToEth( stringValue ) {<br/> if ( typeof stringValue != 'string' ) {<br/> stringValue = String( stringValue );<br/> }<br/> return web3.utils.fromWei( stringValue, 'ether' );<br/>}</span><span id="a3fa" class="li jp ht ld b fv mg lk l ll lm">// Initiate the Contract<br/>function getContract() { <br/> if (contract === null) {<br/> var abi = cjson.load(path.resolve(__dirname, '../ABI/abi.json'));<br/> var c = new web3.eth.Contract(abi,contractAddress)<br/> contract = c.clone();<br/> }<br/> console.log('Contract Initiated successfully!')<br/> return contract;<br/>}</span><span id="2a06" class="li jp ht ld b fv mg lk l ll lm">// send token to Address<br/>async function sendToken(req, res) {<br/> var address = req.body.address<br/> var tokens = Number(req.body.tokens)</span><span id="00ea" class="li jp ht ld b fv mg lk l ll lm">if (address &amp;&amp; tokens) {<br/> const rawTrans = getContract().methods.send(address, tokens) // contract method <br/> return res.send(await sendSignTransaction(rawTrans))<br/> } else {<br/> res.send({<br/> 'message':'Wallet address or no. of tokens is missing.'<br/> })<br/> }</span><span id="4b62" class="li jp ht ld b fv mg lk l ll lm">}</span><span id="8f77" class="li jp ht ld b fv mg lk l ll lm">// Mint/Create token to given address<br/>async function mintToken(req, res) {<br/> var address = req.body.address<br/> var tokens = Number(req.body.tokens)</span><span id="31db" class="li jp ht ld b fv mg lk l ll lm">if (address &amp;&amp; tokens) {<br/> const rawTrans = getContract().methods.mint(address, tokens) // contract method <br/> return res.send(await sendSignTransaction(rawTrans))<br/> } else {<br/> res.send({<br/> 'message':'Wallet address or no. of tokens is missing.'<br/> })<br/> }<br/>}</span><span id="87e4" class="li jp ht ld b fv mg lk l ll lm">// get the balance of given address<br/>async function getBalance(req, res) {<br/> var address = req.query.address<br/> if (address) {<br/> // get the Ether balance of the given address<br/> var ethBalance = convertWeiToEth( await web3.eth.getBalance(address)) || '0'</span><span id="d51a" class="li jp ht ld b fv mg lk l ll lm">// get the token balance of the given address<br/> var tokenBalance = await getContract().methods.balances(address).call() || '0'</span><span id="8887" class="li jp ht ld b fv mg lk l ll lm">// response data back to requestor<br/> return res.send({<br/> 'Ether Balance': ethBalance,<br/> 'Token Balance': tokenBalance<br/> })<br/> } <br/>}</span><span id="22d8" class="li jp ht ld b fv mg lk l ll lm">// Send Signed Transaction<br/>async function sendSignTransaction(rawTrans) {<br/> // Initiate values required by the dataTrans<br/> if (rawTrans) {<br/> var txCount = await web3.eth.getTransactionCount(defaultAccount) // needed for nonce<br/> var abiTrans = rawTrans.encodeABI() // encoded contract method <br/> <br/> var gas = await rawTrans.estimateGas()<br/> var gasPrice = await web3.eth.getGasPrice()<br/> gasPrice = Number(gasPrice)<br/> gasPrice = gasPrice * 2<br/> var gasLimit = gas * 4</span><span id="8bd8" class="li jp ht ld b fv mg lk l ll lm">// Initiate the transaction data<br/> var dataTrans = {<br/> nonce: web3.utils.toHex(txCount),<br/> gasLimit: web3.utils.toHex(gasLimit),<br/> gasPrice: web3.utils.toHex(gasPrice), <br/> to: contractAddress,<br/> data: abiTrans <br/> }<br/> <br/> // sign transaction<br/> var tx = new TX(dataTrans)<br/> tx.sign(privateKey)</span><span id="dcca" class="li jp ht ld b fv mg lk l ll lm">// after signing send the transaction<br/> return await sendSigned(tx)<br/> } else {<br/> throw new console.error('Encoded raw transaction was not given.');<br/> }<br/> <br/>}</span><span id="3e9a" class="li jp ht ld b fv mg lk l ll lm">function sendSigned(tx) {<br/> return new Promise(function(resolve,reject){<br/> // send the signed transaction<br/> web3.eth.sendSignedTransaction('0x' + tx.serialize().toString('hex'))<br/> .once(‘transactionHash’, function(hash){<br/> var result = {<br/> 'status':'sent',<br/> 'url': etherscanLink + hash,<br/> 'message':'click the given url to verify status of transaction'<br/> }</span><span id="e089" class="li jp ht ld b fv mg lk l ll lm">// respond with the result<br/> resolve(result)<br/> })<br/> .then(out =&gt; {console.log(out)})<br/> .catch(err =&gt; {<br/> // respond with error<br/> reject(err)<br/> })<br/> })<br/>}</span><span id="e711" class="li jp ht ld b fv mg lk l ll lm">module.exports = {<br/> send: sendToken,<br/> mint: mintToken,<br/> balance: getBalance<br/>}</span></pre><p id="8fc7" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">好了，这就是我们的DAPP (Rest API)应用程序所需要的。从这里开始，我推荐使用<code class="eh la lb lc ld b">node app</code>命令运行应用程序来测试您的应用程序。然后，使用API测试工具如Postman来测试你的API。</p><p id="4628" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">注意:如果您想使用Infura订阅智能合约事件。必须使用websockets而不是普通的httpprovider。</p><h1 id="0c7c" class="jo jp ht bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl dt translated">部署前要求</h1><p id="7fc0" class="pw-post-body-paragraph iq ir ht is b it km iv iw ix kn iz ja jb ko jd je jf kp jh ji jj kq jl jm jn hm dt translated">在我们继续之前，请确保您完全理解来自您机器的<a class="ae kr" href="https://up.docs.apex.sh/#aws_credentials" rel="noopener ugc nofollow" target="_blank"> AWS凭证</a>和<a class="ae kr" href="https://up.docs.apex.sh" rel="noopener ugc nofollow" target="_blank"> up </a>命令的设置。我假设您已经设置了所需的<a class="ae kr" href="https://up.docs.apex.sh/#aws_credentials" rel="noopener ugc nofollow" target="_blank">凭证</a>、<a class="ae kr" href="https://up.docs.apex.sh/#aws_credentials.iam_policy_for_up_cli" rel="noopener ugc nofollow" target="_blank">自定义策略</a>和<a class="ae kr" href="https://up.docs.apex.sh/#installation" rel="noopener ugc nofollow" target="_blank"> up </a>命令已经安装。</p><p id="74b1" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">首先，您需要从IAM下的AWS设置<a class="ae kr" href="https://console.aws.amazon.com/iam/home?region=us-east-2#/roles" rel="noopener ugc nofollow" target="_blank">角色</a>。点击<em class="mm">创建角色</em>按钮，创建一个新角色。</p><figure class="kt ku kv kw fq kx fe ff paragraph-image"><div role="button" tabindex="0" class="mi mj di mk bf ml"><div class="fe ff mz"><img src="../Images/96fb00b722dfade0d002a80f7c132218.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hHafbsVcVTJabPxEh1szJw.png"/></div></div></figure><p id="3209" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">在下一个屏幕上，您需要创建一个新策略。点击<em class="mm">创建策略</em>按钮。</p><figure class="kt ku kv kw fq kx fe ff paragraph-image"><div role="button" tabindex="0" class="mi mj di mk bf ml"><div class="fe ff na"><img src="../Images/b264296afec5af1ec5f379fd27904ca2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zhpnp7_VEpCQBVRUHtrQGg.png"/></div></div></figure><p id="e259" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">单击JSON选项卡。</p><figure class="kt ku kv kw fq kx fe ff paragraph-image"><div role="button" tabindex="0" class="mi mj di mk bf ml"><div class="fe ff nb"><img src="../Images/71f3c65df54aa99bc9354c379c38c66d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kq41pnk4AzKObsdIzkEw1g.png"/></div></div></figure><p id="e0ce" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">使用下面的JSON替换现有值。然后，点击<em class="mm">审核策略</em>按钮。</p><pre class="kt ku kv kw fq le ld lf lg aw lh dt"><span id="31a9" class="li jp ht ld b fv lj lk l ll lm">{<br/>    "Version": "2012-10-17",<br/>    "Statement": [<br/>        {<br/>            "Action": [<br/>                "logs:CreateLogGroup",<br/>                "logs:CreateLogStream",<br/>                "logs:PutLogEvents",<br/>                "ssm:GetParametersByPath",<br/>                "ec2:CreateNetworkInterface",<br/>                "ec2:DescribeNetworkInterfaces",<br/>                "ec2:DeleteNetworkInterface"<br/>            ],<br/>            "Effect": "Allow",<br/>            "Resource": "*"<br/>        },<br/>        {<br/>            "Action": [<br/>                "logs:CreateLogGroup",<br/>                "logs:CreateLogStream",<br/>                "logs:PutLogEvents",<br/>                "ssm:GetParametersByPath",<br/>                "ec2:CreateNetworkInterface",<br/>                "ec2:DescribeNetworkInterfaces",<br/>                "ec2:DeleteNetworkInterface"<br/>            ],<br/>            "Effect": "Allow",<br/>            "Resource": "*"<br/>        }<br/>    ]<br/>}</span></pre><p id="ba7a" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">在下一个屏幕上，输入一个描述性名称，然后单击<em class="mm">创建策略</em>按钮。</p><figure class="kt ku kv kw fq kx fe ff paragraph-image"><div role="button" tabindex="0" class="mi mj di mk bf ml"><div class="fe ff nc"><img src="../Images/fa1471ad5ad755af8a4b23b0b73a603d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lcQyzkC8D0g4fWVg6DtsnA.png"/></div></div></figure><p id="c270" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">回到角色创建，搜索新创建的自定义策略，然后单击勾选框。然后，点击<em class="mm">下一步:查看</em>按钮。</p><figure class="kt ku kv kw fq kx fe ff paragraph-image"><div role="button" tabindex="0" class="mi mj di mk bf ml"><div class="fe ff nd"><img src="../Images/f1dd88df025c35f71b2be45ceaacfa7f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ktI-3z0e3ACtcPYEMgBK6A.png"/></div></div></figure><p id="87b8" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">在下一个屏幕上，给出一个描述性名称并点击<em class="mm">创建角色</em>按钮。</p><figure class="kt ku kv kw fq kx fe ff paragraph-image"><div role="button" tabindex="0" class="mi mj di mk bf ml"><div class="fe ff ne"><img src="../Images/c0e8ed1099c41d6e254ccb08053ea4d3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*g8er7ygBKdvBvqE-e-EOvA.png"/></div></div></figure><p id="8bcd" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">之后，打开新创建的角色。然后，单击信任关系选项卡。</p><figure class="kt ku kv kw fq kx fe ff paragraph-image"><div role="button" tabindex="0" class="mi mj di mk bf ml"><div class="fe ff nf"><img src="../Images/2e56240f18caab55ea85a519e02acb9c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qumXlR6rSIqoZqmT0lb2AA.png"/></div></div></figure><p id="6a07" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">然后，使用以下文本修改现有策略，并点击<em class="mm">更新信任策略</em>按钮。</p><pre class="kt ku kv kw fq le ld lf lg aw lh dt"><span id="5a12" class="li jp ht ld b fv lj lk l ll lm">{<br/>  "Version": "2012-10-17",<br/>  "Statement": [<br/>    {<br/>      "Effect": "Allow",<br/>      "Principal": {<br/>        "Service": "apigateway.amazonaws.com"<br/>      },<br/>      "Action": "sts:AssumeRole"<br/>    },<br/>    {<br/>      "Effect": "Allow",<br/>      "Principal": {<br/>        "Service": "lambda.amazonaws.com"<br/>      },<br/>      "Action": "sts:AssumeRole"<br/>    }<br/>  ]<br/>}</span></pre><figure class="kt ku kv kw fq kx fe ff paragraph-image"><div class="fe ff ng"><img src="../Images/9ae7768d3e839b005edcbb4214437fbe.png" data-original-src="https://miro.medium.com/v2/resize:fit:1314/format:webp/1*JGqPk5BancoB7AJs7boQ8Q.png"/></div></figure><p id="da62" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">然后，复制ARN链接并保存在某个地方，用于<code class="eh la lb lc ld b">up.json </code>配置文件。</p><figure class="kt ku kv kw fq kx fe ff paragraph-image"><div role="button" tabindex="0" class="mi mj di mk bf ml"><div class="fe ff nh"><img src="../Images/5f4c59acb8c757b4cbb475deef87f027.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cEWuDT64d3U7X4LBcjBf8w.png"/></div></div></figure><p id="b3d5" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">接下来是创建VPC、子网(至少两个子网)，然后连接到互联网网关。请按照此<a class="ae kr" rel="noopener" href="/@devopslearning/aws-vpc-virtual-private-cloud-d8f8481695b6">链接</a>创建(<a class="ae kr" rel="noopener" href="/@devopslearning/aws-vpc-virtual-private-cloud-d8f8481695b6">https://medium . com/@ devopsleeping/AWS-VPC-virtual-private-cloud-d8f 8481695 b 6</a>)。</p><p id="2aa1" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">然后，从根文件夹创建<code class="eh la lb lc ld b">up.json</code>文件。这是与up命令一起使用所需的配置文件。使用以下格式:</p><pre class="kt ku kv kw fq le ld lf lg aw lh dt"><span id="c89e" class="li jp ht ld b fv lj lk l ll lm">{<br/>  "name":"web3betainfuralambda",<br/>  "profile":"lambda_test",<br/>  "regions":["us-east-2"],<br/>  "lambda": {<br/>    "memory": 512,<br/>    "timeout": 0,<br/>    "role": "&lt;ARN link copied previously&gt;",<br/>    "runtime": "nodejs8.10"<br/>  },<br/>  "vpc": {<br/>    "subnets": ["subnet-1c27a366", "subnet-9c25a1e6"],<br/>    "security_groups": ["sg-d1c4a4bb"]<br/>  }<br/>}</span></pre><p id="6f23" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">我不会解释这些属性是什么。但是，我们需要的重要属性是<em class="mm">名称</em>、<em class="mm">概要</em>、<em class="mm">角色</em>、<em class="mm">运行时</em>和<em class="mm"> vpc </em>。</p><p id="c0d0" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">名称—是显示在lambda仪表板中的应用程序的名称。</p><p id="d3b7" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">配置文件—您创建的<a class="ae kr" href="https://docs.aws.amazon.com/cli/latest/userguide/cli-config-files.html" rel="noopener ugc nofollow" target="_blank"> AWS IAM帐户</a>是否定义了<a class="ae kr" href="https://up.docs.apex.sh/#aws_credentials.iam_policy_for_up_cli" rel="noopener ugc nofollow" target="_blank">自定义策略</a>。</p><p id="0d6c" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">角色-我们之前复制的角色ARN链接。</p><p id="6721" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">运行时—是node.js版本</p><p id="12a2" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">vpc —在这种情况下，我们需要定义子网id和安全组</p><p id="c5d7" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">要了解更多关于up的配置，请点击此<a class="ae kr" href="https://up.docs.apex.sh/#configuration" rel="noopener ugc nofollow" target="_blank">链接</a>(<a class="ae kr" href="https://up.docs.apex.sh/#configuration" rel="noopener ugc nofollow" target="_blank">https://up.docs.apex.sh/#configuration</a>)</p><h1 id="1c8c" class="jo jp ht bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl dt translated">使用up命令部署到Lambda</h1><p id="ad33" class="pw-post-body-paragraph iq ir ht is b it km iv iw ix kn iz ja jb ko jd je jf kp jh ji jj kq jl jm jn hm dt translated">打开你的命令终端，然后进入你的DAPP目录。然后，在您的终端上运行以下命令。</p><pre class="kt ku kv kw fq le ld lf lg aw lh dt"><span id="5482" class="li jp ht ld b fv lj lk l ll lm">up</span></pre><p id="f963" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">您应该会看到下面类似消息，</p><figure class="kt ku kv kw fq kx fe ff paragraph-image"><div class="fe ff ni"><img src="../Images/2889f839925b5a75d88750608e8ea254.png" data-original-src="https://miro.medium.com/v2/resize:fit:802/format:webp/1*TU9ewLLWap4vjhaGq-E6iw.png"/></div></figure><p id="67af" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">然后，运行下面的命令来获取DAPP应用程序的url。</p><pre class="kt ku kv kw fq le ld lf lg aw lh dt"><span id="a3b1" class="li jp ht ld b fv lj lk l ll lm">up url</span></pre><p id="029b" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">然后，用Postman或其他API测试工具使用给定的URL测试您的端点。您可以运行<code class="eh la lb lc ld b">up logs -f</code>来查看来自lambda的实时控制台消息。</p><figure class="kt ku kv kw fq kx fe ff paragraph-image"><div role="button" tabindex="0" class="mi mj di mk bf ml"><div class="fe ff nj"><img src="../Images/e214e319337a0ce14c02927b44ad81e9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*EYBUaLxtRurkZcf8IgkhDA.png"/></div></div></figure><p id="babc" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">如果你从Lambda控制台收到如下所示的关于scrypt的错误信息。</p><figure class="kt ku kv kw fq kx fe ff paragraph-image"><div role="button" tabindex="0" class="mi mj di mk bf ml"><div class="fe ff nk"><img src="../Images/52149202d18c845ddc231e415e52f824.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4170G9rpxVTye0pp58bYiw.png"/></div></div></figure><p id="e581" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">您需要创建一个<a class="ae kr" href="https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/EC2_GetStarted.html" rel="noopener ugc nofollow" target="_blank">新的EC2实例，并使用类似于Lambda实例的Linux AMI映像</a>。出现此错误的原因是，在npm安装期间创建的scrypt二进制文件与Lambda使用的AWS Linux AMI中的二进制文件不同。</p><p id="333b" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">创建EC2实例后，在AWS Linux上运行npm install之前，需要执行以下步骤:</p><ol class=""><li id="29cc" class="nl nm ht is b it iu ix iy jb nn jf no jj np jn nq nr ns nt dt translated">安装更新(<code class="eh la lb lc ld b">sudo yum update -y</code>)</li><li id="9de9" class="nl nm ht is b it nu ix nv jb nw jf nx jj ny jn nq nr ns nt dt translated">安装nvm ( <code class="eh la lb lc ld b">curl -o- <a class="ae kr" href="https://raw.githubusercontent.com/creationix/nvm/v0.33.0/install.sh" rel="noopener ugc nofollow" target="_blank">https://raw.githubusercontent.com/creationix/nvm/v0.33.0/install.sh</a> | bash</code>)</li><li id="30fd" class="nl nm ht is b it nu ix nv jb nw jf nx jj ny jn nq nr ns nt dt translated">安装节点(<code class="eh la lb lc ld b">nvm install 8.10</code></li><li id="1f67" class="nl nm ht is b it nu ix nv jb nw jf nx jj ny jn nq nr ns nt dt translated">安装python 2.7，请点击此链接(<a class="ae kr" href="https://myopswork.com/install-python-2-7-10-on-centos-rhel-75f90c5239a5" rel="noopener ugc nofollow" target="_blank">https://myopswork . com/install-python-2-7-10-on-centos-rhel-75f 90 c 5239 a5</a>)</li><li id="816a" class="nl nm ht is b it nu ix nv jb nw jf nx jj ny jn nq nr ns nt dt translated">全球安装node-gyp(<code class="eh la lb lc ld b">npm install -g node-gyp</code></li><li id="2da0" class="nl nm ht is b it nu ix nv jb nw jf nx jj ny jn nq nr ns nt dt translated">安装开发工具(<code class="eh la lb lc ld b">sudo yum groupinstall "Development Tools"</code>)。这是scrypt正确编译所需要的。</li><li id="256e" class="nl nm ht is b it nu ix nv jb nw jf nx jj ny jn nq nr ns nt dt translated">安装命令。首先需要给/user/local/bin ( <code class="eh la lb lc ld b">sudo chown -R $(whoami) /usr/local/bin/</code>)权限。然后，使用脚本(<code class="eh la lb lc ld b">sudo curl -sf <a class="ae kr" href="https://up.apex.sh/install" rel="noopener ugc nofollow" target="_blank">https://up.apex.sh/install</a> | sh</code>)进行安装。然后，使用您之前创建的相同的<a class="ae kr" href="https://docs.aws.amazon.com/cli/latest/userguide/cli-config-files.html" rel="noopener ugc nofollow" target="_blank"> AWS IAM </a>，然后设置您的<a class="ae kr" href="https://up.docs.apex.sh/#aws_credentials" rel="noopener ugc nofollow" target="_blank"> AWS凭证</a>。</li><li id="f350" class="nl nm ht is b it nu ix nv jb nw jf nx jj ny jn nq nr ns nt dt translated">上传我们在上面创建的所有源文件。<em class="mm">注意:我建议通过Git提交并推送您的源文件，然后下载到您新创建的EC2实例。</em></li><li id="e2a7" class="nl nm ht is b it nu ix nv jb nw jf nx jj ny jn nq nr ns nt dt translated">(可选)安装git ( <code class="eh la lb lc ld b">sudo yum install git</code>)。如果您通过Git (Github、Bitbucket等)保存您的库，并且您想要克隆或下载您的源代码，这是必需的。</li></ol><p id="61c6" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">然后，从新创建的EC2实例运行<code class="eh la lb lc ld b">npm install</code>，并再次运行<code class="eh la lb lc ld b">up</code>命令。</p><p id="7a20" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">之后，使用Postman或其他API端点测试工具进行测试。</p><p id="c901" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">这个帖子可以参考我的Github回购。</p><p id="1977" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated"><a class="ae kr" href="https://github.com/abcamitan/web3BetaInfuraLambda" rel="noopener ugc nofollow" target="_blank">https://github.com/abcamitan/web3BetaInfuraLambda</a></p><p id="7735" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">这就是所有的人。您成功地创建了DAPP应用程序，并部署在Lambda中。</p></div></div>    
</body>
</html>