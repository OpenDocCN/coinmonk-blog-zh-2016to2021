# 实施利害关系证明第 5 部分

> 原文：<https://medium.com/coinmonks/implementing-proof-of-stake-part-5-7e3d5b6cdc31?source=collection_archive---------1----------------------->

## 账户、股份和验证者

![](img/67a3c3a562cf394e00d1dc1fd2774c83.png)

在前一篇文章中，我们创建了一个钱包，签署了交易并将其广播到网络。在这篇文章中，我们将在我们的应用程序中添加一些额外的功能。我们将实现一个帐户模型、股份模型和验证者列表。

# 帐目

比特币使用 UTXOs 的概念，而以太坊使用账户模型来跟踪节点余额。账户模型是以太坊中的另一棵默克尔树，就像区块链一样。每笔交易执行时，特定账户的余额要么增加，要么减少。因此，可以简单地将其视为一个大型的键-值哈希表，其中键是节点的帐户，值是余额。我们将在应用程序中创建一个对象来创建一个帐户模型，而不是实际创建 merkel 树。

因此，让我们通过在区块链文件夹中添加一个名为`account.js`的新文件来创建一个帐户模型

我们的账户模型应该提供以下功能—

1.  增量平衡
2.  减量平衡
3.  转移硬币
4.  转让手续费
5.  更新帐户状态
6.  获取给定账户的余额

Account 类有两个属性 address 和对应于这些地址的 balances。

贷记和借记有两种不同的功能。`getBalance` 函数只是返回给定键的值。传递函数利用递增和递减函数来模拟值的传递，最后，更新函数接受并执行一个事务。

*注意:初始化函数可以解决这个问题，因为 balances 对象没有地址或键，当创建新帐户时，它的默认余额为零，所以这个函数安全地处理这种情况，并为每个帐户分配一个零余额。*

## 钱包和余额

我们现在可以在我们的钱包中添加函数来获得节点的余额。为了保持代码的整洁，我们将在区块链类中添加一个函数来获取任何节点的余额，并重用钱包中的代码。

```
 // blockchain.js getBalance(publicKey) {
    return this.accounts.getBalance(publicKey);
  }
```

我们现在可以在 wallet 类中调用这个函数，在创建交易之前检查余额。

我们将在后面的教程中添加转会费功能。

# 桩

我们需要一种方法来跟踪一个节点下注的硬币数量。在以太坊中，每个方块持有赌注金额，但我们将保持简单，并为其创建一个单独的模型来概括这个概念。由于具有最大赌注的节点被选为领导者或伪造块者，我们通过在该模型中查找赌注硬币来找到下一个领导者。股份模型的功能类似于账户模型。

通过在区块链文件夹中添加一个名为`stake.js`的新文件来创建一个桩子模型

addStake 函数增加节点的堆叠量。getStake 函数返回赌注金额。getMax 函数返回具有最大赌注硬币的节点地址。update 函数只是执行事务的 addStake 函数的包装器。

# 验证器

验证器节点不同于 PoS 中的普通节点。验证器节点可以添加标桩，被选为领导者和创建块。但不是所有的节点都可以是验证器。只有那些发送包含验证器费用的特殊事务的节点才能成为验证器。费用或硬币随后被烧掉，不再使用。在 Casper 中，每个节点以前需要支付 1000 个以太，现在需要 32 个以太才能成为验证者。

为了将这个特性添加到我们的项目中，我们将在区块链文件夹中创建一个名为`validators.js`的文件，该文件将包含一个地址列表，这些地址是验证者并且已经提交了费用。

费用可以是任何整数，这里我有 30 英镑，这笔钱的接收者是一个地址“0 ”,这是一个特殊的地址，所有应该被烧毁的硬币都被送到这个地址。如果条件匹配，这个函数简单地将地址添加到列表中。

# 交易类型

在这个应用中有三种类型的交易——

1.  交易——用于常规交易(想不出更好的名称)
2.  赌注——用于赌硬币
3.  VALIDATOR_FEE —成为验证者的固定金额的交易

*感谢您的阅读。* ***在下一部分中，我们将为我们的硬币创建一个 ICO，添加一个静态的 leader，并生成和广播块。*** *希望你喜欢编码。如果你发现这很有帮助，请鼓掌。*

如果你对区块链、以太坊或整个世界有任何疑问，请发表评论。:)

[![](img/449450761cd76f44f9ae574333f9e9af.png)](http://bit.ly/2G71Sp7)

k

> [直接在您的收件箱中获得最佳软件交易](https://coincodecap.com/?utm_source=coinmonks)

[![](img/7c0b3dfdcbfea594cc0ae7d4f9bf6fcb.png)](https://coincodecap.com/?utm_source=coinmonks)