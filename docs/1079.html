<html>
<head>
<title>Build a Smart Mailbox with Sigfox and Pycom</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Sigfox和Pycom构建智能邮箱</h1>
<blockquote>原文：<a href="https://medium.com/coinmonks/build-a-smart-mailbox-with-sigfox-and-pycom-364e272666db?source=collection_archive---------6-----------------------#2018-07-18">https://medium.com/coinmonks/build-a-smart-mailbox-with-sigfox-and-pycom-364e272666db?source=collection_archive---------6-----------------------#2018-07-18</a></blockquote><div><div class="ef hh hi hj hk hl"/><div class="hm hn ho hp hq"><div class=""/><figure class="fi fk ir is it iu fe ff paragraph-image"><div role="button" tabindex="0" class="iv iw di ix bf iy"><div class="fe ff iq"><img src="../Images/369940b8353fc758d0b51b9d229727c5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*POraT5Z2L6-Gu1hh.png"/></div></div></figure><p id="d65d" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">今天，我们将向您展示如何使用Wia和Pycom SiPy创建Sigfox邮件通知程序。</p><p id="a0ab" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">本教程假设您已经将Sigfox连接到Wia。如果尚未连接，请单击此处<a class="ae jz" href="https://developers.wia.io/v1.0/docs/pycom-sipy" rel="noopener ugc nofollow" target="_blank"/>查找Sigfox初始设置和向Wia发布数据的教程。</p><h1 id="6d28" class="ka kb ht bd kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx dt translated">成分</h1><ul class=""><li id="2625" class="ky kz ht jd b je la ji lb jm lc jq ld ju le jy lf lg lh li dt translated"><a class="ae jz" href="https://pycom.io/hardware/sipy-specs/" rel="noopener ugc nofollow" target="_blank"> Pycom SiPy </a></li><li id="1ac5" class="ky kz ht jd b je lj ji lk jm ll jq lm ju ln jy lf lg lh li dt translated"><a class="ae jz" href="https://pycom.io/product/expansion-board-3-0/" rel="noopener ugc nofollow" target="_blank"> Pycom扩展板</a></li><li id="bf2a" class="ky kz ht jd b je lj ji lk jm ll jq lm ju ln jy lf lg lh li dt translated">Sigfox兼容天线</li><li id="0829" class="ky kz ht jd b je lj ji lk jm ll jq lm ju ln jy lf lg lh li dt translated">移动设备(iOS或安卓)</li><li id="4e14" class="ky kz ht jd b je lj ji lk jm ll jq lm ju ln jy lf lg lh li dt translated"><a class="ae jz" href="https://www.amazon.co.uk/ELEGOO-Ultrasonic-Raspberry-Datasheet-Available/dp/B01M0QL1F1/ref=sr_1_3?ie=UTF8&amp;qid=1531485159&amp;sr=8-3&amp;keywords=hc-sr04" rel="noopener ugc nofollow" target="_blank"> HC-SR04超声波传感器</a></li></ul><h1 id="a0df" class="ka kb ht bd kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx dt translated">设置您的电路板</h1><ul class=""><li id="c7b6" class="ky kz ht jd b je la ji lb jm lc jq ld ju le jy lf lg lh li dt translated">将SiPy连接到扩展板。(Pycom标志应该面向同一方向)</li><li id="d7cc" class="ky kz ht jd b je lj ji lk jm ll jq lm ju ln jy lf lg lh li dt translated">将Sigfox天线连接到SiPy。连接是SiPy板左下方的小金圆。只需将天线卡入到位。</li></ul><figure class="lp lq lr ls fq iu fe ff paragraph-image"><div role="button" tabindex="0" class="iv iw di ix bf iy"><div class="fe ff lo"><img src="../Images/eb83db8853c90ac8f8f2d6c300c8c85d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*sRBVxs13dQ_5dcif.png"/></div></div></figure><p id="874a" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">对于HC-SR04超声波传感器，需要将以下引脚连接到Pycom SiPy:</p><ul class=""><li id="4d77" class="ky kz ht jd b je jf ji jj jm lt jq lu ju lv jy lf lg lh li dt translated">HC-SR0 | Pycom</li><li id="9d6a" class="ky kz ht jd b je lj ji lk jm ll jq lm ju ln jy lf lg lh li dt translated">Vcc -&gt; Vin</li><li id="123e" class="ky kz ht jd b je lj ji lk jm ll jq lm ju ln jy lf lg lh li dt translated">Trig -&gt; G8</li><li id="7452" class="ky kz ht jd b je lj ji lk jm ll jq lm ju ln jy lf lg lh li dt translated">回声-&gt; G7</li><li id="86fc" class="ky kz ht jd b je lj ji lk jm ll jq lm ju ln jy lf lg lh li dt translated">Gnd -&gt; GND</li></ul><h1 id="a284" class="ka kb ht bd kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx dt translated">设置您的项目</h1><p id="aff6" class="pw-post-body-paragraph jb jc ht jd b je la jg jh ji lb jk jl jm lw jo jp jq lx js jt ju ly jw jx jy hm dt translated">原子中:</p><ul class=""><li id="e279" class="ky kz ht jd b je jf ji jj jm lt jq lu ju lv jy lf lg lh li dt translated">为项目创建一个新文件夹。我要给我的邮箱打电话</li><li id="ed4c" class="ky kz ht jd b je lj ji lk jm ll jq lm ju ln jy lf lg lh li dt translated">在<a class="ae jz" href="https://atom.io/" rel="noopener ugc nofollow" target="_blank"> Atom </a>中，转到<code class="eh lz ma mb mc b">File &gt; New Window</code>打开一个新窗口</li><li id="b231" class="ky kz ht jd b je lj ji lk jm ll jq lm ju ln jy lf lg lh li dt translated">单击<code class="eh lz ma mb mc b">File &gt; Add Project Folder</code>并导航至新创建的文件夹，添加该文件夹</li><li id="86b3" class="ky kz ht jd b je lj ji lk jm ll jq lm ju ln jy lf lg lh li dt translated">如果你的Atom窗口底部没有打开<a class="ae jz" href="https://atom.io/packages/pymakr" rel="noopener ugc nofollow" target="_blank"> Pymakr </a>插件，点击右边的箭头打开它</li><li id="3124" class="ky kz ht jd b je lj ji lk jm ll jq lm ju ln jy lf lg lh li dt translated">选择<code class="eh lz ma mb mc b">Settings &gt; Project Settings</code>。在地址字段中，用上述步骤中的设备名称替换该值，例如<code class="eh lz ma mb mc b">/dev/tty.usbmodemPy343431</code> (Mac OS X)、<code class="eh lz ma mb mc b">COM3</code> (Windows)、<code class="eh lz ma mb mc b">/dev/ttyACM0</code> (Linux)，然后保存该文件</li></ul><h1 id="6165" class="ka kb ht bd kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx dt translated">为我们的邮件发布sigfox事件</h1><p id="d768" class="pw-post-body-paragraph jb jc ht jd b je la jg jh ji lb jk jl jm lw jo jp jq lx js jt ju ly jw jx jy hm dt translated">我们的申请需要三个文件:</p><ul class=""><li id="ae6e" class="ky kz ht jd b je jf ji jj jm lt jq lu ju lv jy lf lg lh li dt translated"><code class="eh lz ma mb mc b">boot.py</code>设备通电时运行</li><li id="7b04" class="ky kz ht jd b je lj ji lk jm ll jq lm ju ln jy lf lg lh li dt translated"><code class="eh lz ma mb mc b">main.py</code>这是我们的主要代码</li><li id="e83c" class="ky kz ht jd b je lj ji lk jm ll jq lm ju ln jy lf lg lh li dt translated"><code class="eh lz ma mb mc b">ultrasonic.py</code>是我们获取距离和校准的功能所在</li></ul><p id="46f5" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">在Atom中:</p><ul class=""><li id="eae6" class="ky kz ht jd b je jf ji jj jm lt jq lu ju lv jy lf lg lh li dt translated">右键单击您的项目，然后单击新建文件。输入<code class="eh lz ma mb mc b">boot.py</code>作为文件名</li><li id="6d8a" class="ky kz ht jd b je lj ji lk jm ll jq lm ju ln jy lf lg lh li dt translated">将下面的代码复制并粘贴到文件中</li></ul><pre class="lp lq lr ls fq md mc me mf aw mg dt"><span id="92ad" class="mh kb ht mc b fv mi mj l mk ml"><strong class="mc hu">from</strong> machine <strong class="mc hu">import</strong> UART<br/><strong class="mc hu">import</strong> machine<br/><strong class="mc hu">import</strong> os</span><span id="a7fc" class="mh kb ht mc b fv mm mj l mk ml">uart = UART(0, baudrate=115200)<br/>os.dupterm(uart)</span><span id="ef8d" class="mh kb ht mc b fv mm mj l mk ml">machine.main('main.py')</span></pre><ul class=""><li id="dc3d" class="ky kz ht jd b je jf ji jj jm lt jq lu ju lv jy lf lg lh li dt translated">右键单击您的项目，然后单击新建文件。输入<code class="eh lz ma mb mc b">main.py</code>作为文件名</li><li id="6e9b" class="ky kz ht jd b je lj ji lk jm ll jq lm ju ln jy lf lg lh li dt translated">将下面的代码复制并粘贴到文件中</li></ul><pre class="lp lq lr ls fq md mc me mf aw mg dt"><span id="09da" class="mh kb ht mc b fv mi mj l mk ml"><strong class="mc hu">import</strong> time<br/><strong class="mc hu">import</strong> pycom<br/><strong class="mc hu">import</strong> socket<br/><strong class="mc hu">from</strong> network <strong class="mc hu">import</strong> Sigfox<br/><strong class="mc hu">from</strong> machine <strong class="mc hu">import</strong> Pin, Timer<br/><strong class="mc hu">import</strong> ultrasonic<br/></span><span id="26f5" class="mh kb ht mc b fv mm mj l mk ml">pycom.heartbeat(<strong class="mc hu">False</strong>)</span><span id="7819" class="mh kb ht mc b fv mm mj l mk ml">echo = Pin(Pin.exp_board.G7, mode=Pin.IN)<br/>trigger = Pin(Pin.exp_board.G8, mode=Pin.OUT)<br/>trigger(0)</span><span id="1073" class="mh kb ht mc b fv mm mj l mk ml"># Get the chronometer object<br/>chrono = Timer.Chrono()</span><span id="8825" class="mh kb ht mc b fv mm mj l mk ml"># init Sigfox for RCZ1 (Europe)<br/>sigfox = Sigfox(mode=Sigfox.SIGFOX, rcz=Sigfox.RCZ1)<br/># create a Sigfox socket<br/>s = socket.socket(socket.AF_SIGFOX, socket.SOCK_RAW)<br/># make the socket blocking<br/>s.setblocking(<strong class="mc hu">True</strong>)<br/># configure it as uplink only<br/>s.setsockopt(socket.SOL_SIGFOX, socket.SO_RX, <strong class="mc hu">False</strong>)<br/></span><span id="a513" class="mh kb ht mc b fv mm mj l mk ml">calabrated_distance = ultrasonic.calabration(chrono, trigger, echo, 1)<br/>mailed_distance = 0<br/><strong class="mc hu">while</strong> <strong class="mc hu">True</strong>:<br/>    time.sleep(30)<br/>    distance = ultrasonic.getDistance(chrono, trigger, echo)<br/>    print("distance: {}, calabration: {}".format(distance, calabrated_distance))<br/>    <strong class="mc hu">if</strong> distance &lt; calabrated_distance:<br/>        <strong class="mc hu">if</strong> distance != mailed_distance:<br/>            s.send('') # Send 1 bit<br/>            print("you got mail")<br/>            mailed_distance = ultrasonic.calabration(chrono, trigger, echo)</span></pre><ul class=""><li id="1427" class="ky kz ht jd b je jf ji jj jm lt jq lu ju lv jy lf lg lh li dt translated">右键单击您的项目，然后单击新建文件。输入<code class="eh lz ma mb mc b">ultrasonic.py</code>作为文件名</li><li id="4813" class="ky kz ht jd b je lj ji lk jm ll jq lm ju ln jy lf lg lh li dt translated">将下面的代码复制并粘贴到文件中</li></ul><pre class="lp lq lr ls fq md mc me mf aw mg dt"><span id="44e3" class="mh kb ht mc b fv mi mj l mk ml"><strong class="mc hu">from</strong> machine <strong class="mc hu">import</strong> Pin, Timer<br/><strong class="mc hu">import</strong> pycom<br/><strong class="mc hu">import</strong> time<br/><strong class="mc hu">import</strong> socket</span><span id="ae14" class="mh kb ht mc b fv mm mj l mk ml"><strong class="mc hu">def</strong> <strong class="mc hu">calabration</strong>(chrono, trigger, echo, led = False):<br/>    <strong class="mc hu">if</strong> led:<br/>        pycom.rgbled(0x7f0000) # red<br/>    prev_distance = 0<br/>    distance = getDistance(chrono, trigger, echo)<br/>    print("calibration distance is {}".format(distance))<br/>    count = 0<br/>    <strong class="mc hu">while</strong> <strong class="mc hu">True</strong>:<br/>        prev_distance = distance<br/>        distance = getDistance(chrono, trigger, echo)<br/>        <strong class="mc hu">while</strong> prev_distance == distance:<br/>            count+=1<br/>            print("count: {}".format(count))<br/>            <strong class="mc hu">if</strong> count &gt; 5:<br/>                <strong class="mc hu">if</strong> led:<br/>                    pycom.rgbled(0x007f00) # green<br/>                    time.sleep(1.5)<br/>                    pycom.rgbled(0) # off<br/>                <strong class="mc hu">return</strong> distance<br/>            time.sleep(5)<br/>            prev_distance = distance<br/>            distance = getDistance(chrono, trigger, echo)<br/>        <strong class="mc hu">else</strong>:<br/>            count = 0</span><span id="01bd" class="mh kb ht mc b fv mm mj l mk ml"><strong class="mc hu">def</strong> <strong class="mc hu">getDistance</strong>(chrono, trigger, echo):<br/>    chrono.reset()<br/>    trigger(1)<br/>    time.sleep_us(10)<br/>    trigger(0)</span><span id="aa9b" class="mh kb ht mc b fv mm mj l mk ml">    <strong class="mc hu">while</strong> echo() == 0:<br/>        <strong class="mc hu">pass</strong><br/>    chrono.start()</span><span id="0b59" class="mh kb ht mc b fv mm mj l mk ml">    <strong class="mc hu">while</strong> echo() == 1:<br/>        <strong class="mc hu">pass</strong><br/>    chrono.stop()</span><span id="3d6a" class="mh kb ht mc b fv mm mj l mk ml">    distance = chrono.read_us() / 58.0<br/>    <strong class="mc hu">if</strong> distance &gt; 400:<br/>        <strong class="mc hu">return</strong> -1<br/>    <strong class="mc hu">else</strong>:<br/>        <strong class="mc hu">return</strong> int(distance)</span><span id="9cdd" class="mh kb ht mc b fv mm mj l mk ml">    time.sleep(1)</span></pre><p id="fb6e" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">您的文件夹结构现在应该如下所示:</p><ul class=""><li id="7189" class="ky kz ht jd b je jf ji jj jm lt jq lu ju lv jy lf lg lh li dt translated"><code class="eh lz ma mb mc b">ultrasonic.py</code></li><li id="0c7a" class="ky kz ht jd b je lj ji lk jm ll jq lm ju ln jy lf lg lh li dt translated"><code class="eh lz ma mb mc b">boot.py</code></li><li id="1a84" class="ky kz ht jd b je lj ji lk jm ll jq lm ju ln jy lf lg lh li dt translated"><code class="eh lz ma mb mc b">main.py</code></li></ul><p id="07d0" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">点击Atom窗口底部的Pymakr插件中的<code class="eh lz ma mb mc b">Upload</code>，将代码发送到您的Pycom板。现在转到Wia仪表板，您应该看到数据出现在仪表板的调试器部分。</p><p id="e48b" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">为了让传感器正常工作，它需要校准你的邮箱内的距离。</p><h1 id="ac2e" class="ka kb ht bd kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx dt translated">校准</h1><p id="8b5d" class="pw-post-body-paragraph jb jc ht jd b je la jg jh ji lb jk jl jm lw jo jp jq lx js jt ju ly jw jx jy hm dt translated">要校准传感器，请将传感器放在邮箱中最合适的位置。给董事会供电；当板上的LED为红色时，传感器正在校准；一旦LED闪烁绿色，传感器已被校准。传感器需要至少2厘米的空间才能正常工作。</p><p id="a215" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">现在，当邮件被插入您的邮箱时，距离将从校准后的距离减少，代码将通过Sigfox向Wia发布一个事件。</p><h1 id="e301" class="ka kb ht bd kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx dt translated">发送推送通知</h1><p id="cdd1" class="pw-post-body-paragraph jb jc ht jd b je la jg jh ji lb jk jl jm lw jo jp jq lx js jt ju ly jw jx jy hm dt translated">现在，下一步，一旦我们在Wia中收到Sigfox事件，我们将向任何连接的电话发送一个有邮件的通知。为此，我们需要建立一个流程。</p><p id="24d4" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">走到你的Wia仪表盘和你的Sigfox设备所在的地方。从那里点击左边菜单中的流程图标，进入您的流程。</p><figure class="lp lq lr ls fq iu fe ff paragraph-image"><div role="button" tabindex="0" class="iv iw di ix bf iy"><div class="fe ff mn"><img src="../Images/f0121622c250c51cef8f698f3223775a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*5m6RXA1jOc0WWWhl.png"/></div></div></figure><p id="5a26" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">现在来创建你的心流，你可以给它起任何你喜欢的名字。一旦你创建了一个流，你应该被带到流工作室。</p><p id="8341" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">在Flow studio中:</p><ul class=""><li id="4c82" class="ky kz ht jd b je jf ji jj jm lt jq lu ju lv jy lf lg lh li dt translated">将<code class="eh lz ma mb mc b">trigger event node</code>从左侧拖到画布上</li><li id="51c8" class="ky kz ht jd b je lj ji lk jm ll jq lm ju ln jy lf lg lh li dt translated">点击节点并输入<code class="eh lz ma mb mc b">sigfoxDataUplink</code>作为事件名称</li><li id="0f1f" class="ky kz ht jd b je lj ji lk jm ll jq lm ju ln jy lf lg lh li dt translated">启用Sigfox设备作为事件源</li></ul><p id="45f5" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">现在，我们将为Sigfox事件添加一个通知，这样我们就可以收到关于入站邮件的通知。为此，您将需要Wia移动应用程序。iOS <a class="ae jz" href="https://itunes.apple.com/us/app/wia-talk-to-your-things/id1320616870?ls=1&amp;mt=8" rel="noopener ugc nofollow" target="_blank">这里</a>安卓<a class="ae jz" href="https://play.google.com/store/apps/details?id=io.wia.wia" rel="noopener ugc nofollow" target="_blank">这里</a>都可以下载。</p><figure class="lp lq lr ls fq iu fe ff paragraph-image"><div role="button" tabindex="0" class="iv iw di ix bf iy"><div class="fe ff mn"><img src="../Images/a729509708317cf62568f870de50e5b0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*mC16vmtYjCbFU4fh.png"/></div></div></figure><p id="5f7f" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">在Flow Studio编辑器中:</p><ul class=""><li id="f527" class="ky kz ht jd b je jf ji jj jm lt jq lu ju lv jy lf lg lh li dt translated">将鼠标拖到通知节点上，并输入以下文本</li></ul><pre class="lp lq lr ls fq md mc me mf aw mg dt"><span id="ee9e" class="mh kb ht mc b fv mi mj l mk ml">You've got Mail!</span></pre><p id="4fb7" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">现在，您应该可以在移动设备上接收Sigfox数据了。</p><figure class="lp lq lr ls fq iu fe ff paragraph-image"><div role="button" tabindex="0" class="iv iw di ix bf iy"><div class="fe ff mo"><img src="../Images/68cd1d75f15d2495d560ac368a8c0af9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*x4-c7_bYRhe4vfDm.jpeg"/></div></div></figure></div></div>    
</body>
</html>