<html>
<head>
<title>Writing smarter contracts with TetriX</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用TetriX编写更智能的合同</h1>
<blockquote>原文：<a href="https://medium.com/coinmonks/writing-smarter-contracts-with-tetrix-1b6b7f3a44be?source=collection_archive---------9-----------------------#2018-05-15">https://medium.com/coinmonks/writing-smarter-contracts-with-tetrix-1b6b7f3a44be?source=collection_archive---------9-----------------------#2018-05-15</a></blockquote><div><div class="ef hh hi hj hk hl"/><div class="hm hn ho hp hq"><div class=""/><p id="e626" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">以太坊标志着自己是一个分散的计算平台，旨在完全按照编程运行应用程序，而不存在欺诈、审查和第三方干扰。然而，实现这些有价值的特性是要付出代价的——毫不夸张地说。</p><h1 id="b41b" class="jo jp ht bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl dt translated">汽油很贵。</h1><p id="dc12" class="pw-post-body-paragraph iq ir ht is b it km iv iw ix kn iz ja jb ko jd je jf kp jh ji jj kq jl jm jn hm dt translated">根据<a class="ae kr" href="http://gavwood.com/paper.pdf" rel="noopener ugc nofollow" target="_blank">黄皮书</a>，一个256位字需要<code class="eh ks kt ku kv b">SSTORE</code>20k的气体，换算成640k的气体才能存储1千字节。在撰写本文时，对于标准速度(&lt; 5m)，一单位天然气的成本为11 Gwei(或0.000000011 ETH)，1 ETH的价值为731.052美元。因此，1千字节的存储成本为5.146美元，单个千兆字节的成本超过500万美元。这并不是说需要大量内存的数据(如视频、音频、图像等。)是写在区块链上的，但重要的是要注意到扩展智能合约的重大经济影响，以及任何类型的改进以降低交易成本的需要。</p><h1 id="6899" class="jo jp ht bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl dt translated">延伸以太坊生态系统。</h1><p id="e45a" class="pw-post-body-paragraph iq ir ht is b it km iv iw ix kn iz ja jb ko jd je jf kp jh ji jj kq jl jm jn hm dt translated">为了解决这个问题，我们的团队探索了以太坊领域目前可用的工具。我们都熟悉的最常用的资源是Solidity编译器的优化器。正如在<a class="ae kr" href="http://solidity.readthedocs.io/en/latest/miscellaneous.html" rel="noopener ugc nofollow" target="_blank"> Solidity文档</a>中所展示的，优化的编译器被设计成搜索总是相等的表达式(在每个输入上)并将它们组合成一个表达式类。例如，它替换了在评估为常数的<code class="eh ks kt ku kv b">JUMP1</code>条件下分割的基本块。</p><p id="bf5f" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">因此，</p><pre class="kw kx ky kz fq la kv lb lc aw ld dt"><span id="3417" class="le jp ht kv b fv lf lg l lh li"><strong class="kv hu">var</strong> x = 7;<br/>data[7] = 9;<br/><strong class="kv hu">if</strong> (data[x] != x + 2)<br/>  <strong class="kv hu">return</strong> 2;<br/><strong class="kv hu">else<br/>  return</strong> 1;</span></pre><p id="baa1" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">简化为以下内容:</p><pre class="kw kx ky kz fq la kv lb lc aw ld dt"><span id="bba7" class="le jp ht kv b fv lf lg l lh li">data[7] = 9;<br/><strong class="kv hu">return</strong> 1;</span></pre><p id="343e" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">即使进行了这些优化，研究人员在分析2016年11月5日之前部署的所有智能合约时发现，Solidity编译器中的优化器未能充分考虑无用代码相关模式和循环相关模式的实例。因此，他们提出了GASPER(GAS-cost Patterns checker的缩写)，一种自动发现字节码中这些低效模式的工具。跟随GASPER团队的脚步，我们还想通过寻找其他方法来帮助开发人员考虑对他们的智能合约进行开发改进，从而扩展以太坊的前沿。</p><p id="aa8d" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">今天，我们很高兴地介绍TetriX，这是一个gas优化工具，它可以在合同实例化期间自动重新排序状态变量，以降低交易成本。</p><h1 id="caeb" class="jo jp ht bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl dt translated">设计。</h1><p id="91f0" class="pw-post-body-paragraph iq ir ht is b it km iv iw ix kn iz ja jb ko jd je jf kp jh ji jj kq jl jm jn hm dt translated">在我们的研究中，我们观察到智能合同的状态变量的组织对天然气成本有明显的影响。一组变量在区块链上占用不同数量的32字节槽，这取决于各个数据类型的大小如何相互对齐。因此，TetriX通过自动调整流程来确保合同占用最少的空间。</p><h1 id="5293" class="jo jp ht bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl dt translated">特色。</h1><h2 id="2848" class="le jp ht bd jq lj lk ll ju lm ln lo jy jb lp lq kc jf lr ls kg jj lt lu kk lv dt translated">优化合同状态变量内存分配</h2><ul class=""><li id="8f5f" class="lw lx ht is b it km ix kn jb ly jf lz jj ma jn mb mc md me dt translated">解析用户的智能合同并检测状态变量。</li><li id="d8e0" class="lw lx ht is b it mf ix mg jb mh jf mi jj mj jn mb mc md me dt translated">字节对齐基于32字节内存插槽的变量。</li><li id="be21" class="lw lx ht is b it mf ix mg jb mh jf mi jj mj jn mb mc md me dt translated">重新排列智能合约的状态变量，以便在区块链上尽可能分配最少的内存槽，从而优化气体使用。</li></ul><h2 id="8e77" class="le jp ht bd jq lj lk ll ju lm ln lo jy jb lp lq kc jf lr ls kg jj lt lu kk lv dt translated">打造个人区块链开发环境</h2><ul class=""><li id="7285" class="lw lx ht is b it km ix kn jb ly jf lz jj ma jn mb mc md me dt translated">使用Solidity编译器编译用户的智能合同，以检索准确的合同信息。</li><li id="1fa8" class="lw lx ht is b it mf ix mg jb mh jf mi jj mj jn mb mc md me dt translated">使用Truffle Suite的Ganache部署用户的智能合约，以模拟以太坊区块链，而无需真正的燃气费。</li></ul><h2 id="4b60" class="le jp ht bd jq lj lk ll ju lm ln lo jy jb lp lq kc jf lr ls kg jj lt lu kk lv dt translated">智能合同信息的前端显示</h2><figure class="kw kx ky kz fq ml fe ff paragraph-image"><div role="button" tabindex="0" class="mm mn di mo bf mp"><div class="fe ff mk"><img src="../Images/cbfe9c0c93702f4d89e16fcdf38d0151.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*q7FtBQL2Vg_4NErKfLFPjw.gif"/></div></div></figure><ul class=""><li id="284f" class="lw lx ht is b it iu ix iy jb ms jf mt jj mu jn mb mc md me dt translated">通过客户端本地托管服务器可视化TetriX执行的状态变量操作。</li></ul><h1 id="dfa4" class="jo jp ht bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl dt translated">精心制作智能合同是一件严肃的事情。</h1><p id="e186" class="pw-post-body-paragraph iq ir ht is b it km iv iw ix kn iz ja jb ko jd je jf kp jh ji jj kq jl jm jn hm dt translated">我们构建TetriX是为了在设计智能合约时增强开发人员的体验。我们通过在契约实例化期间改进状态变量的字节对齐，以及提供可视化功能来实现这一点，该功能提供多个比较视图，以允许用户了解他们的契约是如何被操纵的。作为令人印象深刻的气体减少的交换，优化带来了代码可维护性方面的一些风险和挑战。模板策略并不考虑所有的边缘情况，尤其是在不同的应用中分配类型不同的情况下。因此，用户在制定智能合同时，在决定TetriX是否是他们的正确工具时，应该小心谨慎。</p><p id="9fbf" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">TetriX是为开发者打造的，我们希望让开发过程尽可能无痛。如果您有任何反馈或建议，我们很高兴听到我们如何继续改进这一工具！</p><h1 id="242b" class="jo jp ht bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl dt translated">开始</h1><p id="b8eb" class="pw-post-body-paragraph iq ir ht is b it km iv iw ix kn iz ja jb ko jd je jf kp jh ji jj kq jl jm jn hm dt translated"><a class="ae kr" href="https://www.npmjs.com/package/tetrix-sol" rel="noopener ugc nofollow" target="_blank">今天就在npm上下载TetriX </a>。</p><pre class="kw kx ky kz fq la kv lb lc aw ld dt"><span id="111f" class="le jp ht kv b fv lf lg l lh li">npm install tetrix-sol</span></pre><p id="59b8" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated"><strong class="is hu">德肯特里克斯</strong>是<a class="ae kr" href="https://github.com/choisiesther" rel="noopener ugc nofollow" target="_blank">埃斯特金</a>、<a class="ae kr" href="https://github.com/josephwu1994" rel="noopener ugc nofollow" target="_blank">吴钊燮</a>和<a class="ae kr" href="https://github.com/pskchang" rel="noopener ugc nofollow" target="_blank">张宝琳</a>。</p><figure class="kw kx ky kz fq ml fe ff paragraph-image"><a href="http://bit.ly/2G71Sp7"><div class="fe ff mv"><img src="../Images/449450761cd76f44f9ae574333f9e9af.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fKX2mtg7p1lOs7JmosPLsA.png"/></div></a></figure></div></div>    
</body>
</html>