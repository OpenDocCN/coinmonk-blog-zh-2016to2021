<html>
<head>
<title>Recycling System using IOTA</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用IOTA的回收系统</h1>
<blockquote>原文：<a href="https://medium.com/coinmonks/recycling-system-using-iota-2172ecc7444?source=collection_archive---------2-----------------------#2020-01-30">https://medium.com/coinmonks/recycling-system-using-iota-2172ecc7444?source=collection_archive---------2-----------------------#2020-01-30</a></blockquote><div><div class="ef hh hi hj hk hl"/><div class="hm hn ho hp hq"><div class=""/><p id="0d94" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">大家好，在上一篇文章中我谈到了用Tangle和IPFS实现一个数据库系统。今天我将展示我的数据库的一个用例。我将创建一个回收系统。回收行业面临着严峻的挑战，回收材料的数量不一致，难以估计。所以我们会用区块链来解决这个问题。</p><h1 id="a364" class="jp jq ht bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km dt translated">应用场景</h1><p id="20aa" class="pw-post-body-paragraph iq ir ht is b it kn iv iw ix ko iz ja jb kp jd je jf kq jh ji jj kr jl jm jn hm dt translated">消费者#A想要回收他的笔记本电脑、智能手机或手表……不管是什么。消费者#A使用智能手机上的NFC扫描他消费的产品，并转到我们的智能垃圾桶。我们的智能垃圾桶扫描NFC标签，并向消费者#A发送一些MIOTA作为回收奖励。</p><figure class="kt ku kv kw fq kx fe ff paragraph-image"><div role="button" tabindex="0" class="ky kz di la bf lb"><div class="fe ff ks"><img src="../Images/575d339f9c5dd5da6c9c804e35ca346e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*eRulh3IZe5O4faCO"/></div></div><figcaption class="le lf fg fe ff lg lh bd b be z ek">Diagram will be explained in details next</figcaption></figure><h1 id="bc41" class="jp jq ht bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km dt translated">它是如何工作的</h1><p id="e4c2" class="pw-post-body-paragraph iq ir ht is b it kn iv iw ix ko iz ja jb kp jd je jf kq jh ji jj kr jl jm jn hm dt translated">假设一个笔记本电脑工厂有兴趣在用户使用后回收他的笔记本电脑。</p><p id="05df" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">1-工厂会将他所有的笔记本电脑数据和id发送到我们的系统，并保存在我们的系统中。(id将是进入每台笔记本电脑的钥匙)</p><p id="a082" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">2-所有笔记本电脑将被保存，状态如下:“未找到，被消费者#a找到，在垃圾箱#B找到”</p><p id="12d9" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">数据库将如下所示:</p><figure class="kt ku kv kw fq kx fe ff paragraph-image"><div role="button" tabindex="0" class="ky kz di la bf lb"><div class="fe ff li"><img src="../Images/4f8475244ff3b43de5e581f08cab80e4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wkbz9YwAR48z5OI_b3k_ag.png"/></div></div></figure><p id="acb8" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">3-所有笔记本电脑都将有NFC标签来写入ID。</p><p id="ef2d" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">4-现在消费者将扫描他想要回收的笔记本电脑。扫描笔记本电脑后，API调用会将消费者设置为回收笔记本电脑的所有者。</p><figure class="kt ku kv kw fq kx fe ff paragraph-image"><div class="fe ff lj"><img src="../Images/e4cc881f253ef5b414e04ec03cc11b4d.png" data-original-src="https://miro.medium.com/v2/resize:fit:396/0*dgqI1TOY-OCYesIi"/></div><figcaption class="le lf fg fe ff lg lh bd b be z ek">Scan product using your phone</figcaption></figure><p id="984a" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">5-每当消费者将他的笔记本电脑放入我们的垃圾桶，他将获得代币作为奖励。</p><figure class="kt ku kv kw fq kx fe ff paragraph-image"><div class="fe ff lk"><img src="../Images/33e03860e76ff354dd6d6866f5c85737.png" data-original-src="https://miro.medium.com/v2/resize:fit:400/0*YgtJi8YgjcMW5I_K"/></div><figcaption class="le lf fg fe ff lg lh bd b be z ek">The smart Trash scan product and check its owner to give token.</figcaption></figure><h1 id="49c7" class="jp jq ht bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km dt translated">API实现</h1><p id="8783" class="pw-post-body-paragraph iq ir ht is b it kn iv iw ix ko iz ja jb kp jd je jf kq jh ji jj kr jl jm jn hm dt translated">首先，我将从API设计开始，它看起来像这样:</p><figure class="kt ku kv kw fq kx fe ff paragraph-image"><div role="button" tabindex="0" class="ky kz di la bf lb"><div class="fe ff ks"><img src="../Images/89062e9b783cc51a61dcd836a8d04631.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*LMqNdaO_3seqjrie"/></div></div><figcaption class="le lf fg fe ff lg lh bd b be z ek">Recycler Sequence Diagram.</figcaption></figure><p id="5098" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">每个API端点如何工作:-</p><p id="0090" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated"><strong class="is hu">‘init’</strong>get-call初始化MAM根并准备好使用数据库(它不应该作为API调用，但这将在第二个版本中改变)。</p><p id="fba8" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">路线:</p><pre class="kt ku kv kw fq ll lm ln lo aw lp dt"><span id="9fe4" class="lq jq ht lm b fv lr ls l lt lu">app.route(‘/init’)<br/>.get(recycler.init);</span></pre><p id="3f55" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">控制器:</p><pre class="kt ku kv kw fq ll lm ln lo aw lp dt"><span id="964e" class="lq jq ht lm b fv lr ls l lt lu">exports.init = async (req,res) =&gt;{<br/>const response = await manageClients.init()<br/>res.json('DB initialized with some clients with root',response )<br/>}</span></pre><p id="e660" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">实现:(将初始化MAM的根并添加客户机虚拟数据)</p><pre class="kt ku kv kw fq ll lm ln lo aw lp dt"><span id="ba91" class="lq jq ht lm b fv lr ls l lt lu">const init = async()=&gt;{</span><span id="eca9" class="lq jq ht lm b fv lv ls l lt lu">products['HELLODRAYMANRNFELVTJREBCXJETCFEUGXBZHEGHCJHIYIFPQEQGDXILJZYUQMOYSELXIG9KUYOSYBFAY'] = {</span><span id="d102" class="lq jq ht lm b fv lv ls l lt lu">'name':'product01',</span><span id="5a9a" class="lq jq ht lm b fv lv ls l lt lu">'address':'HELLODRAYMANRNFELVTJREBCXJETCFEUGXBZHEGHCJHIYIFPQEQGDXILJZYUQMOYSELXIG9KUYOSYBFAY',</span><span id="9096" class="lq jq ht lm b fv lv ls l lt lu">'owner':false,</span><span id="a0c1" class="lq jq ht lm b fv lv ls l lt lu">'producer':'client01'</span><span id="1d97" class="lq jq ht lm b fv lv ls l lt lu">}</span><span id="7c45" class="lq jq ht lm b fv lv ls l lt lu">products['AB9CCUACOSC9VHQQFSVUGOVLAGNYJYDPROPBYTZIGNVOF9KMFNXBMSUGFFA9HTVHBPKPGGIBGSRJPUXZK'] = {</span><span id="3ecf" class="lq jq ht lm b fv lv ls l lt lu">'name':'product02',</span><span id="f6c3" class="lq jq ht lm b fv lv ls l lt lu">'address':'AB9CCUACOSC9VHQQFSVUGOVLAGNYJYDPROPBYTZIGNVOF9KMFNXBMSUGFFA9HTVHBPKPGGIBGSRJPUXZK',</span><span id="818b" class="lq jq ht lm b fv lv ls l lt lu">'owner':false,</span><span id="2301" class="lq jq ht lm b fv lv ls l lt lu">'producer':'client01'</span><span id="6ddb" class="lq jq ht lm b fv lv ls l lt lu">}</span><span id="a0ce" class="lq jq ht lm b fv lv ls l lt lu">products['LHSQELEGSRM9IAQCUBPXOLYXDMFOAPNJFS9JPOJBSRUDJAIRTWHTZCJCFLVYVRJPGPNXEWDDRGTCGKRAB'] = {</span><span id="bca6" class="lq jq ht lm b fv lv ls l lt lu">'name':'product03',</span><span id="8a12" class="lq jq ht lm b fv lv ls l lt lu">'address':'LHSQELEGSRM9IAQCUBPXOLYXDMFOAPNJFS9JPOJBSRUDJAIRTWHTZCJCFLVYVRJPGPNXEWDDRGTCGKRAB',</span><span id="b90d" class="lq jq ht lm b fv lv ls l lt lu">'owner':false,</span><span id="9845" class="lq jq ht lm b fv lv ls l lt lu">'producer':'client01'</span><span id="5346" class="lq jq ht lm b fv lv ls l lt lu">}</span><span id="d009" class="lq jq ht lm b fv lv ls l lt lu">const ipfsHash = await addIPFS.execute(products)</span><span id="cef6" class="lq jq ht lm b fv lv ls l lt lu">const root = await mamManage.send(ipfsHash)</span><span id="ffeb" class="lq jq ht lm b fv lv ls l lt lu">return root</span><span id="3cac" class="lq jq ht lm b fv lv ls l lt lu">}</span></pre><p id="dd5c" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated"><strong class="is hu">‘添加客户’</strong>呼叫后生产者/回收者注册到我的服务。</p><p id="79c9" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">路线:</p><pre class="kt ku kv kw fq ll lm ln lo aw lp dt"><span id="e2c2" class="lq jq ht lm b fv lr ls l lt lu">app.route('/addClient')</span><span id="67e7" class="lq jq ht lm b fv lv ls l lt lu">.post(recycler.addClient);</span></pre><p id="2268" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">控制器:</p><pre class="kt ku kv kw fq ll lm ln lo aw lp dt"><span id="d279" class="lq jq ht lm b fv lr ls l lt lu">exports.addClient = async (req,res) =&gt;{<br/>const response = await manageClients.addNewClient(req.body.root,req.body.products)<br/>res.json("added new client succefuly "+response)<br/>}</span></pre><p id="8eea" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">实施:</p><pre class="kt ku kv kw fq ll lm ln lo aw lp dt"><span id="377e" class="lq jq ht lm b fv lr ls l lt lu">const addNewClient = async (_root,_products)=&gt;{<br/>const currentPropretiesRoot = _root<br/>const currentPropretiesHash = await mamManage.fetch(currentPropretiesRoot)<br/>const currentPropretiesString = await catIPFS.execute(getLastHash(currentPropretiesHash))<br/>const currentPropretiesJSON = JSON.parse(currentPropretiesString)<br/>const productsJSON = JSON.parse(JSON.stringify(_products))<br/>for(let i = 0; i &lt; productsJSON.length;i++){<br/>currentPropretiesJSON[productsJSON[i].address] = productsJSON[i]<br/>}<br/>const newPropretiesHash = await addIPFS.execute(currentPropretiesJSON)<br/>const newPropretiesRoot = await mamManage.send(newPropretiesHash)<br/>return newPropretiesRoot<br/>}</span></pre><p id="9b0a" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated"><strong class="is hu">“添加所有者”</strong>致电后，消费者将成为某个产品的所有者。</p><p id="3d58" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">路线:</p><pre class="kt ku kv kw fq ll lm ln lo aw lp dt"><span id="c7d0" class="lq jq ht lm b fv lr ls l lt lu">app.route('/addOwner')<br/>.post(recycler.addOwner);</span></pre><p id="2b52" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">控制器:</p><pre class="kt ku kv kw fq ll lm ln lo aw lp dt"><span id="d1e6" class="lq jq ht lm b fv lr ls l lt lu">exports.addOwner = async (req,res) =&gt;{<br/>const response = await manageClients.addNewOwner(req.body.root,req.body.productAddress,req.body.ownerAddress)<br/>res.json("added new owner  "+ response)<br/>}</span></pre><p id="3114" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">实施:</p><pre class="kt ku kv kw fq ll lm ln lo aw lp dt"><span id="aab9" class="lq jq ht lm b fv lr ls l lt lu">const addNewOwner = async(_root,productAddress,ownerAddress)=&gt;{<br/>const proprietiesHash = await mamManage.fetch(_root)<br/>const currentPropretiesString = await catIPFS.execute(getLastHash(proprietiesHash))<br/>const currentPropretiesJSON = JSON.parse(currentPropretiesString)<br/>currentPropretiesJSON[productAddress].owner = ownerAddress<br/>const newPropretiesHash = await addIPFS.execute(currentPropretiesJSON)<br/>const root = await mamManage.send(newPropretiesHash)<br/>return root<br/>}</span></pre><p id="0f8d" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">“给予奖励”后调用将发送奖励给产品的所有者。</p><p id="6ac0" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">路线:</p><pre class="kt ku kv kw fq ll lm ln lo aw lp dt"><span id="fed2" class="lq jq ht lm b fv lr ls l lt lu">app.route('/giveReward')<br/>.post(recycler.giveReward);</span></pre><p id="2899" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">控制器:</p><pre class="kt ku kv kw fq ll lm ln lo aw lp dt"><span id="39a7" class="lq jq ht lm b fv lr ls l lt lu">exports.giveReward = async (req,res) =&gt;{<br/>const response = await giveReward.execute(req.body.root,req.body.productAddress)<br/>res.json(response)<br/>}</span></pre><p id="8d8e" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">实施:</p><pre class="kt ku kv kw fq ll lm ln lo aw lp dt"><span id="e288" class="lq jq ht lm b fv lr ls l lt lu">const sendToken = require('./sendToken')<br/>const fetchToMap = require('./fetchToMap')<br/>giveRewards = async(root,productAddress) =&gt;{<br/>const OwnerAddrress = await fetchToMap.execute(root)<br/>console.log(OwnerAddrress[productAddress].owner)<br/>await  sendToken.execute(OwnerAddrress[productAddress].owner,1)<br/>return "Send 1 i. Congrats"<br/>}</span></pre><h1 id="8cda" class="jp jq ht bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km dt translated">演示</h1><p id="e0c7" class="pw-post-body-paragraph iq ir ht is b it kn iv iw ix ko iz ja jb kp jd je jf kq jh ji jj kr jl jm jn hm dt translated">现在，为了展示我的项目，我为消费者和智能垃圾制作了一个android应用程序。短视频(1:16)</p><div class="lw lx fm fo ly lz"><a href="https://drive.google.com/file/d/1IBTMFGMtq1qYzt7-xjbmmavqh8U8aToB/view?usp=sharing" rel="noopener  ugc nofollow" target="_blank"><div class="ma ab ej"><div class="mb ab mc cl cj md"><h2 class="bd hu fv z el me eo ep mf er et hs dt translated">20191230_014822.mp4</h2><div class="mg l"><h3 class="bd b fv z el me eo ep mf er et ek translated">编辑描述</h3></div><div class="mh l"><p class="bd b gc z el me eo ep mf er et ek translated">drive.google.com</p></div></div><div class="mi l"><div class="mj l mk ml mm mi mn lc lz"/></div></div></a></div><p id="a5f6" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">你可以在下面的资源库中找到android应用和API:<a class="ae jo" href="https://github.com/yehia67/Recycling-System-IOTA" rel="noopener ugc nofollow" target="_blank">https://github.com/yehia67/Recycling-System-IOTA</a></p><p id="d9a7" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated"><strong class="is hu">下一步做什么</strong></p><p id="d03b" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">在下一个版本中，我将把Datamarketplace和accountHub添加到我的项目中来创建一个完整的系统，并可能使用ESP32来处理智能垃圾桶。</p><blockquote class="mo"><p id="60ed" class="mp mq ht bd mr ms mt mu mv mw mx jn ek translated"><a class="ae jo" href="https://coincodecap.com/?utm_source=coinmonks" rel="noopener ugc nofollow" target="_blank">直接在您的收件箱中获得最佳软件交易</a></p></blockquote><figure class="mz na nb nc nd kx fe ff paragraph-image"><a href="https://coincodecap.com/?utm_source=coinmonks"><div class="fe ff my"><img src="../Images/7c0b3dfdcbfea594cc0ae7d4f9bf6fcb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1168/format:webp/0*OJ-qb5G6i863msBB.png"/></div></a></figure><figure class="kt ku kv kw fq kx fe ff paragraph-image"><a href="https://coincodecap.com"><div class="fe ff ne"><img src="../Images/673b3528e0b341cca62769c9baa632cd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bcTJUjFtXf1QtlWzlS04XQ.jpeg"/></div></a></figure></div></div>    
</body>
</html>