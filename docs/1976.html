<html>
<head>
<title>Hyperledger Fabric By Example: Part 6</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">超分类帐结构示例:第6部分</h1>
<blockquote>原文：<a href="https://medium.com/coinmonks/hyperledger-fabric-by-example-part-6-591d89158940?source=collection_archive---------1-----------------------#2019-01-15">https://medium.com/coinmonks/hyperledger-fabric-by-example-part-6-591d89158940?source=collection_archive---------1-----------------------#2019-01-15</a></blockquote><div><div class="ef hh hi hj hk hl"/><div class="hm hn ho hp hq"><div class=""/><div class=""><h2 id="b581" class="pw-subtitle-paragraph iq hs ht bd b ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ek translated">通过探索chaincode结束本系列。</h2></div><figure class="jj jk jl jm fq jn fe ff paragraph-image"><div role="button" tabindex="0" class="jo jp di jq bf jr"><div class="fe ff ji"><img src="../Images/214f1ce0da2b96693e553965f121bf28.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TbwyYRjpwZxSCliGumQfow.jpeg"/></div></div></figure><p id="5097" class="pw-post-body-paragraph ju jv ht jw b jx jy iu jz ka kb ix kc kd ke kf kg kh ki kj kk kl km kn ko kp hm dt translated">本文是以<a class="ae kq" rel="noopener" href="/@johntucker_48673/hyperledger-fabric-by-example-part-1-758547e9fb04"><em class="kr">Hyperledger Fabric By Example:Part 1</em></a>开始的系列文章的一部分。</p><p id="c0b7" class="pw-post-body-paragraph ju jv ht jw b jx jy iu jz ka kb ix kc kd ke kf kg kh ki kj kk kl km kn ko kp hm dt translated"><strong class="jw hu">链码</strong></p><p id="7754" class="pw-post-body-paragraph ju jv ht jw b jx jy iu jz ka kb ix kc kd ke kf kg kh ki kj kk kl km kn ko kp hm dt translated">现在我们有了分布式账本，我们可以开始做一些有趣的事情；使用<strong class="jw hu">链码</strong>。</p><blockquote class="ks kt ku"><p id="ab2a" class="ju jv kr jw b jx jy iu jz ka kb ix kc kv ke kf kg kw ki kj kk kx km kn ko kp hm dt translated">智能合约是由区块链网络外部的客户端应用程序调用的代码，它管理对世界状态中的一组键值对的访问和修改。在Hyperledger Fabric中，智能合同被称为链码。智能合同链代码被安装到对等节点上，并被实例化到一个或多个通道。</p></blockquote><p id="f528" class="pw-post-body-paragraph ju jv ht jw b jx jy iu jz ka kb ix kc kd ke kf kg kh ki kj kk kl km kn ko kp hm dt translated"><em class="kr">—Hyperledger Fabric—</em><a class="ae kq" href="https://hyperledger-fabric.readthedocs.io/en/latest/glossary.html#smart-contract" rel="noopener ugc nofollow" target="_blank"><em class="kr">词汇表</em> </a></p><p id="f3a2" class="pw-post-body-paragraph ju jv ht jw b jx jy iu jz ka kb ix kc kd ke kf kg kh ki kj kk kl km kn ko kp hm dt translated">以下示例严格遵循<em class="kr"> Hyperledger Fabric </em>文档中描述的概念(<strong class="jw hu">在继续</strong>之前阅读)。</p><ul class=""><li id="76a3" class="ky kz ht jw b jx jy ka kb kd la kh lb kl lc kp ld le lf lg dt translated"><a class="ae kq" href="https://hyperledger-fabric.readthedocs.io/en/latest/network/network.html#applications-and-smart-contract-chaincode" rel="noopener ugc nofollow" target="_blank">应用程序和智能合同链代码</a></li><li id="1187" class="ky kz ht jw b jx lh ka li kd lj kh lk kl ll kp ld le lf lg dt translated"><a class="ae kq" href="https://hyperledger-fabric.readthedocs.io/en/latest/network/network.html#installing-a-smart-contract" rel="noopener ugc nofollow" target="_blank">安装智能合同</a></li><li id="29c1" class="ky kz ht jw b jx lh ka li kd lj kh lk kl ll kp ld le lf lg dt translated"><a class="ae kq" href="https://hyperledger-fabric.readthedocs.io/en/latest/network/network.html#instantiating-a-smart-contract" rel="noopener ugc nofollow" target="_blank">实例化智能合同</a></li><li id="2e8b" class="ky kz ht jw b jx lh ka li kd lj kh lk kl ll kp ld le lf lg dt translated"><a class="ae kq" href="https://hyperledger-fabric.readthedocs.io/en/latest/network/network.html#endorsement-policy" rel="noopener ugc nofollow" target="_blank">背书政策</a></li></ul><p id="46f7" class="pw-post-body-paragraph ju jv ht jw b jx jy iu jz ka kb ix kc kd ke kf kg kh ki kj kk kl km kn ko kp hm dt translated">在本例中，我们将在<em class="kr">peer0.org1.example.com</em>和<em class="kr">peer0.org2.example.com</em>上安装一个<em class="kr"> Node.js </em> chaincode，又名智能合约，名为<em class="kr"> mycc </em>。然后我们在通道<em class="kr"> mychannel </em>上实例化它。</p><figure class="jj jk jl jm fq jn fe ff paragraph-image"><div role="button" tabindex="0" class="jo jp di jq bf jr"><div class="fe ff lm"><img src="../Images/8f69691ddf28926257e8a2093c2d0d0f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FL4bfrilQTscaYTujrw0uw.png"/></div></div></figure><p id="c40d" class="pw-post-body-paragraph ju jv ht jw b jx jy iu jz ka kb ix kc kd ke kf kg kh ki kj kk kl km kn ko kp hm dt translated">使用CLI容器:</p><pre class="jj jk jl jm fq ln lo lp lq aw lr dt"><span id="8abd" class="ls lt ht lo b fv lu lv l lw lx">docker exec -it cli bash</span></pre><p id="672f" class="pw-post-body-paragraph ju jv ht jw b jx jy iu jz ka kb ix kc kd ke kf kg kh ki kj kk kl km kn ko kp hm dt translated">我们执行以下命令将链码安装到<em class="kr">peer0.org1.example.com</em>上:</p><pre class="jj jk jl jm fq ln lo lp lq aw lr dt"><span id="6d9a" class="ls lt ht lo b fv lu lv l lw lx">peer chaincode install <strong class="lo hu">-</strong>n mycc <strong class="lo hu">-</strong>v 1.0 <strong class="lo hu">-</strong>l node <strong class="lo hu">-</strong>p <strong class="lo hu">/</strong>opt<strong class="lo hu">/</strong>gopath<strong class="lo hu">/</strong>src<strong class="lo hu">/</strong>github<strong class="lo hu">.</strong>com<strong class="lo hu">/</strong>chaincode<strong class="lo hu">/</strong>chaincode_example02<strong class="lo hu">/</strong>node<strong class="lo hu">/</strong></span></pre><p id="ed46" class="pw-post-body-paragraph ju jv ht jw b jx jy iu jz ka kb ix kc kd ke kf kg kh ki kj kk kl km kn ko kp hm dt translated">和以前一样，我们设置环境变量并在<em class="kr">peer0.org2.example.com</em>上执行:</p><pre class="jj jk jl jm fq ln lo lp lq aw lr dt"><span id="3647" class="ls lt ht lo b fv lu lv l lw lx">CORE_PEER_MSPCONFIGPATH=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org2.example.com/users/Admin@org2.example.com/msp CORE_PEER_ADDRESS=peer0.org2.example.com:7051 CORE_PEER_LOCALMSPID="Org2MSP" CORE_PEER_TLS_ROOTCERT_FILE=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org2.example.com/peers/peer0.org2.example.com/tls/ca.crt peer chaincode install <strong class="lo hu">-</strong>n mycc <strong class="lo hu">-</strong>v 1.0 <strong class="lo hu">-</strong>l node <strong class="lo hu">-</strong>p <strong class="lo hu">/</strong>opt<strong class="lo hu">/</strong>gopath<strong class="lo hu">/</strong>src<strong class="lo hu">/</strong>github<strong class="lo hu">.</strong>com<strong class="lo hu">/</strong>chaincode<strong class="lo hu">/</strong>chaincode_example02<strong class="lo hu">/</strong>node<strong class="lo hu">/</strong></span></pre><p id="a3a8" class="pw-post-body-paragraph ju jv ht jw b jx jy iu jz ka kb ix kc kd ke kf kg kh ki kj kk kl km kn ko kp hm dt translated">我们执行以下命令来实例化通道上的链码。</p><pre class="jj jk jl jm fq ln lo lp lq aw lr dt"><span id="2064" class="ls lt ht lo b fv lu lv l lw lx">peer chaincode instantiate -o orderer.example.com:7050 --tls --cafile /opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/ordererOrganizations/example.com/orderers/orderer.example.com/msp/tlscacerts/tlsca.example.com-cert.pem -C mychannel -n mycc -l node -v 1.0 -c '{"Args":["init","a", "100", "b","200"]}' -P "AND ('Org1MSP.peer','Org2MSP.peer')"</span></pre><p id="0fb7" class="pw-post-body-paragraph ju jv ht jw b jx jy iu jz ka kb ix kc kd ke kf kg kh ki kj kk kl km kn ko kp hm dt translated"><strong class="jw hu">注意</strong>:<em class="kr">node . js</em>chain code的实例化大约需要一分钟。命令没有挂起；相反，它是在编译映像时安装<em class="kr"> fabric-shim </em>层。</p><p id="48d1" class="pw-post-body-paragraph ju jv ht jw b jx jy iu jz ka kb ix kc kd ke kf kg kh ki kj kk kl km kn ko kp hm dt translated">让我们看一看链码本身。通过检查CLI容器配置，我们可以看到以下代码:</p><p id="71cc" class="pw-post-body-paragraph ju jv ht jw b jx jy iu jz ka kb ix kc kd ke kf kg kh ki kj kk kl km kn ko kp hm dt translated"><em class="kr">。/chain code/chain code _ example 02/node/package . JSON</em></p><figure class="jj jk jl jm fq jn"><div class="bz el l di"><div class="ly lz l"/></div></figure><p id="29c9" class="pw-post-body-paragraph ju jv ht jw b jx jy iu jz ka kb ix kc kd ke kf kg kh ki kj kk kl km kn ko kp hm dt translated"><em class="kr">。/chain code/chain code _ example 02/node/chain code _ example 02 . js</em></p><figure class="jj jk jl jm fq jn"><div class="bz el l di"><div class="ly lz l"/></div></figure><p id="d55d" class="pw-post-body-paragraph ju jv ht jw b jx jy iu jz ka kb ix kc kd ke kf kg kh ki kj kk kl km kn ko kp hm dt translated">观察结果:</p><ul class=""><li id="447b" class="ky kz ht jw b jx jy ka kb kd la kh lb kl lc kp ld le lf lg dt translated">老实说，这段代码在做什么并不太清楚。<em class="kr">Hyperledger</em><a class="ae kq" href="https://hyperledger-fabric.readthedocs.io/en/latest/write_first_app.html#" rel="noopener ugc nofollow" target="_blank"><em class="kr">Fabric编写你的第一个应用</em> </a>有一个编写链码的更好的例子和解释</li></ul><p id="f2a6" class="pw-post-body-paragraph ju jv ht jw b jx jy iu jz ka kb ix kc kd ke kf kg kh ki kj kk kl km kn ko kp hm dt translated">最后，我们用下面的命令执行chaincode(在本例中是<em class="kr">查询</em>方法):</p><pre class="jj jk jl jm fq ln lo lp lq aw lr dt"><span id="ac06" class="ls lt ht lo b fv lu lv l lw lx">peer chaincode query -C mychannel  -n mycc -c '{"Args":["query","a"]}'</span></pre><p id="7ece" class="pw-post-body-paragraph ju jv ht jw b jx jy iu jz ka kb ix kc kd ke kf kg kh ki kj kk kl km kn ko kp hm dt translated">它会将数字<em class="kr"> 100 </em>记录到屏幕上。</p><p id="8558" class="pw-post-body-paragraph ju jv ht jw b jx jy iu jz ka kb ix kc kd ke kf kg kh ki kj kk kl km kn ko kp hm dt translated"><strong class="jw hu">总结</strong></p><p id="455e" class="pw-post-body-paragraph ju jv ht jw b jx jy iu jz ka kb ix kc kd ke kf kg kh ki kj kk kl km kn ko kp hm dt translated">虽然我发现<em class="kr"> Hyperledger Fabric </em>的概念非常有趣，但是实现起来有点粗糙；配置的大量盲目复制粘贴。我猜这是一个新项目，可能会随着时间的推移迅速改善。</p><p id="b47c" class="pw-post-body-paragraph ju jv ht jw b jx jy iu jz ka kb ix kc kd ke kf kg kh ki kj kk kl km kn ko kp hm dt translated">也就是说，我们确实完成了逆向工程的目标<em class="kr">构建您的第一个网络示例</em>教程。</p><figure class="jj jk jl jm fq jn fe ff paragraph-image"><a href="http://bit.ly/2G71Sp7"><div class="fe ff ma"><img src="../Images/449450761cd76f44f9ae574333f9e9af.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fKX2mtg7p1lOs7JmosPLsA.png"/></div></a></figure><blockquote class="mb"><p id="c86a" class="mc md ht bd me mf mg mh mi mj mk kp ek translated"><a class="ae kq" href="https://coincodecap.com/?utm_source=coinmonks" rel="noopener ugc nofollow" target="_blank">直接在您的收件箱中获得最佳软件交易</a></p></blockquote><figure class="mm mn mo mp mq jn fe ff paragraph-image"><a href="https://coincodecap.com/?utm_source=coinmonks"><div class="fe ff ml"><img src="../Images/7c0b3dfdcbfea594cc0ae7d4f9bf6fcb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1168/format:webp/0*OJ-qb5G6i863msBB.png"/></div></a></figure></div></div>    
</body>
</html>