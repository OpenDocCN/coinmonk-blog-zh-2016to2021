<html>
<head>
<title>UselessEthereumToken(UET), ERC20 token, allows attackers to steal all victim’s balances (CVE-2018–10468)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">UselessEthereumToken(UET)，ERC20令牌，允许攻击者窃取所有受害者的余额(CVE-2018–10468)</h1>
<blockquote>原文：<a href="https://medium.com/coinmonks/uselessethereumtoken-uet-erc20-token-allows-attackers-to-steal-all-victims-balances-543d42ac808e?source=collection_archive---------1-----------------------#2018-05-03">https://medium.com/coinmonks/uselessethereumtoken-uet-erc20-token-allows-attackers-to-steal-all-victims-balances-543d42ac808e?source=collection_archive---------1-----------------------#2018-05-03</a></blockquote><div><div class="ef hh hi hj hk hl"/><div class="hm hn ho hp hq"><div class=""/><h1 id="054e" class="iq ir ht bd is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn dt translated">摘要</h1><p id="757c" class="pw-post-body-paragraph jo jp ht jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl hm dt translated">我发现了一个UselessEthereumToken(UET)的智能合约的漏洞，一个以太坊ERC20令牌(<a class="ae km" href="http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2018-10468" rel="noopener ugc nofollow" target="_blank"><strong class="jq hu">CVE-2018–10468</strong></a>)【1】。由于<em class="kn"> transferFrom </em>函数中有一个错误的if语句，攻击者可以窃取受害者账户中的所有余额。</p><blockquote class="ko"><p id="2c44" class="kp kq ht bd kr ks kt ku kv kw kx kl ek translated"><a class="ae km" href="https://coincodecap.com" rel="noopener ugc nofollow" target="_blank">发现并回顾最佳区块链软件</a></p></blockquote><h1 id="2686" class="iq ir ht bd is it iu iv iw ix iy iz ja jb ky jd je jf kz jh ji jj la jl jm jn dt translated">细节</h1><p id="96c7" class="pw-post-body-paragraph jo jp ht jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl hm dt translated">在ERC20令牌标准中，对函数的<em class="kn">转移定义如下<a class="ae km" href="https://github.com/ethereum/EIPs/blob/master/EIPS/eip-20.md#transferfrom" rel="noopener ugc nofollow" target="_blank">【2】</a>:</em></p><blockquote class="lb lc ld"><p id="4a58" class="jo jp kn jq b jr le jt ju jv lf jx jy lg lh kb kc li lj kf kg lk ll kj kk kl hm dt translated">将<code class="eh lm ln lo lp b">_value</code>数量的令牌从地址<code class="eh lm ln lo lp b">_from</code>转移到地址<code class="eh lm ln lo lp b">_to</code>，并且必须触发<code class="eh lm ln lo lp b">Transfer</code>事件。</p></blockquote><p id="e1ca" class="pw-post-body-paragraph jo jp ht jq b jr le jt ju jv lf jx jy jz lh kb kc kd lj kf kg kh ll kj kk kl hm dt translated">它最多将地址<code class="eh lm ln lo lp b">_from</code>的余额转移到地址<code class="eh lm ln lo lp b">_to</code>的<code class="eh lm ln lo lp b">_allowed[_from][msg.sender]</code>。这是从功能转移而来的<em class="kn">的原始功能。</em></p><figure class="lr ls lt lu fq lv fe ff paragraph-image"><div role="button" tabindex="0" class="lw lx di ly bf lz"><div class="fe ff lq"><img src="../Images/74b6194b52f92e6d471fc51c963af534.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*thfif-WBcAntLgGulkFpuA.png"/></div></div><figcaption class="mc md fg fe ff me mf bd b be z ek">Figure 1. Code of transferFrom function in UET smart contract</figcaption></figure><p id="fdd3" class="pw-post-body-paragraph jo jp ht jq b jr le jt ju jv lf jx jy jz lh kb kc kd lj kf kg kh ll kj kk kl hm dt translated">但是，如图1所示，UET智能合约中的<em class="kn">transfer被加上了<a class="ae km" href="https://etherscan.io/address/0x27f706edde3aD952EF647Dd67E24e38CD0803DD6#code" rel="noopener ugc nofollow" target="_blank">【3】</a>。通过上面的代码，如果<code class="eh lm ln lo lp b">balances[to] + _value</code>溢出，用户可以传输比地址<code class="eh lm ln lo lp b">_from</code>更多的余额。应按如下方式进行固定:</em></p><pre class="lr ls lt lu fq mg lp mh mi aw mj dt"><span id="a657" class="mk ir ht lp b fv ml mm l mn mo">bool sufficientFunds = fromBalance <strong class="lp hu">&gt;=</strong> _value;<br/>bool sufficientAllowance = allowance <strong class="lp hu">&gt;=</strong> _value;<br/>bool overflowed = balances[_to] + _value &gt; balances[_to];</span><span id="e2d9" class="mk ir ht lp b fv mp mm l mn mo">if (sufficientFunds &amp;&amp; sufficientAllowance &amp;&amp; <strong class="lp hu">overflowed</strong>) {</span></pre><p id="fda1" class="pw-post-body-paragraph jo jp ht jq b jr le jt ju jv lf jx jy jz lh kb kc kd lj kf kg kh ll kj kk kl hm dt translated">两个不等式的方向应该改变和'！'if条件中的'<em class="kn">前溢出的</em>变量应移除。</p><h2 id="138b" class="mk ir ht bd is mq mr ms iw mt mu mv ja jz mw mx je kd my mz ji kh na nb jm nc dt translated">攻击者能做什么？</h2><p id="23b5" class="pw-post-body-paragraph jo jp ht jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl hm dt translated">攻击者可以将目标地址的余额窃取到他的地址中。他们只需选择足够大的<code class="eh lm ln lo lp b">_value</code>来设置<code class="eh lm ln lo lp b">overflowed</code>变量为假，并选择<code class="eh lm ln lo lp b">_to</code>作为他的地址。如果攻击者发送带有这些参数的事务，第60行的If语句的条件将被通过，然后余额将被操纵。</p><h2 id="9408" class="mk ir ht bd is mq mr ms iw mt mu mv ja jz mw mx je kd my mz ji kh na nb jm nc dt translated">利用</h2><p id="1a72" class="pw-post-body-paragraph jo jp ht jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl hm dt translated">好像已经被人剥削过几次了。我发现了两个试图转移大量令牌的漏洞利用交易<a class="ae km" href="https://etherscan.io/tx/0x122ee230d86cea0d1c1df42599e722a849067598777a0f43ccf83b12d0dfd485" rel="noopener ugc nofollow" target="_blank">【4】</a><a class="ae km" href="https://etherscan.io/tx/0x50a100eaf74469520177db55ea28f6046492034fdf5f5d264768d87c60ec3f3b" rel="noopener ugc nofollow" target="_blank">【5】</a>。</p><figure class="lr ls lt lu fq lv fe ff paragraph-image"><div role="button" tabindex="0" class="lw lx di ly bf lz"><div class="fe ff nd"><img src="../Images/576f14ce953c064446cfce26dd42438b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qldtehwUVIiY0CLRaXdvjQ.png"/></div></div><figcaption class="mc md fg fe ff me mf bd b be z ek">Figure 2. Exploit transaction at 04/20/2018</figcaption></figure><figure class="lr ls lt lu fq lv fe ff paragraph-image"><div role="button" tabindex="0" class="lw lx di ly bf lz"><div class="fe ff ne"><img src="../Images/eeaad6ae76c981ad8074ba4370b325d3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JYtA_TSSUv1c63dtF9PVew.png"/></div></div><figcaption class="mc md fg fe ff me mf bd b be z ek">Figure 3. Exploit transaction at 04/27/2018</figcaption></figure><h1 id="3241" class="iq ir ht bd is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn dt translated">UET代币是骗局？</h1><p id="3634" class="pw-post-body-paragraph jo jp ht jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl hm dt translated">发现这个漏洞后，我访问了无用以太币令牌<a class="ae km" href="https://uetoken.com" rel="noopener ugc nofollow" target="_blank">【6】</a>的官方主页。在页面中，他们说“说真的，<em class="kn">不要买这些代币</em>”</p><figure class="lr ls lt lu fq lv fe ff paragraph-image"><div role="button" tabindex="0" class="lw lx di ly bf lz"><div class="fe ff nf"><img src="../Images/ce78197fd832bde6e32d21a5256070f7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*s7y97NP4crpeVP73Z8DtGg.png"/></div></div><figcaption class="mc md fg fe ff me mf bd b be z ek">Figure 4. Offical page of UET token</figcaption></figure><p id="8a74" class="pw-post-body-paragraph jo jp ht jq b jr le jt ju jv lf jx jy jz lh kb kc kd lj kf kg kh ll kj kk kl hm dt translated">如果你访问官方网页，并阅读该网页上的所有文字，你可以意识到这是骗局。但是，开发者老老实实的说，不要买，因为这个代币没有任何价值。然而，许多人购买了UET代币，在众筹期间，它收集了大约310.445以太币(这些天大约226，274美元)。而且在HitBTC交易所<a class="ae km" href="https://hitbtc.com/UET-to-ETH" rel="noopener ugc nofollow" target="_blank">【7】</a>(目前不提供存取款)。</p><h1 id="d099" class="iq ir ht bd is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn dt translated">报告</h1><p id="2b71" class="pw-post-body-paragraph jo jp ht jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl hm dt translated">我向ethereum.org UET代币的开发商报告了此事，并获得了CVE身份证。大约在同一时间，Peckshiled团队报告了此事，并获得了与我相同的CVE id。他们已经在我之前发表了一篇文章。CVE团队确认我先报告，30小时后Peckshied发出请求。所以CVE团队给了我和Peckshiled一个相同的CVE id，但是Peckshiled在我之前发表了他们的文章。</p><h1 id="be50" class="iq ir ht bd is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn dt translated">结论</h1><p id="675d" class="pw-post-body-paragraph jo jp ht jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl hm dt translated">开发者总是应该注意不平等的方向。有时，它会在智能合同以及许多其他软件中造成严重的安全漏洞。然而，在这种情况下，我强烈怀疑这是一个故意的错误。因此，人们在购买加密令牌时应该小心。</p><h1 id="e613" class="iq ir ht bd is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn dt translated">参考</h1><ul class=""><li id="470d" class="ng nh ht jq b jr js jv jw jz ni kd nj kh nk kl nl nm nn no dt translated">[1]http://cve.mitre.org/cgi-bin/cvename.cgi? CVE-2018–10468:<a class="ae km" href="http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2018-10468" rel="noopener ugc nofollow" target="_blank">name=CVE-2018-10468 </a></li><li id="4014" class="ng nh ht jq b jr np jv nq jz nr kd ns kh nt kl nl nm nn no dt translated">[2]ERC 20令牌标准中的transfer from:<a class="ae km" href="https://github.com/ethereum/EIPs/blob/master/EIPS/eip-20.md#transferfrom" rel="noopener ugc nofollow" target="_blank">https://github . com/ether eum/EIPs/blob/master/EIPS/EIP-20 . MD # transfer from</a></li><li id="46f8" class="ng nh ht jq b jr np jv nq jz nr kd ns kh nt kl nl nm nn no dt translated">[3]UET智能合约代码:<a class="ae km" href="https://etherscan.io/address/0x27f706edde3aD952EF647Dd67E24e38CD0803DD6#code" rel="noopener ugc nofollow" target="_blank">https://ethers can . io/address/0x 27 f 706 edde 3 ad 952 ef 647 DD 67 e 24 e 38 CD 0803 DD 6 #代码</a></li><li id="3589" class="ng nh ht jq b jr np jv nq jz nr kd ns kh nt kl nl nm nn no dt translated">[4]2018年04月20日的一次漏洞利用交易:<a class="ae km" href="https://etherscan.io/tx/0x122ee230d86cea0d1c1df42599e722a849067598777a0f43ccf83b12d0dfd485" rel="noopener ugc nofollow" target="_blank">https://ethers can . io/tx/0x 122 ee 230d 86 ce A0 D1 C1 df 42599 e 722 a 849067598777 a 0 f 43 CCF 83 b 12d 0 DFD 485</a></li><li id="4ead" class="ng nh ht jq b jr np jv nq jz nr kd ns kh nt kl nl nm nn no dt translated">[5]2018年04月27日的一次漏洞利用交易:<a class="ae km" href="https://etherscan.io/tx/0x50a100eaf74469520177db55ea28f6046492034fdf5f5d264768d87c60ec3f3b" rel="noopener ugc nofollow" target="_blank">https://ethers can . io/tx/0x 50 a 100 EAF 74469520177 db 55 ea 28 f 6046492034 fdf 5d 264768d 87 c 60 EC 3 F3 b</a></li><li id="fadf" class="ng nh ht jq b jr np jv nq jz nr kd ns kh nt kl nl nm nn no dt translated">[6]无用以太坊令牌官方页面:【https://uetoken.com】T4</li><li id="e794" class="ng nh ht jq b jr np jv nq jz nr kd ns kh nt kl nl nm nn no dt translated">[7]hit BTC中的UET:<a class="ae km" href="https://hitbtc.com/UET-to-ETH" rel="noopener ugc nofollow" target="_blank">https://hitbtc.com/UET-to-ETH</a></li><li id="f94b" class="ng nh ht jq b jr np jv nq jz nr kd ns kh nt kl nl nm nn no dt translated">[8] Peckshiled的帖子:<a class="ae km" rel="noopener" href="/@peckshield/your-tokens-are-mine-a-suspicious-scam-token-in-a-top-exchange-5e864075f7e9">https://medium . com/@ peck shield/your-tokens-is-mine-a-suspective-scam-token-in-a-top-exchange-5e 864075 f7e 9</a></li></ul></div></div>    
</body>
</html>