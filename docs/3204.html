<html>
<head>
<title>Canceling lots of Ethereum Transactions using CLI tools (seth, geth)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用CLI工具取消大量以太坊交易(seth，geth)</h1>
<blockquote>原文：<a href="https://medium.com/coinmonks/cancelling-lots-of-ethereum-transactions-using-cli-tools-seth-geth-5d2c9d4d39a5?source=collection_archive---------0-----------------------#2020-07-26">https://medium.com/coinmonks/cancelling-lots-of-ethereum-transactions-using-cli-tools-seth-geth-5d2c9d4d39a5?source=collection_archive---------0-----------------------#2020-07-26</a></blockquote><div><div class="ef hh hi hj hk hl"/><div class="hm hn ho hp hq"><div class=""/><figure class="fi fk ir is it iu fe ff paragraph-image"><div role="button" tabindex="0" class="iv iw di ix bf iy"><div class="fe ff iq"><img src="../Images/3a04e65fd62a258017096baee6f69a2f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9_s5fvSOQeeo3QXRW6zkVA.jpeg"/></div></div><figcaption class="jb jc fg fe ff jd je bd b be z ek">Gas price is too damn high</figcaption></figure><p id="9070" class="pw-post-body-paragraph jf jg ht jh b ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc hm dt translated">这是一个动荡的时代，以太币价格比比特币价格更不稳定。你含泪发送短信，但他们仍然在天然气价格竞争中失败，并被困太久。你想取消它们。</p><p id="5ef6" class="pw-post-body-paragraph jf jg ht jh b ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc hm dt translated">如果你使用的是浏览器工具，比如<a class="ae kd" href="https://metamask.zendesk.com/hc/en-us/articles/360015489251-How-to-Speed-Up-or-Cancel-a-Pending-Transaction" rel="noopener ugc nofollow" target="_blank"> Metamask </a>或者<a class="ae kd" href="https://support.mycrypto.com/how-to/sending/checking-or-replacing-a-transaction-after-it-has-been-sent#canceling-a-transaction" rel="noopener ugc nofollow" target="_blank"> MyCrypto </a>，你可以通过它自己的UI来完成；但是，如果您更喜欢以批处理或更可组合的方式来完成，下面是如何在命令行中完成。</p></div><div class="ab cl ke kf hb kg" role="separator"><span class="kh bw bk ki kj kk"/><span class="kh bw bk ki kj kk"/><span class="kh bw bk ki kj"/></div><div class="hm hn ho hp hq"><p id="9d57" class="pw-post-body-paragraph jf jg ht jh b ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc hm dt translated">您需要在系统中安装两个包:<code class="eh kl km kn ko b">geth</code> &amp; <code class="eh kl km kn ko b">seth</code>和一个以太坊JSON-RPC端点。</p><p id="e2e9" class="pw-post-body-paragraph jf jg ht jh b ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc hm dt translated">端点可以是像<a class="ae kd" href="https://infura.io/" rel="noopener ugc nofollow" target="_blank"> Infura </a>这样的云服务，也可以是你自己运行<code class="eh kl km kn ko b">geth</code>的全节点。如何设置Infura或运行一个完整节点超出了本文的范围，所以接下来我们将假设您已经准备好了上述端点之一。</p><p id="d178" class="pw-post-body-paragraph jf jg ht jh b ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc hm dt translated"><code class="eh kl km kn ko b">geth</code>如上所述，是最流行的以太坊全节点软件之一。但是我们不一定要运行全节点；我们只是用它来管理钱包，这样你的私人密钥就可以安全地保存在本地。</p><p id="5c44" class="pw-post-body-paragraph jf jg ht jh b ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc hm dt translated"><code class="eh kl km kn ko b">seth</code>是一个CLI封装器，用于发送以太坊JSON-RPC请求。它在<code class="eh kl km kn ko b">geth</code>中搜索你的钱包，并向Infura或你自己的<code class="eh kl km kn ko b">geth</code>全节点发送tx。</p><h1 id="9184" class="kp kq ht bd kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm dt translated">安装geth并导入您的钱包</h1><p id="f3f6" class="pw-post-body-paragraph jf jg ht jh b ji ln jk jl jm lo jo jp jq lp js jt ju lq jw jx jy lr ka kb kc hm dt translated"><code class="eh kl km kn ko b">geth</code>的官方<a class="ae kd" href="https://geth.ethereum.org/docs/install-and-build/installing-geth" rel="noopener ugc nofollow" target="_blank">维基</a>有在各种操作系统上安装的详细说明。安装后，您可以通过CLI导入您的钱包。</p><p id="8874" class="pw-post-body-paragraph jf jg ht jh b ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc hm dt translated">将您的私钥放在一个文本文件中(例如<code class="eh kl km kn ko b">/path/to/your/private-key</code>)。请注意，这是临时的，为了安全起见，我们稍后将删除该文件。私钥<strong class="jh hu">也不应该</strong>有<code class="eh kl km kn ko b">0x</code>前缀。</p><p id="e18f" class="pw-post-body-paragraph jf jg ht jh b ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc hm dt translated">接下来，用下面的命令导入它。您将被要求输入密码以保护钱包:</p><pre class="ls lt lu lv fq lw ko lx ly aw lz dt"><span id="63ab" class="ma kq ht ko b fv mb mc l md me">$ geth account import /path/to/your/private-key</span><span id="5a07" class="ma kq ht ko b fv mf mc l md me">INFO [07-25|15:37:07.145] Maximum peer count                       ETH=50 LES=0 total=50</span><span id="492d" class="ma kq ht ko b fv mf mc l md me">Your new account is locked with a password. Please give a password. Do not forget this password.</span><span id="08b7" class="ma kq ht ko b fv mf mc l md me">Password:</span><span id="befc" class="ma kq ht ko b fv mf mc l md me">Repeat password:</span></pre><p id="5b8a" class="pw-post-body-paragraph jf jg ht jh b ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc hm dt translated">现在您可以安全地删除<code class="eh kl km kn ko b">/path/to/your/private-key</code>，因为它已经被导入并安全地存储在<code class="eh kl km kn ko b">geth</code>中，并且您可能不想继续将您的私钥保存在一个纯文本文件中。</p><h1 id="927e" class="kp kq ht bd kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm dt translated">安装seth</h1><p id="7df5" class="pw-post-body-paragraph jf jg ht jh b ji ln jk jl jm lo jo jp jq lp js jt ju lq jw jx jy lr ka kb kc hm dt translated">在安装<code class="eh kl km kn ko b">seth</code>之前，你需要安装它的依赖项<code class="eh kl km kn ko b">nix</code>，这可以在一行程序中完成；然而，在撰写本文时，在较新的Mac OS(如10.15 Catalina及更高版本)中安装<code class="eh kl km kn ko b">nix</code>需要一些额外的设置，所以:</p><p id="ac82" class="pw-post-body-paragraph jf jg ht jh b ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc hm dt translated">对于10.15之前的非Mac OS或更早的Mac OS:</p><pre class="ls lt lu lv fq lw ko lx ly aw lz dt"><span id="aae7" class="ma kq ht ko b fv mb mc l md me">sh &lt;(curl -L <a class="ae kd" href="https://nixos.org/nix/install" rel="noopener ugc nofollow" target="_blank">https://nixos.org/nix/install</a>)</span></pre><p id="4fc6" class="pw-post-body-paragraph jf jg ht jh b ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc hm dt translated">对于Mac OS 10.15及更高版本:</p><pre class="ls lt lu lv fq lw ko lx ly aw lz dt"><span id="186e" class="ma kq ht ko b fv mb mc l md me">sh &lt;(curl -L <a class="ae kd" href="https://nixos.org/nix/install" rel="noopener ugc nofollow" target="_blank">https://nixos.org/nix/install</a>) --darwin-use-unencrypted-nix-store-volume</span></pre><p id="3ea7" class="pw-post-body-paragraph jf jg ht jh b ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc hm dt translated">一旦<code class="eh kl km kn ko b">nix</code>安装完毕，你就可以用另一个单命令行程序安装<code class="eh kl km kn ko b">seth</code>:</p><pre class="ls lt lu lv fq lw ko lx ly aw lz dt"><span id="3e57" class="ma kq ht ko b fv mb mc l md me">curl <a class="ae kd" href="https://dapp.tools/install" rel="noopener ugc nofollow" target="_blank">https://dapp.tools/install</a> | sh</span></pre><p id="c64d" class="pw-post-body-paragraph jf jg ht jh b ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc hm dt translated">然而，由于某些原因，它对我不起作用，所以我手动操作。如果上面的一行程序对您也不起作用，请遵循下面的说明:</p><pre class="ls lt lu lv fq lw ko lx ly aw lz dt"><span id="dd1c" class="ma kq ht ko b fv mb mc l md me">$ nix-shell --pure -p cacert cachix curl git jq nix</span><span id="39c8" class="ma kq ht ko b fv mf mc l md me">[nix-shell:~/tmp]$ cachix use dapp</span><span id="f4ff" class="ma kq ht ko b fv mf mc l md me">Configured <a class="ae kd" href="https://dapp.cachix.org/" rel="noopener ugc nofollow" target="_blank">https://dapp.cachix.org</a> binary cache in /Users/detoo/.config/nix/nix.conf</span><span id="8bc5" class="ma kq ht ko b fv mf mc l md me">[nix-shell:~/tmp]$ git clone --recursive <a class="ae kd" href="https://github.com/dapphub/dapptools" rel="noopener ugc nofollow" target="_blank">https://github.com/dapphub/dapptools</a> $HOME/.dapp/dapptools</span><span id="c802" class="ma kq ht ko b fv mf mc l md me">[nix-shell:~/tmp]$ nix-env -f $HOME/.dapp/dapptools -iA dapp seth solc hevm ethsign</span><span id="c760" class="ma kq ht ko b fv mf mc l md me">...</span><span id="7c82" class="ma kq ht ko b fv mf mc l md me">created 29 symlinks in user environment</span></pre><h1 id="bb07" class="kp kq ht bd kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm dt translated">取消交易</h1><p id="7367" class="pw-post-body-paragraph jf jg ht jh b ji ln jk jl jm lo jo jp jq lp js jt ju lq jw jx jy lr ka kb kc hm dt translated">现在一切都准备好了，让我们尝试取消一个tx。</p><p id="a307" class="pw-post-body-paragraph jf jg ht jh b ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc hm dt translated">假设你的钱包地址是<code class="eh kl km kn ko b">0xdeadbeefdeadbeefdeadbeefdeadbeefdeadbeef</code>，你要注销的tx的nonce是<code class="eh kl km kn ko b">123</code>，它的气价是<code class="eh kl km kn ko b">30 gwei</code>。我们要做的实际上是发送一个替换的<strong class="jh hu">无操作</strong> tx，具有<strong class="jh hu">相同的随机数</strong>和<strong class="jh hu">更高的油价</strong>，这实际上是通过用无操作覆盖原始tx来“取消”它。无操作tx的一个典型示例是向自己发送0乙醚，这将(1)什么都不改变,( 2)消耗非常少的汽油，这就是我们想要取消的。</p><p id="2c25" class="pw-post-body-paragraph jf jg ht jh b ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc hm dt translated">要发送此类tx，请运行以下命令:</p><pre class="ls lt lu lv fq lw ko lx ly aw lz dt"><span id="b014" class="ma kq ht ko b fv mb mc l md me">$ seth --rpc-url=<a class="ae kd" href="https://mainnet.infura.io/v3/b424ca737ba145588005367252bf1cee" rel="noopener ugc nofollow" target="_blank">https://</a>url.to.your.endpoint send -F <!-- -->0xdeadbeefdeadbeefdeadbeefdeadbeefdeadbeef<!-- --> <!-- -->0xdeadbeefdeadbeefdeadbeefdeadbeefdeadbeef<!-- --> --value=0 --nonce=123 --gas-price=$(seth --to-wei 40 gwei)</span><span id="83f4" class="ma kq ht ko b fv mf mc l md me">Ethereum account passphrase (not echoed):</span></pre><p id="a41a" class="pw-post-body-paragraph jf jg ht jh b ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc hm dt translated"><code class="eh kl km kn ko b">--rpc-url</code>应该是您从Infura获得的端点，或者如果您使用默认设置运行<code class="eh kl km kn ko b">geth</code>全节点，则应该是<code class="eh kl km kn ko b"><a class="ae kd" href="http://localhost:8545" rel="noopener ugc nofollow" target="_blank">http://localhost:8545</a></code>。</p><p id="ec30" class="pw-post-body-paragraph jf jg ht jh b ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc hm dt translated">请注意，我们发送的新tx的天然气价格比旧的价格至少高10%,因此矿工更有可能接受它。</p><p id="2197" class="pw-post-body-paragraph jf jg ht jh b ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc hm dt translated">由于我们指定了从(<code class="eh kl km kn ko b">-F</code>)发送交易的帐户，<code class="eh kl km kn ko b">seth</code>将自动搜索<code class="eh kl km kn ko b">geth</code>密钥库中的钱包。如果您在前面的步骤中导入了<code class="eh kl km kn ko b">0xdeadbeefdeadbeefdeadbeefdeadbeefdeadbeef</code>的私钥，<code class="eh kl km kn ko b">seth</code>将会找到它，并提示您输入密码。输入您在导入过程中设置的密码，然后它将签名并发送tx，并等待确认。一旦确认，取消就完成了！</p><h1 id="3d7e" class="kp kq ht bd kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm dt translated">有人说过可组合性吗？</h1><p id="b04f" class="pw-post-body-paragraph jf jg ht jh b ji ln jk jl jm lo jo jp jq lp js jt ju lq jw jx jy lr ka kb kc hm dt translated">CLI的好处是您可以对它进行“编程”。比方说，如果你正在运行一个机器人，它卡住了不止一个，而是10个低气体交易。您可以编写一个简单的脚本来自动化这个过程，而不是运行该命令10次:</p><pre class="ls lt lu lv fq lw ko lx ly aw lz dt"><span id="de84" class="ma kq ht ko b fv mb mc l md me">$ for i in {123..132}; do seth --rpc-url=<a class="ae kd" href="https://mainnet.infura.io/v3/b424ca737ba145588005367252bf1cee" rel="noopener ugc nofollow" target="_blank">https://</a>url.to.your.endpoint send -F <!-- -->0xdeadbeefdeadbeefdeadbeefdeadbeefdeadbeef<!-- --> <!-- -->0xdeadbeefdeadbeefdeadbeefdeadbeefdeadbeef<!-- --> --value=0 --nonce=$i --gas-price=$(seth --to-wei 40 gwei) --password=/path/to/your/password/file; done</span></pre><p id="c765" class="pw-post-body-paragraph jf jg ht jh b ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc hm dt translated">注意额外的参数<code class="eh kl km kn ko b">--password</code>。我们希望这个过程是自动化的，可以通过在一个单独的文件<code class="eh kl km kn ko b">/path/to/your/password/file</code>中写入密码并指向<code class="eh kl km kn ko b">seth</code>来实现，这样它就不会每次都提示输入密码。</p><p id="4257" class="pw-post-body-paragraph jf jg ht jh b ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc hm dt translated">生产力和利润呢？</p><figure class="ls lt lu lv fq iu fe ff paragraph-image"><div class="fe ff mg"><img src="../Images/6b54c2c5229662d2136f2d7a8bc5a6c3.png" data-original-src="https://miro.medium.com/v2/resize:fit:800/0*NexmbG8DoeyN1Nya.gif"/></div><figcaption class="jb jc fg fe ff jd je bd b be z ek">Automated</figcaption></figure><blockquote class="mh"><p id="b751" class="mi mj ht bd mk ml mm mn mo mp mq kc ek translated"><a class="ae kd" href="https://coincodecap.com?utm_source=coinmonks" rel="noopener ugc nofollow" target="_blank">在您的收件箱中直接获得最佳软件交易</a></p></blockquote><figure class="ms mt mu mv mw iu fe ff paragraph-image"><a href="https://coincodecap.com?utm_source=coinmonks"><div class="fe ff mr"><img src="../Images/160ce73bd06d46c2250251e7d5969f9d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1168/format:webp/1*BoDnKUyK8p4hitHAJZ5Pdw.png"/></div></a></figure></div></div>    
</body>
</html>