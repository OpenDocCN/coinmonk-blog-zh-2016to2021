# å¼€æ”¾å¼é½æŸæž—æ‰˜ç®¡æ™ºèƒ½åˆåŒ

> åŽŸæ–‡ï¼š<https://medium.com/coinmonks/open-zeppelin-escrow-smart-contract-2a54ad027482?source=collection_archive---------3----------------------->

## æ‰˜ç®¡æ™ºèƒ½åˆåŒå¼€æ”¾-é½æŸæž— 2.0

![](img/974533390b3921ad7b0014aad397eecc.png)

[Source](https://www.google.co.in/url?sa=i&source=images&cd=&cad=rja&uact=8&ved=2ahUKEwin69zZma7eAhVL57wKHf-aCnIQjxx6BAgBEAI&url=https%3A%2F%2Fwww.youtube.com%2Fwatch%3Fv%3DfZlHcazNMrc&psig=AOvVaw15UREEGFN2fIM7CpMCbQ8B&ust=1540990101846540)

ä»Šå¤©ï¼Œæˆ‘ä»¬å°†çœ‹çœ‹æ™ºèƒ½å¥‘çº¦æ‰˜ç®¡ï¼Œå¹¶äº†è§£ open-zeppelin æ‰˜ç®¡æ™ºèƒ½å¥‘çº¦ã€‚

## ä»€ä¹ˆæ˜¯æ‰˜ç®¡ï¼Ÿ

[æ‰˜ç®¡æ˜¯ä¸€ç§é‡‘èžå®‰æŽ’ï¼Œç”±ç¬¬ä¸‰æ–¹æŒæœ‰å¹¶ç›‘ç®¡ç‰¹å®šäº¤æ˜“ä¸­åŒæ–¹æ‰€éœ€çš„èµ„é‡‘æ”¯ä»˜ã€‚](https://www.escrow.com/what-is-escrow)æ‰˜ç®¡è¢«ä¼ä¸šç”¨ä½œé‡‘èžåè®®çš„å—æ‰˜æ–¹ã€‚æœ‰è®¸å¤šåœ¨çº¿æ‰˜ç®¡æœåŠ¡ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥ä½¿ç”¨æ™ºèƒ½åˆåŒå»ºç«‹ä¸€ä¸ªæ‰˜ç®¡æœåŠ¡ã€‚

## å¼€æ”¾å¼é½æŸæž—æ‰˜ç®¡åˆåŒ-

## æƒé™ç®¡ç†å™¨æ™ºèƒ½åˆåŒ(Secondary.sol)

åœ¨è¿›å…¥ open-zeppelin æ‰˜ç®¡æ™ºèƒ½åˆåŒä¹‹å‰ï¼Œæˆ‘ä»¬å°†é¦–å…ˆçœ‹ä¸€ä¸‹`Secondary.sol`ï¼Œå®ƒä¹Ÿæ˜¯ç”± open-zeppelin æä¾›çš„ã€‚å®ƒæœ¬è´¨ä¸Šæ˜¯åœ¨`Escrow.sol`ä¸­ä½¿ç”¨çš„è®¸å¯ç®¡ç†å™¨åŒ…è£…å™¨ã€‚

**ä¸ºä»€ä¹ˆæ˜¯ Secondary.solï¼Ÿ**

Secondary.sol å°†æœ‰åŠ©äºŽä¸ºæˆ‘ä»¬çš„åˆåŒå»ºç«‹ä¸€ä¸ªä¸»è¦å½“äº‹äººã€‚è¿™ä¸ªä¸»è¦æ–¹æ˜¯æˆ‘ä»¬(æ‰˜ç®¡æœåŠ¡)ã€‚è¿™å®šä¹‰äº†åœ¨ä¸Žæˆ‘ä»¬çš„æ‰˜ç®¡ç³»ç»Ÿäº¤äº’æ—¶å°†ç”¨äºŽå¼ºåˆ¶æ‰€æœ‰æƒçš„ä¿®é¥°ç¬¦ã€‚å½“ç„¶ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨æ‰˜ç®¡æ™ºèƒ½åˆåŒæœ¬èº«ä¸­æž„å»ºè¿™ä¸€åŠŸèƒ½ï¼Œä½†æ˜¯åˆ›å»º`Secondary.sol`æœ‰åŠ©äºŽæˆ‘ä»¬å®žçŽ°å¯é‡ç”¨æ€§ã€æ¨¡å—åŒ–å’Œå…³æ³¨ç‚¹åˆ†ç¦»ã€‚

**è¿™é‡Œæ˜¯**T3 çš„ä»£ç ã€‚

çŽ°åœ¨ï¼Œè®©æˆ‘ä»¬çœ‹çœ‹è¿™ä»½åˆåŒã€‚

**å»ºé€ æ–¹** -åœ¨åŒºå—é“¾éƒ¨ç½²æœ¬åˆåŒçš„è´¦æˆ·å°†æ˜¯æœ¬æ™ºèƒ½åˆåŒçš„`_primary`(ä¸»è¦æ–¹)ï¼Œå¹¶å°†æŽ§åˆ¶æœ¬åˆåŒã€‚

**ä¿®é¥°ç¬¦-** å¦‚æžœåœ¨ä»»ä½•å‡½æ•°ä¸­ä½¿ç”¨ä¿®é¥°ç¬¦ï¼Œå°†æ£€æŸ¥å‡½æ•°æ˜¯å¦è¢«ä¸»è¦æ–¹è°ƒç”¨ã€‚

**è½¬ç§»æ‰€æœ‰æƒ**â€”â€”å½“ç„¶æœ‰æ”¹å˜ä¸»æ–¹çš„åŠŸèƒ½ã€‚

## æ‰˜ç®¡æ™ºèƒ½åˆåŒ

å› ä¸ºæˆ‘ä»¬æä¾›æ‰˜ç®¡æœåŠ¡ã€‚æˆ‘ä»¬å°†æŽ§åˆ¶æˆ‘ä»¬çš„æ‰˜ç®¡èµ„é‡‘(æˆ‘ä»¬å°†æ˜¯ç¬¬ä¸€æ–¹`Secondary.sol`)ï¼Œæˆ‘ä»¬å°†ä¸ºä¸€æ–¹å­˜æ¬¾å’Œå–æ¬¾ï¼Œå¹¶è·Ÿè¸ªå­˜æ¬¾ã€‚ä»»ä½•äººéƒ½å¯ä»¥æŸ¥çœ‹ç»™å®šåœ°å€çš„ç›¸åº”åœ°å€å­˜å…¥äº†å¤šå°‘é‡‘é¢ã€‚

å¥½äº†ï¼ŒçŽ°åœ¨æˆ‘ä»¬å¯ä»¥å¼€å§‹æˆ‘ä»¬çš„æ‰˜ç®¡æ™ºèƒ½åˆåŒäº†ã€‚é‚£ä¹ˆçŽ°åœ¨æˆ‘ä»¬æ¥äº†è§£ä¸€ä¸‹`Escrow.sol`ã€‚

æˆ‘ä»¬æ­£åœ¨å®šä¹‰ä¸€ä¸ªæ˜ å°„æ¥è·Ÿè¸ªå­˜æ¬¾ã€‚å®ƒå°†åœ°å€ä¸Žæ‰˜ç®¡åˆåŒä¸­çš„å­˜æ¬¾å€¼è¿›è¡Œæ˜ å°„ã€‚

```
mapping(address => uint256) private _deposits;
```

**äº‹ä»¶**â€”â€”æ™ºèƒ½åˆçº¦è¿˜å®šä¹‰äº†ä¸¤ä¸ªäº‹ä»¶ï¼Œä¸€ä¸ªç”¨äºŽå­˜æ¬¾ï¼Œä¸€ä¸ªç”¨äºŽå–æ¬¾ã€‚

```
event Deposited(address indexed payee, uint256 weiAmount);
event Withdrawn(address indexed payee, uint256 weiAmount);
```

**æ–¹æ³•** -çŽ°åœ¨è®©æˆ‘ä»¬çœ‹çœ‹æˆ‘ä»¬åœ¨æ‰˜ç®¡æ™ºèƒ½åˆåŒä¸­çš„æ–¹æ³•ã€‚

**æŠ¼é‡‘** â€”è¿™æ˜¯ä¸€ä¸ªç®€å•çš„æ–¹æ³•ï¼Œåªå…è®¸åˆåŒæ‰€æœ‰è€…(ä¸»è¦æ–¹)ä¸ºä»»ä½•ä¸€æ–¹æäº¤æŠ¼é‡‘ã€‚çœ‹ï¼Œæˆ‘ä»¬ä½¿ç”¨äº†æ¥è‡ª`Secondary.sol`çš„`onlyPrimary`ä¿®é¥°ç¬¦æ¥è¿›è¡Œæƒé™ç®¡ç†ã€‚æˆ‘ä»¬ä¹Ÿå­˜å‚¨æˆ‘ä»¬å­˜æ”¾ä¹™é†šçš„ä¸€æ–¹çš„åœ°å€ã€‚æˆ‘ä»¬ä¹Ÿåœ¨æœ€åŽå‘å°„æ²‰ç§¯ã€‚

```
function deposit(address payee) public onlyPrimary payable {
    uint256 amount = msg.value;
    _deposits[payee] = _deposits[payee].add(amount);

     emit Deposited(payee, amount);
  }
```

**æ’¤å›ž** â€”æˆ‘ä»¬å°†ä½¿ç”¨æ­¤æ–¹æ³•å°†ä¹™é†šè½¬ç§»å›žæˆ‘ä»¬å­˜æ”¾ä¹™é†šçš„ä¸€æ–¹ã€‚å¦‚æžœäº¤æ˜“æˆåŠŸï¼Œæˆ‘ä»¬å°†æ›´æ–°æ˜ å°„å¹¶å‘å‡ºä¸€ä¸ªäº‹ä»¶ã€‚è¿™é‡Œæˆ‘ä»¬ä¹Ÿä½¿ç”¨`onlyPrimary`æ¥ç¡®ä¿åªæœ‰æˆ‘ä»¬å¯ä»¥æ‰§è¡Œæ’¤é”€ã€‚

```
function withdraw(address payee) public onlyPrimary {
    uint256 payment = _deposits[payee]; _deposits[payee] = 0; payee.transfer(payment); emit Withdrawn(payee, payment);
  }
```

è¿™æ˜¯ä¸€ä¸ªè¿”å›žç»™å®šåœ°å€çš„å­˜æ¬¾å€¼çš„å‡½æ•°ï¼Œå®ƒæ˜¯å…¬å…±çš„ï¼Œæ‰€ä»¥ä»»ä½•äººéƒ½å¯ä»¥æ£€æŸ¥ç»™å®šè´¦æˆ·çš„æ‰˜ç®¡ä½™é¢ã€‚

```
function depositsOf(address payee) public view returns (uint256) {
    return _deposits[payee];
}
```

å°±è¿™æ ·ï¼Œæˆ‘ä»¬çš„æ™ºèƒ½åˆçº¦å®Œæˆäº†ã€‚æˆ‘ä»¬å¯ä»¥åœ¨å®ƒçš„åŸºç¡€ä¸Šæ·»åŠ é¢å¤–çš„åŠŸèƒ½ï¼Œå®ƒä¹Ÿç»è¿‡äº†å¾ˆå¥½çš„æµ‹è¯•ï¼Œä½†æ˜¯ä½ å¯ä»¥æµ‹è¯•å®ƒï¼Œåªæ˜¯ä¸ºäº†äº†è§£å®ƒæ˜¯å¦‚ä½•å·¥ä½œçš„ã€‚æˆ‘ä»¬å°†åœ¨æŽ¥ä¸‹æ¥çš„æ•™ç¨‹ä¸­æŸ¥çœ‹ç”± open-zeppelin library æä¾›çš„å…¶ä»– 2 ä¸ªæ‰˜ç®¡åˆåŒ(æœ‰æ¡ä»¶æ‰˜ç®¡å’Œé€€æ¬¾),å®ƒä»¬æ˜¯åŸºäºŽè¿™ä¸ªæ‰˜ç®¡æ™ºèƒ½åˆåŒæž„å»ºçš„ã€‚

å¦‚æžœä½ å¯¹æ™ºèƒ½åˆçº¦æœ‰ä»€ä¹ˆä¸äº†è§£æˆ–è€…ä¸äº†è§£ï¼Œå¯ä»¥åœ¨ä¸‹é¢è¯„è®ºã€‚å¦‚æžœä½ è§‰å¾—è¿™æœ‰ç”¨ï¼Œä½ å¯ä»¥ðŸ‘åœ¨çµåª’ä¸Šè·Ÿç€æˆ‘ã€‚

> [ç›´æŽ¥åœ¨æ‚¨çš„æ”¶ä»¶ç®±ä¸­èŽ·å¾—æœ€ä½³è½¯ä»¶äº¤æ˜“](https://coincodecap.com/?utm_source=coinmonks)

[![](img/7c0b3dfdcbfea594cc0ae7d4f9bf6fcb.png)](https://coincodecap.com/?utm_source=coinmonks)