<html>
<head>
<title>How to Make a Survey with an EOS Smart Contract (1)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何使用EOS智能合同进行调查(1)</h1>
<blockquote>原文：<a href="https://medium.com/coinmonks/how-to-make-a-survey-with-an-eos-smart-contract-1-ac13852405c1?source=collection_archive---------2-----------------------#2018-08-03">https://medium.com/coinmonks/how-to-make-a-survey-with-an-eos-smart-contract-1-ac13852405c1?source=collection_archive---------2-----------------------#2018-08-03</a></blockquote><div><div class="ef hh hi hj hk hl"/><div class="hm hn ho hp hq"><div class=""/><div class=""><h2 id="a457" class="pw-subtitle-paragraph iq hs ht bd b ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ek translated">使用智能合同进行抽样调查。</h2></div><figure class="jj jk jl jm fq jn fe ff paragraph-image"><div role="button" tabindex="0" class="jo jp di jq bf jr"><div class="fe ff ji"><img src="../Images/21c938a108d372867e1b53fd52fd7537.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KNa-6I77jfVpIIVkUrXibA.png"/></div></div></figure><p id="29db" class="pw-post-body-paragraph ju jv ht jw b jx jy iu jz ka kb ix kc kd ke kf kg kh ki kj kk kl km kn ko kp hm dt translated">你好，我是ITAM游戏公司的沈在贤。在这篇文章中，我将给出一个使用智能合同进行调查的例子。</p><p id="bef7" class="pw-post-body-paragraph ju jv ht jw b jx jy iu jz ka kb ix kc kd ke kf kg kh ki kj kk kl km kn ko kp hm dt translated">请记住，这个示例是为了保持一定的简单性，因此在实际使用中可能不实用，但是固定的要求都包括在内。</p><h1 id="9228" class="kq kr ht bd ks kt ku kv kw kx ky kz la iz lb ja lc jc ld jd le jf lf jg lg lh dt translated">开始</h1><p id="d622" class="pw-post-body-paragraph ju jv ht jw b jx li iu jz ka lj ix kc kd lk kf kg kh ll kj kk kl lm kn ko kp hm dt translated">首先，让我们在头脑中把它画出来。</p><ol class=""><li id="77a9" class="ln lo ht jw b jx jy ka kb kd lp kh lq kl lr kp ls lt lu lv dt translated">合同创建者输入调查的描述和四个选项的内容。</li><li id="04e7" class="ln lo ht jw b jx lw ka lx kd ly kh lz kl ma kp ls lt lu lv dt translated">普通用户将他们的账号和他/她选择的号码发送到合同上。</li><li id="fe54" class="ln lo ht jw b jx lw ka lx kd ly kh lz kl ma kp ls lt lu lv dt translated">所有用户都使用合同来查看结果。</li><li id="47b3" class="ln lo ht jw b jx lw ka lx kd ly kh lz kl ma kp ls lt lu lv dt translated">一般用户一旦选择，就不能修改调查结果。</li></ol><p id="1d40" class="pw-post-body-paragraph ju jv ht jw b jx jy iu jz ka kb ix kc kd ke kf kg kh ki kj kk kl km kn ko kp hm dt translated">需求在组织的时候已经被结构化了，为了简单地结构化，似乎需要有3个。意为2~3桌。</p><h2 id="8f2f" class="mb kr ht bd ks mc md me kw mf mg mh la kd mi mj lc kh mk ml le kl mm mn lg mo dt translated"><strong class="ak">动作配置</strong></h2><p id="dac5" class="pw-post-body-paragraph ju jv ht jw b jx li iu jz ka lj ix kc kd lk kf kg kh ll kj kk kl lm kn ko kp hm dt translated">操作配置如下。</p><ol class=""><li id="45f1" class="ln lo ht jw b jx jy ka kb kd lp kh lq kl lr kp ls lt lu lv dt translated"><strong class="jw hu">调查</strong>:进入新的调查</li><li id="fb96" class="ln lo ht jw b jx lw ka lx kd ly kh lz kl ma kp ls lt lu lv dt translated"><strong class="jw hu">增加</strong>:参加调查</li><li id="8028" class="ln lo ht jw b jx lw ka lx kd ly kh lz kl ma kp ls lt lu lv dt translated"><strong class="jw hu">结果</strong>:查看调查结果</li></ol><h2 id="6bd8" class="mb kr ht bd ks mc md me kw mf mg mh la kd mi mj lc kh mk ml le kl mm mn lg mo dt translated"><strong class="ak">工作台配置</strong></h2><p id="0783" class="pw-post-body-paragraph ju jv ht jw b jx li iu jz ka lj ix kc kd lk kf kg kh ll kj kk kl lm kn ko kp hm dt translated">该表也被配置成如下3个部分。</p><ol class=""><li id="35bc" class="ln lo ht jw b jx jy ka kb kd lp kh lq kl lr kp ls lt lu lv dt translated">包含调查信息和4个选项的表格。</li><li id="04ef" class="ln lo ht jw b jx lw ka lx kd ly kh lz kl ma kp ls lt lu lv dt translated">保存调查参与者及其选择的表格。</li><li id="6be6" class="ln lo ht jw b jx lw ka lx kd ly kh lz kl ma kp ls lt lu lv dt translated">收集和保存结果的表。</li></ol><p id="f184" class="pw-post-body-paragraph ju jv ht jw b jx jy iu jz ka kb ix kc kd ke kf kg kh ki kj kk kl km kn ko kp hm dt translated">我认为如果你混合1和3应该不会有任何问题，但是为了确保组件是可见的，我将在这个例子中分开。</p><pre class="jj jk jl jm fq mp mq mr ms aw mt dt"><span id="7917" class="mb kr ht mq b fv mu mv l mw mx">#include &lt;eosiolib/eosio.hpp&gt;<br/>#include &lt;eosiolib/print.hpp&gt;</span><span id="22d3" class="mb kr ht mq b fv my mv l mw mx">using namespace eosio;</span><span id="ea72" class="mb kr ht mq b fv my mv l mw mx">class survey : public eosio::contract <br/>{<br/>  public:<br/>    using contract::contract;</span><span id="4f88" class="mb kr ht mq b fv my mv l mw mx">/// <a class="ae mz" href="http://twitter.com/abi" rel="noopener ugc nofollow" target="_blank">@abi</a> action<br/>    void csurvey() <br/>    {<br/>      print("your call to csurvey");<br/>    }</span><span id="34f9" class="mb kr ht mq b fv my mv l mw mx">/// <a class="ae mz" href="http://twitter.com/abi" rel="noopener ugc nofollow" target="_blank">@abi</a> action<br/>    void add() <br/>    {<br/>      print("your call to add");<br/>    }</span><span id="a3cf" class="mb kr ht mq b fv my mv l mw mx">/// <a class="ae mz" href="http://twitter.com/abi" rel="noopener ugc nofollow" target="_blank">@abi</a> action<br/>    void result()<br/>    {<br/>      print("your call to result");<br/>    }<br/>};</span><span id="1ab3" class="mb kr ht mq b fv my mv l mw mx">EOSIO_ABI( survey, (csurvey) (add) (result) )</span></pre><p id="cad7" class="pw-post-body-paragraph ju jv ht jw b jx jy iu jz ka kb ix kc kd ke kf kg kh ki kj kk kl km kn ko kp hm dt translated">做一个简单的骨架，我们会在每个动作中输入一个测试代码打印(“你对csurvey的调用”)。发布后编译源代码并测试。(关于合同的编制、发布和执行方法，请参考<a class="ae mz" rel="noopener" href="/coinmonks/using-table-on-eos-smart-contract-291f98312b80">上一篇文章</a></p><figure class="jj jk jl jm fq jn fe ff paragraph-image"><div role="button" tabindex="0" class="jo jp di jq bf jr"><div class="fe ff na"><img src="../Images/5004ca5d6943d31e39b418fdbc236b1f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*h0X6pYOaLS315C7EPZu0UA.png"/></div></div></figure><p id="4ff3" class="pw-post-body-paragraph ju jv ht jw b jx jy iu jz ka kb ix kc kd ke kf kg kh ki kj kk kl km kn ko kp hm dt translated">你可以看到每个动作都工作正常，没有任何问题。</p><h1 id="f317" class="kq kr ht bd ks kt ku kv kw kx ky kz la iz lb ja lc jc ld jd le jf lf jg lg lh dt translated"><strong class="ak">实施</strong></h1><p id="a119" class="pw-post-body-paragraph ju jv ht jw b jx li iu jz ka lj ix kc kd lk kf kg kh ll kj kk kl lm kn ko kp hm dt translated">首先，制作一个用于csurvey动作的表格</p><pre class="jj jk jl jm fq mp mq mr ms aw mt dt"><span id="db06" class="mb kr ht mq b fv mu mv l mw mx">using namespace eosio;<br/>using namespace std;<br/>.<br/>.<br/>.<br/>/// <a class="ae mz" href="http://twitter.com/abi" rel="noopener ugc nofollow" target="_blank">@abi</a> table surveycon i64<br/>    struct surveycon<br/>    {<br/>      account_name owner;<br/>      string question<br/>      string no1con;<br/>      string no2con;<br/>      string no3con;<br/>      string no4con;</span><span id="71a4" class="mb kr ht mq b fv my mv l mw mx">uint64_t primary_key() const {return owner;}</span><span id="3f2b" class="mb kr ht mq b fv my mv l mw mx">EOSLIB_SERIALIZE(surveycon,(owner)(question)(no1con)(no2con)(no3con)(no4con))<br/>    };<br/>typedef multi_index&lt;N(surveycon),surveycon&gt; _survey;</span></pre><p id="3acc" class="pw-post-body-paragraph ju jv ht jw b jx jy iu jz ka kb ix kc kd ke kf kg kh ki kj kk kl km kn ko kp hm dt translated">为了使用字符串变量，首先使用std命名空间(使用命名空间STD；).然后将智能协定所需的表定义为结构。这些表必须有一个用于搜索的主键。主键不能重复或为空。在本例中，因为我们将只进行一项调查，所以使用主键作为智能合约的帐户，并且调查的剩余数据answer1、answer2、answer3、answer4已被声明为string类型。</p><p id="0441" class="pw-post-body-paragraph ju jv ht jw b jx jy iu jz ka kb ix kc kd ke kf kg kh ki kj kk kl km kn ko kp hm dt translated">现在实现action csurvey特性。</p><pre class="jj jk jl jm fq mp mq mr ms aw mt dt"><span id="b8fc" class="mb kr ht mq b fv mu mv l mw mx">/// <a class="ae mz" href="http://twitter.com/abi" rel="noopener ugc nofollow" target="_blank">@abi</a> action<br/>    void csurvey(string question,string no1con,string no2con,string no3con,string no4con) <br/>    {<br/>      _survey survey(_self,_self);<br/>      <br/>      survey.emplace(_self,[&amp;](auto&amp; surveycon)<br/>      {<br/>        surveycon.owner=_self;<br/>        surveycon.question=question;<br/>        surveycon.no1con=no1con;<br/>        surveycon.no2con=no2con;<br/>        surveycon.no3con=no3con;<br/>        surveycon.no4con=no4con;<br/>      });</span><span id="dd18" class="mb kr ht mq b fv my mv l mw mx">return;<br/>    }</span></pre><p id="0205" class="pw-post-body-paragraph ju jv ht jw b jx jy iu jz ka kb ix kc kd ke kf kg kh ki kj kk kl km kn ko kp hm dt translated">首先，定义要传递给操作的数据。我们得到了将要输入到表上的问题的字符串数据，以及1~4的答案。现在将来自csurvey的数据输入到表格中。为了简单说明，我们没有讨论密钥复制的问题。</p><p id="3bac" class="pw-post-body-paragraph ju jv ht jw b jx jy iu jz ka kb ix kc kd ke kf kg kh ki kj kk kl km kn ko kp hm dt translated">接下来，创建用户用来保存投票信息的表。</p><pre class="jj jk jl jm fq mp mq mr ms aw mt dt"><span id="a3e5" class="mb kr ht mq b fv mu mv l mw mx">/// <a class="ae mz" href="http://twitter.com/abi" rel="noopener ugc nofollow" target="_blank">@abi</a> table surveydetail i64<br/>    struct surveydetail<br/>    {<br/>      account_name who;<br/>      uint64_t selnum;</span><span id="1b18" class="mb kr ht mq b fv my mv l mw mx">uint64_t primary_key() const {return who;}</span><span id="1abf" class="mb kr ht mq b fv my mv l mw mx">EOSLIB_SERIALIZE(surveydetail,(who)(selnum))<br/>    };<br/>    typedef multi_index&lt;N(surveydetail),surveydetail&gt; _items;</span></pre><p id="daf2" class="pw-post-body-paragraph ju jv ht jw b jx jy iu jz ka kb ix kc kd ke kf kg kh ki kj kk kl km kn ko kp hm dt translated">要存储谁保存了什么号码，请定义who变量和所选号码selnum。我使用who(帐户)作为主键，使用_items作为类型。</p><p id="66ab" class="pw-post-body-paragraph ju jv ht jw b jx jy iu jz ka kb ix kc kd ke kf kg kh ki kj kk kl km kn ko kp hm dt translated">现在实现添加操作。</p><pre class="jj jk jl jm fq mp mq mr ms aw mt dt"><span id="d1b7" class="mb kr ht mq b fv mu mv l mw mx">/// <a class="ae mz" href="http://twitter.com/abi" rel="noopener ugc nofollow" target="_blank">@abi</a> action<br/>    void add(account_name user,uint64_t selnum) <br/>    {<br/>      require_auth(user);</span><span id="8dbb" class="mb kr ht mq b fv my mv l mw mx">_items item(_self,_self);</span><span id="3fe5" class="mb kr ht mq b fv my mv l mw mx">item.emplace(_self,[&amp;](auto&amp; surveydetail){<br/>        surveydetail.who=user;<br/>        surveydetail.selnum=selnum;<br/>      });<br/>    return;<br/>    }</span></pre><p id="e39e" class="pw-post-body-paragraph ju jv ht jw b jx jy iu jz ka kb ix kc kd ke kf kg kh ki kj kk kl km kn ko kp hm dt translated">这段代码与上面的csurvey操作没有什么不同。这可能很奇怪，因为我们所做的只是将调查参与情况存储到表中，但是我们将在下面的代码中添加该功能。代码顶部的require_auth (user)比较验证契约的执行权限是否与用户一致。因为eosio允许您调用多个帐户的执行权限的操作，所以很难区分执行合同的权限和执行操作的权限。因此，我们使用函数来检查在将必要帐户的名称放入操作的数据中之后，是否使用必要的帐户执行权限执行了合同。</p><p id="dce9" class="pw-post-body-paragraph ju jv ht jw b jx jy iu jz ka kb ix kc kd ke kf kg kh ki kj kk kl km kn ko kp hm dt translated">由于篇幅原因，此内容将在下一篇文章中继续。</p></div><div class="ab cl nb nc hb nd" role="separator"><span class="ne bw bk nf ng nh"/><span class="ne bw bk nf ng nh"/><span class="ne bw bk nf ng"/></div><div class="hm hn ho hp hq"><h2 id="1133" class="mb kr ht bd ks mc md me kw mf mg mh la kd mi mj lc kh mk ml le kl mm mn lg mo dt translated">ITAM游戏是一个透明的游戏生态系统的区块链平台</h2><p id="5d69" class="pw-post-body-paragraph ju jv ht jw b jx li iu jz ka lj ix kc kd lk kf kg kh ll kj kk kl lm kn ko kp hm dt translated">订阅ITAM游戏并接收最新信息。</p><p id="4717" class="pw-post-body-paragraph ju jv ht jw b jx jy iu jz ka kb ix kc kd ke kf kg kh ki kj kk kl km kn ko kp hm dt translated">访问ITAM游戏电讯，就ITAM游戏和区块链进行交流。点击下面的链接加入！👫</p><p id="9423" class="pw-post-body-paragraph ju jv ht jw b jx jy iu jz ka kb ix kc kd ke kf kg kh ki kj kk kl km kn ko kp hm dt translated">网址:<strong class="jw hu"/><a class="ae mz" href="https://itam.games" rel="noopener ugc nofollow" target="_blank">https://itam . games</a><strong class="jw hu"><br/></strong>电报:<a class="ae mz" href="https://t.me/itamgames" rel="noopener ugc nofollow" target="_blank">https://t.me/itamgames</a></p></div></div>    
</body>
</html>