<html>
<head>
<title>Running PySpark with Cassandra using spark-cassandra-connector in Jupyter Notebook</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在Jupyter笔记本中使用spark-cassandra-connector运行PySpark和Cassandra</h1>
<blockquote>原文：<a href="https://medium.com/coinmonks/running-pyspark-with-cassandra-using-spark-cassandra-connector-in-jupyter-notebook-9f1dc45e8dc9?source=collection_archive---------0-----------------------#2018-09-06">https://medium.com/coinmonks/running-pyspark-with-cassandra-using-spark-cassandra-connector-in-jupyter-notebook-9f1dc45e8dc9?source=collection_archive---------0-----------------------#2018-09-06</a></blockquote><div><div class="ef hh hi hj hk hl"/><div class="hm hn ho hp hq"><div class=""/><figure class="fi fk ir is it iu fe ff paragraph-image"><div role="button" tabindex="0" class="iv iw di ix bf iy"><div class="fe ff iq"><img src="../Images/8308afc8061f0e00203e12323c315744.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*VRAoHqBR9RCkm91p.png"/></div></div></figure><p id="b346" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">当我们对DB Cassandra集群中的大数据进行操作时，我们面临着几个内存不足的问题。所以我们决定最好使用Spark来解决这个问题。</p><p id="d7f7" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">对我们来说，这是一个艰难而有趣的旅程，因为我们作为一个团队做出了一个决定，那就是我们希望在我们的后端项目中最多使用两种语言，即Node.js和Python。据我们所说，这两个工具是解决这个项目问题的合适工具。因为所有的数据收集和转换问题都将由Node.js轻松处理，所有其他东西，如大数据操作、人工智能/机器学习问题都将使用Python解决。你可能会奇怪，在多语言微服务架构的时代，我们为什么要设置这种限制。</p><p id="2c9a" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">使用多种语言工作很有趣，我曾经是一名Java开发人员，后来根据项目要求转到Node.js，然后转到Python，这在构建时也很有意义，但很难维护它们或找到懂多种语言的合适人员，或者有时招聘一名精通某种语言的开发人员来维护一个模块是没有意义的。</p><p id="d4ba" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">由于多语言编程，许多团队或公司都面临着问题。他们中的几个人也表达了他们的担忧。</p><p id="330f" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">一旦我开始在PySpark上工作，一切都很顺利，直到我想到使用Cassandra。由于我使用了几个与<strong class="jd hu"> PySpark </strong>相关的例子和几个与<strong class="jd hu"> Scala </strong>相关的例子，所以可用的文档或例子非常少。用这些我开始了我的旅程。</p><p id="7c17" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">如果你没有安装PySpark &amp; Jupyter，你可以参考<a class="ae jz" rel="noopener" href="/@ashok.tankala/run-your-first-spark-program-using-pyspark-and-jupyter-notebook-3b1281765169">我以前的文章</a>。不要浪费太多时间，让我们把手弄脏。</p></div><div class="ab cl ka kb hb kc" role="separator"><span class="kd bw bk ke kf kg"/><span class="kd bw bk ke kf kg"/><span class="kd bw bk ke kf"/></div><div class="hm hn ho hp hq"><p id="98b2" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">我们需要一些好的数据来研究它。所以，我为此选择<a class="ae jz" href="http://grouplens.org/datasets/movielens/" rel="noopener ugc nofollow" target="_blank">电影镜头数据</a>。你可以在<a class="ae jz" href="https://grouplens.org/datasets/movielens/latest/" rel="noopener ugc nofollow" target="_blank">这里</a>获得最新数据。我选择ml-latest.zip而不是ml-latest-small.zip，这样我们就可以处理相当大的数据。</p><p id="8ae0" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">让我们首先将这些数据加载到Cassandra数据库中。打开您的cqlsh shell。为此创建一个密钥空间。我创建了movie_lens键空间，并开始使用下面的命令。</p><pre class="kh ki kj kk fq kl km kn ko aw kp dt"><span id="ace1" class="kq kr ht km b fv ks kt l ku kv">CREATE KEYSPACE movie_lens WITH replication = {'class': 'SimpleStrategy', 'replication_factor': 1};</span><span id="2708" class="kq kr ht km b fv kw kt l ku kv">use movie_lens;</span></pre><p id="3c0b" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">然后，我用下面的命令创建了电影和评级表。</p><pre class="kh ki kj kk fq kl km kn ko aw kp dt"><span id="b064" class="kq kr ht km b fv ks kt l ku kv">CREATE TABLE movies(movie_id int PRIMARY KEY, title text, genres text);</span><span id="1902" class="kq kr ht km b fv kw kt l ku kv">CREATE TABLE ratings(user_id int, movie_id int, rating double, timestamp bigint, primary key((user_id), movie_id));</span></pre><p id="423b" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">使用以下命令加载数据。</p><pre class="kh ki kj kk fq kl km kn ko aw kp dt"><span id="3924" class="kq kr ht km b fv ks kt l ku kv">COPY movies(movie_id, title, genres) FROM '../ml-latest/movies.csv' WITH HEADER = true;</span><span id="a344" class="kq kr ht km b fv kw kt l ku kv">COPY ratings(user_id, movie_id, rating, timestamp) FROM '../ml-latest/ratings.csv' WITH HEADER = true;</span></pre><p id="e578" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">然后你会得到这样的输出</p><pre class="kh ki kj kk fq kl km kn ko aw kp dt"><span id="5dcf" class="kq kr ht km b fv ks kt l ku kv">cqlsh:movie_lens&gt; COPY movies(movie_id, title, genres) FROM '../ml-latest/movies.csv' WITH HEADER = true;<br/>Reading options from the command line: {'header': 'true'}<br/>Using 3 child processes</span><span id="ab63" class="kq kr ht km b fv kw kt l ku kv">Starting copy of movie_lens.movies with columns [movie_id, title, genres].<br/>Processed: 45843 rows; Rate:   12664 rows/s; Avg. rate:   11930 rows/s<br/>45843 rows imported from 1 files in 3.843 seconds (0 skipped).</span><span id="bc40" class="kq kr ht km b fv kw kt l ku kv">cqlsh:movie_lens&gt; COPY ratings(user_id, movie_id, rating, timestamp) FROM '../ml-latest/ratings.csv' WITH HEADER = true;<br/>Reading options from the command line: {'header': 'true'}<br/>Using 3 child processes</span><span id="0cb8" class="kq kr ht km b fv kw kt l ku kv">Starting copy of movie_lens.ratings with columns [user_id, movie_id, rating, timestamp].<br/>Processed: 26024289 rows; Rate:    9378 rows/s; Avg. rate:   22557 rows/s<br/>26024289 rows imported from 1 files in 19 minutes and 13.714 seconds (0 skipped).</span></pre><p id="7d98" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">一切就绪。是时候做编码了。</p></div><div class="ab cl ka kb hb kc" role="separator"><span class="kd bw bk ke kf kg"/><span class="kd bw bk ke kf kg"/><span class="kd bw bk ke kf"/></div><div class="hm hn ho hp hq"><p id="8c72" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">使用下面的命令启动你的<strong class="jd hu"> Jupyter笔记本</strong>。</p><pre class="kh ki kj kk fq kl km kn ko aw kp dt"><span id="d1d7" class="kq kr ht km b fv ks kt l ku kv">jupyter notebook</span></pre><p id="1683" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">创建新笔记本。</p><figure class="kh ki kj kk fq iu fe ff paragraph-image"><div class="ab fr cl kx"><img src="../Images/9280c24c828eed3c57148d0a8c3ae530.png" data-original-src="https://miro.medium.com/v2/format:webp/1*LGWJbjOI94KlAMizN_hjug.png"/></div></figure><blockquote class="ky kz la"><p id="9785" class="jb jc lb jd b je jf jg jh ji jj jk jl lc jn jo jp ld jr js jt le jv jw jx jy hm dt translated">首先，我们需要设置一些参数或配置来确保PySpark连接到我们的Cassandra节点集群。</p></blockquote><pre class="kh ki kj kk fq kl km kn ko aw kp dt"><span id="6745" class="kq kr ht km b fv ks kt l ku kv"># Configuratins related to Cassandra connector &amp; Cluster<br/>import os<br/>os.environ['PYSPARK_SUBMIT_ARGS'] = '--packages com.datastax.spark:spark-cassandra-connector_2.11:2.3.0 --conf spark.cassandra.connection.host=127.0.0.1 pyspark-shell'</span></pre><blockquote class="ky kz la"><p id="f4a8" class="jb jc lb jd b je jf jg jh ji jj jk jl lc jn jo jp ld jr js jt le jv jw jx jy hm dt translated">这里我们说使用spark-cassandra-connector连接到我们的cassandra集群，它的主机名是127.0.0.1。就是这样。例如，在Cassandra集群中有多个节点，那么在主机配置中，我们需要给出它们的所有IP。举个例子，</p></blockquote><pre class="kh ki kj kk fq kl km kn ko aw kp dt"><span id="6174" class="kq kr ht km b fv ks kt l ku kv"># Configuratins related to Cassandra connector &amp; Cluster<br/>import os<br/>os.environ['PYSPARK_SUBMIT_ARGS'] = '--packages com.datastax.spark:spark-cassandra-connector_2.11:2.3.0 --conf spark.cassandra.connection.host=192.168.0.123,192.168.0.124 pyspark-shell'</span></pre><p id="04d9" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">当你第一次运行它的时候，需要花一些时间，因为它需要下载jar并连接到我们的Cassandra集群。您将得到这样的输出</p><figure class="kh ki kj kk fq iu fe ff paragraph-image"><div role="button" tabindex="0" class="iv iw di ix bf iy"><div class="fe ff lf"><img src="../Images/acecf44c155d9adebd2124cc473ca165.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cCWN4_YFN-JTMWAeQ8Tp4g.png"/></div></div></figure><blockquote class="ky kz la"><p id="ae93" class="jb jc lb jd b je jf jg jh ji jj jk jl lc jn jo jp ld jr js jt le jv jw jx jy hm dt translated">然后我们需要创建Spark上下文。</p></blockquote><pre class="kh ki kj kk fq kl km kn ko aw kp dt"><span id="cef9" class="kq kr ht km b fv ks kt l ku kv"># Creating PySpark Context<br/>from pyspark import SparkContext<br/>sc = SparkContext("local", "movie lens app")</span></pre><blockquote class="ky kz la"><p id="04dd" class="jb jc lb jd b je jf jg jh ji jj jk jl lc jn jo jp ld jr js jt le jv jw jx jy hm dt translated">在这之后，我们需要创建SQL上下文来对我们的数据进行SQL操作。</p></blockquote><pre class="kh ki kj kk fq kl km kn ko aw kp dt"><span id="9e06" class="kq kr ht km b fv ks kt l ku kv"># Creating PySpark SQL Context<br/>from pyspark.sql import SQLContext<br/>sqlContext = SQLContext(sc)</span></pre><blockquote class="ky kz la"><p id="4ea9" class="jb jc lb jd b je jf jg jh ji jj jk jl lc jn jo jp ld jr js jt le jv jw jx jy hm dt translated">我们将在多个表上工作，所以需要它们的数据框来保存一些代码行创建了一个函数，它为一个表加载数据框，包括给定的键空间</p></blockquote><pre class="kh ki kj kk fq kl km kn ko aw kp dt"><span id="446e" class="kq kr ht km b fv ks kt l ku kv"># Loads and returns data frame for a table including key space given<br/>def load_and_get_table_df(keys_space_name, table_name):<br/>    table_df = sqlContext.read\<br/>        .format("org.apache.spark.sql.cassandra")\<br/>        .options(table=table_name, keyspace=keys_space_name)\<br/>        .load()<br/>    return table_df</span></pre><blockquote class="ky kz la"><p id="a0c8" class="jb jc lb jd b je jf jg jh ji jj jk jl lc jn jo jp ld jr js jt le jv jw jx jy hm dt translated">让我们加载电影，收视率数据框。</p></blockquote><pre class="kh ki kj kk fq kl km kn ko aw kp dt"><span id="6c72" class="kq kr ht km b fv ks kt l ku kv"># Loading movies &amp; ratings table data frames<br/>movies = load_and_get_table_df("movie_lens", "movies")<br/>ratings = load_and_get_table_df("movie_lens", "ratings")</span></pre><blockquote class="ky kz la"><p id="5f87" class="jb jc lb jd b je jf jg jh ji jj jk jl lc jn jo jp ld jr js jt le jv jw jx jy hm dt translated">现在，我们来了解一下数据。首先，让我们看看电影数据是什么样子的。</p></blockquote><pre class="kh ki kj kk fq kl km kn ko aw kp dt"><span id="bf8b" class="kq kr ht km b fv ks kt l ku kv"># First 20 rows of movies table<br/>movies.show()</span></pre><p id="ccba" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">然后你会得到这样的数据</p><pre class="kh ki kj kk fq kl km kn ko aw kp dt"><span id="794b" class="kq kr ht km b fv ks kt l ku kv">+--------+--------------------+--------------------+<br/>|movie_id|              genres|               title|<br/>+--------+--------------------+--------------------+<br/>|  166048|       Drama|Romance|Happy Birthday (2...|<br/>|   99572|               Drama|     Cornelis (2010)|<br/>|   96638|         Documentary|    Klitschko (2011)|<br/>|  146455|       Drama|Fantasy|      Hallway (2015)|<br/>|   87258|Crime|Drama|Film-...|    The Thief (1952)|<br/>|   69227|     Children|Comedy|Ernest Rides Agai...|<br/>|     678|      Drama|Thriller|Some Folks Call I...|<br/>|  154214|    Children|Fantasy|Barbara the Fair ...|<br/>|   71675|              Comedy|    Hiroshima (2009)|<br/>|  139918|     Documentary|War|The Ghost Army (2...|<br/>|  164753|             Romance|Anything for Love...|<br/>|  168310|  (no genres listed)|Μαριχουάνα Στοπ !...|<br/>|   93952|     Horror|Thriller|Silent House, The...|<br/>|  118204|Adventure|Documen...|     McConkey (2013)|<br/>|  168678|              Comedy|     Devolved (2010)|<br/>|  111852|         Documentary|Generation Iron (...|<br/>|   43333|       Drama|Romance|        Water (2005)|<br/>|  106026|      Comedy|Musical|Folies Bergere de...|<br/>|  105926|              Horror| Barrio Tales (2012)|<br/>|   36477|Comedy|Drama|Romance|  Baxter, The (2005)|<br/>+--------+--------------------+--------------------+<br/>only showing top 20 rows</span></pre><blockquote class="ky kz la"><p id="19db" class="jb jc lb jd b je jf jg jh ji jj jk jl lc jn jo jp ld jr js jt le jv jw jx jy hm dt translated">然后让我们看看收视率数据是什么样的。</p></blockquote><pre class="kh ki kj kk fq kl km kn ko aw kp dt"><span id="2831" class="kq kr ht km b fv ks kt l ku kv"># First 20 rows of ratings table<br/>ratings.show()</span></pre><p id="2ca7" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">然后你会得到这样的数据</p><pre class="kh ki kj kk fq kl km kn ko aw kp dt"><span id="e62a" class="kq kr ht km b fv ks kt l ku kv">+-------+--------+------+----------+<br/>|user_id|movie_id|rating| timestamp|<br/>+-------+--------+------+----------+<br/>| 117752|     340|   5.0|1004221564|<br/>| 117752|    1275|   5.0|1004221564|<br/>| 117752|    1760|   5.0|1004221564|<br/>| 117752|    2028|   5.0|1004221564|<br/>| 117752|    2268|   5.0|1004221564|<br/>| 117752|    2643|   5.0|1004221564|<br/>| 117752|    3204|   5.0|1004221564|<br/>| 117752|    3677|   5.0|1004221564|<br/>| 117752|    4143|   4.0|1004221564|<br/>| 117752|    4565|   5.0|1004221564|<br/>| 122430|       1|   4.0| 832302134|<br/>| 122430|      25|   5.0| 850195697|<br/>| 122430|      34|   4.0| 832302184|<br/>| 122430|      50|   5.0| 832302207|<br/>| 122430|      52|   3.0| 850195768|<br/>| 122430|      69|   4.0| 832303477|<br/>| 122430|     110|   3.0| 832302172|<br/>| 122430|     111|   3.0| 832302229|<br/>| 122430|     122|   4.0| 832302922|<br/>| 122430|     145|   3.0| 832302767|<br/>+-------+--------+------+----------+<br/>only showing top 20 rows</span></pre><blockquote class="ky kz la"><p id="add0" class="jb jc lb jd b je jf jg jh ji jj jk jl lc jn jo jp ld jr js jt le jv jw jx jy hm dt translated">现在，想看看排名前20的评论者给出的评分吗</p></blockquote><pre class="kh ki kj kk fq kl km kn ko aw kp dt"><span id="7111" class="kq kr ht km b fv ks kt l ku kv"># Top 20 reviewers in terms of number of ratings given<br/>ratings.groupBy("user_id").count().orderBy('count', ascending=False).show()</span></pre><p id="ceee" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">得到这样的数据</p><pre class="kh ki kj kk fq kl km kn ko aw kp dt"><span id="8639" class="kq kr ht km b fv ks kt l ku kv">+-------+-----+<br/>|user_id|count|<br/>+-------+-----+<br/>|  45811|18276|<br/>|   8659| 9279|<br/>| 270123| 7638|<br/>| 179792| 7515|<br/>| 228291| 7410|<br/>| 243443| 6320|<br/>|  98415| 6094|<br/>| 229879| 6024|<br/>|  98787| 5814|<br/>| 172224| 5701|<br/>| 230417| 5619|<br/>|  70648| 5356|<br/>| 194690| 5206|<br/>| 107720| 5169|<br/>|  24025| 4946|<br/>| 165352| 4921|<br/>| 101276| 4834|<br/>| 243331| 4834|<br/>|  74275| 4815|<br/>|  41190| 4785|<br/>+-------+-----+<br/>only showing top 20 rows</span></pre><p id="0d2d" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">在上面的查询运行和数据处理的时候，你会在命令提示符下看到你从哪里启动了<strong class="jd hu"> Jupyter </strong> Notebook。</p><figure class="kh ki kj kk fq iu fe ff paragraph-image"><div role="button" tabindex="0" class="iv iw di ix bf iy"><div class="fe ff lg"><img src="../Images/19ab23c68da5a5a02dfe7993494caf89.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*73TCfdQXpOD6mh-OprANsw.png"/></div></div></figure><p id="c47c" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">这意味着它从DB(Cassandra Cluster)流式传输数据，并在其上进行操作。</p><p id="57ff" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">在这里，我想选择2个用户，并想看看他们有多少相似的电影评级，以及他们中的任何一个人审查了多少独特的电影。</p><blockquote class="ky kz la"><p id="7cc9" class="jb jc lb jd b je jf jg jh ji jj jk jl lc jn jo jp ld jr js jt le jv jw jx jy hm dt translated">为了做到这一点，让我们看看评级数据框架的模式是什么样子的。</p></blockquote><pre class="kh ki kj kk fq kl km kn ko aw kp dt"><span id="f04e" class="kq kr ht km b fv ks kt l ku kv">#Schema of ratings data frame<br/>ratings.printSchema()</span></pre><blockquote class="ky kz la"><p id="1e48" class="jb jc lb jd b je jf jg jh ji jj jk jl lc jn jo jp ld jr js jt le jv jw jx jy hm dt translated">现在让我们选择每个用户评价的电影。</p></blockquote><pre class="kh ki kj kk fq kl km kn ko aw kp dt"><span id="2243" class="kq kr ht km b fv ks kt l ku kv"># Selecting 2 users rated movies<br/>firstUserMovies = ratings.where(ratings["user_id"] == 45811).select("movie_id")<br/>secondUserMovies = ratings.where(ratings["user_id"] == 98415).select("movie_id")</span></pre><p id="1fef" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">此时spark不查询任何数据。Spark以一种懒惰的方式工作，除非你想做一些与数据相关的事情，否则只有它会得到数据。对于每个操作，它都将获取数据，为了避免这种情况，我们可以缓存它。每当它第一次获得数据时，它只是缓存它，并在下次从缓存中使用它，而不是再次从数据库中获取。</p><blockquote class="ky kz la"><p id="0e75" class="jb jc lb jd b je jf jg jh ji jj jk jl lc jn jo jp ld jr js jt le jv jw jx jy hm dt translated">让我们缓存数据帧。</p></blockquote><pre class="kh ki kj kk fq kl km kn ko aw kp dt"><span id="73be" class="kq kr ht km b fv ks kt l ku kv"># Caching the data frames of users<br/>firstUserMovies = firstUserMovies.cache()<br/>secondUserMovies = secondUserMovies.cache()</span></pre><blockquote class="ky kz la"><p id="94ab" class="jb jc lb jd b je jf jg jh ji jj jk jl lc jn jo jp ld jr js jt le jv jw jx jy hm dt translated">现在，一切都准备好了，我们需要让两个用户评论一些电影</p></blockquote><pre class="kh ki kj kk fq kl km kn ko aw kp dt"><span id="8546" class="kq kr ht km b fv ks kt l ku kv"># 20 common movies both users reviewed<br/>firstUserMovies.intersect(secondUserMovies).show()</span></pre><p id="e78e" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">它会给出这样的数据</p><pre class="kh ki kj kk fq kl km kn ko aw kp dt"><span id="4df3" class="kq kr ht km b fv ks kt l ku kv">+--------+<br/>|movie_id|<br/>+--------+<br/>|     471|<br/>|    1088|<br/>|    1238|<br/>|    1342|<br/>|    1580|<br/>|    1645|<br/>|    1959|<br/>|    2122|<br/>|    2366|<br/>|    2866|<br/>|    3175|<br/>|    3918|<br/>|    5300|<br/>|    6357|<br/>|    6466|<br/>|    6620|<br/>|    6658|<br/>|    7253|<br/>|    7982|<br/>|    8638|<br/>+--------+<br/>only showing top 20 rows</span></pre><p id="4e54" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">我想核实一下，或者只是确认一下我做得对不对。所以，选一部电影，检查一下。在这种情况下，我选择id为3918的电影，并检查。</p><blockquote class="ky kz la"><p id="0028" class="jb jc lb jd b je jf jg jh ji jj jk jl lc jn jo jp ld jr js jt le jv jw jx jy hm dt translated">检查第一个用户是否审阅过</p></blockquote><pre class="kh ki kj kk fq kl km kn ko aw kp dt"><span id="6528" class="kq kr ht km b fv ks kt l ku kv"># Verifying wether first user reviewed these movies or not<br/>firstUserMovies.where(firstUserMovies["movie_id"] == 3918).show()</span></pre><p id="4a22" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">输出:</p><pre class="kh ki kj kk fq kl km kn ko aw kp dt"><span id="c40d" class="kq kr ht km b fv ks kt l ku kv">+--------+<br/>|movie_id|<br/>+--------+<br/>|    3918|<br/>+--------+</span></pre><blockquote class="ky kz la"><p id="8986" class="jb jc lb jd b je jf jg jh ji jj jk jl lc jn jo jp ld jr js jt le jv jw jx jy hm dt translated">要检查第二个用户是否检查过</p></blockquote><pre class="kh ki kj kk fq kl km kn ko aw kp dt"><span id="0cd2" class="kq kr ht km b fv ks kt l ku kv"># Verifying wether second user reviewed these movies or not<br/>secondUserMovies.where(secondUserMovies["movie_id"] == 3918).show()</span></pre><p id="d16c" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">输出:</p><pre class="kh ki kj kk fq kl km kn ko aw kp dt"><span id="ba5a" class="kq kr ht km b fv ks kt l ku kv">+--------+<br/>|movie_id|<br/>+--------+<br/>|    3918|<br/>+--------+</span></pre><blockquote class="ky kz la"><p id="9a2d" class="jb jc lb jd b je jf jg jh ji jj jk jl lc jn jo jp ld jr js jt le jv jw jx jy hm dt translated">为了知道两个用户评论的电影数量</p></blockquote><pre class="kh ki kj kk fq kl km kn ko aw kp dt"><span id="9a95" class="kq kr ht km b fv ks kt l ku kv">firstUserMovies.intersect(secondUserMovies).count()</span></pre><p id="182a" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">输出:</p><pre class="kh ki kj kk fq kl km kn ko aw kp dt"><span id="76fd" class="kq kr ht km b fv ks kt l ku kv">4488</span></pre><blockquote class="ky kz la"><p id="d3f8" class="jb jc lb jd b je jf jg jh ji jj jk jl lc jn jo jp ld jr js jt le jv jw jx jy hm dt translated">知道他们总共评论了多少独特的电影</p></blockquote><pre class="kh ki kj kk fq kl km kn ko aw kp dt"><span id="dfc4" class="kq kr ht km b fv ks kt l ku kv"># In total How many unique movies they reviewed<br/>firstUserMovies.union(secondUserMovies).distinct().count()</span></pre><p id="9939" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">输出:</p><pre class="kh ki kj kk fq kl km kn ko aw kp dt"><span id="7869" class="kq kr ht km b fv ks kt l ku kv">19882</span></pre><blockquote class="ky kz la"><p id="763e" class="jb jc lb jd b je jf jg jh ji jj jk jl lc jn jo jp ld jr js jt le jv jw jx jy hm dt translated">一旦你不希望数据被保留在缓存中，那么</p></blockquote><pre class="kh ki kj kk fq kl km kn ko aw kp dt"><span id="a893" class="kq kr ht km b fv ks kt l ku kv"># Removing data frame from Cache<br/>firstUserMovies.unpersist()<br/>secondUserMovies.unpersist()</span></pre><blockquote class="ky kz la"><p id="4b45" class="jb jc lb jd b je jf jg jh ji jj jk jl lc jn jo jp ld jr js jt le jv jw jx jy hm dt translated">如果您想关闭PySpark上下文，那么</p></blockquote><pre class="kh ki kj kk fq kl km kn ko aw kp dt"><span id="ba02" class="kq kr ht km b fv ks kt l ku kv"># Shutdowning PySpark Context<br/>sc.stop()</span></pre><p id="0f30" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">你可以在<a class="ae jz" href="https://github.com/tankala/spark-examples" rel="noopener ugc nofollow" target="_blank">我的GitHub库</a>找到这个Jupyter笔记本。</p><p id="ad74" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">和平。快乐编码。<br/> <a class="ae jz" href="https://blog.tanka.la/2018/09/06/running-pyspark-with-cassandra-using-spark-cassandra-connector-in-jupyter-notebook/" rel="noopener ugc nofollow" target="_blank">这里看我的原创文章。</a></p></div><div class="ab cl ka kb hb kc" role="separator"><span class="kd bw bk ke kf kg"/><span class="kd bw bk ke kf kg"/><span class="kd bw bk ke kf"/></div><div class="hm hn ho hp hq"><blockquote class="ky kz la"><p id="e64f" class="jb jc lb jd b je jf jg jh ji jj jk jl lc jn jo jp ld jr js jt le jv jw jx jy hm dt translated">一些好的参考资料:</p></blockquote><div class="lh li fm fo lj lk"><a href="https://github.com/datastax/spark-cassandra-connector/blob/master/doc/15_python.md" rel="noopener  ugc nofollow" target="_blank"><div class="ll ab ej"><div class="lm ab ln cl cj lo"><h2 class="bd hu fv z el lp eo ep lq er et hs dt translated">datastax/spark-Cassandra-连接器</h2><div class="lr l"><h3 class="bd b fv z el lp eo ep lq er et ek translated">DataStax火花卡珊德拉连接器。创建一个帐户，为datastax/spark-Cassandra-connector开发做贡献…</h3></div><div class="ls l"><p class="bd b gc z el lp eo ep lq er et ek translated">github.com</p></div></div><div class="lt l"><div class="lu l lv lw lx lt ly iz lk"/></div></div></a></div><div class="lh li fm fo lj lk"><a rel="noopener follow" target="_blank" href="/@amirziai/running-pyspark-with-cassandra-in-jupyter-2bf5e95c319"><div class="ll ab ej"><div class="lm ab ln cl cj lo"><h2 class="bd hu fv z el lp eo ep lq er et hs dt translated">和卡桑德拉一起在朱庇特经营PySpark</h2><div class="lr l"><h3 class="bd b fv z el lp eo ep lq er et ek translated">Apache Cassandra是一个开源的分布式数据库系统。使用Python与Cassandra进行交互…</h3></div><div class="ls l"><p class="bd b gc z el lp eo ep lq er et ek translated">medium.com</p></div></div><div class="lt l"><div class="lz l lv lw lx lt ly iz lk"/></div></div></a></div><figure class="kh ki kj kk fq iu"><div class="bz el l di"><div class="ma mb l"/></div></figure><blockquote class="mc"><p id="ee53" class="md me ht bd mf mg mh mi mj mk ml jy ek translated"><a class="ae jz" href="https://coincodecap.com/?utm_source=coinmonks" rel="noopener ugc nofollow" target="_blank">在您的收件箱中直接获得最佳软件交易</a></p></blockquote><figure class="mn mo mp mq mr iu fe ff paragraph-image"><a href="https://coincodecap.com/?utm_source=coinmonks"><div class="fe ff mm"><img src="../Images/7c0b3dfdcbfea594cc0ae7d4f9bf6fcb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1168/format:webp/0*OJ-qb5G6i863msBB.png"/></div></a></figure></div></div>    
</body>
</html>