# Solidity å’Œ Web3.js

> åŸæ–‡ï¼š<https://medium.com/coinmonks/solidity-and-web3-js-141115b0f8c5?source=collection_archive---------0----------------------->

## å‚è€ƒ:cryptozombies.io

![](img/0fb62edac19a67285656f39e7859982d.png)

ç„¶è€Œï¼Œä½¿ç”¨ web3.js çš„å¦ä¸€ç§æ–¹å¼ä¸æ­¤å¤§ç›¸å¾„åº­ï¼Œä¹Ÿè¯·é˜…è¯»æ­¤æ–‡:[https://medium . com/@ yang nana 11/interactive-with-a-smart-contract-through-web 3-js-tutorial-56 a7 ff 2ff 153](/@yangnana11/interacting-with-a-smart-contract-through-web3-js-tutorial-56a7ff2ff153)

# Web3.js æ˜¯ä»€ä¹ˆï¼Ÿ

è®°ä½ï¼Œä»¥å¤ªåŠç½‘ç»œæ˜¯ç”±èŠ‚ç‚¹ç»„æˆçš„ï¼Œæ¯ä¸ªèŠ‚ç‚¹éƒ½åŒ…å«ä¸€ä»½åŒºå—é“¾ã€‚å½“æ‚¨æƒ³è¦è°ƒç”¨æ™ºèƒ½åˆçº¦ä¸Šçš„å‡½æ•°æ—¶ï¼Œæ‚¨éœ€è¦æŸ¥è¯¢å…¶ä¸­ä¸€ä¸ªèŠ‚ç‚¹å¹¶å‘Šè¯‰å®ƒ:

1.  æ™ºèƒ½åˆåŒçš„åœ°å€
2.  æ‚¨æƒ³è¦è°ƒç”¨çš„å‡½æ•°ï¼Œä»¥åŠ
3.  è¦ä¼ é€’ç»™è¯¥å‡½æ•°çš„å˜é‡ã€‚

> æ–°æ‰‹äº¤æ˜“è¯•è¯•[å¯†ç äº¤æ˜“æœºå™¨äºº](/coinmonks/crypto-trading-bot-c2ffce8acb2a)æˆ–è€…[å¤åˆ¶äº¤æ˜“](/coinmonks/top-10-crypto-copy-trading-platforms-for-beginners-d0c37c7d698c)

ä»¥å¤ªåŠèŠ‚ç‚¹åªè¯´ä¸€ç§å«åš **JSON-RPC** çš„è¯­è¨€ï¼Œè¿™ç§è¯­è¨€ä¸å¤ªå®¹æ˜“è¢«äººè¯»æ‡‚ã€‚å‘Šè¯‰èŠ‚ç‚¹æ‚¨æƒ³è¦è°ƒç”¨å¥‘çº¦ä¸Šçš„å‡½æ•°çš„æŸ¥è¯¢å¦‚ä¸‹æ‰€ç¤º:

```
// Yeah... Good luck writing all your function calls this way!
{"jsonrpc":"2.0","method":"eth_sendTransaction","params":[{"from":"0xb60e8dd61c5d32be8058bb8eb970870f07233155","to":"0xd46e8dd67c5d32be8058bb8eb970870f07244567","gas":"0x76c0","gasPrice":"0x9184e72a000","value":"0x9184e72a","data":"0xd46e8dd67c5d32be8d46e8dd67c5d32be8058bb8eb970870f072445675058bb8eb970870f072445675"}],"id":1}
```

å¹¸è¿çš„æ˜¯ï¼ŒWeb3.js å°†è¿™äº›è®¨åŒçš„æŸ¥è¯¢éšè—åœ¨è¡¨é¢ä¹‹ä¸‹ï¼Œæ‰€ä»¥æ‚¨åªéœ€è¦ä¸ä¸€ä¸ªæ–¹ä¾¿ä¸”æ˜“è¯»çš„ JavaScript æ¥å£è¿›è¡Œäº¤äº’ã€‚

ä¸éœ€è¦æ„é€ ä¸Šé¢çš„æŸ¥è¯¢ï¼Œåœ¨æ‚¨çš„ä»£ç ä¸­è°ƒç”¨ä¸€ä¸ªå‡½æ•°å°†çœ‹èµ·æ¥åƒè¿™æ ·:

```
CryptoZombies.methods.createRandomZombie("Vitalik Nakamoto ğŸ¤”")
  .send({ from: "0xb60e8dd61c5d32be8058bb8eb970870f07233155", gas: "3000000" })
```

# 1.å…¥é—¨æŒ‡å—

æ ¹æ®é¡¹ç›®çš„å·¥ä½œæµç¨‹ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨å¤§å¤šæ•°åŒ…å·¥å…·å°† Web3.js æ·»åŠ åˆ°é¡¹ç›®ä¸­:

```
*// Using NPM*
npm install web3*// Using Yarn*
yarn add web3*// Using Bower*
bower install web3*// ...etc.*
```

æˆ–è€…æ‚¨å¯ä»¥ä» [github](https://github.com/ethereum/web3.js/blob/1.0/dist/web3.min.js) ä¸‹è½½ç¼©å°çš„`.js`æ–‡ä»¶ï¼Œå¹¶å°†å…¶åŒ…å«åœ¨æ‚¨çš„é¡¹ç›®ä¸­:

```
<script language="javascript" type="text/javascript" src="web3.min.js"></script>
```

# **Web3 æä¾›å•†**

è®°ä½ï¼Œä»¥å¤ªåŠæ˜¯ç”±**èŠ‚ç‚¹**ç»„æˆçš„ï¼Œå®ƒä»¬å…±äº«ç›¸åŒæ•°æ®çš„å‰¯æœ¬ã€‚åœ¨ Web3.js ä¸­è®¾ç½® Web3 Provider å‘Šè¯‰æˆ‘ä»¬çš„ä»£ç **æˆ‘ä»¬åº”è¯¥ä¸å“ªä¸ªèŠ‚ç‚¹**å¯¹è¯æ¥å¤„ç†æˆ‘ä»¬çš„è¯»å†™ã€‚è¿™æœ‰ç‚¹åƒåœ¨ä¼ ç»Ÿçš„ web åº”ç”¨ç¨‹åºä¸­ä¸º API è°ƒç”¨è®¾ç½®è¿œç¨‹ web æœåŠ¡å™¨çš„ URLã€‚

æ‚¨å¯ä»¥ä½œä¸ºæä¾›è€…æ‰˜ç®¡è‡ªå·±çš„ä»¥å¤ªåŠèŠ‚ç‚¹ã€‚ç„¶è€Œï¼Œæœ‰ä¸€ä¸ªç¬¬ä¸‰æ–¹æœåŠ¡è®©ä½ çš„ç”Ÿæ´»æ›´è½»æ¾ï¼Œè¿™æ ·ä½ å°±ä¸éœ€è¦ä¸ºäº†ç»™ä½ çš„ç”¨æˆ·æä¾› DApp è€Œç»´æŠ¤è‡ªå·±çš„ä»¥å¤ªåŠèŠ‚ç‚¹äº†ã€‚

# Infura

Infura æ˜¯ä¸€ä¸ªç»´æŠ¤ä¸€ç»„ä»¥å¤ªåŠèŠ‚ç‚¹çš„æœåŠ¡ï¼Œè¿™äº›èŠ‚ç‚¹æœ‰ä¸€ä¸ªç”¨äºå¿«é€Ÿè¯»å–çš„ç¼“å­˜å±‚ï¼Œä½ å¯ä»¥é€šè¿‡ä»–ä»¬çš„ API å…è´¹è®¿é—®ã€‚ä½¿ç”¨ Infura ä½œä¸ºæä¾›è€…ï¼Œæ‚¨å¯ä»¥å¯é åœ°å‘/ä»ä»¥å¤ªåŠåŒºå—é“¾å‘é€å’Œæ¥æ”¶æ¶ˆæ¯ï¼Œè€Œä¸éœ€è¦è®¾ç½®å’Œç»´æŠ¤æ‚¨è‡ªå·±çš„èŠ‚ç‚¹ã€‚

æ‚¨å¯ä»¥è®¾ç½® Web3 ä½¿ç”¨ Infura ä½œä¸ºæ‚¨çš„ web3 æä¾›å•†ï¼Œå¦‚ä¸‹æ‰€ç¤º:

```
var web3 = new Web3(new Web3.providers.WebsocketProvider("wss://mainnet.infura.io/ws"));
```

ç„¶è€Œï¼Œç”±äºæˆ‘ä»¬çš„ DApp å°†è¢«è®¸å¤šç”¨æˆ·ä½¿ç”¨â€”â€”è¿™äº›ç”¨æˆ·å°†å†™åŒºå—é“¾ï¼Œè€Œä¸ä»…ä»…æ˜¯è¯»å®ƒâ€”â€”æˆ‘ä»¬éœ€è¦ä¸€ç§æ–¹æ³•è®©è¿™äº›ç”¨æˆ·ç”¨ä»–ä»¬çš„ç§é’¥ç­¾ç½²äº¤æ˜“ã€‚

> æ³¨æ„:ä»¥å¤ªåŠ(ä»¥åŠä¸€èˆ¬çš„åŒºå—é“¾)ä½¿ç”¨å…¬é’¥/ç§é’¥å¯¹å¯¹äº¤æ˜“è¿›è¡Œæ•°å­—ç­¾åã€‚å¯ä»¥æŠŠå®ƒæƒ³è±¡æˆä¸€ä¸ªéå¸¸å®‰å…¨çš„æ•°å­—ç­¾åå¯†ç ã€‚è¿™æ ·ï¼Œå¦‚æœæˆ‘æ›´æ”¹äº†åŒºå—é“¾ä¸Šçš„ä¸€äº›æ•°æ®ï¼Œæˆ‘å¯ä»¥é€šè¿‡æˆ‘çš„å…¬é’¥å‘ T4 è¯æ˜æˆ‘æ˜¯ç­¾åè€…â€”â€”ä½†æ˜¯å› ä¸ºæ²¡æœ‰äººçŸ¥é“æˆ‘çš„ç§é’¥ï¼Œæ‰€ä»¥æ²¡æœ‰äººèƒ½ä¸ºæˆ‘ä¼ªé€ äº¤æ˜“ã€‚

å¯†ç å­¦å¾ˆå¤æ‚ï¼Œæ‰€ä»¥é™¤éä½ æ˜¯ä¸€ä¸ªå®‰å…¨ä¸“å®¶ï¼Œä½ çœŸçš„çŸ¥é“ä½ åœ¨åšä»€ä¹ˆï¼Œå¦åˆ™å°è¯•åœ¨æˆ‘ä»¬çš„åº”ç”¨å‰ç«¯è‡ªå·±ç®¡ç†ç”¨æˆ·çš„ç§é’¥å¯èƒ½ä¸æ˜¯ä¸€ä¸ªå¥½ä¸»æ„ã€‚

ä½†å¹¸è¿çš„æ˜¯ï¼Œä½ ä¸éœ€è¦è¿™æ ·åšâ€”â€”å·²ç»æœ‰æœåŠ¡ä¸ºä½ å¤„ç†è¿™äº›äº†ã€‚å…¶ä¸­æœ€å—æ¬¢è¿çš„æ˜¯ **Metamask** ã€‚

# å…ƒæ©ç 

[Metamask](https://metamask.io/) æ˜¯ Chrome å’Œ Firefox çš„æµè§ˆå™¨æ‰©å±•ï¼Œå…è®¸ç”¨æˆ·å®‰å…¨åœ°ç®¡ç†ä»–ä»¬çš„ä»¥å¤ªåŠè´¦æˆ·å’Œç§é’¥ï¼Œå¹¶ä½¿ç”¨è¿™äº›è´¦æˆ·ä¸ä½¿ç”¨ Web3.js çš„ç½‘ç«™è¿›è¡Œäº¤äº’ã€‚(å¦‚æœä½ ä»¥å‰æ²¡æœ‰ä½¿ç”¨è¿‡å®ƒï¼Œä½ è‚¯å®šä¼šæƒ³å»å®‰è£…å®ƒâ€”â€”é‚£ä¹ˆä½ çš„æµè§ˆå™¨æ˜¯ Web3 å¯ç”¨çš„ï¼Œç°åœ¨ä½ å¯ä»¥ä¸ä»»ä½•ä¸ä»¥å¤ªåŠåŒºå—é“¾é€šä¿¡çš„ç½‘ç«™è¿›è¡Œäº¤äº’ï¼).

ä½œä¸ºä¸€åå¼€å‘äººå‘˜ï¼Œå¦‚æœä½ æƒ³è®©ç”¨æˆ·åœ¨ä»–ä»¬çš„ç½‘ç»œæµè§ˆå™¨ä¸­é€šè¿‡ä¸€ä¸ªç½‘ç«™ä¸ä½ çš„ DApp è¿›è¡Œäº¤äº’(å°±åƒæˆ‘ä»¬å¯¹ CryptoZombies æ¸¸æˆæ‰€åšçš„é‚£æ ·)ï¼Œä½ è‚¯å®šä¼šæƒ³è®©å®ƒå…¼å®¹ Metamaskã€‚

> **æ³¨æ„** : Metamask ä½¿ç”¨ Infura çš„æœåŠ¡å™¨ä½œä¸º web3 æä¾›å•†ï¼Œå°±åƒæˆ‘ä»¬ä¸Šé¢åšçš„ä¸€æ ·â€”â€”ä½†æ˜¯å®ƒä¹Ÿç»™ç”¨æˆ·é€‰æ‹©ä»–ä»¬è‡ªå·±çš„ web3 æä¾›å•†çš„é€‰é¡¹ã€‚æ‰€ä»¥é€šè¿‡ä½¿ç”¨ Metamask çš„ web3 providerï¼Œä½ ç»™äº†ç”¨æˆ·ä¸€ä¸ªé€‰æ‹©çš„æœºä¼šï¼Œä½ åœ¨åº”ç”¨ç¨‹åºä¸­å°±å°‘äº†ä¸€ä»¶éœ€è¦æ‹…å¿ƒçš„äº‹æƒ…ã€‚

# ä½¿ç”¨ Metamask çš„ web3 æä¾›ç¨‹åº

Metamask å°†ä»–ä»¬çš„ web3 æä¾›è€…æ³¨å…¥åˆ°æµè§ˆå™¨çš„å…¨å±€ JavaScript å¯¹è±¡`web3`ä¸­ã€‚æ‰€ä»¥ä½ çš„åº”ç”¨ç¨‹åºå¯ä»¥æ£€æŸ¥`web3`æ˜¯å¦å­˜åœ¨ï¼Œä»¥åŠå®ƒæ˜¯å¦ä½¿ç”¨`web3.currentProvider`ä½œä¸ºå®ƒçš„æä¾›è€…ã€‚

ä»¥ä¸‹æ˜¯ Metamask æä¾›çš„ä¸€äº›æ¨¡æ¿ä»£ç ï¼Œè¯´æ˜æˆ‘ä»¬å¦‚ä½•æ£€æµ‹ç”¨æˆ·æ˜¯å¦å®‰è£…äº† Metamaskï¼Œå¦‚æœæ²¡æœ‰ï¼Œå‘Šè¯‰ä»–ä»¬éœ€è¦å®‰è£…å®ƒæ‰èƒ½ä½¿ç”¨æˆ‘ä»¬çš„åº”ç”¨ç¨‹åº:

```
window.addEventListener('load', function() {*// Checking if Web3 has been injected by the browser (Mist/MetaMask)*
  if (typeof web3 !== 'undefined') {
    *// Use Mist/MetaMask's provider*
    web3js = new Web3(web3.currentProvider);
  } else {
    *// Handle the case where the user doesn't have web3\. Probably* 
    *// show them a message telling them to install Metamask in* 
    *// order to use our app.*
    // For example
    // web3 = new Web3(new Web3.providers.HttpProvider("http://localhost:8545"));
  } *// Now you can start your app & access web3js freely:*
  startApp()})
```

æ‚¨å¯ä»¥åœ¨æ‚¨åˆ›å»ºçš„æ‰€æœ‰åº”ç”¨ç¨‹åºä¸­ä½¿ç”¨æ­¤æ ·æœ¬ä»£ç ï¼Œä»¥è¦æ±‚ç”¨æˆ·æ‹¥æœ‰å…ƒæ©ç æ‰èƒ½ä½¿ç”¨æ‚¨çš„ DAppã€‚

> æ³¨æ„:é™¤äº†å…ƒæ©ç ä¹‹å¤–ï¼Œæ‚¨çš„ç”¨æˆ·å¯èƒ½è¿˜ä¼šä½¿ç”¨å…¶ä»–ç§é’¥ç®¡ç†ç¨‹åºï¼Œä¾‹å¦‚ web æµè§ˆå™¨ **Mist** ã€‚ç„¶è€Œï¼Œå®ƒä»¬éƒ½å®ç°äº†æ³¨å…¥å˜é‡`web3`çš„é€šç”¨æ¨¡å¼ï¼Œæ‰€ä»¥æˆ‘ä»¬åœ¨è¿™é‡Œæè¿°çš„ç”¨äºæ£€æµ‹ç”¨æˆ·çš„ web3 æä¾›è€…çš„æ–¹æ³•ä¹Ÿé€‚ç”¨äºè¿™äº›ã€‚

# 2.ä¸åˆåŒå¯¹è¯

ç°åœ¨æˆ‘ä»¬å·²ç»ç”¨ MetaMask çš„ Web3 provider åˆå§‹åŒ–äº† Web3.jsï¼Œè®©æˆ‘ä»¬è®¾ç½®å®ƒä¸æˆ‘ä»¬çš„æ™ºèƒ½å¥‘çº¦å¯¹è¯ã€‚

Web3.js éœ€è¦ä¸¤ä»¶ä¸œè¥¿æ¥å’Œä½ çš„åˆåŒå¯¹è¯:å®ƒçš„**åœ°å€**å’Œå®ƒçš„ **ABI** ã€‚

# åˆåŒåœ°å€

åœ¨æ‚¨å®Œæˆç¼–å†™æ‚¨çš„æ™ºèƒ½å¥‘çº¦ä¹‹åï¼Œæ‚¨å°†ç¼–è¯‘å®ƒå¹¶å°†å…¶éƒ¨ç½²åˆ°ä»¥å¤ªåŠã€‚æˆ‘ä»¬å°†åœ¨ä¸‹ä¸€è¯¾çš„**ä¸­è®²è¿°**éƒ¨ç½²**ï¼Œä½†æ˜¯ç”±äºè¿™æ˜¯ä¸€ä¸ªä¸ç¼–å†™ä»£ç å®Œå…¨ä¸åŒçš„è¿‡ç¨‹ï¼Œæˆ‘ä»¬å†³å®šæ‰“ç ´é¡ºåºï¼Œå…ˆè®²è¿° Web3.jsã€‚**

åœ¨ä½ éƒ¨ç½²ä½ çš„åˆåŒåï¼Œå®ƒä¼šåœ¨ä»¥å¤ªåŠä¸Šè·å¾—ä¸€ä¸ªå›ºå®šçš„åœ°å€ï¼Œåœ¨é‚£é‡Œå®ƒå°†æ°¸è¿œå­˜åœ¨ã€‚ä»¥å¤ªåŠä¸»ç½‘ä¸Š CryptoKitties åˆçº¦çš„åœ°å€æ˜¯`YOUR_CONTRACT_ADDRESS`ã€‚

æ‚¨éœ€è¦åœ¨éƒ¨ç½²åå¤åˆ¶æ­¤åœ°å€ï¼Œä»¥ä¾¿ä¸æ‚¨çš„ smart contract å¯¹è¯ã€‚

# åˆåŒ ABI

Web3.js éœ€è¦å’Œä½ çš„åˆåŒè®¨è®ºçš„å¦ä¸€ä»¶äº‹æ˜¯å®ƒçš„ ABIã€‚

ABI ä»£è¡¨åº”ç”¨ç¨‹åºäºŒè¿›åˆ¶æ¥å£ã€‚åŸºæœ¬ä¸Šï¼Œå®ƒæ˜¯ JSON æ ¼å¼çš„å¥‘çº¦æ–¹æ³•çš„è¡¨ç¤ºï¼Œå‘Šè¯‰ Web3.js å¦‚ä½•ä»¥å¥‘çº¦å¯ä»¥ç†è§£çš„æ–¹å¼æ ¼å¼åŒ–å‡½æ•°è°ƒç”¨ã€‚

å½“æ‚¨ç¼–è¯‘æ‚¨çš„åˆåŒä»¥éƒ¨ç½²åˆ°ä»¥å¤ªåŠæ—¶ï¼ŒSolidity ç¼–è¯‘å™¨å°†ç»™æ‚¨ ABIï¼Œæ‰€ä»¥é™¤äº†åˆåŒåœ°å€ä¹‹å¤–ï¼Œæ‚¨è¿˜éœ€è¦å¤åˆ¶å¹¶ä¿å­˜å®ƒã€‚

# å®ä¾‹åŒ– Web3.js åå®š

ä¸€æ—¦æœ‰äº†åˆåŒçš„åœ°å€å’Œ ABIï¼Œå°±å¯ä»¥åœ¨ Web3 ä¸­å®ä¾‹åŒ–å®ƒï¼Œå¦‚ä¸‹æ‰€ç¤º:

```
*// Instantiate myContract*
var myContract = new web3js.eth.Contract(myABI, myContractAddress);
```

# 3.è°ƒç”¨åˆåŒåŠŸèƒ½

æˆ‘ä»¬çš„åˆåŒéƒ½å‡†å¤‡å¥½äº†ï¼ç°åœ¨æˆ‘ä»¬å¯ä»¥ç”¨ Web3.js å’Œå®ƒå¯¹è¯äº†ã€‚

Web3.js æœ‰ä¸¤ä¸ªæ–¹æ³•ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨å®ƒä»¬æ¥è°ƒç”¨å¥‘çº¦ä¸­çš„å‡½æ•°:`call`å’Œ`send`ã€‚

# æ‰“ç”µè¯

`call`ç”¨äº`view`å’Œ`pure`åŠŸèƒ½ã€‚å®ƒåªåœ¨æœ¬åœ°èŠ‚ç‚¹ä¸Šè¿è¡Œï¼Œä¸ä¼šåœ¨åŒºå—é“¾ä¸Šåˆ›å»ºäº‹åŠ¡ã€‚

> **å›é¡¾:** `view`å’Œ`pure`åŠŸèƒ½æ˜¯åªè¯»çš„ï¼Œä¸æ”¹å˜åŒºå—é“¾çš„çŠ¶æ€ã€‚å®ƒä»¬ä¹Ÿä¸æ¶ˆè€—ä»»ä½•æ±½æ²¹ï¼Œç”¨æˆ·ä¸ä¼šè¢«æç¤ºä¸ MetaMask ç­¾ç½²äº¤æ˜“ã€‚

ä½¿ç”¨ Web3.jsï¼Œæ‚¨å°†ä½¿ç”¨å‚æ•°`123`æ¥`call`ä¸€ä¸ªåä¸º`myMethod`çš„å‡½æ•°ï¼Œå¦‚ä¸‹æ‰€ç¤º:

```
myContract.methods.myMethod(123).call()
```

# å‘é€

`send`å°†åˆ›å»ºäº¤æ˜“å¹¶æ›´æ”¹åŒºå—é“¾ä¸Šçš„æ•°æ®ã€‚å¯¹äºä»»ä½•ä¸æ˜¯`view`æˆ–`pure`çš„å‡½æ•°ï¼Œä½ éƒ½éœ€è¦ä½¿ç”¨`send`ã€‚

> **æ³¨:** `send` ing ä¸€ç¬”äº¤æ˜“ä¼šè¦æ±‚ç”¨æˆ·æ”¯ä»˜æ²¹è´¹ï¼Œå¹¶ä¼šå¼¹å‡ºä»–ä»¬çš„ Metamask æç¤ºä»–ä»¬ç­¾è®¢äº¤æ˜“ã€‚å½“æˆ‘ä»¬ä½¿ç”¨ Metamask ä½œä¸ºæˆ‘ä»¬çš„ web3 æä¾›è€…æ—¶ï¼Œè¿™ä¸€åˆ‡éƒ½åœ¨æˆ‘ä»¬è°ƒç”¨`send()`æ—¶è‡ªåŠ¨å‘ç”Ÿï¼Œæˆ‘ä»¬ä¸éœ€è¦åœ¨ä»£ç ä¸­åšä»»ä½•ç‰¹æ®Šçš„äº‹æƒ…ã€‚ç›¸å½“é…·ï¼

ä½¿ç”¨ Web3.jsï¼Œæ‚¨å°†ä½¿ç”¨å‚æ•°`123`è°ƒç”¨åä¸º`myMethod`çš„å‡½æ•°çš„`send`äº‹åŠ¡å¦‚ä¸‹:

```
myContract.methods.myMethod(123).send()
```

è¯­æ³•ä¸`call()`å‡ ä¹ç›¸åŒã€‚

# è·å–åƒµå°¸æ•°æ®

ç°åœ¨è®©æˆ‘ä»¬çœ‹ä¸€ä¸ªä½¿ç”¨`call`è®¿é—®åˆåŒæ•°æ®çš„çœŸå®ä¾‹å­ã€‚

æˆ‘ä»¬åˆ¶ä½œäº†åƒµå°¸é˜µåˆ—`public`:

```
Zombie[] public zombies*;*
```

åœ¨ Solidity ä¸­ï¼Œå½“ä½ å£°æ˜ä¸€ä¸ªå˜é‡`public`æ—¶ï¼Œå®ƒä¼šè‡ªåŠ¨åˆ›å»ºä¸€ä¸ªåŒåçš„å…¬å…±â€œgetterâ€å‡½æ•°ã€‚æ‰€ä»¥å¦‚æœä½ æƒ³æŸ¥æ‰¾ id ä¸º`15`çš„åƒµå°¸ï¼Œä½ ä¼šåƒè°ƒç”¨å‡½æ•°ä¸€æ ·è°ƒç”¨å®ƒ:`zombies(15)`ã€‚

ä¸‹é¢æ˜¯æˆ‘ä»¬å¦‚ä½•åœ¨å‰ç«¯ç¼–å†™ä¸€ä¸ª JavaScript å‡½æ•°ï¼Œè¯¥å‡½æ•°æ¥å—ä¸€ä¸ªåƒµå°¸ idï¼Œåœ¨æˆ‘ä»¬çš„å¥‘çº¦ä¸­æŸ¥è¯¢è¯¥åƒµå°¸ï¼Œå¹¶è¿”å›ç»“æœ:

> æ³¨æ„:æˆ‘ä»¬åœ¨æœ¬è¯¾ä¸­ä½¿ç”¨çš„ä»£ç ä½¿ç”¨çš„æ˜¯ Web3.js çš„**1.0 ç‰ˆ**ï¼Œå®ƒä½¿ç”¨æ‰¿è¯ºè€Œä¸æ˜¯å›è°ƒã€‚ä½ å°†åœ¨ç½‘ä¸Šçœ‹åˆ°çš„è®¸å¤šå…¶ä»–æ•™ç¨‹ä½¿ç”¨çš„æ˜¯æ—§ç‰ˆæœ¬çš„ web 3 . jsã€‚1.0 ç‰ˆæœ¬çš„è¯­æ³•å‘ç”Ÿäº†å¾ˆå¤§å˜åŒ–ï¼Œæ‰€ä»¥å¦‚æœä½ ä»å…¶ä»–æ•™ç¨‹å¤åˆ¶ä»£ç ï¼Œè¯·ç¡®ä¿ä»–ä»¬ä½¿ç”¨çš„æ˜¯å’Œä½ ç›¸åŒçš„ç‰ˆæœ¬ï¼

```
function getZombieDetails(id) {
  return cryptoZombies.methods.zombies(id).call()
}*// Call the function and do something with the result:*
getZombieDetails(15)
.then(function(result) {
  console.log("Zombie 15: " + JSON.stringify(result));
});
```

è®©æˆ‘ä»¬çœ‹çœ‹è¿™é‡Œå‘ç”Ÿäº†ä»€ä¹ˆã€‚

`cryptoZombies.methods.zombies(id).call()`å°†ä¸ Web3 æä¾›è€…èŠ‚ç‚¹é€šä¿¡ï¼Œå¹¶å‘Šè¯‰å®ƒä»æˆ‘ä»¬çš„å¥‘çº¦ä¸Šçš„`Zombie[] public zombies`è¿”å›ç´¢å¼•ä¸º`id`çš„åƒµå°¸ã€‚

æ³¨æ„ï¼Œè¿™æ˜¯**å¼‚æ­¥**ï¼Œå°±åƒå¯¹å¤–éƒ¨æœåŠ¡å™¨çš„ API è°ƒç”¨ã€‚æ‰€ä»¥ Web3 åœ¨è¿™é‡Œè¿”å›ä¸€ä¸ªæ‰¿è¯ºã€‚(å¦‚æœæ‚¨ä¸ç†Ÿæ‚‰ JavaScript promisesâ€¦â€¦åœ¨ç»§ç»­ä¹‹å‰ï¼Œæ˜¯æ—¶å€™åšä¸€äº›é¢å¤–çš„åŠŸè¯¾äº†ï¼)

ä¸€æ—¦æ‰¿è¯ºå®Œæˆ(è¿™æ„å‘³ç€æˆ‘ä»¬ä» web3 æä¾›è€…é‚£é‡Œå¾—åˆ°äº†ä¸€ä¸ªå›ç­”)ï¼Œæˆ‘ä»¬çš„ç¤ºä¾‹ä»£ç ç»§ç»­æ‰§è¡Œ`then`è¯­å¥ï¼Œè¯¥è¯­å¥å°†`result`è®°å½•åˆ°æ§åˆ¶å°ã€‚

`result`å°†ä¼šæ˜¯ä¸€ä¸ªå¦‚ä¸‹æ‰€ç¤ºçš„ javascript å¯¹è±¡:

```
{
  "name": "H4XF13LD MORRIS'S COOLER OLDER BROTHER",
  "dna": "1337133713371337",
  "level": "9999",
  "readyTime": "1522498671",
  "winCount": "999999999",
  "lossCount": "0" // Obviously.
}
```

ç„¶åï¼Œæˆ‘ä»¬å¯ä»¥ç”¨ä¸€äº›å‰ç«¯é€»è¾‘æ¥è§£æè¿™ä¸ªå¯¹è±¡ï¼Œå¹¶ä»¥ä¸€ç§æœ‰æ„ä¹‰çš„æ–¹å¼åœ¨å‰ç«¯æ˜¾ç¤ºå®ƒã€‚

# è·å–å…ƒæ©ç ä¸­çš„ç”¨æˆ·å¸æˆ·

å…ƒæ©ç å…è®¸ç”¨æˆ·åœ¨å…¶æ‰©å±•ä¸­ç®¡ç†å¤šä¸ªå¸æˆ·ã€‚

æˆ‘ä»¬å¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼æŸ¥çœ‹æ³¨å…¥çš„`web3`å˜é‡ä¸­å“ªä¸ªè´¦æˆ·å½“å‰å¤„äºæ´»åŠ¨çŠ¶æ€:

```
var userAccount = web3.eth.accounts[0]
```

# â€¦

ç°åœ¨è®©æˆ‘ä»¬çœ‹çœ‹å¦‚ä½•ä½¿ç”¨`send`å‡½æ•°æ¥æ›´æ”¹æ™ºèƒ½åˆçº¦ä¸Šçš„æ•°æ®ã€‚

ä¸`call`åŠŸèƒ½æœ‰å‡ ä¸ªä¸»è¦åŒºåˆ«:

1.  `send`å¤„ç†ä¸€ä¸ªäº‹åŠ¡éœ€è¦ä¸€ä¸ªè°ƒç”¨å‡½æ•°çš„`from`åœ°å€(åœ¨ä½ çš„å®‰å…¨ä»£ç ä¸­å˜æˆ`msg.sender`)ã€‚æˆ‘ä»¬å¸Œæœ›è¿™æ˜¯æˆ‘ä»¬çš„ DApp çš„ç”¨æˆ·ï¼Œæ‰€ä»¥ MetaMask å°†å¼¹å‡ºæç¤ºä»–ä»¬ç­¾ç½²äº¤æ˜“ã€‚
2.  `send` ing äº¤æ˜“è´¹æ°”
3.  ä»ç”¨æˆ·å¼€å§‹å¤„ç†äº‹åŠ¡åˆ°è¯¥äº‹åŠ¡åœ¨åŒºå—é“¾ä¸Šå®é™…ç”Ÿæ•ˆä¼šæœ‰å¾ˆå¤§çš„å»¶è¿Ÿã€‚è¿™æ˜¯å› ä¸ºæˆ‘ä»¬å¿…é¡»ç­‰å¾…äº‹åŠ¡è¢«åŒ…å«åœ¨ä¸€ä¸ªå—ä¸­ï¼Œè€Œä»¥å¤ªåŠçš„å—æ—¶é—´å¹³å‡ä¸º 15 ç§’ã€‚å¦‚æœä»¥å¤ªåŠä¸Šæœ‰å¾ˆå¤šæœªå®Œæˆçš„äº¤æ˜“ï¼Œæˆ–è€…å¦‚æœç”¨æˆ·å‘é€çš„å¤©ç„¶æ°”ä»·æ ¼å¤ªä½ï¼Œæˆ‘ä»¬çš„äº¤æ˜“å¯èƒ½éœ€è¦ç­‰å¾…å‡ ä¸ªè¡—åŒºæ‰èƒ½è¢«åŒ…æ‹¬åœ¨å†…ï¼Œè¿™å¯èƒ½éœ€è¦å‡ åˆ†é’Ÿã€‚

# 4.è°ƒç”¨åº”ä»˜æ¬¾å‡½æ•°

åœ¨`ZombieHelper`åˆåŒä¸­ï¼Œæˆ‘ä»¬å¢åŠ äº†ä¸€ä¸ªä»˜è´¹åŠŸèƒ½ï¼Œç”¨æˆ·å¯ä»¥å‡çº§:

```
function levelUp(uint _zombieId) external payable {
  require(msg.value == levelUpFee);
  zombies[_zombieId].level++;
}
```

å°†ä»¥å¤ªå’Œå‡½æ•°ä¸€èµ·å‘é€çš„æ–¹æ³•å¾ˆç®€å•ï¼Œä½†æœ‰ä¸€ç‚¹éœ€è¦æ³¨æ„:æˆ‘ä»¬éœ€è¦åœ¨`wei`ä¸­æŒ‡å®šå‘é€å¤šå°‘ï¼Œè€Œä¸æ˜¯ä»¥å¤ªã€‚

# é­æ˜¯ä»€ä¹ˆï¼Ÿ

A `wei`æ˜¯ä»¥å¤ªçš„æœ€å°å­å•ä½â€”â€”ä¸€ä¸ª`ether`ä¸­æœ‰ 10^18 `wei`ã€‚

è¿™éœ€è¦æ•°å¾ˆå¤šä¸ªé›¶â€”â€”ä½†å¹¸è¿çš„æ˜¯ï¼ŒWeb3.js æœ‰ä¸€ä¸ªè½¬æ¢å®ç”¨ç¨‹åºå¯ä»¥å¸®æˆ‘ä»¬åšåˆ°è¿™ä¸€ç‚¹ã€‚

```
*// This will convert 1 ETH to Wei*
web3js.utils.toWei("1", "ether");
```

åœ¨æˆ‘ä»¬çš„ DApp ä¸­ï¼Œæˆ‘ä»¬è®¾ç½®äº†`levelUpFee = 0.001 ether`ï¼Œæ‰€ä»¥å½“æˆ‘ä»¬è°ƒç”¨æˆ‘ä»¬çš„`levelUp`å‡½æ•°æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¸‹é¢çš„ä»£ç è®©ç”¨æˆ·å‘é€`0.001`ä¹™é†š:

```
CryptoZombies.methods.levelUp(zombieId)
.send({ from: userAccount, value: web3js.utils.toWei("0.001", "ether") })
```

# 5.è®¢é˜…äº‹ä»¶

æ­£å¦‚ä½ æ‰€çœ‹åˆ°çš„ï¼Œé€šè¿‡ Web3.js ä¸ä½ çš„åˆåŒäº¤äº’æ˜¯éå¸¸ç®€å•çš„â€”â€”ä¸€æ—¦ä½ è®¾ç½®å¥½äº†ä½ çš„ç¯å¢ƒï¼Œå‡½æ•°å’Œäº‹åŠ¡ä¸æ™®é€šçš„ web API å¹¶æ²¡æœ‰ä»€ä¹ˆä¸åŒã€‚

æˆ‘ä»¬è¿˜æƒ³ä»‹ç»ä¸€ä¸ªæ–¹é¢â€”â€”ä»æ‚¨çš„åˆåŒä¸­è®¢é˜…äº‹ä»¶ã€‚

# ç›‘å¬æ–°çš„åƒµå°¸

ä»`zombiefactory.sol`å¼€å§‹ï¼Œæˆ‘ä»¬æœ‰ä¸€ä¸ªåä¸º`NewZombie`çš„äº‹ä»¶ï¼Œæ¯å½“ä¸€ä¸ªæ–°çš„åƒµå°¸è¢«åˆ›é€ å‡ºæ¥ï¼Œæˆ‘ä»¬å°±è§¦å‘è¿™ä¸ªäº‹ä»¶:

```
event NewZombie(uint zombieId, string name, uint dna);
```

åœ¨ Web3.js ä¸­ï¼Œæ‚¨å¯ä»¥**è®¢é˜…**ä¸€ä¸ªäº‹ä»¶ï¼Œè¿™æ ·æ‚¨çš„ web3 provider æ¯æ¬¡è§¦å‘æ—¶éƒ½ä¼šåœ¨æ‚¨çš„ä»£ç ä¸­è§¦å‘ä¸€äº›é€»è¾‘:

```
cryptoZombies.events.NewZombie()
.on("data", function(event) {
  let zombie = event.returnValues;
  *// We can access this event's 3 return values on the `event.returnValues` object:*
  console.log("A new zombie was born!", zombie.zombieId, zombie.name, zombie.dna);
}).on("error", console.error);
```

è¯·æ³¨æ„ï¼Œè¿™å°†åœ¨æˆ‘ä»¬çš„ DApp ä¸­æ¯æ¬¡åˆ›å»ºä»»ä½•åƒµå°¸æ—¶è§¦å‘è­¦æŠ¥â€”â€”ä¸ä»…ä»…æ˜¯é’ˆå¯¹å½“å‰ç”¨æˆ·ã€‚å¦‚æœæˆ‘ä»¬åªæƒ³è¦å½“å‰ç”¨æˆ·çš„è­¦æŠ¥ä¼šæ€ä¹ˆæ ·ï¼Ÿ

# ä½¿ç”¨`indexed`

ä¸ºäº†è¿‡æ»¤äº‹ä»¶å¹¶åªç›‘å¬ä¸å½“å‰ç”¨æˆ·ç›¸å…³çš„å˜åŒ–ï¼Œæˆ‘ä»¬çš„ Solidity å¥‘çº¦å¿…é¡»ä½¿ç”¨`indexed`å…³é”®å­—ï¼Œå°±åƒæˆ‘ä»¬åœ¨ ERC721 å®ç°çš„`Transfer`äº‹ä»¶ä¸­æ‰€åšçš„é‚£æ ·:

```
event Transfer(address indexed _from, address indexed _to, uint256 _tokenId);
```

åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå› ä¸º`_from`å’Œ`_to`æ˜¯`indexed`ï¼Œè¿™æ„å‘³ç€æˆ‘ä»¬å¯ä»¥åœ¨å‰ç«¯çš„äº‹ä»¶ç›‘å¬å™¨ä¸­è¿‡æ»¤å®ƒä»¬:

```
*// Use `filter` to only fire this code when `_to` equals `userAccount`*
cryptoZombies.events.Transfer({ **filter: { _to: userAccount** } })
.on("data", function(event) {
  let data = event.returnValues;
  *// The current user just received a zombie!*
  *// Do something here to update the UI to show it*
}).on("error", console.error);
```

æ­£å¦‚ä½ æ‰€çœ‹åˆ°çš„ï¼Œä½¿ç”¨`event` s å’Œ`indexed`å­—æ®µæ˜¯ä¸€ç§éå¸¸æœ‰ç”¨çš„åšæ³•ï¼Œå¯ä»¥ç›‘å¬ä½ çš„åˆåŒçš„å˜åŒ–ï¼Œå¹¶åœ¨ä½ çš„åº”ç”¨ç¨‹åºçš„å‰ç«¯åæ˜ å‡ºæ¥ã€‚

# æŸ¥è¯¢è¿‡å»çš„äº‹ä»¶

æˆ‘ä»¬ç”šè‡³å¯ä»¥ä½¿ç”¨`getPastEvents`æŸ¥è¯¢è¿‡å»çš„äº‹ä»¶ï¼Œå¹¶ä½¿ç”¨è¿‡æ»¤å™¨`fromBlock`å’Œ`toBlock`ç»™ Solidity ä¸€ä¸ªäº‹ä»¶æ—¥å¿—çš„æ—¶é—´èŒƒå›´(æœ¬ä¾‹ä¸­çš„â€œå—â€æŒ‡ä»¥å¤ªåŠå—å·):

```
cryptoZombies.**getPastEvents("NewZombie", { fromBlock: 0, toBlock: "latest" })**
.then(function(events) {
  *// `events` is an array of `event` objects that we can iterate, like we did above*
  *// This code will get us a list of every zombie that was ever created*
});
```

å› ä¸ºæ‚¨å¯ä»¥ä½¿ç”¨è¿™ç§æ–¹æ³•æ¥æŸ¥è¯¢äº‹ä»¶æ—¥å¿—ï¼Œè¿™æä¾›äº†ä¸€ä¸ªæœ‰è¶£çš„ç”¨ä¾‹:**ä½¿ç”¨äº‹ä»¶ä½œä¸ºä¸€ç§æ›´ä¾¿å®œçš„å­˜å‚¨å½¢å¼**ã€‚

å¦‚æœæ‚¨è¿˜è®°å¾—ï¼Œå°†æ•°æ®ä¿å­˜åˆ°åŒºå—é“¾æ˜¯ Solidity ä¸­æœ€æ˜‚è´µçš„æ“ä½œä¹‹ä¸€ã€‚ä½†æ˜¯ä½¿ç”¨äº‹ä»¶åœ¨æ±½æ²¹æ–¹é¢è¦ä¾¿å®œå¾—å¤šã€‚

è¿™é‡Œçš„æƒè¡¡æ˜¯äº‹ä»¶ä¸èƒ½ä»æ™ºèƒ½åå®šæœ¬èº«å†…éƒ¨è¯»å–ã€‚ä½†æ˜¯ï¼Œå¦‚æœæ‚¨æƒ³è¦å°†ä¸€äº›æ•°æ®å†å²è®°å½•åœ¨åŒºå—é“¾ä¸Šï¼Œä»¥ä¾¿å¯ä»¥ä»åº”ç”¨ç¨‹åºçš„å‰ç«¯è¯»å–ï¼Œé‚£ä¹ˆè¿™æ˜¯ä¸€ä¸ªéœ€è¦è®°ä½çš„é‡è¦ç”¨ä¾‹ã€‚

ä¾‹å¦‚ï¼Œæˆ‘ä»¬å¯ä»¥å°†æ­¤ä½œä¸ºåƒµå°¸æˆ˜æ–—çš„å†å²è®°å½•â€”â€”æˆ‘ä»¬å¯ä»¥ä¸ºæ¯æ¬¡ä¸€ä¸ªåƒµå°¸æ”»å‡»å¦ä¸€ä¸ªåƒµå°¸ä»¥åŠè°èµ¢äº†åˆ›å»ºä¸€ä¸ªäº‹ä»¶ã€‚æ™ºèƒ½åˆçº¦ä¸éœ€è¦è¿™äº›æ•°æ®æ¥è®¡ç®—ä»»ä½•æœªæ¥çš„ç»“æœï¼Œä½†å®ƒæ˜¯ç”¨æˆ·èƒ½å¤Ÿä»åº”ç”¨ç¨‹åºçš„å‰ç«¯æµè§ˆçš„æœ‰ç”¨æ•°æ®ã€‚

# Web3.js äº‹ä»¶å’Œå…ƒæ©ç 

æˆ‘ä»¬ä¸Šé¢åˆšåˆšæè¿°çš„è¯­æ³•æ¥è‡ª Web3.js çš„æœ€æ–° 1.0 ç‰ˆæœ¬ï¼Œå®ƒä½¿ç”¨ **WebSockets** æ¥è®¢é˜…äº‹ä»¶ã€‚

ç„¶è€Œï¼ŒMetaMask è¿˜ä¸æ”¯æŒæœ€æ–°çš„äº‹ä»¶ API(å°½ç®¡ä»–ä»¬æ­£åœ¨ç§¯æåœ°å·¥ä½œâ€”â€”æ£€æŸ¥è¿™ä¸ª [github é—®é¢˜](https://github.com/MetaMask/metamask-extension/issues/3642)çš„æ›´æ–°)(MetaMask ç‰ˆæœ¬ 4.5.1)

æ‰€ä»¥ç°åœ¨æˆ‘ä»¬å¿…é¡»ä½¿ç”¨ä¸€ä¸ªå•ç‹¬çš„ Web3 providerï¼Œå®ƒä¸“é—¨ä¸ºäº‹ä»¶æ”¯æŒ WebSocketsã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ Infura å®ä¾‹åŒ–ç¬¬äºŒä¸ªå‰¯æœ¬ï¼Œå¦‚ä¸‹æ‰€ç¤º:

```
var web3Infura = new Web3(new Web3.providers.WebsocketProvider("wss://mainnet.infura.io/ws"));
var czEvents = new web3Infura.eth.Contract(cryptoZombiesABI, cryptoZombiesAddress);
```

ç„¶åæˆ‘ä»¬å°†ä½¿ç”¨`czEvents.events.Transfer`è€Œä¸æ˜¯`cryptoZombies.events.Transfer`æ¥ç›‘å¬äº‹ä»¶ã€‚æˆ‘ä»¬ä»å°†ä½¿ç”¨`cryptoZombies.methods`æ¥è¡¨ç¤ºæˆ‘ä»¬åœ¨æœ¬è¯¾ä¸­æ¶‰åŠçš„æ‰€æœ‰å†…å®¹ã€‚

å°†æ¥ï¼Œå½“ MetaMask æ›´æ–°ä»–ä»¬çš„ API ä»¥æ”¯æŒ Web3.js 1.0 æ—¶ï¼Œè¿™å°†æ˜¯ä¸å¿…è¦çš„â€”â€”ä½†ç°åœ¨ï¼Œå¦‚æœæˆ‘ä»¬æƒ³å¼€å§‹ä½¿ç”¨æ›´å¥½çš„ Web3.js 1.0 è¯­æ³•æ¥è®¢é˜…äº‹ä»¶ï¼Œè¿™æ˜¯ä¸€ä¸ªå¿…è¦çš„æƒå®œä¹‹è®¡ã€‚

> åŠ å…¥ Coinmonks [ç”µæŠ¥é¢‘é“](https://t.me/coincodecap)å’Œ [Youtube é¢‘é“](https://www.youtube.com/c/coinmonks/videos)è·å–æ¯æ—¥[åŠ å¯†æ–°é—»](http://coincodecap.com/)

## å¦å¤–ï¼Œé˜…è¯»

*   [å¤åˆ¶äº¤æ˜“](/coinmonks/top-10-crypto-copy-trading-platforms-for-beginners-d0c37c7d698c) | [åŠ å¯†ç¨åŠ¡è½¯ä»¶](/coinmonks/crypto-tax-software-ed4b4810e338)
*   [ç½‘æ ¼äº¤æ˜“](https://coincodecap.com/grid-trading) | [åŠ å¯†ç¡¬ä»¶é’±åŒ…](/coinmonks/the-best-cryptocurrency-hardware-wallets-of-2020-e28b1c124069)
*   [å¯†ç ç”µæŠ¥ä¿¡å·](http://Top 4 Telegram Channels for Crypto Traders) | [å¯†ç äº¤æ˜“æœºå™¨äºº](/coinmonks/crypto-trading-bot-c2ffce8acb2a)
*   [æœ€ä½³åŠ å¯†äº¤æ˜“æ‰€](/coinmonks/crypto-exchange-dd2f9d6f3769) | [å°åº¦æœ€ä½³åŠ å¯†äº¤æ˜“æ‰€](/coinmonks/bitcoin-exchange-in-india-7f1fe79715c9)
*   å¼€å‘äººå‘˜çš„æœ€ä½³åŠ å¯† API
*   æœ€ä½³[å¯†ç å€Ÿè´·å¹³å°](/coinmonks/top-5-crypto-lending-platforms-in-2020-that-you-need-to-know-a1b675cec3fa)
*   [æ æ†ä»£å¸](/coinmonks/leveraged-token-3f5257808b22)ç»ˆææŒ‡å—