<html>
<head>
<title>Ethereum: Improving message verification in Solidity</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">以太坊:提高消息验证的可靠性</h1>
<blockquote>原文：<a href="https://medium.com/coinmonks/ethereum-improve-message-verification-in-solidity-f657091932d1?source=collection_archive---------1-----------------------#2020-08-16">https://medium.com/coinmonks/ethereum-improve-message-verification-in-solidity-f657091932d1?source=collection_archive---------1-----------------------#2020-08-16</a></blockquote><div><div class="ef hh hi hj hk hl"/><div class="hm hn ho hp hq"><div class=""/><p id="9ebf" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated"><strong class="is hu">我看了这篇文章，</strong> <a class="ae jo" href="https://blog.ricmoo.com/verifying-messages-in-solidity-50a94f82b2ca" rel="noopener ugc nofollow" target="_blank"> <strong class="is hu">签名:在Solidity中验证消息</strong> </a> <strong class="is hu">。这是一篇很好的文章，但是这段代码让我不舒服。这太浪费和肮脏，然后我实现我的，所以你可以做比较。</strong></p><h1 id="3f6b" class="jp jq ht bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km dt translated">以太坊中的消息签名</h1><p id="d18e" class="pw-post-body-paragraph iq ir ht is b it kn iv iw ix ko iz ja jb kp jd je jf kq jh ji jj kr jl jm jn hm dt translated">以太坊上几乎所有的信息都是用给定的格式签名的:</p><pre class="ks kt ku kv fq kw kx ky kz aw la dt"><span id="17c3" class="lb jq ht kx b fv lc ld l le lf">"\x19Ethereum Signed Message:\n" + message.length + message</span><span id="c19a" class="lb jq ht kx b fv lg ld l le lf">E.g: “\x19Ethereum Signed Message:\n16Hello, I’m Chiro”</span></pre><p id="011d" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">这个前缀<code class="eh lh li lj kx b">"\x19Ethereum Signed Message:\n"</code>用于确保签名的消息不会在其他地方被<strong class="is hu">【重用】</strong>。</p><h1 id="db87" class="jp jq ht bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km dt translated">改进</h1><p id="0922" class="pw-post-body-paragraph iq ir ht is b it kn iv iw ix ko iz ja jb kp jd je jf kq jh ji jj kr jl jm jn hm dt translated">如您所见，唯一阻止我们归档onchain验证的是<code class="eh lh li lj kx b">message.length</code>。你需要将一个数字编码成字符串，这里有<a class="lk ll gr" href="https://medium.com/u/889387e95e0b?source=post_page-----f657091932d1--------------------------------" rel="noopener" target="_blank"> RicMoo </a>的代码:</p><figure class="ks kt ku kv fq lm"><div class="bz el l di"><div class="ln lo l"/></div></figure><p id="fe34" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">基本概念可以简化为:</p><pre class="ks kt ku kv fq kw kx ky kz aw la dt"><span id="3751" class="lb jq ht kx b fv lc ld l le lf">function uintToStr(value) {<br/>  let result = [];<br/>  for (let i = value; i &gt; 0; i = (i / 10) &gt;&gt;&gt; 0) {<br/>    result.push(String.fromCharCode((i % 10) + 0x30));<br/>  }<br/>  return result.reverse().join('');<br/>}</span></pre><p id="82de" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">基数是<code class="eh lh li lj kx b">10</code>，所以我们需要对<code class="eh lh li lj kx b">10</code>取模来得到数字，并将结果与<code class="eh lh li lj kx b">0x30</code>相加来得到它的ASCII码。</p><pre class="ks kt ku kv fq kw kx ky kz aw la dt"><span id="15f2" class="lb jq ht kx b fv lc ld l le lf">E.g:<br/>123 % 10 = 3<br/>3 + 0x30 = 0x33 (ASCII of “3”)</span></pre><p id="3374" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">以下是我不带占位符的实现:</p><figure class="ks kt ku kv fq lm"><div class="bz el l di"><div class="ln lo l"/></div></figure><p id="8c95" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated"><code class="eh lh li lj kx b">truffle test</code>的结果:</p><figure class="ks kt ku kv fq lm fe ff paragraph-image"><div role="button" tabindex="0" class="lq lr di ls bf lt"><div class="fe ff lp"><img src="../Images/bf426ccbd3fe401ee42ce52db3b8f363.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tT_uuMeWOZsxV4-4mB-IEQ.png"/></div></div><figcaption class="lw lx fg fe ff ly lz bd b be z ek">Test result</figcaption></figure><p id="a565" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">结果和完整代码可以在这里找到:</p><div class="ma mb fm fo mc md"><a href="https://github.com/chiro-hiro/examples/blob/master/solidity/verify-signature/" rel="noopener  ugc nofollow" target="_blank"><div class="me ab ej"><div class="mf ab mg cl cj mh"><h2 class="bd hu fv z el mi eo ep mj er et hs dt translated">chiro-Hiro/示例</h2><div class="mk l"><h3 class="bd b fv z el mi eo ep mj er et ek translated">我读了这篇文章，签名:验证消息的可靠性。这是一篇很好的文章，但是这段代码让我…</h3></div><div class="ml l"><p class="bd b gc z el mi eo ep mj er et ek translated">github.com</p></div></div><div class="mm l"><div class="mn l mo mp mq mm mr lu md"/></div></div></a></div><h1 id="564e" class="jp jq ht bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km dt translated">结论</h1><ul class=""><li id="b4ea" class="ms mt ht is b it kn ix ko jb mu jf mv jj mw jn mx my mz na dt translated">我的实施成本<code class="eh lh li lj kx b">5846 Gas</code>、<a class="lk ll gr" href="https://medium.com/u/889387e95e0b?source=post_page-----f657091932d1--------------------------------" rel="noopener" target="_blank"> RicMoo </a>的实施成本<code class="eh lh li lj kx b">6440 Gas</code></li><li id="8293" class="ms mt ht is b it nb ix nc jb nd jf ne jj nf jn mx my mz na dt translated">验证序列化签名成本的新功能<code class="eh lh li lj kx b">6160 Gas</code></li><li id="0f46" class="ms mt ht is b it nb ix nc jb nd jf ne jj nf jn mx my mz na dt translated">理论上，它可以验证长度等于10 -1的消息</li></ul><h2 id="b751" class="lb jq ht bd jr ng nh ni jv nj nk nl jz jb nm nn kd jf no np kh jj nq nr kl ns dt translated">另外，阅读</h2><ul class=""><li id="02dc" class="ms mt ht is b it kn ix ko jb mu jf mv jj mw jn mx my mz na dt translated">最好的<a class="ae jo" rel="noopener" href="/coinmonks/crypto-trading-bot-c2ffce8acb2a">密码交易机器人</a></li><li id="b851" class="ms mt ht is b it nb ix nc jb nd jf ne jj nf jn mx my mz na dt translated"><a class="ae jo" rel="noopener" href="/coinmonks/top-10-crypto-copy-trading-platforms-for-beginners-d0c37c7d698c">密码本交易平台</a></li><li id="ae2d" class="ms mt ht is b it nb ix nc jb nd jf ne jj nf jn mx my mz na dt translated">最好的<a class="ae jo" rel="noopener" href="/coinmonks/best-crypto-tax-tool-for-my-money-72d4b430816b">加密税务软件</a></li><li id="92e4" class="ms mt ht is b it nb ix nc jb nd jf ne jj nf jn mx my mz na dt translated"><a class="ae jo" rel="noopener" href="/coinmonks/the-best-crypto-trading-platforms-in-2020-the-definitive-guide-updated-c72f8b874555">最佳加密交易平台</a></li><li id="d8fc" class="ms mt ht is b it nb ix nc jb nd jf ne jj nf jn mx my mz na dt translated">最佳<a class="ae jo" rel="noopener" href="/coinmonks/top-5-crypto-lending-platforms-in-2020-that-you-need-to-know-a1b675cec3fa">加密贷款平台</a></li><li id="4f10" class="ms mt ht is b it nb ix nc jb nd jf ne jj nf jn mx my mz na dt translated"><a class="ae jo" href="https://bitquery.io/blog/best-blockchain-analysis-tools-and-software" rel="noopener ugc nofollow" target="_blank">最佳区块链分析工具</a></li><li id="d432" class="ms mt ht is b it nb ix nc jb nd jf ne jj nf jn mx my mz na dt translated"><a class="ae jo" rel="noopener" href="/coinmonks/crypto-arbitrage-guide-how-to-make-money-as-a-beginner-62bfe5c868f6">加密套利</a>指南:新手如何赚钱</li><li id="aa54" class="ms mt ht is b it nb ix nc jb nd jf ne jj nf jn mx my mz na dt translated">最佳<a class="ae jo" rel="noopener" href="/coinmonks/what-are-the-best-charting-platforms-for-cryptocurrency-trading-85aade584d80">加密制图工具</a></li><li id="15e1" class="ms mt ht is b it nb ix nc jb nd jf ne jj nf jn mx my mz na dt translated"><a class="ae jo" rel="noopener" href="/coinmonks/ledger-vs-trezor-best-hardware-wallet-to-secure-cryptocurrency-22c7a3fd391e">莱杰vs特雷佐</a></li><li id="56fd" class="ms mt ht is b it nb ix nc jb nd jf ne jj nf jn mx my mz na dt translated">了解比特币的<a class="ae jo" rel="noopener" href="/coinmonks/what-are-the-best-books-to-learn-bitcoin-409aeb9aff4b">最佳书籍有哪些？</a></li><li id="170f" class="ms mt ht is b it nb ix nc jb nd jf ne jj nf jn mx my mz na dt translated"><a class="ae jo" rel="noopener" href="/coinmonks/3commas-review-an-excellent-crypto-trading-bot-2020-1313a58bec92">3商业评论</a></li><li id="d145" class="ms mt ht is b it nb ix nc jb nd jf ne jj nf jn mx my mz na dt translated"><a class="ae jo" rel="noopener" href="/coinmonks/aax-exchange-review-2021-67c5ea09330c"> AAX交易所评论</a> |推荐代码、交易费用、利弊</li><li id="54f9" class="ms mt ht is b it nb ix nc jb nd jf ne jj nf jn mx my mz na dt translated"><a class="ae jo" rel="noopener" href="/coinmonks/deribit-review-options-fees-apis-and-testnet-2ca16c4bbdb2"> Deribit审查</a> |选项、费用、API和Testnet</li><li id="e34b" class="ms mt ht is b it nb ix nc jb nd jf ne jj nf jn mx my mz na dt translated"><a class="ae jo" rel="noopener" href="/coinmonks/ftx-crypto-exchange-review-53664ac1198f"> FTX密码交易所评论</a></li><li id="d0c3" class="ms mt ht is b it nb ix nc jb nd jf ne jj nf jn mx my mz na dt translated"><a class="ae jo" rel="noopener" href="/coinmonks/ngrave-zero-review-c465cf8307fc">n零审核</a></li><li id="1310" class="ms mt ht is b it nb ix nc jb nd jf ne jj nf jn mx my mz na dt translated"><a class="ae jo" rel="noopener" href="/coinmonks/bybit-exchange-review-dbd570019b71">比特交换评论</a></li><li id="8b1e" class="ms mt ht is b it nb ix nc jb nd jf ne jj nf jn mx my mz na dt translated"><a class="ae jo" rel="noopener" href="/coinmonks/cryptohopper-vs-3commas-vs-shrimpy-a2c16095b8fe"> 3Commas vs Cryptohopper </a></li><li id="b18b" class="ms mt ht is b it nb ix nc jb nd jf ne jj nf jn mx my mz na dt translated">最好的比特币<a class="ae jo" rel="noopener" href="/coinmonks/the-best-cryptocurrency-hardware-wallets-of-2020-e28b1c124069?source=friends_link&amp;sk=324dd9ff8556ab578d71e7ad7658ad7c">硬件钱包</a></li><li id="e7b1" class="ms mt ht is b it nb ix nc jb nd jf ne jj nf jn mx my mz na dt translated">最佳<a class="ae jo" href="https://blog.coincodecap.com/best-monero-wallets" rel="noopener ugc nofollow" target="_blank"> monero钱包</a></li><li id="747f" class="ms mt ht is b it nb ix nc jb nd jf ne jj nf jn mx my mz na dt translated"><a class="ae jo" href="https://blog.coincodecap.com/ledger-nano-s-vs-x" rel="noopener ugc nofollow" target="_blank">莱杰纳米s vs x </a></li><li id="ace6" class="ms mt ht is b it nb ix nc jb nd jf ne jj nf jn mx my mz na dt translated"><a class="ae jo" href="https://blog.coincodecap.com/bitsgap-3commas-quadency" rel="noopener ugc nofollow" target="_blank">bits gap vs 3 commas vs quad ency</a></li><li id="a274" class="ms mt ht is b it nb ix nc jb nd jf ne jj nf jn mx my mz na dt translated"><a class="ae jo" href="https://blog.coincodecap.com/ledger-nano-s-vs-trezor-one-ledger-nano-x-trezor-t" rel="noopener ugc nofollow" target="_blank">莱杰纳米S vs特雷佐one vs特雷佐T vs莱杰纳米X </a></li><li id="44f0" class="ms mt ht is b it nb ix nc jb nd jf ne jj nf jn mx my mz na dt translated"><a class="ae jo" rel="noopener" href="/coinmonks/blockfi-vs-celsius-vs-hodlnaut-8a1cc8c26630">block fi vs Celsius</a>vs Hodlnaut</li><li id="52d0" class="ms mt ht is b it nb ix nc jb nd jf ne jj nf jn mx my mz na dt translated">Bitsgap评论——一个轻松赚钱的加密交易机器人</li><li id="92c0" class="ms mt ht is b it nb ix nc jb nd jf ne jj nf jn mx my mz na dt translated"><a class="ae jo" rel="noopener" href="/coinmonks/quadency-review-a-crypto-trading-automation-platform-3068eaa374e1">第四次审查</a>——一个为专业人士设计的秘密交易机器人</li><li id="22eb" class="ms mt ht is b it nb ix nc jb nd jf ne jj nf jn mx my mz na dt translated"><a class="ae jo" rel="noopener" href="/coinmonks/primexbt-review-88e0815be858"> PrimeXBT Review </a> |杠杆交易、费用和契约</li><li id="62d2" class="ms mt ht is b it nb ix nc jb nd jf ne jj nf jn mx my mz na dt translated"><a class="ae jo" rel="noopener" href="/coinmonks/ellipal-titan-review-85e9071dd029">埃利帕尔泰坦评论</a></li><li id="1a26" class="ms mt ht is b it nb ix nc jb nd jf ne jj nf jn mx my mz na dt translated"><a class="ae jo" href="https://blog.coincodecap.com/secux-stone-hardware-wallet-review" rel="noopener ugc nofollow" target="_blank"> SecuX石材审核</a></li><li id="31ff" class="ms mt ht is b it nb ix nc jb nd jf ne jj nf jn mx my mz na dt translated"><a class="ae jo" rel="noopener" href="/coinmonks/blockfi-review-53096053c097"> BlockFi Review </a> |获取高达8.6%的加密利息</li></ul></div></div>    
</body>
</html>