<html>
<head>
<title>I wrote a serverless app to automate my cryptocurrency purchases on GCP</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">我写了一个无服务器的应用程序来自动在GCP购买加密货币</h1>
<blockquote>原文：<a href="https://medium.com/coinmonks/i-wrote-a-serverless-app-to-automate-my-cryptocurrency-purchases-17c9a869d0c7?source=collection_archive---------4-----------------------#2021-05-11">https://medium.com/coinmonks/i-wrote-a-serverless-app-to-automate-my-cryptocurrency-purchases-17c9a869d0c7?source=collection_archive---------4-----------------------#2021-05-11</a></blockquote><div><div class="ef hh hi hj hk hl"/><div class="hm hn ho hp hq"><div class=""/><p id="ec84" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt jo translated">我不得不承认，在加密货币方面，我算是一个大器晚成者。</p><p id="8228" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">在2017年用<em class="jx"> shitcoins </em>烧伤自己之后，我回去积累我在投资理论、区块链技术和比特币方面的知识，然后从2020年末开始作为maxi每周都会DCA到BTC(我知道。不应该错过三月的跳水。)</p><p id="f5c4" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">尽管已经有了一个系统，有时候你<em class="jx">就是无法停止关注价格走势，最终想要把握市场时机。我在日本使用的交易所BitFlyer的重复购买功能也产生了大量开销。这一点以及我一直想尝试l̵o̵s̵i̵n̵g̵用自动算法交易押注我的钱的事实，激励我编写自己的机器人并开源它，以防社区中有人发现它有用。</em></p><p id="e7bd" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated"><a class="ae jy" href="https://github.com/kalanyuz/gcp-cryptobot" rel="noopener ugc nofollow" target="_blank">https://github.com/kalanyuz/gcp-cryptobot</a></p><p id="49d8" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">我选择了<a class="ae jy" href="https://nestjs.com/" rel="noopener ugc nofollow" target="_blank"> nestjs </a>作为这个机器人的框架，因为它非常通用并且非常可扩展。该机器人被设计为部署在<a class="ae jy" href="https://cloud.google.com/run" rel="noopener ugc nofollow" target="_blank">云运行</a>上，并利用他们的一些产品来增加安全性和减少维护。然而，它也被设计成容器化的，所以你可以很容易地修改它以在任何地方运行。</p><h1 id="be47" class="jz ka ht bd kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw dt translated">我们来谈谈吧</h1><figure class="ky kz la lb fq lc fe ff paragraph-image"><div role="button" tabindex="0" class="ld le di lf bf lg"><div class="fe ff kx"><img src="../Images/de26ae3e901bb341d87fd1a627bd643b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ok3hAnu9oiL5d4Wm7ntwMw.png"/></div></div><figcaption class="lj lk fg fe ff ll lm bd b be z ek">System diagram showing how the bot works (as of May 2021.)</figcaption></figure><p id="2e7f" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">对于规格，我希望机器人是1。固定<br/> 2。弹性<br/> 3。可伸缩<br/> 4。可配置的</p><p id="c42b" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated"><strong class="is hu">安全</strong></p><p id="0f50" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">当涉及到安全性时，容器化的应用程序为您提供了优势，在CloudRun上部署它可以让您访问GCP应用程序喜欢的工具，而不必自己进行配置。</p><p id="949b" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">该机器人已经建立了警卫和拦截器，将允许特定的传入请求(例如。仅接受来自TradingView的警报)或删除包含配置文件中不允许的资产交易请求的请求。如果你只想堆叠sat，用服务账户IAM锁定你的应用，只允许来自<a class="ae jy" href="https://cloud.google.com/scheduler" rel="noopener ugc nofollow" target="_blank">云调度器</a>的请求。</p><p id="6cb1" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">它还利用GCP的<a class="ae jy" href="https://cloud.google.com/secret-manager" rel="noopener ugc nofollow" target="_blank">秘密管理器</a>来管理API密钥的存储，这样你就不必在你的源代码或终端命令历史中保留它。尽管如此，重要的是<strong class="is hu">永远不要给你的API键超过必要的访问权限</strong>。例如，这个机器人只支持自动购买和出售，所以你不应该授予API键提取资金的权利。</p><p id="08b0" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated"><strong class="is hu">富有弹性</strong></p><p id="c46e" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">部署容器化的无服务器应用程序可以最大限度地减少服务中断并保证正常运行时间(例如当你的房子停电时，你不会想在撞车前错过你的出口)。云运行也可以扩展到零，因此您的成本也保持在最低水平。</p><p id="80a6" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated"><strong class="is hu">可扩展</strong></p><p id="db7b" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">NestJs非常具有可扩展性。该机器人是非常模块化的，因此您可以通过添加更多的交换或服务和拦截器来扩展其安全功能，从而轻松地添加contribute。</p><p id="6138" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated"><strong class="is hu">可配置</strong></p><p id="92cb" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">bot为您提供了一个<code class="eh ln lo lp lq b">config.yaml</code>文件，允许您配置bot的行为。在这里你可以设置你的自动买入再平衡配置文件，或者告诉机器人它可以交易哪些交易对。</p></div><div class="ab cl lr ls hb lt" role="separator"><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw"/></div><div class="hm hn ho hp hq"><h1 id="8737" class="jz ka ht bd kb kc ly ke kf kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw dt translated"><strong class="ak">示例用例</strong></h1><p id="cba5" class="pw-post-body-paragraph iq ir ht is b it md iv iw ix me iz ja jb mf jd je jf mg jh ji jj mh jl jm jn hm dt translated"><strong class="is hu">自动交易</strong> <br/>目前，该机器人支持TradingView中的警报，因此，如果您有订阅，您可以设置webhooks来发送警报上的购买/出售请求，机器人将处理其余部分。你可以从<code class="eh ln lo lp lq b">exchange.ts</code>文件中的<code class="eh ln lo lp lq b">BotRequest</code>类看到bot接受什么请求格式。</p><p id="04a4" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">下面是我如何使用<a class="mi mj gr" href="https://medium.com/u/46f509fcc598?source=post_page-----17c9a869d0c7--------------------------------" rel="noopener" target="_blank"> Piriya Sambandaraksa </a>的CDC-Actionzone为我的机器人设置警报的例子:一个基于EMA的、非常简单、非常容易理解但相对安全的指示器。你可以在这里阅读指示器<a class="ae jy" href="https://medium.com/r?url=https%3A%2F%2Fwww.tradingview.com%2Fscript%2FrGpAOoLi-CDC-ActionZone-V3-2020%2F" rel="noopener"/>。如果你是泰国人，有兴趣了解更多关于比特币的知识，我强烈推荐他的<a class="ae jy" href="https://www.youtube.com/channel/UCxx6Lgcyxs01U1U1p4so8Ng" rel="noopener ugc nofollow" target="_blank"> youtube频道</a>。</p><figure class="ky kz la lb fq lc fe ff paragraph-image"><div class="fe ff mk"><img src="../Images/515ae0752172dd0c23f7fe9ef2d8392e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1164/format:webp/1*ra4m5FacxyexWb-Kb3dXYQ.png"/></div><figcaption class="lj lk fg fe ff ll lm bd b be z ek">Don’t reveal your services’ URL to anyone else to reduce potential attack.</figcaption></figure><figure class="ky kz la lb fq lc fe ff paragraph-image"><div class="fe ff ml"><img src="../Images/6ee06016af0e9cfeaea8fce218d15e04.png" data-original-src="https://miro.medium.com/v2/resize:fit:918/format:webp/1*ay5AZi2UpOjMgU3TmQDorg.png"/></div><figcaption class="lj lk fg fe ff ll lm bd b be z ek">The bot logs the incoming requests so you can always check if it’s working as intended.</figcaption></figure><p id="d8dd" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated"><strong class="is hu">自动堆栈<br/> </strong>这个很简单，你必须首先禁用从特定地址发出请求的全局守卫。之后，您可以设置一个调度程序cron，以您想要的频率自动购买。例如，我使用<code class="eh ln lo lp lq b">0 6 * * 1</code>在周一早上6:00自动完成我的每周采购。</p></div><div class="ab cl lr ls hb lt" role="separator"><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw"/></div><div class="hm hn ho hp hq"><h1 id="04ef" class="jz ka ht bd kb kc ly ke kf kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw dt translated">合作者欢迎！</h1><p id="ef39" class="pw-post-body-paragraph iq ir ht is b it md iv iw ix me iz ja jb mf jd je jf mg jh ji jj mh jl jm jn hm dt translated">我本人计划在未来几周内增加对币安的支持，因为这是我目前正在使用的两个交换平台。</p><p id="4942" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hm dt translated">如果你喜欢这个机器人的想法，并希望增加你所在地区的交易所，或使其更容易在本地运行，请提交一份公关！</p></div></div>    
</body>
</html>