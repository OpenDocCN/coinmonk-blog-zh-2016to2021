<html>
<head>
<title>How To Get Real Time Crypto Market Data</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何获得实时加密市场数据</h1>
<blockquote>原文：<a href="https://medium.com/coinmonks/how-to-get-real-time-crypto-market-data-522a102f7f4a?source=collection_archive---------2-----------------------#2018-07-12">https://medium.com/coinmonks/how-to-get-real-time-crypto-market-data-522a102f7f4a?source=collection_archive---------2-----------------------#2018-07-12</a></blockquote><div><div class="ef hh hi hj hk hl"/><div class="hm hn ho hp hq"><div class=""/><div class=""><h2 id="133d" class="pw-subtitle-paragraph iq hs ht bd b ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ek translated">使用<a class="ae ji" href="https://www.kucoin.com" rel="noopener ugc nofollow" target="_blank">库币</a>交换API # how to guidl(7/n)</h2></div><blockquote class="jj jk jl"><p id="076b" class="jm jn jo jp b jq jr iu js jt ju ix jv jw jx jy jz ka kb kc kd ke kf kg kh ki hm dt translated">在上一篇文章中，我们关注于获取任何交易所上市的任何加密货币或ERC20令牌的大致价格数据。一些从事crypto的人不一定需要最新的数据，所以关于使用CoinMarketCap API 的<a class="ae ji" rel="noopener" href="/coinmonks/how-to-get-global-crypto-market-data-and-approximate-price-info-4dea89a795e1">的文章可能就足够了。它提供了“足够好”的数据，让人们对整个市场有了一些了解。对于那些试图实际建立业务，用代币交换商品和服务，经营商店，为密码出售物品，或活跃的交易者，CMC只是不够好。</a></p><p id="bc52" class="jm jn jo jp b jq jr iu js jt ju ix jv jw jx jy jz ka kb kc kd ke kf kg kh ki hm dt translated">你在crypto呆的时间越长，在某些时候你会需要更准确的数据。要获得这些信息，你需要一个市场数据服务提供商，或者更直接地说，一个交易所本身。</p></blockquote><p id="3761" class="pw-post-body-paragraph jm jn ht jp b jq jr iu js jt ju ix jv kj jx jy jz kk kb kc kd kl kf kg kh ki hm dt translated">对于这组代码示例，我们将看看#构建一个命令行工具或定制的web应用程序，用于从<a class="ae ji" href="https://www.kucoin.com" rel="noopener ugc nofollow" target="_blank"> K </a> ucoin API请求当前的贸易数据。你甚至可以大胆地创建一个定制的<a class="km kn gr" href="https://medium.com/u/b501917dd00d?source=post_page-----522a102f7f4a--------------------------------" rel="noopener" target="_blank"> AirSwap团队</a> maker，这样你就可以与#去中心化市场工具集成，让你安全地参与原子互换。"<a class="ae ji" href="https://blog.airswap.io/the-app-store-of-ethereum-is-powered-by-tokens-25a3af0f71da" rel="noopener ugc nofollow" target="_blank"> AirSwap不仅仅是一个市场，而是一个安全的消费者令牌交易网络，只能通过真正去中心化的点对点协议才能存在。当您在AirSwap上进行买卖时，您是在与世界各地的其他人进行交易，在买方、卖方和智能合约之间进行钱包对钱包的交易。没有摩擦，没有监护，没有费用。</a>”</p><blockquote class="ko"><p id="4b96" class="kp kq ht bd kr ks kt ku kv kw kx ki ek translated"><a class="ae ji" href="https://coincodecap.com/category/crypto-api" rel="noopener ugc nofollow" target="_blank">发现并审查最佳加密api提供商</a></p></blockquote><p id="8c09" class="pw-post-body-paragraph jm jn ht jp b jq ky iu js jt kz ix jv kj la jy jz kk lb kc kd kl lc kg kh ki hm dt translated">做市商通过建议一种数量的代币对另一种数量的代币的汇率来提供流动性，接受者接受出价或报价，从而创建了一种原子代币互换，如果没有当前针对BTC进行两种不同交易的集中选项，这种互换实际上是不可能的。现在，如果你想为AirSwap创建自己的制造商，你最好有一些关于当前市场价格的信息，所以我们将研究你如何通过Kucoin获得这些信息。</p><blockquote class="jj jk jl"><p id="a855" class="jm jn jo jp b jq jr iu js jt ju ix jv jw jx jy jz ka kb kc kd ke kf kg kh ki hm dt translated">AirSwap是在考虑到做市商的情况下从头开始构建的。我们已经为<a class="ae ji" href="https://github.com/airswap/developers" rel="noopener ugc nofollow" target="_blank"> JavaScript和Python </a>发布了交换协议客户端，快速入门指南即将发布。— <a class="km kn gr" href="https://medium.com/u/19fca2ef04ea?source=post_page-----522a102f7f4a--------------------------------" rel="noopener" target="_blank">唐·莫斯提斯</a></p></blockquote><p id="a79e" class="pw-post-body-paragraph jm jn ht jp b jq jr iu js jt ju ix jv kj jx jy jz kk kb kc kd kl kf kg kh ki hm dt translated"><a class="ae ji" href="https://www.kucoin.com" rel="noopener ugc nofollow" target="_blank"> Kucoin </a> <a class="ae ji" href="https://intro.kucoin.com/" rel="noopener ugc nofollow" target="_blank">是一家总部位于香港的中国数字货币交易所</a>。我在这个例子中选择它，是因为在这里列出一枚硬币通常比像币安这样的东西更容易或更实惠，因此，它包含了我将在我的例子中使用的一些硬币。此外，这似乎是一个更可靠的交流，据我所知，没有遭受任何安全漏洞。作为一个额外的奖励，Kucoin与KCS代币持有者分享费用利润，因此用户有动力持有代币作为被动股息收入。这在集中式加密交换中有点罕见。让我们开始吧。</p><p id="97a0" class="pw-post-body-paragraph jm jn ht jp b jq jr iu js jt ju ix jv kj jx jy jz kk kb kc kd kl kf kg kh ki hm dt translated">让我们为Kucoin安装开源的javascript RESTful API包装器。<br/>我使用的是<a class="ae ji" href="https://github.com/Satoshinaire/kucoin-api" rel="noopener ugc nofollow" target="_blank">satoshinaire/ku coin-API</a>的<a class="ae ji" href="https://github.com/emmonspired/kucoin-api" rel="noopener ugc nofollow" target="_blank">分叉</a>版本。<br/>完整的API文档可以在这里<a class="ae ji" href="https://kucoinapidocs.docs.apiary.io/#" rel="noopener ugc nofollow" target="_blank">阅读。<br/>特别感谢</a><a class="km kn gr" href="https://medium.com/u/9b53b1fd5a7e?source=post_page-----522a102f7f4a--------------------------------" rel="noopener" target="_blank"> Satoshinaire </a>的API包装器！</p><pre class="ld le lf lg fq lh li lj lk aw ll dt"><span id="82d4" class="lm ln ht li b fv lo lp l lq lr">npm install kucoin-api</span></pre><p id="fc04" class="pw-post-body-paragraph jm jn ht jp b jq jr iu js jt ju ix jv kj jx jy jz kk kb kc kd kl kf kg kh ki hm dt translated">现在它已经在我们的项目中可用了，获取对库的引用，并实例化API对象的一个实例。</p><pre class="ld le lf lg fq lh li lj lk aw ll dt"><span id="75a0" class="lm ln ht li b fv lo lp l lq lr">Kucoin = require("kucoin-api");<br/>kucoin = new Kucoin(); // read only, not passing in API (key,secret)</span></pre><h2 id="06a5" class="lm ln ht bd ls lt lu lv lw lx ly lz ma kj mb mc md kk me mf mg kl mh mi mj mk dt translated">探索API</h2><p id="e8cc" class="pw-post-body-paragraph jm jn ht jp b jq ml iu js jt mm ix jv kj mn jy jz kk mo kc kd kl mp kg kh ki hm dt translated">让我们用async <code class="eh mq mr ms li b">getCoins</code>函数获得所有可用硬币的列表。</p><pre class="ld le lf lg fq lh li lj lk aw ll dt"><span id="28df" class="lm ln ht li b fv lo lp l lq lr">kucoin.getCoins();<br/>coins = _;</span></pre><p id="256b" class="pw-post-body-paragraph jm jn ht jp b jq jr iu js jt ju ix jv kj jx jy jz kk kb kc kd kl kf kg kh ki hm dt translated">现在我们来检查一下。我们会在列表中看到和网站上一样的177枚硬币。</p><p id="9514" class="pw-post-body-paragraph jm jn ht jp b jq jr iu js jt ju ix jv kj jx jy jz kk kb kc kd kl kf kg kh ki hm dt translated"><code class="eh mq mr ms li b">coins.data.length; //177</code></p><p id="07de" class="pw-post-body-paragraph jm jn ht jp b jq jr iu js jt ju ix jv kj jx jy jz kk kb kc kd kl kf kg kh ki hm dt translated"><code class="eh mq mr ms li b">locicoin = coins.data.filter(c=&gt; c.coin==’LOCI’)[0];</code></p><pre class="ld le lf lg fq lh li lj lk aw ll dt"><span id="2c21" class="lm ln ht li b fv lo lp l lq lr">{ withdrawMinFee: 4, coinType: 'ERC20', withdrawMinAmount: 10, withdrawRemark: <strong class="li hu">null</strong>, orgAddress: <strong class="li hu">null</strong>, txUrl: 'https://etherscan.io/tx/{txId}', userAddressName: <strong class="li hu">null</strong>, withdrawFeeRate: 0.001, confirmationCount: 12, infoUrl: <strong class="li hu">null</strong>, enable: true, name: 'LOCIcoin', tradePrecision: 4, depositRemark: <strong class="li hu">null</strong>, enableWithdraw: true, enableDeposit: true, coin: 'LOCI' }</span></pre><p id="b865" class="pw-post-body-paragraph jm jn ht jp b jq jr iu js jt ju ix jv kj jx jy jz kk kb kc kd kl kf kg kh ki hm dt translated">位点的JSON表示告诉我们一些有趣的事情。我们可以确定它是一个ERC20 <code class="eh mq mr ms li b">coinType</code>，您必须至少有10个才能提取，有一个4硬币<code class="eh mq mr ms li b">withrawMinFee</code>用于任何转出交易所，任何转入交易所必须等待12 <code class="eh mq mr ms li b">confirmationCount</code>才能计算任何余额。</p><pre class="ld le lf lg fq lh li lj lk aw ll dt"><span id="ab5d" class="lm ln ht li b fv lo lp l lq lr">kucoin.getLanguages();</span><span id="5df4" class="lm ln ht li b fv mt lp l lq lr">{ success: true, code: 'OK', msg: 'Operation succeeded.', timestamp: 1531253711223, data: [ [ 'en_US', 'English', true ], [ 'ru_RU', 'русский', true ], [ 'ko_KR', '한국어', true ], [ 'pt_PT', 'Portugues', true ], [ 'zh_CN', '中文简体', true ], [ 'nl_NL', 'Nederlands', true ], [ 'zh_HK', '中文繁体', true ], [ 'de_DE', 'Deutsch', true ], [ 'fr_FR', 'Français', true ], [ 'es_ES', 'Español', true ], [ 'vi_VN', 'Tiếng Việt', true ], [ 'tr_TR', 'Türkçe', true ] ] }</span><span id="f7d1" class="lm ln ht li b fv mt lp l lq lr">languages = _;</span></pre><p id="360b" class="pw-post-body-paragraph jm jn ht jp b jq jr iu js jt ju ix jv kj jx jy jz kk kb kc kd kl kf kg kh ki hm dt translated">嗯。好的。Kucoin在现场提供支持。非常适合国际化。一定有办法通过API改变用户的首选语言。我年轻的时候学过一些西班牙语，但是现在我不会去管它。美式英语<code class="eh mq mr ms li b">en_US</code>就可以了。</p><p id="8060" class="pw-post-body-paragraph jm jn ht jp b jq jr iu js jt ju ix jv kj jx jy jz kk kb kc kd kl kf kg kh ki hm dt translated">虽然这一切都很有趣，但这不是我们来这里的目的。有时简单地探索一个API并在代码中摆弄它是必要的，只是为了获得你的方向并确定你能做什么和不能做什么。初级开发人员通常不理解“软件开发”不仅仅是整天敲打精确的代码。它包括探索、计划、导航代码，当然还有写作，但更多的是阅读你没有写的代码，而且通常那些写了的代码已经不在公司了。这是你通过检查其他项目和学习如何浏览新代码库而积累的经验的一部分。</p><h2 id="a23c" class="lm ln ht bd ls lt lu lv lw lx ly lz ma kj mb mc md kk me mf mg kl mh mi mj mk dt translated">Papa比特币的汇率</h2><p id="8171" class="pw-post-body-paragraph jm jn ht jp b jq ml iu js jt mm ix jv kj mn jy jz kk mo kc kd kl mp kg kh ki hm dt translated">有个函数叫<code class="eh mq mr ms li b">getExchangeRates</code>。听起来像是我们真正感兴趣的事情。</p><pre class="ld le lf lg fq lh li lj lk aw ll dt"><span id="598e" class="lm ln ht li b fv lo lp l lq lr">kucoin.getExchangeRates();<br/>xrates = _;</span></pre><p id="b0bf" class="pw-post-body-paragraph jm jn ht jp b jq jr iu js jt ju ix jv kj jx jy jz kk kb kc kd kl kf kg kh ki hm dt translated">现在<code class="eh mq mr ms li b">xrates.data.currencies</code>包含了一个【名称，符号】对的数组列表。</p><pre class="ld le lf lg fq lh li lj lk aw ll dt"><span id="e1fc" class="lm ln ht li b fv lo lp l lq lr">[[ 'USD', '$' ], [ 'EUR', '€' ], [ 'AUD', '$' ], ... ]</span></pre><p id="9d63" class="pw-post-body-paragraph jm jn ht jp b jq jr iu js jt ju ix jv kj jx jy jz kk kb kc kd kl kf kg kh ki hm dt translated">而<code class="eh mq mr ms li b">xrates.data.rates</code>包含一个用于<code class="eh mq mr ms li b">BTC</code>的属性，该属性是这些货币到该货币中的值的映射:</p><pre class="ld le lf lg fq lh li lj lk aw ll dt"><span id="90f4" class="lm ln ht li b fv lo lp l lq lr">BTC : { /*...*/ EUR: 5442.33, DKK: 40570.1, <strong class="li hu">USD: 6380.3</strong>, /*...*/ }</span></pre><p id="133c" class="pw-post-body-paragraph jm jn ht jp b jq jr iu js jt ju ix jv kj jx jy jz kk kb kc kd kl kf kg kh ki hm dt translated">现在，这些汇率一直在变动，所以我真的不能从我提取汇率时抓取一个准确的截图，但是如果我看一下Bitstamp报告的BTC/美元汇率，它也是~ <strong class="jp hu"> 6380 </strong>。由于库币没有真正的美元法币交易对，你能得到的最接近的是比较BTC/USDT，这是一对与“稳定的硬币”称为USDT或系绳。</p><figure class="ld le lf lg fq mv fe ff paragraph-image"><div role="button" tabindex="0" class="mw mx di my bf mz"><div class="fe ff mu"><img src="../Images/071ede3c4a2be29f8e231f22b46c53cd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WRLhND1Q08uMHyCP4nMdJw.png"/></div></div><figcaption class="nc nd fg fe ff ne nf bd b be z ek">bitcoinwisdom.com/markets/bitstamp/btcusd</figcaption></figure><p id="c500" class="pw-post-body-paragraph jm jn ht jp b jq jr iu js jt ju ix jv kj jx jy jz kk kb kc kd kl kf kg kh ki hm dt translated">因此，如果你有一个在BTC定价的股票，比如LOCI/BTC，你可以用当前价格乘以<code class="eh mq mr ms li b">xrates.data.rates.BTC.USD</code>得到等值的美元价格。</p><h2 id="6d39" class="lm ln ht bd ls lt lu lv lw lx ly lz ma kj mb mc md kk me mf mg kl mh mi mj mk dt translated">交易对和价格数据</h2><p id="6792" class="pw-post-body-paragraph jm jn ht jp b jq ml iu js jt mm ix jv kj mn jy jz kk mo kc kd kl mp kg kh ki hm dt translated">那么，我们如何通过Kucoin Exchange API找到可用的交易符号对呢？嗯，有个<code class="eh mq mr ms li b">getTradingSymbols</code>功能。这比仅仅<code class="eh mq mr ms li b">getCoins</code>更进一步。不是每个硬币都有所有的<code class="eh mq mr ms li b">BTC</code>、<code class="eh mq mr ms li b">ETH</code>、<code class="eh mq mr ms li b">NEO</code>、<code class="eh mq mr ms li b">USDT</code>和<code class="eh mq mr ms li b">KCS</code>对。大多数只有<code class="eh mq mr ms li b">BTC &amp; ETH.</code></p><pre class="ld le lf lg fq lh li lj lk aw ll dt"><span id="b9d2" class="lm ln ht li b fv lo lp l lq lr">kucoin.getTradingSymbols();<br/>symbols = _;</span><span id="8d77" class="lm ln ht li b fv mt lp l lq lr">symbols.data.length; // 353<br/></span></pre><p id="04d5" class="pw-post-body-paragraph jm jn ht jp b jq jr iu js jt ju ix jv kj jx jy jz kk kb kc kd kl kf kg kh ki hm dt translated">你可以在Kucoin网站的市场屏幕上看到这个图表。</p><figure class="ld le lf lg fq mv fe ff paragraph-image"><div role="button" tabindex="0" class="mw mx di my bf mz"><div class="fe ff ng"><img src="../Images/af22fa5052dc59bc1ed013e93de49a59.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*S1qCkDEI9jpcjzaXPSKzpg.png"/></div></div><figcaption class="nc nd fg fe ff ne nf bd b be z ek">https://www.kucoin.com/#/markets</figcaption></figure><p id="171f" class="pw-post-body-paragraph jm jn ht jp b jq jr iu js jt ju ix jv kj jx jy jz kk kb kc kd kl kf kg kh ki hm dt translated">所以我们可以看到交易符号对比硬币多，这是我们预料到的。在我们之前的<code class="eh mq mr ms li b">getCoins</code>例子中，<code class="eh mq mr ms li b">locicoin</code>是一枚硬币，而</p><p id="3773" class="pw-post-body-paragraph jm jn ht jp b jq jr iu js jt ju ix jv kj jx jy jz kk kb kc kd kl kf kg kh ki hm dt translated"><code class="eh mq mr ms li b">locipairs = symbols.data.filter( s=&gt; s.coinType === locicoin.coin );</code></p><p id="bfe8" class="pw-post-body-paragraph jm jn ht jp b jq jr iu js jt ju ix jv kj jx jy jz kk kb kc kd kl kf kg kh ki hm dt translated">是一套所有对为<code class="eh mq mr ms li b">locicoin.coin</code>(硬币属性为<code class="eh mq mr ms li b">'LOCI'</code>)。</p><pre class="ld le lf lg fq lh li lj lk aw ll dt"><span id="3b37" class="lm ln ht li b fv lo lp l lq lr">[ <br/>{ coinType: 'LOCI', trading: true, symbol: 'LOCI-BTC', lastDealPrice: <strong class="li hu">0.00000517</strong>, buy: 0.00000457, sell: 0.00000514, change: -7e-8, coinTypePair: 'BTC', sort: 100, feeRate: 0.001, volValue: 0.09000668, high: 0.00000552, datetime: 1531255308000, vol: 18075.6256, low: 0.00000452, changeRate: -0.0134 },</span><span id="60dd" class="lm ln ht li b fv mt lp l lq lr">{ coinType: 'LOCI', trading: true, symbol: 'LOCI-ETH', lastDealPrice: 0.00008, buy: 0.0000675, sell: 0.000081, change: 0.000007, coinTypePair: 'ETH', sort: 0, feeRate: 0.001, volValue: 1.55628934, high: 0.00008, datetime: 1531255308000, vol: 20357.2562, low: 0.0000652, changeRate: 0.0959 }<br/> <br/>]</span></pre><p id="a047" class="pw-post-body-paragraph jm jn ht jp b jq jr iu js jt ju ix jv kj jx jy jz kk kb kc kd kl kf kg kh ki hm dt translated">因此，当我们转到市场屏幕并使用<code class="eh mq mr ms li b">loci</code>的过滤/搜索小部件时，我们可以看到它果然作为<code class="eh mq mr ms li b">LOCI-BTC</code>和<code class="eh mq mr ms li b">LOCI-ETH</code>对进行交易。</p><div class="ld le lf lg fq ab cb"><figure class="nh mv ni nj nk nl nm paragraph-image"><div role="button" tabindex="0" class="mw mx di my bf mz"><img src="../Images/565178b87bc996049591252cac5ed017.png" data-original-src="https://miro.medium.com/v2/resize:fit:998/format:webp/1*rUm0pvPBX4qQ3Of8HZwZ1g.png"/></div></figure><figure class="nh mv nn nj nk nl nm paragraph-image"><div role="button" tabindex="0" class="mw mx di my bf mz"><img src="../Images/f6ad22fcc5542075b2018d5609880fb0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1004/format:webp/1*-5EJRHEjegj8tGP-5d9KlQ.png"/></div><figcaption class="nc nd fg fe ff ne nf bd b be z ek no di np nq">Filtered <a class="ae ji" href="https://www.kucoin.com/#markets" rel="noopener ugc nofollow" target="_blank">https://www.kucoin.com/#markets</a> page.</figcaption></figure></div><p id="e8a7" class="pw-post-body-paragraph jm jn ht jp b jq jr iu js jt ju ix jv kj jx jy jz kk kb kc kd kl kf kg kh ki hm dt translated">注意<code class="eh mq mr ms li b">LOCI-BTC</code>的价格在用户界面上被列为<code class="eh mq mr ms li b">0.00000517(BTC)</code>。这与我们在下面的<code class="eh mq mr ms li b">locibtcpair</code>中检索到的实时数据相匹配。</p><pre class="ld le lf lg fq lh li lj lk aw ll dt"><span id="7665" class="lm ln ht li b fv lo lp l lq lr">locibtcpair = locipairs.filter( p=&gt; p.coinTypePair === 'BTC' )[0];<br/>locibtc = locibtcpair.lastDealPrice; // 0.00000517</span><span id="50c1" class="lm ln ht li b fv mt lp l lq lr">lociusd = locibtc * <!-- -->xrates.data.rates.BTC.USD; // 6380.30 is BTCUSD</span></pre><p id="b908" class="pw-post-body-paragraph jm jn ht jp b jq jr iu js jt ju ix jv kj jx jy jz kk kb kc kd kl kf kg kh ki hm dt translated">现在我们可以把那个<code class="eh mq mr ms li b">locibtc</code>转换成<code class="eh mq mr ms li b">lociusd</code> = $0.032986151或者~$0.03。<br/>可以肯定的是，如果我们打开Kucoin上的图形交易界面，我们看到的是0.03美元。</p><figure class="ld le lf lg fq mv fe ff paragraph-image"><div role="button" tabindex="0" class="mw mx di my bf mz"><div class="fe ff nr"><img src="../Images/96bd0837b756ef827d4e33580f709dc2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*sfLDzFTZOdkyT2HLWQOKvA.png"/></div></div><figcaption class="nc nd fg fe ff ne nf bd b be z ek"><a class="ae ji" href="https://www.kucoin.com/#/trade.pro/LOCI-BTC" rel="noopener ugc nofollow" target="_blank">https://www.kucoin.com/#/trade.pro/LOCI-BTC</a></figcaption></figure><p id="5cb4" class="pw-post-body-paragraph jm jn ht jp b jq jr iu js jt ju ix jv kj jx jy jz kk kb kc kd kl kf kg kh ki hm dt translated">在我们继续之前，让我们看看<code class="eh mq mr ms li b">locibtcpair</code>的其他一些属性，看看是否还有其他有用的东西。果然，有一个<code class="eh mq mr ms li b">buy</code>和<code class="eh mq mr ms li b">sell</code>属性，匹配了订单簿中的最高买价和卖价。</p><figure class="ld le lf lg fq mv fe ff paragraph-image"><div role="button" tabindex="0" class="mw mx di my bf mz"><div class="fe ff ns"><img src="../Images/a03304091a0ba823de8bb03b94627447.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Day8Tfam2LEV4S2Myevh0g.png"/></div></div><figcaption class="nc nd fg fe ff ne nf bd b be z ek">locipairs[0].buy is the highest bid, locipairs[0].sell is the lowest offer</figcaption></figure><p id="d889" class="pw-post-body-paragraph jm jn ht jp b jq jr iu js jt ju ix jv kj jx jy jz kk kb kc kd kl kf kg kh ki hm dt translated"><code class="eh mq mr ms li b">buy</code>表示最高出价<code class="eh mq mr ms li b">0.00000457 BTC per LOCI</code>，而<code class="eh mq mr ms li b">sell</code>表示最低出价<code class="eh mq mr ms li b">0.00000514 BTC per LOCI</code>。我们也可以在出价中称之为457 satoshis(或简称为sats ),在出价中称之为514 sats。买卖差价就是价差。在交易量较低的硬币中，这种差价可能很大，因为在每个价格水平上没有足够的交易量。如果你试图确定在这个特定的时间点，你可以在市场上购买或出售多少枚硬币，这会影响你的定价。</p><p id="eabe" class="pw-post-body-paragraph jm jn ht jp b jq jr iu js jt ju ix jv kj jx jy jz kk kb kc kd kl kf kg kh ki hm dt translated">将来，我们可以通过使用方便的<code class="eh mq mr ms li b">getTicker</code>函数更快地获得上面的信息，该函数带有一个<code class="eh mq mr ms li b">pair</code>属性参数。</p><p id="fce7" class="pw-post-body-paragraph jm jn ht jp b jq jr iu js jt ju ix jv kj jx jy jz kk kb kc kd kl kf kg kh ki hm dt translated"><code class="eh mq mr ms li b">kucoin.getTicker({pair:locibtcpair.symbol}); // {pair:'LOCI-BTC'}</code></p><p id="a6ce" class="pw-post-body-paragraph jm jn ht jp b jq jr iu js jt ju ix jv kj jx jy jz kk kb kc kd kl kf kg kh ki hm dt translated">这只是获取特定报价器的一种稍微有效的方式，而不是像<code class="eh mq mr ms li b">kucoin.getTradingSymbols()</code>那样一次获取所有报价器。</p><p id="9e9f" class="pw-post-body-paragraph jm jn ht jp b jq jr iu js jt ju ix jv kj jx jy jz kk kb kc kd kl kf kg kh ki hm dt translated">还记得在我们的CoinMarketCap示例中，我们想要确定一个<code class="eh mq mr ms li b">XMR</code>代币可以购买多少个<code class="eh mq mr ms li b">WAX</code>代币的等值美元。现在让我们用另一双鞋试试同样的东西。像<code class="eh mq mr ms li b">LOCI/WTC</code>这样的定制款怎么样？我想知道多少个<code class="eh mq mr ms li b">LOCI</code>相当于一个<code class="eh mq mr ms li b">Waltonchain</code>币。</p><h2 id="8723" class="lm ln ht bd ls lt lu lv lw lx ly lz ma kj mb mc md kk me mf mg kl mh mi mj mk dt translated">首先是一些让我们生活更轻松的设置:</h2><pre class="ld le lf lg fq lh li lj lk aw ll dt"><span id="bc74" class="lm ln ht li b fv lo lp l lq lr">const async = require('asyncawait/async');<br/>const await = require('asyncawait/await');</span><span id="528c" class="lm ln ht li b fv mt lp l lq lr">async function get_kucoin_ticker_price_in_btc(pair) {<br/>  return new Promise(function(res, rej) {          <br/>    kucoin.getTicker({pair:pair}).then( function(ticker) {<br/>      res(ticker.data.<strong class="li hu">lastDealPrice</strong>); <br/>    });<br/>  });<br/>}</span></pre><p id="5551" class="pw-post-body-paragraph jm jn ht jp b jq jr iu js jt ju ix jv kj jx jy jz kk kb kc kd kl kf kg kh ki hm dt translated">现在我们可以做一些快速呼叫:</p><pre class="ld le lf lg fq lh li lj lk aw ll dt"><span id="f5f1" class="lm ln ht li b fv lo lp l lq lr">let locibtc = await get_kucoin_ticker_price_in_btc('LOCI-BTC');<br/>let wtcbtc  = await get_kucoin_ticker_price_in_btc('WTC-BTC');</span><span id="3d37" class="lm ln ht li b fv mt lp l lq lr">// locibtc = 0.00000517 BTC<br/>// wtcbtc  = 0.00100298 BTC</span><span id="bf98" class="lm ln ht li b fv mt lp l lq lr">let loci_per_wtc = wtcbtc / locibtc; // ~194 LOCI per WTC</span></pre><p id="0f0a" class="pw-post-body-paragraph jm jn ht jp b jq jr iu js jt ju ix jv kj jx jy jz kk kb kc kd kl kf kg kh ki hm dt translated">我们可以用这些信息做什么？我们可以估算出一个给定的WTC相对于LOCI的美元当量，甚至不用转换成美元。非常聪明。这意味着我们可以想出我们自己的碱基对，这些碱基对除了在你自己的网站上找不到。或者，您可以构建一个服务，在特定条件下将不同种类的令牌作为“兼容令牌”，作为交换支付的等效方法。您还可以构建一个筛选程序，显示您投资组合中的一组代币与您拥有的其他代币在相对强度基础上的表现，或者使用非陈旧数据，而不是从Kucoin交换数据，为您提供一个快速的方法，立即查看您可以积累的X代币比硬币Y多多少。</p><h2 id="0db7" class="lm ln ht bd ls lt lu lv lw lx ly lz ma kj mb mc md kk me mf mg kl mh mi mj mk dt translated">但是等等！我们还没完。</h2><p id="28dc" class="pw-post-body-paragraph jm jn ht jp b jq ml iu js jt mm ix jv kj mn jy jz kk mo kc kd kl mp kg kh ki hm dt translated">请记住，最终目标是为一组令牌提供一个定制的碱基对，这些令牌通常不会像<code class="eh mq mr ms li b">LOCI-BTC</code>那样相互列出，而是使用我们可以通过实时exchange数据源获得的最准确的信息。在前面的例子中，我们从<code class="eh mq mr ms li b"><strong class="jp hu">lastDealPrice</strong></code>中获取信息，并根据它得出汇率的估计值。好像很合理吧？嗯，仅仅因为它过去在那里交易，它仍然是一个陈旧的报价，仅仅因为其他人用一些代币交易<code class="eh mq mr ms li b">LOCI</code>或<code class="eh mq mr ms li b">WTC</code>对<code class="eh mq mr ms li b">BTC</code>并不意味着确切的交易价格将再次可用。</p><p id="9b23" class="pw-post-body-paragraph jm jn ht jp b jq jr iu js jt ju ix jv kj jx jy jz kk kb kc kd kl kf kg kh ki hm dt translated">我们不能交易我们希望存在的市场，也不能交易过去。我们只能交易<em class="jo">现在</em>实际存在的市场。如果你想把你的一些<code class="eh mq mr ms li b">WTC</code>换成等量的<code class="eh mq mr ms li b">LOCI</code>，你实际上必须在现实生活中进行两笔交易:(1)以最高的可用<code class="eh mq mr ms li b">bid</code>卖出你的<code class="eh mq mr ms li b">WTC</code>；以及(2)以最低的可用报价买入你的<code class="eh mq mr ms li b">LOCI</code>。在现实生活中，你会在两边的价差上放弃一点，所以我们的<em class="jo">定制碱基对</em> <code class="eh mq mr ms li b">LOCI-WTC</code>价格估计应该会考虑到这一点。</p><h2 id="cb53" class="lm ln ht bd ls lt lu lv lw lx ly lz ma kj mb mc md kk me mf mg kl mh mi mj mk dt translated">检查订单簿</h2><p id="6337" class="pw-post-body-paragraph jm jn ht jp b jq ml iu js jt mm ix jv kj mn jy jz kk mo kc kd kl mp kg kh ki hm dt translated"><em class="jo">检索LOCI-BTC交易对的所有当前订单:</em></p><pre class="ld le lf lg fq lh li lj lk aw ll dt"><span id="a5dd" class="lm ln ht li b fv lo lp l lq lr">kucoin.getOrderBooks({pair:'LOCI-BTC'});<br/>books = _;</span><span id="cfea" class="lm ln ht li b fv mt lp l lq lr">{ success: true, code: 'OK', msg: 'Operation succeeded.', timestamp: 1531259489343, data: { SELL: [ [Array], [Array], [Array], [Array], [Array], [Array] ], BUY: [ [Array], [Array], [Array], [Array], [Array], [Array] ], timestamp: 1531259319987 } }</span></pre><p id="6f2a" class="pw-post-body-paragraph jm jn ht jp b jq jr iu js jt ju ix jv kj jx jy jz kk kb kc kd kl kf kg kh ki hm dt translated">注意，<code class="eh mq mr ms li b">books.data</code>包含了<code class="eh mq mr ms li b">SELL</code>(报价)和<code class="eh mq mr ms li b">BUY</code>(出价)双方。我们实际上可以指定一个<code class="eh mq mr ms li b">type</code>,这样我们只获得<code class="eh mq mr ms li b">BUY</code>或<code class="eh mq mr ms li b">SELL</code>的数据，我们可以包含一个<code class="eh mq mr ms li b">limit</code>,以便从响应中引入更多行的数据。</p><pre class="ld le lf lg fq lh li lj lk aw ll dt"><span id="a89d" class="lm ln ht li b fv lo lp l lq lr">kucoin.getOrderBooks({pair:'LOCI-BTC',limit:10,type:'SELL'});<br/>loci_offers = _;</span><span id="b1a7" class="lm ln ht li b fv mt lp l lq lr">kucoin.getOrderBooks({pair:'WTC-BTC',limit:10,type:'BUY'});<br/>wtc_bids = _;</span></pre><figure class="ld le lf lg fq mv fe ff paragraph-image"><div role="button" tabindex="0" class="mw mx di my bf mz"><div class="fe ff nt"><img src="../Images/f5b5ced29198620252c88b0626db6e11.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CNn504sWUXWdfLWJ7-c2Sw.png"/></div></div></figure><p id="95f0" class="pw-post-body-paragraph jm jn ht jp b jq jr iu js jt ju ix jv kj jx jy jz kk kb kc kd kl kf kg kh ki hm dt translated"><code class="eh mq mr ms li b">wtc_bids.data</code>包含多行数组。每一行中的元素代表返回到用户界面上的相同数据:<br/> <code class="eh mq mr ms li b">[ priceBTC, amountOfCoin, amountOfCoinInBTC ]</code></p><figure class="ld le lf lg fq mv fe ff paragraph-image"><div role="button" tabindex="0" class="mw mx di my bf mz"><div class="fe ff nu"><img src="../Images/c147d64759d35c6685e5d6af5e22e852.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4mVEJbTq8djo_4xGwdkL4Q.png"/></div></div></figure><p id="93b7" class="pw-post-body-paragraph jm jn ht jp b jq jr iu js jt ju ix jv kj jx jy jz kk kb kc kd kl kf kg kh ki hm dt translated"><code class="eh mq mr ms li b">loci_offers.data</code>也包含数组行。每一行中的元素代表返回到用户界面上的相同数据:<br/> <code class="eh mq mr ms li b">[ priceBTC, amountOfCoin, amountOfCoinInBTC ]</code></p><p id="e7c5" class="pw-post-body-paragraph jm jn ht jp b jq jr iu js jt ju ix jv kj jx jy jz kk kb kc kd kl kf kg kh ki hm dt translated"><code class="eh mq mr ms li b">loci_offers.data</code>和<code class="eh mq mr ms li b">wtc_bids.data</code>中的第一个元素与从<code class="eh mq mr ms li b">getTickers({pair:'LOCI-BTC'}).then(t=&gt;t.data.sell)</code>或<code class="eh mq mr ms li b">getTickers({pair:'WTC-BTC'}).then(t=&gt;t.data.buy)</code>返回的元素相同。如果我们只关心最高出价和最低出价，我们可以只使用当前的WTC出价和LOCI出价，作为足够接近的实时近似值。看起来大概是这样的:</p><pre class="ld le lf lg fq lh li lj lk aw ll dt"><span id="de34" class="lm ln ht li b fv lo lp l lq lr">async function get_kucoin_price_in_btc(pair,side) {<br/>  return new Promise(function(res, rej) {<br/>    kc.getOrderBooks({pair:pair}).then( function(books) {<br/>      res(books.data[side][0][0]); <br/>    });<br/>  });<br/>}</span><span id="5294" class="lm ln ht li b fv mt lp l lq lr">let allowance =  5000000000000000000; // 5 WTC in wei (18 decimals)<br/>            <br/>let wtcprice = await get_kucoin_price_in_btc('WTC-BTC','BUY');           let lociprice = await get_kucoin_price_in_btc('LOCI-BTC','SELL');        </span><span id="f768" class="lm ln ht li b fv mt lp l lq lr">let wtcloci = wtcprice / lociprice;  // .00101807 / .00000514 = ~198<br/>let exchanged = wtcloci * allowance; // About 5*198 = ~990.34 LOCI</span></pre><p id="af49" class="pw-post-body-paragraph jm jn ht jp b jq jr iu js jt ju ix jv kj jx jy jz kk kb kc kd kl kf kg kh ki hm dt translated">在这个例子中，使用买价和卖价让我们更接近LOCI-WTC的实时汇率，大约是1 WTC = 198 LOCI。</p><h2 id="335b" class="lm ln ht bd ls lt lu lv lw lx ly lz ma kj mb mc md kk me mf mg kl mh mi mj mk dt translated">还有一件事…</h2><p id="f1ba" class="pw-post-body-paragraph jm jn ht jp b jq ml iu js jt mm ix jv kj mn jy jz kk mo kc kd kl mp kg kh ki hm dt translated">如果我们在交换非流动硬币，或者大量硬币，我们最好考虑从<code class="eh mq mr ms li b">getOrderBooks</code>数据中得到的数量。</p><p id="9a84" class="pw-post-body-paragraph jm jn ht jp b jq jr iu js jt ju ix jv kj jx jy jz kk kb kc kd kl kf kg kh ki hm dt translated">我们可以做得更好，而不是简单地假设我们可以以最接近的<code class="eh mq mr ms li b">BUY</code>或<code class="eh mq mr ms li b">SELL</code>价格购买或出售我们的全部数量。我们可以尝试的一种方法是计算大米的VWAP或体积。</p><p id="62a8" class="pw-post-body-paragraph jm jn ht jp b jq jr iu js jt ju ix jv kj jx jy jz kk kb kc kd kl kf kg kh ki hm dt translated">我们可以通过下面的方法来计算VWAP的粗略估计。我们将<code class="eh mq mr ms li b">data</code>行<code class="eh mq mr ms li b">reduce</code>和每个<code class="eh mq mr ms li b">priceBTC * amountOfCoin</code>相加，并将结果记为<code class="eh mq mr ms li b">total_price_times_volume</code>。<br/> 2。我们<code class="eh mq mr ms li b">reduce</code>了<code class="eh mq mr ms li b">data</code>行，把体积加起来就成了<code class="eh mq mr ms li b">total_volume</code>。<br/> 3。将<code class="eh mq mr ms li b">total_price_times_volume</code>除以<code class="eh mq mr ms li b">total_volume</code>。</p><p id="ba21" class="pw-post-body-paragraph jm jn ht jp b jq jr iu js jt ju ix jv kj jx jy jz kk kb kc kd kl kf kg kh ki hm dt translated">下面是上述算法在实践中的编码方式</p><pre class="ld le lf lg fq lh li lj lk aw ll dt"><span id="3719" class="lm ln ht li b fv lo lp l lq lr">const sum_price_times_volume = function(total,row) { <br/>  return parseFloat(total) + <br/>    (parseFloat(row[0])*parseFloat(row[1])); <br/>}</span><span id="da9f" class="lm ln ht li b fv mt lp l lq lr">const sum_volume = function(total,row) { <br/>  return parseFloat(total) + parseFloat(row[1]); <br/>}</span><span id="b90c" class="lm ln ht li b fv mt lp l lq lr">async function <strong class="li hu">get_kucoin_vwap_in_btc</strong>(pair,side) {</span><span id="6147" class="lm ln ht li b fv mt lp l lq lr">  return new Promise(function(res, rej) {<br/>    kucoin.getOrderBooks({pair:pair}).then( function(books) {<br/>      let total_price_times_volume =   <br/>        books.data[side].reduce(sum_price_times_volume);      // #1<br/>      let total_volume = books.data[side].reduce(sum_volume); // #2<br/>      <strong class="li hu">res(total_price_times_volume / total_volume);           // #3</strong><br/>    });<br/>  });<br/>}</span><span id="f198" class="lm ln ht li b fv mt lp l lq lr">let allowance =  5000000000000000000; // 5 WTC in wei (18 decimals)<br/>            <br/>let wtcprice = await get_kucoin_vwap_in_btc('WTC-BTC','BUY');<br/>let lociprice = await get_kucoin_vwap_in_btc('LOCI-BTC','SELL');</span><span id="cba1" class="lm ln ht li b fv mt lp l lq lr">let wtcloci = wtcprice / lociprice;<br/>let exchanged = wtcloci * allowance;<br/></span></pre><p id="d898" class="pw-post-body-paragraph jm jn ht jp b jq jr iu js jt ju ix jv kj jx jy jz kk kb kc kd kl kf kg kh ki hm dt translated">我们在处理实时数据，所以账面上的价格已经改变了。为了演示的目的，我编写了一个<code class="eh mq mr ms li b">truffle test</code>来看看结果。在结果中，我们将看到使用陈旧的<code class="eh mq mr ms li b">coinmarketcap-api</code>数据、略显幼稚的<code class="eh mq mr ms li b">bid</code>和<code class="eh mq mr ms li b">ask</code>价格以及使用上述<code class="eh mq mr ms li b"><strong class="jp hu">get_kucoin_vwap_in_btc</strong></code> <strong class="jp hu"> </strong>方法的最终结果之间的细微差别。</p><figure class="ld le lf lg fq mv fe ff paragraph-image"><div role="button" tabindex="0" class="mw mx di my bf mz"><div class="fe ff nv"><img src="../Images/66e925c175263221011b6fe6ee9f771d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HP5L-I4k7wmQhcs5Sfn4ig.png"/></div></div></figure><p id="8f4f" class="pw-post-body-paragraph jm jn ht jp b jq jr iu js jt ju ix jv kj jx jy jz kk kb kc kd kl kf kg kh ki hm dt translated">请注意<code class="eh mq mr ms li b">loci-per-wtc</code>费率是如何根据所提供的定价数据源而变化的，对于单个用例来说，这似乎没有太大的区别。然而，对于重复转移或相对较大的交易量来说，这可能意味着天壤之别。</p><h2 id="44b1" class="lm ln ht bd ls lt lu lv lw lx ly lz ma kj mb mc md kk me mf mg kl mh mi mj mk dt translated">关键要点</h2><ul class=""><li id="e3dc" class="nw nx ht jp b jq ml jt mm kj ny kk nz kl oa ki ob oc od oe dt translated">支持实时数据而非陈旧数据，以获得准确的定价数据。</li><li id="d34f" class="nw nx ht jp b jq of jt og kj oh kk oi kl oj ki ob oc od oe dt translated">如果可能，从数据源获取数据，如<code class="eh mq mr ms li b">kucoin-api</code>对<code class="eh mq mr ms li b">coinmarketcap-api</code></li><li id="f535" class="nw nx ht jp b jq of jt og kj oh kk oi kl oj ki ob oc od oe dt translated">考虑一下利差的实际情况。</li><li id="9be9" class="nw nx ht jp b jq of jt og kj oh kk oi kl oj ki ob oc od oe dt translated">利用<em class="jo">当前订单簿</em>数据计算实际数量。</li><li id="cfe7" class="nw nx ht jp b jq of jt og kj oh kk oi kl oj ki ob oc od oe dt translated">将订单簿数据整合到一个<em class="jo"> VWAP </em>中，以获得更好的结果。</li></ul><p id="2535" class="pw-post-body-paragraph jm jn ht jp b jq jr iu js jt ju ix jv kj jx jy jz kk kb kc kd kl kf kg kh ki hm dt translated">如果你对如何使用API有更多的想法，请在下面留下你的评论！</p><p id="4298" class="pw-post-body-paragraph jm jn ht jp b jq jr iu js jt ju ix jv kj jx jy jz kk kb kc kd kl kf kg kh ki hm dt translated"><em class="jo">丹·埃蒙斯(Dan Emmons)是一名区块链开发者，</em> <a class="ae ji" href="http://www.emmonspired.com/" rel="noopener ugc nofollow" target="_blank"> <em class="jo">埃蒙斯皮雷德有限责任公司</em> </a> <em class="jo">，一名</em> <a class="ae ji" href="http://cryptoconsortium.org/lookup/6f0d14" rel="noopener ugc nofollow" target="_blank"> <em class="jo">认证比特币专业人士</em> </a> <em class="jo">，认证以太坊开发者，全栈开发者，加密货币项目顾问。他还是一个名为</em><a class="ae ji" href="https://www.youtube.com/watch?v=SVBZ7mdgGcA" rel="noopener ugc nofollow" target="_blank"><em class="jo"># ByteSizeBlockchain</em></a><em class="jo">的Youtube频道和iTunes播客的创作者。</em></p></div></div>    
</body>
</html>