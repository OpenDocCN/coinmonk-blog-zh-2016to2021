<html>
<head>
<title>Deploying a smart contract to Ethereum</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">将智能合约部署到以太坊</h1>
<blockquote>原文：<a href="https://medium.com/coinmonks/deploying-a-smart-contract-to-ethereum-86daed0ff69?source=collection_archive---------2-----------------------#2017-11-05">https://medium.com/coinmonks/deploying-a-smart-contract-to-ethereum-86daed0ff69?source=collection_archive---------2-----------------------#2017-11-05</a></blockquote><div><div class="ef hh hi hj hk hl"/><div class="hm hn ho hp hq"><div class=""/><figure class="fi fk ir is it iu fe ff paragraph-image"><div role="button" tabindex="0" class="iv iw di ix bf iy"><div class="fe ff iq"><img src="../Images/c848081dd48d95ae28e802e0cfa506ba.png" data-original-src="https://miro.medium.com/v2/resize:fit:1398/format:webp/1*C9rkSR45k0dQR2h-uxawVw.png"/></div></div></figure><p id="8928" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">历史上从未有过这样一种技术，任何地方的任何人都可以公开部署代码，这些代码将立即并无限期地在成千上万个节点上同时确定地运行。此外，由于密码学和密码经济学，这种技术是无主的、不可信的，并且有动机继续下去。一旦契约被部署，它就有效地自治、永恒，并且只受机器法则的控制。</p><p id="78b2" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">让我们在区块链留下我们的印记。</p><p id="9771" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">这里有一个简单的合同，它持有一个公开的<strong class="jd hu">计数:</strong></p><pre class="jz ka kb kc fq kd ke kf kg aw kh dt"><span id="0d1b" class="ki kj ht ke b fv kk kl l km kn">pragma solidity ^0.4.11;  </span><span id="aa3e" class="ki kj ht ke b fv ko kl l km kn">contract Simple {    <br/>  <br/> uint8 public count;  <br/>    <br/> function Simple(uint8 _amount) {       <br/>  count = _amount;     <br/> }      </span><span id="7937" class="ki kj ht ke b fv ko kl l km kn"> function add(uint8 _amount) {         <br/>  count += _amount;     <br/> } </span><span id="1d73" class="ki kj ht ke b fv ko kl l km kn">}</span></pre><p id="8e03" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated"><strong class="jd hu">计数</strong>在构造函数<strong class="jd hu"> Simple()中初始化。</strong></p><p id="89a0" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">如果您正在使用我们的开源<a class="ae kp" href="https://concurrence.io/exploration/craftingscripts/" rel="noopener ugc nofollow" target="_blank">并发脚本</a>，您可以运行:</p><pre class="jz ka kb kc fq kd ke kf kg aw kh dt"><span id="ff30" class="ki kj ht ke b fv kk kl l km kn">node compile Simple</span></pre><p id="4451" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">这产生了一大块字节码:</p><pre class="jz ka kb kc fq kd ke kf kg aw kh dt"><span id="e665" class="ki kj ht ke b fv kk kl l km kn">6060604052341561000f57600080fd5b60405160208061011a833981016040528080516000805460ff90921660ff19909216919091179055505060d3806100476000396000f300606060405263ffffffff7c010000000000000000000000000000000000000000000000000000000060003504166302067e6a8114604557806306661abd14605d57600080fd5b3415604f57600080fd5b605b60ff600435166083565b005b3415606757600080fd5b606d609e565b60405160ff909116815260200160405180910390f35b6000805460ff19811660ff9182169390930116919091179055565b60005460ff16815600a165627a7a723058203b071253b061d82c255e5006105dfcb6234b29200503a45f7a55c842c0dbc10a0029</span></pre><p id="f9a9" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">要了解关于这个字节码的更多信息，请查看stackexchange 上的<a class="ae kp" href="https://ethereum.stackexchange.com/questions/119/what-opcodes-are-available-for-the-ethereum-evm" rel="noopener ugc nofollow" target="_blank">这篇文章。如果你真的想搞怪，也可以一头扎进</a><a class="ae kp" href="http://yellowpaper.io/" rel="noopener ugc nofollow" target="_blank">以太坊黄皮书</a>(朝向底部)。</p><p id="a707" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">让我们将这个字节码部署到testnet中:</p><pre class="jz ka kb kc fq kd ke kf kg aw kh dt"><span id="9b77" class="ki kj ht ke b fv kk kl l km kn">node deploy Simple</span></pre><p id="07dd" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">此外，您需要一个<strong class="jd hu"> arguments.js </strong>文件将一个数字传递给构造函数:</p><pre class="jz ka kb kc fq kd ke kf kg aw kh dt"><span id="29a5" class="ki kj ht ke b fv kk kl l km kn">module.exports = [253]</span></pre><p id="4b64" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">部署的输出如下所示:</p><pre class="jz ka kb kc fq kd ke kf kg aw kh dt"><span id="6ccd" class="ki kj ht ke b fv kk kl l km kn">paying a max of 2000000 gas @ the price of 22 gwei (22000000000) <br/>... <br/>==ETHER COST: 0.0029070139999999994 $1.0174548999999997</span></pre><p id="b09c" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">22gwei的价格，看起来好像花了一美元部署。</p><p id="a012" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">现在，在testnet的剩余生命周期中，来自任何地方的任何人都可以通过<a class="ae kp" href="https://ropsten.etherscan.io/address/0xd68ef7611913d0aff3627a92f5e502696887d626" rel="noopener ugc nofollow" target="_blank">0x d 68 ef 7611913d 0 aff 3627 a 92 F5 e 502696887d 626</a>与该契约进行交互。太棒了！</p></div><div class="ab cl kq kr hb ks" role="separator"><span class="kt bw bk ku kv kw"/><span class="kt bw bk ku kv kw"/><span class="kt bw bk ku kv"/></div><div class="hm hn ho hp hq"><p id="6a4f" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">让我们仔细看看这份合同，看看有什么问题。我们将想精心设计一些脚本，这样我们就不会在命令行上摸索了:</p><pre class="jz ka kb kc fq kd ke kf kg aw kh dt"><span id="edcc" class="ki kj ht ke b fv kk kl l km kn">//<br/>// usage: node contract getCount Simple<br/>//<br/>module.exports = (contract,params,args)=&gt;{<br/>  contract.methods.count().call().then((count)=&gt;{<br/>    console.log("COUNT:"+count)<br/>  })<br/>}</span><span id="c5e3" class="ki kj ht ke b fv ko kl l km kn">node contract getCount Simple</span><span id="28f1" class="ki kj ht ke b fv ko kl l km kn">COUNT:253</span></pre><p id="81ed" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">很好，所以我们当前的<strong class="jd hu">计数</strong>是<em class="kx"> 253 </em>，这就是我们部署合同时使用的。</p><p id="a74c" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">这是一个只读操作，我们没有改变合同的状态，因此任何人都可以免费读取<strong class="jd hu">计数</strong>，只要他们连接到以太坊区块链。</p><p id="a993" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">让我们在契约上运行<strong class="jd hu"> add() </strong>函数来实际更改状态。</p><pre class="jz ka kb kc fq kd ke kf kg aw kh dt"><span id="f01c" class="ki kj ht ke b fv kk kl l km kn">//<br/>// usage: node contract add Simple null #AMOUNT#<br/>//<br/>// ex: node contract add Simple null 1<br/>//<br/>module.exports = (contract,params,args)=&gt;{<br/>  console.log("**== adding "+args[5])<br/>  return contract.methods.add(args[5]).send({<br/>    from: params.accounts[0],<br/>    gas: params.gas,<br/>    gasPrice:params.gasPrice<br/>  })<br/>}<br/></span><span id="d464" class="ki kj ht ke b fv ko kl l km kn">node contract add Simple null 1<br/></span><span id="56ac" class="ki kj ht ke b fv ko kl l km kn">Success<br/>{<br/>  blockHash: '0x78ad780d0bf95737baec82f974e067d4ee67708829cbd4dad4fda15c3de39a51',<br/>  blockNumber: 1856672,<br/>  contractAddress: null,<br/>  cumulativeGasUsed: 26840,<br/>  from: '0x4ffd642a057ce33579a3ca638347b402b909f6d6',<br/>  gasUsed: 26840,<br/>  status: '0x1',<br/>  to: '0xd68ef7611913d0aff3627a92f5e502696887d626',<br/>  transactionHash: '0x78a472410ada67aa2345d37fb4d695e1e07702940aae51616efacb7e4b01621c',<br/>  transactionIndex: 0<br/>}</span></pre><p id="0488" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">查看<a class="ae kp" href="https://ropsten.etherscan.io/tx/0x78a472410ada67aa2345d37fb4d695e1e07702940aae51616efacb7e4b01621c" rel="noopener ugc nofollow" target="_blank"> etherscan.io </a>上的交易。</p><p id="390e" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">现在让我们再做一个<strong class="jd hu"> getCount() </strong>来看看契约的状态是什么:</p><pre class="jz ka kb kc fq kd ke kf kg aw kh dt"><span id="b41c" class="ki kj ht ke b fv kk kl l km kn">node contract getCount Simple</span><span id="4369" class="ki kj ht ke b fv ko kl l km kn">COUNT:254</span></pre><p id="876a" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">根据Etherscan的数据，将1加到那个单位大约需要0.17美元。这可能看起来有点贵，但实际上是怎么回事呢？</p><p id="714d" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">嗯，我们向网络广播我们想要进行交易，一些幸运的矿工能够通过强力cpu能力找到正确的随机数，挖掘包含我们的交易和其他交易的块，向网络的其余部分广播，然后世界上的每个<em class="kx">矿工根据他们的合同版本运行我们的交易，并得到相同的结果。然后我们可以问<em class="kx">他们中的任何一个</em>我们的<strong class="jd hu">计数</strong>是多少，结果会是一样的。即使银行、企业和政府起起落落，我们的<strong class="jd hu">计数</strong>仍然准确地停留在它被指示停留的地方。这真是太棒了。</em></p><p id="995c" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">让我们再多考虑一下天然气成本，因为合同交互成本在<a class="ae kp" href="https://concurrence.io" rel="noopener ugc nofollow" target="_blank">并发</a>如何工作中起着巨大的作用。</p><p id="e25f" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">让我们把愿意支付的价格降低110:</p><pre class="jz ka kb kc fq kd ke kf kg aw kh dt"><span id="63d4" class="ki kj ht ke b fv kk kl l km kn">echo "2" &gt; gasprice.int</span></pre><p id="ea76" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">现在让我们再次运行相同的事务:</p><pre class="jz ka kb kc fq kd ke kf kg aw kh dt"><span id="e39c" class="ki kj ht ke b fv kk kl l km kn">node contract add Simple null 1</span></pre><p id="9c6b" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">现在检查计数，我们看到:</p><pre class="jz ka kb kc fq kd ke kf kg aw kh dt"><span id="cf36" class="ki kj ht ke b fv kk kl l km kn">COUNT:255</span></pre><p id="08d3" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">查看<a class="ae kp" href="https://ropsten.etherscan.io/tx/0x2af7ef9e4c20b10e8fa0b5252bb9c2ab1df01b81058c3e99e87562bae47fa97d" rel="noopener ugc nofollow" target="_blank"> etherscan.io </a>上的交易。</p><p id="9661" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">上次花了大约25秒。这一次花了55秒，但花费了大约0.017美元。这是因为矿商不仅受到大宗开采奖励的激励，还受到用于交易的天然气的激励。由他们来决定哪些交易值得挖掘。根据我们的需要，我们可以用成本换取速度。</p><p id="e794" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">(<em class="kx">ethers can . io提供的另一个整洁的工具是</em><a class="ae kp" href="https://ropsten.etherscan.io/vmtrace?txhash=0x2af7ef9e4c20b10e8fa0b5252bb9c2ab1df01b81058c3e99e87562bae47fa97d" rel="noopener ugc nofollow" target="_blank"><em class="kx">VM trace</em></a><em class="kx">。您可以看到事务的每个步骤，包括操作码和成本。看看与其他东西相比，SSTORE有多贵。</em>)</p></div><div class="ab cl kq kr hb ks" role="separator"><span class="kt bw bk ku kv kw"/><span class="kt bw bk ku kv kw"/><span class="kt bw bk ku kv"/></div><div class="hm hn ho hp hq"><p id="d37a" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">我们还应该涉及安全性和bug。这个契约是公开的，所以任何人都可以运行add函数，任何人都可以看到当前的计数。现在这很好，但是如果有1亿美元处于危险之中呢…呀！这使得合同开发者的工作变得极其困难，因为在接下来的时间里，你所做的一切都受到每个坏演员的摆布。每个契约交互都是确定的；我们<em class="kx">可以</em>确定给定一个状态和一个动作会发生什么，但是就像下棋一样，预测棋盘上每一个可能的结果也是相对困难的。</p><p id="2e0c" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">那么如果我们再运行一次<strong class="jd hu"> add() </strong>会发生什么呢？假设没有其他人已经点击我们的合同，计数将像以前一样上升，我们应该看到<em class="kx"> 256 </em>对不对？让我们来试试:</p><pre class="jz ka kb kc fq kd ke kf kg aw kh dt"><span id="6e3f" class="ki kj ht ke b fv kk kl l km kn">node contract add Simple null 1</span></pre><p id="5ad1" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">查看<a class="ae kp" href="https://ropsten.etherscan.io/tx/0xee07a309049d3ee0d78ba66f186fd0a3727cd8b552ec4b4b331a626dc3570815" rel="noopener ugc nofollow" target="_blank"> etherscan.io </a>上的交易。</p><p id="f0c7" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">现在检查计数，我们看到:</p><pre class="jz ka kb kc fq kd ke kf kg aw kh dt"><span id="4476" class="ki kj ht ke b fv kk kl l km kn">COUNT:0</span></pre><p id="d73c" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated">哦沙特！我们的账户余额为0！H4ckers！嗯，不完全是，更像是uint8 <a class="ae kp" href="https://en.wikipedia.org/wiki/Integer_overflow" rel="noopener ugc nofollow" target="_blank">溢出</a>，但是你明白了。理解你的合同可能遇到的每一种可能性的每一个方面是非常重要的，因为这关系到大量的真金白银。</p><blockquote class="ky"><p id="31ab" class="kz la ht bd lb lc ld le lf lg lh jy ek translated"><a class="ae kp" href="https://coincodecap.com/?utm_source=coinmonks" rel="noopener ugc nofollow" target="_blank">直接在您的收件箱中获得最佳软件交易</a></p></blockquote><figure class="lj lk ll lm ln iu fe ff paragraph-image"><a href="https://coincodecap.com/?utm_source=coinmonks"><div class="fe ff li"><img src="../Images/7c0b3dfdcbfea594cc0ae7d4f9bf6fcb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1168/format:webp/0*OJ-qb5G6i863msBB.png"/></div></a></figure><p id="bdf0" class="pw-post-body-paragraph jb jc ht jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hm dt translated"><em class="kx">这是摘自</em> <a class="ae kp" href="https://concurrence.io/exploration/deployingacontract/" rel="noopener ugc nofollow" target="_blank"> <em class="kx">部署合同</em> </a> <em class="kx">章节关于</em><a class="ae kp" href="https://concurrence.io" rel="noopener ugc nofollow" target="_blank"><em class="kx">concurrence . io</em></a><em class="kx">。</em></p><figure class="jz ka kb kc fq iu"><div class="bz el l di"><div class="lo lp l"/></div></figure></div></div>    
</body>
</html>